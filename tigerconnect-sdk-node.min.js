module.exports=function(n){function r(e){if(a[e])return a[e].exports;var t=a[e]={exports:{},id:e,loaded:!1};return n[e].call(t.exports,t,t.exports,r),t.loaded=!0,t.exports}var a={};return r.m=n,r.c=a,r.p="",r(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(global._babelPolyfill||!1===global._tcShouldPolyfill?215:217);n(224)("./node");var r=n(94).TigerConnectClient;t.Client=r},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.VERSIONS=t.ROUTES=void 0;var u=r(n(10)),a=r(n(9)),o=r(n(29)),i=r(n(1)),s=r(n(2));t.recoverFromNotFound=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fallbackValue,i=void 0===t?null:t,n=e.httpStatusCodes,s=void 0===n?d:n;return function(e,t,n){var r,o=n.value;return n.value=(r=(0,a.default)(u.default.mark(function e(){var t,n,r,a=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,t=a.length,n=Array(t),r=0;r<t;r++)n[r]=a[r];return e.next=4,o.call.apply(o,[this].concat(n));case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(0),e.t0.response&&s.includes(e.t0.response.status))return e.abrupt("return",i);e.next=13;break;case 13:if(e.t0.code===l.PermissionDeniedError.CODE&&s.includes(403))return e.abrupt("return",i);e.next=17;break;case 17:if(e.t0.code===l.WrongCredentialsError.CODE&&s.includes(401))return e.abrupt("return",i);e.next=21;break;case 21:throw e.t0;case 22:case"end":return e.stop()}},e,this,[[0,7]])})),function(){return r.apply(this,arguments)}),n}};var c=r(n(33)),l=n(17),d=[403,404],f=(t.ROUTES={CONVERSATION_FIND_ALL:"conversations.findAll",DISTRIBUTION_LIST_FIND:"distributionLists.find",ENTITIES_FIND_ALL:"entities.findAll",ESCALATION:"escalation",EVENTS_ACK:"events.ack",EVENTS_CLOSE_ALL_CONNECTIONS:"events.closeAllConnections",GROUP_ADD_MEMBERS:"group.addMembers",GROUP_CREATE:"group.create",GROUP_DESTROY:"group.destroy",GROUP_FIND:"group.find",GROUP_FIND_ALL_MEMBER_IDS:"group.findAllMemberIds",GROUP_UPDATE:"group.update",MESSAGE_FIND:"messages.find",MESSAGE_FIND_RECIPIENT_STATUS:"messages.findRecipientStatus",MESSAGE_FIND_RECIPIENT_STATUS_MULTI:"messages.findRecipientStatusMulti",MESSAGE_FORWARD:"message.forward",MESSAGE_SEND:"message.send",MESSAGE_UPDATE_RECIPIENT_STATUS_MULTI:"messages.updateRecipientStatusMulti",METADATA_FIND:"metadata.find",MUTE_FIND_ALL:"mute.findAll",ORGANIZATION_FIND:"organization.find",ORGANIZATION_FIND_ALL_OF_USER:"organization.findAllOfUser",ROLES_CREATE_P2P_GROUP:"roles.createP2PGroup",SEARCH_QUERY:"search.query",TEAMS_CREATE:"teams.create",TEAMS_FIND:"teams.find",TEAMS_LEAVE:"teams.leave",TEAMS_UPDATE:"teams.update",USER_FIND:"user.find",USER_FIND_ME:"user.findMe"},t.VERSIONS={VERSION_TWO:"v2",VERSION_FIVE:"v5"}),p=((0,s.default)(h,[{key:"getVersion",value:function(e){var t=f.VERSION_TWO,n=f.VERSION_FIVE;return{version:this.config.condensedReplays?n:t}}}]),h);function h(e,t){(0,i.default)(this,h),(0,o.default)(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient}t.default=p,(0,o.default)(p.prototype,c.default.prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(3)),s=r(n(4)),d=r(n(12)),f=r(n(13)),p=r(n(5)),a=r(n(29)),o=r(n(1)),u=r(n(2)),h=r(n(33)),y=n(23),g=((0,u.default)(v,[{key:"_resolveModelIdWithTypes",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+l(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+l(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+c(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+c(t));if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return y.Validator.oneOf("thing",e.$entityType,(0,y.arrayWrap)(t)),e.serverId||e.id||null}},{key:"_resolveEntity",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+l(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+l(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+c(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+c(t));if(t=t?(0,y.arrayWrap)(t):this.host.allModelEntityTypes,"object"===(void 0===e?"undefined":(0,p.default)(e))&&(e.$entityType&&(y.Validator.oneOf("thing",e.$entityType,t),t=[e.$entityType]),e=e.id),!t||"function"!=typeof t[f.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+c(t));if(!t||"function"!=typeof t[f.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+l(t));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,d.default)(t);!(n=(o=i.next()).done);n=!0){var s=o.value,u=this.host.modelsByEntityType[s].get(e);if(u)return u}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),v);function v(e,t){(0,o.default)(this,v),this._resolveModelId=function(e){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+l(e));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+c(e));return"string"==typeof e?e:e&&(e.serverId||e.id)||null},(0,a.default)(this,t),this.host=e,this.config=e.config,this.httpClient=e.httpClient}t.default=g,(0,a.default)(g.prototype,h.default.prototype),e.exports=t.default},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WrongCredentialsError=t.ValidationError=t.TargetNotSupportedError=t.RequiresBasicAuthError=t.PermissionDeniedError=t.NotSupportedError=t.NotSignedInError=t.NotFoundError=t.ConnectionUnavailableError=void 0;var a=r(n(124)),o=r(n(125)),i=r(n(126)),s=r(n(127)),u=r(n(128)),c=r(n(129)),l=r(n(130)),d=r(n(66)),f=r(n(131));t.ConnectionUnavailableError=a.default,t.NotFoundError=o.default,t.NotSignedInError=i.default,t.NotSupportedError=s.default,t.PermissionDeniedError=u.default,t.RequiresBasicAuthError=c.default,t.TargetNotSupportedError=l.default,t.ValidationError=d.default,t.WrongCredentialsError=f.default},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("reuse-promise")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerValueEnum=t.default=void 0;var a,o=r(n(6)),i=r(n(8)),s=r(n(7)),u=r(n(83)),c=r(n(16)),l=r(n(1)),d=r(n(2)),f=r(n(268)),p=r(n(59)),h=((0,d.default)(y,[{key:"resolve",value:function(e){return e||this.defaultValue}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),y);function y(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var n in(0,l.default)(this,y),Array.isArray(e)&&(e=e.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=t.defaultValue||null,e){this[n]=t.valueFn?t.valueFn(n):n;var r=(0,c.default)({key:n},e[n]);this.entriesByKey[n]=r,this.entries.push(r),this.keys.push(n)}(0,u.default)(this.keys),(0,u.default)(this.entries),(0,u.default)(this.entriesByKey)}function g(){return(0,l.default)(this,g),(0,i.default)(this,(g.__proto__||(0,o.default)(g)).apply(this,arguments))}t.default=h,t.ServerValueEnum=(a=h,(0,s.default)(g,a),(0,d.default)(g,[{key:"mapEnumKeyToServerValue",value:function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=(0,p.default)(this.entries,function(e,t){return e[t.key]=t.serverValue},{}))}},{key:"mapServerValueToEnumKey",value:function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=(0,f.default)(this.mapEnumKeyToServerValue()))}},{key:"fromServer",value:function(e){return this.mapServerValueToEnumKey()[e]}},{key:"toServer",value:function(e){return this.mapEnumKeyToServerValue()[this.resolve(e)]}},{key:"resolve",value:function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue}}]),g)},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return Array.isArray(e)?e:null!=e?[e]:[]}Object.defineProperty(t,"__esModule",{value:!0}),t.Validator=t.urlEncodedTaggedString=t.SortedArray=t.replaceKeys=t.replaceKey=t.phone=t.jsonCloneDeep=t.isConfigurableProperty=t.generateComparator=t.email=t.date=t.attachments=t.Camelizer=void 0,t.arrayWrapBound=function(){return o(this)},t.arrayWrap=o;var i=a(n(27)),s=r(n(80)),u=r(n(44)),c=r(n(32)),l=a(n(216)),d=a(n(81)),f=a(n(82)),p=r(n(28)),h=a(n(218)),y=a(n(219)),g=a(n(213)),v=a(n(221)),m=a(n(214));t.Camelizer=i.default,t.attachments=s,t.date=u,t.email=c,t.generateComparator=l.default,t.isConfigurableProperty=d.default,t.jsonCloneDeep=f.default,t.phone=p,t.replaceKey=h.default,t.replaceKeys=y.default,t.SortedArray=g.default,t.urlEncodedTaggedString=v.default,t.Validator=m.default},function(e,t){e.exports=require("babel-runtime/helpers/get")},function(e,t){e.exports=require("lodash/defaults")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityType=t.TypingContext=t.SearchType=t.ProcessingActionTypes=t.PresenceStatus=t.PatientCareCardUIType=t.PatientCareCardType=t.PatientCareCardActionType=t.Networks=t.MessageType=t.MessageSubType=t.MessageSenderStatus=t.MessageRecipientStatus=t.MessagePriority=t.GroupType=t.EscalationStatus=t.EscalationChangeAction=t.ConversationAnchorPoints=t.AllowedSendersReason=void 0;var a=r(n(157)),o=r(n(158)),i=r(n(159)),s=r(n(68)),u=r(n(48)),c=r(n(160)),l=r(n(41)),d=r(n(161)),f=r(n(162)),p=r(n(163)),h=r(n(69)),y=r(n(164)),g=r(n(165)),v=r(n(166)),m=r(n(70)),b=r(n(49)),w=r(n(167)),_=r(n(71)),x=r(n(72));t.AllowedSendersReason=a.default,t.ConversationAnchorPoints=o.default,t.EscalationChangeAction=i.default,t.EscalationStatus=s.default,t.GroupType=u.default,t.MessagePriority=c.default,t.MessageRecipientStatus=l.default,t.MessageSenderStatus=d.default,t.MessageSubType=f.default,t.MessageType=p.default,t.Networks=h.default,t.PatientCareCardActionType=y.default,t.PatientCareCardType=g.default,t.PatientCareCardUIType=v.default,t.PresenceStatus=m.default,t.ProcessingActionTypes=b.default,t.SearchType=w.default,t.TypingContext=_.default,t.VisibilityType=x.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,r){return(0,s.default)(e)?e.map(function(e){return a(e,r)}):(0,i.default)(e)?(0,o.default)(e,function(e,t,n){e[r(n)]=a(t,r)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(59)),i=r(n(271)),s=r(n(269)),u=r(n(279)),c=r(n(255)),l=r(n(275)),d={camelizeKey:(0,l.default)(c.default),underscoreKey:(0,l.default)(u.default),camelizeObject:function(e){return a(e,d.camelizeKey)},underscoreObject:function(e){return a(e,d.underscoreKey)}};t.default=d,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPhone=function(e){return e&&/^\+?([0-9]{7,15})$/.test(e.replace(/[-.● ()]/g,""))},t.formatPhone=function(e){var t=e.replace(/\D/g,"");return/^\+?1/.test(e)?t.replace(/^(1)(\d{3})(\d{3})(\d{4})/,"+$1 $2 $3 $4"):("1"===t[0]&&(t=t.slice(1)),t.replace(/^(\d{3})(\d{3})(\d{4})/,"$1 $2 $3"))},t.formatPhoneWithDash=function(e){var t=e.replace(/\D/g,"");return"1"===t[0]&&(t=t.slice(1)),t.replace(/^(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")},t.normalizePhone=function(e){return e.replace(/\D/g,"")},t.normalizePhoneUS=function(e){var t=e.replace(/\D/g,"");return"1"!==t[0]&&(t="1"+t),"+"+t}},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmail=void 0;var r,a=n(247),o=(r=a)&&r.__esModule?r:{default:r};t.isEmail=o.default},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("lodash-bound/uniq")},function(e,t){e.exports=require("lodash/get")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){var r=A(t);if(!I[r]){var a;if(!n.placeholderEntityDelayBeforeRefreshing)return x(e,t,n).catch((a=console).error.bind(a));Object.defineProperty(t,"$$loadingScheduled",{value:!0,configurable:!0}),I[r]=setTimeout(function(){return E(e,t,n)},n.placeholderEntityDelayBeforeRefreshing)}}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function y(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=y(t[0],n);return t.every(function(e){return y(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return y(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+y(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i=r(n(3)),s=r(n(4)),u=r(n(5)),l=r(n(18)),g=r(n(10)),v=r(n(19)),m=r(n(12)),b=r(n(13)),w=r(n(22)),d=r(n(9)),f=r(n(31)),p=r(n(16)),_=r(n(61)),x=(o=(0,d.default)(g.default.mark(function e(t,n,r){var a,o,i,s,u,c,l,d,f,p;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.placeholderEntityAllowLoading){e.next=2;break}return e.abrupt("return");case 2:return Object.defineProperty(n,"$$loading",{value:!0,configurable:!0}),a=void 0,e.prev=4,e.next=7,r.finder(n.id);case 7:e.next=18;break;case 9:if(e.prev=9,e.t0=e.catch(4),e.t0.code!==k.NotFoundError.CODE&&e.t0.code!==k.PermissionDeniedError.CODE){e.next=15;break}a=!0,e.next=18;break;case 15:e.next=18;break;case 18:if(delete n.$$loading,!a){e.next=51;break}if(!(l=(0,w.default)(r.notFoundAttributes))||"function"!=typeof l[b.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+h(l));e.next=23;break;case 23:if(!l||"function"!=typeof l[b.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+y(l));e.next=25;break;case 25:for(i=!(o=!0),s=void 0,e.prev=28,u=(0,m.default)(l);!(o=(c=u.next()).done);o=!0)d=(0,v.default)(c.value,2),f=d[0],p=d[1],(0,T.default)(n,f)&&(n[f]=p);e.next=36;break;case 32:e.prev=32,e.t1=e.catch(28),i=!0,s=e.t1;case 36:e.prev=36,e.prev=37,!o&&u.return&&u.return();case 39:if(e.prev=39,i)throw s;e.next=42;break;case 42:return e.finish(39);case 43:return e.finish(36);case 44:Object.defineProperty(n,"$notFound",{value:!0,configurable:!0}),t.inject(n),r.onNotFound&&r.onNotFound(),r.onLoad&&r.onLoad(null),r.onFinish&&r.onFinish(null),e.next=57;break;case 51:delete n.$placeholder,delete n.$notFound,t.inject(n),r.onSuccess&&r.onSuccess(n),r.onLoad&&r.onLoad(n),r.onFinish&&r.onFinish(n);case 57:case"end":return e.stop()}},e,this,[[4,9],[28,32,36,44],[37,,39,43]])})),function(e,t,n){return o.apply(this,arguments)}),E=(a=(0,d.default)(g.default.mark(function e(t,n,r){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,delete n.$$loadingScheduled,delete I[A(n)],n.$placeholder){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",x(t,n,r));case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])})),function(e,t,n){return a.apply(this,arguments)});t.default=function(a,e){var n=e.finder,r=e.defaultPlaceholderAttrs,o=e.defaultNotFoundAttrs,i=e.placeholderEntityDelayBeforeRefreshing,s=e.placeholderEntityAllowLoading,u=e.shouldEnsure;if(null==e||void 0!==e.finder&&null!=e.finder&&"function"!=typeof e.finder||!(void 0===e.defaultPlaceholderAttrs||null==e.defaultPlaceholderAttrs||e.defaultPlaceholderAttrs instanceof Object)||!(void 0===e.defaultNotFoundAttrs||null==e.defaultNotFoundAttrs||e.defaultNotFoundAttrs instanceof Object)||void 0!==e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"function"!=typeof e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"number"!=typeof e.placeholderEntityDelayBeforeRefreshing||void 0!==e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"function"!=typeof e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"boolean"!=typeof e.placeholderEntityAllowLoading||void 0!==e.shouldEnsure&&null!=e.shouldEnsure&&"function"!=typeof e.shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder?: ?Function;\n  defaultPlaceholderAttrs?: ?Object;\n  defaultNotFoundAttrs?: ?Object;\n  placeholderEntityDelayBeforeRefreshing?: ?Function | ?number;\n  placeholderEntityAllowLoading?: ?Function | ?boolean;\n  shouldEnsure?: ?Function;\n}\n\nGot:\n"+y(e));if(null==e||void 0!==e.finder&&null!=e.finder&&"function"!=typeof e.finder||!(void 0===e.defaultPlaceholderAttrs||null==e.defaultPlaceholderAttrs||e.defaultPlaceholderAttrs instanceof Object)||!(void 0===e.defaultNotFoundAttrs||null==e.defaultNotFoundAttrs||e.defaultNotFoundAttrs instanceof Object)||void 0!==e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"function"!=typeof e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"number"!=typeof e.placeholderEntityDelayBeforeRefreshing||void 0!==e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"function"!=typeof e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"boolean"!=typeof e.placeholderEntityAllowLoading||void 0!==e.shouldEnsure&&null!=e.shouldEnsure&&"function"!=typeof e.shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder?: ?Function;\n  defaultPlaceholderAttrs?: ?Object;\n  defaultNotFoundAttrs?: ?Object;\n  placeholderEntityDelayBeforeRefreshing?: ?Function | ?number;\n  placeholderEntityAllowLoading?: ?Function | ?boolean;\n  shouldEnsure?: ?Function;\n}\n\nGot:\n"+h(e));a.ensureEntity=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return"function"==typeof i&&(i=i()),"function"==typeof s&&(s=s()),function(e,t,n,r){var a=3<arguments.length&&void 0!==r?r:{},o=e.get(t);if(o)o.$placeholder?o.$$loading||o.$notFound||a.onlyPlaceholder||c(e,o,a):(a.onExists&&a.onExists(o),a.onFinish&&a.onFinish(o));else{if(n=(0,p.default)((0,f.default)({},e.idAttribute,t),n),a.onMissing&&a.onMissing(),o=e.createInstance(n),Object.defineProperty(o,"$placeholder",{value:!0,configurable:!0}),e.inject(o),a.onlyPlaceholder)return o;c(e,o,a)}}(a,e,(0,p.default)({},r,t.attrs),(0,p.default)({finder:n,notFoundAttributes:o,placeholderEntityDelayBeforeRefreshing:i,placeholderEntityAllowLoading:s},t))},a.waitForEnsuredEntity=function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new l.default(function(e,t){a.ensureEntity(n,(0,p.default)({},r,{onFinish:e}))})},a.shouldEnsure=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof e&&(e=a.get(e)),!e||!(!u||!u(e,t,n))||!(!e.$placeholder||e.$$loading||t)}},t.dispose=function(){(0,_.default)(I).map(function(e){return clearTimeout(e)}),I={}};var k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),T=r(n(81)),I={},A=function(e){return e.$entityType+":"+e.id}},function(e,t){e.exports=require("babel-runtime/core-js/object/values")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/omit")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MESSAGE_STATUS_ORDER=t.MessageRecipientStatus=void 0;var r,a,o=n(31),i=(a=o)&&a.__esModule?a:{default:a},s=new(n(21).ServerValueEnum)({NA:{key:"NA"},NEW:{serverValue:"New"},DELIVERED:{serverValue:"Delivered"},READ:{serverValue:"Read"},ACKNOWLEDGED:{serverValue:"Confirmed"}},{defaultValue:"NA"}),u=(r={},(0,i.default)(r,s.NA,0),(0,i.default)(r,s.NEW,1),(0,i.default)(r,s.DELIVERED,2),(0,i.default)(r,s.READ,3),(0,i.default)(r,s.ACKNOWLEDGED,4),r);t.MessageRecipientStatus=s,t.MESSAGE_STATUS_ORDER=u,t.default=s},function(e,t){"use strict";function n(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||57344<=r?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}function r(e){for(var t=new Uint8Array(e),n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getUtf8Bytes=n,t.doubleEncodeUtf8=function(e){return r(n(e))},t.arrayBufferToBinaryString=r,t.base64ToArrayBuffer=function(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++){var o=t.charCodeAt(a);r[a]=o}return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["ONLINE","OFFLINE","CONNECTING","UNREACHABLE"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),l=(r=a)&&r.__esModule?r:{default:r};t.formatDob=function(e){if(!e)return e;var t=e.split("T"),n=(0,l.default)(t,1)[0];if(n.includes("-")){var r=n.split("-"),a=(0,l.default)(r,3),o=a[0];return[a[1],a[2],o].join("/")}if(n.includes("/")){var i=n.split("/"),s=(0,l.default)(i,3);return[s[0],s[1],s[2]].join("/")}return e},t.secondsToDurationFormat=function(e){if(!e||!parseInt(e))return"";var t=parseInt(e),n=Math.floor(t/d),r=t%d,a=new Date(0);a.setSeconds(r);var o=a.toISOString().substr(11,8).split(":").map(function(e){return parseInt(e)}),i=(0,l.default)(o,3),s=i[0],u=i[1],c=i[2]+" sec";return(u||s||n)&&(c=u+" min "+c),(s||n)&&(c=s+24*n+" hr "+c),c};var d=86400},function(e,t){e.exports=require("lodash/difference")},function(e,t){e.exports=require("lodash/pick")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.PROFILE_ATTRIBUTES_PER_ORG=void 0;var i=r(n(3)),s=r(n(4)),u=r(n(5)),l=r(n(38)),_=r(n(29)),x=r(n(19)),E=r(n(12)),k=r(n(13)),T=r(n(22)),d=r(n(16)),I=r(n(92)),f=r(n(46));t.default=function(e,t){var c=t.host,n=e.defineModel("user",{replaceKeys:{avatar:"avatarUrl",blockedPersonal:"contactsMessagingBlockedByOrganizationIds",organizationKey:"organizationId",organizationToken:"organizationId",timeToLive:"messagesTTL"},defaultValues:{botRole:null,contactsMessagingBlockedByOrganizationIds:[],isPatient:!1,isPatientContact:!1,organizationIds:[],presence:a.default.UNKNOWN,profileByOrganizationId:{},removedFromOrg:!1,roles:[]},skipCamelizationForKeys:["metadata"],parseAttrs:function(e){var t=e.organizationId;if(e.dndAutoForwardReceivers?e.autoForwardReceiverIds=e.dndAutoForwardReceivers.map(function(e){return e.token}):""===e.dndAutoForwardReceiver||"undefined"===e.dndAutoForwardReceiver?e.autoForwardReceiverIds=[]:void 0!==e.dndAutoForwardReceiver&&(e.autoForwardReceiverIds=[e.dndAutoForwardReceiver]),delete e.dndAutoForwardReceiver,delete e.dndAutoForwardReceivers,t){delete e.organizationId,e.organizationIds||(e.organizationIds=[]),e.organizationIds.includes(t)||e.organizationIds.push(t);var n=(0,d.default)({},(0,f.default)(e,y),{userId:e.id,organizationId:t});delete e.autoForwardReceiverIds,delete e.conversationId,e.profileByOrganizationId||(e.profileByOrganizationId={}),e.profileByOrganizationId[t]=n}if("patientId"in e&&!e.patientId.startsWith("patient:")){var r="patient:"+e.patientId,a=e.patientId;e.isPatient=!e.isPatientContact,e.patientId=r,e.patientBroadcastListDetails={addedByDisplayName:e.addedByDisplayName,addedOn:e.addedOn};var o={id:r,dob:e.patientDob,gender:e.patientGender,mrn:e.patientMrn};if(e.isPatient)o.userId=e.id;else if(e.isPatientContact){var i="patientContact:"+e.id;e.patientContactId=i,c.models.User.injectPlaceholder({id:a,displayName:e.patientDisplayName,patientId:r}),c.models.PatientContact.injectPlaceholder({id:i,relation:e.relationName,userId:e.id,patientId:r}),o.userId=a}c.models.Patient.injectPlaceholder(o),delete e.addedByDisplayName,delete e.addedOn,delete e.patientDisplayName,delete e.patientDob,delete e.patientGender,delete e.patientMrn,delete e.relationName}if("metadata"in e){if("feature_service"in e.metadata&&"patient_messaging"===e.metadata.feature_service){var s=e.metadata,u=s.is_patient_contact;"string"==typeof u&&"true"===u||"boolean"==typeof u&&u?(e.patientContactId="patientContact:"+e.id,e.isPatientContact=!0,c.users._injectPatientContactEntity(e,t)):(e.patientId="patient:"+e.id,e.isPatient=!0,c.users._injectPatientEntity(s,e.id,t))}"feature_service"in e.metadata&&"role"===e.metadata.feature_service&&t&&c.roles.__injectRoleFromMetadata({metadata:(0,d.default)({},e.metadata,{display_name:e.display_name,token:e.id}),organizationId:t}),delete e.metadata}return e.avatarUrl&&(e.avatarUrl=(0,h.cloudFrontUrlTransform)(e.avatarUrl,c.config)),!e.displayName&&e.name&&(e.displayName=e.name),e.displayName&&(0,p.isPhone)(e.displayName)&&(e.displayName=(0,p.formatPhone)(e.displayName)),e},beforeInject:function(e,t){if(t&&(e.organizationIds&&(e.organizationIds=(0,I.default)(t.organizationIds,e.organizationIds)),e.profileByOrganizationId)){var n={};if(t.profileByOrganizationId){if(!(u=(0,T.default)(t.profileByOrganizationId))||"function"!=typeof u[k.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries to be iterable, got "+b(u));if(!u||"function"!=typeof u[k.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries to be iterable, got "+w(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,E.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=(0,x.default)(i.value,2),l=c[0],d=c[1];n[l]={},(0,_.default)(n[l],d)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}if(!(v=(0,T.default)(e.profileByOrganizationId))||"function"!=typeof v[k.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+b(v));if(!v||"function"!=typeof v[k.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+w(v));var f=!0,p=!1,h=void 0;try{for(var y,g=(0,E.default)(v);!(f=(y=g.next()).done);f=!0){var v,m=(0,x.default)(y.value,2);l=m[0],d=m[1];n[l]||(n[l]={}),(0,_.default)(n[l],d)}}catch(e){p=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw h}}e.profileByOrganizationId=n}},afterAssignment:function(e){var t=e.profileByOrganizationId;if(e.contactsMessagingBlocked=0<e.contactsMessagingBlockedByOrganizationIds.length,e.isRoleBot=e.metadata.some(function(e){return"role"===e.data.feature_service}),e.shouldDisplay=!e.metadata.some(function(e){return"true"===e.data.invisible}),!(s=(0,l.default)(t))||"function"!=typeof s[k.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$values to be iterable, got "+b(s));if(!s||"function"!=typeof s[k.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$values to be iterable, got "+w(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,E.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;e.dnd||(u.autoForwardReceiverIds=[]),c.users._setMembersOnEntity(u,"autoForwardReceiverIds","autoForwardReceivers")}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}e.removedFromOrg&&(!e.displayName||e.$$loading||e.$$loadingScheduled||e.$notFound)&&(e.displayName="Removed User")},relations:{belongsTo:{patient:{type:"patient",foreignKey:"patientId"},patientContact:{type:"patientContact",foreignKey:"patientContactId"}},hasMany:{metadata:{type:"metadata",foreignKey:"entityId"}}}});return(0,o.default)(n,{finder:function(){var e;return(e=c.users).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return c.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return c.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<User Not Found>"}}),n};var p=n(28),a=r(n(70)),h=n(73),o=r(n(37)),y=t.PROFILE_ATTRIBUTES_PER_ORG=["autoForwardReceiverIds","conversationId","department","title"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["ACTIVATED_TEAM","ESCALATION","FORUM","GROUP","INTRA_TEAM","PATIENT_CARE","PATIENT_MESSAGING","ROLE_ASSIGNMENT","ROLE_P2P"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({CONVERSATION_MESSAGE_STATUS:{serverValue:"conversation_message_status"},GROUP_REPLAY:{serverValue:"group_replay"},MESSAGE_REPLAY:{serverValue:"message_replay"},OFFLINE:{serverValue:"offline"},ORGANIZATION_MESSAGE_STATUS:{serverValue:"organization_message_status"},ORGANIZATION_REPLAY:{serverValue:"organization_replay"},ROLE_OPT_IN:{serverValue:"optin"},ROLE_OPT_OUT:{serverValue:"optout"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=n(1),o=(r=a)&&r.__esModule?r:{default:r};t.default=function e(t){(0,o.default)(this,e),this.type=t,this.target=void 0},e.exports=t.default},function(e,t,u){"use strict";function n(e){var t=e.provideDefault,n=void 0!==t&&t;return function(e){var t=e.fileBuffer,n=e.filename,r=u(85)(t),a=n&&u(63).extname(n),o=a&&(0,c.getMimeEntryByExtension)(a);if(r){var i=r.ext,s=r.mime;return{ext:i="."+i,mime:s}}return o?o[0]:{ext:a||d,mime:l}}((0,o.default)(e,["provideDefault"]))||(n?{ext:d,mime:l}:void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MIME_EXTENSION=t.DEFAULT_MIME_CONTENT_TYPE=void 0;var r,a=u(34),o=(r=a)&&r.__esModule?r:{default:r};t.getMimeType=n;var c=u(80),l=t.DEFAULT_MIME_CONTENT_TYPE="application/octet-stream",d=t.DEFAULT_MIME_EXTENSION=".bin";t.default=n},function(e,t,u){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){var r=new FileReader,a=new Blob([t],{type:n});r.fileName=e,r.onload=function(e){window.open(r.result,"_blank")},r.readAsDataURL(a)}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadFile=void 0;var r,a=n(u(18)),l=n(u(10)),o=n(u(9));t.downloadFile=(r=(0,o.default)(l.default.mark(function e(t){var n,r,a,o=t.attachmentContentType,i=t.blob,s=t.fileName;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=13;break;case 5:n=e.sent,r=(0,d.base64ToArrayBuffer)(n),c(s,r,o),e.next=11;break;case 10:a=u(244),(0,a.saveAs)(i,s);case 11:e.next=14;break;case 13:f.TargetNotSupportedError.raise();case 14:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),t.loadLocalFilePathWithFileReader=function(r){return new a.default(function(e,t){var n=new FileReader;n.addEventListener("load",function(){e(n.result)},!1),n.addEventListener("error",function(e){t(e)},!1),n.readAsDataURL(r)})},t.saveByteArray=c;var d=u(42),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u(17))},function(e,t){e.exports=require("babel-runtime/core-js/symbol")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("lodash-bound/flatten")},function(e,t){e.exports=require("lodash-bound/map")},function(e,t){e.exports=require("lodash/chunk")},function(e,t){e.exports=require("lodash/defaultsDeep")},function(e,t){e.exports=require("lodash/transform")},function(e,t){e.exports=require("lodash/uniq")},function(e,t){e.exports=require("lodash/values")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("uuid")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="UpM28mnfW65vJkbqEATtKvxm",r={CONSUMER_ORGANIZATION_ID:n,BASE_URLS:{local:"http://localhost:8888",productionOauth:"http://52.41.133.15:8000/tigertextapi"},ADMIN_URLS:{},CN_URLS:{},FORGOT_PASSWORD_URLS:{},ROLES_URLS:{},CLOUDFRONT:{development:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},production:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},tt:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},ihis:{avatar:"",groupAvatar:""}},CONFIG_DEFAULT:{adminFeatureBranch:null,apiEnv:"production",assetDomain:"assets.tigerconnect.com",autoAckSuccessfullyHandledEvents:!0,autoSignOutOnBrowserUnload:!0,baseUrl:null,botUsers:[],clearTypingStatusThrottleDelay:2e3,clearTypingStatusTimeout:8e3,cloudfrontDomain:"cloudfront.net",cloudfront:{},condensedReplays:!1,consumerOrganizationId:n,detectBangReplayTimeout:1e3,events:{autoAck:!1,autoDeliver:!1,canConfirm:!0,closeAfterMessages:!1,heartbeat:!0,hidden:!1,includeDistributionListEvents:!0,isTyping:!0,keepAlive:!1,msgDeliveryDelay:0,multiOrg:!0,noOfflineMessages:!1,renderMetadata:!0},eventCollectionInterval:50,eventDrainTimeout:4e3,eventsAutoReconnect:!0,eventsAutoReconnectDelay:2e3,eventsAutoReconnectMaxDelay:16e3,eventsClearRetryHistoryInterval:6e4,eventsDebugging:!1,eventsHeartbeatIntervalVisible:12e3,eventsHeartbeatIntervalInvisible:3e4,eventsOpenTimeout:6e3,flushAckInterval:1e3,flushAckMaxConnections:2,flushAckMaxEvents:50,flushFindRecipientStatusInterval:150,flushFindRecipientStatusMaxCount:20,flushSetMessageStatusInterval:1e3,flushSetMessageStatusMaxCount:500,keepConversationsForAllForums:!1,localAdminUrl:null,localCnUrl:null,localRolesUrl:null,logLevel:"error",manuallyRequestEventQueueBatch:!1,maxEventBatch:50,maxMetadataKeyCount:11,organizationRostersChangeThrottleDelay:500,placeholderEntityAllowLoading:!0,placeholderEntityDelayBeforeRefreshing:100,processingEvents:!1,productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",pushAgent:"consumer",serviceLogLevels:{},signUpHashKey:"21d2ff3ffbf",signUpHashSalt:"%(xx*&x$&*%&",ttRoute:null,version:"1.0",wantCondensedReplays:!0}};["stag","uat"].forEach(function(e){r.BASE_URLS[e]="https://"+e+"-devapi.tigertext.me",r.FORGOT_PASSWORD_URLS[e]="https://"+e+"-forget.tigertext.com",r.CN_URLS[e]="https://"+e+"-console.tigertext.me",r.ADMIN_URLS[e]="https://"+e+"-console.tigertext.me/app/admin",r.ROLES_URLS[e]="/"+e+"/app/roles/index.html"}),["ihis","prod","prod-a","prod-c","production","tt"].forEach(function(e){r.BASE_URLS[e]="https://api.tigertext.me",r.FORGOT_PASSWORD_URLS[e]="https://forget.tigertext.com",r.CN_URLS[e]="https://home.tigertext.com",r.ADMIN_URLS[e]="https://home.tigertext.com/app/admin",r.ROLES_URLS[e]="/app/roles/index.html"}),["prod-a","prod-c"].forEach(function(e){var t=e.replace("prod-","");r.BASE_URLS[e]="https://"+t+"-api.tigertext.me"}),["ihis"].forEach(function(e){r.CN_URLS[e]="https://"+e+".tigertext.com",r.ADMIN_URLS[e]="https://"+e+".tigertext.com/app/admin"}),t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="validation",o);function f(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"invalid",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e+" is "+t;(0,u.default)(this,f);var r=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,n));return r.code=f.CODE,r.name=e,r.reason=t,r}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function T(e,t){return t in e?e[t].value:null}Object.defineProperty(t,"__esModule",{value:!0}),t.CONTACTS_ORG_ID=void 0,t.default=function(e,t){var k=t.host,n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{allowMsgForward:"__isForwardAllowed",allowPublicGroups:"forumsEnabled",allowRoleScheduleUpload:"__isRolesScheduleUploadEnabled",desktopPriorityMessaging:"__desktopPriorityMessagingSounds",eula:"eulaEnabled",eulaContent:"eulaUrl",featurePatientCare:"__canShowPatientCare",featurePatientNetwork:"__canShowPatientNetwork",featureRoleScheduleUpload:"__canUploadRolesSchedule",featureRoleService:"rolesEnabled",featureRolesEscalation:"__canEscalateMessages",featureTeams:"__canShowTeams",featureTransactions:"canShowTransactions",latestIncomingMessageSortNumber:"lastIncomingMessageSortNumber",members:"memberCount",organizationKey:"organizationId",patientCare:"__showPatientCare",patientNetwork:"__showPatientNetwork",pfNoAttachment:"__isPFAttachmentAllowed",pfNoPhoto:"__isPFPhotoAllowed",roleService:"canAdminRoles",rolesEscalation:"__isRolesEscalationEnabled",ssoWebSessionDuration:"desktopExtendedSession",teams:"__showTeams"},defaultValues:{__canEscalateMessages:!1,__canShowPatientCare:!1,__canShowTeams:!1,__canUploadRolesSchedule:!1,__isForwardAllowed:!1,__isPFAttachmentAllowed:!1,__isPFPhotoAllowed:!1,__isRolesEscalationEnabled:!1,__isRolesScheduleUploadEnabled:!1,__showPatientCare:!1,__showTeams:!1,canAdminRoles:!1,canShowTransactions:!1,desktopExtendedSession:-1,forumsEnabled:!1,highestSortNumber:0,isPatientNetworkEnabled:!1,lastIncomingMessageSortNumber:0,networks:null,paid:!1,rolesEnabled:!1,settings:{},unreadCount:0,unreadPriorityCount:0},transientAttrs:["unreadCount","unreadPriorityCount"],parseAttrs:function(e){var t;e.settings&&(e.settings=(t=(t=e.settings,a.default).call(t,function(e){return i.default.camelizeKey(e.name)}),o.default).call(t,function(e){isFinite(e.value)&&(e.value=+e.value),"true"===e.value&&(e.value=!0),"false"===e.value&&(e.value=!1)}));return e},afterAssignment:function(e){var t=e.__canEscalateMessages,n=e.__canShowPatientCare,r=e.__canShowPatientNetwork,a=e.__canShowTeams,o=e.__canUploadRolesSchedule,i=e.__desktopPriorityMessagingSounds,s=e.__isForwardAllowed,u=e.__isPFAttachmentAllowed,c=e.__isPFPhotoAllowed,l=e.__isRolesEscalationEnabled,d=e.__isRolesScheduleUploadEnabled,f=e.__showPatientCare,p=e.__showPatientNetwork,h=e.__showTeams,y=e.autoForwardReceiverId,g=e.id,v=e.name,m=e.paid,b=e.settings;h=h&&!!T(b,"teams"),p="individual"===p?!!T(b,"patientNetwork"):!!p,y=T(b,"dndAutoForwardReceiver"),e.allowPriorityMessage=!!T(b,"priorityMessaging"),e.autoLogoutMinutes=T(b,"autologoutTime")||1440,e.canUploadRolesSchedule=o&&d,e.deleteOnRead=!!T(b,"dor"),e.desktopAutoUpdate=!!T(b,"autoUpdate"),e.isEulaAccepted=!T(b,"eula"),e.isForwardAllowed=s&&1===T(b,"forward"),e.messageTimeToLive=T(b,"ttl")||-1,e.isPatientBroadcastEnabled=!!T(b,"pfBroadcast"),e.isPatientScheduledMessagesEnabled=!!T(b,"pfScheduleMessages"),e.isPFVideoCallEnabled=!!T(b,"pfVideoCall"),e.isPFVoiceCallEnabled=!!T(b,"pfVoiceCall"),e.isPFGroupVideoCallEnabled=!!T(b,"pfGroupVideoCall"),e.isPFGroupVoiceCallEnabled=!!T(b,"pfGroupVoiceCall"),e.isPFAttachmentAllowed=!u,e.isPFPhotoAllowed=!c;var w=e.id===I;if(e.allowedSenders=k.organizations._getAllowedSenders(e),e.autoForwardReceiverId=y,e.autoForwardReceiver=y?k.models.User.get(y):null,e.canEscalateMessages=t&&l,e.desktopPriorityMessagingSounds=m&&i,e.displayName=w?"Contacts":v,e.isContacts=w,e.showPatientCare=n&&f,e.isPatientNetworkEnabled=r&&p,k.currentUser&&(k.currentUser.isPatient||k.currentUser.isPatientContact)&&r&&(e.isPatientNetworkEnabled="off"!==p),e.showTeams=a&&h,e.userRoles=k.userRoles.getByOrganizationId(g),e.networks||(e.networks={}),e.networks.provider||(e.networks.provider={unreadCount:0,unreadPriorityCount:0}),e.networks.patient||(e.networks.patient={dnd:!1,dndText:"",unreadCount:0,unreadPriorityCount:0}),e.network){var _=e.network.patient,x=_.dnd,E=_.dndText;e.networks.patient.dnd=x,e.networks.patient.dndText=null!==E?E:"",delete e.network}},methods:{getSettingValue:function(e){return T(this.settings,e)},getSettingEntry:function(e){return this.settings&&e in this.settings?this.settings[e]:null}},relations:{hasMany:{__expirableMessages:{type:"message",foreignKey:"__organizationId",filter:function(e){return!!e.expiresAt},sortBy:[["expiresAt","asc"],["id","asc"]]},__expirableMutes:{type:"mute",foreignKey:"organizationId",filter:function(e){return!!e.expiresAt},sortBy:[["expiresAt","asc"],["id","asc"]]},__markingAsReadConversations:{type:"conversation",foreignKey:"organizationId",filter:function(e){return!!e._markingAsRead},sortBy:[["_markingAsReadExpiration","asc"],["id","asc"]]},conversations:{type:"conversation",foreignKey:"organizationId",filter:function(e){var t=e.counterParty;return!!t&&t.groupType!==s.GroupType.ROLE_ASSIGNMENT},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"],["id","asc"]]},messageTemplates:{type:"messageTemplate",foreignKey:"organizationId",sortBy:[["title","asc"]]},roles:{type:"role",foreignKey:"organizationId"},roleTags:{type:"roleTag",foreignKey:"organizationId"}}}});return(0,u.default)(n,{finder:function(){var e;return(e=k.organizations).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return k.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return k.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Organization..."},defaultNotFoundAttrs:{displayName:"<Organization Not Found>"}}),n};var a=r(n(251)),o=r(n(248)),i=r(n(27)),s=n(26),u=r(n(37)),I=t.CONTACTS_ORG_ID="UpM28mnfW65vJkbqEATtKvxm"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({ACKNOWLEDGED:{serverValue:"confirmed"},CANCELLED:{serverValue:"cancelled"},IN_PROGRESS:{serverValue:"in_progress"},NO_RESPONSE:{serverValue:"no_response"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["PATIENT","PROVIDER"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["GLOBAL","GROUP","ORGANIZATION"],{valueFn:function(e){return e.toLowerCase()}});t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["VISIBLE","HIDDEN","PRERENDER"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cloudFrontUrlTransform=void 0;var s=r(n(260)),u=r(n(39));t.cloudFrontUrlTransform=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!n||(0,u.default)(e.cloudfront))return n;var t=e.cloudfront,r=(0,s.default)(t,function(e,t){return-1!==n.indexOf(t)}),a=t[r]?r+"."+e.cloudfrontDomain:"",o=t[r]?e.assetDomain+"/"+t[r]:"",i=a&&o?n.replace(a,o):n;return i.replace("http://","https://")}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={WAITING:-1,CONNECTING:0,OPEN:1,CLOSED:2},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function g(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=g(t[0],n);return t.every(function(e){return g(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return g(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+g(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function v(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=v(t[0],n);return t.every(function(e){return v(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return v(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+v(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i,s=r(n(4)),m=r(n(10)),b=r(n(3)),w=r(n(5)),_=r(n(12)),x=r(n(13)),u=r(n(9)),c=r(n(1)),l=r(n(2)),d=n(283),f=n(42),p=r(n(76)),h=["application/json","text/plain"],y=((0,l.default)(E,[{key:"appendField",value:(i=(0,u.default)(m.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(y)){e.next=43;break}if(n=0,!y||"function"!=typeof y[x.default]&&!Array.isArray(y))throw new TypeError("Expected fieldValue to be iterable, got "+g(y));e.next=4;break;case 4:if(!y||"function"!=typeof y[x.default]&&!Array.isArray(y))throw new TypeError("Expected fieldValue to be iterable, got "+v(y));e.next=6;break;case 6:a=!(r=!0),o=void 0,e.prev=9,i=(0,_.default)(y);case 11:if(r=(s=i.next()).done){e.next=27;break}if(u=s.value,"data"!==t||"object"!==(void 0===u?"undefined":(0,w.default)(u))){e.next=22;break}if(c=u.mimetype,l=void 0===c?"application/json":c,d=u.namespace,f=u.payload,p=void 0===f?"":f,d){e.next=17;break}throw new Error("Missing namespace on data["+n+"] object");case 17:h={"TT-X-Namespace":d},this._appendParsedField(t,{fieldValue:String(p),mimetype:l,filename:null,headers:h}),e.next=23;break;case 22:this.appendField(t,u);case 23:n++;case 24:r=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(9),a=!0,o=e.t0;case 33:e.prev=33,e.prev=34,!r&&i.return&&i.return();case 36:if(e.prev=36,a)throw o;e.next=39;break;case 39:return e.finish(36);case 40:return e.finish(33);case 41:e.next=45;break;case 43:y&&y.nodeType&&y.nodeName&&y.getAttribute&&(y=y.value),"object"===(void 0===y?"undefined":(0,w.default)(y))?this._appendParsedField(t,{fieldValue:(0,b.default)(y),mimetype:"application/json"}):this._appendParsedField(t,{fieldValue:String(y),mimetype:"text/plain"});case 45:case"end":return e.stop()}},e,this,[[9,29,33,41],[34,,36,40]])})),function(e){return i.apply(this,arguments)})},{key:"_appendParsedField",value:function(e,t){var n=t.fieldValue,r=t.filename,a=t.headers,o=t.mimetype,i=this.body.fields;r?r=(0,f.doubleEncodeUtf8)(r):n=(0,f.doubleEncodeUtf8)(n),h.includes(o)&&(o+='; charset="utf-8"');var s=new d.RequestField(n,o,r,a);i.hasOwnProperty(e)?(Array.isArray(i[e])||(i[e]=[i[e]]),i[e].push(s)):i[e]=s}},{key:"appendFile",value:(o=(0,u.default)(m.default.mark(function e(t,n){var r;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r="",n)return e.next=4,(0,p.default)(n,{idx:this.fileIdx++});e.next=5;break;case 4:r=e.sent;case 5:this._appendParsedField(t,r);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getContentType",value:function(){return this.body.getContentType()}},{key:"getPayload",value:(a=(0,u.default)(m.default.mark(function e(){return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.body.toString());case 4:e.next=7;break;case 7:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})}]),E);function E(){(0,c.default)(this,E),this.body=new d.RequestBody,this.fileIdx=0,this.body.setType("multipart")}t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(i,e){var s=this,u=(1<arguments.length&&void 0!==e?e:{}).idx,c=n(54),l=n(63),d=void 0,f=void 0,p=void 0;return void 0!==u&&(u="-"+u),h.default.resolve().then((0,g.default)(y.default.mark(function e(){var t,n,r,a,o;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof i)return e.next=3,new h.default(function(n,r){c.readFile(i,function(e,t){e?r(e):n(t)})});e.next=9;break;case 3:d=e.sent,f=l.basename(i),t=(0,v.getMimeType)({fileBuffer:d,filename:f,provideDefault:!0}),n=t.mime,p=n,e.next=17;break;case 9:if(!(i instanceof Buffer)){e.next=16;break}d=i,r=(0,v.getMimeType)({fileBuffer:d,provideDefault:!0}),a=r.ext,o=r.mime,f="attachment"+u+a,p=o,e.next=17;break;case 16:throw new Error("Unsupported file attachment type");case 17:return e.abrupt("return",{fieldValue:d.toString("binary"),mimetype:p,filename:f});case 18:case"end":return e.stop()}},e,s)})))}Object.defineProperty(t,"__esModule",{value:!0});var o,h=r((r((r((r((r((r(n(3)),n(4))),n(5))),n(12))),n(13))),n(18))),y=r(n(10)),g=r(n(9)),i=(o=(0,g.default)(y.default.mark(function e(t,n){var r;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="",e.next=4,a(t,n);case 4:r=e.sent,e.next=11;break;case 7:e.next=11;break;case 10:r=e.sent;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)}),v=n(51);n(42),t.default=i,e.exports=t.default},function(e,t,n){},function(e,t,n){"use strict";!function(){try{var e=n(245).request().constructor.prototype;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(e){}}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function m(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,s.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=m(t[0],n);return t.every(function(e){return m(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return m(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+m(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,s.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i=r(n(3)),s=r(n(5)),u=r(n(30)),c=r(n(4)),l=r(n(16)),w=r(n(19)),_=r(n(22)),x=r(n(12)),E=r(n(13)),h=r(n(10)),y=r(n(9)),g=r(n(6)),v=r(n(1)),d=r(n(2)),k=r(n(8)),f=r(n(7)),p=r(n(90)),T=r(n(72)),I=r(n(138)),A=r(n(65)),O=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),j=r(n(43)),S=n(23),M=r(n(15)),R=["message:is_typing","presence","remote_wipe","sse:heartbeat"],z=["message:is_typing","presence","sse:heartbeat"],C=["00000000-0000-0000-0000-000000000001"],P=["remote_wipe"],V={autoDeliver:"auto-deliver",canConfirm:"can-confirm",closeAfterMessages:"close-after-messages",heartbeat:"heartbeat_5",hidden:"hidden",includeDistributionListEvents:"dl_sender_event",isTyping:"is-typing",keepAlive:"keep_alive_15_1",msgDeliveryDelay:"msg_delivery_delay",multiOrg:"multi-org",noOfflineMessages:"no-offline-messages",renderMetadata:"render_metadata",singleConversation:"single_conversation"},G={events:{allowManualRequestBatch:!0,basicAuthParam:"auth_basic",features:null,requiresBasicAuth:!1,routerName:"eventRouter",url:"/events"},simpleNotifications:{allowManualRequestBatch:!1,basicAuthParam:"auth",features:{heartbeat:!0},requiresBasicAuth:!0,routerName:"notificationRouter",url:"/events/simple_notifications"}},N=(a=M.default,(0,f.default)(U,a),(0,d.default)(U,[{key:"mounted",value:function(){this._throttled_flushQueuedAcks=(0,p.default)(this._flushQueuedAcks,this.config.flushAckInterval,{leading:!1}),this.__allEvents=[],this._connectionRetryCount=0,this._eventQueue=[],this._eventQueueDeferred=!1,this._eventQueueIsManual=!1,this._eventQueueTimeout=null,this._heartbeatInterval=this.config.eventsHeartbeatIntervalVisible,this._heartbeatTimeout=null,this._lastHeartbeatTime=null,this._openTimeout=null,this._pendingAckConnections=0,this._processedEventIds={},this._queuedAcks=[],this._reconnectWhenQueuesAreEmpty=!1,this._reconnectWhenQueuesAreEmpty=!1,this._retryHistoryTimeout=null,this._visibilityState=T.default.VISIBLE,this.isConnected=!1,this.isOpen=!1}},{key:"dispose",value:function(){this._throttled_flushQueuedAcks.cancel&&this._throttled_flushQueuedAcks.cancel(),this.disconnect({source:"EventsService cleanup"})}},{key:"setAuth",value:function(e){this._auth=(0,l.default)({basicAuthParam:this.basicAuthParam},e)}},{key:"removeAuth",value:function(){this._auth=null}},{key:"getAuth",value:function(){return this._auth}},{key:"connect",value:function(){var o=this;if(!this.isSignedIn)throw this._cancelSessionTimers({source:"Connection attempt while not signed in"}),new O.NotSignedInError;if(this.requiresBasicAuth&&(!this._auth.key||!this._auth.secret))throw this._cancelSessionTimers({source:"Connection attempt without valid authorization"}),new O.RequiresBasicAuthError;if(this.eventSource)throw new Error("Already connected to EventSource");var e=[];if(!(s=(0,_.default)(this.features||this.config.events))||"function"!=typeof s[E.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$entries2 to be iterable, got "+m(s));if(!s||"function"!=typeof s[E.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$entries2 to be iterable, got "+b(s));var t=!0,n=!1,r=void 0;try{for(var a,i=(0,x.default)(s);!(t=(a=i.next()).done);t=!0){var s,u=(0,w.default)(a.value,2),c=u[0],l=u[1];if(l||0===l){var d=V[c],f=!0===l?d:d+":"+l;e.push(f)}}}catch(o){n=!0,r=o}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}var p=e.join(",");this.logger.info("connecting "+this.endpointType+". networkStatus="+this.httpClient.networkStatus+" features="+p);var h=!this._watchingNetworkConnection;if(this.httpClient.networkStatus!==j.default.OFFLINE&&h&&this.httpClient._setNetworkStatus(j.default.CONNECTING),this._watchNetworkConnection(),this.httpClient.networkStatus===j.default.OFFLINE)throw new Error("Cannot connect while network is offline, but will autoconnect when online");this._isClosed=!1,this._isHeartbeatTimeout=!1,this._reconnectWhenQueuesAreEmpty=!1,this._requestedClose=!1;var y=void 0,g=!1,v=!1;this._openTimeout=setTimeout(function(){o._openTimeout=null,v=!0,y.close()},this.config.eventsOpenTimeout),this.eventSource=y=this.host.eventSourceClient.createEventSource(this.url,{auth:this._auth,features:p,onOpen:function(){o.logger.info("open"),o._cancelSessionTimers({source:"Event source opened"}),o._setHeartbeatTimeout(),g=!0,o.isOpen=!0,o.emit("opened")},onMessage:function(e,t){var n=t.isFirstMessage;o._setHeartbeatTimeout(),n&&(o._setRetryHistoryTimeout(),o.isConnected=!0,o.emit("connected")),o._queueEvent(e)},onError:function(e){var t=!!e&&o.httpClient.isUnauthorizedError(e),n=o._isHeartbeatTimeout,r=o.httpClient.networkStatus,a=o._requestedClose;n?e=new Error("No activity within "+o._heartbeatInterval+" milliseconds; reconnecting"):v&&(e=new Error("Open timed out after "+o.config.eventsOpenTimeout+" milliseconds; reconnecting")),o.logger.info("error",e,e.message||"",e.code||"",void 0!==e.status?e.status:""),o.__allEvents.push({clientDisconnect:{error:{code:e.code,message:e.message,status:e.status},hasConnected:g,isHeartbeatTimeout:n,isUnauthorized:t,networkStatus:r,openTimedOut:v,requestedClose:a,timestamp:new Date}}),a||(t?o.disconnect({isRecoverable:!1,source:"Unauthorized during eventSource error handling"}):r!==j.default.OFFLINE&&(g||0!==o._connectionRetryCount||(o._connectionRetryCount=1),o._disconnectAndRetry()))}}),this.eventSource.start()}},{key:"_scheduleConnectRetry",value:function(){var e=this;this._cancelSessionTimers({source:"Scheduling connection retry"}),this.logger.info("scheduleConnectRetry",this._connectionRetryCount);var t=Math.min(this.config.eventsAutoReconnectDelay*this._connectionRetryCount,this.config.eventsAutoReconnectMaxDelay);this._scheduleConnectRetryTimeout=setTimeout(function(){return e.connect()},t),this._connectionRetryCount++}},{key:"_watchNetworkConnection",value:function(){this._watchingNetworkConnection||(this._watchingNetworkConnection=!0,this.host.on("networkStatus:change",this.onNetworkStatusChanged))}},{key:"_unwatchNetworkConnection",value:function(){this._watchingNetworkConnection&&(this.host.removeListener("networkStatus:change",this.onNetworkStatusChanged),this._watchingNetworkConnection=!1)}},{key:"_cancelSessionTimers",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).source;this._heartbeatTimeout&&(clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=null),this._openTimeout&&(clearTimeout(this._openTimeout),this._openTimeout=null),this._scheduleConnectRetryTimeout&&(this.__allEvents.push({cancelSessionTimer:{source:e,timestamp:new Date}}),clearTimeout(this._scheduleConnectRetryTimeout),this._scheduleConnectRetryTimeout=null),null!==this._eventQueueTimeout&&(clearTimeout(this._eventQueueTimeout),this._eventQueueTimeout=null)}},{key:"_setHeartbeatTimeout",value:function(e){var t=this;this._heartbeatTimeout&&clearTimeout(this._heartbeatTimeout),void 0!==e&&(this._heartbeatInterval=e),this._heartbeatTimeout=setTimeout(function(){t._heartbeatTimeout=null,t._isHeartbeatTimeout=!0,0===t._connectionRetryCount&&(t._connectionRetryCount=1),t._disconnectAndRetry()},this._heartbeatInterval)}},{key:"_cancelRetryHistoryTimeout",value:function(){this._retryHistoryTimeout&&(clearTimeout(this._retryHistoryTimeout),this._retryHistoryTimeout=null)}},{key:"_setRetryHistoryTimeout",value:function(){var e=this;this._retryHistoryTimeout&&clearTimeout(this._retryHistoryTimeout),this._retryHistoryTimeout=setTimeout(function(){e._retryHistoryTimeout=null,e._connectionRetryCount=0},this.config.eventsClearRetryHistoryInterval)}},{key:"reconnect",value:function(){this._connectionRetryCount=0,this.disconnect({unwatchNetwork:!1,source:"Reconnect"}),this.connect()}},{key:"_disconnectAndRetry",value:function(){var e=this;this.__allEvents.push({eventsDisconnectAndRetry:{eventQueueLength:this._eventQueue.length,pendingAckConnections:this._pendingAckConnections,queuedAcksLength:this._queuedAcks.length,connectionRetryCount:this._connectionRetryCount,timestamp:new Date}}),this.disconnect({clearQueues:!1,unwatchNetwork:!1,source:"Disconnect and retry"}),this.config.eventsAutoReconnect&&(this._reconnectWhenQueuesAreEmpty=!0),this.config.eventsAutoReconnect&&0===this._eventQueue.length&&0===this._pendingAckConnections&&0===this._queuedAcks.length?this._scheduleConnectRetry():this.config.eventsAutoReconnect&&(this._scheduleConnectRetryTimeout=setTimeout(function(){return e.connect()},this.config.eventDrainTimeout)),0<this._eventQueue.length&&this._scheduleEventQueue({immediate:!0}),(0<this._pendingAckConnections||0<this._queuedAcks.length)&&this._flushQueuedAcks()}},{key:"disconnect",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.clearQueues,n=void 0===t||t,r=e.isRecoverable,a=void 0===r||r,o=e.unwatchNetwork,i=void 0===o||o,s=e.source;if(this.__allEvents.push({eventsDisconnect:{clearQueues:n,source:s,unwatchNetwork:i}}),this._cancelSessionTimers({source:"Disconnect"}),this._cancelRetryHistoryTimeout(),i&&this._unwatchNetworkConnection(),this.eventSource){var u=this.eventSource;this.eventSource=null,this._requestedClose=!0,this._isClosed||(this._isClosed=!0,u.close()),this.emit("disconnected",{isRecoverable:a})}this.isConnected=!1,this.isOpen=!1,n&&(this._eventQueue=[],this._queuedAcks=[])}},{key:"_queueEvent",value:function(e){var t=e.data;if(t){if(P.some(function(e){return t.includes(e)})){var n=void 0;try{n=JSON.parse(t)}catch(e){return this.logger.error("error parsing SSE payload: <"+t+">"),void this._disconnectAndRetry()}var r=(0,c.default)(n.event)[0].replace("tigertext:iq:","");if(P.includes(r)){this.disconnect({source:"Immediate event "+r});var a=n.event_id;return void this._processImmediateEvent(a,t)}}this._eventQueue.push(t),this._scheduleEventQueue()}}},{key:"_handleEvent",value:function(e){var t=e.event_id;if(this._autoAck||!this._processedEventIds[t]||C.includes(t)){var n=(0,c.default)(e.event)[0],r=n.replace("tigertext:iq:",""),a=e.event[n];!this.config.eventsDebugging&&z.includes(r)||this.__allEvents.push(e),"sse:heartbeat"===r&&(this._lastHeartbeatTime=Date.now()),this.logger.debug("incoming",r,a);var o=new I.default(t,r,a);try{this.router.emit(o),this.emit("event",o),this._autoAck?R.includes(r)||this.__queueAck(t):this._processedEventIds[t]=!0}catch(e){this.logger.error("error in event "+r,e,e.stack,{data:a}),this.disconnect({isRecoverable:!1,source:"Error in event "+r})}}}},{key:"__queueAck",value:function(e){var t;e=(0,S.arrayWrap)(e),(t=this._queuedAcks).push.apply(t,(0,u.default)(e)),this._throttled_flushQueuedAcks()}},{key:"ack",value:(o=(0,y.default)(h.default.mark(function e(t){var n;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),n=!1,t=(0,S.arrayWrap)(t),this.logger.log("ack",t),this._pendingAckConnections++,e.prev=5,e.next=8,this.host.api.events.ack(t);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(5),n=this.httpClient.isUnauthorizedError(e.t0),this.logger.warn("some events not acked",t);case 14:this._pendingAckConnections--,n&&(this.logger.warn("no longer authorized, terminating session"),this.disconnect({isRecoverable:!1,source:"Unauthorized during ack"}));case 16:case"end":return e.stop()}},e,this,[[5,10]])})),function(e){return o.apply(this,arguments)})},{key:"_autoAck",get:function(){return"events"===this.endpointType&&this.config.autoAckSuccessfullyHandledEvents}},{key:"hasConnection",get:function(){return!!this.eventSource}},{key:"isSignedIn",get:function(){return!!this._auth}},{key:"router",get:function(){return this.host[this.routerName]}},{key:"url",get:function(){var e=G[this.endpointType].url;return"/"+("events"===this.endpointType&&this.config.condensedReplays?"v5":"v2")+e}}]),U);function U(e,t){var a=this;(0,v.default)(this,U);var n,l=(0,k.default)(this,(U.__proto__||(0,g.default)(U)).call(this,e,t));if(l.onNetworkStatusChanged=function(e){var t=e.networkStatus,n=e.previousStatus;if(l.__allEvents.push({networkStatusChange:{previousStatus:n,networkStatus:t,timestamp:new Date}}),t===j.default.CONNECTING){if(l._reconnectIfHeartbeatIntervalPassed()&&l.eventSource)return;l._connectionRetryCount=1,l._disconnectAndRetry()}else t===j.default.OFFLINE&&(l._connectionRetryCount=0,l.disconnect({unwatchNetwork:!1,source:"Network went offline"}))},l._closeAllConnections=(0,y.default)(h.default.mark(function e(){var t,n,r;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.eventSource)throw new Error("Existing connections must be closed first");e.next=2;break;case 2:if("simpleNotifications"!==l.endpointType){e.next=10;break}if(t=l._auth,n=t.key,r=t.secret,n&&r){e.next=6;break}throw new O.RequiresBasicAuthError;case 6:return e.next=8,l.host.api.notifications.closeAllConnections(n,r);case 8:e.next=12;break;case 10:return e.next=12,l.host.api.events.closeAllConnections();case 12:case"end":return e.stop()}},e,a)})),l._processImmediateEvent=(n=(0,y.default)(h.default.mark(function e(t,n){return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l._eventQueue=[n],l._eventQueueDeferred=!1,l._autoAck)return e.next=5,l.ack([t]);e.next=5;break;case 5:l.processEventQueue();case 6:case"end":return e.stop()}},e,a)})),function(e,t){return n.apply(this,arguments)}),l._scheduleEventQueue=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).immediate,t=void 0!==e&&e;if(l.allowManualRequestBatch&&l.config.manuallyRequestEventQueueBatch&&(l._eventQueueIsManual=!0),t&&(clearTimeout(l._eventQueueTimeout),l._eventQueueTimeout=null),null===l._eventQueueTimeout){var n=l.config.eventCollectionInterval;if(t||null===n)l._eventQueueIsManual?l._emitBatch({immediate:t}):l.processEventQueue(l._eventQueue.length);else{var r=l._eventQueueIsManual?l._emitBatch:l.processEventQueue;l._eventQueueTimeout=setTimeout(r,n)}}},l._emitBatch=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).immediate,t=void 0!==e&&e;l._eventQueueTimeout=null,l.emit("batch:available",{maxEventBatch:l._eventQueue.length,immediate:t})},l.deferEventQueue=function(){l._eventQueueDeferred=!0,l._eventQueueTimeout&&(clearTimeout(l._eventQueueTimeout),l._eventQueueTimeout=null)},l.resumeEventQueue=function(){l._eventQueueDeferred=!1,l._eventQueueTimeout&&(clearTimeout(l._eventQueueTimeout),l._eventQueueTimeout=null),0<l._eventQueue.length&&l._scheduleEventQueue()},l.processEventQueue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l.config.maxEventBatch;if(l._eventQueueIsManual||(l._eventQueueTimeout=null),!l._eventQueueDeferred&&0!==l._eventQueue.length){var t=void 0,n=void 0,r=void 0;try{var a=l._eventQueue.splice(0,e);if(!a||"function"!=typeof a[E.default]&&!Array.isArray(a))throw new TypeError("Expected lines to be iterable, got "+m(a));if(!a||"function"!=typeof a[E.default]&&!Array.isArray(a))throw new TypeError("Expected lines to be iterable, got "+b(a));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,x.default)(a);!(o=(u=c.next()).done);o=!0)t=u.value,n=!1,r=JSON.parse(t),n=!0,l._handleEvent(r)}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}0<l._eventQueue.length?l._scheduleEventQueue():l._reconnectWhenQueuesAreEmpty&&0===l._queuedAcks.length&&0===l._pendingAckConnections&&l._scheduleConnectRetry()}catch(e){n?(l.logger.error("error while processing SSE payload",e,e.stack,{data:r}),l.disconnect({isRecoverable:!1,source:"Error processing SSE payload"})):(l.logger.error("error parsing SSE payload: <"+t+">"),l._disconnectAndRetry())}}},l._flushQueuedAcks=(0,y.default)(h.default.mark(function e(){var t,n;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===l._queuedAcks.length)return e.abrupt("return");e.next=2;break;case 2:if(l._pendingAckConnections>=l.config.flushAckMaxConnections)return l._throttled_flushQueuedAcks(),e.abrupt("return");e.next=5;break;case 5:if(t=l._queuedAcks.splice(0,l.config.flushAckMaxEvents),n=l.ack(t),!(0<l._queuedAcks.length)){e.next=11;break}l._throttled_flushQueuedAcks(),e.next=19;break;case 11:return e.prev=11,e.next=14,n;case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:l._reconnectWhenQueuesAreEmpty&&0===l._eventQueue.length&&0===l._pendingAckConnections&&l._scheduleConnectRetry();case 19:case"end":return e.stop()}},e,a,[[11,16]])})),l._onVisibilityChange=function(e,t){t=t.toUpperCase();var n=l._visibilityState;l._visibilityState=t,l.isConnected&&(l.__allEvents.push({visibilityChange:{previousState:n,state:t,timestamp:new Date}}),t===T.default.HIDDEN?(l.host.configure({eventCollectionInterval:null}),l._setHeartbeatTimeout(l.config.eventsHeartbeatIntervalInvisible)):t===T.default.VISIBLE&&(l.host.configure({eventCollectionInterval:A.default.eventCollectionInterval}),l._setHeartbeatTimeout(l.config.eventsHeartbeatIntervalVisible))),n===T.default.HIDDEN&&t===T.default.VISIBLE&&l.httpClient.networkStatus===j.default.CONNECTING&&l._reconnectIfHeartbeatIntervalPassed(),l.emit("visibilityChange",e,t)},l._reconnectIfHeartbeatIntervalPassed=function(){return null!==l._lastHeartbeatTime&&(Date.now()-l._lastHeartbeatTime>=l._heartbeatInterval&&(l._lastHeartbeatTime=null,l.reconnect(),!0))},l.endpointType||(l.endpointType="events"),!(c=(0,_.default)(G[l.endpointType]))||"function"!=typeof c[E.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+m(c));if(!c||"function"!=typeof c[E.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+b(c));var r=!0,o=!1,i=void 0;try{for(var s,u=(0,x.default)(c);!(r=(s=u.next()).done);r=!0){var c,d=(0,w.default)(s.value,2),f=d[0],p=d[1];"url"!==f&&(l[f]=p)}}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return l}t.default=N,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.allExtensions=t.allContentTypes=void 0;var a=r(n(12)),s=r(n(3)),u=r(n(5)),c=r(n(4)),o=r(n(13));t.getMimeEntryByContentType=function(e){return l[e]},t.getMimeEntryByExtension=function(e){return e&&"."===e[0]&&(e=e.slice(1)),d[e]};var i=[{ext:"csv",mime:"text/csv"},{ext:"csv",mime:"text/plain"},{ext:"doc",mime:"application/msword"},{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{ext:"gif",mime:"image/gif"},{ext:"gz",mime:"application/gzip"},{ext:"gz",mime:"application/x-gzip"},{ext:"gz",mime:"application/x-compressed"},{ext:"jpg",mime:"image/jpeg"},{ext:"jpeg",mime:"image/jpeg"},{ext:"m4a",mime:"audio/m4a"},{ext:"m4a",mime:"audio/x-m4a"},{ext:"m4a",mime:"audio/mp4"},{ext:"m4v",mime:"video/x-m4v"},{ext:"mov",mime:"video/quicktime"},{ext:"mp3",mime:"audio/mpeg"},{ext:"mp3",mime:"audio/mp3"},{ext:"mp3",mime:"audio/mpeg3"},{ext:"mp3",mime:"audio/x-mpeg"},{ext:"mp3",mime:"audio/x-mpeg-3"},{ext:"mp3",mime:"video/mpeg"},{ext:"mp3",mime:"video/x-mpeg"},{ext:"mp4",mime:"video/mp4"},{ext:"pdf",mime:"application/pdf"},{ext:"png",mime:"image/png"},{ext:"ppsx",mime:"application/vnd.openxmlformats-officedocument.presentationml.slideshow"},{ext:"ppt",mime:"application/vnd.ms-powerpoint"},{ext:"ppt",mime:"application/ms-powerpoint"},{ext:"ppt",mime:"application/mspowerpoint"},{ext:"ppt",mime:"application/powerpoint"},{ext:"ppt",mime:"application/x-mspowerpoint"},{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"},{ext:"svg",mime:"image/svg+xml"},{ext:"txt",mime:"text/plain"},{ext:"wav",mime:"audio/wav"},{ext:"wav",mime:"audio/wave"},{ext:"wav",mime:"audio/x-pn-wav"},{ext:"wav",mime:"audio/x-wav"},{ext:"xls",mime:"application/vnd.ms-excel"},{ext:"xls",mime:"application/excel"},{ext:"xls",mime:"application/x-excel"},{ext:"xls",mime:"application/x-msexcel"},{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{ext:"zip",mime:"application/zip"}],l={},d={};if("function"!=typeof i[o.default]&&!Array.isArray(i))throw new TypeError("Expected supportedMimeEntries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,u.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,s.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(i));if("function"!=typeof i[o.default]&&!Array.isArray(i))throw new TypeError("Expected supportedMimeEntries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,u.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,s.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(i));var f=!0,p=!1,h=void 0;try{for(var y,g=(0,a.default)(i);!(f=(y=g.next()).done);f=!0){var v=y.value,m=v.ext,b=v.mime;l[b]||(l[b]=[]),l[b].push(v),d[m]||(d[m]=[]),d[m].push(v)}}catch(e){p=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw h}}t.allContentTypes=(0,c.default)(l),t.allExtensions=(0,c.default)(d)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(11),o=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t){var n=(0,o.default)(e,t);return n&&n.configurable},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(3),o=(r=a)&&r.__esModule?r:{default:r};t.default=function(e){return void 0!==e?JSON.parse((0,o.default)(e)):null},e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t){e.exports=require("btoa")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("jshashes")},function(e,t){e.exports=require("lodash-bound/omitBy")},function(e,t){e.exports=require("lodash-bound/values")},function(e,t){e.exports=require("lodash-bound/without")},function(e,t){e.exports=require("lodash.throttle")},function(e,t){e.exports=require("lodash/each")},function(e,t){e.exports=require("lodash/union")},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function M(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=M(t[0],n);return t.every(function(e){return M(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return M(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,G.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+M(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function R(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=R(t[0],n);return t.every(function(e){return R(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return R(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,G.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+R(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.TigerConnectClient=void 0;var o,i,s,u,c,l,d,f,p=a(n(3)),h=a(n(5)),v=a(n(18)),y=a(n(10)),g=a(n(9)),z=a(n(19)),C=a(n(12)),P=a(n(13)),V=a(n(22)),G=a(n(4)),N=a(n(16)),U=a(n(29)),F=a(n(1)),m=a(n(2)),$=a(n(276)),D=a(n(274)),q=a(n(58)),b=a(n(33)),w=a(n(246)),L=a(n(285)),_=a(n(64)),B=r(n(123)),K=r(n(17)),Z=a(n(65)),H=a(n(95)),W=r(n(26)),x=a(n(49)),X=a(n(169)),Q=a(n(183)),Y=a(n(43)),J=r(n(210)),ee=a(n(212)),te=n(23),ne=a(n(222)),E=t.TigerConnectClient=((0,m.default)(re,[{key:"_listenToEvents",value:function(){var r=this;this.on("signedIn",function(e,t){r.logger.info("signedIn",e.id)}),this.on("signedOut",function(e){e.resetClient&&r.reset()}),this.on("signUp",function(e){var t=e.user,n=e.auth;r.logger.info("signUp",t.id),r._setCurrentUser(t),r._setAuth(n)}),this.events.on("event",function(e){r.emit("event",e),"bang"===e.type&&r._resetLastBang()}),this.events.on("batch:available",function(e){return r.emit("events:batch:available",e)}),this.events.on("connected",function(){return r.emit("events:connected")}),this.events.on("disconnected",this._onDisconnected),this.events.on("processing:start",function(e){return r.emit("processing:start",e)}),this.events.on("processing:stop",function(e){return r.emit("processing:stop",e)}),this.events.on("visibilityChange",function(e,t){return r.emit("visibilityChange",e,t)}),this.calls.on("answered",function(e){return r.emit("call:answered",e)}),this.calls.on("ended",function(e){return r.emit("call:ended",e)}),this.calls.on("incoming",function(e){return r.emit("call:incoming",e)}),this.calls.on("state",function(e){return r.emit("call:state",e)}),this.conversations.on("clearTimeline",function(e){return r.emit("conversation:clearTimeline",e)}),this.conversations.on("clearMessageStatuses",function(e){return r.emit("conversation:clearMessageStatuses",e)}),this.conversations.on("message",function(e){return r.emit("message",e)}),this.conversations.on("friends",function(e){return r.emit("friends",e)}),this.eventSourceClient.on("auth:invalid",function(){return r.emit("auth:invalid")}),this.groups.on("membership:change",function(e){return r.emit("group:membership:change",e)}),this.httpClient.on("networkStatus:change",function(e){return r.emit("networkStatus:change",e)}),this.notifications.on("connected",function(){return r.emit("notifications:connected")}),this.notifications.on("disconnected",function(e){return r.emit("notifications:disconnected")}),this.notifications.on("signingIn",function(){return r.emit("notifications:signingIn")}),this.notifications.on("signedIn",function(e){return r.emit("notifications:signedIn",e)}),this.notifications.on("signingOut",function(e){return r.emit("notifications:signingOut",e)}),this.notifications.on("signedOut",function(e){return r.emit("notifications:signedOut",e)}),this.notifications.on("event",function(e){return r.emit("notifications:event",e)}),this.notifications.on("message",function(e){return r.emit("notification:message",e)}),this.notifications.on("unread:change",function(e){return r.emit("notification:unread:change",e)}),this.organizations.on("preferences:change",function(e){return r.emit("organization:preferences:change",e)}),this.presence.on("change",function(e){return r.emit("presence:change",e)}),this.roles.on("change",function(e){return r.emit("role:change",e)}),this.typingStatus.on("change",function(e){return r.emit("typing:change",e)}),this.users.on("preferences:change",function(e){return r.emit("user:preferences:change",e)}),"undefined"!=typeof window&&window.addEventListener("unload",this._onBrowserUnload)}},{key:"_startTicker",value:function(){this.__ticker=setTimeout(this._onTick,5e3),this.__tickerFrame=null}},{key:"_stopTicker",value:function(){null!==this.__ticker&&(clearTimeout(this.__ticker),this.__ticker=null),null!==this.__tickerFrame&&(L.default.cancel(this.__tickerFrame),this.__tickerFrame=null)}},{key:"signIn",value:(f=(0,g.default)(y.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.udid,a=void 0===r?(0,_.default)():r,o=l.refreshUser,i=void 0===o||o,this.emit("signingIn"),e.next=4,this.users.signIn(t,n,{udid:a});case 4:if(s=e.sent,u=s.auth,c=s.user,this._setCurrentUser(c),this._setAuth(u),i)return e.next=12,this.users.findMe({bypassCache:!0});e.next=12;break;case 12:return this.emit("signedIn",c,u),e.abrupt("return",{auth:u,user:c});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"signInWithApiKeyAndSecret",value:(d=(0,g.default)(y.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.udid,a=void 0===r?(0,_.default)():r,o=l.refreshUser,i=void 0===o||o,this.emit("signingIn"),e.next=4,this.users.signInWithApiKeyAndSecret(t,n,{udid:a});case 4:if(s=e.sent,u=s.auth,c=s.user,this._setCurrentUser(c),this._setAuth(u),i)return e.next=12,this.users.findMe({bypassCache:!0});e.next=12;break;case 12:return this.emit("signedIn",c,u),e.abrupt("return",{auth:u,user:c});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"signInWithMagicToken",value:(l=(0,g.default)(y.default.mark(function e(t){var n,r,a,o,i,s,u,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.udid,r=void 0===n?(0,_.default)():n,a=c.refreshUser,o=void 0===a||a,this.emit("signingIn"),e.next=4,this.users.signInWithMagicToken(t,{udid:r});case 4:if(i=e.sent,s=i.auth,u=i.user,this._setCurrentUser(u),this._setAuth(s),o)return e.next=12,this.users.findMe({bypassCache:!0});e.next=12;break;case 12:return this.emit("signedIn",u,s),e.abrupt("return",{auth:s,user:u});case 14:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"signOut",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.async,n=void 0===t||t,r=e.fromServer,a=void 0!==r&&r,o=e.resetClient,i=void 0===o||o;if(!this.isSignedIn)return v.default.resolve(!1);if(!n&&"undefined"==typeof XMLHttpRequest)throw new Error("`async: false` option cannot be set unless using signOut() in a browser");if(this.events.disconnect({source:"On sign out"}),n)return this.users.signOut({fromServer:a,resetClient:i});this.emit("signingOut",{fromServer:a,resetClient:i});var s=new XMLHttpRequest;if(s.open("POST",this.config.baseUrl+"/v2/logout",!1),!(p=(0,V.default)(this.httpClient.getAuthHeaders()))||"function"!=typeof p[P.default]&&!Array.isArray(p))throw new TypeError("Expected _Object$entries3 to be iterable, got "+M(p));if(!p||"function"!=typeof p[P.default]&&!Array.isArray(p))throw new TypeError("Expected _Object$entries3 to be iterable, got "+R(p));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,C.default)(p);!(u=(d=f.next()).done);u=!0){var p,h=(0,z.default)(d.value,2),y=h[0],g=h[1];s.setRequestHeader(y,g)}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}return s.send(null),this.emit("signedOut",{fromServer:a,resetClient:i,signedOut:!0}),v.default.resolve(!0)}},{key:"signOutAllDevices",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).async,t=void 0===e||e;if(!this.isSignedIn)return v.default.resolve();if(!t&&"undefined"==typeof XMLHttpRequest)throw new Error("`async: false` option cannot be set unless using signOutAllDevices() in a browser");if(t)return this.users.signOutAllDevices();var n=new XMLHttpRequest;if(n.open("POST",this.config.baseUrl+"/v2/wipe?token="+this.currentUserId,!1),!(u=(0,V.default)(this.httpClient.getAuthHeaders()))||"function"!=typeof u[P.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries4 to be iterable, got "+M(u));if(!u||"function"!=typeof u[P.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries4 to be iterable, got "+R(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,C.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=(0,z.default)(i.value,2),l=c[0],d=c[1];n.setRequestHeader(l,d)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n.send(null),v.default.resolve()}},{key:"authenticate",value:(c=(0,g.default)(y.default.mark(function e(t,n){var r;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+R(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+R(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+M(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+M(n));e.next=8;break;case 8:return e.next=10,this._authenticateWithParams({key:t,secret:n});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"authenticateUsingOauth",value:(u=(0,g.default)(y.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{udid:void 0};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+R(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+M(t));e.next=4;break;case 4:return n=o.udid,r=void 0===n?(0,_.default)():n,e.next=7,this._authenticateWithParams({bearerToken:t,udid:r});case 7:return a=e.sent,e.abrupt("return",a);case 9:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"_authenticateWithParams",value:(s=(0,g.default)(y.default.mark(function e(t){var n;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._setAuth(t),e.prev=1,e.next=4,this.users.findMe();case 4:return n=e.sent,this._setCurrentUser(n),this.emit("signedIn",n,t),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),this._removeAuth(),this._currentUser=null,e.t0;case 15:case"end":return e.stop()}},e,this,[[1,10]])})),function(e){return s.apply(this,arguments)})},{key:"_setCurrentUser",value:function(e){this._currentUser=e}},{key:"_setAuth",value:function(e){this._auth=e,this.httpClient.setAuth(e),this.events.setAuth(e)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth(),this.events.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"requireUser",value:function(){if(!this.isSignedIn)throw new K.NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.currentlyServingOfflineMessages=!0,this.emit("messages:offline:start",t),this.products._addProcessingEvent({actionType:x.default.MESSAGE_REPLAY,entity:this.products.getAll()[0],itemsEstimate:t.replayMessageCount});break;case"replayStop":null===this._checkBangTimer&&(this.emit("groups:offline:start"),this._startBangTimer()),this.products._removeProcessingEvent({actionType:x.default.MESSAGE_REPLAY,entity:this.products.getAll()[0]})}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"modelNameByTypeNS",value:function(e){var t=this.MODEL_BY_TYPE_NS[e];return t?t.name:((0,w.default)(t,"modelNameByTypeNS: Missing class for "+e),null)}},{key:"modelNameByEntityType",value:function(e){var t=this.modelsByEntityType[e]||this.MODEL_BY_TYPE_NS[e];return t?t.name:void(0,w.default)(t,"modelNameByEntityType: Missing class for "+e)}},{key:"ejectModel",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.MODEL_BY_TYPE_NS[t]||this.modelsByEntityType[t];return n?n.eject(e):void(0,w.default)(n,"ejectModel: Missing class for "+t)}},{key:"injectModel",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.MODEL_BY_TYPE_NS[t]||this.modelsByEntityType[t];return n?n.inject(e):((0,w.default)(n,"injectModel: Missing class for "+t),null)}},{key:"injectPlaceholderModel",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.modelByTypeNS(t)||this.modelsByEntityType[t];return n?n.injectPlaceholder(e):((0,w.default)(n,"injectPlaceholderModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"dispose",value:function(){if(this._stopTicker(),this.conversationsLoaded=!1,null!==this._checkBangTimer&&(clearTimeout(this._checkBangTimer),this._checkBangTimer=null),!(o=this._services)||"function"!=typeof o[P.default]&&!Array.isArray(o))throw new TypeError("Expected _services2 to be iterable, got "+M(o));if(!o||"function"!=typeof o[P.default]&&!Array.isArray(o))throw new TypeError("Expected _services2 to be iterable, got "+R(o));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,C.default)(o);!(e=(r=a.next()).done);e=!0){var o,i=r.value;i.dispose&&i.dispose()}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this.store&&this.store.clear()}},{key:"reset",value:function(){if(this.dispose(),!(o=this._services)||"function"!=typeof o[P.default]&&!Array.isArray(o))throw new TypeError("Expected _services3 to be iterable, got "+M(o));if(!o||"function"!=typeof o[P.default]&&!Array.isArray(o))throw new TypeError("Expected _services3 to be iterable, got "+R(o));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,C.default)(o);!(e=(r=a.next()).done);e=!0){var o,i=r.value;i.mounted&&i.mounted()}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this._startTicker()}},{key:"configure",value:function(e){return(0,U.default)(this.config,e),this.httpClient.mounted(),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"currentUser",get:function(){return this.getCurrentUser()}},{key:"currentUserId",get:function(){var e=this.getCurrentUser();return e?e.id:null}},{key:"isSignedIn",get:function(){return!!this.getAuth()}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:distribution_list":this.models.DistributionList,"tigertext:entity:dist_list_member":this.models.User,"tigertext:entity:list":this.models.DistributionList,"tigertext:entity:message_template":this.models.MessageTemplate,"tigertext:entity:patient_distribution_list":this.models.DistributionList,"tigertext:entity:schedule_message":this.models.ScheduledMessage,"tigertext:entity:tag":this.models.RoleTag,"tigertext:entity:team":this.models.Team,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"networkStatus",get:function(){return this.httpClient.networkStatus}},{key:"forgotPasswordUrl",get:function(){return Z.default.FORGOT_PASSWORD_URLS[this.config.apiEnv]}},{key:"adminUrl",get:function(){return this.config.adminFeatureBranch?"/feature/"+this.config.adminFeatureBranch+"/app/admin":this.config.localAdminUrl?this.config.localAdminUrl:Z.default.ADMIN_URLS[this.config.apiEnv]}},{key:"cnUrl",get:function(){return this.config.localCnUrl?this.config.localCnUrl:Z.default.CN_URLS[this.config.apiEnv]}},{key:"rolesUrl",get:function(){return this.config.localRolesUrl?this.config.localRolesUrl:Z.default.ROLES_URLS[this.config.apiEnv]}}]),i=o=re,o.CONSUMER_ORGANIZATION_ID=Z.default.CONSUMER_ORGANIZATION_ID,o.errors=K,o.VERSION=ne.default,o.version=ne.default,i);function re(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if((0,F.default)(this,re),this.errors=K,this.VERSION=ne.default,this.version=ne.default,this._onBrowserUnload=function(){var r=[];n.emit("browserUnload",function(e,t,n){return r.push({fn:e,priority:t,name:n})}),(0,$.default)(r,["priority"],["desc"]).forEach(function(e){var t=e.fn,n=e.priority,r=e.name;console.log("[unload]",n,r),t()})},this._onDisconnected=function(e){var t=e.isRecoverable;t||n._removeAuth(),n.emit("events:disconnected",{isRecoverable:t})},this._onTick=function(){n.__tickerFrame=(0,L.default)(function(){try{n.emit("tick")}finally{n.__ticker=setTimeout(n._onTick,5e3)}})},this._resetLastBang=function(){n._bangOccurredDuringReplay=!0},this._startBangTimer=function(){n._bangOccurredDuringReplay=!1,n._checkBangTimer=setTimeout(n._didBangOccur,n.config.detectBangReplayTimeout)},this._didBangOccur=function(){n._bangOccurredDuringReplay?n._startBangTimer():(n._checkBangTimer=null,n._bangReplayDone())},this._bangReplayDone=function(){n.currentlyServingOfflineMessages&&(n.currentlyServingOfflineMessages=!1,n.emit("conversations:loading:start"),n.conversations.hasPendingReloads()&&n.conversations.__flushConversationsToReload(),n.emit("groups:offline:stop"),n.emit("messages:offline:stop"),n.emit("conversations:loading:stop"),n.emit("messages:new:start"))},!(null==e||e instanceof Object))throw new TypeError('Value of argument "originalConfig" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+R(e));if(!(null==e||e instanceof Object))throw new TypeError('Value of argument "originalConfig" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+M(e));this.config=(0,U.default)({},e),(0,q.default)(this.config,Z.default.CONFIG_DEFAULT);var t=this.config,r=t.apiEnv,a=t.logLevel;if(this.config.cloudfront=Z.default.CLOUDFRONT[r],/(env\d+|lt\d*)/.test(r)&&(this.config.cloudfront=Z.default.CLOUDFRONT.development,Z.default.BASE_URLS[this.config.apiEnv]="https://"+r+"-devapi.tigertext.xyz",Z.default.FORGOT_PASSWORD_URLS[this.config.apiEnv]="https://"+r+"-forget.tigertext.com",Z.default.CN_URLS[this.config.apiEnv]="https://"+r+"-console.tigertext.xyz",Z.default.ADMIN_URLS[this.config.apiEnv]=Z.default.CN_URLS[r]+"/app/admin",Z.default.ROLES_URLS[this.config.apiEnv]="/"+r+"/app/roles/index.html"),this.config.baseUrl||(this.config.baseUrl=Z.default.BASE_URLS[r]),this.config.autoSignOutOnBrowserUnload=!1,(0,U.default)(this,{attachments:te.attachments,date:te.date,email:te.email,phone:te.phone}),this.httpClient=new Q.default({config:this.config,logger:new H.default({name:"HttpClient",level:a})}),this.eventSourceClient=new X.default({config:this.config,httpClient:this.httpClient,logger:new H.default({name:"EventSourceClient",level:a})}),this.enums=(0,N.default)({},W,{NetworkStatus:Y.default}),this.store=new ee.default(this,{logger:new H.default({name:"Store",level:a})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=(0,D.default)(this.store.models,function(e,t){return te.Camelizer.camelizeKey(t)}),this.modelsByEntityType.account=this.modelsByEntityType.user,this.modelsByEntityType.list=this.modelsByEntityType.distributionList,this.allModelEntityTypes=(0,G.default)(this.modelsByEntityType),this.logger=new H.default({name:"TigerConnectClient",level:a}),this.api={},!(l=(0,V.default)(B))||"function"!=typeof l[P.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+M(l));if(!l||"function"!=typeof l[P.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+R(l));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,C.default)(l);!(o=(u=c.next()).done);o=!0){var l,d=(0,z.default)(u.value,2),f=d[0],p=d[1],h=te.Camelizer.camelizeKey(f);this.api[h]=new p(this,{logger:new H.default({name:f+"API",level:a})})}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}if(this._services=[],!(w=(0,V.default)(J))||"function"!=typeof w[P.default]&&!Array.isArray(w))throw new TypeError("Expected _Object$entries2 to be iterable, got "+M(w));if(!w||"function"!=typeof w[P.default]&&!Array.isArray(w))throw new TypeError("Expected _Object$entries2 to be iterable, got "+R(w));var y=!0,g=!1,v=void 0;try{for(var m,b=(0,C.default)(w);!(y=(m=b.next()).done);y=!0){var w,_=(0,z.default)(m.value,2),x=(f=_[0],p=_[1],te.Camelizer.camelizeKey(f)),E=new p(this,{logger:new H.default({name:f+"Service",level:this.config.serviceLogLevels[x]||a})});this[x]=E,this._services.push(E)}}catch(e){g=!0,v=e}finally{try{!y&&b.return&&b.return()}finally{if(g)throw v}}if(!(j=this._services)||"function"!=typeof j[P.default]&&!Array.isArray(j))throw new TypeError("Expected _services to be iterable, got "+M(j));if(!j||"function"!=typeof j[P.default]&&!Array.isArray(j))throw new TypeError("Expected _services to be iterable, got "+R(j));var k=!0,T=!1,I=void 0;try{for(var A,O=(0,C.default)(j);!(k=(A=O.next()).done);k=!0){var j,S=A.value;S.mounted&&S.mounted()}}catch(e){T=!0,I=e}finally{try{!k&&O.return&&O.return()}finally{if(T)throw I}}this._listenToEvents(),this._startTicker(),this.on("browserUnload",function(e){return e(function(){n.config.autoSignOutOnBrowserUnload&&(n.notifications.disconnect({source:"On browser unload"}),n.signOut({async:!1,resetClient:!1}))},100,"signOut")}),this._checkBangTimer=null,this.conversationsLoaded=!1,this.currentlyServingOfflineMessages=!1}(0,U.default)(E.prototype,b.default.prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.LOG_LEVELS=t.default=void 0;var u=r(n(3)),c=r(n(4)),l=r(n(5)),o=r(n(30)),a=r(n(1)),d=((0,r(n(2)).default)(f,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(this.level=e.toLowerCase(),"string"!=typeof this.level)throw new TypeError('Value of "this.level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(this.level))}}]),f);function f(e){var t=e.name,n=e.level;if((0,a.default)(this,f),null==e||"string"!=typeof e.name||"string"!=typeof e.level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+s(e));if(null==e||"string"!=typeof e.name||"string"!=typeof e.level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+i(e));this.name=t,this.level=n}t.default=d;var p=t.LOG_LEVELS=["debug","log","info","warn","error"],h=p.reduce(function(e,t,n){return e[t]=n,e},{});p.forEach(function(r){var a=h[r];d.prototype[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a>=h[this.level]&&(t=["["+this.name+"]"].concat((0,o.default)(t)),Function.prototype.apply.call(console[r],console,t))}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f=r(n(16)),p=r(n(10)),h=r(n(9)),y=r(n(6)),g=r(n(1)),v=r(n(2)),m=r(n(8)),b=r(n(7)),w=r(n(36)),_=r(n(14)),x=r(n(27)),E=(a=_.default,(0,b.default)(k,a),(0,v.default)(k,[{key:"start",value:(d=(0,h.default)(p.default.mark(function e(t){var n,r,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v2/voip_call",{data:x.default.underscoreObject(t),headers:{"TT-X-Organization-Key":t.organizationId}});case 2:return n=e.sent,r=(0,w.default)(n,"data.disabled_participants",{}),(a=x.default.camelizeObject(n.data)).disabledParticipants=r,e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"end",value:(l=(0,h.default)(p.default.mark(function e(t,n,r){var a,o,i,s=r.callId,u=r.payload,c=r.reason;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.default)(u,"disabledParticipants",{}),(o=x.default.underscoreObject({payload:u,reason:c,callId:s})).payload.disabled_participants=a,e.next=5,this.httpClient.post("/v2/voip_call/"+t+"/end",{data:o,headers:{"TT-X-Organization-Key":n}});case 5:return i=e.sent,e.abrupt("return",i.data);case 7:case"end":return e.stop()}},e,this)})),function(e,t,n){return l.apply(this,arguments)})},{key:"decline",value:(c=(0,h.default)(p.default.mark(function e(t,n,r){var a,o,i,s,u=r.callId,c=r.payload;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.default)(c,"disabledParticipants",{}),o="declined",(i=x.default.underscoreObject({payload:(0,f.default)({},c,{reason:o,callId:u}),reason:o,callId:u,type:"call_ended",roomName:t})).payload.disabled_participants=a,e.next=6,this.httpClient.post("/v2/voip_call/"+t+"/end",{data:i,headers:{"TT-X-Organization-Key":n}});case 6:return s=e.sent,e.abrupt("return",s.data);case 8:case"end":return e.stop()}},e,this)})),function(e,t,n){return c.apply(this,arguments)})},{key:"join",value:(u=(0,h.default)(p.default.mark(function e(t,n){var r;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/v2/voip_call/"+t,{headers:{"TT-X-Organization-Key":n}});case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"answer",value:(s=(0,h.default)(p.default.mark(function e(t,n,r){var a,o,i,s,u=r.callId,c=r.payload;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.default)(c,"disabledParticipants",{}),o="answered",(i=x.default.underscoreObject({callId:u,payload:(0,f.default)({},c,{reason:o,callId:u}),reason:o,type:"call_answered",roomName:t})).payload.disabled_participants=a,e.next=6,this.httpClient.post("/v2/voip_call/"+t+"/answer",{data:i,headers:{"TT-X-Organization-Key":n}});case 6:return s=e.sent,e.abrupt("return",s.data);case 8:case"end":return e.stop()}},e,this)})),function(e,t,n){return s.apply(this,arguments)})},{key:"invite",value:(i=(0,h.default)(p.default.mark(function e(t,n,r){var a,o,i=r.callId,s=r.payload,u=r.recipients;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.default)(s,"disabledParticipants",{}),(o=x.default.underscoreObject({callId:i,payload:s,recipients:u})).payload.disabled_participants=a,e.next=5,this.httpClient.post("/v2/voip_call/"+t+"/add_participants",{data:o,headers:{"TT-X-Organization-Key":n}});case 5:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"state",value:(o=(0,h.default)(p.default.mark(function e(t,n,r){var a,o,i=r.callId,s=r.payload;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,w.default)(s,"disabledParticipants",{}),(o=x.default.underscoreObject({callId:i,payload:(0,f.default)({},s,{callId:i})})).payload.disabled_participants=a,e.next=5,this.httpClient.post("/v2/voip_call/"+t+"/state",{data:o,headers:{"TT-X-Organization-Key":n}});case 5:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})}]),k);function k(){return(0,g.default)(this,k),(0,m.default)(this,(k.__proto__||(0,y.default)(k)).apply(this,arguments))}t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u=r(n(3)),c=r(n(4)),f=r(n(5)),p=r(n(10)),h=r(n(9)),y=r(n(6)),g=r(n(1)),v=r(n(2)),m=r(n(8)),b=r(n(7)),w=r(n(14)),_=(a=w.default,(0,b.default)(x,a),(0,v.default)(x,[{key:"find",value:(s=(0,h.default)(p.default.mark(function e(t){var n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=4;break;case 4:return e.next=6,this.httpClient.get("/v5/conversation/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"updateConversationStatus",value:(i=(0,h.default)(p.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=o.highestSortNumber,s=o.lowestSortNumber;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=8;break;case 8:return r={status:n},i&&(r.highest_sort_number=i),s&&(r.lowest_sort_number=s),e.next=13,this.httpClient.post("/v5/conversation/:id/status",{urlParams:{id:t},data:r});case 13:return a=e.sent,e.abrupt("return",a.data);case 15:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"fetchTimeline",value:(o=(0,h.default)(p.default.mark(function e(t,n,r,a){var o,i=a.continuation,s=a.markAsDelivered,u=void 0===s||s,c=arguments;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "anchorPoint" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));e.next=4;break;case 4:if("number"!=typeof r)throw new TypeError('Value of argument "maxItems" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+d(r));e.next=6;break;case 6:if(null==c[3]||!(null==c[3].continuation||c[3].continuation instanceof Object)||null!=c[3].markAsDelivered&&"boolean"!=typeof c[3].markAsDelivered)throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{\n  continuation: ?Object;\n  markAsDelivered: ?boolean;\n}\n\nGot:\n"+d(c[3]));e.next=8;break;case 8:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=10;break;case 10:if("string"!=typeof n)throw new TypeError('Value of argument "anchorPoint" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=12;break;case 12:if("number"!=typeof r)throw new TypeError('Value of argument "maxItems" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+l(r));e.next=14;break;case 14:if(null==c[3]||!(null==c[3].continuation||c[3].continuation instanceof Object)||null!=c[3].markAsDelivered&&"boolean"!=typeof c[3].markAsDelivered)throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{\n  continuation: ?Object;\n  markAsDelivered: ?boolean;\n}\n\nGot:\n"+l(c[3]));e.next=16;break;case 16:return e.next=18,this.httpClient.post("/v5/conversation/:id/timeline",{urlParams:{id:t},data:{anchor_point:n,continuation:i,mark_as_delivered:u,max_items:r}});case 18:return o=e.sent,e.abrupt("return",o.data);case 20:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return o.apply(this,arguments)})}]),x);function x(){return(0,g.default)(this,x),(0,m.default)(this,(x.__proto__||(0,y.default)(x)).apply(this,arguments))}t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,E.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function f(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,E.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=f(t[0],n);return t.every(function(e){return f(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return f(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+f(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,p,h,y,g,v,m,b,w,_=r(n(3)),x=r(n(4)),E=r(n(5)),k=r(n(11)),T=r(n(10)),I=r(n(9)),A=r(n(6)),O=r(n(1)),j=r(n(2)),S=r(n(8)),M=r(n(24)),R=r(n(7)),z=n(14),C=r(z),P=z.VERSIONS.VERSION_TWO,V=z.ROUTES.DISTRIBUTION_LIST_FIND,G=(o=(0,z.recoverFromNotFound)(),i=(0,z.recoverFromNotFound)(),s=(0,z.recoverFromNotFound)(),u=(0,z.recoverFromNotFound)(),c=(0,z.recoverFromNotFound)(),p=C.default,(0,R.default)(N,p),(0,j.default)(N,[{key:"batch",value:(w=(0,I.default)(T.default.mark(function e(t){var n,r=t.ids,a=t.operation,o=t.organizationId,i=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=i[0]&&Array.isArray(i[0].ids)&&i[0].ids.every(function(e){return"string"==typeof e})&&"string"==typeof i[0].operation&&"string"==typeof i[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  ids: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+f(i[0]));case 2:if(null!=i[0]&&Array.isArray(i[0].ids)&&i[0].ids.every(function(e){return"string"==typeof e})&&"string"==typeof i[0].operation&&"string"==typeof i[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  ids: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+d(i[0]));case 4:return n={"TT-X-Organization-Key":o},e.next=7,this.httpClient.patch("/v5/dist_list",{data:{ids:r,operation:a},headers:n});case 7:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"create",value:(b=(0,I.default)(T.default.mark(function e(t){var n,r,a,o=t.adminOnly,i=t.members,s=t.name,u=t.network,c=t.organizationId,l=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=l[0]&&"boolean"==typeof l[0].adminOnly&&Array.isArray(l[0].members)&&l[0].members.every(function(e){return"string"==typeof e})&&"string"==typeof l[0].name&&"string"==typeof l[0].network&&"string"==typeof l[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  adminOnly: boolean;\n  members: string[];\n  name: string;\n  network: string;\n  organizationId: string;\n}\n\nGot:\n"+f(l[0]));case 2:if(null!=l[0]&&"boolean"==typeof l[0].adminOnly&&Array.isArray(l[0].members)&&l[0].members.every(function(e){return"string"==typeof e})&&"string"==typeof l[0].name&&"string"==typeof l[0].network&&"string"==typeof l[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  adminOnly: boolean;\n  members: string[];\n  name: string;\n  network: string;\n  organizationId: string;\n}\n\nGot:\n"+d(l[0]));case 4:return n={"TT-X-Organization-Key":c},e.next=7,this.httpClient.post("/v5/dist_list",{data:{admin_only:o,members:i,name:s,network:u},headers:n});case 7:return r=e.sent,a=r.data,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"delete",value:(m=(0,I.default)(T.default.mark(function e(t,n){var r;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.del("/v5/dist_list/:id",{headers:r,urlParams:{id:t}});case 11:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"find",value:(v=(0,I.default)(T.default.mark(function e(t){var n,r,a,o,i,s,u=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=4;break;case 4:return n=(0,M.default)(N.prototype.__proto__||(0,A.default)(N.prototype),"getVersion",this).call(this,V),r=n.version,a=void 0===r?P:r,o={},u&&(o["TT-X-Organization-Key"]=u),e.next=9,this.httpClient.get("/:version/dist_list/:id",{headers:o,urlParams:{id:t,version:a}});case 9:return i=e.sent,s=i.data,e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"findMemberIds",value:(g=(0,I.default)(T.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).continuation;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));e.next=8;break;case 8:return r=(0,M.default)(N.prototype.__proto__||(0,A.default)(N.prototype),"getVersion",this).call(this,V),a=r.version,o=void 0===a?P:a,i={"TT-X-Organization-Key":n},s="/:version/dist_list/:id/members",l&&(s+="/?continuation=:continuation"),e.next=14,this.httpClient.get(s,{headers:i,urlParams:{continuation:l,id:t,version:o}});case 14:return u=e.sent,c=u.data,e.abrupt("return",c);case 17:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"membersBatch",value:(y=(0,I.default)(T.default.mark(function e(t){var n,r,a,o=t.id,i=t.members,s=t.operation,u=t.organizationId,c=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=c[0]&&"string"==typeof c[0].id&&Array.isArray(c[0].members)&&c[0].members.every(function(e){return"string"==typeof e})&&"string"==typeof c[0].operation&&"string"==typeof c[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  id: string;\n  members: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+f(c[0]));case 2:if(null!=c[0]&&"string"==typeof c[0].id&&Array.isArray(c[0].members)&&c[0].members.every(function(e){return"string"==typeof e})&&"string"==typeof c[0].operation&&"string"==typeof c[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  id: string;\n  members: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+d(c[0]));case 4:return n={"TT-X-Organization-Key":u},e.next=7,this.httpClient.patch("/v5/dist_list/:id/members",{data:{members:i,operation:s},headers:n,urlParams:{id:o}});case 7:return r=e.sent,a=r.data,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"update",value:(h=(0,I.default)(T.default.mark(function e(t){var n,r,a,o=t.adminOnly,i=t.id,s=t.name,u=t.organizationId,c=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==c[0]||void 0!==c[0].adminOnly&&null!=c[0].adminOnly&&"boolean"!=typeof c[0].adminOnly||"string"!=typeof c[0].id||void 0!==c[0].name&&null!=c[0].name&&"string"!=typeof c[0].name||"string"!=typeof c[0].organizationId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  adminOnly?: ?boolean;\n  id: string;\n  name?: ?string;\n  organizationId: string;\n}\n\nGot:\n"+f(c[0]));e.next=2;break;case 2:if(null==c[0]||void 0!==c[0].adminOnly&&null!=c[0].adminOnly&&"boolean"!=typeof c[0].adminOnly||"string"!=typeof c[0].id||void 0!==c[0].name&&null!=c[0].name&&"string"!=typeof c[0].name||"string"!=typeof c[0].organizationId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  adminOnly?: ?boolean;\n  id: string;\n  name?: ?string;\n  organizationId: string;\n}\n\nGot:\n"+d(c[0]));e.next=4;break;case 4:return n={"TT-X-Organization-Key":u},e.next=7,this.httpClient.put("/v5/dist_list/:id",{data:{admin_only:o,name:s},headers:n,urlParams:{id:i}});case 7:return r=e.sent,a=r.data,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})}]),a((l=N).prototype,"delete",[o],(0,k.default)(l.prototype,"delete"),l.prototype),a(l.prototype,"find",[i],(0,k.default)(l.prototype,"find"),l.prototype),a(l.prototype,"findMemberIds",[s],(0,k.default)(l.prototype,"findMemberIds"),l.prototype),a(l.prototype,"membersBatch",[u],(0,k.default)(l.prototype,"membersBatch"),l.prototype),a(l.prototype,"update",[c],(0,k.default)(l.prototype,"update"),l.prototype),l);function N(){return(0,O.default)(this,N),(0,S.default)(this,(N.__proto__||(0,A.default)(N)).apply(this,arguments))}t.default=G,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function f(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=f(t[0],n);return t.every(function(e){return f(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return f(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+f(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function p(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=p(t[0],n);return t.every(function(e){return p(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return p(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+p(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,h,y,g=r(n(3)),v=r(n(4)),m=r(n(5)),b=r(n(11)),w=r(n(10)),_=r(n(9)),x=r(n(6)),E=r(n(1)),k=r(n(2)),T=r(n(8)),I=r(n(24)),A=r(n(7)),O=n(14),j=r(O),S=O.VERSIONS.VERSION_TWO,M=O.ROUTES.ENTITIES_FIND_ALL,R=(a=(0,O.recoverFromNotFound)(),h=j.default,(0,A.default)(z,h),(0,k.default)(z,[{key:"findMulti",value:(y=(0,_.default)(w.default.mark(function e(t){var n,r,a,o,i,s,u=t.users,c=t.metadata,l=t.organizationId,d=arguments;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=d[0]&&Array.isArray(d[0].users)&&d[0].users.every(function(e){return"string"==typeof e})&&Array.isArray(d[0].metadata)&&d[0].metadata.every(function(e){return"string"==typeof e})&&"string"==typeof d[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  users: Array<string>;\n  metadata: Array<string>;\n  organizationId: string;\n}\n\nGot:\n"+p(d[0]));case 2:if(null!=d[0]&&Array.isArray(d[0].users)&&d[0].users.every(function(e){return"string"==typeof e})&&Array.isArray(d[0].metadata)&&d[0].metadata.every(function(e){return"string"==typeof e})&&"string"==typeof d[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  users: Array<string>;\n  metadata: Array<string>;\n  organizationId: string;\n}\n\nGot:\n"+f(d[0]));case 4:return n=(0,I.default)(z.prototype.__proto__||(0,x.default)(z.prototype),"getVersion",this).call(this,M),r=n.version,a=void 0===r?S:r,o={"TT-X-Organization-Key":l},i={render_owner_object:"true"},e.next=9,this.httpClient.post("/:version/entities_bulk",{urlParams:{version:a},data:{users:u,metadata:c},headers:o,query:i});case 9:return s=e.sent,e.abrupt("return",s.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})}]),i=(o=z).prototype,s="findMulti",u=[a],c=(0,b.default)(o.prototype,"findMulti"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function z(){return(0,E.default)(this,z),(0,T.default)(this,(z.__proto__||(0,x.default)(z)).apply(this,arguments))}t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,f,p,h,y,g,v=r(n(3)),m=r(n(4)),b=r(n(5)),w=r(n(11)),_=r(n(10)),x=r(n(9)),E=r(n(6)),k=r(n(1)),T=r(n(2)),I=r(n(8)),A=r(n(24)),O=r(n(7)),j=n(14),S=r(j),M=j.VERSIONS.VERSION_TWO,R=j.ROUTES.ESCALATION,z=(o=(0,j.recoverFromNotFound)(),i=(0,j.recoverFromNotFound)(),s=(0,j.recoverFromNotFound)(),u=(0,j.recoverFromNotFound)(),f=S.default,(0,O.default)(C,f),(0,T.default)(C,[{key:"escalateMessage",value:(g=(0,x.default)(_.default.mark(function e(t){var n,r,a,o;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=4;break;case 4:return n=(0,A.default)(C.prototype.__proto__||(0,E.default)(C.prototype),"getVersion",this).call(this,R),r=n.version,a=void 0===r?M:r,e.next=7,this.httpClient.post("/:version/message/:messageId/escalation",{urlParams:{version:a,messageId:t}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"acknowledge",value:(y=(0,x.default)(_.default.mark(function e(t,n){var r,a,o,i,s=n.messageId,u=n.userTokens,c=arguments;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+d(c[1]));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=6;break;case 6:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+l(c[1]));case 8:return r=(0,A.default)(C.prototype.__proto__||(0,E.default)(C.prototype),"getVersion",this).call(this,R),a=r.version,o=void 0===a?M:a,e.next=11,this.httpClient.post("/:version/message/:messageId/escalation/:escalationId/confirm",{urlParams:{version:o,escalationId:t,messageId:s},data:{confirm_as:u}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"cancel",value:(h=(0,x.default)(_.default.mark(function e(t){var n,r,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=4;break;case 4:return n=(0,A.default)(C.prototype.__proto__||(0,E.default)(C.prototype),"getVersion",this).call(this,R),r=n.version,a=void 0===r?M:r,e.next=7,this.httpClient.del("/:version/message/:messageId/escalation",{urlParams:{version:a,messageId:t}});case 7:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"skip",value:(p=(0,x.default)(_.default.mark(function e(t,n){var r,a,o,i,s=n.messageId,u=n.userTokens,c=arguments;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+d(c[1]));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=6;break;case 6:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+l(c[1]));case 8:return r=(0,A.default)(C.prototype.__proto__||(0,E.default)(C.prototype),"getVersion",this).call(this,R),a=r.version,o=void 0===a?M:a,e.next=11,this.httpClient.post("/:version/message/:messageId/escalation/:escalationId/skip",{urlParams:{version:o,escalationId:t,messageId:s},data:{skip_as:u}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})}]),a((c=C).prototype,"escalateMessage",[o],(0,w.default)(c.prototype,"escalateMessage"),c.prototype),a(c.prototype,"acknowledge",[i],(0,w.default)(c.prototype,"acknowledge"),c.prototype),a(c.prototype,"cancel",[s],(0,w.default)(c.prototype,"cancel"),c.prototype),a(c.prototype,"skip",[u],(0,w.default)(c.prototype,"skip"),c.prototype),c);function C(){return(0,k.default)(this,C),(0,I.default)(this,(C.__proto__||(0,E.default)(C)).apply(this,arguments))}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(10)),u=r(n(9)),c=r(n(6)),l=r(n(1)),d=r(n(2)),f=r(n(8)),p=r(n(24)),h=r(n(7)),y=n(14),g=r(y),v=y.VERSIONS.VERSION_TWO,m=y.ROUTES.EVENTS_ACK,b=y.ROUTES.EVENTS_CLOSE_ALL_CONNECTIONS,w=(a=g.default,(0,h.default)(_,a),(0,d.default)(_,[{key:"ack",value:(i=(0,u.default)(s.default.mark(function e(t){var n,r,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,p.default)(_.prototype.__proto__||(0,c.default)(_.prototype),"getVersion",this).call(this,m),r=n.version,a=void 0===r?v:r,e.next=3,this.httpClient.post("/:version/events/ack",{urlParams:{version:a},data:{events:t}});case 3:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"closeAllConnections",value:(o=(0,u.default)(s.default.mark(function e(){var t,n,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.default)(_.prototype.__proto__||(0,c.default)(_.prototype),"getVersion",this).call(this,b),n=t.version,r=void 0===n?v:n,e.next=3,this.httpClient.del("/:version/events",{urlParams:{version:r}});case 3:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})}]),_);function _(){return(0,l.default)(this,_),(0,f.default)(this,(_.__proto__||(0,c.default)(_)).apply(this,arguments))}t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,c,l,d,f,p,h,y,g,v,m,b=r(n(3)),w=r(n(4)),_=r(n(5)),x=r(n(11)),T=r(n(10)),E=r(n(9)),I=r(n(6)),k=r(n(1)),A=r(n(2)),O=r(n(8)),j=r(n(24)),S=r(n(7)),M=n(14),R=r(M),z=M.VERSIONS.VERSION_FIVE,C=M.VERSIONS.VERSION_TWO,P=M.ROUTES.GROUP_ADD_MEMBERS,V=M.ROUTES.GROUP_CREATE,G=M.ROUTES.GROUP_DESTROY,N=M.ROUTES.GROUP_FIND,U=M.ROUTES.GROUP_UPDATE,F=(o=(0,M.recoverFromNotFound)(),i=(0,M.recoverFromNotFound)(),c=(0,M.recoverFromNotFound)(),d=R.default,(0,S.default)($,d),(0,A.default)($,[{key:"create",value:(m=(0,E.default)(T.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p=t.avatarFile,h=t.description,y=t.excludeCreator,g=t.isPublic,v=void 0!==g&&g,m=t.memberIds,b=void 0===m?[]:m,w=t.metadata,_=t.name,x=t.organizationId,E=t.replayHistory,k=void 0!==E&&E;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,j.default)($.prototype.__proto__||(0,I.default)($.prototype),"getVersion",this).call(this,V),r=n.version,a=void 0===r?C:r,o={},i={is_public:v,members:b.join(","),metadata:w,name:_,replay_history:k},s={},u={exclude_creator:y},p&&(s.avatar=p),h&&(i.description=h),x&&(o["TT-X-Organization-Key"]=x),e.next=10,this.httpClient.post("/:version/group",{urlParams:{version:a},query:u,headers:o,data:i,files:s});case 10:if(c=e.sent,a===z)return e.abrupt("return",c.data);e.next=13;break;case 13:return l=c.getHeader("TT-X-Group-Avatar"),d=c.getHeader("TT-X-Group-Token"),f={avatarUrl:l,id:d,memberIds:b,metadata:w,name:_,organizationId:x},e.abrupt("return",f);case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"update",value:(v=(0,E.default)(T.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=n.name,d=void 0===l?void 0:l,f=n.avatarFile,p=void 0===f?void 0:f,h=n.replayHistory,y=void 0===h?void 0:h,g=n.memberIds;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,j.default)($.prototype.__proto__||(0,I.default)($.prototype),"getVersion",this).call(this,U),a=r.version,o=void 0===a?C:a,i={},s={},void 0!==d&&(i.name=d),void 0!==g&&(i.members=g.join(",")),void 0!==y&&(i.replay_history=y),p&&(s.avatar=p),e.next=9,this.httpClient.post("/:version/group/:id",{urlParams:{id:t,version:o},data:i,files:s});case 9:return u=e.sent,c=u.getHeader("TT-X-Group-Avatar"),e.abrupt("return",{id:t,avatarUrl:c});case 12:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"find",value:(g=(0,E.default)(T.default.mark(function e(t){var n,r,a,o;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return n=(0,j.default)($.prototype.__proto__||(0,I.default)($.prototype),"getVersion",this).call(this,N),r=n.version,a=void 0===r?C:r,e.next=7,this.httpClient.get("/:version/group/:id",{urlParams:{id:t,version:a},query:{render_metadata:"true"}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"findAllMemberIds",value:(y=(0,E.default)(T.default.mark(function e(t){var n;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return e.next=6,this.httpClient.get("/:version/group/:id/members",{urlParams:{id:t,version:C}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"destroy",value:(h=(0,E.default)(T.default.mark(function e(t){var n,r,a;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return n=(0,j.default)($.prototype.__proto__||(0,I.default)($.prototype),"getVersion",this).call(this,G),r=n.version,a=void 0===r?C:r,e.next=7,this.httpClient.del("/:version/group/:id",{urlParams:{id:t,version:a}});case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"addMembers",value:(p=(0,E.default)(T.default.mark(function e(t,n){var r,a,o,i;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+u(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+s(n));case 8:return r=(0,j.default)($.prototype.__proto__||(0,I.default)($.prototype),"getVersion",this).call(this,P),a=r.version,o=void 0===a?C:a,e.next=11,this.httpClient.post("/:version/group/:id/members",{urlParams:{id:t,version:o},data:{members:n}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"removeMembers",value:(f=(0,E.default)(T.default.mark(function e(t,n){return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+u(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+s(n));case 8:return e.next=10,this.httpClient.post("/v2/group/:id/members/remove",{urlParams:{id:t},data:{members:n}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})}]),a((l=$).prototype,"find",[o],(0,x.default)(l.prototype,"find"),l.prototype),a(l.prototype,"findAllMemberIds",[i],(0,x.default)(l.prototype,"findAllMemberIds"),l.prototype),a(l.prototype,"destroy",[c],(0,x.default)(l.prototype,"destroy"),l.prototype),l);function $(){return(0,k.default)(this,$),(0,O.default)(this,($.__proto__||(0,I.default)($)).apply(this,arguments))}t.default=F,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function p(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=p(t[0],n);return t.every(function(e){return p(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return p(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+p(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,y,g,v,m,b=r(n(3)),w=r(n(4)),_=r(n(5)),x=r(n(11)),E=r(n(16)),k=r(n(10)),T=r(n(9)),I=r(n(6)),A=r(n(1)),O=r(n(2)),j=r(n(8)),S=r(n(7)),M=n(14),R=r(M),z=(o=(0,M.recoverFromNotFound)(),i=(0,M.recoverFromNotFound)(),s=(0,M.recoverFromNotFound)(),u=(0,M.recoverFromNotFound)(),l=R.default,(0,S.default)(C,l),(0,O.default)(C,[{key:"batch",value:(m=(0,T.default)(k.default.mark(function e(t){var n,r=t.ids,a=t.operation,o=t.organizationId,i=arguments;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=i[0]&&Array.isArray(i[0].ids)&&i[0].ids.every(function(e){return"string"==typeof e})&&"string"==typeof i[0].operation&&"string"==typeof i[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  ids: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+h(i[0]));case 2:if(null!=i[0]&&Array.isArray(i[0].ids)&&i[0].ids.every(function(e){return"string"==typeof e})&&"string"==typeof i[0].operation&&"string"==typeof i[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  ids: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+p(i[0]));case 4:return n={"TT-X-Organization-Key":o},e.next=7,this.httpClient.patch("/v5/message_template",{data:{ids:r,operation:a},headers:n});case 7:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"create",value:(v=(0,T.default)(k.default.mark(function e(t){var n,r,a,o,i=t.attachment,s=t.body,u=t.network,c=t.organizationId,l=t.repository,d=t.title,f=arguments;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=f[0]&&(void 0===f[0].attachment||null==f[0].attachment||f[0].attachment instanceof Object||null==f[0].attachment||"string"==typeof f[0].attachment)&&"string"==typeof f[0].body&&"string"==typeof f[0].network&&"string"==typeof f[0].organizationId&&"string"==typeof f[0].repository&&"string"==typeof f[0].title){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  network: string;\n  organizationId: string;\n  repository: string;\n  title: string;\n}\n\nGot:\n"+h(f[0]));case 2:if(null!=f[0]&&(void 0===f[0].attachment||null==f[0].attachment||f[0].attachment instanceof Object||null==f[0].attachment||"string"==typeof f[0].attachment)&&"string"==typeof f[0].body&&"string"==typeof f[0].network&&"string"==typeof f[0].organizationId&&"string"==typeof f[0].repository&&"string"==typeof f[0].title){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  network: string;\n  organizationId: string;\n  repository: string;\n  title: string;\n}\n\nGot:\n"+p(f[0]));case 4:return n={},r={"TT-X-Organization-Key":c},i&&(n.attachment=i),e.next=9,this.httpClient.post("/v5/message_template",{files:n,data:{body:s,network:u,repository:l,template_label:d},headers:r,timeout:!i});case 9:return a=e.sent,o=a.data,e.abrupt("return",o);case 12:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"delete",value:(g=(0,T.default)(k.default.mark(function e(t,n){var r;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+h(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+h(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.del("/v5/message_template/:id",{headers:r,urlParams:{id:t}});case 11:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"downloadTemplateFile",value:(y=(0,T.default)(k.default.mark(function e(t){var n,r,a=t.templateId,o=t.fileName,i=t.organizationId;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={"TT-X-Organization-Key":i},r="/v5/message_template/"+a+"/attachment/"+o,e.abrupt("return",this.httpClient.downloadFileBlob(r,{headers:n}));case 3:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"find",value:(f=(0,T.default)(k.default.mark(function e(t,n){var r,a,o;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+h(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+h(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.get("/v5/message_template/:id",{headers:r,urlParams:{id:t}});case 11:return a=e.sent,o=a.data,e.abrupt("return",o);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"update",value:(d=(0,T.default)(k.default.mark(function e(t){var n,r,a,o,i=t.attachment,s=t.body,u=t.id,c=t.organizationId,l=t.repository,d=t.title,f=arguments;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=f[0]&&(void 0===f[0].attachment||null==f[0].attachment||null==f[0].attachment||null==f[0].attachment||f[0].attachment instanceof Object||null==f[0].attachment||"string"==typeof f[0].attachment)&&"string"==typeof f[0].body&&"string"==typeof f[0].id&&"string"==typeof f[0].organizationId&&"string"==typeof f[0].repository&&"string"==typeof f[0].title){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?null | ?Object | ?string;\n  body: string;\n  id: string;\n  organizationId: string;\n  repository: string;\n  title: string;\n}\n\nGot:\n"+h(f[0]));case 2:if(null!=f[0]&&(void 0===f[0].attachment||null==f[0].attachment||null==f[0].attachment||null==f[0].attachment||f[0].attachment instanceof Object||null==f[0].attachment||"string"==typeof f[0].attachment)&&"string"==typeof f[0].body&&"string"==typeof f[0].id&&"string"==typeof f[0].organizationId&&"string"==typeof f[0].repository&&"string"==typeof f[0].title){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?null | ?Object | ?string;\n  body: string;\n  id: string;\n  organizationId: string;\n  repository: string;\n  title: string;\n}\n\nGot:\n"+p(f[0]));case 4:return n={},r={"TT-X-Organization-Key":c},i&&(n.attachment=i),e.next=9,this.httpClient.put("/v5/message_template/:id",{files:n,data:(0,E.default)({},n.attachment?null:{attachment:i},{body:s,repository:l,template_label:d}),headers:r,timeout:!i,urlParams:{id:u}});case 9:return a=e.sent,o=a.data,e.abrupt("return",o);case 12:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})}]),a((c=C).prototype,"delete",[o],(0,x.default)(c.prototype,"delete"),c.prototype),a(c.prototype,"downloadTemplateFile",[i],(0,x.default)(c.prototype,"downloadTemplateFile"),c.prototype),a(c.prototype,"find",[s],(0,x.default)(c.prototype,"find"),c.prototype),a(c.prototype,"update",[u],(0,x.default)(c.prototype,"update"),c.prototype),c);function C(){return(0,A.default)(this,C),(0,j.default)(this,(C.__proto__||(0,I.default)(C)).apply(this,arguments))}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function T(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=T(t[0],n);return t.every(function(e){return T(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return T(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,j.default)(e))+": "+T(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function I(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=I(t[0],n);return t.every(function(e){return I(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return I(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,j.default)(e))+": "+I(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v=r(n(4)),m=r(n(5)),b=r(n(11)),A=r(n(10)),O=r(n(18)),j=r(n(3)),S=r(n(16)),w=r(n(9)),M=r(n(6)),_=r(n(1)),x=r(n(2)),E=r(n(8)),R=r(n(24)),k=r(n(7)),z=n(14),C=r(z),P=n(32),V=z.VERSIONS.VERSION_FIVE,G=z.VERSIONS.VERSION_TWO,N=z.ROUTES.MESSAGE_FIND,U=z.ROUTES.MESSAGE_FORWARD,F=z.ROUTES.MESSAGE_SEND,$=z.ROUTES.MESSAGE_UPDATE_RECIPIENT_STATUS_MULTI,D=(o=(0,z.recoverFromNotFound)(),i=(0,z.recoverFromNotFound)(),u=C.default,(0,k.default)(q,u),(0,x.default)(q,[{key:"send",value:(g=(0,w.default)(A.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f=t.attachment,p=t.body,h=t.conversationId,y=t.counterPartyId,g=t.deleteOnRead,v=t.escalate,m=t.localId,b=t.metadata,w=t.priority,_=t.recipientOrganizationId,x=t.senderOrganizationId,E=t.ttl,k=arguments;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==k[0]||!(void 0===k[0].attachment||null==k[0].attachment||k[0].attachment instanceof Object||null==k[0].attachment||"string"==typeof k[0].attachment)||"string"!=typeof k[0].body||void 0!==k[0].conversationId&&null!=k[0].conversationId&&"string"!=typeof k[0].conversationId||void 0!==k[0].counterPartyId&&null!=k[0].counterPartyId&&"string"!=typeof k[0].counterPartyId||void 0!==k[0].deleteOnRead&&null!=k[0].deleteOnRead&&"boolean"!=typeof k[0].deleteOnRead||void 0!==k[0].escalate&&null!=k[0].escalate&&"boolean"!=typeof k[0].escalate||"string"!=typeof k[0].localId||!(void 0===k[0].metadata||null==k[0].metadata||k[0].metadata instanceof Object)||void 0!==k[0].priority&&null!=k[0].priority&&"number"!=typeof k[0].priority||void 0!==k[0].recipientOrganizationId&&null!=k[0].recipientOrganizationId&&"string"!=typeof k[0].recipientOrganizationId||"string"!=typeof k[0].senderOrganizationId||void 0!==k[0].ttl&&null!=k[0].ttl&&"number"!=typeof k[0].ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  conversationId?: ?string;\n  counterPartyId?: ?string;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId: string;\n  ttl?: ?number;\n}\n\nGot:\n"+I(k[0]));e.next=2;break;case 2:if(null==k[0]||!(void 0===k[0].attachment||null==k[0].attachment||k[0].attachment instanceof Object||null==k[0].attachment||"string"==typeof k[0].attachment)||"string"!=typeof k[0].body||void 0!==k[0].conversationId&&null!=k[0].conversationId&&"string"!=typeof k[0].conversationId||void 0!==k[0].counterPartyId&&null!=k[0].counterPartyId&&"string"!=typeof k[0].counterPartyId||void 0!==k[0].deleteOnRead&&null!=k[0].deleteOnRead&&"boolean"!=typeof k[0].deleteOnRead||void 0!==k[0].escalate&&null!=k[0].escalate&&"boolean"!=typeof k[0].escalate||"string"!=typeof k[0].localId||!(void 0===k[0].metadata||null==k[0].metadata||k[0].metadata instanceof Object)||void 0!==k[0].priority&&null!=k[0].priority&&"number"!=typeof k[0].priority||void 0!==k[0].recipientOrganizationId&&null!=k[0].recipientOrganizationId&&"string"!=typeof k[0].recipientOrganizationId||"string"!=typeof k[0].senderOrganizationId||void 0!==k[0].ttl&&null!=k[0].ttl&&"number"!=typeof k[0].ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  conversationId?: ?string;\n  counterPartyId?: ?string;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId: string;\n  ttl?: ?number;\n}\n\nGot:\n"+T(k[0]));e.next=4;break;case 4:return n=(0,R.default)(q.prototype.__proto__||(0,M.default)(q.prototype),"getVersion",this).call(this,F),r=n.version,o={body:p},i={},s={},(a=void 0===r?G:r)===G?((0,P.isEmail)(y)&&(y=y.toLowerCase()),o.recipient=y,i.response_format="message",_=_||x,x&&(o.sender_organization=x),_&&(o.recipient_organization=_)):a===V&&(o.conversation_id=h),b&&(o.data=b.map(function(e){return(0,S.default)({},e,{payload:(0,j.default)(e.payload)})})),f&&(s.attachment=f),g&&(o.dor=g),v&&(o.escalate=v),void 0!==w&&(o.priority=w),E&&(o.ttl=E),e.prev=15,e.next=18,this.httpClient.post("/:version/message",{urlParams:{version:a},data:o,files:s,query:i,requestId:m,timeout:!f});case 18:if(u=e.sent,c=u.headers["tt-x-message-id"],this.config.condensedReplays&&u.data.last_message&&c!==u.data.last_message.message_id)return e.next=24,this.host.api.messages.find(c);e.next=26;break;case 24:(l=e.sent)&&(u.data.last_message=l.message);case 26:return e.abrupt("return",u.data);case 29:if(e.prev=29,e.t0=e.catch(15),304!==e.t0.status)return e.abrupt("return",O.default.reject(e.t0));e.next=33;break;case 33:if(d=e.t0.response.headers["TT-X-Message-Id".toLowerCase()]){e.next=36;break}return e.abrupt("return",O.default.reject(e.t0));case 36:return e.abrupt("return",{message_id:d});case 37:case"end":return e.stop()}},e,this,[[15,29]])})),function(e){return g.apply(this,arguments)})},{key:"destroy",value:(y=(0,w.default)(A.default.mark(function e(t){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(t));e.next=4;break;case 4:return e.prev=4,e.next=7,this.httpClient.del("/v2/message/:id",{urlParams:{id:t}});case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this,[[4,10]])})),function(e){return y.apply(this,arguments)})},{key:"forward",value:(h=(0,w.default)(A.default.mark(function e(t,n,r){var a,o,i,s,u,c,l=r.conversationId,d=r.localId,f=r.metadata,p=r.priority,h=r.recipientOrganizationId,y=r.senderOrganizationId,g=arguments;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(t));e.next=2;break;case 2:if(void 0!==n&&null!=n&&"string"!=typeof n)throw new TypeError('Value of optional argument "counterPartyId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+I(n));e.next=4;break;case 4:if(null==g[2]||void 0!==g[2].conversationId&&null!=g[2].conversationId&&"string"!=typeof g[2].conversationId||"string"!=typeof g[2].localId||!(void 0===g[2].metadata||null==g[2].metadata||g[2].metadata instanceof Object)||void 0!==g[2].priority&&null!=g[2].priority&&"number"!=typeof g[2].priority||void 0!==g[2].recipientOrganizationId&&null!=g[2].recipientOrganizationId&&"string"!=typeof g[2].recipientOrganizationId||void 0!==g[2].senderOrganizationId&&null!=g[2].senderOrganizationId&&"string"!=typeof g[2].senderOrganizationId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  conversationId?: ?string;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId?: ?string;\n}\n\nGot:\n"+I(g[2]));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(t));e.next=8;break;case 8:if(void 0!==n&&null!=n&&"string"!=typeof n)throw new TypeError('Value of optional argument "counterPartyId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+T(n));e.next=10;break;case 10:if(null==g[2]||void 0!==g[2].conversationId&&null!=g[2].conversationId&&"string"!=typeof g[2].conversationId||"string"!=typeof g[2].localId||!(void 0===g[2].metadata||null==g[2].metadata||g[2].metadata instanceof Object)||void 0!==g[2].priority&&null!=g[2].priority&&"number"!=typeof g[2].priority||void 0!==g[2].recipientOrganizationId&&null!=g[2].recipientOrganizationId&&"string"!=typeof g[2].recipientOrganizationId||void 0!==g[2].senderOrganizationId&&null!=g[2].senderOrganizationId&&"string"!=typeof g[2].senderOrganizationId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  conversationId?: ?string;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId?: ?string;\n}\n\nGot:\n"+T(g[2]));e.next=12;break;case 12:return a=(0,R.default)(q.prototype.__proto__||(0,M.default)(q.prototype),"getVersion",this).call(this,U),o=a.version,s={},(i=void 0===o?G:o)===G?(s.recipient=n,h=h||y,y&&(s.sender_organization=y),h&&(s.recipient_organization=h)):i===V&&(s.conversation_id=l),f&&(s.data=f.map(function(e){return(0,S.default)({},e,{payload:(0,j.default)(e.payload)})})),void 0!==p&&(s.priority=p),e.next=19,this.httpClient.post("/:version/message/:id/forward",{urlParams:{id:t,version:i},data:s,requestId:d});case 19:if(u=e.sent,i===G)return c={message_id:u.getHeader("TT-X-Message-Id")},e.abrupt("return",c);e.next=25;break;case 25:return e.abrupt("return",u.data);case 26:case"end":return e.stop()}},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"find",value:(p=(0,w.default)(A.default.mark(function e(t){var n,r,a,o;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(t));e.next=4;break;case 4:return n=(0,R.default)(q.prototype.__proto__||(0,M.default)(q.prototype),"getVersion",this).call(this,N),r=n.version,a=void 0===r?G:r,e.next=7,this.httpClient.get("/:version/message/:id",{urlParams:{id:t,version:a}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"findRecipientStatus",value:(f=(0,w.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(t));e.next=4;break;case 4:return e.next=6,this.httpClient.get("/:version/message/:id/status",{urlParams:{id:t,version:G}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"findRecipientStatusMulti",value:(d=(0,w.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+I(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+T(t));case 4:return e.next=6,this.httpClient.post("/:version/get_bulk_message_status",{urlParams:{version:G},data:{messages:t}});case 6:return n=e.sent,e.abrupt("return",n.data.bulk_message_statuses);case 8:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"updateRecipientStatusMulti",value:(l=(0,w.default)(A.default.mark(function e(t){var n,r,a,o;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,R.default)(q.prototype.__proto__||(0,M.default)(q.prototype),"getVersion",this).call(this,$),r=n.version,a=void 0===r?G:r,e.next=3,this.httpClient.post("/:version/message/status",{urlParams:{version:a},data:t});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"createAttachmentTokens",value:(c=(0,w.default)(A.default.mark(function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n&&"number"!=typeof n)throw new TypeError('Value of optional argument "count" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+I(n));e.next=2;break;case 2:if(void 0!==n&&"number"!=typeof n)throw new TypeError('Value of optional argument "count" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+T(n));e.next=4;break;case 4:return e.next=6,this.httpClient.post("/v5/attachment_tokens_bulk",{data:{count:n,expire_after_sec:43200,expire_after_used_sec:5}});case 6:return t=e.sent,e.abrupt("return",t.data);case 8:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})}]),a((s=q).prototype,"find",[o],(0,b.default)(s.prototype,"find"),s.prototype),a(s.prototype,"findRecipientStatus",[i],(0,b.default)(s.prototype,"findRecipientStatus"),s.prototype),s);function q(){return(0,_.default)(this,q),(0,E.default)(this,(q.__proto__||(0,M.default)(q)).apply(this,arguments))}t.default=D,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,d.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,l.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,c.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,d.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,l.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,c.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,c=r(n(3)),l=r(n(4)),d=r(n(5)),f=r(n(10)),p=r(n(9)),h=r(n(6)),y=r(n(1)),g=r(n(2)),v=r(n(8)),m=r(n(24)),b=r(n(7)),w=n(14),_=r(w),x=w.VERSIONS.VERSION_TWO,E=w.ROUTES.METADATA_FIND,k=(a=_.default,(0,b.default)(T,a),(0,g.default)(T,[{key:"update",value:(i=(0,p.default)(f.default.mark(function e(t,n,r){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+u(n));case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=8;break;case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+s(n));case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/metadata/:id",{urlParams:{id:t},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"find",value:(o=(0,p.default)(f.default.mark(function e(t,n){var r,a,o,i;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=8;break;case 8:return r=(0,m.default)(T.prototype.__proto__||(0,h.default)(T.prototype),"getVersion",this).call(this,E),a=r.version,o=void 0===a?x:a,e.next=11,this.httpClient.get("/:version/metadata/:id",{urlParams:{id:t,version:o},headers:{"TT-X-Organization-Key":n}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),T);function T(){return(0,y.default)(this,T),(0,v.default)(this,(T.__proto__||(0,h.default)(T)).apply(this,arguments))}t.default=k,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E=r(n(3)),k=r(n(4)),T=r(n(5)),I=r(n(11)),A=r(n(10)),O=r(n(9)),j=r(n(6)),S=r(n(1)),M=r(n(2)),R=r(n(8)),z=r(n(24)),C=r(n(7)),P=n(14),V=r(P),G=P.VERSIONS.VERSION_TWO,N=P.ROUTES.MUTE_FIND_ALL,U=(o=(0,P.recoverFromNotFound)(),u=(0,P.recoverFromNotFound)(),c=(0,P.recoverFromNotFound)(),l=(0,P.recoverFromNotFound)(),d=(0,P.recoverFromNotFound)(),f=(0,P.recoverFromNotFound)(),h=V.default,(0,C.default)(F,h),(0,M.default)(F,[{key:"findAll",value:(x=(0,O.default)(A.default.mark(function e(){var t,n,r,a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,z.default)(F.prototype.__proto__||(0,j.default)(F.prototype),"getVersion",this).call(this,N),n=t.version,r=void 0===n?G:n,e.next=3,this.httpClient.get("/:version/mute",{urlParams:{version:r}});case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}},e,this)})),function(){return x.apply(this,arguments)})},{key:"unmuteAll",value:(_=(0,O.default)(A.default.mark(function e(){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/v2/mute");case 2:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"muteUser",value:(w=(0,O.default)(A.default.mark(function e(t,n,r){var a=(3<arguments.length&&void 0!==arguments[3]?arguments[3]:{}).recipientOrganizationId,o=void 0===a?r:a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/mute/p2p",{data:{sender_token:t,sender_organization:r,receiver_organization:o,duration:n.toString()}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return w.apply(this,arguments)})},{key:"unmuteUser",value:(b=(0,O.default)(A.default.mark(function e(t,n){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).recipientOrganizationId,a=void 0===r?n:r;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v2/mute/p2p",{headers:{"TT-X-Sender-Token":t,"TT-X-Sender-Organization":n,"TT-X-Receiver-Organization":a}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"muteGroup",value:(m=(0,O.default)(A.default.mark(function e(t,n,r){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/mute/group/:groupId",{urlParams:{groupId:t},data:{duration:n.toString(),receiver_organization:r}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return m.apply(this,arguments)})},{key:"unmuteGroup",value:(v=(0,O.default)(A.default.mark(function e(t,n){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v2/mute/group/:groupId",{urlParams:{groupId:t},headers:{"TT-X-Receiver-Organization":n}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"muteOrganization",value:(g=(0,O.default)(A.default.mark(function e(t,n){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.post("/v2/mute/organization/:organizationId",{urlParams:{organizationId:t},data:{duration:n.toString(),receiver_organization:t}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"unmuteOrganization",value:(y=(0,O.default)(A.default.mark(function e(t){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:return e.next=6,this.httpClient.del("/v2/mute/organization/:organizationId",{urlParams:{organizationId:t},headers:{"TT-X-Receiver-Organization":t}});case 6:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})}]),a((p=F).prototype,"muteUser",[o],(0,I.default)(p.prototype,"muteUser"),p.prototype),a(p.prototype,"unmuteUser",[u],(0,I.default)(p.prototype,"unmuteUser"),p.prototype),a(p.prototype,"muteGroup",[c],(0,I.default)(p.prototype,"muteGroup"),p.prototype),a(p.prototype,"unmuteGroup",[l],(0,I.default)(p.prototype,"unmuteGroup"),p.prototype),a(p.prototype,"muteOrganization",[d],(0,I.default)(p.prototype,"muteOrganization"),p.prototype),a(p.prototype,"unmuteOrganization",[f],(0,I.default)(p.prototype,"unmuteOrganization"),p.prototype),p);function F(){return(0,S.default)(this,F),(0,R.default)(this,(F.__proto__||(0,j.default)(F)).apply(this,arguments))}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u=r(n(10)),c=r(n(9)),l=r(n(6)),d=r(n(1)),f=r(n(2)),p=r(n(8)),h=r(n(7)),y=r(n(14)),g=(a=y.default,(0,h.default)(v,a),(0,f.default)(v,[{key:"closeAllConnections",value:(s=(0,c.default)(u.default.mark(function e(t,n){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.httpClient.getAuthHeaders({key:t,secret:n}),e.next=3,this.httpClient.del("/v2/events/simple_notifications",{headers:r});case 3:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"signIn",value:(i=(0,c.default)(u.default.mark(function e(){var t,n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.httpClient.post("/v2/events/simple_notifications/key");case 2:return t=e.sent,n=t.getHeader("TT-X-Api-Key"),r=t.getHeader("TT-X-Api-Secret"),e.abrupt("return",{key:n,secret:r});case 6:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"signOut",value:(o=(0,c.default)(u.default.mark(function e(t,n){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.httpClient.getAuthHeaders({key:t,secret:n}),e.abrupt("return",this.httpClient.post("/v2/logout",{headers:r}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),v);function v(){return(0,d.default)(this,v),(0,p.default)(this,(v.__proto__||(0,l.default)(v)).apply(this,arguments))}t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,c,l,d,f,p,h,y,g,v=r(n(3)),m=r(n(4)),b=r(n(5)),w=r(n(11)),_=r(n(10)),x=r(n(9)),E=r(n(6)),k=r(n(1)),T=r(n(2)),I=r(n(8)),A=r(n(24)),O=r(n(7)),j=n(14),S=r(j),M=r(n(27)),R=j.VERSIONS.VERSION_TWO,z=j.ROUTES.ORGANIZATION_FIND_ALL_OF_USER,C=j.ROUTES.ORGANIZATION_FIND,P=(o=(0,j.recoverFromNotFound)(),i=(0,j.recoverFromNotFound)(),c=(0,j.recoverFromNotFound)(),l=(0,j.recoverFromNotFound)(),f=S.default,(0,O.default)(V,f),(0,T.default)(V,[{key:"find",value:(g=(0,x.default)(_.default.mark(function e(t,n){var r,a,o,i;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=8;break;case 8:return r=(0,A.default)(V.prototype.__proto__||(0,E.default)(V.prototype),"getVersion",this).call(this,C),a=r.version,o=void 0===a?R:a,e.next=11,this.httpClient.get("/:version/user/:userId/organization/:id",{urlParams:{version:o,userId:t,id:n}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"findAllOfUser",value:(y=(0,x.default)(_.default.mark(function e(t){var n,r,a,o;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return n=(0,A.default)(V.prototype.__proto__||(0,E.default)(V.prototype),"getVersion",this).call(this,z),r=n.version,a=void 0===r?R:r,e.next=7,this.httpClient.get("/:version/user/:userId/organization",{urlParams:{version:a,userId:t}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"getPreferences",value:(h=(0,x.default)(_.default.mark(function e(t){var n;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/v2/organization/:organizationId/preferences",{urlParams:{organizationId:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"editPreferences",value:(p=(0,x.default)(_.default.mark(function e(t){var n,r=t.organizationId,a=t.quickReplies;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v2/organization/:organizationId/preferences",{headers:{"TT-X-Organization-Key":r},data:M.default.underscoreObject({network:{patient:{quickReplies:a}}}),urlParams:{organizationId:r}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})}]),a((d=V).prototype,"find",[o],(0,w.default)(d.prototype,"find"),d.prototype),a(d.prototype,"findAllOfUser",[i],(0,w.default)(d.prototype,"findAllOfUser"),d.prototype),a(d.prototype,"getPreferences",[c],(0,w.default)(d.prototype,"getPreferences"),d.prototype),a(d.prototype,"editPreferences",[l],(0,w.default)(d.prototype,"editPreferences"),d.prototype),d);function V(){return(0,k.default)(this,V),(0,I.default)(this,(V.__proto__||(0,E.default)(V)).apply(this,arguments))}t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function f(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=f(t[0],n);return t.every(function(e){return f(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return f(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+f(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function p(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=p(t[0],n);return t.every(function(e){return p(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return p(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+p(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,h,y,g,v,m,b=r(n(3)),w=r(n(4)),_=r(n(5)),x=r(n(10)),E=r(n(9)),k=r(n(6)),T=r(n(1)),I=r(n(2)),A=r(n(8)),O=r(n(7)),j=r(n(233)),S=r(n(229)),M=r(n(40)),R=r(n(14)),z=r(n(27)),C=((0,S.default)(G,j.default,{value:function(e){return G(e)}}),G),P=(a=R.default,(0,O.default)(V,a),(0,I.default)(V,[{key:"create",value:(m=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v5/patient",{data:z.default.underscoreObject((0,M.default)(t,"organizationId")),headers:{"TT-X-Organization-Key":t.organizationId}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"delete",value:(v=(0,E.default)(x.default.mark(function e(t,n){var r;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v5/patient/:id",{urlParams:{id:t},headers:{"TT-X-Organization-Key":n}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"update",value:(g=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v5/patient/:id",{data:z.default.underscoreObject((0,M.default)(t,["organizationId","patientId"])),headers:{"TT-X-Organization-Key":t.organizationId},urlParams:{id:t.patientId}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"createContact",value:(y=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v5/patient/:patient_id/contact",{data:z.default.underscoreObject((0,M.default)(t,["organizationId","patientId"])),headers:{"TT-X-Organization-Key":t.organizationId},urlParams:{patient_id:t.patientId}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"deleteContact",value:(h=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/v5/patient/:patient_id/contact/:contact_id",{urlParams:{contact_id:t.contactId,patient_id:t.patientId},headers:{"TT-X-Organization-Key":t.organizationId}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"updateContact",value:(d=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v5/patient/:patient_id/contact/:contact_id",{data:z.default.underscoreObject((0,M.default)(t,["organizationId","patientId","contactId"])),headers:{"TT-X-Organization-Key":t.organizationId},urlParams:{patient_id:t.patientId,contact_id:t.contactId}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"login",value:(l=(0,E.default)(x.default.mark(function e(t,n,r,a){var o,i,s,u,c,l,d;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "linkToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=2;break;case 2:if(void 0!==n&&"string"!=typeof n)throw new TypeError('Value of optional argument "accessToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(n));e.next=4;break;case 4:if(void 0!==r&&"string"!=typeof r)throw new TypeError('Value of optional argument "dateOfBirth" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(r));e.next=6;break;case 6:if(void 0===a||Array.isArray(a)&&a.every(function(e){return C(e)})){e.next=8;break}throw new TypeError('Value of optional argument "sessions" violates contract.\n\nExpected:\nSessionObject[]\n\nGot:\n'+p(a));case 8:if("string"!=typeof t)throw new TypeError('Value of argument "linkToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=10;break;case 10:if(void 0!==n&&"string"!=typeof n)throw new TypeError('Value of optional argument "accessToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(n));e.next=12;break;case 12:if(void 0!==r&&"string"!=typeof r)throw new TypeError('Value of optional argument "dateOfBirth" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(r));e.next=14;break;case 14:if(void 0===a||Array.isArray(a)&&a.every(function(e){return C(e)})){e.next=16;break}throw new TypeError('Value of optional argument "sessions" violates contract.\n\nExpected:\nSessionObject[]\n\nGot:\n'+f(a));case 16:return o={want_condensed_replays:this.config.wantCondensedReplays,want_processing_events:this.config.wantCondensedReplays},n?(o.auth={access_token:n},r&&(o.auth.dob=r)):r&&(o.auth={dob:r}),Array.isArray(a)&&(o.session_tokens=z.default.underscoreObject(a)),e.next=21,this.httpClient.post("/v5/patient/login/:linkToken",{urlParams:{linkToken:t},data:o});case 21:return(i=e.sent).data&&(s=i.data,u=s.condensed_replays,c=void 0!==u&&u,l=s.processing_events,d=void 0!==l&&l,this.host.configure({condensedReplays:c,processingEvents:d})),e.abrupt("return",i.data);case 24:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return l.apply(this,arguments)})},{key:"loginCheck",value:(c=(0,E.default)(x.default.mark(function e(t,n){var r,a;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "linkToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=2;break;case 2:if(void 0===n||Array.isArray(n)&&n.every(function(e){return C(e)})){e.next=4;break}throw new TypeError('Value of optional argument "sessions" violates contract.\n\nExpected:\nSessionObject[]\n\nGot:\n'+p(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "linkToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=6;break;case 6:if(void 0===n||Array.isArray(n)&&n.every(function(e){return C(e)})){e.next=8;break}throw new TypeError('Value of optional argument "sessions" violates contract.\n\nExpected:\nSessionObject[]\n\nGot:\n'+f(n));case 8:return r={},Array.isArray(n)&&(r.session_tokens=z.default.underscoreObject(n)),e.next=12,this.httpClient.post("/v5/patient/login_check/:linkToken",{urlParams:{linkToken:t},data:r});case 12:return a=e.sent,e.abrupt("return",a.data);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"requestAccessToken",value:(u=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "linkToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "linkToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=4;break;case 4:return e.next=6,this.httpClient.post("/v5/patient/request_access_token/:linkToken",{urlParams:{linkToken:t},data:{}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"csvUpload",value:(s=(0,E.default)(x.default.mark(function e(t,n){var r;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "file" violates contract.\n\nExpected:\nstring\n\nGot:\n'+p(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "file" violates contract.\n\nExpected:\nstring\n\nGot:\n'+f(n));e.next=8;break;case 8:return e.next=10,this.httpClient.post("/v5/patient/csv/upload",{data:n,headers:{"TT-X-Organization-Key":t}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getWhiteLabel",value:(i=(0,E.default)(x.default.mark(function e(t){var n;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/v5/patient/white_label/:organizationId",{urlParams:{organizationId:t},headers:{"TT-X-Organization-Key":t}});case 2:return n=e.sent,e.abrupt("return",z.default.camelizeObject(n.data));case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"setWhiteLabel",value:(o=(0,E.default)(x.default.mark(function e(t,n){var r;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v5/patient/white_label/:organizationId",{urlParams:{organizationId:t},headers:{"TT-X-Organization-Key":t},data:z.default.underscoreObject(n)});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),V);function V(){return(0,T.default)(this,V),(0,A.default)(this,(V.__proto__||(0,k.default)(V)).apply(this,arguments))}function G(e){return null!=e&&"string"==typeof e.account_token&&"string"==typeof e.session_token}t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,h=r(n(11)),y=r(n(10)),g=r(n(9)),v=r(n(6)),m=r(n(1)),b=r(n(2)),w=r(n(8)),_=r(n(7)),x=n(14),E=r(x),k=(a=(0,x.recoverFromNotFound)(),f=E.default,(0,_.default)(T,f),(0,b.default)(T,[{key:"create",value:(p=(0,g.default)(y.default.mark(function e(){var t,n;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.httpClient.getAuthHeaders(),e.next=3,this.httpClient.get("/v2/qr_login_code/",{headers:t});case 3:return n=e.sent,e.abrupt("return",n.data.qr_key);case 5:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})}]),i=(o=T).prototype,s="create",u=[a],c=(0,h.default)(o.prototype,"create"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function T(){return(0,m.default)(this,T),(0,w.default)(this,(T.__proto__||(0,v.default)(T)).apply(this,arguments))}t.default=k,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function g(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=g(t[0],n);return t.every(function(e){return g(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return g(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+g(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function v(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=v(t[0],n);return t.every(function(e){return v(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return v(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+v(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,h=r(n(3)),y=r(n(4)),m=r(n(5)),b=r(n(11)),w=r(n(10)),_=r(n(9)),x=r(n(6)),E=r(n(1)),k=r(n(2)),T=r(n(8)),I=r(n(7)),A=n(14),O=r(A),j=["messageId","sender.name","sender.title","sender.department","sender.mrn","senderRoleDisplayName","recipient.name","recipient.title","recipient.department","recipient.mrn","recipientRoleDisplayName","group.name","distributionList.name","sentTimestamp","attachment.hasAttachment","recalledTimestamp","forwardedMessageId","expireTimestamp","dndAutoForwardedFrom"],S={script:"(doc['deliveredTimestamp'].empty ? '' : _source.deliveredTimestamp < _source.sentTimestamp ? _source.sentTimestamp : _source.deliveredTimestamp)"},M={script:"(doc['readTimestamp'].empty ? '' :_source.readTimestamp < _source.sentTimestamp ? _source.sentTimestamp : _source.readTimestamp)"},R=["sender.title","recipient.title","sender.department","sender.mrn","recipient.mrn","senderRoleDisplayName","recipient.department","recipientRoleDisplayName","sender.username","recipient.username","sender.verifiedEmails","recipient.verifiedEmails","sender.unverifiedEmails","recipient.unverifiedEmails","sender.verifiedPhones","recipient.verifiedPhones","sender.unverifiedPhones","recipient.unverifiedPhones","group.groupId","group.name","distributionList.distributionListId","distributionList.name","forwardedMessageId","messageId"],z=(a=(0,A.recoverFromNotFound)(),f=O.default,(0,I.default)(C,f),(0,k.default)(C,[{key:"fetchTransactions",value:(p=(0,_.default)(w.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=n.page,d=n.size,f=n.startDate,p=n.endDate,h=n.query,y=arguments;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(t));e.next=2;break;case 2:if(null==y[1]||"number"!=typeof y[1].page||"number"!=typeof y[1].size||"string"!=typeof y[1].startDate||"string"!=typeof y[1].endDate||"string"!=typeof y[1].query)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  page: number;\n  size: number;\n  startDate: string;\n  endDate: string;\n  query: string;\n}\n\nGot:\n"+v(y[1]));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(t));e.next=6;break;case 6:if(null==y[1]||"number"!=typeof y[1].page||"number"!=typeof y[1].size||"string"!=typeof y[1].startDate||"string"!=typeof y[1].endDate||"string"!=typeof y[1].query)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  page: number;\n  size: number;\n  startDate: string;\n  endDate: string;\n  query: string;\n}\n\nGot:\n"+g(y[1]));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},a=l*d-d,o=t,s=(i=h)&&h.split(" ").join("*"),u=[{range:{sentTimestamp:{from:f,to:p}}},{match:{"sender.organization.orgId":o}},{constant_score:{filter:{missing:{field:"message.hideMessage"}}}},{bool:{should:[{query_string:{query:"*"+s+"*",fields:["sender.name","recipient.name"]}},{multi_match:{query:i,fields:R}}]}}],e.next=16,this.httpClient.post("/v2/report/messages",{headers:r,data:{from:a,size:d,fields:j,script_fields:{deliveredTimestamp:S,readTimestamp:M},sort:{sentTimestamp:{order:"desc"}},query:{bool:{must:u}}}});case 16:return c=e.sent,e.abrupt("return",c);case 18:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})}]),i=(o=C).prototype,s="fetchTransactions",u=[a],c=(0,b.default)(o.prototype,"fetchTransactions"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function C(){var e,t,i,n,r,s=this;(0,E.default)(this,C);for(var a=arguments.length,o=Array(a),u=0;u<a;u++)o[u]=arguments[u];return t=i=(0,T.default)(this,(e=C.__proto__||(0,x.default)(C)).call.apply(e,[this].concat(o))),i.generateLookerEmbed=(r=(0,_.default)(w.default.mark(function e(t,n){var r,a,o;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "dashboard_type" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "dashboard_type" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,i.httpClient.post("/v2/looker",{headers:r,data:{dashboard_type:n}});case 11:return a=e.sent,o=a.data,e.abrupt("return",o&&o.looker_url);case 14:case"end":return e.stop()}},e,s)})),function(e,t){return r.apply(this,arguments)}),n=t,(0,T.default)(i,n)}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,k.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,E.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,x.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,k.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,E.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,x.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,d,f,p,h,y,g,v,m,b,w,_,x=r(n(3)),E=r(n(4)),k=r(n(5)),T=r(n(11)),I=r(n(10)),A=r(n(9)),O=r(n(6)),j=r(n(1)),S=r(n(2)),M=r(n(8)),R=r(n(7)),z=n(14),C=r(z),P=(a=(0,z.recoverFromNotFound)(),h=C.default,(0,R.default)(V,h),(0,S.default)(V,[{key:"findAll",value:(_=(0,A.default)(I.default.mark(function e(t){var n,r;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=4;break;case 4:return n={"TT-X-Organization-Key":t},e.next=7,this.httpClient.get("/v2/role/tags",{headers:n});case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"createOrUpdateTag",value:(w=(0,A.default)(I.default.mark(function e(t,n,r,a){var o,i;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "color" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "name" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "color" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "name" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(r));e.next=12;break;case 12:if(o={color:t,name:n,organizationId:r},i=void 0,a)return e.next=17,this.updateTag(a,o);e.next=20;break;case 17:i=e.sent,e.next=23;break;case 20:return e.next=22,this.createTag(o);case 22:i=e.sent;case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return w.apply(this,arguments)})},{key:"createTag",value:(b=(0,A.default)(I.default.mark(function e(t){var n,r,a=t.color,o=t.name,i=t.organizationId,s=arguments;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==s[0]||"string"!=typeof s[0].color||"string"!=typeof s[0].name||"string"!=typeof s[0].organizationId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+l(s[0]));e.next=2;break;case 2:if(null==s[0]||"string"!=typeof s[0].color||"string"!=typeof s[0].name||"string"!=typeof s[0].organizationId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+c(s[0]));e.next=4;break;case 4:return n={"TT-X-Organization-Key":i},e.next=7,this.httpClient.post("/v2/tags",{data:{color:a,name:o},headers:n});case 7:return(r=e.sent).token=r.headers["tt-x-tag-id"],e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"updateTag",value:(m=(0,A.default)(I.default.mark(function e(t,n){var r,a,o=n.color,i=n.name,s=n.organizationId,u=arguments;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==u[1]||"string"!=typeof u[1].color||"string"!=typeof u[1].name||"string"!=typeof u[1].organizationId)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+l(u[1]));e.next=2;break;case 2:if(null==u[1]||"string"!=typeof u[1].color||"string"!=typeof u[1].name||"string"!=typeof u[1].organizationId)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+c(u[1]));e.next=4;break;case 4:return r={"TT-X-Organization-Key":s},e.next=7,this.httpClient.put("/v2/tags/:token",{urlParams:{token:t},data:{color:o,name:i},headers:r});case 7:return(a=e.sent).token=t,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"destroy",value:(v=(0,A.default)(I.default.mark(function e(t,n){var r,a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.del("/v2/tags/:token",{urlParams:{token:n},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"findColors",value:(g=(0,A.default)(I.default.mark(function e(t){var n,r;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=4;break;case 4:return n={"TT-X-Organization-Key":t},e.next=7,this.httpClient.get("/v2/tag/color_list/:organizationId",{urlParams:{organizationId:t},headers:n});case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"findTag",value:(y=(0,A.default)(I.default.mark(function e(t,n){var r,a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "tagId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "tagId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.get("/v2/tags/:tagId",{urlParams:{tagId:n},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})}]),i=(o=V).prototype,s="findAll",u=[a],d=(0,T.default)(o.prototype,"findAll"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(i,s,p),p=null),o);function V(){return(0,j.default)(this,V),(0,M.default)(this,(V.__proto__||(0,O.default)(V)).apply(this,arguments))}t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function m(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=m(t[0],n);return t.every(function(e){return m(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return m(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+m(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,w,_,x,E=r(n(3)),k=r(n(4)),T=r(n(5)),I=r(n(11)),A=r(n(10)),O=r(n(9)),j=r(n(6)),S=r(n(1)),M=r(n(2)),R=r(n(8)),z=r(n(24)),C=r(n(7)),P=n(14),V=r(P),G=P.VERSIONS.VERSION_TWO,N=P.ROUTES.ROLES_CREATE_P2P_GROUP,U=(o=(0,P.recoverFromNotFound)(),i=(0,P.recoverFromNotFound)(),u=V.default,(0,C.default)(F,u),(0,M.default)(F,[{key:"createP2PGroup",value:(x=(0,O.default)(A.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p=t.createdByUserId,h=t.name,y=t.replayHistory,g=void 0!==y&&y,v=t.memberIds,m=void 0===v?[]:v,b=t.organizationId;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,z.default)(F.prototype.__proto__||(0,j.default)(F.prototype),"getVersion",this).call(this,N),r=n.version,a=void 0===r?G:r,o={"TT-X-Organization-Key":b},i={created_by:p,members:m,name:h,replay_history:g},e.next=5,this.httpClient.post("/:version/role_group",{urlParams:{version:a},headers:o,data:i});case 5:return s=e.sent,u=s.data,c=u.conversation_id,l=u.metadata,d=s.data.token,f={conversationId:c,memberIds:m,metadata:l,name:h,organizationId:b,token:d},e.abrupt("return",f);case 10:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"find",value:(_=(0,O.default)(A.default.mark(function e(t,n){var r,a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.get("/v2/role/:id",{urlParams:{id:t},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return _.apply(this,arguments)})},{key:"createRole",value:(w=(0,O.default)(A.default.mark(function e(t){var n,r,a,o=t.description,i=t.name,s=t.openAssignment,u=t.organizationId,c=t.ownerRequired,l=t.owners,d=t.replayHistory,f=t.tagColor,p=t.tagName,h=t.tagToken,y=t.escalationPolicy,g=arguments;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==g[0]||void 0!==g[0].description&&null!=g[0].description&&"string"!=typeof g[0].description||"string"!=typeof g[0].name||"boolean"!=typeof g[0].openAssignment||"string"!=typeof g[0].organizationId||void 0!==g[0].ownerRequired&&null!=g[0].ownerRequired&&"boolean"!=typeof g[0].ownerRequired||!(void 0===g[0].owners||null==g[0].owners||Array.isArray(g[0].owners)&&g[0].owners.every(function(e){return"string"==typeof e}))||"string"!=typeof g[0].replayHistory||void 0!==g[0].tagColor&&null!=g[0].tagColor&&"string"!=typeof g[0].tagColor||void 0!==g[0].tagName&&null!=g[0].tagName&&"string"!=typeof g[0].tagName||void 0!==g[0].tagToken&&null!=g[0].tagToken&&"string"!=typeof g[0].tagToken||!(void 0===g[0].escalationPolicy||null==g[0].escalationPolicy||g[0].escalationPolicy instanceof Object))throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name: string;\n  openAssignment: boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory: string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+b(g[0]));e.next=2;break;case 2:if(null==g[0]||void 0!==g[0].description&&null!=g[0].description&&"string"!=typeof g[0].description||"string"!=typeof g[0].name||"boolean"!=typeof g[0].openAssignment||"string"!=typeof g[0].organizationId||void 0!==g[0].ownerRequired&&null!=g[0].ownerRequired&&"boolean"!=typeof g[0].ownerRequired||!(void 0===g[0].owners||null==g[0].owners||Array.isArray(g[0].owners)&&g[0].owners.every(function(e){return"string"==typeof e}))||"string"!=typeof g[0].replayHistory||void 0!==g[0].tagColor&&null!=g[0].tagColor&&"string"!=typeof g[0].tagColor||void 0!==g[0].tagName&&null!=g[0].tagName&&"string"!=typeof g[0].tagName||void 0!==g[0].tagToken&&null!=g[0].tagToken&&"string"!=typeof g[0].tagToken||!(void 0===g[0].escalationPolicy||null==g[0].escalationPolicy||g[0].escalationPolicy instanceof Object))throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name: string;\n  openAssignment: boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory: string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+m(g[0]));e.next=4;break;case 4:return n={"TT-X-Organization-Key":u},r={display_name:i,open_assignment:s?"1":"0",replay_history:d},void 0!==o&&(r.description=o),void 0!==y&&(r.escalation_policy=y),void 0!==c&&(r.owner_required=c?"1":"0"),void 0!==l&&(r.owners=l),void 0!==f&&(r.tag_color=f),void 0!==h&&(r.tag_id=h),void 0!==p&&(r.tag_name=p),e.next=15,this.httpClient.post("/v2/role",{headers:n,data:r});case 15:return(a=e.sent).token=a.headers["tt-x-role-token"],e.abrupt("return",a);case 18:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"updateRole",value:(v=(0,O.default)(A.default.mark(function e(t,n){var r,a,o,i=n.description,s=n.name,u=n.openAssignment,c=n.organizationId,l=n.ownerRequired,d=n.owners,f=n.replayHistory,p=n.tagColor,h=n.tagName,y=n.tagToken,g=n.escalationPolicy,v=arguments;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if(null==v[1]||void 0!==v[1].description&&null!=v[1].description&&"string"!=typeof v[1].description||void 0!==v[1].name&&null!=v[1].name&&"string"!=typeof v[1].name||void 0!==v[1].openAssignment&&null!=v[1].openAssignment&&"boolean"!=typeof v[1].openAssignment||"string"!=typeof v[1].organizationId||void 0!==v[1].ownerRequired&&null!=v[1].ownerRequired&&"boolean"!=typeof v[1].ownerRequired||!(void 0===v[1].owners||null==v[1].owners||Array.isArray(v[1].owners)&&v[1].owners.every(function(e){return"string"==typeof e}))||void 0!==v[1].replayHistory&&null!=v[1].replayHistory&&"string"!=typeof v[1].replayHistory||void 0!==v[1].tagColor&&null!=v[1].tagColor&&"string"!=typeof v[1].tagColor||void 0!==v[1].tagName&&null!=v[1].tagName&&"string"!=typeof v[1].tagName||void 0!==v[1].tagToken&&null!=v[1].tagToken&&"string"!=typeof v[1].tagToken||!(void 0===v[1].escalationPolicy||null==v[1].escalationPolicy||v[1].escalationPolicy instanceof Object))throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name?: ?string;\n  openAssignment?: ?boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory?: ?string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+b(v[1]));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if(null==v[1]||void 0!==v[1].description&&null!=v[1].description&&"string"!=typeof v[1].description||void 0!==v[1].name&&null!=v[1].name&&"string"!=typeof v[1].name||void 0!==v[1].openAssignment&&null!=v[1].openAssignment&&"boolean"!=typeof v[1].openAssignment||"string"!=typeof v[1].organizationId||void 0!==v[1].ownerRequired&&null!=v[1].ownerRequired&&"boolean"!=typeof v[1].ownerRequired||!(void 0===v[1].owners||null==v[1].owners||Array.isArray(v[1].owners)&&v[1].owners.every(function(e){return"string"==typeof e}))||void 0!==v[1].replayHistory&&null!=v[1].replayHistory&&"string"!=typeof v[1].replayHistory||void 0!==v[1].tagColor&&null!=v[1].tagColor&&"string"!=typeof v[1].tagColor||void 0!==v[1].tagName&&null!=v[1].tagName&&"string"!=typeof v[1].tagName||void 0!==v[1].tagToken&&null!=v[1].tagToken&&"string"!=typeof v[1].tagToken||!(void 0===v[1].escalationPolicy||null==v[1].escalationPolicy||v[1].escalationPolicy instanceof Object))throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name?: ?string;\n  openAssignment?: ?boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory?: ?string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+m(v[1]));e.next=8;break;case 8:return r={"TT-X-Organization-Key":c},a={},void 0!==i&&(a.description=i),void 0!==s&&(a.display_name=s),void 0!==g&&(a.escalation_policy=g),void 0!==u&&(a.open_assignment=u?"1":"0"),void 0!==l&&(a.owner_required=l?"1":"0"),void 0!==d&&(a.owners=d),void 0!==f&&(a.replay_history=f),void 0!==p&&(a.tag_color=p),void 0!==y&&(a.tag_id=y),void 0!==h&&(a.tag_name=h),e.next=22,this.httpClient.put("/v2/role/:token",{urlParams:{token:t},headers:r,data:a});case 22:return(o=e.sent).token=t,e.abrupt("return",o);case 25:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"deleteRole",value:(g=(0,O.default)(A.default.mark(function e(t,n){var r;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.del("/v2/role/:token",{urlParams:{token:n},headers:r});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"findSavedRoles",value:(y=(0,O.default)(A.default.mark(function e(t,n){var r,a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.get("/v2/user/:userId/saved_roles",{urlParams:{userId:t},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"saveRole",value:(h=(0,O.default)(A.default.mark(function e(t,n,r){var a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.post("/v2/user/:userId/saved_roles",{urlParams:{userId:n},data:{role_id:t},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"removeSavedRole",value:(p=(0,O.default)(A.default.mark(function e(t,n,r){var a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.del("/v2/user/:userId/saved_roles/:roleId",{urlParams:{userId:n,roleId:t},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"optIn",value:(f=(0,O.default)(A.default.mark(function e(t,n,r){var a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.post("/v2/role/:roleId/members/:userId",{urlParams:{roleId:t,userId:n},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return f.apply(this,arguments)})},{key:"optOut",value:(d=(0,O.default)(A.default.mark(function e(t,n,r){var a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.del("/v2/role/:roleId/members/:userId",{urlParams:{roleId:t,userId:n},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return d.apply(this,arguments)})},{key:"saveAwayResponse",value:(l=(0,O.default)(A.default.mark(function e(t,n,r){var a;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":n},e.next=15,this.httpClient.post("/v2/role/:roleId/away",{urlParams:{roleId:t},headers:a,data:{status:r}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return l.apply(this,arguments)})},{key:"removeAwayResponse",value:(c=(0,O.default)(A.default.mark(function e(t,n){var r;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.del("/v2/role/:roleId/away",{urlParams:{roleId:t},headers:r});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})}]),a((s=F).prototype,"find",[o],(0,I.default)(s.prototype,"find"),s.prototype),a(s.prototype,"findSavedRoles",[i],(0,I.default)(s.prototype,"findSavedRoles"),s.prototype),s);function F(){return(0,S.default)(this,F),(0,R.default)(this,(F.__proto__||(0,j.default)(F)).apply(this,arguments))}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l,d=r(n(3)),f=r(n(4)),p=r(n(5)),h=r(n(10)),y=r(n(9)),g=r(n(6)),v=r(n(1)),m=r(n(2)),b=r(n(8)),w=r(n(24)),_=r(n(7)),x=r(n(266)),E=n(14),k=r(E),T=E.VERSIONS.VERSION_TWO,I=E.VERSIONS.VERSION_FIVE,A=["user","distributionList"],O=E.ROUTES.CONVERSATION_FIND_ALL,j=(a=k.default,(0,_.default)(S,a),(0,m.default)(S,[{key:"findAll",value:(l=(0,y.default)(h.default.mark(function e(){var t,n,r,a,o,i,s,u=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{organizationId:null};return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,w.default)(S.prototype.__proto__||(0,g.default)(S.prototype),"getVersion",this).call(this,O),n=t.version,o={render_metadata:"true"},(r=(a=void 0)===n?T:n)===I&&(a=u.organizationId,o.mark_as_delivered="true",o.paginated="true",o.organization_id=a||void 0),e.next=6,this.httpClient.get("/:version/roster",{query:o,urlParams:{version:r}});case 6:if((i=e.sent).data.continuation)return e.next=10,this._findAllPaginated(i.data.continuation,a,i.data.items);e.next=12;break;case 10:return s=e.sent,e.abrupt("return",s);case 12:return e.abrupt("return",i.data.items||i.data);case 13:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"_findAllPaginated",value:(c=(0,y.default)(h.default.mark(function e(t,n,r){var a;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t)return e.abrupt("return",r);e.next=2;break;case 2:return e.next=4,this.httpClient.get("/v5/roster",{query:{render_metadata:"true",mark_as_delivered:"true",paginated:"true",continuation:encodeURI(t),organization_id:n||void 0}});case 4:return a=e.sent,r=r.concat(a.data.items),e.abrupt("return",this._findAllPaginated(a.data.continuation,n,r));case 7:case"end":return e.stop()}},e,this)})),function(e,t,n){return c.apply(this,arguments)})},{key:"add",value:(u=(0,y.default)(h.default.mark(function e(t,n,r){var a,o;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:if((0,x.default)(A,t)){e.next=14;break}return e.abrupt("return");case 14:return a={},r&&(a["TT-X-Organization-Key"]=r),o=this.__typeToNS(t),e.next=19,this.httpClient.post("/v2/roster",{headers:a,data:{entity:n,type:o}});case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(o=(0,y.default)(h.default.mark(function e(t,n,r){var a,o;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:if((0,x.default)(A,t)){e.next=14;break}return e.abrupt("return");case 14:return a={},o=this.__typeToNS(t),r&&(a["TT-X-Organization-Key"]=r,a["TT-X-Type"]=o),e.next=19,this.httpClient.del("/v2/roster/:counterPartyId",{headers:a,urlParams:{counterPartyId:n},data:{type:o}});case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"__typeToNS",value:function(e){return M[e]}}]),S);function S(){return(0,v.default)(this,S),(0,b.default)(this,(S.__proto__||(0,g.default)(S)).apply(this,arguments))}t.default=j;var M={user:"tigertext:entity:account",distributionList:"tigertext:entity:list"};e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,x.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,b.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,m.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,x.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,b.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,m.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m=r(n(3)),b=r(n(4)),x=r(n(5)),E=r(n(11)),k=r(n(16)),T=r(n(10)),I=r(n(9)),A=r(n(6)),O=r(n(1)),j=r(n(2)),S=r(n(8)),M=r(n(7)),R=n(14),z=r(R),C=(o=(0,R.recoverFromNotFound)(),i=(0,R.recoverFromNotFound)(),s=(0,R.recoverFromNotFound)(),u=(0,R.recoverFromNotFound)(),l=z.default,(0,M.default)(P,l),(0,j.default)(P,[{key:"batch",value:(v=(0,I.default)(T.default.mark(function e(t){var n,r=t.ids,a=t.operation,o=t.organizationId,i=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=i[0]&&Array.isArray(i[0].ids)&&i[0].ids.every(function(e){return"string"==typeof e})&&"string"==typeof i[0].operation&&"string"==typeof i[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  ids: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+_(i[0]));case 2:if(null!=i[0]&&Array.isArray(i[0].ids)&&i[0].ids.every(function(e){return"string"==typeof e})&&"string"==typeof i[0].operation&&"string"==typeof i[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  ids: string[];\n  operation: string;\n  organizationId: string;\n}\n\nGot:\n"+w(i[0]));case 4:return n={"TT-X-Organization-Key":o},e.next=7,this.httpClient.patch("/v5/schedule_message",{data:{ids:r,operation:a},headers:n});case 7:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"create",value:(g=(0,I.default)(T.default.mark(function e(t){var n,r,a,o,i=t.attachment,s=t.body,u=t.end_date,c=t.network,l=t.no_reply,d=t.organizationId,f=t.recipients,p=t.repeating,h=t.send_now,y=t.start_date,g=t.start_time,v=t.template_id,m=t.timezone_name,b=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==b[0]||!(void 0===b[0].attachment||null==b[0].attachment||b[0].attachment instanceof Object||null==b[0].attachment||"string"==typeof b[0].attachment)||"string"!=typeof b[0].body||void 0!==b[0].end_date&&null!=b[0].end_date&&"string"!=typeof b[0].end_date||"string"!=typeof b[0].network||void 0!==b[0].no_reply&&null!=b[0].no_reply&&"boolean"!=typeof b[0].no_reply||"string"!=typeof b[0].organizationId||!Array.isArray(b[0].recipients)||!b[0].recipients.every(function(e){return"string"==typeof e})||void 0!==b[0].repeating&&null!=b[0].repeating&&"string"!=typeof b[0].repeating||void 0!==b[0].send_now&&null!=b[0].send_now&&"boolean"!=typeof b[0].send_now||void 0!==b[0].start_date&&null!=b[0].start_date&&"string"!=typeof b[0].start_date||void 0!==b[0].start_time&&null!=b[0].start_time&&"string"!=typeof b[0].start_time||void 0!==b[0].template_id&&null!=b[0].template_id&&"string"!=typeof b[0].template_id||"string"!=typeof b[0].timezone_name)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  end_date?: ?string;\n  network: string;\n  no_reply?: ?boolean;\n  organizationId: string;\n  recipients: string[];\n  repeating?: ?string;\n  send_now?: ?boolean;\n  start_date?: ?string;\n  start_time?: ?string;\n  template_id?: ?string;\n  timezone_name: string;\n}\n\nGot:\n"+_(b[0]));e.next=2;break;case 2:if(null==b[0]||!(void 0===b[0].attachment||null==b[0].attachment||b[0].attachment instanceof Object||null==b[0].attachment||"string"==typeof b[0].attachment)||"string"!=typeof b[0].body||void 0!==b[0].end_date&&null!=b[0].end_date&&"string"!=typeof b[0].end_date||"string"!=typeof b[0].network||void 0!==b[0].no_reply&&null!=b[0].no_reply&&"boolean"!=typeof b[0].no_reply||"string"!=typeof b[0].organizationId||!Array.isArray(b[0].recipients)||!b[0].recipients.every(function(e){return"string"==typeof e})||void 0!==b[0].repeating&&null!=b[0].repeating&&"string"!=typeof b[0].repeating||void 0!==b[0].send_now&&null!=b[0].send_now&&"boolean"!=typeof b[0].send_now||void 0!==b[0].start_date&&null!=b[0].start_date&&"string"!=typeof b[0].start_date||void 0!==b[0].start_time&&null!=b[0].start_time&&"string"!=typeof b[0].start_time||void 0!==b[0].template_id&&null!=b[0].template_id&&"string"!=typeof b[0].template_id||"string"!=typeof b[0].timezone_name)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  end_date?: ?string;\n  network: string;\n  no_reply?: ?boolean;\n  organizationId: string;\n  recipients: string[];\n  repeating?: ?string;\n  send_now?: ?boolean;\n  start_date?: ?string;\n  start_time?: ?string;\n  template_id?: ?string;\n  timezone_name: string;\n}\n\nGot:\n"+w(b[0]));e.next=4;break;case 4:return n={},r={"TT-X-Organization-Key":d},i&&(n.attachment=i),e.next=9,this.httpClient.post("/v5/schedule_message",{files:n,data:(0,k.default)({},n.attachment?null:{attachment:i},{body:s},p?{end_date:u}:null,{network:c,no_reply:l,recipients:f},p?{repeating:p}:null,{send_now:h,start_date:y,start_time:g},v?{template_id:v}:null,{timezone_name:m}),headers:r,timeout:!(i||v)});case 9:return a=e.sent,o=a.data,e.abrupt("return",o);case 12:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"delete",value:(y=(0,I.default)(T.default.mark(function e(t,n){var r;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.del("/v5/schedule_message/:id",{headers:r,urlParams:{id:t}});case 11:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"downloadScheduledMessageFile",value:(h=(0,I.default)(T.default.mark(function e(t){var n,r,a=t.scheduleId,o=t.fileName,i=t.organizationId;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={"TT-X-Organization-Key":i},r="/v5/schedule_message/"+a+"/attachment/"+o,e.abrupt("return",this.httpClient.downloadFileBlob(r,{headers:n}));case 3:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"find",value:(p=(0,I.default)(T.default.mark(function e(t,n){var r,a,o;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.get("/v5/schedule_message/:id",{headers:r,urlParams:{id:t}});case 11:return a=e.sent,o=a.data,e.abrupt("return",o);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"findCoarseTimezone",value:(f=(0,I.default)(T.default.mark(function e(t,n){var r,a,o;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={"TT-X-Organization-Key":n},e.next=3,this.httpClient.get("/v5/timezone/:timezone",{headers:r,urlParams:{timezone:t}});case 3:return a=e.sent,o=a.data,e.abrupt("return",o);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"update",value:(d=(0,I.default)(T.default.mark(function e(t){var n,r,a,o,i=t.attachment,s=t.body,u=t.end_date,c=t.id,l=t.organizationId,d=t.repeating,f=t.start_date,p=t.start_time,h=t.template_id,y=t.timezone_name,g=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==g[0]||!(void 0===g[0].attachment||null==g[0].attachment||null==g[0].attachment||null==g[0].attachment||g[0].attachment instanceof Object||null==g[0].attachment||"string"==typeof g[0].attachment)||"string"!=typeof g[0].body||void 0!==g[0].end_date&&null!=g[0].end_date&&"string"!=typeof g[0].end_date||"string"!=typeof g[0].id||"string"!=typeof g[0].organizationId||void 0!==g[0].repeating&&null!=g[0].repeating&&"string"!=typeof g[0].repeating||void 0!==g[0].start_date&&null!=g[0].start_date&&"string"!=typeof g[0].start_date||void 0!==g[0].start_time&&null!=g[0].start_time&&"string"!=typeof g[0].start_time||void 0!==g[0].template_id&&null!=g[0].template_id&&"string"!=typeof g[0].template_id||"string"!=typeof g[0].timezone_name)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?null | ?Object | ?string;\n  body: string;\n  end_date?: ?string;\n  id: string;\n  organizationId: string;\n  repeating?: ?string;\n  start_date?: ?string;\n  start_time?: ?string;\n  template_id?: ?string;\n  timezone_name: string;\n}\n\nGot:\n"+_(g[0]));e.next=2;break;case 2:if(null==g[0]||!(void 0===g[0].attachment||null==g[0].attachment||null==g[0].attachment||null==g[0].attachment||g[0].attachment instanceof Object||null==g[0].attachment||"string"==typeof g[0].attachment)||"string"!=typeof g[0].body||void 0!==g[0].end_date&&null!=g[0].end_date&&"string"!=typeof g[0].end_date||"string"!=typeof g[0].id||"string"!=typeof g[0].organizationId||void 0!==g[0].repeating&&null!=g[0].repeating&&"string"!=typeof g[0].repeating||void 0!==g[0].start_date&&null!=g[0].start_date&&"string"!=typeof g[0].start_date||void 0!==g[0].start_time&&null!=g[0].start_time&&"string"!=typeof g[0].start_time||void 0!==g[0].template_id&&null!=g[0].template_id&&"string"!=typeof g[0].template_id||"string"!=typeof g[0].timezone_name)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?null | ?Object | ?string;\n  body: string;\n  end_date?: ?string;\n  id: string;\n  organizationId: string;\n  repeating?: ?string;\n  start_date?: ?string;\n  start_time?: ?string;\n  template_id?: ?string;\n  timezone_name: string;\n}\n\nGot:\n"+w(g[0]));e.next=4;break;case 4:return n={},r={"TT-X-Organization-Key":l},i&&(n.attachment=i),e.next=9,this.httpClient.put("/v5/schedule_message/:id",{files:n,data:(0,k.default)({},n.attachment?null:{attachment:i},{body:s},d?{end_date:u}:null,d?{repeating:d}:null,{start_date:f,start_time:p},h?{template_id:h}:null,{timezone_name:y}),headers:r,timeout:!(i||h),urlParams:{id:c}});case 9:return a=e.sent,o=a.data,e.abrupt("return",o);case 12:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})}]),a((c=P).prototype,"delete",[o],(0,E.default)(c.prototype,"delete"),c.prototype),a(c.prototype,"downloadScheduledMessageFile",[i],(0,E.default)(c.prototype,"downloadScheduledMessageFile"),c.prototype),a(c.prototype,"find",[s],(0,E.default)(c.prototype,"find"),c.prototype),a(c.prototype,"update",[u],(0,E.default)(c.prototype,"update"),c.prototype),c);function P(){return(0,O.default)(this,P),(0,S.default)(this,(P.__proto__||(0,A.default)(P)).apply(this,arguments))}t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,d=r(n(3)),f=r(n(4)),p=r(n(5)),h=r(n(18)),y=r(n(10)),g=r(n(9)),v=r(n(6)),m=r(n(1)),b=r(n(2)),w=r(n(8)),_=r(n(7)),x=r(n(14)),E=(a=x.default,(0,_.default)(k,a),(0,b.default)(k,[{key:"findIntegrationIds",value:(u=(0,g.default)(y.default.mark(function e(t){var n,r;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=4;break;case 4:return n={Accept:"*","TT-X-Organization-Key":t},e.next=7,this.httpClient.post("/v1/integrations/scheduler/configs/info/org",{headers:n,data:{org:t}});case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"sendCsvSchedule",value:(s=(0,g.default)(y.default.mark(function e(t,n,r,a){var o,i,s,u;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "integrationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "file" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(r));e.next=6;break;case 6:if("string"!=typeof a)throw new TypeError('Value of argument "timezone" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(a));e.next=8;break;case 8:if("string"!=typeof t)throw new TypeError('Value of argument "integrationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=10;break;case 10:if("string"!=typeof n)throw new TypeError('Value of argument "file" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=12;break;case 12:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(r));e.next=14;break;case 14:if("string"!=typeof a)throw new TypeError('Value of argument "timezone" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(a));e.next=16;break;case 16:return o={"Content-Type":"text/csv","TT-X-Organization-Key":r,"TT-X-Integration-Id":t,"TT-X-Timezone":a},s=i=void 0,e.prev=19,e.next=22,this.httpClient.post("/v1/integrations/scheduler/webhook/csv",{data:n,headers:o});case 22:u=e.sent,i=u.data,s=u.status,e.next=35;break;case 27:if(e.prev=27,e.t0=e.catch(19),400!==e.t0.status){e.next=34;break}i=e.t0.response&&(e.t0.response.body||e.t0.response.text),s=e.t0.status,e.next=35;break;case 34:return e.abrupt("return",h.default.reject(e.t0));case 35:return e.abrupt("return",{json:i,status:s});case 36:case"end":return e.stop()}},e,this,[[19,27]])})),function(e,t,n,r){return s.apply(this,arguments)})},{key:"findCsv",value:(i=(0,g.default)(y.default.mark(function e(t,n){var r,a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.post("/v1/integrations/scheduler/webhook/csv/download",{headers:r,data:{org:t,id:n},resFormat:"text"});case 11:return a=e.sent,e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"clearSchedule",value:(o=(0,g.default)(y.default.mark(function e(t,n){var r,a;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={Accept:"*","TT-X-Organization-Key":t},e.next=11,this.httpClient.post("/v1/integrations/scheduler/configs/truncate",{headers:r,data:{id:n}});case 11:return a=e.sent,e.abrupt("return",a.status);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),k);function k(){return(0,m.default)(this,k),(0,w.default)(this,(k.__proto__||(0,v.default)(k)).apply(this,arguments))}t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(10)),u=r(n(9)),c=r(n(6)),l=r(n(1)),d=r(n(2)),f=r(n(8)),p=r(n(24)),h=r(n(7)),y=n(14),g=r(y),v=y.VERSIONS.VERSION_TWO,m=y.ROUTES.SEARCH_QUERY,b=(a=g.default,(0,h.default)(w,a),(0,d.default)(w,[{key:"query",value:(i=(0,u.default)(s.default.mark(function e(t){var n,r,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,p.default)(w.prototype.__proto__||(0,c.default)(w.prototype),"getVersion",this).call(this,m),r=n.version,a=void 0===r?v:r,e.next=3,this.httpClient.post("/:version/search",{data:t,urlParams:{version:a}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"patientQuery",value:(o=(0,u.default)(s.default.mark(function e(t){var n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v5/patient/search",{data:t});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}]),w);function w(){return(0,l.default)(this,w),(0,f.default)(this,(w.__proto__||(0,c.default)(w)).apply(this,arguments))}t.default=b,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,g.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,g.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,l,d,f,p,h=r(n(3)),y=r(n(4)),g=r(n(5)),w=r(n(10)),v=r(n(9)),_=r(n(6)),m=r(n(1)),b=r(n(2)),x=r(n(8)),E=r(n(24)),k=r(n(7)),T=n(14),I=r(T),A=T.VERSIONS.VERSION_TWO,O=T.ROUTES.TEAMS_CREATE,j=T.ROUTES.TEAMS_FIND,S=T.ROUTES.TEAMS_LEAVE,M=T.ROUTES.TEAMS_UPDATE,R=(a=I.default,(0,k.default)(z,a),(0,b.default)(z,[{key:"find",value:(p=(0,v.default)(w.default.mark(function e(t,n){var r,a,o,i,s=n.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=4;break;case 4:return r=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,j),a=r.version,o=void 0===a?A:a,e.next=7,this.httpClient.get("/:version/team/:team_id",{headers:{"TT-X-Organization-Key":s},urlParams:{team_id:t,version:o}});case 7:return i=e.sent,e.abrupt("return",i.data);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"create",value:(f=(0,v.default)(w.default.mark(function e(t){var n,r,a,o,i,s,u,c=t.avatar,l=t.canMembersLeave,d=void 0===l||l,f=t.canRequestToJoin,p=void 0===f||f,h=t.description,y=t.displayName,g=t.memberIds,v=void 0===g?[]:g,m=t.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,O),r=n.version,a=void 0===r?A:r,o={},i={can_members_leave:d,can_request_to_join:p,display_name:y,members:v},s={},c&&(s.avatar=c),h&&(i.description=h),m&&(o["TT-X-Organization-Key"]=m),e.next=9,this.httpClient.post("/:version/team",{urlParams:{version:a},headers:o,data:i,files:s});case 9:return u=e.sent,e.abrupt("return",u.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"update",value:(d=(0,v.default)(w.default.mark(function e(t){var n,r,a,o,i,s,u,c=t.avatar,l=t.canMembersLeave,d=void 0===l||l,f=t.canRequestToJoin,p=void 0===f||f,h=t.description,y=t.displayName,g=t.id,v=t.memberIds,m=void 0===v?[]:v,b=t.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,M),r=n.version,a=void 0===r?A:r,o={},i={can_members_leave:d,can_request_to_join:p,display_name:y,members:m},s={},c&&(s.avatar=c),h&&(i.description=h),b&&(o["TT-X-Organization-Key"]=b),e.next=9,this.httpClient.post("/:version/team/:id",{urlParams:{id:g,version:a},headers:o,data:i,files:s});case 9:return u=e.sent,e.abrupt("return",u.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"delete",value:(l=(0,v.default)(w.default.mark(function e(t,n){var r,a,o,i,s=n.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,O),a=r.version,o=void 0===a?A:a,e.next=3,this.httpClient.del("/:version/team/:id",{headers:{"TT-X-Organization-Key":s},urlParams:{version:o,id:t}});case 3:return i=e.sent,e.abrupt("return",i.status);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"requestToJoin",value:(s=(0,v.default)(w.default.mark(function e(t,n){var r,a,o,i,s=n.organizationId,u=n.requestedById;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,O),a=r.version,o=void 0===a?A:a,e.next=3,this.httpClient.post("/:version/team/:id/request",{headers:{"TT-X-Organization-Key":s},urlParams:{id:t,version:o},data:{requested_by:u}});case 3:return i=e.sent,e.abrupt("return",i.status);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"updateJoinRequest",value:(i=(0,v.default)(w.default.mark(function e(t,n){var r,a,o,i,s=n.organizationId,u=n.teamId,c=n.handledAsId,l=n.status;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,O),a=r.version,o=void 0===a?A:a,e.next=3,this.httpClient.post("/:version/team/:team_id/request/:request_id",{headers:{"TT-X-Organization-Key":s},urlParams:{version:o,team_id:u,request_id:t},data:{handled_as:c,status:l}});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"leave",value:(o=(0,v.default)(w.default.mark(function e(t,n){var r,a,o,i,s=n.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,E.default)(z.prototype.__proto__||(0,_.default)(z.prototype),"getVersion",this).call(this,S),a=r.version,o=void 0===a?A:a,e.next=3,this.httpClient.post("/:version/team/:team_id/leave",{headers:{"TT-X-Organization-Key":s},urlParams:{team_id:t,version:o},data:{}});case 3:return i=e.sent,e.abrupt("return",i.status);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),z);function z(){return(0,m.default)(this,z),(0,x.default)(this,(z.__proto__||(0,_.default)(z)).apply(this,arguments))}t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,d.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,l.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,d.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,l.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l=r(n(3)),d=r(n(4)),f=r(n(5)),p=r(n(10)),h=r(n(9)),y=r(n(6)),g=r(n(1)),v=r(n(2)),m=r(n(8)),b=r(n(7)),w=r(n(14)),_=(a=w.default,(0,b.default)(x,a),(0,v.default)(x,[{key:"getTwilioNumbers",value:(c=(0,h.default)(p.default.mark(function e(t,n){var r,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "areaCode" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "areaCode" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.post("/v2/twilio/numbers",{headers:r,data:{area_code:n}});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"assignPagerNumber",value:(u=(0,h.default)(p.default.mark(function e(t,n,r){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":t},e.next=15,this.httpClient.post("/v2/user/:roleToken/organization/:organizationId/pagers?process_number=true",{headers:a,urlParams:{organizationId:t,roleToken:r},data:{pager_numbers:n}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"removePagerNumber",value:(o=(0,h.default)(p.default.mark(function e(t,n,r){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":t},e.next=15,this.httpClient.del("/v2/user/:roleToken/organization/:organizationId/pagers/:number?process_number=true",{headers:a,urlParams:{organizationId:t,roleToken:r,number:n}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})}]),x);function x(){return(0,g.default)(this,x),(0,m.default)(this,(x.__proto__||(0,y.default)(x)).apply(this,arguments))}t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,d.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,l.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,c.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,d.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,l.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,c.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c=r(n(3)),l=r(n(4)),d=r(n(5)),f=r(n(10)),p=r(n(9)),h=r(n(6)),y=r(n(1)),g=r(n(2)),v=r(n(8)),m=r(n(7)),b=r(n(14)),w=(a=b.default,(0,m.default)(_,a),(0,g.default)(_,[{key:"startTyping",value:(u=(0,p.default)(f.default.mark(function e(t,n,r){var a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return a={recipient:t},n&&n!==this.host.currentUserId&&(a.proxy_token=n),e.next=16,this.httpClient.post("/v2/message/typing",{data:a,headers:{"TT-X-Organization-Key":r}});case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"stopTyping",value:(o=(0,p.default)(f.default.mark(function e(t,n){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+i(n));e.next=8;break;case 8:if(n)return e.next=11,this.httpClient.del("/v2/message/typing/:recipientId/:senderId",{urlParams:{recipientId:t,senderId:n}});e.next=13;break;case 11:e.next=15;break;case 13:return e.next=15,this.httpClient.del("/v2/message/typing/:recipientId",{urlParams:{recipientId:t}});case 15:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),_);function _(){return(0,y.default)(this,_),(0,v.default)(this,(_.__proto__||(0,h.default)(_)).apply(this,arguments))}t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l,d,f,p,h,y,g=r(n(3)),v=r(n(4)),m=r(n(5)),b=r(n(11)),w=r(n(10)),_=r(n(9)),x=r(n(6)),E=r(n(1)),k=r(n(2)),T=r(n(8)),I=r(n(7)),A=n(14),O=r(A),j=(a=(0,A.recoverFromNotFound)(),h=O.default,(0,I.default)(S,h),(0,k.default)(S,[{key:"findAll",value:(y=(0,_.default)(w.default.mark(function e(t,n){var r;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.get("/v2/user/:userId/organization/:organizationId/roles",{urlParams:{userId:t,organizationId:n}});case 10:return r=e.sent,e.abrupt("return",r.data.roles);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})}]),u=(o=S).prototype,c="findAll",l=[a],d=(0,b.default)(o.prototype,"findAll"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(u,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(u,c,p),p=null),o);function S(){return(0,E.default)(this,S),(0,T.default)(this,(S.__proto__||(0,x.default)(S)).apply(this,arguments))}t.default=j,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,M.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,S.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,j.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function E(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,M.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=E(t[0],n);return t.every(function(e){return E(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return E(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,S.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,j.default)(e))+": "+E(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,k,T,I,A,O,j=r(n(3)),S=r(n(4)),M=r(n(5)),R=r(n(11)),z=r(n(16)),C=r(n(10)),P=r(n(9)),V=r(n(6)),G=r(n(1)),N=r(n(2)),U=r(n(8)),F=r(n(24)),$=r(n(7)),D=n(14),q=r(D),L=r(n(87)),B=r(n(84)),K=r(n(86)),Z=n(32),H=n(28),W=r(n(27)),X=D.VERSIONS.VERSION_TWO,Q=D.ROUTES.USER_FIND,Y=D.ROUTES.USER_FIND_ME,J=new K.default.MD5,ee=(o=(0,D.recoverFromNotFound)({httpStatusCodes:[400]}),i=(0,D.recoverFromNotFound)(),s=(0,D.recoverFromNotFound)(),u=(0,D.recoverFromNotFound)(),l=q.default,(0,$.default)(te,l),(0,N.default)(te,[{key:"getAnonymousAuthHeader",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "udid" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(e));if("string"!=typeof e)throw new TypeError('Value of argument "udid" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));var t=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=[t,n,e].join(":"),a=J.hex(r),o=[a.substr(0,2),a.substr(a.length-2)].join(""),i=[this.config.productKey,t,n,e,o].join(":");return"XMPP-Anonymous "+(0,B.default)(i)}},{key:"getSignInAuthHeader",value:function(){var e;return(e=this.constructor).getSignInAuthHeader.apply(e,arguments)}},{key:"checkLogin",value:(O=(0,P.default)(C.default.mark(function e(t,n){var r,a,o;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={Authorization:this.getAnonymousAuthHeader(n.udid)},a={device:n.udid,tt_product_version:this.config.partnerName},(0,H.isPhone)(t)?a.phones=(0,H.normalizePhoneUS)(t):a.emails=t,e.next=5,this.httpClient.get("/v4/login_check",{headers:r,query:a});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"signUp",value:(A=(0,P.default)(C.default.mark(function e(t){var n,r,a;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={Authorization:this.getAnonymousAuthHeader(t.udid)},r={primary_email:t.email,unique_id:t.email,password:t.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:t.countryCode,device_id:t.udid,version:this.config.version},e.next=4,this.httpClient.post("/v2/signup",{headers:n,data:r});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"signIn",value:(I=(0,P.default)(C.default.mark(function e(t,n){var r,a,o,i,s,u,c;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={device_id:n.udid,metadata:{device_type:"js_sdk",device_version:"11.7.0-beta1",tt_product_version:this.config.partnerName,user_agent:global.navigator&&global.navigator.userAgent},push_routing:this.config.pushAgent,version:this.config.version,want_condensed_replays:this.config.wantCondensedReplays,want_processing_events:this.config.wantCondensedReplays},e.next=3,this.httpClient.post("/v5/login",{headers:t,data:r});case 3:return(a=e.sent).data&&a.data.settings&&(o=a.data.settings,i=o.condensed_replays,s=void 0!==i&&i,u=o.processing_events,c=void 0!==u&&u,this.host.configure({condensedReplays:s,processingEvents:c})),e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"signOut",value:(T=(0,P.default)(C.default.mark(function e(){var t;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v2/logout");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"lookup",value:(k=(0,P.default)(C.default.mark(function e(t){var n,r,a,o,i;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return n=(0,F.default)(te.prototype.__proto__||(0,V.default)(te.prototype),"getVersion",this).call(this,Q),r=n.version,a=void 0===r?X:r,o={display_name:t},(0,Z.isEmail)(t)?o.email_address=t:(0,H.isPhone)(t)&&(o.phone_number=(0,H.normalizePhoneUS)(t)),e.next=9,this.httpClient.post("/:version/user_lookup/:id",{urlParams:{id:t,version:a},data:o});case 9:return i=e.sent,e.abrupt("return",i.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"wipe",value:(_=(0,P.default)(C.default.mark(function e(t){var n;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return e.next=6,this.httpClient.post("/v2/wipe",{data:{},query:{token:t}});case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"find",value:(w=(0,P.default)(C.default.mark(function e(t){var n,r,a,o,i,s=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return n=(0,F.default)(te.prototype.__proto__||(0,V.default)(te.prototype),"getVersion",this).call(this,Q),r=n.version,a=void 0===r?X:r,(0,Z.isEmail)(t)&&(t=t.toLowerCase()),o=s?{"TT-X-Organization-Key":s}:null,e.next=9,this.httpClient.get("/:version/user/:id",{headers:o,urlParams:{id:t,version:a},query:{render_metadata:!0}});case 9:return i=e.sent,e.abrupt("return",i.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"findMe",value:(b=(0,P.default)(C.default.mark(function e(){var t,n,r,a,o,i=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,F.default)(te.prototype.__proto__||(0,V.default)(te.prototype),"getVersion",this).call(this,Y),n=t.version,r=void 0===n?X:n,a=i?{"TT-X-Organization-Key":i}:null,e.next=4,this.httpClient.get("/:version/user",{headers:a,query:{render_metadata:!0},urlParams:{version:r}});case 4:return o=e.sent,e.abrupt("return",o.data);case 6:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"update",value:(m=(0,P.default)(C.default.mark(function e(t,n){var r,a,o,i=n.firstName,s=void 0===i?void 0:i,u=n.lastName,c=void 0===u?void 0:u,l=n.displayName,d=void 0===l?void 0:l,f=n.status,p=void 0===f?void 0:f,h=n.dnd,y=void 0===h?void 0:h,g=n.dndText,v=void 0===g?void 0:g,m=n.avatarFile,b=void 0===m?void 0:m,w=n.removeAvatar,_=void 0===w?void 0:w;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return a={},_?a.avatar=null:b&&(a.avatar=b),o=(r={first_name:s,last_name:c,display_name:d,status:p,dnd:y,dnd_text:v},L.default).call(r,function(e,t){return void 0===e}),e.next=9,this.httpClient.post("/v2/user/:id/settings",{urlParams:{id:t},data:o,files:a});case 9:return e.abrupt("return",(0,z.default)({id:t},b&&b.preview?{avatarUrl:b.preview}:null));case 10:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"updatePassword",value:(v=(0,P.default)(C.default.mark(function e(t,n,r,a){var o,i;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(r));e.next=6;break;case 6:if("string"!=typeof a)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(a));e.next=8;break;case 8:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=10;break;case 10:if("string"!=typeof n)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=12;break;case 12:if("string"!=typeof r)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(r));e.next=14;break;case 14:if("string"!=typeof a)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(a));e.next=16;break;case 16:return o={Authorization:this.getSignInAuthHeader(a,t,n)},e.next=19,this.httpClient.post("/v2/user/:id/password",{urlParams:{id:t},headers:o,data:{password:r}});case 19:return i=e.sent,e.abrupt("return",i);case 21:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return v.apply(this,arguments)})},{key:"setAutoForward",value:(g=(0,P.default)(C.default.mark(function e(t,n,r){var a,o=r.dnd,i=r.receiverId,s=arguments;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if(null==s[2]||"boolean"!=typeof s[2].dnd||"string"!=typeof s[2].receiverId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  dnd: boolean;\n  receiverId: string;\n}\n\nGot:\n"+E(s[2]));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=10;break;case 10:if(null==s[2]||"boolean"!=typeof s[2].dnd||"string"!=typeof s[2].receiverId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  dnd: boolean;\n  receiverId: string;\n}\n\nGot:\n"+x(s[2]));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/user/:userId/organization/:organizationId",{urlParams:{userId:t,organizationId:n},data:{dnd:o,dnd_auto_forward_receiver:i}});case 14:return a=e.sent,e.abrupt("return",a);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return g.apply(this,arguments)})},{key:"removeAutoForward",value:(y=(0,P.default)(C.default.mark(function e(t,n){var r;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v2/user/:userId/organization/:organizationId/dnd_auto_forward_receiver",{urlParams:{userId:t,organizationId:n}});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"setAwayMessage",value:(h=(0,P.default)(C.default.mark(function e(t,n,r){var a=r.dnd,o=r.dndText,i=arguments;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if(null==i[2]||"boolean"!=typeof i[2].dnd||void 0!==i[2].dndText&&null!=i[2].dndText&&"string"!=typeof i[2].dndText)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  dnd: boolean;\n  dndText?: ?string;\n}\n\nGot:\n"+E(i[2]));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=10;break;case 10:if(null==i[2]||"boolean"!=typeof i[2].dnd||void 0!==i[2].dndText&&null!=i[2].dndText&&"string"!=typeof i[2].dndText)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  dnd: boolean;\n  dndText?: ?string;\n}\n\nGot:\n"+x(i[2]));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v5/user/:userId/organization/:organizationId",{urlParams:{userId:t,organizationId:n},data:{network:{patient:{dnd:a,dnd_text:o}}}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"setEulaAccepted",value:(p=(0,P.default)(C.default.mark(function e(t,n,r){var a;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if("boolean"!=typeof r)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+E(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=10;break;case 10:if("boolean"!=typeof r)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+x(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/user/:userId/organization/:organizationId",{urlParams:{userId:t,organizationId:n},data:{eula:!r}});case 14:return a=e.sent,e.abrupt("return",a);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"getPreferences",value:(f=(0,P.default)(C.default.mark(function e(t){var n;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.get("/v2/user/:userId/preferences",{urlParams:{userId:t}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"editPreferences",value:(d=(0,P.default)(C.default.mark(function e(t){var n,r=t.organizationId,a=t.quickReplies,o=t.userId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v2/user/:userId/preferences",{headers:{"TT-X-Organization-Key":r},data:W.default.underscoreObject({quickReplies:a}),urlParams:{userId:o}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));var r=[e,t,n].join(":");return"XMPP-Simple "+(0,B.default)(r)}}]),a((c=te).prototype,"lookup",[o],(0,R.default)(c.prototype,"lookup"),c.prototype),a(c.prototype,"find",[i],(0,R.default)(c.prototype,"find"),c.prototype),a(c.prototype,"getPreferences",[s],(0,R.default)(c.prototype,"getPreferences"),c.prototype),a(c.prototype,"editPreferences",[u],(0,R.default)(c.prototype,"editPreferences"),c.prototype),c);function te(){return(0,G.default)(this,te),(0,U.default)(this,(te.__proto__||(0,V.default)(te)).apply(this,arguments))}t.default=ee,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Users=t.UserRoles=t.TypingStatus=t.Twilio=t.Teams=t.Search=t.ScheduledMessages=t.Scheduler=t.Roster=t.RoleTags=t.Roles=t.Reporting=t.QRCode=t.Patients=t.Organizations=t.Notifications=t.Mute=t.Metadata=t.MessageTemplates=t.Messages=t.Groups=t.Events=t.Escalations=t.Entities=t.DistributionLists=t.Conversations=t.Calls=void 0;var a=r(n(96)),o=r(n(97)),i=r(n(98)),s=r(n(99)),u=r(n(100)),c=r(n(101)),l=r(n(102)),d=r(n(104)),f=r(n(103)),p=r(n(105)),h=r(n(106)),y=r(n(107)),g=r(n(108)),v=r(n(109)),m=r(n(110)),b=r(n(111)),w=r(n(113)),_=r(n(112)),x=r(n(114)),E=r(n(116)),k=r(n(115)),T=r(n(117)),I=r(n(118)),A=r(n(119)),O=r(n(120)),j=r(n(121)),S=r(n(122));t.Calls=a.default,t.Conversations=o.default,t.DistributionLists=i.default,t.Entities=s.default,t.Escalations=u.default,t.Events=c.default,t.Groups=l.default,t.Messages=d.default,t.MessageTemplates=f.default,t.Metadata=p.default,t.Mute=h.default,t.Notifications=y.default,t.Organizations=g.default,t.Patients=v.default,t.QRCode=m.default,t.Reporting=b.default,t.Roles=w.default,t.RoleTags=_.default,t.Roster=x.default,t.Scheduler=E.default,t.ScheduledMessages=k.default,t.Search=T.default,t.Teams=I.default,t.Twilio=A.default,t.TypingStatus=O.default,t.UserRoles=j.default,t.Users=S.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="connection-unavailable",o);function f(){(0,u.default)(this,f);var e=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,"No internet connection"));return e.code=f.CODE,e}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="not-found",o);function f(e,t,n){(0,u.default)(this,f),n=n||e+" '"+t+"' not found";var r=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,n));return r.code=f.CODE,r.resource=e,r.id=t,r}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="not-signed-in",o);function f(){var e;(0,u.default)(this,f);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=(0,c.default)(this,(e=f.__proto__||(0,s.default)(f)).call.apply(e,[this].concat(n)));return a.code=f.CODE,a}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="not-supported",o);function f(e){(0,u.default)(this,f);var t=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,e));return t.code=f.CODE,t}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="permission-denied",o);function f(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"can't perform action '"+n+"' on "+(e.name||e)+" #"+t;(0,u.default)(this,f);var a=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,r));return a.code=f.CODE,a.resource=e,a.action=n,a.id=t,a}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="requires-basic-auth",o);function f(){var e;(0,u.default)(this,f);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=(0,c.default)(this,(e=f.__proto__||(0,s.default)(f)).call.apply(e,[this].concat(n)));return a.code=f.CODE,a}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(2)),l=r(n(8)),d=r(n(7)),f=(i=Error,(0,d.default)(p,i),(0,c.default)(p,null,[{key:"raise",value:function(e){throw new this(e)}}]),o=a=p,a.CODE="target-not-supported",o);function p(e){return(0,u.default)(this,p),(0,l.default)(this,(p.__proto__||(0,s.default)(p)).call(this,"method"+(e?" "+e:"")+" not supported in target node"))}t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(6)),u=r(n(1)),c=r(n(8)),l=r(n(7)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="wrong-credentials",o);function f(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,u.default)(this,f);for(var n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=(0,c.default)(this,(e=f.__proto__||(0,s.default)(f)).call.apply(e,[this].concat(r))),i=t.tt_login_attempts_left;return o.code=f.CODE,o.loginAttemptsLeft=void 0===i?null:i,o}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(30));t.default=function(e,t){return t.host,e.defineModel("call",{replaceKeys:{},defaultValues:{},skipCamelizationForKeys:["payload"],parseAttrs:function(e){if(e.id||(e.id=e.roomName),e.payload){var t={};e.payload.disabled_participants&&(t=e.payload.disabled_participants,delete e.payload.disabled_participants),e.payload=o.default.camelizeObject(e.payload),e.payload.disabledParticipants=t}return e.payload&&(e.payload.orgId&&(e.organizationId=e.payload.orgId),e.payload.callId&&(e.callId=e.payload.callId),e.payload.groupId&&(e.groupId=e.payload.groupId),e.payload.participantsTokens&&e.payload.callerId&&(e.memberIds=[].concat((0,a.default)(e.payload.participantsTokens),[e.payload.callerId]))),delete e.serverId,e}})};var o=r(n(27));e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(4));t.default=function(p,e){var h=e.host;return p.defineModel("conversation",{instanceEvents:!0,transientAttrs:["_counterPartyAddedOnServer","_origIndex","highestSortNumber","unreadCount","unreadPriorityCount"],defaultValues:{_markingAsRead:!1,_markingAsReadSortNumber:null,_markingAsReadExpiration:null,firstExpiringUnreadMessage:null,firstUnreadMessage:null,higherContinuation:null,highestSortNumber:0,inProgressEscalationCount:0,isLive:!1,lastBangMessageSortNumber:0,lastIncomingMessageSortNumber:0,lastMessage:null,lowerContinuation:null,markableAsReadMessages:null,messages:null,muted:null,network:g.default.PROVIDER,timeline:null,unreadCount:0,unreadPriorityCount:0},skipCamelizationForKeys:["metadata","muted"],parseAttrs:function(e){if("muted"in e&&e.muted){var t=e.muted;if(0<(0,o.default)(t).length){var n=t.mute_duration,r=t.mute_start;r=r&&1e3*+r;var a=h.mute._addEntry(e.id,{durationInMinutes:n,organizationId:e.organizationId,startedAt:r});e.muted=a}else e.muted=null}return e},afterAssignment:function(e){var t=e.counterParty,n=e.counterPartyId,r=e.counterPartyType,a=e.id,o=e.isDeletable,i=e.isMuteable,s=e.metadata,u=e.muted;if(u=p.host.config.condensedReplays?u||h.mute.getById(a):h.mute._getByConversationHandle(a),e.muted=u,e.isMuted=!!e.muted,t?(n=t.id,r=t.$entityType):t=r&&n?p.store.get(r,n):null,e.counterParty=t,e.counterPartyId=n,e.counterPartyType=r,e.shouldDisplay=!("user"===r&&t&&!t.shouldDisplay),h.conversations._setAllowedSenders(e),o=!0,i="distributionList"!==r,t&&"group"===r){var c=t,l=c.groupType,d=c.p2pSender;if(l===y.default.ROLE_P2P){var f=d&&"role"===d.$entityType;o=0<e.allowedSenders.length&&!f,i=i&&0<e.allowedSenders.length}else l===y.default.ESCALATION?i=!(o=!1):l===y.default.PATIENT_MESSAGING&&(o=2<e.counterParty.memberCount)}else t&&"team"===r&&(i=o=!1);e.isDeletable=o,e.isMuteable=i,e.markableAsReadMessages||(e.markableAsReadMessages=[]),e.messages||(e.messages=[]),e.timeline||(e.timeline=[]),e.higherContinuation||(e.higherContinuation={continuation:p.host.config.condensedReplays?{higher_continuation:null}:"HIGHER",itemsEstimate:null}),e.lowerContinuation||(e.lowerContinuation={continuation:p.host.config.condensedReplays?{lower_continuation:null}:"LOWER",itemsEstimate:null}),s&&"patient_messaging"===s.feature_service&&(e.network=g.default.PATIENT,"group"===r&&(e.patientId="patient:"+s.patient_id,s.patient_contact_id&&(e.patientContactId="patientContact:"+s.patient_contact_id)))},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}},hasMany:{content:{type:"message",foreignKey:"conversationId",sortBy:[["sortNumber","asc"],["id","asc"]]}}}})};var y=r(n(48)),g=r(n(69));e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("distributionList",{replaceKeys:{avatar:"avatarUrl",createdBy:"createdById",displayName:"name",organizationKey:"organizationId",totalMembers:"memberCount",updatedBy:"updatedById"},skipCamelizationForKeys:["metadata"],transientAttrs:["$deleted"],defaultValues:{memberCount:0},afterAssignment:function(e){e.displayName=e.name},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},organization:{type:"organization",foreignKey:"organizationId"},updatedBy:{type:"user",foreignKey:"updatedById"}}}});return(0,o.default)(n,{finder:function(){var e;return(e=t.host.distributionLists).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Distribution List..."},defaultNotFoundAttrs:{name:"<Distribution List Not Found>"}}),n};var r,a=n(37),o=(r=a)&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function E(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=E(t[0],n);return t.every(function(e){return E(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return E(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+E(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(3)),s=r(n(4)),u=r(n(5)),k=r(n(12)),T=r(n(13));t.default=function(e,t){var _=t.host;return e.defineModel("escalationExecution",{replaceKeys:{destructionDuration:"minutesToExpire",destructionTime:"expiresAt",displayName:"displayId",escalationExecutionId:"id",escalationGroupToken:"groupId",escalationPath:"path",escalationStatus:"status",level:"currentStep",organizationToken:"organizationId",targetDuration:"targetMinutesToAcknowledge",targetToken:"targetId",triggeredMessageToken:"carbonCopyMessageId",triggeringConversationId:"originalGroupConversationId",triggeringMessageToken:"originalMessageId"},defaultValues:{currentStep:0,status:I.default.IN_PROGRESS},parseAttrs:function(e){if("actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),"carbonCopyMessageId"in e&&"string"==typeof e.carbonCopyMessageId&&"undefined"===e.carbonCopyMessageId&&(e.carbonCopyMessageId=null),"displayId"in e&&(e.displayId.startsWith("#")&&(e.displayId=e.displayId.slice(1)),e.displayId=e.displayId.toUpperCase()),"expiresAt"in e&&"string"==typeof e.expiresAt&&(e.expiresAt=new Date(e.expiresAt).getTime()),"groupId"in e&&"string"==typeof e.groupId&&"undefined"===e.groupId&&(e.groupId=null),"path"in e){var t=[],n=!1;if(!(u=e.path)||"function"!=typeof u[T.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+x(u));if(!u||"function"!=typeof u[T.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+E(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,k.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=i.value,l=c.targets,d=c.duration,f=[];if(!l||"function"!=typeof l[T.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+x(l));if(!l||"function"!=typeof l[T.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+E(l));var p=!0,h=!1,y=void 0;try{for(var g,v=(0,k.default)(l);!(p=(g=v.next()).done);p=!0){var m=g.value;if("string"==typeof m)f.push(_.injectPlaceholderModel({id:m},"user"));else if(m&&m.token){var b=m.displayName,w=m.token;f.push(_.injectPlaceholderModel({id:w,displayName:b},"user"))}else n=!0}}catch(e){h=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw y}}t.push({minutesToAcknowledge:d,targets:f})}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}n?delete e.path:e.path=t}return"status"in e&&("init"===e.status&&(e.status="in_progress"),"destruct"===e.status&&(e.status="cancelled"),e.status=I.default.resolve(e.status)),e},afterAssignment:function(e){},relations:{belongsTo:{carbonCopyMessage:{type:"message",foreignKey:"carbonCopyMessageId"},group:{type:"group",foreignKey:"groupId"},organization:{type:"organization",foreignKey:"organizationId"},originalConversation:{type:"conversation",foreignKey:"originalGroupConversationId"},originalMessage:{type:"message",foreignKey:"originalMessageId"},target:{type:"user",foreignKey:"targetId"},escalationGroupConversation:{type:"conversation",foreignKey:"escalationGroupConversationId"}}}})};var I=r(n(68));e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("escalationExecutionChange",{parseAttrs:function(e){return"actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),e}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function E(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=E(t[0],n);return t.every(function(e){return E(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return E(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+E(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(3)),s=r(n(4)),u=r(n(5)),k=r(n(12)),T=r(n(13));t.default=function(e,t){var _=t.host;return e.defineModel("escalationPolicy",{replaceKeys:{destructionDuration:"minutesToExpire",escalationPath:"path",target:"targetId",targetDuration:"targetMinutesToAcknowledge"},defaultValues:{alwaysEscalate:!1},parseAttrs:function(e){if("path"in e){var t=[],n=!1;if(!(u=e.path)||"function"!=typeof u[T.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+x(u));if(!u||"function"!=typeof u[T.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+E(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,k.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=i.value,l=c.targets,d=c.duration,f=[];if(!l||"function"!=typeof l[T.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+x(l));if(!l||"function"!=typeof l[T.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+E(l));var p=!0,h=!1,y=void 0;try{for(var g,v=(0,k.default)(l);!(p=(g=v.next()).done);p=!0){var m=g.value;if("string"==typeof m)f.push(_.injectPlaceholderModel({id:m},"user"));else if(m&&m.token){var b=m.displayName,w=m.token;f.push(_.injectPlaceholderModel({id:w,displayName:b},"user"))}else n=!0}}catch(e){h=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw y}}t.push({minutesToAcknowledge:d,targets:f})}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}n?delete e.path:e.path=t}return e},afterAssignment:function(e){},relations:{belongsTo:{target:{type:"user",foreignKey:"targetId"}}}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),o=((0,r(n(2)).default)(i,null,[{key:"is",value:function(e){return e instanceof this}}]),i);function i(e,t,n){(0,a.default)(this,i),this.id=e,this.type=t,this.data=n}t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var f=r(n(3)),p=r(n(4)),h=r(n(5)),y=r(n(12)),g=r(n(13));t.default=function(e,t){var d=t.host,n=e.defineModel("group",{replaceKeys:{avatar:"avatarUrl",createdTime:"createdAt",displayName:"name",members:"memberIds",numMembers:"__memberCount",organizationKey:"organizationId",proxied_members:"proxiedMembers"},transientAttrs:["__memberCount"],defaultValues:{hasCurrentUser:!1,isPublic:!1,memberIds:null},skipCamelizationForKeys:["escalation","metadata","proxied_members"],parseAttrs:function(e){if("createdAt"in e&&(e.createdAt=new Date(e.createdAt)),"createdBy"in e&&delete e.createdBy,e.avatarUrl&&(e.avatarUrl=(0,v.cloudFrontUrlTransform)(e.avatarUrl,d.config)),"escalation"in e){var t=d.escalations._updateEscalation(e.escalation,{inGroupInject:!0});delete e.escalation,e.escalationExecutionId=t.id}if(e.memberIds){var n=[];if(!(u=e.memberIds)||"function"!=typeof u[g.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$memberIds to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,h.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,p.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,f.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(u));if(!u||"function"!=typeof u[g.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$memberIds to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,h.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,p.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,f.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,y.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=i.value;"string"==typeof c?n.push(c):c.id&&n.push(c.id)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}e.memberIds=n}if(e.metadata&&"patient_care"===e.metadata.feature_service&&(e.patientDetails=e.metadata.patient),e.metadata&&"patient_messaging"===e.metadata.feature_service&&(e.patientDetails={dob:e.metadata.patient_dob,gender:e.metadata.patient_gender,id:e.metadata.patient_id,isPatientContact:e.metadata.is_patient_contact,mrn:e.metadata.patient_mrn,name:e.metadata.patient_name,phoneNumber:e.metadata.phone_number,smsOptedOut:e.metadata.sms_opted_out},e.patientDetails.isPatientContact&&e.metadata.relation_name&&(e.patientDetails.relationName=e.metadata.relation_name)),e.metadata)if(e.metadata.team&&(e.metadata.team.token||e.metadata.team.id)){var l=d.models.Team.inject(e.metadata.team);l&&(e.teamId=l.id)}else e.metadata.team_token&&(e.teamId=e.metadata.team_token);return"metadata"in e&&delete e.metadata,e},afterAssignment:function(e){var t=e.id,n=e.memberIds,r=e.organizationId,a=void 0;d.config.condensedReplays?e.conversationId&&(a=d.conversations.getById(e.conversationId)):a=r?d.conversations.get("group",t,r):null;var o=r?d.metadata.get(t,r):null;o=o&&o.data;var i=d.groups.__extractGroupTypeFromAttrs(e),s=o&&i===u.GroupType.ROLE_P2P?o.target_display_name:e.name;e.conversation=a,e.displayName=s,e.groupType=i,e.memberCount=n&&n.length||e.__memberCount||0,e.metadata=o,"FORUM"!==i&&delete e.hasCurrentUser,d.users._setMembersOnEntity(e),d.groups._setMembership(e),d.groups._setP2PEntities(e)},beforeCreateInstance:function(e){!function(e,t,n){t&&0!==t.length&&d.groups.ensureMembersWithIds(e,t,{onlyPlaceholder:!0,attrs:{organizationId:n}})}(e.id,e.memberIds,e.organizationId)},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},escalationExecution:{type:"escalationExecution",foreignKey:"escalationExecutionId"},team:{type:"team",foreignKey:"teamId"}}}});return(0,a.default)(n,{finder:function(){var e;return(e=d.groups).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return d.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return d.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading group..."},defaultNotFoundAttrs:{displayName:"<Group Not Found>"},shouldEnsure:function(e,t,n){var r=n.groupMembersOnlyPlaceholder;return!e.members||!e.metadata||e.groupType===u.GroupType.ROLE_P2P||e.members.some(function(e){return d.models.User.shouldEnsure(e,r)})}}),n};var a=r(n(37)),v=n(73),u=n(26);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("groupMembersChange",{parseAttrs:function(e){return"actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),e}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var z=r(n(3)),C=r(n(4)),P=r(n(5)),V=r(n(12)),G=r(n(13)),N=r(n(256));t.default=function(d,e){var R=e.host;return d.defineModel("message",{replaceKeys:{clientId:"id",createdTime:"createdAt",data:"metadata",dndAutoForwardedFrom:"autoForwardedFromId",dor:"deleteOnRead",escalationExecId:"escalationExecutionId",groupAvatar:"groupAvatarUrl",groupToken:"groupId",messageId:"id",originalData:"originalMetadata",originalMsgId:"originalMessageId",originalSenderName:"originalSenderDisplayName",originalTimestamp:"originalForwardedMessageCreatedAt",recipient:"recipientId",recipientOrganization:"recipientOrganizationId",recipientOrgToken:"recipientOrganizationId",recipientToken:"recipientId",sender:"senderId",senderAvatar:"senderAvatarUrl",senderOrganization:"senderOrganizationId",senderOrgToken:"senderOrganizationId",senderToken:"senderId"},transientAttrs:["__organizationId","$synced","escalationExecutionChange","groupMembersChange","inTimeline"],defaultValues:{inTimeline:!1,isUnread:!1,messageType:U.MessageType.USER_SENT,senderStatus:U.MessageRecipientStatus.NEW,shouldEnsureRecipientStatus:!1,sortNumber:0},skipCamelizationForKeys:["escalation","metadata","originalMetadata"],parseAttrs:function(e){if(e.teamRequest&&(e.senderId||(e.senderId=e.teamRequest.createdById),e.teamRequestId=e.teamRequest.id,delete e.teamRequest),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,"undefined"!==t&&Array.isArray(e.attachments)&&0<e.attachments.length&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),"priority"in e&&(e.priority=U.MessagePriority.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"expireIn"in e&&(e.expiresAt=Date.now()+1e3*e.expireIn,delete e.expireIn),"recipientStatus"in e&&delete e.recipientStatus,"status"in e&&delete e.status,"xmlns"in e&&delete e.xmlns,"escalation"in e){var n=R.escalations._updateEscalation(e.escalation);delete e.escalation,e.escalationExecutionId=n.id}if("subType"in e&&(e.subType=U.MessageSubType.resolve(e.subType)),e.metadata){e.metadata=(0,N.default)(e.metadata).map(R.metadata.__parseMessageMetadata).filter(Boolean);var r=e.metadata.find(function(e){return"tigertext:message:role:sender"===e.namespace}),a=e.metadata.find(function(e){return"tigertext:message:role:owner"===e.namespace}),o=e.metadata.find(function(e){return"tigertext:message:patient_care"===e.namespace});if(r&&r.payload){var i=e.senderOrganizationId,s=r.payload;e.senderRole=R.roles.__parseRoleFromMetadata({metadata:s,organizationId:i}),e.currentSenderRoleId=e.senderRole.id}if(a&&a.payload){var u=e.senderOrganizationId,c=e.senderId,l=a.payload;e.senderId=l.token,c!==l.token&&(e.senderRole={$entityType:"role",botUserId:c,id:"role:"+c,organizationId:u},e.currentSenderRoleId="role:"+c)}if(o&&o.payload){var d=[];if(!(v=o.payload.components)||"function"!=typeof v[G.default]&&!Array.isArray(v))throw new TypeError("Expected _patientCareAttrs$pay to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,P.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,C.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,z.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(v));if(!v||"function"!=typeof v[G.default]&&!Array.isArray(v))throw new TypeError("Expected _patientCareAttrs$pay to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,P.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,C.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,z.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(v));var f=!0,p=!1,h=void 0;try{for(var y,g=(0,V.default)(v);!(f=(y=g.next()).done);f=!0){var v,m=y.value;"type"in m&&(m.type=U.PatientCareCardUIType.resolve(m.type)),"sub_type"in m&&(m.sub_type=U.PatientCareCardType.resolve(m.sub_type)),"action_type"in m&&(m.action_type=U.PatientCareCardActionType.resolve(m.action_type)),d.push(m)}}catch(e){p=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw h}}e.patientCareCard=d}}else"metadata"in e&&delete e.metadata;if(e.originalMetadata){e.originalMetadata=(0,N.default)(e.originalMetadata).map(R.metadata.__parseMessageMetadata).filter(Boolean);var b=e.originalMetadata.find(function(e){return"tigertext:message:role:sender"===e.namespace}),w=e.originalMetadata.find(function(e){return"tigertext:message:role:owner"===e.namespace}),_=e.originalMetadata.find(function(e){return"tigertext:message:patient_messaging"===e.namespace});if(b&&b.payload){var x=e.senderOrganizationId,E=b.payload;e.originalSenderRole=R.roles.__parseRoleFromMetadata({metadata:E,organizationId:x})}if(w&&w.payload){var k=e.originalSender,T=e.originalSenderDisplayName,I=e.originalSenderRole,A=e.senderOrganizationId,O=w.payload;I||"string"!=typeof k||(e.originalSenderRole={$entityType:"role",botUserId:k,displayName:T,id:"role:"+k,organizationId:A}),(!k||k&&"string"==typeof k)&&(e.originalSender={$entityType:"user",displayName:O.display_name,id:O.token,organizationId:A})}"isForwarded"in e&&e.isForwarded&&_&&(e.isForwardedFromPatientNetwork=!0,_.payload&&(e.patientDetails={isPatientContact:_.payload.is_patient_contact,mrn:_.payload.patient_mrn,patientId:_.payload.patient_id,patientName:_.payload.patient_name},_.payload.is_patient_contact&&(e.patientDetails.contactId=_.payload.patient_contact_id,e.patientDetails.contactName=_.payload.patient_contact_name,e.patientDetails.relation=_.payload.relation_name)))}if("originalSender"in e&&"string"==typeof e.originalSender){var j=e.senderOrganizationId,S=e.originalSender,M=e.originalSenderDisplayName;e.originalSender={$entityType:"user",displayName:M,id:S,organizationId:j},"patientDetails"in e&&(e.patientDetails.patientId===e.originalSender.id&&(e.originalSender.isPatient=!0),e.patientDetails.contactId===e.originalSender.id&&(e.originalSender.isPatientContact=!0,e.originalSender.relation=e.patientDetails.relation)),delete e.originalSenderDisplayName}return e},afterAssignment:function(e){var t=e.__organizationId,n=e.counterParty,r=e.counterPartyId,a=e.counterPartyType,o=e.createdAt,i=e.isOutgoing,s=e.recipientOrganizationId,u=e.senderId,c=e.senderOrganizationId,l=R.currentUserId;if(n)switch(r=n.id,a=n.$entityType){case"group":e.groupId=r,delete e.recipientId;break;case"distributionList":e.distributionListId=r,delete e.recipientId}else n=a&&r?d.store.get(a,r):null;e.counterParty=n,e.counterPartyId=r,e.counterPartyType=a,o=o||new Date,u&&(i=R.messages._isMessageOutgoing(e)),i&&c?t=c:!i&&s&&(t=s),e.__organizationId=t,e.canRecall="distributionList"!==a&&u===l,e.createdAt=o,e.isOutgoing=i,e.isAutoForwarded=!!e.autoForwardedFromId,e.subType||(e.subType=U.MessageSubType.NA),R.messages._setRecipientStatus(e)},relations:{belongsTo:{autoForwardedFrom:{type:"user",foreignKey:"autoForwardedFromId"},conversation:{type:"conversation",foreignKey:"conversationId"},currentSenderRole:{type:"role",foreignKey:"currentSenderRoleId"},distributionList:{type:"distributionList",foreignKey:"distributionListId"},escalationExecution:{type:"escalationExecution",foreignKey:"escalationExecutionId"},group:{type:"group",foreignKey:"groupId"},recipient:{type:"user",foreignKey:"recipientId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},sender:{type:"user",foreignKey:"senderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},teamRequest:{type:"teamRequest",foreignKey:"teamRequestId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}}})};var U=n(26);e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:o.default.NA},parseAttrs:function(e){return e.status&&(e.status=o.default.resolve(e.status)),e.createdAt&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),e},beforeInject:function(e,t){if(t){var n=t.status,r=e.status;a.MESSAGE_STATUS_ORDER[r]<a.MESSAGE_STATUS_ORDER[n]&&(delete e.createdAt,delete e.status)}},relations:{belongsTo:{distributionList:{type:"distributionList",foreignKey:"distributionListId"},message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}})};var r,a=n(41),o=(r=a)&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("messageTemplate",{replaceKeys:{createdBy:"createdById",templateLabel:"title",updatedBy:"updatedById"},transientAttrs:["$deleted"],parseAttrs:function(e){return e.hasAttachment=!1,e.attachmentName&&e.attachmentSize&&e.attachmentType&&(e.hasAttachment=!0),e},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},organization:{type:"organization",foreignKey:"organizationId"},updatedBy:{type:"user",foreignKey:"updatedById"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("metadata",{parseAttrs:function(e,t){return e.data=t.data,e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("mute",{parseAttrs:function(e){return e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("patient",{replaceKeys:{patientMrn:"mrn",patientGender:"gender",patientDob:"dob"},parseAttrs:function(e){return"featureService"in e&&delete e.featureService,"patientContacts"in e&&delete e.patientContacts,"isPatientContact"in e&&delete e.isPatientContact,"dob"in e&&(e.dob=(0,r.formatDob)(e.dob)),"phoneNumber"in e&&(e.phoneNumber=(0,a.formatPhoneWithDash)(e.phoneNumber)),e},relations:{belongsTo:{user:{type:"user",foreignKey:"userId"}},hasMany:{contacts:{type:"patientContact",foreignKey:"patientId"},sharedConversations:{type:"conversation",foreignKey:"patientId",filter:function(e,t){var n=e.counterParty;if(!n)return!1;var r=n.groupType,a=n.hasCurrentUserOrRole,o=n.memberIds;return!(r!==i.GroupType.PATIENT_MESSAGING||!a||!o.includes(t.userId))},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"],["id","asc"]]}}}})};var r=n(44),a=n(28),i=n(26);e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("patientContact",{replaceKeys:{patientDob:"dob",patientGender:"gender",patientMrn:"mrn",relationName:"relation"},parseAttrs:function(e){return"entity"in e&&delete e.entity,"dob"in e&&(e.dob=(0,r.formatDob)(e.dob)),"phoneNumber"in e&&(e.phoneNumber=(0,a.formatPhoneWithDash)(e.phoneNumber)),e},relations:{belongsTo:{patient:{type:"patient",foreignKey:"patientId"},user:{type:"user",foreignKey:"userId"}},hasMany:{sharedConversations:{type:"conversation",foreignKey:"patientContactId",filter:function(e,t){var n=e.counterParty;if(!n)return!1;var r=n.groupType,a=n.hasCurrentUserOrRole,o=n.memberIds;return!(r!==i.GroupType.PATIENT_MESSAGING||!a||!o.includes(t.userId))},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"],["id","asc"]]}}}})};var r=n(44),a=n(28),i=n(26);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.host;return e.defineModel("product",{defaultValues:{activeProcessingEvents:null,conversationCount:0,organizations:null,rolesOptingIn:null,unreadCount:0,unreadPriorityCount:0},transientAttrs:["conversationCount","organizations","unreadCount","unreadPriorityCount"],afterAssignment:function(e){var t=e.id;e.productRoles=n.userRoles.getByProductId(t),null===e.activeProcessingEvents&&(e.activeProcessingEvents=[]),null===e.organizations&&(e.organizations=[]),null===e.rolesOptingIn&&(e.rolesOptingIn=[])}})},e.exports=t.default},function(e,t){"use strict";function n(e,t){return!!e&&e.includes(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("productRoles",{defaultValues:{roles:[]},afterAssignment:function(e){var t=e.roles;e.isAdmin=n(t,"tt_admin"),e.isAnalyticsAdmin=n(t,"tt_reporting"),e.isLdapAdmin=n(t,"tt_ldap"),e.isSuperAdmin=n(t,"tt_super_admin")},methods:{hasRole:function(e){return!!this.roles&&this.roles.includes(e)}},relations:{belongsTo:{product:{type:"product",foreignKey:"productId"},user:{type:"user",foreignKey:"userId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.host;return e.defineModel("role",{defaultValues:{description:"",memberIds:null,roleTagId:null},afterAssignment:function(e){n.users._setMembersOnEntity(e)},relations:{belongsTo:{assignmentGroup:{type:"group",foreignKey:"assignmentGroupId"},botUser:{type:"user",foreignKey:"botUserId"},escalationPolicy:{type:"escalationPolicy",foreignKey:"escalationPolicyId"},organization:{type:"organization",foreignKey:"organizationId"},roleTag:{type:"roleTag",foreignKey:"roleTagId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("roleTag",{replaceKeys:{tagColor:"color",tagName:"name"},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}},hasMany:{roles:{type:"role",foreignKey:"roleTagId"}}},parseAttrs:function(e){if("colorValue"in e){var t=e.color,n=e.colorValue;e.color=n,e.colorId=t,delete e.colorValue}return"color"in e&&(e.color=e.color.replace("0x","#")),e},afterAssignment:function(e){var t=e.name;e.displayName=t,e.isDefault=t&&t.startsWith("Default")}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(a,e){var t=e.host;return a.defineModel("scheduledMessage",{replaceKeys:{createdBy:"createdById",recipient:"recipientId",recipientType:"_recipientType",senderToken:"senderId",scheduleStatus:"status",updatedBy:"updatedById"},transientAttrs:["$deleted"],parseAttrs:function(e){return e.hasAttachment=!1,e.attachmentName&&e.attachmentSize&&e.attachmentType&&(e.hasAttachment=!0),e._recipientType&&(e.recipientType=t.modelsByEntityType[r.Camelizer.camelizeKey(e._recipientType)].name),e},afterAssignment:function(e){var t=e.recipient,n=e.recipientId,r=e.recipientType;t?(n=t.id,r=t.$entityType):t=r&&n?a.store.get(r,n):null,e.recipient=t,e.recipientId=n,e.recipientType=r},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},organization:{type:"organization",foreignKey:"organizationId"},sender:{type:"user",foreignKey:"senderId"},template:{type:"messageTemplate",foreignKey:"templateId"},updatedBy:{type:"user",foreignKey:"updatedById"}}}})};var r=n(23);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),o=((0,r(n(2)).default)(i,null,[{key:"is",value:function(e){return e instanceof this}}]),i);function i(e,t,n,r){(0,a.default)(this,i),this.id="searchResult:"+t+":"+e.id,this.entity=e,this.entityId=e.id,this.entityType=e.$entityType,this.metadata=r,this.organizationId=t,this.conversationId=n}t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(3)),f=r(n(4)),p=r(n(5)),h=r(n(12)),y=r(n(13));t.default=function(e,t){var l=t.host,n=e.defineModel("team",{replaceKeys:{avatar:"avatarUrl",group_token:"groupToken",members:"__members",numMembers:"__memberCount",name:"displayName"},transientAttrs:["__memberCount","__members"],defaultValues:{canMembersLeave:!1,canRequestToJoin:!1,hasCurrentUserOrRole:!1,hasCurrentUserPending:!1,hasCurrentUserBeenDeclined:!1,memberIds:[]},skipCamelizationForKeys:["members"],parseAttrs:function(e){var t=e.__members;if(t){var n=[];if(!t||"function"!=typeof t[y.default]&&!Array.isArray(t))throw new TypeError("Expected rawMembers to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(t));if(!t||"function"!=typeof t[y.default]&&!Array.isArray(t))throw new TypeError("Expected rawMembers to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(t));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,h.default)(t);!(r=(i=s.next()).done);r=!0){var u=i.value;if("object"===(void 0===u?"undefined":(0,p.default)(u)))if(u.token){n.push(u.token);var c=l.models.User.inject(u);l.models.User.removePlaceholder({entity:c,attrs:u})}else u.id&&n.push(u.id);else"string"==typeof u&&n.push(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}e.memberIds=n,delete e.__members}return e},afterAssignment:function(e){var t=e.memberIds;l.groups._setMembership(e),l.users._setMembersOnEntity(e),l.teams._setHasUserPending(e),e.memberCount=t&&t.length||e.__memberCount||0},relations:{belongsTo:{group:{type:"group",foreignKey:"groupId"}}}});return(0,a.default)(n,{finder:function(){var e;return(e=l.teams).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return l.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return l.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<Team Not Found>"}}),n};var a=r(n(37));e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("teamRequest",{replaceKeys:{},transientAttrs:[],defaultValues:{},parseAttrs:function(e){return e.createdBy&&(e.createdById=e.createdBy.token,delete e.createdBy),e.team&&(e.teamId=e.team.id,delete e.team),e},afterAssignment:function(e){},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},team:{type:"team",foreignKey:"teamId"}}}})},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("userRoles",{defaultValues:{roles:[]},afterAssignment:function(e){var t=e.organizationId===r.CONTACTS_ORG_ID,n=e.roles;e.isAdmin=n.includes("admin"),e.isHelpDesk=n.includes("help_desk"),e.isPatientAdmin=n.includes("patient_messaging_admin"),e.isRoleAdmin=n.includes("feature_role_admin"),e.isTeamAdmin=n.includes("team_admin"),e.reportingEnabled=n.includes("reporting")&&!t,e.reportingEnabledOnAllOrgs=n.includes("reporting_view_orgs")&&!t,e.tigerTouchPlusReportingEnabled=n.includes("tigertouchplus_reporting")},methods:{hasRole:function(e){return this.roles.includes(e)}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},user:{type:"user",foreignKey:"userId"}}}})};var r=n(67);e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["CONTACTS_MESSAGING_BLOCKED_BY_ADMIN","CONVERSATION_NOT_FULLY_LOADED","CONVERSATION_WITH_ROLE_YOU_ARE_CURRENTLY_IN","COUNTER_PARTY_IS_TIGERPAGE","COUNTER_PARTY_NOT_FULLY_LOADED","COUNTER_PARTY_TYPE_NOT_SUPPORTED","GROUP_HAS_NO_MEMBERS","GROUP_MEMBERS_NOT_LOADED","IS_ROLE_ASSIGNMENT_GROUP","NO_COUNTER_PARTY","ORGANIZATION_DOES_NOT_EXIST","USER_IS_NOT_IN_THIS_ROLE_CONVERSATION","USER_IS_NOT_MEMBER_OF_GROUP","NONE"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({CONTINUATION:{serverValue:"continuation"},CONVERSATION_END:{serverValue:"conversation_end"},FIRST_UNREAD_ITEM:{serverValue:"first_unread_item"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({ACKNOWLEDGED:{serverValue:"escalation_acknowledged"},CANCELLED:{serverValue:"escalation_cancelled"},INITIATED:{serverValue:"escalation_initiated"},MEMBER_ADDED:{serverValue:"escalation_member_added"},NO_RESPONSE:{serverValue:"escalation_no_response"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["SENDING","SENT","FAILED","RETRYING","NEW","NA"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({EMPTY_ROLE_NOTIFICATION:{serverValue:"empty_role_notification"},NA:{key:"NA"},ROLE_AWAY_NOTIFICATION:{serverValue:"role_away_notification"},SCHEDULE_MESSAGE:{serverValue:"schedule_message"},SMS_OPT_IN_NOTIFICATION:{serverValue:"sms_optin_notification"},SMS_OPT_OUT_NOTIFICATION:{serverValue:"sms_optout_notification"},SYSTEM:{serverValue:"system"},TEAM_REQUEST:{serverValue:"team_request"},USER_AWAY_NOTIFICATION:{serverValue:"user_away_notification"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(21),o=new((r=a)&&r.__esModule?r:{default:r}).default(["CALL_CHANGE","ESCALATION_EXECUTION_CHANGE","GROUP_MEMBERSHIP_CHANGE","HIGHER_CONTINUATION","LOWER_CONTINUATION","USER_SENT"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({ADD_MEMBERS:{serverValue:"add_members"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({ADMIT:{serverValue:"admit"},DISCHARGE:{serverValue:"discharge"},LAB:{serverValue:"lab"},TRANSFER:{serverValue:"transfer"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({ACTION:{serverValue:"ehr_action_item"},HEADER:{serverValue:"ehr_header"},ITEM:{serverValue:"table_item"},TEXT:{serverValue:"ehr_text_view"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(21).ServerValueEnum)({DISTRIBUTION_LIST_MEMBER:{serverValue:"dist_list_member"},DISTRIBUTION_LIST:{serverValue:"distribution_list"},FORUM:{serverValue:"public_group"},GROUP:{serverValue:"group"},MESSAGE_TEMPLATE:{serverValue:"message_template"},ORGANIZATION:{serverValue:"organization"},PATIENT_DISTRIBUTION_LIST:{serverValue:"patient_distribution_list"},PATIENT:{serverValue:"patient_account"},SCHEDULED_MESSAGE:{serverValue:"schedule_message"},TAG:{serverValue:"tag"},TEAM:{serverValue:"team"},USER:{serverValue:"account"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserRoles=t.User=t.TeamRequest=t.Team=t.ScheduledMessage=t.RoleTag=t.Role=t.ProductRoles=t.Product=t.PatientContact=t.Patient=t.Organization=t.Mute=t.Metadata=t.MessageTemplate=t.MessageStatusPerRecipient=t.Message=t.GroupMembersChange=t.Group=t.EscalationPolicy=t.EscalationExecutionChange=t.EscalationExecution=t.DistributionList=t.Conversation=t.Call=void 0;var a=r(n(132)),o=r(n(133)),i=r(n(134)),s=r(n(135)),u=r(n(136)),c=r(n(137)),l=r(n(139)),d=r(n(140)),f=r(n(141)),p=r(n(142)),h=r(n(143)),y=r(n(144)),g=r(n(145)),v=r(n(67)),m=r(n(146)),b=r(n(147)),w=r(n(148)),_=r(n(149)),x=r(n(150)),E=r(n(151)),k=r(n(152)),T=r(n(154)),I=r(n(155)),A=r(n(47)),O=r(n(156));t.Call=a.default,t.Conversation=o.default,t.DistributionList=i.default,t.EscalationExecution=s.default,t.EscalationExecutionChange=u.default,t.EscalationPolicy=c.default,t.Group=l.default,t.GroupMembersChange=d.default,t.Message=f.default,t.MessageStatusPerRecipient=p.default,t.MessageTemplate=h.default,t.Metadata=y.default,t.Mute=g.default,t.Organization=v.default,t.Patient=m.default,t.PatientContact=b.default,t.Product=w.default,t.ProductRoles=_.default,t.Role=x.default,t.RoleTag=E.default,t.ScheduledMessage=k.default,t.Team=T.default,t.TeamRequest=I.default,t.User=A.default,t.UserRoles=O.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function y(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=y(t[0],n);return t.every(function(e){return y(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return y(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+y(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function g(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=g(t[0],n);return t.every(function(e){return g(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return g(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+g(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var a,i=r(n(3)),s=r(n(4)),u=r(n(5)),o=r(n(6)),c=r(n(1)),l=r(n(2)),d=r(n(8)),f=r(n(7)),p=r(n(33)),v=n(17),m=r(n(181)),b=r(n(43)),h=(a=p.default,(0,f.default)(w,a),(0,l.default)(w,[{key:"createEventSource",value:function(a,e){var o=this,t=e.auth,n=void 0===t?this.httpClient.getAuth():t,r=e.features,i=e.onOpen,s=e.onMessage,u=e.onError;if("string"!=typeof a)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(a));if(null==e||void 0!==e.features&&null!=e.features&&"string"!=typeof e.features||void 0!==e.onOpen&&null!=e.onOpen&&"function"!=typeof e.onOpen||void 0!==e.onMessage&&null!=e.onMessage&&"function"!=typeof e.onMessage||void 0!==e.onError&&null!=e.onError&&"function"!=typeof e.onError)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  features?: ?string;\n  onOpen?: ?Function;\n  onMessage?: ?Function;\n  onError?: ?Function;\n}\n\nGot:\n"+g(e));if("string"!=typeof a)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+y(a));if(null==e||void 0!==e.features&&null!=e.features&&"string"!=typeof e.features||void 0!==e.onOpen&&null!=e.onOpen&&"function"!=typeof e.onOpen||void 0!==e.onMessage&&null!=e.onMessage&&"function"!=typeof e.onMessage||void 0!==e.onError&&null!=e.onError&&"function"!=typeof e.onError)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  features?: ?string;\n  onOpen?: ?Function;\n  onMessage?: ?Function;\n  onError?: ?Function;\n}\n\nGot:\n"+y(e));var c=/https?:/.test(a)?a:this.config.baseUrl+a,l=this.httpClient.getAuthHeaders(n,r);"TT-Route-Xmpp"===this.config.ttRoute&&(l["TT-Route-Xmpp"]="true"),r&&(l["TT-X-Features"]=r);var d=new m.default(c,{headers:l}),f=!1,p=!1,h=!1;return d.addEventListener("open",function e(){h||(h=!0,d.removeEventListener("open",e),i&&i())}),d.addEventListener("error",function e(t){if(!f){f=!0,d.removeEventListener("error",e);var n=t?t.status:void 0,r=void 0;401===n?(r=new v.WrongCredentialsError,o.emit("auth:invalid")):403===n?(r=new v.PermissionDeniedError(a,"403","get"),o.emit("auth:invalid")):t&&t.message&&t.stack?(r=new Error(t.message)).stack=t.stack:r=p?new Error("EventSource connection closed"+(n?": status "+n:"")):new Error("Could not establish EventSource connection"+(n?": status "+n:"")),n&&(r.status=n),o.httpClient.networkStatus!==b.default.OFFLINE&&o.httpClient._setNetworkStatus(b.default.UNREACHABLE),u&&u(r)}}),d.addEventListener("message",function(e){var t=!p;p||(p=!0,o.httpClient._setNetworkStatus(b.default.ONLINE)),s&&s(e,{isFirstMessage:t})}),d}}]),w);function w(e){var t=e.config,n=e.httpClient,r=e.logger;(0,c.default)(this,w);var a=(0,d.default)(this,(w.__proto__||(0,o.default)(w)).call(this));return a.config=t,a.httpClient=n,a.logger=r,a}t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(12)),s=r(n(3)),u=r(n(4)),c=r(n(5)),o=r(n(13)),i={};if("function"!=typeof(y=["\n","\r"," ",":"])[o.default]&&!Array.isArray(y))throw new TypeError("Expected _ref to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,c.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,u.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,s.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(y));if("function"!=typeof y[o.default]&&!Array.isArray(y))throw new TypeError("Expected _ref to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,c.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,u.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,s.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(y));var l=!0,d=!1,f=void 0;try{for(var p,h=(0,a.default)(y);!(l=(p=h.next()).done);l=!0){var y,g=p.value;i[g]=g.charCodeAt(0)}}catch(e){d=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw f}}t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,s=r(n(6)),u=r(n(1)),c=r(n(8)),o=r(n(7)),i=r(n(50)),l=(a=i.default,(0,o.default)(d,a),d);function d(e,t){var n=t.headers,r=t.message,a=t.status,o=t.statusText;(0,u.default)(this,d);var i=(0,c.default)(this,(d.__proto__||(0,s.default)(d)).call(this,e));return i.headers=n,i.message=r,i.status=a,i.statusText=o,i}t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.NativeEventSource=t.EventSourcePolyfill=void 0;var a,o,i,s=r(n(10)),u=r(n(9)),c=r(n(1)),l=r(n(2)),d=r(n(33)),f=r(n(74)),p=r(n(173)),h=n(174),y=n(179),g=((0,l.default)(m,[{key:"addEventListener",value:function(e,t){this._events.on(e,t)}},{key:"removeEventListener",value:function(e,t){this._events.removeListener(e,t)}},{key:"dispatchEvent",value:function(e){e&&e.type&&this._events.emit(e.type,e)}},{key:"start",value:(i=(0,u.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.readyState!==f.default.WAITING)return e.abrupt("return");e.next=2;break;case 2:return e.next=4,this._esRequest.start();case 4:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"close",value:function(){this.readyState!==f.default.CLOSED&&(this._esRequest.close(),this._esRequest.onFinish(new Error("Connection closed by caller")))}}]),o=a=m,a.CLOSED=f.default.CLOSED,a.CONNECTING=f.default.CONNECTING,a.OPEN=f.default.OPEN,a.FetchRequest=h.FetchRequest,a.XHRRequest=y.XHRRequest,a.isFetchSupported=h.isFetchSupported,o),v=global.EventSource;function m(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.RequestClass,a=n.headers,o=n.lastEventId,i=n.withCredentials;(0,c.default)(this,m),this.CLOSED=f.default.CLOSED,this.CONNECTING=f.default.CONNECTING,this.OPEN=f.default.OPEN,this.FetchRequest=h.FetchRequest,this.XHRRequest=y.XHRRequest,this.isFetchSupported=h.isFetchSupported,this._events=new d.default,this.onerror=void 0,this.onmessage=void 0,this.onopen=void 0,this.readyState=f.default.WAITING,this.url=e=String(e),this.withCredentials=i,r=r||(h.isFetchSupported?h.FetchRequest:y.XHRRequest),this._esRequest=new p.default({RequestClass:r,dispatchEvent:function(e){return t.dispatchEvent(e)},headers:a,lastEventId:o,onError:function(e){return t.onerror&&t.onerror(e)},onMessage:function(e){return t.onmessage&&t.onmessage(e)},onOpen:function(e){return t.onopen&&t.onopen(e)},onReadyStateChange:function(e){t.readyState=e},url:e,withCredentials:i})}t.default=g,t.EventSourcePolyfill=g,t.NativeEventSource=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function y(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=y(t[0],n);return t.every(function(e){return y(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return y(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+y(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i=r(n(3)),s=r(n(4)),u=r(n(5)),g=r(n(10)),v=r(n(19)),m=r(n(12)),b=r(n(13)),w=r(n(22)),c=r(n(9)),f=r(n(1)),l=r(n(2)),_=r(n(170)),d=r(n(171)),x=r(n(74)),p=r(n(50)),E=r(n(176)),k=r(n(177)),T=/^text\/event\-stream?(\s*charset\=utf\-8)?$/i,I=((0,l.default)(A,[{key:"start",value:(o=(0,c.default)(g.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l,d,f,p=this;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.onReadyStateChange(x.default.CONNECTING),this.currentState=x.default.CONNECTING,t=this.url,n=this.withCredentials,"data:"!==t.slice(0,5)&&"blob:"!==t.slice(0,5)&&(t+=-1===t.indexOf("?")?"?":"&",t+="lastEventId="+encodeURIComponent(this.lastEventId)),r={Accept:"text/event-stream"},!this.headers){e.next=31;break}if(!(c=(0,w.default)(this.headers))||"function"!=typeof c[b.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+h(c));e.next=10;break;case 10:if(!c||"function"!=typeof c[b.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+y(c));e.next=12;break;case 12:for(o=!(a=!0),i=void 0,e.prev=15,s=(0,m.default)(c);!(a=(u=s.next()).done);a=!0)l=(0,v.default)(u.value,2),d=l[0],f=l[1],r[d]=f;e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),o=!0,i=e.t0;case 23:e.prev=23,e.prev=24,!a&&s.return&&s.return();case 26:if(e.prev=26,o)throw i;e.next=29;break;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return e.prev=31,this.request=new this.RequestClass({headers:r,onProgress:function(e){return p.onProgress(e)},onStart:function(e){return p.onStart(e)},url:t,withCredentials:n}),e.next=35,this.request.fetch();case 35:throw new Error("Connection closed by server");case 38:if(e.prev=38,e.t1=e.catch(31),this.request.isAborted)return e.abrupt("return");e.next=42;break;case 42:this.close(),this.onFinish(e.t1);case 44:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30],[31,38]])})),function(){return o.apply(this,arguments)})},{key:"onStart",value:function(e){var t=e.contentType,n=e.headers,r=e.status,a=e.statusText;if(this.currentState===x.default.CONNECTING)if(200===r&&t&&T.test(t)){this.currentState=x.default.OPEN,this.onReadyStateChange(x.default.OPEN);var o=new d.default("open",{headers:n,status:r,statusText:a});this.dispatchEvent(o),this.onOpen(o)}else{var i="";i=200!==r?"EventSource's response has a status "+r+" "+(a=a&&a.replace(/\s+/g," "))+" that is not 200. Aborting the connection.":"EventSource's response has a Content-Type specifying an unsupported type: "+(t?"-":t.replace(/\s+/g," "))+". Aborting the connection.";var s=new d.default("error",{headers:n,message:i,status:r,statusText:a});this.close(),this.dispatchEvent(s),this.onError(s)}}},{key:"onProgress",value:function(e){if(this.currentState===x.default.OPEN){for(var t=this.parserState,n=t.dataBuffer,r=t.eventTypeBuffer,a=t.fieldStart,o=t.lastEventIdBuffer,i=t.state,s=t.textBuffer,u=t.valueStart,c=-1,l=0;l<e.length;l+=1){var d=e.charCodeAt(l);d!==_.default["\n"]&&d!==_.default["\r"]||(c=l)}var f=(-1!==c?s:"")+e.slice(0,c+1);s=(-1===c?s:"")+e.slice(c+1);for(var p=0;p<f.length;p+=1){var h=f.charCodeAt(p);if(i!==k.default.AFTER_CR||h!==_.default["\n"])if(i===k.default.AFTER_CR&&(i=k.default.FIELD_START),h===_.default["\n"]||h===_.default["\r"]){if(i!==k.default.FIELD_START){i===k.default.FIELD&&(u=p+1);var y=f.slice(a,u-1),g=u<p&&f.charCodeAt(u)===_.default[" "]?1:0,v=f.slice(u+g,p);"data"===y?(n+="\n",n+=v):"id"===y?o=v:"event"===y&&(r=v)}if(i===k.default.FIELD_START){if(""!==n){this.lastEventId=o,""===r&&(r="message");var m=new E.default(r,{data:n.slice(1),lastEventId:o});if(this.dispatchEvent(m),"message"===r&&this.onMessage(m),this.currentState===x.default.CLOSED)return}r=n=""}i=h===_.default["\r"]?k.default.AFTER_CR:k.default.FIELD_START}else i===k.default.FIELD_START&&(a=p,i=k.default.FIELD),i===k.default.FIELD?h===_.default[":"]&&(u=p+1,i=k.default.VALUE_START):i===k.default.VALUE_START&&(i=k.default.VALUE);else i=k.default.FIELD_START}this.parserState={dataBuffer:n,eventTypeBuffer:r,fieldStart:a,lastEventIdBuffer:o,state:i,textBuffer:s,valueStart:u}}}},{key:"onFinish",value:function(e){var t=new p.default("error");e&&(t.message=e.message,t.stack=e.stack),this.dispatchEvent(t),this.onError(t)}},{key:"close",value:(a=(0,c.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentState=x.default.CLOSED,this.onReadyStateChange(x.default.CLOSED),this.request&&!this.request.isAborted)return e.next=5,this.request.abort();e.next=5;break;case 5:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})}]),A);function A(e){var t=e.RequestClass,n=e.dispatchEvent,r=e.headers,a=e.lastEventId,o=void 0===a?"":a,i=e.onError,s=e.onMessage,u=e.onOpen,c=e.onReadyStateChange,l=e.url,d=e.withCredentials;(0,f.default)(this,A),this.RequestClass=t,this.dispatchEvent=n,this.headers=r,this.lastEventId=o,this.onError=i,this.onMessage=s,this.onOpen=u,this.onReadyStateChange=c,this.url=l,this.withCredentials=d,this.currentState=x.default.WAITING,this.parserState={dataBuffer:"",eventTypeBuffer:"",fieldStart:0,lastEventIdBuffer:o,state:k.default.FIELD_START,textBuffer:"",valueStart:0},this.request=void 0}t.default=I,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.FetchRequest=t.isFetchSupported=void 0;var a,o,i,s,u=r(n(18)),c=r(n(10)),l=r(n(9)),d=r(n(1)),f=r(n(2)),p=n(178),h=(t.isFetchSupported=!!(global.fetch&&global.Headers&&global.Response&&global.AbortController),(0,p.supportsStreamOption)()?p.NativeTextDecoder:p.TextDecoderPolyfill),y=global.fetch,g=((0,f.default)(v,[{key:"get",value:function(e){return this._headers.get(e)}}]),v);function v(e){(0,d.default)(this,v),this._headers=e}function m(e){var t=e.headers,n=e.onProgress,r=e.onStart,a=e.url,o=e.withCredentials;(0,d.default)(this,m),this.controller=new AbortController,this.headers=new Headers(t),this.isAborted=!1,this.onProgress=n,this.onStart=r,this.response=null,this.textDecoder=new h,this.url=a,this.withCredentials=o,this._reader=null,this._stream=null}t.FetchRequest=((0,f.default)(m,[{key:"fetch",value:(s=(0,l.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAborted)return e.abrupt("return");e.next=2;break;case 2:return e.next=4,y(this.url,{headers:this.headers,credentials:this.withCredentials?"include":"same-origin",signal:this.controller.signal,cache:"no-store"});case 4:if((t=this.response=e.sent).body.on)return this._emitStart(),e.next=9,this._streamBody();e.next=11;break;case 9:e.next=18;break;case 11:if("getReader"in t.body)return this._emitStart(),e.next=15,this._readBody();e.next=17;break;case 15:e.next=18;break;case 17:throw new Error("Cannot read from response.body, lacks 'getReader' or 'on' property");case 18:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"_emitStart",value:function(){var e=this.response,t=e.headers,n=e.status,r=e.statusText;this.onStart({contentType:t.get("Content-Type"),headers:new g(t),status:n,statusText:r})}},{key:"_streamBody",value:(i=(0,l.default)(c.default.mark(function e(){var a=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new u.default(function(e,t){function n(){r||(r=!0,e())}var r=!1;a._stream=a.response.body.on("data",function(e){var t=e.toString("utf8");a.onProgress(t)}).on("close",n).on("end",n).on("error",function(e){return t(e)})});case 2:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_readBody",value:(o=(0,l.default)(c.default.mark(function e(){var t,n,r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._reader=this.response.body.getReader(),t=!1;case 2:if(t||this.isAborted){e.next=9;break}return e.next=5,this._reader.read();case 5:(n=e.sent).done?t=!0:(r=this.textDecoder.decode(n.value,{stream:!0}),this.onProgress(r)),e.next=2;break;case 9:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"abort",value:(a=(0,l.default)(c.default.mark(function e(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAborted)return e.abrupt("return");e.next=2;break;case 2:if(this.isAborted=!0,this._reader)return e.prev=4,e.next=7,this._reader.cancel();e.next=12;break;case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:this._reader=null;case 12:this._stream&&(this._stream.destroy(),this._stream=null),this.controller.abort();case 14:case"end":return e.stop()}},e,this,[[4,9]])})),function(){return a.apply(this,arguments)})}]),m)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(e){return e.replace(/[A-Z]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+32)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=r(n(227)),c=r(n(1)),a=((0,r(n(2)).default)(l,[{key:"get",value:function(e){return this._map[s(e)]}}]),l);function l(e){(0,c.default)(this,l);for(var t=(0,u.default)(null),n=e.split("\r\n"),r=0;r<n.length;r+=1){var a=n[r].split(": "),o=a.shift(),i=a.join(": ");t[s(o)]=i}this._map=t}t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=r(n(6)),i=r(n(1)),s=r(n(8)),u=r(n(7)),c=r(n(50)),l=(a=c.default,(0,u.default)(d,a),d);function d(e,t){(0,i.default)(this,d);var n=(0,s.default)(this,(d.__proto__||(0,o.default)(d)).call(this,e));return n.data=t.data,n.lastEventId=t.lastEventId,n}t.default=l,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={AFTER_CR:-1,FIELD_START:0,FIELD:1,VALUE_START:2,VALUE:3},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){if(1===n)return 128>>t<=e&&e<<t<=2047;if(2===n)return 2048>>t<=e&&e<<t<=55295||57344>>t<=e&&e<<t<=65535;if(3===n)return 65536>>t<=e&&e<<t<=1114111;throw new Error("Invalid octetsCount")}function s(e,t){if(6===e)return 15<t>>6?3:31<t?2:1;if(12===e)return 15<t?3:2;if(18===e)return 3;throw new Error}Object.defineProperty(t,"__esModule",{value:!0}),t.TextDecoderPolyfill=t.NativeTextDecoder=void 0;var a=r(n(1)),o=r(n(2));t.supportsStreamOption=function(){if(!u||"undefined"==typeof TextEncoder)return!1;try{return"test"===(new u).decode((new TextEncoder).encode("test"),{stream:!0})}catch(e){}return!1};var u=t.NativeTextDecoder=global.TextDecoder;function c(){(0,a.default)(this,c),this.bitsNeeded=0,this.codePoint=0}t.TextDecoderPolyfill=((0,o.default)(c,[{key:"decode",value:function(e){for(var t="",n=this.bitsNeeded,r=this.codePoint,a=0;a<e.length;a+=1){var o=e[a];0!==n&&(o<128||191<o||!i(r<<6|63&o,n-6,s(n,r)))&&(n=0,r=65533,t+=String.fromCharCode(r)),0===n?(r=0<=o&&o<=127?(n=0,o):192<=o&&o<=223?(n=6,31&o):224<=o&&o<=239?(n=12,15&o):240<=o&&o<=247?(n=18,7&o):(n=0,65533),0===n||i(r,n,s(n,r))||(n=0,r=65533)):(n-=6,r=r<<6|63&o),0===n&&(r<=65535?t+=String.fromCharCode(r):(t+=String.fromCharCode(55296+(r-65535-1>>10)),t+=String.fromCharCode(56320+(r-65535-1&1023))))}return this.bitsNeeded=n,this.codePoint=r,t}}]),c)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function p(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=p(t[0],n);return t.every(function(e){return p(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return p(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+p(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.XHRRequest=void 0;var a,o,i=r(n(3)),s=r(n(4)),u=r(n(5)),y=r(n(10)),g=r(n(19)),v=r(n(12)),m=r(n(13)),b=r(n(22)),w=r(n(18)),c=r(n(9)),l=r(n(1)),d=r(n(2)),_=r(n(175)),f=r(n(180));function x(e){var t=e.headers,n=e.onProgress,r=e.onStart,a=e.url,o=e.withCredentials;(0,l.default)(this,x),this.headers=t,this.isAborted=!1,this.offset=0,this.onProgress=n,this.onStart=r,this.url=a,this.withCredentials=o,this.xhr=new f.default(new XMLHttpRequest)}t.XHRRequest=((0,d.default)(x,[{key:"fetch",value:(o=(0,c.default)(y.default.mark(function e(){var n,t,r,a,o,i,s,u,c,l,d,f=this;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAborted)return e.abrupt("return");e.next=2;break;case 2:if(n=void 0,t=new w.default(function(e){n=e}),this.xhr.open("GET",this.url),this.xhr.onprogress=function(){var e=f.xhr.responseText.slice(f.offset);f.offset+=e.length,f.onProgress(e)},this.xhr.onreadystatechange=function(){if(f.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){var e=f.xhr.getResponseHeader("Content-Type"),t=f.xhr.getAllResponseHeaders();f.onStart({contentType:e,headers:new _.default(t),status:f.xhr.status,statusText:f.xhr.statusText})}else f.xhr.readyState===XMLHttpRequest.DONE&&n()},this.xhr.withCredentials=this.withCredentials,this.xhr.responseType="text",!(u=(0,b.default)(this.headers))||"function"!=typeof u[m.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries to be iterable, got "+p(u));e.next=12;break;case 12:if(!u||"function"!=typeof u[m.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries to be iterable, got "+h(u));e.next=14;break;case 14:for(a=!(r=!0),o=void 0,e.prev=17,i=(0,v.default)(u);!(r=(s=i.next()).done);r=!0)c=(0,g.default)(s.value,2),l=c[0],d=c[1],this.xhr.setRequestHeader(l,d);e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),a=!0,o=e.t0;case 25:e.prev=25,e.prev=26,!r&&i.return&&i.return();case 28:if(e.prev=28,a)throw o;e.next=31;break;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return this.xhr.send(),e.next=36,t;case 36:case"end":return e.stop()}},e,this,[[17,21,25,33],[26,,28,32]])})),function(){return o.apply(this,arguments)})},{key:"abort",value:(a=(0,c.default)(y.default.mark(function e(){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAborted)return e.abrupt("return");e.next=2;break;case 2:this.isAborted=!0,this.xhr.abort();case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})}]),x)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;function c(){}var a=r(n(1)),o=r(n(2)),i=((0,o.default)(s,[{key:"open",value:function(e,t){this._abort(!0);var a=this,o=this._xhr,i=1,n=0;function r(){if(1===i){var t="",n=void 0,r=0;if("contentType"in o)r=200,t="OK",n=o.contentType;else try{r=o.status,t=o.statusText,n=o.getResponseHeader("Content-Type")}catch(e){t="",n=void(r=0)}0!==r&&(i=2,a.readyState=2,a.status=r,a.statusText=t,a._contentType=n,a.onreadystatechange())}}function s(){if(r(),2===i||3===i){i=3;var e="";try{e=o.responseText}catch(e){}a.readyState=3,a.responseText=e,a.onprogress()}}function u(){s(),1!==i&&2!==i&&3!==i||(i=4,0!==n&&(clearTimeout(n),n=0),a.readyState=4,a.onreadystatechange())}this._abort=function(e){0!==a._sendTimeout&&(clearTimeout(a._sendTimeout),a._sendTimeout=0),1!==i&&2!==i&&3!==i||(i=4,o.onload=c,o.onerror=c,o.onabort=c,o.onprogress=c,o.onreadystatechange=c,o.abort(),0!==n&&(clearTimeout(n),n=0),e||(a.readyState=4,a.onreadystatechange())),i=0},o.onload=u,o.onerror=u,o.onabort=u,"sendAsBinary"in XMLHttpRequest.prototype||"mozAnon"in XMLHttpRequest.prototype||(o.onprogress=s),o.onreadystatechange=function(){o&&(4===o.readyState?u():3===o.readyState?s():2===o.readyState&&r())},"contentType"in o&&(t+=(-1===t.indexOf("?")?"?":"&")+"padding=true"),o.open(e,t,!0),"readyState"in o&&(n=setTimeout(function(){!function e(){n=setTimeout(function(){e()},500),3===o.readyState&&s()}()},0))}},{key:"abort",value:function(){this._abort(!1)}},{key:"getResponseHeader",value:function(e){return this._contentType}},{key:"setRequestHeader",value:function(e,t){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(e,t)}},{key:"getAllResponseHeaders",value:function(){return this._xhr.getAllResponseHeaders?this._xhr.getAllResponseHeaders():""}},{key:"send",value:function(){if("ontimeout"in XMLHttpRequest.prototype||!document||!document.readyState||"complete"===document.readyState){var e=this._xhr;e.withCredentials=this.withCredentials,e.responseType=this.responseType;try{e.send(void 0)}catch(t){throw t}}else{var t=this;t._sendTimeout=setTimeout(function(){t._sendTimeout=0,t.send()},4)}}}]),s);function s(e){(0,a.default)(this,s),this.withCredentials=!1,this.responseType="",this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=c,this.onreadystatechange=c,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=c}t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourcePolyfill=void 0;var r,a=n(172),o=(r=a)&&r.__esModule?r:{default:r};t.default=o.default,t.EventSourcePolyfill=o.default},function(e,t,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function A(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,c.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=A(t[0],n);return t.every(function(e){return A(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return A(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,u.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+A(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function O(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,c.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=O(t[0],n);return t.every(function(e){return O(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return O(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,u.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+O(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var j=n(s(16)),i=n(s(3)),u=n(s(4)),c=n(s(5)),S=n(s(29)),M=n(s(19)),R=n(s(12)),z=n(s(13)),C=n(s(22)),P=n(s(18)),V=n(s(10)),r=n(s(9)),a=n(s(1)),o=n(s(2)),G=n(s(36)),N=n(s(25)),l=n(s(84)),d=n(s(33)),f=s(20),U=n(s(288)),p=n(s(289)),F=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s(17)),h=n(s(43)),$=n(s(75)),y=["get","post","put","patch","del"],g=[F.PermissionDeniedError.CODE,F.WrongCredentialsError.CODE],v=((0,o.default)(m,[{key:"mounted",value:function(){this._prefixBaseUrl=(0,p.default)(this.config.baseUrl)}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"getAuth",value:function(e){return this._auth}},{key:"setAuth",value:function(e){this._auth=e}},{key:"removeAuth",value:function(){this._auth=null}},{key:"getAuthForKeyAndSecret",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(t));if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+A(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+A(t));return e&&t?(0,l.default)(e+":"+t):null}},{key:"getAuthHeaders",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._auth;if(!e)return{};var t={};if(e.key&&e.secret)t.Authorization="Basic "+this.getAuthForKeyAndSecret(e.key,e.secret);else{if(!e.bearerToken||!e.udid)return{};t.Authorization="Bearer "+e.bearerToken,t["X-Device-ID"]=e.udid}return t}},{key:"isUnauthorizedError",value:function(e){return e&&g.includes(e.code)}},{key:"downloadFileBlob",value:function(e){if((1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).headers,"string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(e));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+A(e));F.TargetNotSupportedError.raise()}},{key:"downloadToFile",value:function(e,t){var o=this,i=s(54);return new P.default(function(n,r){var a=o.config.baseUrl+e;s(286)({url:a,headers:o.getAuthHeaders()},function(e,t){e||t&&t.statusCode<200||299<t.statusCode?r(new Error("Failed downloading "+a+". Error: "+e.message+" | Status: "+(t?t.statusCode:null))):n()}).pipe(i.createWriteStream(t))})}},{key:"_watchNetworkConnection",value:function(){this.networkStatus=h.default.ONLINE}},{key:"_setNetworkStatus",value:function(e){var t=this.networkStatus;e!==t&&(this.networkStatus=e,this.emit("networkStatus:change",{networkStatus:e,previousStatus:t}))}},{key:"isSignedIn",get:function(){return!!this._auth}}]),m);function m(e){var t=e.config,n=e.logger;(0,a.default)(this,m),this.downloadFileBlobAndUrl=function(){return F.TargetNotSupportedError.raise()},this.config=t,this.logger=n,this._prefixBaseUrl=(0,p.default)(this.config.baseUrl),this._watchNetworkConnection()}if("function"!=typeof y[z.default]&&!Array.isArray(y))throw new TypeError("Expected HTTP_METHODS to be iterable, got "+A(y));if("function"!=typeof y[z.default]&&!Array.isArray(y))throw new TypeError("Expected HTTP_METHODS to be iterable, got "+O(y));var b,w,_=!0,x=!1,E=void 0;try{for(var k,T=function(){var t,I=k.value;v.prototype[I]=(t=(0,r.default)(V.default.mark(function e(c){var t,n,r,a,o,i,s,u,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k=this,T=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return V.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((T=(0,N.default)(T||{},{reqFormat:"json",resFormat:"json",withCredentials:!0,withHeaders:!0})).urlParams&&(c=c.replace(/:([\w\-]+)/g,function(e,t){var n=T.urlParams[t];return void 0!==n?encodeURIComponent(n):":"+t})),this.logger&&this.logger.info("start",I.toUpperCase(),c,T),(t=(0,j.default)({},T.headers,"TT-Route-Xmpp"===this.config.ttRoute?{"TT-Route-Xmpp":"true"}:null)).Accept=t.Accept||this._contentType(T.resFormat),T.requestId&&(t["Request-ID"]=T.requestId),"Authorization"in t||(0,S.default)(t,this.getAuthHeaders(T.auth)),n=U.default[I](c).use(this._prefixBaseUrl).query(T.query||{}),T.withCredentials&&(n=n.withCredentials()),!1!==T.retry&&(n=n.retry(T.retryCount||3)),!1!==T.timeout&&(n=n.timeout(!0===T.timeout?1e4:T.timeout)),r=void 0,(a=T.files&&(0,C.default)(T.files))&&0<a.length?(r=new $.default,t["Content-Type"]=r.getContentType()):t["Content-Type"]=t["Content-Type"]||this._contentType(T.reqFormat),T.withHeaders&&(n=n.set(t)),!r){e.next=73;break}if(o=[],!T.data){e.next=42;break}if(!(f=(0,C.default)(T.data))||"function"!=typeof f[z.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$entries3 to be iterable, got "+A(f));e.next=21;break;case 21:if(!f||"function"!=typeof f[z.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$entries3 to be iterable, got "+O(f));e.next=23;break;case 23:for(s=!(i=!0),u=void 0,e.prev=26,l=(0,R.default)(f);!(i=(d=l.next()).done);i=!0)p=(0,M.default)(d.value,2),h=p[0],y=p[1],o.push(r.appendField(h,y));e.next=34;break;case 30:e.prev=30,e.t0=e.catch(26),s=!0,u=e.t0;case 34:e.prev=34,e.prev=35,!i&&l.return&&l.return();case 37:if(e.prev=37,s)throw u;e.next=40;break;case 40:return e.finish(37);case 41:return e.finish(34);case 42:if(!a||"function"!=typeof a[z.default]&&!Array.isArray(a))throw new TypeError("Expected fileEntries to be iterable, got "+A(a));e.next=44;break;case 44:if(!a||"function"!=typeof a[z.default]&&!Array.isArray(a))throw new TypeError("Expected fileEntries to be iterable, got "+O(a));e.next=46;break;case 46:for(v=!(g=!0),m=void 0,e.prev=49,b=(0,R.default)(a);!(g=(w=b.next()).done);g=!0)_=(0,M.default)(w.value,2),h=_[0],x=_[1],o.push(r.appendFile(h,x));e.next=57;break;case 53:e.prev=53,e.t1=e.catch(49),v=!0,m=e.t1;case 57:e.prev=57,e.prev=58,!g&&b.return&&b.return();case 60:if(e.prev=60,v)throw m;e.next=63;break;case 63:return e.finish(60);case 64:return e.finish(57);case 65:return e.next=67,P.default.all(o);case 67:return e.next=69,r.getPayload(r);case 69:E=e.sent,n=n.send(E),e.next=74;break;case 73:n=n.send(T.data);case 74:return e.abrupt("return",new P.default(function(s,u){n.end(function(e,t){var n=(t||{}).headers;if(e)if(k.logger&&k.logger.info("error",I.toUpperCase(),c,e),e.status)if(401===e.status)u(new F.WrongCredentialsError(n));else if(403===e.status){var r=(T.urlParams||{}).userId,a=void 0===r?"403":r;u(new F.PermissionDeniedError(c,a,I,(0,G.default)(t,"body.error.message")))}else u(e);else u(new F.ConnectionUnavailableError);else switch(T.resFormat){case"json":var o=t.body||{};"reply"in o&&(o=o.reply);var i={data:o,headers:n,getHeader:function(e){return n[e.toLowerCase()]},status:t.status};k.logger&&k.logger.info("success",I.toUpperCase(),c,i),s(i);break;default:k.logger&&k.logger.info("success",I.toUpperCase(),c,t.text?t.text.substr(0,80)+"...":"[null]"),s(t.text)}})}));case 75:case"end":return e.stop()}},e,this,[[26,30,34,42],[35,,37,41],[49,53,57,65],[58,,60,64]])})),function(e){return t.apply(this,arguments)})},I=(0,R.default)(y);!(_=(k=I.next()).done);_=!0)T()}catch(e){x=!0,E=e}finally{try{!_&&I.return&&I.return()}finally{if(x)throw E}}b=v.prototype.get,w=(0,f.decorator)(b),v.prototype.get=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return t.reusePromise?w.call(this,e,t):b.call(this,e,t)},(0,S.default)(v.prototype,d.default.prototype),t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=t.readFile=t.MultiPart=t.mimeTypes=t.encoding=void 0;var o=a(n(42)),i=a(n(51)),s=r(n(75)),u=r(n(76)),c=r(n(182));t.encoding=o,t.mimeTypes=i,t.MultiPart=s.default,t.readFile=u.default,t.default=c.default,t.HttpClient=c.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,I.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function f(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=f(t[0],n);return t.every(function(e){return f(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return f(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,I.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+f(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,p=r(n(3)),h=r(n(5)),y=r(n(29)),T=r(n(10)),I=r(n(4)),g=r(n(9)),v=r(n(6)),m=r(n(1)),b=r(n(2)),w=r(n(8)),_=r(n(7)),x=r(n(36)),E=r(n(15)),A=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),k=n(23),O=r(n(27)),j=(a=E.default,(0,_.default)(S,a),(0,b.default)(S,[{key:"start",value:(l=(0,g.default)(T.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w=t.organizationId,_=t.recipients,x=t.payload,E=t.context,k=void 0===E?{}:E;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}throw new A.ValidationError("organizationId","required");case 2:if(_){e.next=4;break}throw new A.ValidationError("recipients","required");case 4:if(x){e.next=6;break}throw new A.ValidationError("payload","required");case 6:if(_.length){e.next=8;break}throw new A.ValidationError("recipients array","required");case 8:if(n=x.callId,r=x.callerId,a=x.date,o=x.groupId,i=x.identity,s=x.isVideo,u=x.name,c=x.networkType,l=x.orgId,d=x.participantsTokens,f=x.recipientToken,p=x.roleTokens,n){e.next=11;break}throw new A.ValidationError("payload.callId","required");case 11:if(r){e.next=13;break}throw new A.ValidationError("payload.callerId","required");case 13:if(a){e.next=15;break}throw new A.ValidationError("payload.date","required");case 15:if(o){e.next=17;break}throw new A.ValidationError("payload.groupId","required");case 17:if(i){e.next=19;break}throw new A.ValidationError("payload.identity","required");case 19:if(s){e.next=21;break}throw new A.ValidationError("payload.isVideo","required");case 21:if(u){e.next=23;break}throw new A.ValidationError("payload.name","required");case 23:if(c){e.next=25;break}throw new A.ValidationError("payload.networkType","required");case 25:if(l){e.next=27;break}throw new A.ValidationError("payload.orgId","required");case 27:if(d){e.next=29;break}throw new A.ValidationError("payload.participantsTokens","required");case 29:if(f){e.next=31;break}throw new A.ValidationError("payload.recipientToken","required");case 31:if(p){e.next=33;break}throw new A.ValidationError("payload.roleTokens","required");case 33:return e.next=35,this.host.api.calls.start({organization:w,recipients:_,payload:O.default.underscoreObject(x),context:k});case 35:if(h=e.sent,y=h.accessToken,g=h.roomName,v=h.disabledParticipants,m=void 0===v?{}:v,b={},!g){e.next=43;break}if(b=this.host.models.Call.inject({id:g,payload:x,accessToken:y,roomName:g}),"patient"===c&&(0,I.default)(m).length)return e.next=43,this.host.api.calls.state(g,l,{callId:n,payload:{callState:"disabled_participants",disabledParticipants:m}});e.next=43;break;case 43:return e.abrupt("return",b);case 44:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"decline",value:(c=(0,g.default)(T.default.mark(function e(t){var n,r,a,o,i,s=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).payload;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+f(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 4:if(n=this._resolveModelId(t),t=this._resolveEntity(n,"call"),a=(r=t).callId,o=r.organizationId,i=r.id,o){e.next=9;break}throw new A.ValidationError("organizationId","required");case 9:if(s){e.next=11;break}throw new A.ValidationError("payload","required");case 11:if(i){e.next=13;break}throw new A.ValidationError("roomName","required");case 13:if(a){e.next=15;break}throw new A.ValidationError("callId","required");case 15:return e.next=17,this.host.api.calls.decline(i,o,{callId:a,payload:s});case 17:return e.abrupt("return");case 18:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"end",value:(u=(0,g.default)(T.default.mark(function e(t,n){var r,a,o,i,s,u=n.payload,c=n.reason;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+f(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 4:if(r=this._resolveModelId(t),t=this._resolveEntity(r,"call"),o=(a=t).callId,i=a.organizationId,s=a.id,i){e.next=9;break}throw new A.ValidationError("organizationId","required");case 9:if(u){e.next=11;break}throw new A.ValidationError("payload","required");case 11:if(c){e.next=13;break}throw new A.ValidationError("reason","required");case 13:if(s){e.next=15;break}throw new A.ValidationError("roomName","required");case 15:if(o){e.next=17;break}throw new A.ValidationError("callId","required");case 17:return e.next=19,this.host.api.calls.end(s,i,{callId:o,payload:u,reason:c});case 19:return e.abrupt("return");case 20:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"join",value:(s=(0,g.default)(T.default.mark(function e(t){var n,r,a,o,i;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+f(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 4:if(n=this._resolveModelId(t),t=this._resolveEntity(n,"call"),a=(r=t).organizationId,o=r.id,a){e.next=9;break}throw new A.ValidationError("organizationId","required");case 9:if(o){e.next=11;break}throw new A.ValidationError("roomName","required");case 11:return e.next=13,this.host.api.calls.join(o,a);case 13:return i=e.sent,e.abrupt("return",O.default.camelizeObject(i));case 15:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"answer",value:(i=(0,g.default)(T.default.mark(function e(t){var n,r,a,o,i,s,u=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).payload;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+f(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 4:if(n=this._resolveModelId(t),t=this._resolveEntity(n,"call"),a=(r=t).callId,o=r.organizationId,i=r.id){e.next=9;break}throw new A.ValidationError("roomName","required");case 9:if(o){e.next=11;break}throw new A.ValidationError("organizationId","required");case 11:if(u){e.next=13;break}throw new A.ValidationError("payload","required");case 13:if(a){e.next=15;break}throw new A.ValidationError("callId","required");case 15:return e.next=17,this.host.api.calls.answer(i,o,{payload:u,callId:a});case 17:return s=e.sent,e.abrupt("return",O.default.camelizeObject(s));case 19:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"invite",value:(o=(0,g.default)(T.default.mark(function e(t,n){var r,a,o,i,s,u=n.currentUserId,c=n.payload,l=n.recipients;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+f(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "call" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 4:if(r=this._resolveModelId(t),t=this._resolveEntity(r,"call"),o=(a=t).callId,i=a.organizationId,s=a.id,i){e.next=9;break}throw new A.ValidationError("organizationId","required");case 9:if(s){e.next=11;break}throw new A.ValidationError("roomName","required");case 11:if(c){e.next=13;break}throw new A.ValidationError("payload","required");case 13:if(l){e.next=15;break}throw new A.ValidationError("recipients","required");case 15:if(o){e.next=17;break}throw new A.ValidationError("callId","required");case 17:if(u){e.next=19;break}throw new A.ValidationError("currentUserId","required");case 19:return e.next=21,this.host.api.calls.invite(s,i,{callId:o,payload:c,recipients:l});case 21:return e.next=23,this.host.api.calls.state(s,i,{callId:o,payload:{callState:"participants_updated",inviteInitiator:u,newParticipants:l,roleTokens:{}}});case 23:return e.abrupt("return");case 24:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"reactToVoipSSE",value:function(e){var t=e.data,n=e.type;if("provider"!==(0,x.default)(t,"payload.network_type")){t=(0,k.jsonCloneDeep)(t);var r=n.split(":")[1],a=this.host.models.Call.inject((0,y.default)(t,{callStatus:r}));this.emit(r,a)}}}]),S);function S(){return(0,m.default)(this,S),(0,w.default)(this,(S.__proto__||(0,v.default)(S)).apply(this,arguments))}t.default=j,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function B(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,$.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=B(t[0],n);return t.every(function(e){return B(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return B(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,F.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,U.default)(e))+": "+B(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function K(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,$.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=K(t[0],n);return t.every(function(e){return K(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return K(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,F.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,U.default)(e))+": "+K(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P,V,G,N,U=r(n(3)),F=r(n(4)),$=r(n(5)),D=r(n(11)),q=r(n(34)),L=r(n(18)),Z=r(n(19)),H=r(n(10)),W=r(n(30)),X=r(n(9)),Q=r(n(12)),Y=r(n(16)),J=r(n(13)),ee=r(n(6)),te=r(n(1)),ne=r(n(2)),re=r(n(8)),ae=r(n(7)),oe=r(n(31)),ie=r(n(273)),se=r(n(36)),ue=r(n(58)),ce=r(n(25)),le=r(n(15)),de=r(n(55)),fe=r(n(250)),pe=r(n(56)),he=r(n(35)),ye=r(n(89)),ge=r(n(62)),ve=n(20),me=r(n(86)),be=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),we=n(26),_e=n(41),xe=r(_e),Ee=n(23),ke=n(32),Te=n(28),Ie=n(44),Ae=new me.default.MD5,Oe=[we.MessageType.ESCALATION_EXECUTION_CHANGE,we.MessageType.GROUP_MEMBERSHIP_CHANGE],je=xe.default.toServer(xe.default.DELIVERED),Se=(o={},(0,oe.default)(o,we.EscalationChangeAction.ACKNOWLEDGED,"Acknowledged"),(0,oe.default)(o,we.EscalationChangeAction.CANCELLED,"Cancelled"),(0,oe.default)(o,we.EscalationChangeAction.INITIATED,"Initiated"),(0,oe.default)(o,we.EscalationChangeAction.MEMBER_ADDED,"Added"),(0,oe.default)(o,we.EscalationChangeAction.NO_RESPONSE,"ended with No Response"),o),Me=[we.GroupType.GROUP,we.GroupType.FORUM,we.GroupType.ROLE_ASSIGNMENT,we.GroupType.ROLE_P2P],Re=(i={},(0,oe.default)(i,"ADD","added"),(0,oe.default)(i,"JOIN","joined"),(0,oe.default)(i,"LEAVE","left"),(0,oe.default)(i,"REMOVE","removed"),(0,oe.default)(i,"DENY","declined"),i),ze=(s={},(0,oe.default)(s,"ADD","to"),(0,oe.default)(s,"REMOVE","from"),(0,oe.default)(s,"DENY","to join"),s),Ce=(u={},(0,oe.default)(u,we.GroupType.ACTIVATED_TEAM,"group"),(0,oe.default)(u,we.GroupType.ESCALATION,"escalation"),(0,oe.default)(u,we.GroupType.FORUM,"forum"),(0,oe.default)(u,we.GroupType.GROUP,"group"),(0,oe.default)(u,we.GroupType.PATIENT_CARE,"care team"),(0,oe.default)(u,we.GroupType.ROLE_P2P,"conversation"),(0,oe.default)(u,we.GroupType.PATIENT_MESSAGING,"group"),(0,oe.default)(u,we.GroupType.INTRA_TEAM,"team"),u),Pe=[xe.default.NEW,xe.default.DELIVERED],Ve=xe.default.toServer(xe.default.READ),Ge=(c={},(0,oe.default)(c,"OPT_IN","opted into"),(0,oe.default)(c,"OPT_OUT","opted out of"),c),Ne=(l=(0,ve.decorator)(),d=(0,ve.decorator)(),f=(0,ve.decorator)(),h=le.default,(0,ae.default)(Ue,h),(0,ne.default)(Ue,[{key:"mounted",value:function(){this.__escalationEnabledOrganizations=[],this.__queuedConversationsToReload=[],this._convByConvHandle={},this._fetched=!1,this._roleConversationsProcessingEvent={},this._rolesFriendsEventPromise=null,this.host.on("message:sending",this._onSendingMessage),this.host.on("message:sent",this._onSentMessage),this.host.models.Group.on("afterEject",this._onRemoveGroup),this.host.models.Group.on("afterInject",this._onChangeGroup),this.host.models.Team.on("afterEject",this._onRemoveTeam),this.host.models.Message.on("afterInject",this._onChangeMessage),this.host.models.Message.on("afterEject",this._onRemoveMessage),this.host.models.Organization.on("afterInject",this._onChangeOrganization)}},{key:"dispose",value:function(){this._convByConvHandle={},this._fetched=!1,this._rolesFriendsEventPromise=null,this.__escalationEnabledOrganizations=[],this.__queuedConversationsToReload=[],this.host.removeListener("message:sending",this._onSendingMessage),this.host.removeListener("message:sent",this._onSentMessage),this.host.models.Group.removeListener("afterEject",this._onRemoveGroup),this.host.models.Group.removeListener("afterInject",this._onChangeGroup),this.host.models.Team.removeListener("afterEject",this._onRemoveTeam),this.host.models.Message.removeListener("afterInject",this._onChangeMessage),this.host.models.Message.removeListener("afterEject",this._onRemoveMessage),this.host.models.Organization.removeListener("afterInject",this._onChangeOrganization)}},{key:"clearTimeline",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).emit,n=void 0===t||t;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(e));var r=this._resolveEntity(e,"conversation");if(!r)throw new be.NotFoundError(this.host.models.Conversation.name,e);e=this._resolveModelId(e),this.clearMessageStatuses(r,{emit:!1});var a=r.higherContinuation,o=r.lowerContinuation,i=r.timeline,s=0;if(!i||"function"!=typeof i[J.default]&&!Array.isArray(i))throw new TypeError("Expected timeline to be iterable, got "+B(i));if(!i||"function"!=typeof i[J.default]&&!Array.isArray(i))throw new TypeError("Expected timeline to be iterable, got "+K(i));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,Q.default)(i);!(u=(d=f.next()).done);u=!0){var p=d.value;p.isEphemeral||(p.inTimeline=!1,s+=1)}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}return r.isLive=!1,a.itemsEstimate=null,o.itemsEstimate=null,n&&this.emit("clearTimeline",e),this.config.condensedReplays?this.host.models.Conversation.inject(r):this.__reloadConversation(r,{notify:!1}),s}},{key:"fetchTimeline",value:(N=(0,X.default)(H.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=P.anchorPoint,G=void 0===V?we.ConversationAnchorPoints.CONVERSATION_END:V,N=P.continuation,U=P.fetchAllItems,F=void 0!==U&&U,$=P.markAsDelivered,D=void 0===$||$,q=P.maxItems,L=void 0===q?15:q;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 7:if(t=this._resolveModelId(t),this.config.condensedReplays)return e.next=11,this._fetchTimelineCR(t,{anchorPoint:G,continuation:N,conversation:n,fetchAllItems:F,markAsDelivered:D,maxItems:L});e.next=13;break;case 11:return r=e.sent,e.abrupt("return",r);case 13:if(a=n.content,o=n.timeline,i=n.firstUnreadMessage,s=a.length,u=0,c=[],l=s-L,d=s,G!==we.ConversationAnchorPoints.CONVERSATION_END){e.next=24;break}this.clearTimeline(n,{emit:!1}),e.next=105;break;case 24:if(G!==we.ConversationAnchorPoints.FIRST_UNREAD_ITEM){e.next=62;break}if(this.clearTimeline(n,{emit:!1}),f=-1,!a||"function"!=typeof a[J.default]&&!Array.isArray(a))throw new TypeError("Expected content to be iterable, got "+B(a));e.next=29;break;case 29:if(!a||"function"!=typeof a[J.default]&&!Array.isArray(a))throw new TypeError("Expected content to be iterable, got "+K(a));e.next=31;break;case 31:h=!(p=!0),y=void 0,e.prev=34,g=(0,Q.default)(a);case 36:if(p=(v=g.next()).done){e.next=45;break}if(m=v.value,d=++f,i===m)return e.abrupt("break",45);e.next=42;break;case 42:p=!0,e.next=36;break;case 45:e.next=51;break;case 47:e.prev=47,e.t0=e.catch(34),h=!0,y=e.t0;case 51:e.prev=51,e.prev=52,!p&&g.return&&g.return();case 54:if(e.prev=54,h)throw y;e.next=57;break;case 57:return e.finish(54);case 58:return e.finish(51);case 59:d<a.length&&(d=Math.min(d+L,a.length)),e.next=105;break;case 62:if(G!==we.ConversationAnchorPoints.CONTINUATION){e.next=105;break}if(b=o[0]?o[0].sortNumber:1/0,w=o[o.length-1]?o[o.length-1].sortNumber:0,0!==(_="LOWER"===N?b:w)){e.next=70;break}d-=L,e.next=105;break;case 70:if(x=-1,!a||"function"!=typeof a[J.default]&&!Array.isArray(a))throw new TypeError("Expected content to be iterable, got "+B(a));e.next=73;break;case 73:if(!a||"function"!=typeof a[J.default]&&!Array.isArray(a))throw new TypeError("Expected content to be iterable, got "+K(a));e.next=75;break;case 75:k=!(E=!0),T=void 0,e.prev=78,I=(0,Q.default)(a);case 80:if(E=(A=I.next()).done){e.next=91;break}if(O=A.value,d=++x,"HIGHER"===N&&O.sortNumber>_)return e.abrupt("break",91);e.next=86;break;case 86:if("LOWER"===N&&O.sortNumber>=_)return e.abrupt("break",91);e.next=88;break;case 88:E=!0,e.next=80;break;case 91:e.next=97;break;case 93:e.prev=93,e.t1=e.catch(78),k=!0,T=e.t1;case 97:e.prev=97,e.prev=98,!E&&I.return&&I.return();case 100:if(e.prev=100,k)throw T;e.next=103;break;case 103:return e.finish(100);case 104:return e.finish(97);case 105:if(G!==we.ConversationAnchorPoints.CONVERSATION_END&&(G===we.ConversationAnchorPoints.CONTINUATION&&"HIGHER"===N?s=(l=d)+L:(d===a.length-1&&(d+=1),l=(s=d)-L)),s=Math.min(s,a.length+1),l=Math.max(l,0),c.push.apply(c,(0,W.default)(a.slice(l,s))),!c||"function"!=typeof c[J.default]&&!Array.isArray(c))throw new TypeError("Expected messagesToAdd to be iterable, got "+B(c));e.next=111;break;case 111:if(!c||"function"!=typeof c[J.default]&&!Array.isArray(c))throw new TypeError("Expected messagesToAdd to be iterable, got "+K(c));e.next=113;break;case 113:for(S=!(j=!0),M=void 0,e.prev=116,R=(0,Q.default)(c);!(j=(z=R.next()).done);j=!0)(C=z.value).inTimeline||(C.inTimeline=!0,this.host.models.Message.inject(C),u+=1);e.next=124;break;case 120:e.prev=120,e.t2=e.catch(116),S=!0,M=e.t2;case 124:e.prev=124,e.prev=125,!j&&R.return&&R.return();case 127:if(e.prev=127,S)throw M;e.next=130;break;case 130:return e.finish(127);case 131:return e.finish(124);case 132:return e.abrupt("return",u);case 133:case"end":return e.stop()}},e,this,[[34,47,51,59],[52,,54,58],[78,93,97,105],[98,,100,104],[116,120,124,132],[125,,127,131]])})),function(e){return N.apply(this,arguments)})},{key:"_fetchTimelineCR",value:(G=(0,X.default)(H.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},j=O.anchorPoint,S=void 0===j?we.ConversationAnchorPoints.CONVERSATION_END:j,M=O.continuation,R=O.conversation,z=O.fetchAllItems,C=void 0!==z&&z,P=O.markAsDelivered,V=void 0===P||P,G=O.maxItems,N=void 0===G?15:G;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(S!==we.ConversationAnchorPoints.CONTINUATION&&R.isLive&&(!C&&R.timeline.length>=N||R.lowerContinuation&&0===R.lowerContinuation.itemsEstimate))return e.abrupt("return",0);e.next=2;break;case 2:return S===we.ConversationAnchorPoints.CONVERSATION_END?this.clearTimeline(R,{emit:!1}):S===we.ConversationAnchorPoints.FIRST_UNREAD_ITEM&&(R.firstUnreadMessage=null,this.clearTimeline(R,{emit:!1})),e.next=5,this.host.api.conversations.fetchTimeline(t,we.ConversationAnchorPoints.toServer(S),N,{continuation:M,markAsDelivered:V});case 5:if(n=e.sent,r=n.direction,a=n.higher_continuation,o=n.lower_continuation,i=n.max_items,s=n.timeline,u=R.higherContinuation,c=R.lowerContinuation,l=null,i&&(N=i),!s||"function"!=typeof s[J.default]&&!Array.isArray(s))throw new TypeError("Expected timeline to be iterable, got "+B(s));e.next=16;break;case 16:if(!s||"function"!=typeof s[J.default]&&!Array.isArray(s))throw new TypeError("Expected timeline to be iterable, got "+K(s));e.next=18;break;case 18:for(f=!(d=!0),p=void 0,e.prev=21,h=(0,Q.default)(s);!(d=(y=h.next()).done);d=!0)g=y.value,"tigertext:iq:bang"===(v=g.xmlns)?(m=g.bang_id||""+g.sort_number)?this.host.groups.__handleBang({data:g,eventId:m,alwaysAddToTimeline:!0}):this.logger.warn("Skipping bang with no event id"):"tigertext:iq:message"===v||"tigertext:iq:group_message"===v?(g.conversation_id||(g.conversation_id=t),b=this._reactToMessageEventCR({data:g,injectConversation:!1}),(w=b.message).inTimeline=!0,w.isOutgoing||(_={id:w.id+":"+w.counterPartyId,messageId:w.id,status:xe.default.resolve(g.status),userId:this.host.currentUserId},this.host.models.MessageStatusPerRecipient.inject(_)),w.senderStatus=we.MessageSenderStatus.SENT,x=this.host.models.Message.inject(w),l=l||x):this.logger.warn("Skipping timeline entry with unrecognized xmlns: "+v);e.next=29;break;case 25:e.prev=25,e.t0=e.catch(21),f=!0,p=e.t0;case 29:e.prev=29,e.prev=30,!d&&h.return&&h.return();case 32:if(e.prev=32,f)throw p;e.next=35;break;case 35:return e.finish(32);case 36:return e.finish(29);case 37:if("Higher"!==r&&"Initial"!==r||(E=0===s.length||s.length<N?0:1,S===we.ConversationAnchorPoints.CONVERSATION_END&&(E=0),1===E&&"Initial"===r&&(k=s[s.length-1],T=R.lastMessage,S===we.ConversationAnchorPoints.FIRST_UNREAD_ITEM&&l&&!l.isUnread?E=0:T&&k.message_id===T.id&&(E=T.isUnread?1:0)),u={continuation:{higher_continuation:a},itemsEstimate:E}),"Lower"!==r&&"Initial"!==r||(I=0===s.length||s.length<N?0:1,c={continuation:{lower_continuation:o},itemsEstimate:I}),A=s.length,R.isLive=0===u.itemsEstimate,R.higherContinuation=u,R.lowerContinuation=c,this.host.models.Conversation.inject(R),S!==we.ConversationAnchorPoints.CONTINUATION&&void 0!==R.lowestSortNumber)return e.next=47,this.markAsDelivered(R.id);e.next=47;break;case 47:return e.abrupt("return",A);case 48:case"end":return e.stop()}},e,this,[[21,25,29,37],[30,,32,36]])})),function(e){return G.apply(this,arguments)})},{key:"findAll",value:(V=(0,X.default)(H.default.mark(function e(){var t,n,r,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,ce.default)(a,{includeMutes:!0}),this.config.condensedReplays&&(a.includeMutes=!1),this._fetched)return e.abrupt("return",this.getAll());e.next=4;break;case 4:return e.next=6,L.default.all([this.host.api.roster.findAll(),a.includeMutes?this.host.mute.findAll():L.default.resolve()]);case 6:if(t=e.sent,n=(0,Z.default)(t,1),r=n[0],this.config.condensedReplays)return e.abrupt("return",this._processFindAllCR(r));e.next=13;break;case 13:return e.abrupt("return",this._processFindAll(r));case 14:case"end":return e.stop()}},e,this)})),function(){return V.apply(this,arguments)})},{key:"findAllForOrganization",value:(P=(0,X.default)(H.default.mark(function e(t){var n;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._resolveModelIdWithTypes(t,"organization"),this.config.condensedReplays){e.next=3;break}throw new be.NotSupportedError("findAllForOrganization() may not be called if this.config.condensedReplays=false");case 3:if(this._fetched)return e.abrupt("return",this.getAllForOrganization(t));e.next=5;break;case 5:return e.next=7,this.host.api.roster.findAll({organizationId:t});case 7:return n=e.sent,e.abrupt("return",this._processFindAllCR(n));case 9:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"_processFindAllCR",value:function(e){for(var t=[],n=[],r={counterParty:"full",groupMembers:"full",organization:"placeholder"},a=0;a<e.length;a++){var o=e[a],i=o.entity;if(i){var s=this.host.modelNameByEntityType(i.type);"user"===s?n.push({rawConversation:o,origIndex:a}):s&&t.push({rawConversation:o,origIndex:a})}}if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected users to be iterable, got "+B(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected users to be iterable, got "+K(n));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,Q.default)(n);!(u=(d=f.next()).done);u=!0){var p=d.value,h=p.rawConversation,y=p.origIndex;p.conversation=this.__injectConversation(h,{origIndex:y})}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}if(!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected nonUsers to be iterable, got "+B(t));if(!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected nonUsers to be iterable, got "+K(t));var g=!0,v=!1,m=void 0;try{for(var b,w=(0,Q.default)(t);!(g=(b=w.next()).done);g=!0){var _=b.value,x=_.rawConversation,E=_.origIndex;_.conversation=this.__injectConversation(x,{hasCurrentUser:!0,origIndex:E})}}catch(e){v=!0,m=e}finally{try{!g&&w.return&&w.return()}finally{if(v)throw m}}for(var k=[];0<t.length||0<n.length;){var T=(0===t.length?n.shift():0===n.length?t.shift():t[0].origIndex<n[0].origIndex?t.shift():n.shift()).conversation;this.__ensureEntities(T,r),k.push(T)}return this._fetched=!0,k}},{key:"_processFindAll",value:function(e){for(var t=[],n=[],r=[],a=0;a<e.length;a++){var o=e[a],i=o,s=i.organization_key,u=i.type,c=(0,q.default)(i,["organization_key","type"]),l=this.host.modelNameByTypeNS(u);if(c.organizationId=s,"user"===(o={entityAttrs:c,entityType:l,organizationId:s,origIndex:a}).entityType)o.counterParty=this.__injectCounterParty(o),r.push(o);else if(o.entityType){if("group"===l&&(o.groupType=this.host.groups.__extractGroupTypeFromAttrs(c)),o.groupType===we.GroupType.FORUM)delete c.members;else if(o.groupType===we.GroupType.PATIENT_MESSAGING&&o.entityAttrs&&o.entityAttrs.metadata){var d=o.entityAttrs,f=d.avatar,p=d.display_name,h=d.metadata,y=h.patient_id,g=h.patient_contact_id;this.host.models.User.injectPlaceholder({id:g||y,avatar:f,displayName:p,metadata:h})}n.push(o)}}if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected toProcess to be iterable, got "+B(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected toProcess to be iterable, got "+K(n));var v=!0,m=!1,b=void 0;try{for(var w,_=(0,Q.default)(n);!(v=(w=_.next()).done);v=!0){var x=w.value;x.counterParty=this.__injectCounterParty((0,Y.default)({},x,{hasCurrentUser:!0})),t.push(x)}}catch(e){m=!0,b=e}finally{try{!v&&_.return&&_.return()}finally{if(m)throw b}}for(var E=[];0<t.length||0<r.length;){var k=0===t.length?r.shift():0===r.length?t.shift():t[0].origIndex<r[0].origIndex?t.shift():r.shift(),T=k.conversationId,I=k.counterParty,A=k.lastMessage,O=k.muted,j=(s=k.organizationId,k.entityType),S=k.groupType,M="group"===j&&S&&"PATIENT_MESSAGING"===S?we.Networks.PATIENT:we.Networks.PROVIDER;delete I.$placeholder;var R=void 0;this.host.config.condensedReplays&&A&&A.sort_number&&(R=A.sort_number);var z=this.ensureConversation(I.$entityType,I.id,s,{conversationId:T,ensureEntities:{counterParty:"full",groupMembers:"full",organization:"placeholder"},highestSortNumber:R,muted:O,network:M});z._counterPartyAddedOnServer=!0,E.push(z)}return this._fetched=!0,E}},{key:"find",value:(C=(0,X.default)(H.default.mark(function e(t){var n,r,a,o,i,s,u,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));e.next=4;break;case 4:if(c=(0,ue.default)(c,{ensureEntities:{counterParty:"full",escalationExecution:"full",groupMembers:"placeholder",messageCounterParties:"full",organization:"placeholder",touchOnRelatedEntityLoad:!1}}),n=void 0,!this.config.condensedReplays){e.next=19;break}if((n=this.getById(t))&&n.$localOnly){e.next=17;break}return e.next=11,this.host.api.conversations.find(t);case 11:if(r=e.sent){e.next=14;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 14:if(n=this.__injectConversation(r)){e.next=17;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 17:e.next=28;break;case 19:if(o=(a=c).groupId,i=a.organizationId,s=a.includeMutes,u=o&&i?this.getConversationKey("group",o,i):t,n=this.getById(u)){e.next=26;break}return e.next=25,this.findAll({includeMutes:s});case 25:n=this.getById(u);case 26:if(n){e.next=28;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 28:if(c.ensureEntities)return e.next=31,this.__ensureEntities(n,c.ensureEntities);e.next=31;break;case 31:return e.abrupt("return",n);case 32:case"end":return e.stop()}},e,this)})),function(e){return C.apply(this,arguments)})},{key:"__injectConversation",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.hasCurrentUser,r=t.highestSortNumber,a=t.origIndex,o=void 0===a?this.host.models.Conversation.getAll().length:a,i=void 0,s=e.conversation_id,u=e.entity,c=e.first_expiring_unread_message,l=e.in_progress_escalation_count,d=e.last_message,f=e.lowest_sort_number,p=e.muted,h=e.organization_id,y=e.unread_message_count,g=e.unread_priority_message_count,v=this.getById(s);if(v)i=v.counterParty,h=v.organizationId;else{if(h=h||e.organization_key,!p&&u&&u.muted&&(p=u.muted,delete u.muted),u&&(i=this.__injectCounterParty({conversationId:s,entityAttrs:u,entityType:u.$entityType,hasCurrentUser:n,organizationId:h})),!i)return null;delete i.$placeholder,v=v||this.host.models.Conversation.createInstance({id:s,counterParty:i,organizationId:h,_origIndex:o})}var m=i,b=m.id,w=m.$entityType,_=m.groupType;if("group"!==w||_!==we.GroupType.FORUM||i.hasCurrentUser||(d=null),c?(d&&(d.message_id===c.message_id?c=d:(c.senderId=d.sender_token,c.senderOrganizationId=d.sender_organization)),v.firstExpiringUnreadMessage=this._ensureFirstExpiringUnreadMessage({rawFirstExpiringUnreadMessage:c,conversationId:s,counterParty:i})):null===c&&(v.firstExpiringUnreadMessage=null),void 0!==d){var x=d?this._ensureLastMessage({rawLastMessage:d,conversationId:s,counterParty:i}):null;if(x&&x.isEphemeral){var E=v.lastEphemeralMessage;(!E||x.sortNumber>E.sortNumber)&&(v.lastEphemeralMessage=x)}if(v.lastEphemeralMessage){var k=v.lastEphemeralMessage;(!x||k.sortNumber>x.sortNumber)&&(x=k)}v.lastMessage=x,void 0===r&&d&&d.sort_number&&(r=d.sort_number)}v._counterPartyAddedOnServer=!0,u&&u.metadata&&(v.metadata=u.metadata),void 0!==r&&r>v.highestSortNumber&&(v.highestSortNumber=r),void 0!==f&&0!==f&&(v.lowestSortNumber=f),void 0!==l&&(v.inProgressEscalationCount=l),void 0!==p&&(v.muted=p),v._markingAsRead&&(void 0===r||r<=v._markingAsReadSortNumber)||(void 0!==y&&(v.unreadCount=y),void 0!==g&&(v.unreadPriorityCount=g)),this.host.models.Conversation.inject(v);var T=this.getConversationKey(w,b,h);return this._convByConvHandle[T]=v}},{key:"refetch",value:(z=(0,X.default)(H.default.mark(function e(){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},e,this)})),function(){return z.apply(this,arguments)})},{key:"_ensureLastMessage",value:function(e){var t=e.rawLastMessage,n=e.conversationId,r=e.counterParty,a=t.message_id,o=(0,q.default)(t,["message_id"]);if(!a)return null;var i=this.host.messages.getById(a);return i?(i.shouldEnsureRecipientStatus=!0,i.senderStatus=we.MessageSenderStatus.SENT,this.host.models.Message.inject(i)):(o.senderStatus=we.MessageSenderStatus.SENT,o.id=a,o.shouldEnsureRecipientStatus=!0,o.conversationId=n,o.counterParty=r,i=this.host.models.Message.injectPlaceholder(o)),i}},{key:"_ensureFirstExpiringUnreadMessage",value:function(e){var t=e.rawFirstExpiringUnreadMessage,n=e.conversationId,r=e.counterParty,a=t.expire_in,o=t.message_id,i=(0,q.default)(t,["expire_in","message_id"]);if(o){var s=this.host.messages.getById(o);return s?(s.shouldEnsureRecipientStatus=!0,s.expireIn=a,this.host.models.Message.inject(s)):(i.id=o,i.shouldEnsureRecipientStatus=!0,i.expireIn=a,i.conversationId=n,i.counterParty=r,s=this.host.models.Message.injectPlaceholder(i)),s}return null}},{key:"markAsDelivered",value:(R=(0,X.default)(H.default.mark(function e(t){var n,r,a;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 7:if(t=this._resolveModelId(t),this.config.condensedReplays)return r=n.highestSortNumber,a=n.lowestSortNumber,e.prev=10,e.next=13,this.host.api.conversations.updateConversationStatus(t,je,{highestSortNumber:r,lowestSortNumber:a});e.next=22;break;case 13:n.lowestSortNumber=null,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),this.logger.warn("failed to mark conversation "+t+" as delivered");case 19:this.host.models.Conversation.inject(n),e.next=23;break;case 22:return e.abrupt("return",this.host.messages.markAsDelivered(n.messages));case 23:case"end":return e.stop()}},e,this,[[10,16]])})),function(e){return R.apply(this,arguments)})},{key:"markAsRead",value:(M=(0,X.default)(H.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 7:if(t=this._resolveModelId(t),!this.config.condensedReplays){e.next=29;break}if(r=n.highestSortNumber,a=n.unreadCount,n._markingAsRead){e.next=17;break}if(0===a)return e.abrupt("return");e.next=13;break;case 13:n._markingAsRead=!0,n._markingAsReadSortNumber=r,n._markingAsReadExpiration=(new Date).getTime()+3e4,this.__reloadConversation(n);case 17:if(o.localOnly)return e.abrupt("return");e.next=19;break;case 19:return e.prev=19,e.next=22,this.host.api.conversations.updateConversationStatus(t,Ve,{highestSortNumber:r});case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(19),this.logger.warn("failed to mark conversation "+t+" as read");case 27:e.next=30;break;case 29:return e.abrupt("return",this.host.messages.markAsRead(n.markableAsReadMessages,o));case 30:case"end":return e.stop()}},e,this,[[19,24]])})),function(e){return M.apply(this,arguments)})},{key:"add",value:(S=(0,X.default)(H.default.mark(function e(t,n,r){var a;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(r));e.next=12;break;case 12:return a=this.ensureConversation(t,n,r),e.prev=13,e.next=16,this.host.api.roster.add(t,n,r);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),this.logger.warn("can't add "+n+" "+t,e.t0);case 21:a._counterPartyAddedOnServer=!0;case 22:case"end":return e.stop()}},e,this,[[13,18]])})),function(e,t,n){return S.apply(this,arguments)})},{key:"remove",value:(j=(0,X.default)(H.default.mark(function e(t){var n,r,a,o;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 4:if(t=this._resolveModelId(t),n=this._resolveEntity(t,"conversation")){e.next=8;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 8:return r=n.counterPartyId,a=n.counterPartyType,o=n.organizationId,e.prev=9,e.next=12,this.host.api.roster.remove(a,r,o);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),this.logger.warn("can't remove conversation "+t);case 17:case"end":return e.stop()}},e,this,[[9,14]])})),function(e){return j.apply(this,arguments)})},{key:"ensureConversation",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(n));var a=(r=(0,ue.default)(r,{ensureEntities:{counterParty:!1,organization:!1,messageCounterParties:!1,groupMembers:!1,touchOnRelatedEntityLoad:!0}})).conversationId,o=this.getConversationKey(e,t,n);if(this.config.condensedReplays&&!a){var i=this._convByConvHandle[o];i&&(a=i.id)}a=a||o;var s=this.getById(a);if(s){this.__ensureEntities(s,r.ensureEntities);var u=!1;return this.config.condensedReplays&&void 0!==r.highestSortNumber&&(s.highestSortNumber=r.highestSortNumber,u=!0),this.config.condensedReplays&&void 0!==r.muted&&(s.muted=r.muted,u=!0),this._convByConvHandle[o]=s,u&&this.host.models.Conversation.inject(s),s}var c={id:a,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length};r.highestSortNumber&&(c.highestSortNumber=r.highestSortNumber),r.muted&&(c.muted=r.muted),r.network&&(c.network=r.network);var l=this.host.models.Group.get(t);l&&l.groupType===we.GroupType.PATIENT_MESSAGING&&(c.network=we.Networks.PATIENT);var d=this.host.metadata.get(t,n);if(d){var f=d.data;c.metadata=f}return s=this.host.models.Conversation.createInstance(c),this.__ensureEntities(s,r.ensureEntities),this.host.models.Conversation.inject(s),this._convByConvHandle[o]=s}},{key:"__ejectConversation",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));var t=this.getById(e);if(t){var n=t.counterPartyType,r=t.counterPartyId,a=t.organizationId,o=this.getConversationKey(n,r,a);delete this._convByConvHandle[o],this.host.models.Conversation.eject(t),this.__queuedConversationsToReload=this.__queuedConversationsToReload.filter(function(e){return e.id!==t.id})}return t}},{key:"reactToMessageEvent",value:function(e){var t=e.data;if(this.config.condensedReplays)this.reactToMessageEventCR({data:t});else{var n=this._reactToMessageEvent({data:t}),r=n.message,a=n.conversation;this.host.models.Message.inject(r),this.emit("message",r),a&&(this.__addConversationCounterPartyToServerRosterIfShould(a),a.emit("message",r),this.config.condensedReplays&&a._markingAsRead&&r.sortNumber>a._markingAsReadSortNumber&&this.__clearOptimisticStatus([a])),_e.MESSAGE_STATUS_ORDER[r.markedRecipientStatus]<_e.MESSAGE_STATUS_ORDER[xe.default.DELIVERED]&&this.host.messages.markAsReceived(r,{})}}},{key:"reactToMessageEventCR",value:function(e){var t=e.data,n={},r=this._reactToMessageEventCR({data:t}),a=r.message,o=r.conversation;this.emit("message",a),o&&(this.__addConversationCounterPartyToServerRosterIfShould(o),o.emit("message",a)),n.queue=!0,this.host.messages.markAsReceived(a,n)}},{key:"_reactToMessageEvent",value:function(e){var t=e.data,n=e.conversationId,r=void 0===n?null:n;t=(0,Ee.jsonCloneDeep)(t);var a=this.host.currentUserId,o=t.recipient_status;o=o||[];var i={status:t.status,timestamp:t.created_time};t.team_request&&this.host.teams.__injectTeamRequest(t.team_request);var s=this.host.models.Message.parseAttrs(t);s.messageType=we.MessageType.USER_SENT;var u=!0;if(s.groupId)s.counterPartyType="group",s.counterPartyId=s.groupId;else if(s.recipientId){if(this.host.distributionLists.getById(s.recipientId))s.counterPartyType="distributionList";else if(this.host.users.getById(s.recipientId))s.counterPartyType="user";else{u=!1;var c=this.host.messages._looksLikeDistributionListMessage(s);s.counterPartyType=c?"distributionList":"user"}s.counterPartyId="distributionList"===s.counterPartyType||s.senderId===a?s.recipientId:s.senderId}var l=this.host.messages._isMessageOutgoing(s);"distributionList"!==s.counterPartyType&&(i.account_id=l?s.recipientId:this.host.currentUserId,i.account_id&&o.push(i)),s.senderStatus=we.MessageSenderStatus.SENT;var d=u&&this.ensureConversation(s.counterPartyType,s.counterPartyId,s.recipientOrganizationId,{conversationId:r,ensureEntities:{counterParty:"placeholder",groupMembers:"placeholder",organization:"placeholder"}});s.conversationId=d?d.id:null;var f=this.host.models.Message.get(s.id);if(f){var p=s.body,h=s.escalationExecutionId,y=s.isForwardedFromPatientNetwork,g=s.originalSender,v=s.patientDetails,m=s.priority,b=s.sortNumber,w=s.sortSeries;f.body=p,f.escalationExecutionId=h||null,f.isForwardedFromPatientNetwork=y,f.originalSender=g,f.patientDetails=v,f.priority=m,f.shouldEscalate=!1,f.sortNumber=b,f.sortSeries=w}else f=this.host.models.Message.createInstance(s,!1);var _=f.senderId===a?f.recipientId:f.senderId;if(_&&"distributionList"!==f.counterPartyType&&this.__ensureMessageCounterParty(d,_,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),!o||"function"!=typeof o[J.default]&&!Array.isArray(o))throw new TypeError("Expected recipientStatuses to be iterable, got "+B(o));if(!o||"function"!=typeof o[J.default]&&!Array.isArray(o))throw new TypeError("Expected recipientStatuses to be iterable, got "+K(o));var x=!0,E=!1,k=void 0;try{for(var T,I=(0,Q.default)(o);!(x=(T=I.next()).done);x=!0){var A=T.value;this.config.condensedReplays||this.host.messages.__injectMessageStatus(f,A)}}catch(e){E=!0,k=e}finally{try{!x&&I.return&&I.return()}finally{if(E)throw k}}return"group"!==s.counterPartyType&&!this.config.condensedReplays||(f.shouldEnsureRecipientStatus=!0),f.inTimeline=!(!d||!d.isLive),{message:f,conversation:d}}},{key:"_reactToMessageEventCR",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?{}:t,r=e.injectConversation,a=void 0===r||r;n=(0,Ee.jsonCloneDeep)(n);var o=this.host.currentUserId,i=n,s=i.first_expiring_unread_message,u=i.last_message,c=(i.type,i.unread_message_count),l=i.unread_priority_message_count,d=(i.xmlns,(0,q.default)(i,["first_expiring_unread_message","last_message","type","unread_message_count","unread_priority_message_count","xmlns"])),f=void 0;d.team_request&&this.host.teams.__injectTeamRequest(d.team_request),u&&(u.conversation_id=d.conversation_id,f=u.sort_number,u.is_group&&!u.group_token&&(u.group_token=u.recipient_token),u.message_id===d.client_id&&(d.attachmentName=u.attachment_name)),d.is_group&&!d.group_token&&(d.group_token=d.recipient_token);var p=this.host.models.Message.parseAttrs(d);if(p.messageType=we.MessageType.USER_SENT,p.groupId)p.counterPartyType="group",p.counterPartyId=p.groupId;else if(p.recipientId){if(this.host.distributionLists.getById(p.recipientId))p.counterPartyType="distributionList";else if(this.host.users.getById(p.recipientId))p.counterPartyType="user";else{var h=this.host.messages._looksLikeDistributionListMessage(p);p.counterPartyType=h?"distributionList":"user"}p.counterPartyId="distributionList"===p.counterPartyType||p.senderId===o?p.recipientId:p.senderId}p.senderStatus=we.MessageSenderStatus.SENT;var y=this.host.models.Message.get(p.id);y?this.host.models.Message.inject((0,Y.default)({shouldEscalate:!1},p)):y=this.host.models.Message.inject(p);var g=void 0;if(a){var v={conversation_id:y.conversationId,entity:this._resolveEntity(p.counterPartyId,p.counterPartyType),first_expiring_unread_message:s,last_message:u,organization_id:y.__organizationId,unread_message_count:c,unread_priority_message_count:l};if(u&&u.sort_number<y.sortNumber?(f=y.sortNumber,v.last_message={message_id:y.id},(g=this.__injectConversation(v,{highestSortNumber:f}))&&this._ensureLastMessage({rawLastMessage:u,conversationId:g.id,counterParty:g.counterParty})):g=this.__injectConversation(v,{highestSortNumber:f}),u&&u.message_id&&g&&g.isLive){var m=this.host.models.Message.get(u.message_id);m&&!m.inTimeline&&(m.inTimeline=!0,this.host.models.Message.inject(m))}}else g=this.host.conversations.getById(d.conversation_id);var b=y.senderId===o?y.recipientId:y.senderId,w="group"!==y.counterPartyType||y.counterParty&&"FORUM"===y.counterParty.groupType;return b&&"distributionList"!==y.counterPartyType&&w&&this.__ensureMessageCounterParty(g,b,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),y.inTimeline=!!y.isEphemeral||!(!g||!g.isLive),y.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(y),{conversation:g,message:y}}},{key:"reactToFriendsEventCR",value:function(e){var t=e.data,n=e.eventId,r=t=(0,Ee.jsonCloneDeep)(t),a=r.action,o=(r.xmlns,(0,q.default)(r,["action","xmlns"])),i=o.entity,s=o.organization_id||o.organization_key,u=i.metadata,c=i.id||i.token;if(i.type){var l=this.host.modelNameByEntityType(i.type);if(u&&"patient_messaging"===u.feature_service&&"string"==typeof u.is_patient_contact&&(u.is_patient_contact="true"===u.is_patient_contact),i.organizationId=s,"group"===l&&u&&"role"===u.feature_service&&"role_assignment"===u.meta_type)return void(this._rolesFriendsEventPromise=this.host.roles.reactToFriendsEventCR({action:a,attrs:i,id:n}));var d=o.conversation_id,f=o.last_message,p=o.lowest_sort_number,h=this.getById(d);if("add"===a||"update"===a){h&&"update"===a&&this.clearMessageStatuses(h);var y=f&&f.sort_number?f.sort_number:void 0,g=!1,v=(0,se.default)(t,"entity.is_public")||(0,se.default)(t,"entity.metadata.team");if((void 0===y||v)&&"add"===a)if("group"===l){if(i.proxied_members&&i.proxied_members[this.host.currentUserId]){var m=this.host.models.Product.getAll()[0];if(!(k=i.proxied_members[this.host.currentUserId])||"function"!=typeof k[J.default]&&!Array.isArray(k))throw new TypeError("Expected _entityAttrs$proxied_ to be iterable, got "+B(k));if(!k||"function"!=typeof k[J.default]&&!Array.isArray(k))throw new TypeError("Expected _entityAttrs$proxied_ to be iterable, got "+K(k));var b=!0,w=!1,_=void 0;try{for(var x,E=(0,Q.default)(k);!(b=(x=E.next()).done);b=!0){var k,T=x.value;if(m.rolesOptingIn.includes(T.token)){g=!0;break}}}catch(e){w=!0,_=e}finally{try{!b&&E.return&&E.return()}finally{if(w)throw _}}}y=g?1:this.host.messages.__getNextSortNumber(s)}else y=h?h.highestSortNumber:1;var I=h&&h.lastMessage;if("add"===a){var A="group"===l&&this.host.groups.__extractGroupTypeFromAttrs(i);A!==we.GroupType.GROUP&&A!==we.GroupType.FORUM||(i.members=null),this.__injectCounterParty({entityAttrs:i,entityType:l,groupType:A,hasCurrentUser:!0,isPlaceholder:!0,organizationId:s}),h=this.__injectConversation(o,{highestSortNumber:y}),I&&!f&&this.find(d),this.clearTimeline(h)}else"update"===a&&(h=this.__injectConversation(o,{highestSortNumber:y}),I&&!f&&this.find(d));p&&this.markAsDelivered(h)}else"del"===a?this.__removeFriend({attrs:i,entityType:l,id:c,organizationId:s}):this.logger.error("friends action not implemented",a,t);h&&this.__clearOptimisticStatus([h]),this.emit("friends",(0,Y.default)({action:a},i))}}},{key:"reactToFriendsEvent",value:function(e){var t=e.data,n=e.id;if(this.config.condensedReplays)this.reactToFriendsEventCR({data:t,eventId:n});else{var r=(t=(0,Ee.jsonCloneDeep)(t)).friend,a=r.action,o=r.organization_id,i=(0,q.default)(r,["action","organization_id"]),s=i.metadata,u=i.token,c=this.host.modelNameByTypeNS(i.xmlns);if(c){if("group"===c&&s&&"role"===s.feature_service&&"role_assignment"===s.meta_type)return void(this._rolesFriendsEventPromise=this.host.roles.reactToFriendsEvent({data:t,id:n}));if("add"===a){var l="group"===c&&this.host.groups.__extractGroupTypeFromAttrs(i);l!==we.GroupType.GROUP&&l!==we.GroupType.FORUM||(i.members=null);var d=l===we.GroupType.PATIENT_MESSAGING?"PATIENT":"PROVIDER";this.__injectCounterParty({entityAttrs:i,entityType:c,groupType:l,hasCurrentUser:!0,isPlaceholder:!0,organizationId:o});var f="group"===c?this.host.messages.__getNextSortNumber(o):1;this.ensureConversation(c,u,o,{highestSortNumber:f,network:d})}else"del"===a?this.__removeFriend({attrs:i,entityType:c,id:u,organizationId:o}):this.logger.error("friends action not implemented",a,t);this.emit("friends",(0,Y.default)({action:a},i))}}}},{key:"reactToUpdateTeamRequestEvent",value:function(e){var t=e.data,n=(t=(0,Ee.jsonCloneDeep)(t)).team_request;n&&this.host.teams.__injectTeamRequest(n)}},{key:"reactToUpdateEventCR",value:function(e){var t=e.data,n=t=(0,Ee.jsonCloneDeep)(t),r=n.entity,a=n.organization_id,o=r.metadata,i=r.token,s=r.type;r.organizationId=a,this._sanitizeGroupAttrs(r);var u=this.host.modelNameByEntityType(s),c=this.host.groups.__extractGroupTypeFromAttrs(r);if(o&&a&&i&&Me.includes(c)&&this.host.metadata.__injectMetadata(i,a,o),o&&o.feature_service&&"role"===o.feature_service){if("group"===u&&o.target_id)return this.__injectTargetEntity(o,a);this.host.roles.reactToUpdateEventCR({entity:r})}this.host.injectModel(r,s)}},{key:"reactToUpdateEvent",value:function(e){var t=e.data;if(this.config.condensedReplays)this.reactToUpdateEventCR({data:t});else{var n=t=(0,Ee.jsonCloneDeep)(t),r=n.metadata,a=n.organization_key,o=n.token,i=n.type;this._sanitizeGroupAttrs(t);var s=this.host.modelNameByTypeNS(i),u=this.host.groups.__extractGroupTypeFromAttrs(t);if(r&&a&&o&&Me.includes(u)&&this.host.metadata.__injectMetadata(o,a,r),r&&r.feature_service&&"role"===r.feature_service){if("group"===s&&r.target_id)return this.__injectTargetEntity(r,a);this.host.roles.reactToUpdateEvent({data:t})}var c=t,l=(0,q.default)(c,[]);this.host.injectModel(l,i)}}},{key:"__queueReload",value:function(e){this.__queuedConversationsToReload.includes(e)||this.__queuedConversationsToReload.push(e),this.__flushConversationsToReload()}},{key:"hasPendingReloads",value:function(){return this.__queuedConversationsToReload&&0<this.__queuedConversationsToReload.length}},{key:"__updateTimeline",value:function(e){var t=e.content,n=e.timeline;if(n.length=0,!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+B(t));if(!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+K(t));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,Q.default)(t);!(r=(i=s.next()).done);r=!0){var u=i.value;u.inTimeline&&n.push(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}this.host.models.Conversation.inject(e)}},{key:"__reloadConversation",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).notify,n=void 0===t||t;if(this.config.condensedReplays)return this.__reloadConversationCR(e);var r=e.content,a=e.higherContinuation,o=e.lowerContinuation,i=e.markableAsReadMessages,s=e.messages,u=e.timeline,c=[],l=[],d=0,f=null,p=null,h=null;i.length=0,s.length=0,u.length=0;var y=-1;if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected content to be iterable, got "+B(r));if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected content to be iterable, got "+K(r));var g=!0,v=!1,m=void 0;try{for(var b,w=(0,Q.default)(r);!(g=(b=w.next()).done);g=!0){var _=b.value;y++;var x=_.escalationExecution,E=_.inTimeline,k=_.isOutgoing,T=_.isUnread,I=_.markedRecipientStatus,A=_.messageType,O=_.priority;E&&(null===f&&(f=y),p=y,u.push(_)),A===we.MessageType.USER_SENT?(s.push(_),k||!T||h||(h=_),x&&"IN_PROGRESS"===x.status&&d++,Pe.includes(I)&&i.push(_),k||(T&&(c.push(_),O===we.MessagePriority.HIGH&&l.push(_)),e.lastIncomingMessageSortNumber=_.sortNumber)):Oe.includes(A)&&(e.lastBangMessageSortNumber=_.sortNumber)}}catch(e){v=!0,m=e}finally{try{!g&&w.return&&w.return()}finally{if(v)throw m}}o.itemsEstimate=f,a.itemsEstimate=null===p?null:r.length-1-p,e.isLive=0===a.itemsEstimate||0===r.length;var j=0<s.length?s[s.length-1]:null,S=j||(0,ie.default)(r.filter(function(e){return e.messageType===we.MessageType.GROUP_MEMBERSHIP_CHANGE&&e.groupMembersChange&&"ADD"===e.groupMembersChange.action}));if(e.firstUnreadMessage=h,e.inProgressEscalationCount=d,e.lastMessage=j,e.unreadCount=c.length,e.unreadPriorityCount=l.length,e.highestSortNumber=S&&S.sortNumber||e.lastConversationSortNumber||0,n){var M=e.counterPartyType,R=e.counterPartyId,z=e.organizationId,C=this.getConversationKey(M,R,z);this._convByConvHandle[C]=e,this.host.models.Conversation.inject(e)}}},{key:"__reloadConversationCR",value:function(e){var t=e._markingAsRead,n=e._markingAsReadSortNumber,r=e.content,a=e.higherContinuation,o=e.messages,i=e.timeline,s=[],u=[],c=null;if(o.length=0,i.length=0,!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected content to be iterable, got "+B(r));if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected content to be iterable, got "+K(r));var l=!0,d=!1,f=void 0;try{for(var p,h=(0,Q.default)(r);!(l=(p=h.next()).done);l=!0){var y=p.value,g=y.inTimeline,v=y.isOutgoing,m=y.isUnread,b=y.messageType,w=y.priority,_=y.sortNumber;g&&i.push(y),b===we.MessageType.USER_SENT?(o.push(y),!v&&m&&(c=c||y,t&&_<=n||(s.push(y),w===we.MessagePriority.HIGH&&u.push(y)))):Oe.includes(b)&&(e.lastBangMessageSortNumber=y.sortNumber)}}catch(e){d=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw f}}e.firstUnreadMessage=c,e.highestSortNumber=e.highestSortNumber||0,e.isLive=0===a.itemsEstimate||0===r.length,t&&(e.unreadCount=s.length,e.unreadPriorityCount=u.length);var x=e.counterPartyType,E=e.counterPartyId,k=e.organizationId,T=this.getConversationKey(x,E,k);this._convByConvHandle[T]=e,this.host.models.Conversation.inject(e)}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(e));if(e&&!e._counterPartyAddedOnServer){var t=e.organization;t&&!t.$placeholder&&this.add(e.counterPartyType,e.counterPartyId,e.organizationId)}}},{key:"addMembershipChangeLog",value:function(e){var t,n=e.action,r=e.actionTime,a=e.actor,o=e.alwaysAddToTimeline,i=e.createdAt,s=e.group,u=e.id,c=e.memberIds,l=e.members,d=e.removedFromGroup,f=void 0!==d&&d,p=e.sortNumber,h=a.id,y=s.id,g=s.organizationId,v=this.host.currentUser,m=this.get("group",y,g),b=void 0;if(this.config.condensedReplays){if(!m)return;b=m.id}else b=this.getConversationKey("group",y,g);t=!!o||!f&&!!m&&m.isLive;var w=this.host.models.GroupMembersChange.inject({id:"groupMembersChange:"+u,action:n,actionTime:r,actor:a,memberIds:c,members:l});this.host.models.Message.inject({body:this.__generateGroupMembershipChangeBody(e),conversationId:b,counterPartyId:y,counterPartyType:"group",createdAt:i,groupId:y,groupMembersChange:w,id:"bang:"+u,inTimeline:t,isOutgoing:!1,messageType:we.MessageType.GROUP_MEMBERSHIP_CHANGE,recipient:v,senderId:h,sortNumber:p}),"OPT_IN"!==n&&"OPT_OUT"!==n||this.host.roles.refresh(g)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t,n=this,r=e.action,a=e.actor,o=e.group,i=e.members,s=o.groupType,u=Re[r]||Ge[r],c=a.id===this.host.currentUserId?"You":a.displayName,l=ze[r]||"",d=null;return(r in ze||r in Ge)&&(d=(t=(t=i.map(function(e,t){return[e.id===n.host.currentUserId?"You":e.displayName,(t===i.length-2?" and":",")+" "]}),de.default).call(t),fe.default).call(t).join("")),r in Ge?[d,u,c].filter(Boolean).join(" "):[c,u,d,l,"this",Ce[s]].filter(Boolean).join(" ")}},{key:"addCallChangeLog",value:function(e){var t=e.caller,n=e.callee.id,r=e.conversationId,a=e.createdAt,o=e.duration,i=e.group.id,s=e.id,u=e.organizationId,c=e.sortNumber,l=e.userStartTime,d=this.config.condensedReplays?r:this.getConversationKey("group",i,u),f=l?(0,ge.default)(l).format("h:mm A"):"",p=t.id===this.host.currentUser.id;this.host.models.Message.inject({body:(p?"Outgoing":"Incoming")+" Video Call "+f+" ("+(0,Ie.secondsToDurationFormat)(o)+")",conversationId:d,counterPartyId:n,counterPartyType:"group",createdAt:a,groupId:n,id:"bang:"+s,inTimeline:!0,isOutgoing:!1,messageType:we.MessageType.CALL_CHANGE,recipient:this.host.currentUser,senderId:t?t.id:null,sortNumber:c})}},{key:"addEscalationExecutionChangeLog",value:function(e){var t,n=e.action,r=e.actionTime,a=e.actor,o=e.alwaysAddToTimeline,i=e.createdAt,s=e.escalationExecution,u=e.group,c=e.members,l=e.id,d=e.sortNumber,f=u.id,p=u.organizationId,h=this.host.currentUser,y=this.get("group",f,p),g=y?y.id:null;if(!y){if(this.config.condensedReplays)return;g=this.getConversationKey("group",f,p)}t=!!o||!!y&&y.isLive;var v=this.host.models.EscalationExecutionChange.inject({id:"escalationExecutionChange:"+l,action:n,actionTime:r,actor:a,members:c});this.host.models.Message.inject({body:this.__generateGroupEscalationChangeBody(e,s),conversationId:g,counterPartyId:f,counterPartyType:"group",createdAt:i,escalationExecutionChange:v,escalationExecutionId:s?s.id:null,groupId:f,id:"bang:"+l,inTimeline:t,isOutgoing:!1,messageType:we.MessageType.ESCALATION_EXECUTION_CHANGE,recipient:h,senderId:a?a.id:null,sortNumber:d})}},{key:"__generateGroupEscalationChangeBody",value:function(e,t){var n=e.action,r=e.actor,a=e.members,o=Se[n],i=t&&t.displayId||"";return i.startsWith("#")&&(i=i.slice(1,i.length)),""!==i&&(i+=" "),n===we.EscalationChangeAction.MEMBER_ADDED?o+" "+a[0].displayName+" to this escalation":n!==we.EscalationChangeAction.INITIATED&&r&&r.displayName?"Escalation "+i+o+" by "+r.displayName:"Escalation "+i+o}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(e));if(e.groupId)return this.conversationHashForListEntityId(e.groupId);if(e.distributionListId)return this.conversationHashForListEntityId(e.distributionListId);var t=e.senderId===this.host.currentUserId?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+K(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+K(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+B(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+B(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"distributionList":case"group":case"team":return this.conversationHashForListEntityId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+K(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+B(n));var r=[e,t,n].join(":");return Ae.b64(r)}},{key:"conversationHashForListEntityId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));return Ae.b64(e)}},{key:"conversationHashForGroupId",value:function(){return this.conversationHashForListEntityId.apply(this,arguments)}},{key:"conversationHashForDistributionListId",value:function(){return this.conversationHashForListEntityId.apply(this,arguments)}},{key:"looksLikeConversationHandle",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));return/^[a-zA-Z0-9\/+=]{24}$/.test(e)}},{key:"findConversationWithUser",value:(O=(0,X.default)(H.default.mark(function e(t,n){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(n));e.next=8;break;case 8:return e.abrupt("return",this.get(this.host.models.User.name,t,n));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"findConversationWithGroup",value:(A=(0,X.default)(H.default.mark(function e(t,n){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(n));e.next=8;break;case 8:return e.abrupt("return",this.get(this.host.models.Group.name,t,n));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"findAllGroupConversationsWithMembers",value:(I=(0,X.default)(H.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},p=f.exact,h=void 0===p||p,y=f.includeCurrentUser,g=void 0===y||y,v=f.includeForums,m=void 0===v||v,b=f.includeRoles,w=void 0===b||b,_=f.localOnly,x=void 0!==_&&_,E=f.senderId,k=void 0===E?null:E;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+K(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));e.next=4;break;case 4:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+B(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(n));e.next=8;break;case 8:return e.next=10,this.resolveMembers((0,Ee.arrayWrap)(t));case 10:return t=(t=e.sent).map(this._resolveModelId),e.next=14,this.host.groups.findAllWithSpecificMembers(t,n,{exact:h,includeCurrentUser:g,includeForums:m,includeRoles:w,localOnly:x,senderId:k});case 14:if(r=e.sent,a=[],!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+B(r));e.next=18;break;case 18:if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+K(r));e.next=20;break;case 20:for(i=!(o=!0),s=void 0,e.prev=23,u=(0,Q.default)(r);!(o=(c=u.next()).done);o=!0)l=c.value,(d=this.get(this.host.models.Group.name,l.id,n))&&a.push(d);e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),i=!0,s=e.t0;case 31:e.prev=31,e.prev=32,!o&&u.return&&u.return();case 34:if(e.prev=34,i)throw s;e.next=37;break;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.abrupt("return",a);case 40:case"end":return e.stop()}},e,this,[[23,27,31,39],[32,,34,38]])})),function(e,t){return I.apply(this,arguments)})},{key:"findLocalRoleP2PConversation",value:function(e,t){var n=void 0,r=void 0;e=this.host.roles.__resolveRoleId(e),t=this.host.roles.__resolveRoleId(t);var a=this.host.models.User.get(e),o=this.host.models.User.get(t);if(o&&o.isRoleBot&&o.botRole)r=this.host.roles._roleP2PConversations[t];else{if(!(a&&a.isRoleBot&&a.botRole))return null;r=this.host.roles._roleP2PConversations[e]}if(r){if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected roleP2PConversations to be iterable, got "+B(r));if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected roleP2PConversations to be iterable, got "+K(r));var i=!0,s=!1,u=void 0;try{for(var c,l=(0,Q.default)(r);!(i=(c=l.next()).done);i=!0){var d=c.value,f=d.$lastModified,p=d.counterParty,h=p.p2pRecipient,y=p.p2pSender;if(h&&y){var g=this.host.roles.__resolveRoleId(h.id),v=this.host.roles.__resolveRoleId(y.id);(g===e&&v===t||g===t&&v===e)&&(!n||n.$lastModified<f)&&(n=d)}}}catch(e){s=!0,u=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw u}}}return n}},{key:"resolveMembers",value:(T=(0,X.default)(H.default.mark(function e(t){var r=this;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.default.all(t.map(function(){var t=(0,X.default)(H.default.mark(function e(t){var n;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ke.isEmail)(t)||(0,Te.isPhone)(t))return e.prev=1,e.next=4,r.host.users.find(t);e.next=11;break;case 4:return n=e.sent,e.abrupt("return",n.id);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",t);case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e,r,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"selectConversation",value:(k=(0,X.default)(H.default.mark(function e(t){var n,r,a,o,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=i.anchorPoint,u=void 0===s?we.ConversationAnchorPoints.CONVERSATION_END:s,c=i.fetchAllItems,l=void 0!==c&&c,d=i.markAsDelivered,f=void 0===d||d,p=i.markAsRead,h=void 0===p||p,y=i.maxItemsPerBatch,g=i.minItemsToFetch,v=void 0===g?20:g;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 4:if(t=this._resolveModelId(t),n=this._resolveEntity(t,"conversation")){e.next=8;break}throw new be.NotFoundError(this.host.models.Conversation.name,t);case 8:if(u===we.ConversationAnchorPoints.CONTINUATION)throw new Error("Cannot call selectConversation() with anchorPoint='CONTINUATION'");e.next=10;break;case 10:if(this.config.condensedReplays)return e.next=13,this._selectConversationCR(t,{anchorPoint:u,conversation:n,fetchAllItems:l,markAsDelivered:f,markAsRead:h,maxItemsPerBatch:y,minItemsToFetch:v});e.next=15;break;case 13:return r=e.sent,e.abrupt("return",r);case 15:return a=0,e.next=18,this.fetchTimeline(t,{anchorPoint:u,markAsDelivered:f,maxItems:v});case 18:return a+=e.sent,0<n.markableAsReadMessages.length?n.firstUnreadMessage=n.markableAsReadMessages[0]:n.firstUnreadMessage=null,o=n.firstUnreadMessage,h&&0<n.unreadCount&&this.markAsRead(t,{localOnly:!0}),e.next=24,this._fetchContinuations(t,{addedMessages:a,conversation:n,fetchAllItems:l,markAsDelivered:f,minItemsToFetch:v});case 24:return a=e.sent,h&&this.markAsRead(t),e.abrupt("return",{addedMessages:a,previousFirstUnreadMessage:o});case 27:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"_selectConversationCR",value:(E=(0,X.default)(H.default.mark(function e(t,n){var r,a,o,i=n.anchorPoint,s=n.conversation,u=n.fetchAllItems,c=void 0!==u&&u,l=n.markAsDelivered,d=n.markAsRead,f=n.minItemsToFetch,p=n.maxItemsPerBatch,h=void 0===p?f:p;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=d&&0<s.unreadCount,a=0,r&&this.markAsRead(t,{localOnly:!0}),e.next=5,this.fetchTimeline(t,{anchorPoint:i,fetchAllItems:c,markAsDelivered:l,maxItems:h});case 5:return a+=e.sent,e.next=8,this._fetchContinuations(t,{addedMessages:a,conversation:s,fetchAllItems:c,markAsDelivered:l,maxItemsPerBatch:h,minItemsToFetch:f});case 8:return a=e.sent,o=s.firstUnreadMessage,r&&this.markAsRead(t),this.__ensureEntities(s,{messageCounterParties:"full"}),e.abrupt("return",{addedMessages:a,previousFirstUnreadMessage:o});case 13:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"_fetchContinuations",value:(x=(0,X.default)(H.default.mark(function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.addedMessages,a=void 0===r?0:r,o=n.conversation,i=n.fetchAllItems,s=void 0!==i&&i,u=n.markAsDelivered,c=void 0===u||u,l=n.minItemsToFetch,d=void 0===l?20:l;return n.maxItemsPerBatch,H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===a)return e.abrupt("return",0);e.next=2;break;case 2:if((s||a<d)&&0<o.higherContinuation.itemsEstimate)return e.next=5,this.fetchTimeline(t,{anchorPoint:we.ConversationAnchorPoints.CONTINUATION,markAsDelivered:c,continuation:o.higherContinuation.continuation,fetchAllItems:s});e.next=8;break;case 5:a+=e.sent,e.next=2;break;case 8:if((s||a<d)&&0<o.lowerContinuation.itemsEstimate)return e.next=11,this.fetchTimeline(t,{anchorPoint:we.ConversationAnchorPoints.CONTINUATION,markAsDelivered:c,continuation:o.lowerContinuation.continuation,fetchAllItems:s});e.next=14;break;case 11:a+=e.sent,e.next=8;break;case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"getWithUser",value:function(e,t){var n=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).createIfNotFound,r=void 0!==n&&n;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));var a=void 0;if(e=this._resolveModelId(e),t=this._resolveModelId(t),this.config.condensedReplays){var o=this.host.users.getById(e);if(o&&o.profileByOrganizationId&&o.profileByOrganizationId[t]){var i=o.profileByOrganizationId[t].conversationId;i&&(a=this.getById(i))}}else{var s=this.conversationHashForUserMessage(e,t);a=this.getById(s)}return!a&&r&&(a=this.ensureConversation("user",e,t)),a||null}},{key:"getWithListEntity",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{createIfNotFound:!1},r=n.createIfNotFound,a=void 0!==r&&r,o=n.organizationId,i=n.conversationId,s=void 0===i?null:i;if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));var u=void 0;if(t=this._resolveModelId(t),this.config.condensedReplays)s&&(u=this.getById(s));else{var c=this.conversationHashForListEntityId(t);u=this.getById(c)}if(!u&&a){var l=this._resolveEntity(t,e);if(!l)throw new Error("Entity required when using createIfNotFound");o=l.organizationId,u=this.ensureConversation(e,t,o,{conversationId:s}),this.config.condensedReplays&&!s&&(u.$localOnly=!0)}return u}},{key:"getWithGroup",value:function(e){return this.getWithListEntity("group",e)}},{key:"getWithDistributionList",value:function(e){return this.getWithListEntity("distributionList",e)}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(n));var r=this.getConversationKey(e,t,n);return(this.config.condensedReplays?this._convByConvHandle[r]:this.host.models.Conversation.get(r))||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+K(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+B(e));return this.host.models.Conversation.getMulti(e)}},{key:"getAllForOrganization",value:function(e){var t=this._resolveEntity(e,"organization");return t?t.conversations:null}},{key:"__ensureEntities",value:(_=(0,X.default)(H.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(t));case 4:if(n=[],r=L.default.resolve(),a.counterParty&&(r=this.__ensureCounterParty(t,a),n.push(r)),a.escalationExecution&&n.push(this.__ensureEscalationExecution(t,r,a)),a.messageCounterParties&&n.push(this.__ensureMessageCounterParties(t,a)),a.organization&&n.push(this.__ensureOrganization(t,a)),0===(n=n.filter(Boolean)).length)return e.abrupt("return");e.next=13;break;case 13:return e.prev=13,e.next=16,L.default.all(n);case 16:a.onLoad&&a.onLoad(),this.host.models.Conversation.inject(t),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(13),console.error(e.t0);case 23:case"end":return e.stop()}},e,this,[[13,20]])})),function(e){return _.apply(this,arguments)})},{key:"__ensureOrganization",value:(w=(0,X.default)(H.default.mark(function e(n){var r=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(n));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(n));case 4:return e.next=6,this.host.organizations._findAll();case 6:if(this.host.models.Organization.shouldEnsure(n.organization,"full"!==a.organization)){e.next=8;break}return e.abrupt("return",null);case 8:return e.next=10,new L.default(function(e,t){r.host.models.Organization.ensureEntity(n.organizationId,{onlyPlaceholder:"placeholder"===a.organization,onMissing:function(){r.logger.info("org "+n.organizationId+" not found, created placeholder org"),n.$loadingOrganization=!0,e()},onLoad:function(){r.logger.info("org "+n.organizationId+" loaded"),n.$loadingOrganization=!1,a.touchOnRelatedEntityLoad&&r.host.models.Conversation.inject(n)},onFinish:e})});case 10:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"__ensureCounterParty",value:(b=(0,X.default)(H.default.mark(function e(n){var r,a,o,i=this,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(n));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(n));case 4:if(s=(0,Y.default)({},s),"group"===n.counterPartyType&&n.counterParty&&n.counterParty.groupType===we.GroupType.ROLE_P2P&&(s.counterParty="full",s.groupMembers="full"),(r=this.host.modelsByEntityType[n.counterPartyType]).shouldEnsure(n.counterParty,"full"!==s.counterParty,{groupMembersOnlyPlaceholder:"full"!==s.groupMembers})){e.next=10;break}return e.abrupt("return",null);case 10:a={},e.t0=n.counterPartyType,e.next="user"===e.t0?14:"group"===e.t0?15:"distributionList"===e.t0?15:17;break;case 14:return e.abrupt("break",18);case 15:return a.organizationId=n.organizationId,e.abrupt("break",18);case 17:throw new Error("unsupported counterPartyType",n.counterPartyType);case 18:return o=function(e){if("group"===r.name&&"placeholder"!==s.counterParty&&s.groupMembers)return i.host.groups.ensureMembers(e,{onlyPlaceholder:"placeholder"===s.groupMembers})},e.abrupt("return",new L.default(function(t,e){r.ensureEntity(n.counterPartyId,{attrs:a,onlyPlaceholder:"placeholder"===s.counterParty,onMissing:function(){i.logger.info("entry "+n.counterPartyId+" not found, created placeholder on org "+n.organizationId),n.$loadingCounterParty=!0},onLoad:function(){n.$loadingCounterParty=!1,s.touchOnRelatedEntityLoad&&i.host.models.Conversation.inject(n)},onFinish:function(e){e&&o(e),t()}})}));case 20:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"__ensureEscalationExecution",value:(m=(0,X.default)(H.default.mark(function e(t,n){var r,a,o;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(t));case 4:return e.next=6,n;case 6:if(r=t.counterPartyType,(a=t.counterParty)&&"group"===r){e.next=9;break}return e.abrupt("return");case 9:if(o=a.escalationExecution,a.groupType===we.GroupType.ESCALATION&&o){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,this.host.escalations.ensureEscalationExecution(o);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"__ensureMessageCounterParties",value:function(t){var e,n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(t instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(t));if(!(t instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(t));var a=(e=(e=(e=t.messages,pe.default).call(e,"senderId").filter(Boolean),he.default).call(e),ye.default).call(e,this.host.currentUserId,t.counterPartyId);return L.default.all(a.map(function(e){return n.__ensureMessageCounterParty(t,e,r)}))}},{key:"__ensureMessageCounterParty",value:function(n,r){var a=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof r)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(r));if("string"!=typeof r)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(r));var e=this.host.models.User.get(r);return this.host.models.User.shouldEnsure(e,"full"!==o.messageCounterParties)?new L.default(function(e,t){a.host.models.User.ensureEntity(r,{onlyPlaceholder:"placeholder"===o.messageCounterParties,onMissing:function(){var e=n?"entry "+n.counterPartyId+" not found, created placeholder on org "+n.organizationId:"counterParty "+r+" not found";a.logger.info(e)},onLoad:function(){n&&o.touchOnRelatedEntityLoad&&a.host.models.Conversation.inject(n)},onFinish:e})}):null}},{key:"_setAllowedSenders",value:function(e){var t=e.counterParty,n=e.counterPartyType,r=e.organization,a=this.host.currentUser,o=[a];if(!r)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.ORGANIZATION_DOES_NOT_EXIST);if(a.contactsMessagingBlocked&&r.isContacts)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.CONTACTS_MESSAGING_BLOCKED_BY_ADMIN);if(!n)return e.allowedSenders=o,void(e.allowedSendersReason=we.AllowedSendersReason.CONVERSATION_NOT_FULLY_LOADED);if(!t)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.NO_COUNTER_PARTY);switch(n){case"user":return t.$placeholder?(e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.COUNTER_PARTY_NOT_FULLY_LOADED)):"TigerPage"===t.displayName?(e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.COUNTER_PARTY_IS_TIGERPAGE)):(e.allowedSenders=o,void(e.allowedSendersReason=we.AllowedSendersReason.NONE));case"distributionList":return e.allowedSenders=o,void(e.allowedSendersReason=we.AllowedSendersReason.NONE);case"group":var i=t.createdByRole,s=t.createdByUser,u=t.groupType,c=t.p2pRecipient,l=t.p2pSender,d=t.targetRole,f=t.targetUser,p=t.members,h=t.proxiedMembers,y=r.allowedSenders;if(u===we.GroupType.FORUM)return e.allowedSenders=o,void(e.allowedSendersReason=we.AllowedSendersReason.NONE);if(u===we.GroupType.ROLE_ASSIGNMENT)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.IS_ROLE_ASSIGNMENT_GROUP);if(u===we.GroupType.ROLE_P2P&&c&&l){var g=[],v=i&&i.botUser,m=d&&d.botUser;!v||p&&p.includes(v)?!s||p&&p.includes(s)||g.push(s):g.push(v),!m||p&&p.includes(m)?!f||p&&p.includes(f)||g.push(f):g.push(m),0<g.length&&(p=[].concat((0,W.default)(p||[]),g))}else if(t.$placeholder)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.COUNTER_PARTY_NOT_FULLY_LOADED);if(!p)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.GROUP_MEMBERS_NOT_LOADED);if(0===p.length)return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.GROUP_HAS_NO_MEMBERS);var b=[];if(!y||"function"!=typeof y[J.default]&&!Array.isArray(y))throw new TypeError("Expected orgAllowedSenders to be iterable, got "+B(y));if(!y||"function"!=typeof y[J.default]&&!Array.isArray(y))throw new TypeError("Expected orgAllowedSenders to be iterable, got "+K(y));var w=!0,_=!1,x=void 0;try{for(var E,k=(0,Q.default)(y);!(w=(E=k.next()).done);w=!0){var T=E.value,I="role"===T.$entityType?T.botUser:T;if(p.includes(I)){var A=I.id,O=h&&h[A];if(O){var j=!1;if(!O||"function"!=typeof O[J.default]&&!Array.isArray(O))throw new TypeError("Expected proxiedEntries to be iterable, got "+B(O));if(!O||"function"!=typeof O[J.default]&&!Array.isArray(O))throw new TypeError("Expected proxiedEntries to be iterable, got "+K(O));var S=!0,M=!1,R=void 0;try{for(var z,C=(0,Q.default)(O);!(S=(z=C.next()).done);S=!0)z.value.token===A&&(j=!0)}catch(e){M=!0,R=e}finally{try{!S&&C.return&&C.return()}finally{if(M)throw R}}if(!j)continue}b.push(T)}}}catch(e){_=!0,x=e}finally{try{!w&&k.return&&k.return()}finally{if(_)throw x}}return 0===b.length?(e.allowedSenders=b,void(e.allowedSendersReason=we.AllowedSendersReason.USER_IS_NOT_MEMBER_OF_GROUP)):u!==we.GroupType.ROLE_P2P?(e.allowedSenders=b,void(e.allowedSendersReason=we.AllowedSendersReason.NONE)):l&&b.includes(l)?c===a||a.roles.includes(c)?(e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.CONVERSATION_WITH_ROLE_YOU_ARE_CURRENTLY_IN)):(e.allowedSenders=[l],void(e.allowedSendersReason=we.AllowedSendersReason.NONE)):(e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.USER_IS_NOT_IN_THIS_ROLE_CONVERSATION));default:return e.allowedSenders=[],void(e.allowedSendersReason=we.AllowedSendersReason.COUNTER_PARTY_TYPE_NOT_SUPPORTED)}}},{key:"reactToProcessingStart",value:function(e){var t=e.data,n=t=(0,Ee.jsonCloneDeep)(t),r=n.action_type,a=n.conversation_id,o=n.entity,i=n.organization_id,s=o.token||o.id,u=we.ProcessingActionTypes.resolve(r);if(this.host.products._addProcessingEvent({actionType:u,entity:(0,Y.default)({id:s},o)}),u===we.ProcessingActionTypes.ROLE_OPT_OUT)this._roleConversationsProcessingEvent[s]=this.host.roles._roleConversations[s];else if(u===we.ProcessingActionTypes.ORGANIZATION_MESSAGE_STATUS||u===we.ProcessingActionTypes.ORGANIZATION_REPLAY){var c=this.host.organizations.getById(i);if(!c)return;c._markingAsReadConversations&&this.__clearOptimisticStatus(c._markingAsReadConversations)}else if(u===we.ProcessingActionTypes.GROUP_REPLAY){var l=void 0;if(a&&(l=this.getById(a)),!l)return;this.__clearOptimisticStatus([l])}else if(u===we.ProcessingActionTypes.ROLE_OPT_IN||u===we.ProcessingActionTypes.ROLE_OPT_OUT){var d=this.host.roles._roleConversations[s];if(!d)return;this.__clearOptimisticStatus(d)}}},{key:"reactToProcessingStop",value:function(e){var t=e.data,n=t=(0,Ee.jsonCloneDeep)(t),r=n.action_type,a=n.conversation_id,o=n.entity,i=n.organization_id;!a&&o.conversation_id&&(a=o.conversation_id,delete o.conversation_id),!i&&o.organization_key&&(i=o.organization_key,delete o.organization_key);var s=o.token||o.id,u=we.ProcessingActionTypes.resolve(r);if(u===we.ProcessingActionTypes.GROUP_REPLAY){var c=void 0;if(a&&(c=this.getById(a)),!c)return;this.clearTimeline(c),this.__clearOptimisticStatus([c])}else if(u===we.ProcessingActionTypes.ROLE_OPT_IN||u===we.ProcessingActionTypes.ROLE_OPT_OUT){this.clearTimelineForAllRoleConversations(u,s);var l=this.host.roles._roleConversations[s];if(!l)return void this.host.products._removeProcessingEvent({actionType:u,entity:(0,Y.default)({id:s},o)});this.__clearOptimisticStatus(l)}else if(u===we.ProcessingActionTypes.ORGANIZATION_MESSAGE_STATUS)this.clearMessageStatusesForOrganization(i);else if(u===we.ProcessingActionTypes.CONVERSATION_MESSAGE_STATUS){var d=void 0;if(a&&(d=this.getById(a)),!d)return;this.clearMessageStatuses(d)}if(u===we.ProcessingActionTypes.ORGANIZATION_MESSAGE_STATUS||u===we.ProcessingActionTypes.ORGANIZATION_REPLAY){var f=this.host.organizations.getById(i);if(!f)return;f._markingAsReadConversations&&this.__clearOptimisticStatus(f._markingAsReadConversations)}this.host.products._removeProcessingEvent({actionType:u,entity:(0,Y.default)({id:s},o)})}},{key:"__clearOptimisticStatus",value:function(e){if(!e||"function"!=typeof e[J.default]&&!Array.isArray(e))throw new TypeError("Expected conversations to be iterable, got "+B(e));if(!e||"function"!=typeof e[J.default]&&!Array.isArray(e))throw new TypeError("Expected conversations to be iterable, got "+K(e));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Q.default)(e);!(t=(a=o.next()).done);t=!0){var i=a.value;i._markingAsRead&&(i._markingAsRead=!1,i._markingAsReadSortNumber=null,i._markingAsReadExpiration=null,this.host.models.Conversation.inject(i))}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"clearTimelineForAllRoleConversations",value:function(e,t){var n;if(n=e===we.ProcessingActionTypes.ROLE_OPT_OUT?this._roleConversationsProcessingEvent[t]:this.host.roles._roleConversations[t]){if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+B(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+K(n));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,Q.default)(n);!(r=(i=s.next()).done);r=!0){var u=i.value;this.clearTimeline(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}},{key:"clearMessageStatusesForOrganization",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(e));if("string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+B(e));var t=this.host.organizations.getById(e);if(t){var n=t.conversations;if(n){if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+B(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+K(n));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,Q.default)(n);!(r=(i=s.next()).done);r=!0){var u=i.value;this.clearMessageStatuses(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}}},{key:"clearMessageStatuses",value:function(e){var s=this,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).emit,n=void 0===t||t,u=e.timeline;if(!u||"function"!=typeof u[J.default]&&!Array.isArray(u))throw new TypeError("Expected timeline to be iterable, got "+B(u));if(!u||"function"!=typeof u[J.default]&&!Array.isArray(u))throw new TypeError("Expected timeline to be iterable, got "+K(u));var r=!0,a=!1,o=void 0;try{for(var i,c=(0,Q.default)(u);!(r=(i=c.next()).done);r=!0){var l=i.value;l.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(l)}}catch(e){a=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw o}}return setTimeout(function(){if(!u||"function"!=typeof u[J.default]&&!Array.isArray(u))throw new TypeError("Expected timeline to be iterable, got "+B(u));if(!u||"function"!=typeof u[J.default]&&!Array.isArray(u))throw new TypeError("Expected timeline to be iterable, got "+K(u));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,Q.default)(u);!(e=(r=a.next()).done);e=!0){var o=r.value;if(!s.host.messages._pendingFindRecipientStatuses)return;var i=s.host.messages._pendingFindRecipientStatuses[o.id];i&&i()}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}},0),n&&this.emit("clearMessageStatuses",u),u.length}},{key:"mute",value:(v=(0,X.default)(H.default.mark(function e(t,n){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+K(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 6:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+B(n));e.next=8;break;case 8:return e.next=10,this.host.mute.muteConversation(t,n);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"unmute",value:(g=(0,X.default)(H.default.mark(function e(t){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+K(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+B(t));case 4:return e.next=6,this.host.mute.unmuteConversation(t);case 6:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"unmuteAll",value:(y=(0,X.default)(H.default.mark(function e(){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.mute.unmuteAll();case 2:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})}]),a((p=Ue).prototype,"findAll",[l],(0,D.default)(p.prototype,"findAll"),p.prototype),a(p.prototype,"add",[d],(0,D.default)(p.prototype,"add"),p.prototype),a(p.prototype,"remove",[f],(0,D.default)(p.prototype,"remove"),p.prototype),p);function Ue(){var e,t,z,n;(0,te.default)(this,Ue);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=z=(0,re.default)(this,(e=Ue.__proto__||(0,ee.default)(Ue)).call.apply(e,[this].concat(a))),z.__injectCounterParty=function(e){var t=e.conversationId,n=e.entityAttrs,r=e.entityType,a=e.groupType,o=e.hasCurrentUser,i=void 0!==o&&o,s=e.isPlaceholder,u=void 0!==s&&s,c=e.organizationId,l=n.id,d=n.metadata;if(l=l||n.token,!r&&n.type&&(r=z.host.modelNameByEntityType(n.type)),t&&(n.conversationId=t),c&&(n.organizationId=c),"group"!==r||a||(a=z.host.groups.__extractGroupTypeFromAttrs(n)),d&&l&&c&&z.host.metadata.__injectMetadata(l,c,d),"group"===r){if(d){if(d.created_by){var f=z.__injectCreatedByEntity(d,c),p=f.role,h=void 0===p?null:p,y=f.user,g=void 0===y?null:y;(h||g)&&(n.createdByRole=h,n.createdByUser=g)}else if(n.created_by){var v=z.host.models.User.injectPlaceholder({id:n.created_by});n.createdByUser=v}if(d.target_id){var m=z.__injectTargetEntity(d,c),b=m.role,w=void 0===b?null:b,_=m.user,x=void 0===_?null:_;(w||x)&&(n.targetRole=w,n.targetUser=x)}if("role_assignment"===d.meta_type){var E=n.display_name||n.name;z.host.roles.__injectRoleAssignmentEntity(E,d,c)}}a===we.GroupType.FORUM&&i&&(n.hasCurrentUser=!0)}else if("user"===r){var k=n.dnd_auto_forward_receiver;k&&"undefined"!==k&&z.host.models.User.injectPlaceholder({id:k})}else if("distributionList"===r)n.created_by&&z.host.injectPlaceholderModel({displayName:n.created_by_display_name,id:n.created_by},"user"),n.updated_by&&z.host.injectPlaceholderModel({displayName:n.updated_by_display_name,id:n.updated_by},"user");else if("messageTemplate"===r)n.created_by&&z.host.injectPlaceholderModel({displayName:n.created_by_display_name,id:n.created_by},"user"),n.updated_by&&z.host.injectPlaceholderModel({displayName:n.updated_by_display_name,id:n.updated_by},"user");else if("scheduledMessage"===r){if(n.event_id&&(n.scheduled_message_id=n.token,n.token=n.event_id,l=n.event_id),n.recipient)if("account"===n.recipient_type){var T={},I=["feature_service","is_patient_contact","patient_display_name","patient_dob","patient_gender","patient_id","patient_mrn","phone_number","relation_name"];if("function"!=typeof I[J.default]&&!Array.isArray(I))throw new TypeError("Expected patientDataKeys to be iterable, got "+B(I));if("function"!=typeof I[J.default]&&!Array.isArray(I))throw new TypeError("Expected patientDataKeys to be iterable, got "+K(I));var A=!0,O=!1,j=void 0;try{for(var S,M=(0,Q.default)(I);!(A=(S=M.next()).done);A=!0){var R=S.value;T[R]=n[R]}}catch(e){O=!0,j=e}finally{try{!A&&M.return&&M.return()}finally{if(O)throw j}}T.patient_id||T.is_patient_contact||(T.patient_id=n.recipient),z.host.metadata.__injectMetadata(n.recipient,c,T),z.host.injectPlaceholderModel((0,Y.default)({},T,{displayName:n.recipient_display_name,id:n.recipient}),"user")}else"distribution_list"!==n.recipient_type&&"list"!==n.recipient_type||z.host.injectPlaceholderModel({id:n.recipient,name:n.recipient_display_name,totalMembers:n.total_members},"distributionList");n.sender_token&&z.host.injectPlaceholderModel({displayName:n.sender_display_name,id:n.sender_token},"user"),n.template_id&&z.host.injectPlaceholderModel({title:n.template_label,id:n.template_id},"messageTemplate"),n.updated_by&&z.host.injectPlaceholderModel({displayName:n.updated_by_display_name,id:n.updated_by},"user")}return l?u?z.host.injectPlaceholderModel(n,r):z.host.injectModel(n,r):null},z.__injectCreatedByEntity=function(e,t){var n={};if(void 0!==e.created_by_tag_id)n.role=z.host.roles.__injectRoleFromMetadata({metadata:{token:e.created_by,display_name:e.created_by_display_name,tag_color:e.created_by_tag_color,tag_id:e.created_by_tag_id,tag_name:e.created_by_tag_name},organizationId:t,replaceExisting:!1});else{var r=z.host.models.User.get(e.created_by);if(r)n.user=r;else{var a={id:e.created_by};"created_by_display_name"in e&&(a.displayName=e.created_by_display_name),n.user=z.host.models.User.injectPlaceholder(a)}}return n},z.__injectTargetEntity=function(e,t){var n={};if(void 0!==e.target_tag_id)n.role=z.host.roles.__injectRoleFromMetadata({metadata:{display_name:e.target_display_name,tag_color:e.target_tag_color,tag_id:e.target_tag_id,tag_name:e.target_tag_name,token:e.target_id},organizationId:t,replaceExisting:!1});else{var r=z.host.models.User.get(e.target_id);if(r)n.user=r;else{var a={id:e.target_id};"target_display_name"in e&&(a.displayName=e.target_display_name),n.user=z.host.models.User.injectPlaceholder(a)}}return n},z.__removeFriend=function(e){var t,n=e.attrs,r=e.entityType,a=e.id,o=e.organizationId,i=z.get(r,a,o),s="group"===r?z.host.models.Group.get(a):null,u=!(!s||s.groupType!==we.GroupType.FORUM);if(t="user"===r||z.config.condensedReplays?i&&i.content.slice():i&&i.messages.slice(),u&&(n.hasCurrentUser=!1,n.members=null,z.host.models.Group.inject(n)),z.config.keepConversationsForAllForums&&u||(i&&z.__ejectConversation(i.id),s&&z.config.condensedReplays&&z.host.models.Group.eject(s)),Array.isArray(t)){if(!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+B(t));if(!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+K(t));var c=!0,l=!1,d=void 0;try{for(var f,p=(0,Q.default)(t);!(c=(f=p.next()).done);c=!0){var h=f.value;z.host.ejectModel(h,h.$entityType)}}catch(e){l=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw d}}}},z._sanitizeGroupAttrs=function(e){var t=e.members;z.host.groups.__extractGroupTypeFromAttrs(e)===we.GroupType.FORUM&&t&&0===t.length&&delete e.members},z._onSendingMessage=function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(e));var t=void 0;if(t=z.config.condensedReplays?e.conversation:z.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId,{ensureEntities:{counterParty:"full",organization:"placeholder",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!0}})){var n=!1;z.host.config.condensedReplays&&e&&e.sortNumber&&(void 0===t.highestSortNumber||t.highestSortNumber<e.sortNumber)&&(t.highestSortNumber=e.sortNumber,n=!0),void 0===t.highestSortNumber&&(t.highestSortNumber=z.host.messages.__getNextSortNumber(t.organizationId),n=!0),n&&z.host.models.Conversation.inject(t),z.__addConversationCounterPartyToServerRosterIfShould(t)}},z._onSentMessage=function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+K(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+B(e));var t=!1,n=z.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);n&&(z.host.config.condensedReplays&&(e&&e.sortNumber&&(void 0===n.highestSortNumber||n.highestSortNumber<e.sortNumber)?(n.highestSortNumber=e.sortNumber,t=!0):void 0===n.highestSortNumber&&(n.highestSortNumber=z.host.messages.__getNextSortNumber(n.organizationId),t=!0)),t&&z.host.models.Conversation.inject(n),n.emit("message",e))},z._onChangeMessage=function(e,t){t.conversation&&z.__queueReload(t.conversation)},z._onRemoveMessage=function(e,t){var n=t.conversation;if(n){if(z.config.condensedReplays){var r=n,a=r.firstExpiringUnreadMessage,o=r.id,i=r.lastMessage,s=r.timeline;if(!(n=z.getById(o)))return;var u=i===t,c=a===t,l=1===s.length&&u;(u||c)&&z.find(n.id),l&&(n.lastMessage=null)}z.__queueReload(n)}},z._onRemoveGroup=function(e,t){var n=t.conversationId?t.conversationId:z.getConversationKey("group",t.id,t.organizationId);z.__ejectConversation(n)},z._onRemoveTeam=function(e,t){var n=z.getConversationKey("team",t.id,t.organizationId);z.__ejectConversation(n)},z._onChangeGroup=function(e,t){t.conversationId&&z.host.models.Conversation.touch(t.conversationId)},z._onChangeOrganization=function(e,t){var n=t.conversations,r=z.__escalationEnabledOrganizations.indexOf(t),a=-1<r;if(a!==t.canEscalateMessages&&(a?z.__escalationEnabledOrganizations.splice(r,1):z.__escalationEnabledOrganizations.push(t),n)){if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+B(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+K(n));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,Q.default)(n);!(o=(u=c.next()).done);o=!0){var l=u.value;z.__queueReload(l)}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}},z.__flushConversationsToReload=function(){if(!z.host.currentlyServingOfflineMessages&&0<z.__queuedConversationsToReload.length){var e=[];if(z.host.organizations._deferConversationChanges=!0,!(i=z.__queuedConversationsToReload)||"function"!=typeof i[J.default]&&!Array.isArray(i))throw new TypeError("Expected _queuedConversations to be iterable, got "+B(i));if(!i||"function"!=typeof i[J.default]&&!Array.isArray(i))throw new TypeError("Expected _queuedConversations to be iterable, got "+K(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Q.default)(i);!(t=(a=o.next()).done);t=!0){var i,s=a.value,u=s.organizationId;z.__reloadConversation(s),e.includes(u)||e.push(u)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}if(z.host.organizations._deferConversationChanges=!1,!e||"function"!=typeof e[J.default]&&!Array.isArray(e))throw new TypeError("Expected changedOrganizations to be iterable, got "+B(e));if(!e||"function"!=typeof e[J.default]&&!Array.isArray(e))throw new TypeError("Expected changedOrganizations to be iterable, got "+K(e));var c=!0,l=!1,d=void 0;try{for(var f,p=(0,Q.default)(e);!(c=(f=p.next()).done);c=!0){u=f.value;var h=z.host.organizations.getById(u);h&&z.host.organizations.__reloadConversations(h)}}catch(e){l=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw d}}z.__queuedConversationsToReload.length=0}},n=t,(0,re.default)(z,n)}t.default=Ne,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E=r(n(3)),k=r(n(4)),T=r(n(5)),I=r(n(11)),A=r(n(31)),O=r(n(16)),j=r(n(10)),S=r(n(9)),M=r(n(6)),R=r(n(1)),z=r(n(2)),C=r(n(8)),P=r(n(7)),V=r(n(25)),G=n(20),N=n(26),U=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),F=r(n(15)),$=["display_name"].join(","),D=["name"].join(","),q=(o=(0,G.decorator)(),u=(0,G.decorator)(),c=(0,G.decorator)(),d=F.default,(0,P.default)(L,d),(0,z.default)(L,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"addMembers",value:(x=(0,S.default)(j.default.mark(function e(t){var n=t.id,r=t.members,a=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new U.ValidationError("id","required");case 2:if(Array.isArray(r)){e.next=4;break}throw new U.ValidationError("members","required","members must be an array");case 4:if(a){e.next=6;break}throw new U.ValidationError("organizationId","required");case 6:return e.next=8,this.host.api.distributionLists.membersBatch({id:n,members:r,operation:"add",organizationId:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"batchDelete",value:(_=(0,S.default)(j.default.mark(function e(t){var n,r=this,a=t.ids,o=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(a)){e.next=2;break}throw new U.ValidationError("ids","required","ids must be an array");case 2:if(o){e.next=4;break}throw new U.ValidationError("organizationId","required");case 4:return e.next=6,this.host.api.distributionLists.batch({ids:a,operation:"destroy",organizationId:o});case 6:return n=a.map(function(e){return r.host.models.DistributionList.inject({$deleted:!0,id:e})}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"create",value:(w=(0,S.default)(j.default.mark(function e(t){var n,r,a=t.adminOnly,o=t.members,i=t.name,s=t.network,u=void 0===s?"patient":s,c=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._validate({adminOnly:a,members:o,name:i,organizationId:c,shouldCheckId:!1}),!1===["patient"].includes(u))throw new U.ValidationError("network","invalid",'network must be "patient"');e.next=3;break;case 3:return e.next=5,this.host.api.distributionLists.create({adminOnly:a,members:o,name:i,network:u,organizationId:c});case 5:return n=e.sent,r=this.host.models.DistributionList.inject((0,O.default)({conversationId:n.conversation_id,organizationId:n.organization_id},n.entity)),e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"delete",value:(b=(0,S.default)(j.default.mark(function e(t,n){var r;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({id:t,organizationId:n,shouldCheckInvalid:!1}),e.next=3,this.host.api.distributionLists.delete(t,n);case 3:return r=this.host.models.DistributionList.inject({$deleted:!0,id:t}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"find",value:(m=(0,S.default)(j.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:if(a=(0,V.default)(a,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,a.bypassCache){e.next=11;break}if(n=this.host.models.DistributionList.get(t))return e.abrupt("return",n);e.next=11;break;case 11:return e.next=13,this.host.api.distributionLists.find(t,{organizationId:a.organizationId});case 13:if(!(r=e.sent)){e.next=19;break}delete(n=this.config.condensedReplays||r.entity?this.host.models.DistributionList.inject((0,O.default)({conversationId:r.conversation_id,organizationId:r.organization_id},r.entity)):this.host.models.DistributionList.inject(r)).$placeholder,e.next=21;break;case 19:if(a.ignoreNotFound){e.next=21;break}throw new U.NotFoundError(this.host.models.DistributionList.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"findAll",value:(v=(0,S.default)(j.default.mark(function e(){var t,n,r,a;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["distributionList"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.DistributionList.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));return this.host.models.DistributionList.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+s(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));return this.host.models.DistributionList.getMulti(e)}},{key:"removeMembers",value:(g=(0,S.default)(j.default.mark(function e(t){var n=t.id,r=t.members,a=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new U.ValidationError("id","required");case 2:if(Array.isArray(r)){e.next=4;break}throw new U.ValidationError("members","required","members must be an array");case 4:if(a){e.next=6;break}throw new U.ValidationError("organizationId","required");case 6:return e.next=8,this.host.api.distributionLists.membersBatch({id:n,members:r,operation:"remove",organizationId:a});case 8:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"search",value:(y=(0,S.default)(j.default.mark(function e(t){var n,r,a=t.continuation,o=t.network,i=void 0===o?"patient":o,s=t.organizationId,u=t.query,c=void 0===u?"":u,l=t.sortBy,d=void 0===l?"name":l,f=t.sortOrder,p=void 0===f?"asc":f,h=t.types,y=void 0===h?[N.SearchType.PATIENT_DISTRIBUTION_LIST]:h;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.search.query({continuation:a,network:i,organizationId:s,query:(0,A.default)({},D,c),returnFields:[],sort:(0,A.default)({},d,p),types:y});case 2:return n=e.sent,r=this._processSearchResults(n.results),e.abrupt("return",{metadata:n.metadata,results:r});case 5:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"findMembers",value:(h=(0,S.default)(j.default.mark(function e(t){var n,r,a,o,i,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},u=s.continuation,c=s.network,l=void 0===c?"patient":c,d=s.organizationId,f=s.query,p=void 0===f?"":f,h=s.sortBy,y=void 0===h?["display_name"]:h,g=s.sortOrder,v=void 0===g?["asc"]:g;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new U.ValidationError("id","required");case 2:if(d){e.next=4;break}throw new U.ValidationError("organizationId","required");case 4:if(y.length!==v.length)throw new U.ValidationError("sortBy","invalid","sortBy and sortOrder must be the same length");e.next=6;break;case 6:for(r={},a=0;a<y.length;a++)r[y[a]]=v[a];return e.next=10,this.host.search.query({continuation:u,network:l,organizationId:d,query:(n={},(0,A.default)(n,$,p),(0,A.default)(n,"dist_list_token",t),n),returnFields:[],sort:r,types:[N.SearchType.DISTRIBUTION_LIST_MEMBER]});case 10:return o=e.sent,i=this._processSearchResults(o.results),e.abrupt("return",{metadata:o.metadata,results:i});case 13:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"findMemberIds",value:(p=(0,S.default)(j.default.mark(function e(t,n){var r,a,o,i,s,u=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).continuation;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new U.ValidationError("id","required");case 2:if(n){e.next=4;break}throw new U.ValidationError("organizationId","required");case 4:return e.next=6,this.host.api.distributionLists.findMemberIds(t,n,{continuation:u});case 6:return r=e.sent,a=r.members,o=void 0===a?[]:a,i=r.metadata,s=o.map(function(e){return e.token}),e.abrupt("return",{metadata:i,results:s});case 12:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"update",value:(f=(0,S.default)(j.default.mark(function e(t){var n,r,a=t.adminOnly,o=t.id,i=t.name,s=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({adminOnly:a,name:i,id:o,organizationId:s}),e.next=3,this.host.api.distributionLists.update({adminOnly:a,id:o,name:i,organizationId:s});case 3:return n=e.sent,r=this.host.models.DistributionList.inject((0,O.default)({conversationId:n.conversation_id,organizationId:n.organization_id},n.entity)),e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_processSearchResults",value:function(e){return e.map(function(e){return e.entity}).filter(function(e){return!e.$deleted})}},{key:"_validate",value:function(e){var t=e.adminOnly,n=e.id,r=(e.members,e.name),a=e.organizationId,o=e.shouldCheckId,i=void 0===o||o,s=e.shouldCheckInvalid,u=void 0===s||s;if(i&&!n)throw new U.ValidationError("id","required");if(!a)throw new U.ValidationError("organizationId","required");if(u){if(void 0!==t&&"boolean"!=typeof t)throw new U.ValidationError("adminOnly","invalid","adminOnly must be a boolean value");if(r&&(0===r.length||60<r.length))throw new U.ValidationError("name","invalid","name must be less than 60 alphanumeric characters")}}}]),a((l=L).prototype,"find",[o],(0,I.default)(l.prototype,"find"),l.prototype),a(l.prototype,"findAll",[u],(0,I.default)(l.prototype,"findAll"),l.prototype),a(l.prototype,"search",[c],(0,I.default)(l.prototype,"search"),l.prototype),l);function L(){return(0,R.default)(this,L),(0,C.default)(this,(L.__proto__||(0,M.default)(L)).apply(this,arguments))}t.default=q,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function K(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,g.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=K(t[0],n);return t.every(function(e){return K(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return K(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+K(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function Z(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,g.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=Z(t[0],n);return t.every(function(e){return Z(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return Z(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+Z(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,h=r(n(3)),y=r(n(4)),g=r(n(5)),v=r(n(11)),H=r(n(10)),W=r(n(19)),X=r(n(22)),Q=r(n(12)),Y=r(n(38)),J=r(n(13)),ee=r(n(18)),m=r(n(9)),b=r(n(6)),w=r(n(1)),_=r(n(2)),x=r(n(8)),E=r(n(7)),te=r(n(57)),ne=r(n(60)),k=r(n(15)),T=n(20),re=n(23),ae=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),I=(a=(0,T.decorator)(),f=k.default,(0,E.default)(A,f),(0,_.default)(A,[{key:"findMulti",value:(p=(0,m.default)(H.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P,V,G,N,U,F,$,D,q,L,B=this;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+Z(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Z(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+K(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new ae.ValidationError("organizationId","required");case 10:return t=(0,ne.default)((0,re.arrayWrap)(t).map(this._resolveModelId)),r=(0,te.default)(t,10),a=r.map(function(e){return B.host.api.entities.findMulti({users:e,metadata:e,organizationId:n})}),e.next=15,ee.default.all(a);case 15:if(o=e.sent,i={},!o||"function"!=typeof o[J.default]&&!Array.isArray(o))throw new TypeError("Expected allResults to be iterable, got "+K(o));e.next=19;break;case 19:if(!o||"function"!=typeof o[J.default]&&!Array.isArray(o))throw new TypeError("Expected allResults to be iterable, got "+Z(o));e.next=21;break;case 21:u=!(s=!0),c=void 0,e.prev=24,l=(0,Q.default)(o);case 26:if(s=(d=l.next()).done){e.next=138;break}if(f=d.value,p=f.users,h=f.metadata,!p){e.next=82;break}if(!p||"function"!=typeof p[J.default]&&!Array.isArray(p))throw new TypeError("Expected users to be iterable, got "+K(p));e.next=32;break;case 32:if(!p||"function"!=typeof p[J.default]&&!Array.isArray(p))throw new TypeError("Expected users to be iterable, got "+Z(p));e.next=34;break;case 34:g=!(y=!0),v=void 0,e.prev=37,m=(0,Q.default)(p);case 39:if(y=(b=m.next()).done){e.next=68;break}if(w=b.value,!(I=(0,X.default)(w))||"function"!=typeof I[J.default]&&!Array.isArray(I))throw new TypeError("Expected _Object$entries to be iterable, got "+K(I));e.next=44;break;case 44:if(!I||"function"!=typeof I[J.default]&&!Array.isArray(I))throw new TypeError("Expected _Object$entries to be iterable, got "+Z(I));e.next=46;break;case 46:for(x=!(_=!0),E=void 0,e.prev=49,k=(0,Q.default)(I);!(_=(T=k.next()).done);_=!0)A=(0,W.default)(T.value,2),O=A[0],j=A[1],i[O]={entity:j};e.next=57;break;case 53:e.prev=53,e.t0=e.catch(49),x=!0,E=e.t0;case 57:e.prev=57,e.prev=58,!_&&k.return&&k.return();case 60:if(e.prev=60,x)throw E;e.next=63;break;case 63:return e.finish(60);case 64:return e.finish(57);case 65:y=!0,e.next=39;break;case 68:e.next=74;break;case 70:e.prev=70,e.t1=e.catch(37),g=!0,v=e.t1;case 74:e.prev=74,e.prev=75,!y&&m.return&&m.return();case 77:if(e.prev=77,g)throw v;e.next=80;break;case 80:return e.finish(77);case 81:return e.finish(74);case 82:if(!h){e.next=135;break}if(!h||"function"!=typeof h[J.default]&&!Array.isArray(h))throw new TypeError("Expected allMetadata to be iterable, got "+K(h));e.next=85;break;case 85:if(!h||"function"!=typeof h[J.default]&&!Array.isArray(h))throw new TypeError("Expected allMetadata to be iterable, got "+Z(h));e.next=87;break;case 87:M=!(S=!0),R=void 0,e.prev=90,z=(0,Q.default)(h);case 92:if(S=(C=z.next()).done){e.next=121;break}if(P=C.value,!($=(0,X.default)(P))||"function"!=typeof $[J.default]&&!Array.isArray($))throw new TypeError("Expected _Object$entries2 to be iterable, got "+K($));e.next=97;break;case 97:if(!$||"function"!=typeof $[J.default]&&!Array.isArray($))throw new TypeError("Expected _Object$entries2 to be iterable, got "+Z($));e.next=99;break;case 99:for(G=!(V=!0),N=void 0,e.prev=102,U=(0,Q.default)($);!(V=(F=U.next()).done);V=!0)D=(0,W.default)(F.value,2),O=D[0],q=D[1],(L=i[O])&&(L.metadata=q);e.next=110;break;case 106:e.prev=106,e.t2=e.catch(102),G=!0,N=e.t2;case 110:e.prev=110,e.prev=111,!V&&U.return&&U.return();case 113:if(e.prev=113,G)throw N;e.next=116;break;case 116:return e.finish(113);case 117:return e.finish(110);case 118:S=!0,e.next=92;break;case 121:e.next=127;break;case 123:e.prev=123,e.t3=e.catch(90),M=!0,R=e.t3;case 127:e.prev=127,e.prev=128,!S&&z.return&&z.return();case 130:if(e.prev=130,M)throw R;e.next=133;break;case 133:return e.finish(130);case 134:return e.finish(127);case 135:s=!0,e.next=26;break;case 138:e.next=144;break;case 140:e.prev=140,e.t4=e.catch(24),u=!0,c=e.t4;case 144:e.prev=144,e.prev=145,!s&&l.return&&l.return();case 147:if(e.prev=147,u)throw c;e.next=150;break;case 150:return e.finish(147);case 151:return e.finish(144);case 152:return e.abrupt("return",(0,Y.default)(i));case 153:case"end":return e.stop()}},e,this,[[24,140,144,152],[37,70,74,82],[49,53,57,65],[58,,60,64],[75,,77,81],[90,123,127,135],[102,106,110,118],[111,,113,117],[128,,130,134],[145,,147,151]])})),function(e,t){return p.apply(this,arguments)})}]),i=(o=A).prototype,s="findMulti",u=[a],c=(0,v.default)(o.prototype,"findMulti"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function A(){return(0,w.default)(this,A),(0,x.default)(this,(A.__proto__||(0,b.default)(A)).apply(this,arguments))}t.default=I,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,x.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,_.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,w.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,x.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,_.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,w.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,f,p,h,y,g,v,m,b,w=r(n(3)),_=r(n(4)),x=r(n(5)),E=r(n(11)),k=r(n(10)),T=r(n(9)),I=r(n(6)),A=r(n(1)),O=r(n(2)),j=r(n(8)),S=r(n(7)),M=n(20),R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),z=r(n(15)),C=(o=(0,M.decorator)(),i=(0,M.decorator)(),s=(0,M.decorator)(),u=(0,M.decorator)(),c=(0,M.decorator)(),p=z.default,(0,S.default)(P,p),(0,O.default)(P,[{key:"escalateMessage",value:(b=(0,T.default)(k.default.mark(function e(t){var n,r,a;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"message")){e.next=7;break}throw new R.NotFoundError(this.host.models.Message.name,t);case 7:return e.next=9,this.host.api.escalations.escalateMessage(n.serverId);case 9:return r=e.sent,a=(r||{}).escalation,e.abrupt("return",this._updateEscalation(a));case 12:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"acknowledge",value:(m=(0,T.default)(k.default.mark(function e(t){var n,r,a,o,i,s,u,c;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new R.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return t=n.id,r=n.originalMessageId,a=this.host,o=a.currentUser,i=a.currentUserId,(s=o.roles.map(function(e){return e.botUserId})).push(i),e.next=14,this.host.api.escalations.acknowledge(t,{messageId:r,userTokens:s});case 14:return u=e.sent,c=this.host.models.EscalationExecution.inject(u),e.abrupt("return",c);case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"cancel",value:(v=(0,T.default)(k.default.mark(function e(t){var n,r;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new R.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return r=n.originalMessageId,e.next=10,this.host.api.escalations.cancel(r);case 10:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"ensureEscalationExecution",value:(g=(0,T.default)(k.default.mark(function e(t){var n,r,a,o;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new R.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return r=n.carbonCopyMessageId,a=n.originalMessageId,o=[],r&&o.push(r),a&&o.push(a),e.next=13,this.host.messages.ensureRecipientStatusMulti(o);case 13:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"skip",value:(y=(0,T.default)(k.default.mark(function e(t){var n,r,a,o,i,s,u,c;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new R.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return t=n.id,r=n.originalMessageId,a=this.host,o=a.currentUser,i=a.currentUserId,(s=o.roles.map(function(e){return e.botUserId})).push(i),e.next=14,this.host.api.escalations.skip(t,{messageId:r,userTokens:s});case 14:return u=e.sent,c=this.host.models.EscalationExecution.inject(u),e.abrupt("return",c);case 17:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"removeEscalationGroup",value:(h=(0,T.default)(k.default.mark(function e(t){var n,r;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new R.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return r=n.groupId,e.next=10,this.host.api.groups.destroy(r);case 10:if(e.sent){e.next=13;break}throw new R.NotFoundError(this.host.models.Group.name,r);case 13:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"reactToEscalationsEvent",value:function(e){var t=e.data;this._updateEscalation(t.escalation)}},{key:"_updateEscalation",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).inGroupInject,n=void 0!==t&&t,r={};e&&e.display_name&&(r=this.host.models.EscalationExecution.inject(e));var a=r,o=a.id,i=a.carbonCopyMessage,s=a.groupId,u=a.organizationId,c=a.originalMessage;return c&&this.host.models.Message.inject({escalationExecutionId:o,id:c.id}),i&&this.host.models.Message.inject({escalationExecutionId:o,id:i.id}),s&&!n&&this.host.models.Group.inject({id:s,escalationExecutionId:o,organizationId:u}),r}},{key:"getAll",value:function(){return this.host.models.EscalationExecution.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(e));return this.host.models.EscalationExecution.get(e)}}]),a((f=P).prototype,"escalateMessage",[o],(0,E.default)(f.prototype,"escalateMessage"),f.prototype),a(f.prototype,"acknowledge",[i],(0,E.default)(f.prototype,"acknowledge"),f.prototype),a(f.prototype,"cancel",[s],(0,E.default)(f.prototype,"cancel"),f.prototype),a(f.prototype,"skip",[u],(0,E.default)(f.prototype,"skip"),f.prototype),a(f.prototype,"removeEscalationGroup",[c],(0,E.default)(f.prototype,"removeEscalationGroup"),f.prototype),f);function P(){return(0,A.default)(this,P),(0,j.default)(this,(P.__proto__||(0,I.default)(P)).apply(this,arguments))}t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i=r(n(3)),s=r(n(4)),u=r(n(5)),x=r(n(19)),E=r(n(12)),k=r(n(13)),T=r(n(22)),I=r(n(31)),A=r(n(10)),O=r(n(9)),j=r(n(6)),S=r(n(1)),o=r(n(2)),M=r(n(8)),c=r(n(7)),l=r(n(15)),d=(a=l.default,(0,c.default)(R,a),(0,o.default)(R,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.info("unhandled event: "+e.type,e.data)}}]),R);function R(e,t){var n;(0,S.default)(this,R);var r=(0,M.default)(this,(R.__proto__||(0,j.default)(R)).call(this,e,t));if(r.EVENTS=(n={},(0,I.default)(n,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,I.default)(n,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),(0,I.default)(n,"escalations",function(e){this.host.escalations.reactToEscalationsEvent(e)}),(0,I.default)(n,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,I.default)(n,"message|group_message",function(e){this.host.conversations.reactToMessageEvent(e)}),(0,I.default)(n,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,I.default)(n,"user_preferences",function(e){this.host.users.reactToUserPreferencesEvent(e)}),(0,I.default)(n,"org_preferences",function(e){this.host.organizations.reactToOrganizationPreferencesEvent(e)}),(0,I.default)(n,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,I.default)(n,"update",function(e){this.host.conversations.reactToUpdateEvent(e)}),(0,I.default)(n,"update:tag",function(e){this.host.roleTags.reactToUpdateEvent(e)}),(0,I.default)(n,"update:team_request",function(e){this.host.conversations.reactToUpdateTeamRequestEvent(e)}),(0,I.default)(n,"account:settings",function(n){var r=this;n.data.services.forEach(function(e){switch(e.xmlns){case"tigertext:iq:update:account":var t=e.account||n.data.token;r.host.users.refresh(t);break;case"tigertext:iq:update:org_settings":r.host.organizations.refreshAll();break;default:r.logger.warn("unhandled account:settings service type "+e.xmlns)}})}),(0,I.default)(n,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,I.default)(n,"processing:start",function(e){this.host.conversations.reactToProcessingStart(e)}),(0,I.default)(n,"processing:stop",function(e){this.host.conversations.reactToProcessingStop(e)}),(0,I.default)(n,"remote_wipe",function(e){var t=this;return(0,O.default)(A.default.mark(function e(){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.host.notifications.disconnect({source:"remote_wipe event"}),t.host.signOut({fromServer:!0});case 2:case"end":return e.stop()}},e,t)}))()}),(0,I.default)(n,"validated",function(e){this.logger.warn("validated not implemented")}),(0,I.default)(n,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,I.default)(n,"conversation_mute",function(e){this.host.mute.reactToMuteEvent(e)}),(0,I.default)(n,"reconnect",function(e){this.host.events.reconnect()}),(0,I.default)(n,"voip:incoming|voip:ended|voip:answered|voip:state",function(e){this.host.calls.reactToVoipSSE(e)}),(0,I.default)(n,"push:credentials",function(){return null}),(0,I.default)(n,"sse:heartbeat",function(){return null}),(0,I.default)(n,"sse:keepalive",function(){return null}),n),!(c=(0,T.default)(r.EVENTS))||"function"!=typeof c[k.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+w(c));if(!c||"function"!=typeof c[k.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+_(c));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,E.default)(c);!(a=(s=u.next()).done);a=!0){var c,l=(0,x.default)(s.value,2),d=l[0],f=l[1];if(d.includes("|")){if(!(m=d.split("|"))||"function"!=typeof m[k.default]&&!Array.isArray(m))throw new TypeError("Expected _eventName$split to be iterable, got "+w(m));if(!m||"function"!=typeof m[k.default]&&!Array.isArray(m))throw new TypeError("Expected _eventName$split to be iterable, got "+_(m));var p=!0,h=!1,y=void 0;try{for(var g,v=(0,E.default)(m);!(p=(g=v.next()).done);p=!0){var m,b=g.value;r.EVENTS[b]=f}}catch(e){h=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw y}}delete r.EVENTS[d]}}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}return r}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,h,y=r(n(3)),g=r(n(4)),v=r(n(5)),m=r(n(11)),b=r(n(10)),w=r(n(30)),_=r(n(18)),x=r(n(9)),E=r(n(6)),k=r(n(1)),T=r(n(2)),I=r(n(8)),A=r(n(7)),O=r(n(25)),j=r(n(35)),S=n(20),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),R=r(n(15)),z=(o=(0,S.decorator)(),u=(0,S.decorator)(),l=R.default,(0,A.default)(C,l),(0,T.default)(C,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"create",value:(h=(0,x.default)(b.default.mark(function e(t){var n,r,a,o,i=this,s=t.avatarFile,u=t.description,c=t.memberIds,l=void 0===c?[]:c,d=t.metadata,f=t.name,p=t.organizationId,h=t.replayHistory,y=void 0===h||h,g=t.senderId,v=void 0===g?this.host.currentUserId:g;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),p){e.next=3;break}throw new M.ValidationError("organizationId","required");case 3:return e.next=5,_.default.all([v].concat((0,w.default)(l)).map(this.host.roles.__resolveRoleId).filter(Boolean).map(function(e){return i._resolveModelIdWithTypes(e,"user")}).map(function(e){return i.host.users.findOrCreate(e,{organizationId:p})}));case 5:return n=e.sent,e.t0=n,r=j.default.call(e.t0),l=r.map(function(e){return i._resolveModelIdWithTypes(e,"user")}),e.next=11,this.host.api.groups.create({avatarFile:s,description:u,excludeCreator:!1,isPublic:!0,memberIds:l,metadata:d,name:f,organizationId:p,replayHistory:y});case 11:return a=e.sent,o=this.config.condensedReplays&&a.entity?this.host.conversations.__injectCounterParty({conversationId:a.conversation_id,entityAttrs:a.entity,entityType:"group",hasCurrentUser:!0,organizationId:a.organization_id}):this.host.models.Group.inject(a),d&&this.host.metadata.__injectMetadata(o.id,p,d),e.abrupt("return",o);case 16:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"find",value:(p=(0,x.default)(b.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:if(a=(0,O.default)(a,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=null,a.bypassCache){e.next=13;break}if((n=this.host.models.Group.get(t))&&!n.$placeholder)return e.next=12,this.host.groups.__ensureEntitiesLoaded(n.id,a);e.next=13;break;case 12:return e.abrupt("return",n);case 13:return e.next=15,this.host.groups.__find(t);case 15:if(r=e.sent,n=this.host.models.Group.get(t),r){e.next=21;break}if(a.ignoreNotFound){e.next=20;break}throw new M.NotFoundError(this.host.models.Group.name,t);case 20:return e.abrupt("return",n);case 21:if(n)return e.next=24,this.host.groups.__ensureEntitiesLoaded(n.id,a);e.next=24;break;case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"findAll",value:(f=(0,x.default)(b.default.mark(function e(){var t,n,r,a,o=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).bypassCache,i=void 0!==o&&o;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i&&this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["forum"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Group.getAll().filter(function(e){return e.isPublic})}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));return this.host.models.Group.get(e)}},{key:"join",value:(d=(0,x.default)(b.default.mark(function e(t){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+s(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:return e.abrupt("return",this.host.groups.addMembers(t,[this.host.currentUserId]));case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})}]),a((c=C).prototype,"find",[o],(0,m.default)(c.prototype,"find"),c.prototype),a(c.prototype,"findAll",[u],(0,m.default)(c.prototype,"findAll"),c.prototype),c);function C(){return(0,k.default)(this,C),(0,I.default)(this,(C.__proto__||(0,E.default)(C)).apply(this,arguments))}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function D(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,z.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=D(t[0],n);return t.every(function(e){return D(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return D(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,R.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,M.default)(e))+": "+D(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function q(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,z.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=q(t[0],n);return t.every(function(e){return q(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return q(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,R.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,M.default)(e))+": "+q(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M=r(n(3)),R=r(n(4)),z=r(n(5)),C=r(n(11)),P=r(n(19)),V=r(n(22)),G=r(n(10)),N=r(n(16)),U=r(n(30)),F=r(n(18)),$=r(n(9)),L=r(n(12)),B=r(n(13)),K=r(n(6)),Z=r(n(1)),H=r(n(2)),W=r(n(8)),X=r(n(7)),Q=r(n(267)),Y=r(n(45)),J=r(n(282)),ee=r(n(25)),te=r(n(36)),ne=r(n(39)),re=r(n(15)),ae=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),oe=n(20),ie=r(n(35)),se=n(26),ue=n(23),ce=n(32),le=n(28),de=(o=(0,oe.decorator)(),i=(0,oe.decorator)(),s=(0,oe.decorator)(),u=(0,oe.decorator)(),c=(0,oe.decorator)(),l=(0,oe.decorator)(),f=re.default,(0,X.default)(fe,f),(0,H.default)(fe,[{key:"mounted",value:function(){this._fetched=!1,this._groupMemberIds={},this._userGroups={},this._userState={},this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onRemoveConversation),this.host.models.Group.on("afterInject",this._onChangeGroup),this.host.models.Group.on("afterEject",this._onRemoveGroup),this.host.models.Metadata.on("afterInject",this._onChangeMetadata),this.host.models.Metadata.on("afterEject",this._onChangeMetadata),this.host.models.User.on("afterInject",this._onChangeUser),this.host.models.User.on("afterEject",this._onRemoveUser)}},{key:"dispose",value:function(){this._fetched=!1,this._groupMemberIds={},this._userGroups={},this._userState={},this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onRemoveConversation),this.host.models.Group.removeListener("afterInject",this._onChangeGroup),this.host.models.Group.removeListener("afterEject",this._onRemoveGroup),this.host.models.Metadata.removeListener("afterInject",this._onChangeMetadata),this.host.models.Metadata.removeListener("afterEject",this._onChangeMetadata),this.host.models.User.removeListener("afterInject",this._onChangeUser),this.host.models.User.removeListener("afterEject",this._onRemoveUser)}},{key:"create",value:(S=(0,$.default)(G.default.mark(function e(t){var n,r,a,o,i,s=this,u=t.avatarFile,c=t.description,l=t.isPatientGroup,d=void 0!==l&&l,f=t.isTeamActivation,p=void 0!==f&&f,h=t.memberIds,y=void 0===h?[]:h,g=t.metadata,v=t.name,m=t.organizationId,b=t.replayHistory,w=void 0!==b&&b,_=t.senderId,x=void 0===_?this.host.currentUserId:_;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),m){e.next=3;break}throw new ae.ValidationError("organizationId","required");case 3:return e.next=5,F.default.all([x].concat((0,U.default)(y)).map(this.host.roles.__resolveRoleId).filter(Boolean).map(function(e){return s._resolveModelIdWithTypes(e,["user","team"])}).map(function(e){var t=s._resolveEntity(e);return"team"===(0,te.default)(t,"$entityType")?t:s.host.users.findOrCreate(e,{organizationId:m})}));case 5:return n=e.sent,e.t0=n,r=ie.default.call(e.t0),y=r.map(function(e){return s._resolveModelIdWithTypes(e,["user","team"])}),a=this._shouldExcludeSender(m,y,x),v||d||p||(v=this._getGroupName(r)),e.next=13,this.host.api.groups.create({avatarFile:u,description:c,excludeCreator:a,memberIds:y,metadata:g,name:v,organizationId:m,replayHistory:w});case 13:if(o=e.sent,i=void 0,this.config.condensedReplays&&o.entity?(i=this.host.conversations.__injectCounterParty({conversationId:o.conversation_id,entityAttrs:o.entity,entityType:"group",organizationId:o.organization_id}),this.host.conversations.__injectConversation((0,N.default)({},o,{entity:i}))):i=this.host.models.Group.inject(o),!g){e.next=20;break}this.host.metadata.__injectMetadata(i.id,m,g),e.next=23;break;case 20:if(this.config.condensedReplays){e.next=23;break}return e.next=23,this.host.metadata.find(i.id,m);case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"createPatientGroup",value:function(e){var t=e.metadata,n=e.name,r=e.organizationId,a=e.recipientId,o=e.senderId;return this.create({isPatientGroup:!0,metadata:t,name:n,organizationId:r,memberIds:[o].concat((0,U.default)(a))})}},{key:"_shouldExcludeSender",value:function(e,t,n){var r,a,o=this.host.models.User.get(n);return!!((r=a=o)&&"user"===r.$entityType&&a.isRoleBot&&o.botRole&&0<o.botRole.members.length)&&!t.includes(o.botRole.memberIds[0])}},{key:"_getGroupName",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return e.map(function(e){var t=e.displayName,n=e.firstName;return e.isRoleBot||"role"===e.$entityType||"team"===e.$entityType?t:n||((0,ce.isEmail)(t)||(0,le.isPhone)(t)?t:"")}).filter(Boolean).join(", ")+(t?" ####":"")||"Group"}},{key:"update",value:(j=(0,$.default)(G.default.mark(function e(t,n){var r,a,o,i=n.name,s=n.avatarFile,u=n.replayHistory,c=n.memberIds,l=n.metadata;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),r={},void 0!==i&&(r.name=i),void 0!==u&&(r.replayHistory=u),void 0!==c&&(r.memberIds=c.map(this.host.roles.__resolveRoleId)),e.next=12,this.host.api.groups.update(t,{name:i,avatarFile:s,replayHistory:u,memberIds:c});case 12:if(void 0!==(a=e.sent).avatarUrl&&(r.avatarUrl=a.avatarUrl),o=this.host.models.Group.inject((0,N.default)({id:t},r)),l)return e.next=18,this.host.metadata.update(t,l,o.organizationId);e.next=18;break;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"find",value:(O=(0,$.default)(G.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=4;break;case 4:if(a=(0,ee.default)(a,{bypassCache:!1,ignoreNotFound:!1,includeMembers:!1}),this.host.requireUser(),n=null,a.bypassCache){e.next=13;break}if((n=this.host.models.Group.get(t))&&!n.$placeholder)return e.next=12,this.__ensureEntitiesLoaded(n.id,a);e.next=13;break;case 12:return e.abrupt("return",n);case 13:return e.next=15,this.__find(t);case 15:if(r=e.sent,n=this.host.models.Group.get(t),r){e.next=21;break}if(a.ignoreNotFound){e.next=20;break}throw new ae.NotFoundError(this.host.models.Group.name,t);case 20:return e.abrupt("return",n);case 21:if(n)return e.next=24,this.__ensureEntitiesLoaded(n.id,a);e.next=24;break;case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"__find",value:(A=(0,$.default)(G.default.mark(function e(t){var n,r,a,o,i;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=4;break;case 4:return n=this.host.models.Group.get(t),e.next=7,this.host.api.groups.find(t);case 7:if(r=e.sent,this.config.condensedReplays&&r&&r.entity)return a=r.entity,n=this.host.conversations.__injectCounterParty({conversationId:r.conversation_id,entityAttrs:a,entityType:"group",organizationId:r.organization_id}),this.host.models.Group.removePlaceholder({entity:n,attrs:a}),e.abrupt("return",a);e.next=15;break;case 15:return r&&(this.__removeForumMembers(r),o=r.metadata,n=this.host.models.Group.inject(r),i=n.organizationId,o&&i&&this.host.metadata.__injectMetadata(t,i,o)),this.host.models.Group.removePlaceholder({entity:n,attrs:r}),e.abrupt("return",r);case 18:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"__removeForumMembers",value:function(e){var t=e.members,n=this.__extractGroupTypeFromAttrs(e);n===se.GroupType.FORUM?t&&0===t.length&&delete e.members:n===se.GroupType.ROLE_ASSIGNMENT||t||(e.members=[])}},{key:"__extractGroupTypeFromAttrs",value:function(e){var t=e.id||e.token,n=e.organizationId||e.organization_key,r=n?this.host.metadata.get(t,n):null,a=e.metadata||(r?r.data:null),o=se.GroupType.GROUP;if(a&&"role_assignment"===a.meta_type)o=se.GroupType.ROLE_ASSIGNMENT;else if(a&&"role"===a.feature_service)o=se.GroupType.ROLE_P2P;else if(a&&"escalation"===a.feature_service)o=se.GroupType.ESCALATION;else if(a&&"patient_care"===a.feature_service)o=se.GroupType.PATIENT_CARE;else if(a&&"patient_messaging"===a.feature_service)o=se.GroupType.PATIENT_MESSAGING;else if(a&&"teams"===a.feature_service){var i=a.meta_type;"activated_team"===i?o=se.GroupType.ACTIVATED_TEAM:"intra_team"===i&&(o=se.GroupType.INTRA_TEAM)}else(e.isPublic||e.is_public)&&(o=se.GroupType.FORUM);return o}},{key:"__ensureEntitiesLoaded",value:(I=(0,$.default)(G.default.mark(function e(t,n){var r,a;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=4;break;case 4:return r=this.host.models.Group.get(t),a=[this.ensureMetadata(r)],n.includeMembers&&a.push(this.ensureMembers(r)),e.next=9,F.default.all(a);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"findAll",value:(T=(0,$.default)(G.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).includeMembers,j=void 0!==O&&O;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["group"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:if(n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),!j){e.next=93;break}if(o={},!a||"function"!=typeof a[B.default]&&!Array.isArray(a))throw new TypeError("Expected groups to be iterable, got "+D(a));e.next=16;break;case 16:if(!a||"function"!=typeof a[B.default]&&!Array.isArray(a))throw new TypeError("Expected groups to be iterable, got "+q(a));e.next=18;break;case 18:s=!(i=!0),u=void 0,e.prev=21,c=(0,L.default)(a);case 23:if(i=(l=c.next()).done){e.next=52;break}if(d=l.value,f=d.organizationId,!(p=d.memberIds)||"function"!=typeof p[B.default]&&!Array.isArray(p))throw new TypeError("Expected memberIds to be iterable, got "+D(p));e.next=28;break;case 28:if(!p||"function"!=typeof p[B.default]&&!Array.isArray(p))throw new TypeError("Expected memberIds to be iterable, got "+q(p));e.next=30;break;case 30:for(y=!(h=!0),g=void 0,e.prev=33,v=(0,L.default)(p);!(h=(m=v.next()).done);h=!0)b=m.value,o[f]||(o[f]=[]),o[f].includes(b)||o[f].push(b);e.next=41;break;case 37:e.prev=37,e.t0=e.catch(33),y=!0,g=e.t0;case 41:e.prev=41,e.prev=42,!h&&v.return&&v.return();case 44:if(e.prev=44,y)throw g;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:i=!0,e.next=23;break;case 52:e.next=58;break;case 54:e.prev=54,e.t1=e.catch(21),s=!0,u=e.t1;case 58:e.prev=58,e.prev=59,!i&&c.return&&c.return();case 61:if(e.prev=61,s)throw u;e.next=64;break;case 64:return e.finish(61);case 65:return e.finish(58);case 66:if(w=[],!(I=(0,V.default)(o))||"function"!=typeof I[B.default]&&!Array.isArray(I))throw new TypeError("Expected _Object$entries to be iterable, got "+D(I));e.next=70;break;case 70:if(!I||"function"!=typeof I[B.default]&&!Array.isArray(I))throw new TypeError("Expected _Object$entries to be iterable, got "+q(I));e.next=72;break;case 72:for(x=!(_=!0),E=void 0,e.prev=75,k=(0,L.default)(I);!(_=(T=k.next()).done);_=!0)A=(0,P.default)(T.value,2),f=A[0],p=A[1],w.push(this.host.users.ensureUsers(p,f));e.next=83;break;case 79:e.prev=79,e.t2=e.catch(75),x=!0,E=e.t2;case 83:e.prev=83,e.prev=84,!_&&k.return&&k.return();case 86:if(e.prev=86,x)throw E;e.next=89;break;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.next=93,F.default.all(w);case 93:return this._fetched=!0,e.abrupt("return",a);case 95:case"end":return e.stop()}},e,this,[[21,54,58,66],[33,37,41,49],[42,,44,48],[59,,61,65],[75,79,83,91],[84,,86,90]])})),function(){return T.apply(this,arguments)})},{key:"findAllWithSpecificMembers",value:(k=(0,$.default)(G.default.mark(function e(t,n,r){var a;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+q(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(n));case 4:if(null==r||r instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+q(r));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+D(t));case 8:if("string"==typeof n||n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 10:if(null==r||r instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+D(r));case 12:if(n=this._resolveModelId(n),t=(0,ue.arrayWrap)(t).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),a=this.__findAllLocalWithSpecificMembers(t,n,r),r&&r.localOnly||0!==a.length){e.next=20;break}return e.next=19,this.findAll();case 19:a=this.__findAllLocalWithSpecificMembers(t,n,r);case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}},e,this)})),function(e,t,n){return k.apply(this,arguments)})},{key:"ensureMembers",value:(E=(0,$.default)(G.default.mark(function e(t){var n,r,a,o,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+q(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+D(t));case 4:if(n=t.groupType===se.GroupType.ROLE_ASSIGNMENT,t.memberIds){e.next=18;break}if(t.groupType===se.GroupType.FORUM)return e.next=9,this.findAllMemberIds(t.id);e.next=13;break;case 9:(r=e.sent)&&this.host.models.Group.inject({id:t.id,members:r}),e.next=18;break;case 13:if(!n){e.next=16;break}e.next=18;break;case 16:return e.next=18,this.__find(t.id);case 18:return a=i.attrs?(0,N.default)({},i.attrs):{},o=n&&!t.memberIds?[]:t.memberIds,a.organizationId=t.organizationId,e.next=23,this.ensureMembersWithIds(t.id,o,(0,N.default)({},i,{attrs:a}));case 23:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"ensureMembersWithIds",value:(x=(0,$.default)(G.default.mark(function e(t,n){var r=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+q(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+D(n));case 8:if(this.host.requireUser(),0===(n=(0,J.default)(n,this.host.currentUserId)).length)return e.abrupt("return");e.next=12;break;case 12:return a=(0,ee.default)(a,{onlyPlaceholder:!1}),e.next=15,F.default.all(n.map(function(e){return r.__ensureMember(e,a)}).filter(Boolean));case 15:0<e.sent.length&&this.host.models.Group.touch(t);case 17:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"__ensureMember",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(e));if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(e));if(!this.host.models.User.shouldEnsure(e,t.onlyPlaceholder))return null;var n=this.host.models.User.get(e);return n&&t.attrs&&this.host.models.User.injectPlaceholder((0,N.default)({id:n.id},t.attrs)),this.host.models.User.waitForEnsuredEntity(e,t)}},{key:"ensureMetadata",value:(_=(0,$.default)(G.default.mark(function e(t){var n,r,a;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+q(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+D(t));case 4:if(n=t.groupType,r=t.id,(a=t.organizationId)&&this.host.metadata.get(r,a)){e.next=12;break}if(n!==se.GroupType.FORUM&&n!==se.GroupType.ROLE_ASSIGNMENT){e.next=10;break}e.next=12;break;case 10:return e.next=12,this.__find(r);case 12:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Group.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+q(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+D(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=n.exact,a=void 0===r||r,o=n.includeCurrentUser,i=void 0===o||o,s=n.includeForums,u=void 0===s||s,c=n.includeRoles,l=void 0===c||c,d=n.senderId,f=void 0===d?null:d;if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+q(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+q(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+D(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));var p=this.host,h=p.currentUser,y=p.currentUserId,g=h.roles.map(function(e){return e.botUserId});f&&g.includes(f)?(e=e.slice()).push(f,y):i&&!e.includes(y)&&(e=e.slice()).push(y);var v=e.includes(y),m=e.length,b=this.host.models.Group.getAll(),w=[];if(!b||"function"!=typeof b[B.default]&&!Array.isArray(b))throw new TypeError("Expected all to be iterable, got "+D(b));if(!b||"function"!=typeof b[B.default]&&!Array.isArray(b))throw new TypeError("Expected all to be iterable, got "+q(b));var _=!0,x=!1,E=void 0;try{for(var k,T=(0,L.default)(b);!(_=(k=T.next()).done);_=!0){var I=k.value;if(u||I.groupType!==se.GroupType.FORUM){var A=I.memberIds;if(I.organizationId===t&&A){var O=!0;if(!e||"function"!=typeof e[B.default]&&!Array.isArray(e))throw new TypeError("Expected memberIds to be iterable, got "+D(e));if(!e||"function"!=typeof e[B.default]&&!Array.isArray(e))throw new TypeError("Expected memberIds to be iterable, got "+q(e));var j=!0,S=!1,M=void 0;try{for(var R,z=(0,L.default)(e);!(j=(R=z.next()).done);j=!0){var C=R.value;if(!A.includes(C)){O=!1;break}}}catch(e){S=!0,M=e}finally{try{!j&&z.return&&z.return()}finally{if(S)throw M}}if(O){if(a){if(!f&&!v)continue;var P=m;if(l){if(!g||"function"!=typeof g[B.default]&&!Array.isArray(g))throw new TypeError("Expected myBotUserIds to be iterable, got "+D(g));if(!g||"function"!=typeof g[B.default]&&!Array.isArray(g))throw new TypeError("Expected myBotUserIds to be iterable, got "+q(g));var V=!0,G=!1,N=void 0;try{for(var U,F=(0,L.default)(g);!(V=(U=F.next()).done);V=!0){var $=U.value;I.memberIds.includes($)&&P++}}catch(e){G=!0,N=e}finally{try{!V&&F.return&&F.return()}finally{if(G)throw N}}}if(P!==I.memberIds.length)continue}w.push(I)}}}}}catch(e){x=!0,E=e}finally{try{!_&&T.return&&T.return()}finally{if(x)throw E}}return w}},{key:"destroy",value:(w=(0,$.default)(G.default.mark(function e(t){return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.next=8,this.host.api.groups.destroy(t);case 8:if(e.sent){e.next=11;break}throw new ae.NotFoundError(this.host.models.Group.name,t);case 11:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"findAllMemberIds",value:(b=(0,$.default)(G.default.mark(function e(t){return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.abrupt("return",this.host.api.groups.findAllMemberIds(t));case 7:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"addMembers",value:(m=(0,$.default)(G.default.mark(function e(t,n){var r,a,o,i;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+q(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+D(n));case 8:if(this.host.requireUser(),t=this._resolveModelId(t),n=(0,ue.arrayWrap)(n).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),(r=this.getById(t))&&r.groupType===se.GroupType.ROLE_P2P)throw new ae.PermissionDeniedError("role p2p group",r.id,"add users");e.next=14;break;case 14:if(!r){e.next=20;break}if("FORUM"!==r.groupType||r.memberIds){e.next=19;break}return e.next=18,this.findAllMemberIds(t);case 18:r.memberIds=e.sent;case 19:n=(0,Y.default)(n,r.memberIds);case 20:if(0===n.length)return e.abrupt("return");e.next=22;break;case 22:return e.next=24,this.host.api.groups.addMembers(t,n);case 24:if(a=e.sent,!this.config.condensedReplays){e.next=37;break}if(o=this.host.conversations.getById(a.conversation_id)){e.next=34;break}return e.next=30,this.host.api.conversations.find(a.conversation_id);case 30:if(i=e.sent){e.next=33;break}throw new ae.NotFoundError(this.host.models.Conversation.name,t);case 33:o=this.host.conversations.__injectConversation(i);case 34:a.unread_message_count&&(o.unreadCount=a.unread_message_count),a.unread_priority_message_count&&(o.unreadPriorityCount=a.unread_priority_message_count),this.host.models.Conversation.inject(o);case 37:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"removeMembers",value:(v=(0,$.default)(G.default.mark(function e(t,n){var r,a,o,i,s;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+q(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+D(n));case 8:if(this.host.requireUser(),t=this._resolveModelId(t),n=(0,ue.arrayWrap)(n).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),!(r=this.getById(t))){e.next=22;break}if(a=r.groupType,o=r.id,i=r.p2pSender,s=i&&"role"===i.$entityType&&i.botUserId,a===se.GroupType.ROLE_P2P&&s&&n.includes(s))throw new ae.PermissionDeniedError("role p2p group",o,"remove an on-duty user");e.next=17;break;case 17:if("FORUM"!==a||r.memberIds){e.next=21;break}return e.next=20,this.findAllMemberIds(t);case 20:r.memberIds=e.sent;case 21:n=(0,Q.default)(n,r.memberIds);case 22:if(0===n.length)return e.abrupt("return");e.next=24;break;case 24:return e.next=26,this.host.api.groups.removeMembers(t,n);case 26:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"addMember",value:(g=(0,$.default)(G.default.mark(function e(t,n){return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 8:return e.abrupt("return",this.addMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"removeMember",value:(y=(0,$.default)(G.default.mark(function e(t,n){return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 8:return e.abrupt("return",this.removeMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"leave",value:(h=(0,$.default)(G.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+q(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 4:if(t=this._resolveModelId(t),n=this.getById(t)){e.next=8;break}return e.abrupt("return");case 8:if(r=this.host,a=r.currentUser,o=r.currentUserId,i=n.groupType,s=n.p2pSender,u=n.memberIds,c=a.roles.map(function(e){return e.botUserId}),l=[o],i===se.GroupType.FORUM)return e.next=16,this.findAllMemberIds(t);e.next=17;break;case 16:u=e.sent;case 17:if(i!==se.GroupType.ROLE_P2P||!s){e.next=21;break}l=["user"===s.$entityType?s.id:s.botUserId],e.next=45;break;case 21:if(!u){e.next=45;break}if(!u||"function"!=typeof u[B.default]&&!Array.isArray(u))throw new TypeError("Expected memberIds to be iterable, got "+D(u));e.next=24;break;case 24:if(!u||"function"!=typeof u[B.default]&&!Array.isArray(u))throw new TypeError("Expected memberIds to be iterable, got "+q(u));e.next=26;break;case 26:for(f=!(d=!0),p=void 0,e.prev=29,h=(0,L.default)(u);!(d=(y=h.next()).done);d=!0)g=y.value,c.includes(g)&&l.push(g);e.next=37;break;case 33:e.prev=33,e.t0=e.catch(29),f=!0,p=e.t0;case 37:e.prev=37,e.prev=38,!d&&h.return&&h.return();case 40:if(e.prev=40,f)throw p;e.next=43;break;case 43:return e.finish(40);case 44:return e.finish(37);case 45:return e.next=47,this.removeMembers(t,l);case 47:case"end":return e.stop()}},e,this,[[29,33,37,45],[38,,40,44]])})),function(e){return h.apply(this,arguments)})},{key:"reactToBangEvent",value:function(e){var t=e.data,n=(t=(0,ue.jsonCloneDeep)(t)).bang_id||""+t.sort_number;return this.__handleBang({data:t,eventId:n,alwaysAddToTimeline:!1})}},{key:"__handleBang",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=void 0!==r&&r,o=t.event;"added"===o?this.__addedToGroup({data:t,eventId:n,alwaysAddToTimeline:a}):"removed"===o?this.__removedFromGroup({data:t,eventId:n,alwaysAddToTimeline:a}):"teams_request_accepted"===o?this.__acceptedToTeam({data:t,eventId:n,alwaysAddToTimeline:a}):"teams_request_declined"===o||"teams_request_declined_full"===o?this.__deniedToTeam({data:t,eventId:n,alwaysAddToTimeline:a}):se.EscalationChangeAction.fromServer(o)?this.__handleEscalationBang({data:t,eventId:n,alwaysAddToTimeline:a}):"ended_voip_call"===o&&this.__handleEndedCall({data:t,eventId:n,alwaysAddToTimeline:a})}},{key:"__handleEndedCall",value:(p=(0,$.default)(G.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_=t.data,x=t.eventId,E=t.alwaysAddToTimeline;return G.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=_.participants_duration,r=_.caller_entity,a=_.conversation_id,o=_.created_on,i=_.organization_id,s=_.sort_number,u=_.subject_entity,c=_.target_entity,l=void 0,e.prev=2,l=JSON.parse(n),e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return");case 9:if(!l||(0,ne.default)(l)||(0,ne.default)(l[this.host.currentUserId]))return e.abrupt("return");e.next=11;break;case 11:if(d=l[this.host.currentUserId],f=d.duration,p=d.start_time,f){e.next=14;break}return e.abrupt("return");case 14:if((0,te.default)(r,"token")&&(0,te.default)(c,"token")){e.next=16;break}return e.abrupt("return");case 16:if(h=[r,c].map(function(e){var t=e.display_name,n=e.token,r=e.type;return{displayName:t,id:n,organizationId:i,type:r}}),y=(0,P.default)(h,2),g=y[0],v=y[1],m=void 0,!v.type.includes("group")){e.next=22;break}m=this.host.models.Group.get(v.id),e.next=28;break;case 22:if(v.type.includes("account"))return e.next=25,this.findAllWithSpecificMembers([v.id,g.id],i);e.next=28;break;case 25:b=e.sent,w=1===b.length&&2===b[0].memberCount,m=w&&b[0];case 28:if(m){e.next=30;break}return e.abrupt("return");case 30:this.host.conversations.addCallChangeLog({action:"CALL_ENDED",alwaysAddToTimeline:E,callee:v,callEntity:u,caller:g,conversationId:a,createdAt:o,duration:f,group:m,id:x,organizationId:i,sortNumber:+s,userStartTime:p});case 31:case"end":return e.stop()}},e,this,[[2,6]])})),function(e){return p.apply(this,arguments)})},{key:"__addedToGroup",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(a&&a.token&&i&&i.token&&o&&o.token){o&&!o.display_name&&(r=!1);var u=this.host.models.Group.get(i.token);if(u){var c,l={displayName:a.display_name,id:a.token,organizationId:s,type:"user"},d={displayName:o.display_name,id:o.token,organizationId:s,type:"user"},f=this.host.models.User.get(l.id),p={action:c=f&&f.isRoleBot||a.metadata&&"role"===a.metadata.feature_service?"OPT_IN":d.id===l.id?"JOIN":"ADD",actionTime:t.action_time||t.created_on,actor:l,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[d],memberIds:[d.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(p),"OPT_IN"!=c&&u.memberIds&&u.memberIds.includes(d.id)||(this.host.models.Group.touch(u),this.emit("membership:change",p))}}}},{key:"__removedFromGroup",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id,u=!1;if(a&&a.token&&i&&i.token&&o&&o.token){var c=this.host.models.Group.get(i.token);if(c){if(t.reason&&("leave_org"===t.reason||"delete_account"===t.reason)&&(t.reason_subject_token||t.subject_entity.token)){u=!(r=!1);var l=t.reason_subject_token||t.subject_entity.token;this.host.models.User.inject({id:l,removedFromOrg:!0})}var d,f={displayName:a.display_name,id:a.token,organizationId:s,type:"user"},p={displayName:o.display_name,id:o.token,organizationId:s,type:"user"},h=this.host.models.User.get(f.id),y={action:d=h&&h.isRoleBot||a.metadata&&"role"===a.metadata.feature_service?"OPT_OUT":p.id===f.id?"LEAVE":"REMOVE",actionTime:t.action_time||t.created_on,actor:f,alwaysAddToTimeline:r,createdAt:t.created_on,group:c,id:n,members:[p],memberIds:[p.id],removedFromGroup:u,sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(y),"OPT_OUT"!=d&&c.memberIds&&!c.memberIds.includes(p.id)||this.emit("membership:change",y)}}}},{key:"__acceptedToTeam",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(a&&a.token&&i&&i.token&&o&&o.token){var u=this.host.models.Group.get(i.token);if(u){var c={displayName:t.action_user_name,id:t.action_user_id,organizationId:s,type:"user"},l={displayName:a.display_name,id:a.token,organizationId:s,type:"user"},d={action:"ADD",actionTime:t.action_time||t.created_on,actor:c,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[l],memberIds:[l.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(d)}}}},{key:"__deniedToTeam",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(a&&a.token&&i&&i.token&&o&&o.token){var u=this.host.models.Group.get(i.token);if(u){var c={displayName:t.action_user_name,id:t.action_user_id,organizationId:s,type:"user"},l={displayName:a.display_name,id:a.token,organizationId:s,type:"user"},d={action:"DENY",actionTime:t.action_time||t.created_on,actor:c,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[l],memberIds:[l.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(d)}}}},{key:"__handleEscalationBang",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(o.token&&i.token){var u=this.host.models.Group.get(i.token);u=u||this.host.models.Group.injectPlaceholder({id:i.token,organizationId:s});var c=this.host.models.EscalationExecution.get(o.token);c=(c=c||u.escalationExecution)||(l===se.EscalationChangeAction.MEMBER_ADDED?null:this.host.models.EscalationExecution.inject({id:o.token,organizationId:s}));var l=se.EscalationChangeAction.resolve(t.event),d=t.action_user_name,f=t.action_time||t.created_on,p=null,h=null;l===se.EscalationChangeAction.INITIATED?p={displayName:a.display_name,id:a.token,organizationId:s,type:"user"}:l===se.EscalationChangeAction.MEMBER_ADDED?h=[{displayName:t.member_name,id:t.member_id,organizationId:s,type:"user"}]:l!==se.EscalationChangeAction.NO_RESPONSE&&(p={displayName:d,id:null,organizationId:s,type:"user"});var y={action:l,actionTime:f,actor:p,alwaysAddToTimeline:r,createdAt:t.created_on,escalationExecution:c,group:u,members:h,id:n,sortNumber:+t.sort_number};this.host.conversations.addEscalationExecutionChangeLog(y)}}},{key:"_setMembership",value:function(e){var t=this.host.currentUser.roles.reduce(function(e,t){var n=t.botUserId;return n&&(e[n]=!0),e},{});if(e.hasCurrentUserOrRole=!1,e.memberIds){if(!(s=e.memberIds)||"function"!=typeof s[B.default]&&!Array.isArray(s))throw new TypeError("Expected _entity$memberIds to be iterable, got "+D(s));if(!s||"function"!=typeof s[B.default]&&!Array.isArray(s))throw new TypeError("Expected _entity$memberIds to be iterable, got "+q(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,L.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;if(u===this.host.currentUserId||t[u])return void(e.hasCurrentUserOrRole=!0)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}}}}]),a((d=fe).prototype,"find",[o],(0,C.default)(d.prototype,"find"),d.prototype),a(d.prototype,"__find",[i],(0,C.default)(d.prototype,"__find"),d.prototype),a(d.prototype,"__ensureEntitiesLoaded",[s],(0,C.default)(d.prototype,"__ensureEntitiesLoaded"),d.prototype),a(d.prototype,"findAll",[u],(0,C.default)(d.prototype,"findAll"),d.prototype),a(d.prototype,"findAllWithSpecificMembers",[c],(0,C.default)(d.prototype,"findAllWithSpecificMembers"),d.prototype),a(d.prototype,"findAllMemberIds",[l],(0,C.default)(d.prototype,"findAllMemberIds"),d.prototype),d);function fe(){var e,t,w,n;(0,Z.default)(this,fe);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=w=(0,W.default)(this,(e=fe.__proto__||(0,K.default)(fe)).call.apply(e,[this].concat(a))),w._setP2PEntities=function(e){var t=e.createdByRole,n=e.createdByUser,r=e.groupType,a=e.targetUser,o=e.targetRole,i=w.host.currentUser;if(i&&r===se.GroupType.ROLE_P2P){var s=i.roles,u=[],c=[];t?c.push(t):n&&n!==i&&u.push(n),o?c.push(o):a&&a!==i&&u.push(a);var l=null,d=null;1===c.length?d=n===i||a===i?s.includes(c[0])?(l=i,c[0]):(l=c[0],i):(l=u[0],c[0]):2===c.length&&(s.includes(c[0])?(l=c[1],d=c[0]):s.includes(c[1])&&(l=c[0],d=c[1])),e.p2pRecipient=l,e.p2pSender=d}},w._onChangeConversation=function(e,t){var n=t.counterPartyId;if("group"===t.counterPartyType){var r=w.host.models.Group.get(n);r&&(r.conversation||w.host.models.Group.inject(r))}},w._onRemoveConversation=function(e,t){var n=t.counterPartyId;if("group"===t.counterPartyType){var r=w.host.models.Group.get(n);r&&r.conversation&&w.host.models.Group.inject(r)}},w._onChangeGroup=function(e,t){var n=t.id,r=t.memberIds,a=w._groupMemberIds[n];if(a){if(!a||"function"!=typeof a[B.default]&&!Array.isArray(a))throw new TypeError("Expected lastGroupMemberIds to be iterable, got "+D(a));if(!a||"function"!=typeof a[B.default]&&!Array.isArray(a))throw new TypeError("Expected lastGroupMemberIds to be iterable, got "+q(a));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,L.default)(a);!(o=(u=c.next()).done);o=!0){var l=u.value,d=w._userGroups[l],f=d?d.indexOf(t):-1;-1<f&&r&&!r.includes(l)&&d.splice(f,1)}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}if(r){if(!(w._groupMemberIds[n]=r)||"function"!=typeof r[B.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+D(r));if(!r||"function"!=typeof r[B.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+q(r));var p=!0,h=!1,y=void 0;try{for(var g,v=(0,L.default)(r);!(p=(g=v.next()).done);p=!0){var m=g.value,b=w._userGroups[m]||[];b.includes(t)||b.push(t),w._userGroups[m]=b}}catch(e){h=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw y}}}},w._onRemoveGroup=function(e,t){var n=t.id,r=t.memberIds;if(delete w._groupMemberIds[n],r){if(!r||"function"!=typeof r[B.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+D(r));if(!r||"function"!=typeof r[B.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+q(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,L.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value,l=w._userGroups[c],d=l?l.indexOf(t):-1;-1<d&&l.splice(d,1)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}},w._onChangeMetadata=function(e,t){var n=t.entityId,r=w.host.models.Group.get(n);r&&w.host.models.Group.inject(r)},w._onChangeUser=function(e,t){var n=t.botRole,r=t.id,a=t.isRoleBot,o=w._userGroups[r],i=w._userState[r],s=i&&(i.botRole!==n||i.isRoleBot!==a);if(i&&!s||(w._userState[r]={botRole:n,isRoleBot:a}),o){if(!o||"function"!=typeof o[B.default]&&!Array.isArray(o))throw new TypeError("Expected groups to be iterable, got "+D(o));if(!o||"function"!=typeof o[B.default]&&!Array.isArray(o))throw new TypeError("Expected groups to be iterable, got "+q(o));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,L.default)(o);!(u=(d=f.next()).done);u=!0){var p=d.value,h=p.conversation,y=p.groupType,g=p.members;y!==se.GroupType.ROLE_P2P&&!s&&g&&g.includes(t)||(w.host.models.Group.inject(p),h&&w.host.models.Conversation.inject(h))}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}}},w._onRemoveUser=function(e,t){var n=t.id,r=w._userGroups[n];if(r&&0<r.length){if(!r||"function"!=typeof r[B.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+D(r));if(!r||"function"!=typeof r[B.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+q(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,L.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value,l=c.members;l&&l.includes(t)&&w.host.models.Group.inject(c)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}delete w._userGroups[n],delete w._userState[n]},n=t,(0,W.default)(w,n)}t.default=de,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v=r(n(3)),m=r(n(4)),b=r(n(5)),w=r(n(11)),_=r(n(31)),x=r(n(10)),E=r(n(9)),k=r(n(6)),T=r(n(1)),I=r(n(2)),A=r(n(8)),O=r(n(7)),j=n(20),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),M=n(52),R=r(n(15)),z=["template_label"].join(","),C=(o=(0,j.decorator)(),i=(0,j.decorator)(),s=(0,j.decorator)(),c=R.default,(0,O.default)(P,c),(0,I.default)(P,[{key:"batchDelete",value:(g=(0,E.default)(x.default.mark(function e(t){var n,r=this,a=t.ids,o=t.organizationId;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(a)){e.next=2;break}throw new S.ValidationError("ids","required","ids must be an array");case 2:if(o){e.next=4;break}throw new S.ValidationError("organizationId","required");case 4:return e.next=6,this.host.api.messageTemplates.batch({ids:a,operation:"destroy",organizationId:o});case 6:return n=a.map(function(e){return r.host.models.MessageTemplate.inject({$deleted:!0,id:e})}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"create",value:(y=(0,E.default)(x.default.mark(function e(t){var n,r,a,o,i=t.attachment,s=t.body,u=t.network,c=void 0===u?"patient":u,l=t.organizationId,d=t.repository,f=void 0===d?"personal":d,p=t.title;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p?p.trim():"",r=s?s.trim():"",this._validate({body:r,organizationId:l,repository:f,shouldCheckId:!1,title:n}),!1===["patient"].includes(c))throw new S.ValidationError("network","invalid",'network must be "patient"');e.next=5;break;case 5:return e.next=7,this.host.api.messageTemplates.create({attachment:i,body:r,network:c,organizationId:l,repository:f,title:n});case 7:return a=e.sent,o=this.host.models.MessageTemplate.inject(a),e.abrupt("return",o);case 10:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"delete",value:(h=(0,E.default)(x.default.mark(function e(t,n){var r;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({id:t,organizationId:n,shouldCheckInvalid:!1}),e.next=3,this.host.api.messageTemplates.delete(t,n);case 3:return r=this.host.models.MessageTemplate.inject({$deleted:!0,id:t}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"downloadTemplateFile",value:(p=(0,E.default)(x.default.mark(function e(t){var n,r=t.templateId,a=t.fileName,o=t.organizationId;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.messageTemplates.downloadTemplateFile({templateId:r,fileName:a,organizationId:o});case 2:return n=e.sent,e.next=5,(0,M.downloadFile)({attachmentContentType:n.type,blob:n,fileName:a});case 5:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"find",value:(f=(0,E.default)(x.default.mark(function e(t,n){var r,a;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({id:t,organizationId:n,shouldCheckInvalid:!1}),e.next=3,this.host.api.messageTemplates.find(t,n);case 3:return r=e.sent,a=this.host.models.MessageTemplate.inject(r),e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.MessageTemplate.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,b.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,b.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));return this.host.models.MessageTemplate.get(e)}},{key:"search",value:(d=(0,E.default)(x.default.mark(function e(t){var n,r,a,o=t.continuation,i=t.network,s=void 0===i?"patient":i,u=t.organizationId,c=t.query,l=void 0===c?"":c,d=t.repository,f=void 0===d?"personal":d,p=t.sortBy,h=void 0===p?"title":p,y=t.sortOrder,g=void 0===y?"asc":y;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.search.query({continuation:o,network:s,organizationId:u,query:(n={},(0,_.default)(n,z,l),(0,_.default)(n,"repository",f),n),returnFields:[],sort:(0,_.default)({},h,g),types:["messageTemplate"]});case 2:return r=e.sent,a=this._processSearchResults(r.results),e.abrupt("return",{metadata:r.metadata,results:a});case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"update",value:(l=(0,E.default)(x.default.mark(function e(t){var n,r,a,o,i=t.attachment,s=t.body,u=t.id,c=t.organizationId,l=t.repository,d=t.title;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=d?d.trim():"",r=s?s.trim():"",this._validate({body:r,id:u,organizationId:c,repository:l,title:n}),e.next=5,this.host.api.messageTemplates.update({attachment:i,body:r,id:u,organizationId:c,repository:l,title:n});case 5:return a=e.sent,o=this.host.models.MessageTemplate.inject(a),e.abrupt("return",o);case 8:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"_processSearchResults",value:function(e){return e.map(function(e){return e.entity}).filter(function(e){return!e.$deleted})}},{key:"_validate",value:function(e){var t=e.body,n=e.id,r=(e.network,e.organizationId),a=e.repository,o=e.shouldCheckId,i=void 0===o||o,s=e.shouldCheckInvalid,u=void 0===s||s,c=e.title;if(i&&!n)throw new S.ValidationError("id","required");if(!r)throw new S.ValidationError("organizationId","required");if(u){if(!t||0===t.trim().length)throw new S.ValidationError("body","invalid","body must be at least 1 character");if(!a||!["general","personal"].includes(a))throw new S.ValidationError("repository","invalid",'repository must be either "general" or "personal"');if(!c||0===c.trim().length||60<c.trim().length)throw new S.ValidationError("title","invalid","title must be between 1 and 60 characters")}}}]),a((u=P).prototype,"downloadTemplateFile",[o],(0,w.default)(u.prototype,"downloadTemplateFile"),u.prototype),a(u.prototype,"find",[i],(0,w.default)(u.prototype,"find"),u.prototype),a(u.prototype,"search",[s],(0,w.default)(u.prototype,"search"),u.prototype),u);function P(){return(0,T.default)(this,P),(0,A.default)(this,(P.__proto__||(0,k.default)(P)).apply(this,arguments))}t.default=C,e.exports=t.default},function(e,t,f){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function Se(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_e.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=Se(t[0],n);return t.every(function(e){return Se(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return Se(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,ze.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,se.default)(e))+": "+Se(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function Me(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_e.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=Me(t[0],n);return t.every(function(e){return Me(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return Me(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,ze.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,se.default)(e))+": "+Me(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P,V,G,N,U,F,$,D,q,L,B,K,Z,H,W,X,Q,Y,J,ee,te,ne,re,ae,oe,ie,se=n(f(3)),ue=n(f(11)),Re=n(f(38)),ze=n(f(4)),ce=n(f(19)),le=n(f(22)),de=n(f(34)),fe=n(f(16)),pe=n(f(30)),Ce=n(f(12)),Pe=n(f(13)),Ve=n(f(10)),he=n(f(18)),ye=n(f(9)),ge=n(f(6)),ve=n(f(1)),me=n(f(2)),be=n(f(8)),we=n(f(7)),_e=n(f(5)),Ge=n(f(57)),xe=n(f(45)),Ee=n(f(92)),ke=n(f(259)),Te=n(f(25)),Ie=n(f(36)),Ae=n(f(39)),Oe=n(f(264)),je=n(f(257)),Ne=n(f(40)),Ue=n(f(35)),Fe=n(f(90)),$e=n(f(62)),De=f(20),qe=n(f(64)),Le=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(f(17)),Be=f(26),Ke=f(41),Ze=f(23),He=f(52),We=f(51),Xe=n(f(15)),Qe=["escalationExecutionId","id","serverId"],Ye=["distributionList","group","user"],Je=(a=(0,De.decorator)(),o=(0,De.decorator)(),i=(0,De.decorator)({serializeArguments:function(e){return e[0]}}),s=(0,De.decorator)({memoize:!0}),u=(0,De.decorator)(),c=(0,De.decorator)({memoize:!0}),l=(0,De.decorator)({serializeArguments:function(e){return"object"===(0,_e.default)(e[0])?e[0].id:e[0]}}),d=(0,De.decorator)({serializeArguments:function(e){return e[0].map(function(e){return"object"===(void 0===e?"undefined":(0,_e.default)(e))?e.id:e}).join(":")}}),h=Xe.default,(0,we.default)(et,h),(0,me.default)(et,[{key:"mounted",value:function(){this._throttled_flushFindRecipientStatusesQueue=this.config.flushFindRecipientStatusInterval?(0,Fe.default)(this.__flushFindRecipientStatusesQueue,this.config.flushFindRecipientStatusInterval,{leading:!1}):this.__flushFindRecipientStatusesQueue,this._throttled_flushSetMessageStatusesQueue=this.config.flushSetMessageStatusInterval?(0,Fe.default)(this.__flushSetMessageStatusesQueue,this.config.flushSetMessageStatusInterval,{leading:!1}):this.__flushSetMessageStatusesQueue,this._attachmentTokens=[],this._pendingFindRecipientStatuses={},this._queuedFindRecipientStatuses=[],this._queuedSetMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this._onTick),this.host.models.MessageStatusPerRecipient.on("afterInject",this._onChangeMessageStatus),this.host.models.MessageStatusPerRecipient.on("afterEject",this._onChangeMessageStatus)}},{key:"dispose",value:function(){this._attachmentTokens=null,this._pendingFindRecipientStatuses=null,this._queuedFindRecipientStatuses=null,this._queuedSetMessageStatuses=null,this._downloadAttachmentBlobAndUrl&&De.decorator.clear(this._downloadAttachmentBlobAndUrl),this.downloadAttachmentUrl&&De.decorator.clear(this.downloadAttachmentUrl),this.downloadAttachment&&De.decorator.clear(this.downloadAttachment),this._throttled_flushFindRecipientStatusesQueue.cancel&&this._throttled_flushFindRecipientStatusesQueue.cancel(),this._throttled_flushSetMessageStatusesQueue.cancel&&this._throttled_flushSetMessageStatusesQueue.cancel(),this.host.removeListener("tick",this._onTick),this.host.models.MessageStatusPerRecipient.removeListener("afterInject",this._onChangeMessageStatus),this.host.models.MessageStatusPerRecipient.removeListener("afterEject",this._onChangeMessageStatus)}},{key:"send",value:(ie=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==d||d instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(d));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==d||d instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(d));case 12:if(this.config.condensedReplays)throw new Error("the send() method has been deprecated in favor of sendToUser(), sendToGroup(), etc.");e.next=14;break;case 14:if(Array.isArray(t))return e.next=17,this.__resolveSender(d);e.next=18;break;case 17:return e.abrupt("return",this.sendToGroupOfUsers(t,n,d));case 18:return e.next=20,this.__resolveCounterPartyEntityAndOrganizationId(t,d.senderOrganizationId||d.organizationId);case 20:return r=e.sent,a=r.counterParty,o=r.organizationId,Ze.Validator.notEmpty("counterPartyId",a,"counterPartyId not found"),o?d=(0,fe.default)({},(0,Ne.default)(d,"organizationId","senderOrganizationId","recipientOrganizationId"),{organizationId:o}):o=d.organizationId,e.next=27,this.__resolveSender(d);case 27:if(i=e.sent,s=function(e){return e&&"user"===e.$entityType},(u=function(e){return s(e)&&e.isRoleBot})(a)||s(a)&&u(i))return e.abrupt("return",this.sendToRole(t,n,d));e.next=32;break;case 32:if(c=a.groupType,l=a.memberIds,c!==Be.GroupType.FORUM||l&&l.includes(this.host.currentUserId)){e.next=36;break}return e.next=36,this.host.forums.join(a);case 36:return e.abrupt("return",this.__sendToCounterParty(a,n,d));case 37:case"end":return e.stop()}},e,this)})),function(e,t){return ie.apply(this,arguments)})},{key:"__resolveSender",value:(oe=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.__resolveSenderId(t),r=t.senderOrganizationId||t.organizationId,n===this.host.currentUserId)return e.abrupt("return",this.host.currentUser);e.next=4;break;case 4:return r||Ze.Validator.raise("senderOrganizationId","missing","When senderId is provided, senderOrganizationId or organizationId must also be provided"),e.next=7,this.host.users.find(n,{organizationId:r});case 7:return(a=e.sent)||Ze.Validator.raise("senderId","invalid","The provided senderId was not found"),a.isRoleBot||Ze.Validator.raise("senderId","invalid","senderId must be either the current user or a role"),e.next=12,this.host.roles.find(n,r);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)})),function(e){return oe.apply(this,arguments)})},{key:"__resolveSenderId",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.senderId;return t=t?(t=this._resolveModelId(t),this.host.roles.__resolveRoleId(t)):this.host.currentUserId,e.senderId=t}},{key:"__resolveCounterPartyEntityAndOrganizationId",value:(ae=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if(null!=o&&"string"!=typeof o)throw new TypeError('Value of argument "providedOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Me(o));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if(null!=o&&"string"!=typeof o)throw new TypeError('Value of argument "providedOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(o));e.next=8;break;case 8:if("string"==typeof t&&(t=this.host.roles.__resolveRoleId(t)),n=this._resolveEntity(t,[].concat(Ye,["conversation"])),r=o,n){e.next=17;break}if(this.host.conversations.looksLikeConversationHandle(t))return e.next=15,this.host.conversations.find(t);e.next=17;break;case 15:(a=e.sent)&&(n=a.counterParty,r=a.organizationId);case 17:if(n){e.next=21;break}return e.next=20,this.__resolveRemoteCounterPartyEntity(t,r);case 20:n=e.sent;case 21:return n&&(n.organizationId&&"user"!==n.$entityType&&(r=n.organizationId),"conversation"===n.$entityType&&(n=n.counterParty)),e.abrupt("return",{counterParty:n,organizationId:r});case 23:case"end":return e.stop()}},e,this)})),function(e){return ae.apply(this,arguments)})},{key:"__resolveRemoteCounterPartyEntity",value:(re=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d=this;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=6;break;case 6:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(n));e.next=8;break;case 8:if(r=null,t=this.host.roles.__resolveRoleId(t),!(a=(0,je.default)([(0,ye.default)(Ve.default.mark(function e(){return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.users.findOrCreate(t,{organizationId:n}));case 1:case"end":return e.stop()}},e,d)})),(0,ye.default)(Ve.default.mark(function e(){return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.groups.find(t));case 1:case"end":return e.stop()}},e,d)})),(0,ye.default)(Ve.default.mark(function e(){return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.distributionLists.find(t));case 1:case"end":return e.stop()}},e,d)}))]))||"function"!=typeof a[Pe.default]&&!Array.isArray(a))throw new TypeError("Expected resolvers to be iterable, got "+Se(a));e.next=13;break;case 13:if(!a||"function"!=typeof a[Pe.default]&&!Array.isArray(a))throw new TypeError("Expected resolvers to be iterable, got "+Me(a));e.next=15;break;case 15:i=!(o=!0),s=void 0,e.prev=18,u=(0,Ce.default)(a);case 20:if(o=(c=u.next()).done){e.next=37;break}return l=c.value,e.prev=22,e.next=25,l();case 25:if(r=e.sent)return e.abrupt("break",37);e.next=28;break;case 28:e.next=34;break;case 30:if(e.prev=30,e.t0=e.catch(22),e.t0.code!==Le.NotFoundError.CODE)throw e.t0;e.next=34;break;case 34:o=!0,e.next=20;break;case 37:e.next=43;break;case 39:e.prev=39,e.t1=e.catch(18),i=!0,s=e.t1;case 43:e.prev=43,e.prev=44,!o&&u.return&&u.return();case 46:if(e.prev=46,i)throw s;e.next=49;break;case 49:return e.finish(46);case 50:return e.finish(43);case 51:return e.abrupt("return",r);case 52:case"end":return e.stop()}},e,this,[[18,39,43,51],[22,30],[44,,46,50]])})),function(e,t){return re.apply(this,arguments)})},{key:"__sendToCounterParty",value:(ne=(0,ye.default)(Ve.default.mark(function e(t,n,r){var a,o,i,s,u,c,l,d,f,p,h,y=r.organizationId,g=r.senderOrganizationId,v=void 0===g?y:g,m=r.recipientOrganizationId,b=void 0===m?v:m,w=(0,de.default)(r,["organizationId","senderOrganizationId","recipientOrganizationId"]);return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=8;break;case 8:return a=t.$entityType,o=t.serverId,this.host.requireUser(),Ze.Validator.oneOf("counterPartyType",a,["user","group","distributionList"]),Ze.Validator.notEmpty("counterPartyId",o),v=this.__ensureOrganization(v),b=b||v,w=this.__normalizeSendOptions(w,{counterParty:t,senderOrganizationId:v}),i=this.__createNewMessage(t,n,(0,fe.default)({organizationId:y,senderOrganizationId:v,recipientOrganizationId:b},w)),this.host.events.deferEventQueue(),this.host.models.Message.inject(i),this.host.emit("message:sending",i),u=(s=w).attachmentFiles,c=s.deleteOnRead,l=s.escalate,d=s.metadata,f=s.priority,p=s.ttl,e.prev=20,e.next=23,this.host.api.messages.send({attachment:(0,Oe.default)(u),body:n,counterPartyId:o,deleteOnRead:c,escalate:l,localId:i?i.id:qe.default.v4(),metadata:d,priority:Be.MessagePriority.toServer(f),recipientOrganizationId:b,senderOrganizationId:v,ttl:p});case 23:return h=e.sent,e.next=26,this.__retrieveSentMessage(h,{instance:i});case 26:i=e.sent,this.host.emit("message:sent",i),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(20),this.logger.error("error while sending message",e.t0),i.senderStatus=Be.MessageSenderStatus.FAILED,this.host.models.Message.inject(i);case 35:return this.host.events.resumeEventQueue(),e.abrupt("return",i);case 37:case"end":return e.stop()}},e,this,[[20,30]])})),function(e,t,n){return ne.apply(this,arguments)})},{key:"__createNewMessage",value:function(e,t,n){var r=n.conversationId,a=n.isForwarded,o=void 0!==a&&a,i=n.organizationId,s=n.recipientOrganizationId,u=void 0===s?l:s,c=n.senderOrganizationId,l=void 0===c?i:c,d=(0,de.default)(n,["conversationId","isForwarded","organizationId","recipientOrganizationId","senderOrganizationId"]);if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Me(e));if("string"!=typeof t)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Se(e));if("string"!=typeof t)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));var f=d.attachmentFiles,p=d.deleteOnRead,h=d.escalate,y=d.metadata,g=d.originalMetadata,v=d.priority,m=d.senderId,b=d.ttl,w=e.$entityType,_=e.serverId;this.host.requireUser(),Ze.Validator.oneOf("counterPartyType",w,["user","group","distributionList"]),Ze.Validator.notEmpty("counterPartyId",_);var x=void 0;r&&(x=this.host.conversations.getById(r));var E=(x=x||this.host.conversations.ensureConversation(w,_,l)).isLive,k=this.__getNextSortNumber(l,{conversation:x}),T=m&&m!==this.host.currentUserId?m:void 0,I=t;"distributionList"===w&&(t="["+e.displayName+"]: "+t);var A=this.host.models.Message.createInstance({$synced:!1,body:t,conversationId:x.id,counterPartyId:_,counterPartyType:w,createdAt:new Date,currentSenderRoleId:T,deleteOnRead:p,id:qe.default.v4(),inTimeline:E,isForwarded:o,isOutgoing:!0,messageType:Be.MessageType.USER_SENT,metadata:y,originalMetadata:g,priority:v,recipientOrganizationId:u,senderId:this.host.currentUserId,senderOrganizationId:l,senderStatus:Be.MessageSenderStatus.SENDING,shouldEscalate:h,sortNumber:k,ttl:b});return A._originalBody=I,f&&(A.attachments=f.map(this.__generateAttachmentDescriptor)),"group"===w?A.groupId=_:"user"===w?A.recipientId=_:"distributionList"===w&&(A.distributionListId=_),this.config.condensedReplays||(A.markedRecipientStatus=Be.MessageRecipientStatus.READ),A}},{key:"__normalizeSendOptions",value:function(e,t){var n=e.attachmentFile,r=e.attachmentFiles,a=e.deleteOnRead,o=e.escalate,i=e.metadata,s=e.originalMetadata,u=e.priority,c=e.senderId,l=e.ttl,d=t.counterParty,f=t.senderOrganizationId;if(null==e||!(void 0===e.attachmentFiles||null==e.attachmentFiles||Array.isArray(e.attachmentFiles)&&e.attachmentFiles.every(function(e){return"string"==typeof e||e instanceof Object}))||void 0!==e.deleteOnRead&&null!=e.deleteOnRead&&"boolean"!=typeof e.deleteOnRead||void 0!==e.escalate&&null!=e.escalate&&"boolean"!=typeof e.escalate||!(void 0===e.metadata||null==e.metadata||Array.isArray(e.metadata)&&e.metadata.every(function(e){return e instanceof Object})||null==e.metadata||e.metadata instanceof Object)||!(void 0===e.originalMetadata||null==e.originalMetadata||Array.isArray(e.originalMetadata)&&e.originalMetadata.every(function(e){return e instanceof Object})||null==e.originalMetadata||e.originalMetadata instanceof Object)||void 0!==e.priority&&null!=e.priority&&"string"!=typeof e.priority||void 0!==e.senderId&&null!=e.senderId&&"string"!=typeof e.senderId||void 0!==e.ttl&&null!=e.ttl&&"number"!=typeof e.ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachmentFiles?: ?Array<string | Object>;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  metadata?: ?Array<Object> | ?Object;\n  originalMetadata?: ?Array<Object> | ?Object;\n  priority?: ?string;\n  senderId?: ?string;\n  ttl?: ?number;\n}\n\nGot:\n"+Me(e));if(null==e||!(void 0===e.attachmentFiles||null==e.attachmentFiles||Array.isArray(e.attachmentFiles)&&e.attachmentFiles.every(function(e){return"string"==typeof e||e instanceof Object}))||void 0!==e.deleteOnRead&&null!=e.deleteOnRead&&"boolean"!=typeof e.deleteOnRead||void 0!==e.escalate&&null!=e.escalate&&"boolean"!=typeof e.escalate||!(void 0===e.metadata||null==e.metadata||Array.isArray(e.metadata)&&e.metadata.every(function(e){return e instanceof Object})||null==e.metadata||e.metadata instanceof Object)||!(void 0===e.originalMetadata||null==e.originalMetadata||Array.isArray(e.originalMetadata)&&e.originalMetadata.every(function(e){return e instanceof Object})||null==e.originalMetadata||e.originalMetadata instanceof Object)||void 0!==e.priority&&null!=e.priority&&"string"!=typeof e.priority||void 0!==e.senderId&&null!=e.senderId&&"string"!=typeof e.senderId||void 0!==e.ttl&&null!=e.ttl&&"number"!=typeof e.ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachmentFiles?: ?Array<string | Object>;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  metadata?: ?Array<Object> | ?Object;\n  originalMetadata?: ?Array<Object> | ?Object;\n  priority?: ?string;\n  senderId?: ?string;\n  ttl?: ?number;\n}\n\nGot:\n"+Se(e));i=this.__normalizeMetadata({metadata:i,organizationId:f,senderId:c}),r=(0,Ze.arrayWrap)(r||n),!(0,Ae.default)(r)&&1<r.length&&Ze.Validator.raise("attachmentFiles","invalid","currently only a single attachment is supported");var p=this.host.models.Organization.get(f);void 0===l&&(l=p?p.messageTimeToLive:-1),!a&&p&&(a=p.deleteOnRead);var h=d.groupType,y=d.p2pRecipient;return h===Be.GroupType.ROLE_P2P&&y&&y.escalationPolicy&&y.escalationPolicy.alwaysEscalate&&(o=!0,u=Be.MessagePriority.NORMAL),{attachmentFiles:r,deleteOnRead:a,escalate:o,metadata:i,originalMetadata:s,priority:u,senderId:c,ttl:l}}},{key:"__ensureOrganization",value:function(e){if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Me(e));if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(e));return e||(this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void Ze.Validator.raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)"))}},{key:"__normalizeMetadata",value:function(e){var t=e.metadata,n=(e.organizationId,e.senderId);if(t=t||[],t=(0,Ze.arrayWrap)(t),n!==this.host.currentUserId){var r=this.host.roles.getById(n),a=r.roleTag;t.push({namespace:"tigertext:message:role:sender",payload:{token:n,display_name:r.displayName,tag_id:a?a.tagId:"",tag_color:a?a.color.replace("#","0x"):"",tag_name:a?a.name:""}})}return 0<t.length?t.map(function(e){return(0,fe.default)({mimetype:"application/json"},e)}):void 0}},{key:"__getNextSortNumber",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).conversation,n=this.host.models.Organization.get(e);n&&!t&&(t=n.conversations[0]);var r=n&&n.highestSortNumber||0,a=t&&t.lastBangMessageSortNumber||0;return Math.max(r,a)+1}},{key:"previewMessage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if(!(null==t||t instanceof Object))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if(!(null==t||t instanceof Object))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(t));var n=this._resolveMessage(e),r={};if(!(c=(0,le.default)(n))||"function"!=typeof c[Pe.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+Se(c));if(!c||"function"!=typeof c[Pe.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+Me(c));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Ce.default)(c);!(a=(s=u.next()).done);a=!0){var c,l=(0,ce.default)(s.value,2),d=l[0],f=l[1];(0,Ze.isConfigurableProperty)(n,d)&&!Qe.includes(d)&&(r[d]=f)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}r=(0,fe.default)({},r,{id:qe.default.v4(),conversationId:null},t),this.__setForwardedMessageProperties({origMessage:n,organizationId:n.__organizationId,message:r});var p=this.host.models.Message.inject(r);if(!(b=n.statusesPerRecipient)||"function"!=typeof b[Pe.default]&&!Array.isArray(b))throw new TypeError("Expected _message$statusesPerR to be iterable, got "+Se(b));if(!b||"function"!=typeof b[Pe.default]&&!Array.isArray(b))throw new TypeError("Expected _message$statusesPerR to be iterable, got "+Me(b));var h=!0,y=!1,g=void 0;try{for(var v,m=(0,Ce.default)(b);!(h=(v=m.next()).done);h=!0){var b,w=v.value,_=w.userId||w.distributionListId,x=p.id+":"+_;this.host.models.MessageStatusPerRecipient.inject((0,fe.default)({},w,{id:x,messageId:p.id}))}}catch(e){y=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(y)throw g}}return p}},{key:"endPreviewMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));var t=this._resolveMessage(e);if(t){if(!(s=t.statusesPerRecipient)||"function"!=typeof s[Pe.default]&&!Array.isArray(s))throw new TypeError("Expected _message$statusesPerR2 to be iterable, got "+Se(s));if(!s||"function"!=typeof s[Pe.default]&&!Array.isArray(s))throw new TypeError("Expected _message$statusesPerR2 to be iterable, got "+Me(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,Ce.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;this.host.models.MessageStatusPerRecipient.eject(u)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}this.host.models.Message.eject(t)}}},{key:"sendToUser",value:(te=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==y||y instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(y));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==y||y instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(y));case 12:if(this.host.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,y));case 14:if(r=y.organizationId,a=y.senderId,o=void 0===a?this.host.currentUserId:a,i=y.groupName,s=y.groupMetadata,r){e.next=17;break}throw new Error("organizationId is required");case 17:if(t=this._resolveModelIdWithTypes(t,"user"),(u=this._resolveEntity(t,"user"))&&u.profileByOrganizationId&&u.profileByOrganizationId[r]){e.next=23;break}return e.next=22,this.host.users.findOrCreate(t,{organizationId:r});case 22:u=e.sent;case 23:return e.next=25,this.__resolveRoleBotId(o,r);case 25:if(c=e.sent,l=c.isRole,d=c.roleBotId,l)return e.next=31,this.__prepareRoleP2PGroup(r,t,d,i,{groupMetadata:s});e.next=33;break;case 31:return f=e.sent,e.abrupt("return",this.sendToGroup(f,n,(0,fe.default)({},y,{organizationId:r,senderId:o})));case 33:if(p=u&&u.profileByOrganizationId[r],h=p&&p.conversationId){e.next=37;break}throw new Error("conversationId not found for p2p message");case 37:return this.host.conversations.getById(h)||this.host.models.Conversation.inject({counterPartyId:u.id,counterPartyType:u.$entityType,id:h,organizationId:r}),e.abrupt("return",this.sendToConversation(h,n,y));case 40:case"end":return e.stop()}},e,this)})),function(e,t){return te.apply(this,arguments)})},{key:"sendToGroup",value:(ee=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==a||a instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(a));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==a||a instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(a));case 12:if(this.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,a));case 14:if(t=this._resolveModelId(t),r=this._resolveEntity(t,"group")){e.next=20;break}return e.next=19,this.host.groups.find(t);case 19:r=e.sent;case 20:if(r&&r.conversationId){e.next=22;break}throw new Error("group conversationId not found");case 22:return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),e.abrupt("return",this.sendToConversation(r.conversationId,n,a));case 25:case"end":return e.stop()}},e,this)})),function(e,t){return ee.apply(this,arguments)})},{key:"sendToRole",value:(J=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==f||f instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(f));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==f||f instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(f));case 12:if(r=f.organizationId,a=f.senderId,o=void 0===a?this.host.currentUserId:a,i=f.groupMetadata,s=f.groupName,!this.host.config.condensedReplays){e.next=24;break}if(r){e.next=16;break}throw new Error("organizationId is required");case 16:return e.next=18,this.__resolveRoleBotId(t,r);case 18:if(u=e.sent,c=u.isRole,l=u.roleBotId,c){e.next=23;break}throw new Error("recipient must be a role");case 23:t=l;case 24:return e.next=26,this.__prepareRoleP2PGroup(r,t,o,s,{groupMetadata:i});case 26:return d=e.sent,e.abrupt("return",this.sendToGroup(d,n,(0,fe.default)({},f,{organizationId:r,senderId:o})));case 28:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"sendToPatient",value:(Y=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==f||f instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(f));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==f||f instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(f));case 12:if((r=f).groupMetadata,a=r.organizationId,o=r.senderId,i=void 0===o?this.host.currentUserId:o,s=(0,de.default)(r,["groupMetadata","organizationId","senderId"]),f=(0,fe.default)({},s,{organizationId:a,senderId:i}),!this.host.config.condensedReplays){e.next=17;break}if(a){e.next=17;break}throw new Error("organizationId is required");case 17:if(c=void 0,u=t&&1===t.length?t[0]:t,l=this._resolveEntity(u,"user")){e.next=22;break}throw new Error("user could not be resolved");case 22:return c=l.isPatientContact?this.host.patients._createPatientContactGroupMetadata(l):this.host.patients._createPatientGroupMetadata(l),e.next=25,this.host.groups.createPatientGroup({organizationId:a,recipientId:t,senderId:i,metadata:c});case 25:return d=e.sent,this.host.metadata.__injectMetadata(d.id,a,c),e.abrupt("return",this.sendToGroup(d,n,(0,fe.default)({},f,{organizationId:a,senderId:i})));case 28:case"end":return e.stop()}},e,this)})),function(e,t){return Y.apply(this,arguments)})},{key:"__resolveRoleBotId",value:(Q=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.host.roles.__resolveRoleId(t),r=void 0;try{a=this._resolveModelIdWithTypes(t,"role"),r=!!this._resolveEntity(a,"role")}catch(e){r=!1}if(r){e.next=10;break}if((o=this._resolveEntity(t,"user"))&&o.profileByOrganizationId&&o.profileByOrganizationId[n]){e.next=9;break}return e.next=8,this.host.users.find(t,{organizationId:n});case 8:o=e.sent;case 9:o&&o.isRoleBot&&(r=!0);case 10:return e.abrupt("return",{isRole:r,roleBotId:t});case 11:case"end":return e.stop()}},e,this)})),function(e,t){return Q.apply(this,arguments)})},{key:"sendToConversation",value:(X=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==E||E instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(E));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==E||E instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(E));case 12:if(this.host.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,E));case 14:if(t=this._resolveModelIdWithTypes(t,"conversation"),r=this.host.conversations.getById(t)){e.next=18;break}throw new Le.NotFoundError(this.host.models.Conversation.name,t);case 18:return e.next=20,this.__resolveSender(E);case 20:if(a=e.sent,o=r.counterPartyId,i=r.counterPartyType,s=r.organizationId,u=this._resolveEntity(o,i),this.host.requireUser(),c=u.groupType,l=u.memberIds,c!==Be.GroupType.FORUM||l&&l.includes(this.host.currentUserId)){e.next=28;break}return e.next=28,this.host.forums.join(u);case 28:return f=d=s,E=this.__normalizeSendOptions(E,{counterParty:u,senderOrganizationId:d,senderId:a.id}),p=this.__createNewMessage(u,n,(0,fe.default)({conversationId:t,organizationId:s,senderOrganizationId:d,recipientOrganizationId:f},E)),this.host.events.deferEventQueue(),this.host.models.Message.inject(p),this.host.emit("message:sending",p),y=(h=E).attachmentFiles,g=h.deleteOnRead,v=h.escalate,m=h.metadata,b=h.priority,w=h.ttl,e.prev=36,e.next=39,this.host.api.messages.send({attachment:(0,Oe.default)(y),body:n,conversationId:r.id,deleteOnRead:g,escalate:v,localId:p?p.id:qe.default.v4(),metadata:m,priority:Be.MessagePriority.toServer(b),senderOrganizationId:d,ttl:w});case 39:return _=e.sent,x=_.last_message?_.last_message:_,e.next=44,this.__retrieveSentMessage(x,{instance:p});case 44:(p=e.sent).unreadMessageCount&&(r.unreadCount=p.unreadMessageCount),p.unreadPriorityMessageCount&&(r.unreadPriorityCount=p.unreadPriorityMessageCount),r.lastMessage=p,r.highestSortNumber=p.sortNumber?p.sortNumber:this.__getNextSortNumber(d,{conversation:r}),r.isLive=!0,r.timeline.push(p),this.host.models.Conversation.inject(r),p.inTimeline=!0,this.host.models.Message.inject(p),this.host.emit("message:sent",p),e.next=62;break;case 57:e.prev=57,e.t0=e.catch(36),this.logger.error("error while sending message",e.t0),p.senderStatus=Be.MessageSenderStatus.FAILED,this.host.models.Message.inject(p);case 62:return this.host.events.resumeEventQueue(),e.abrupt("return",p);case 64:case"end":return e.stop()}},e,this,[[36,57]])})),function(e,t){return X.apply(this,arguments)})},{key:"sendToDistributionList",value:(W=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(null==o||o instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Me(o));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==o||o instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(o));case 12:if(this.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,o));case 14:if(t=this._resolveModelIdWithTypes(t,"distributionList"),r=this._resolveEntity(t,"distributionList")){e.next=20;break}return e.next=19,this.host.distributionLists.find(t);case 19:r=e.sent;case 20:if(r&&r.conversationId){e.next=22;break}throw new Error("distributionList conversationId not found");case 22:return a=(a=this.host.conversations.getById(r.conversationId))||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),e.abrupt("return",this.sendToConversation(a.id,n,o));case 25:case"end":return e.stop()}},e,this)})),function(e,t){return W.apply(this,arguments)})},{key:"sendToGroupOfUsers",value:(H=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=o.groupMetadata,s=o.groupName,u=o.isTeamActivation,c=o.organizationId,l=o.senderId,d=(0,de.default)(o,["groupMetadata","groupName","isTeamActivation","organizationId","senderId"]);return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=8;break;case 8:return e.next=10,this.__prepareGroupForUsers(c,t,l,s,u,{groupMetadata:i});case 10:if(r=e.sent,this.config.condensedReplays)return a=r.conversationId,e.next=15,this.host.conversations.find(a);e.next=18;break;case 15:return e.abrupt("return",this.sendToConversation(a,n,(0,fe.default)({},d,{organizationId:c,senderId:l})));case 18:return e.abrupt("return",this.sendToGroup(r,n,(0,fe.default)({},d,{organizationId:c,senderId:l})));case 19:case"end":return e.stop()}},e,this)})),function(e,t){return H.apply(this,arguments)})},{key:"__prepareGroupForUsers",value:function(e,t,n,r,a){var o=(5<arguments.length&&void 0!==arguments[5]?arguments[5]:{}).groupMetadata;return 0===t.length&&Ze.Validator.raise("memberIds","required"),this.host.groups.create({isTeamActivation:a,memberIds:t,metadata:o,name:r,organizationId:e,senderId:n})}},{key:"__prepareRoleP2PGroup",value:(Z=(0,ye.default)(Ve.default.mark(function e(t,n,r,a){var o,i,s=(4<arguments.length&&void 0!==arguments[4]?arguments[4]:{}).groupMetadata;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.host.conversations.findLocalRoleP2PConversation(n,r))return e.abrupt("return",o.counterParty);e.next=3;break;case 3:return e.next=5,this.host.roles.createP2PGroup({metadata:s,name:a,organizationId:t,recipientId:n,senderId:r});case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return Z.apply(this,arguments)})},{key:"recall",value:(K=(0,ye.default)(Ve.default.mark(function e(t){var n,r;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Se(t));case 4:return this.host.requireUser(),n=(0,Ze.arrayWrap)(t).filter(Boolean),r=n.map(this.__recallSingle.bind(this)),e.next=9,he.default.all(r);case 9:case"end":return e.stop()}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"__recallSingle",value:(B=(0,ye.default)(Ve.default.mark(function e(t){var n;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(!(n=this._resolveMessage(t))){e.next=17;break}if(n.senderId!==this.host.currentUserId)throw new Le.PermissionDeniedError(n,n.serverId,"recall");e.next=8;break;case 8:if(!1!==n.$synced&&n.serverId){e.next=12;break}this.host.models.Message.eject(n),e.next=15;break;case 12:return e.next=14,this.host.api.messages.destroy(n.serverId);case 14:this.host.models.Message.eject(n);case 15:e.next=19;break;case 17:return e.next=19,this.host.api.messages.destroy(t);case 19:case"end":return e.stop()}},e,this)})),function(e){return B.apply(this,arguments)})},{key:"retrySend",value:(L=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}throw new Le.NotFoundError(this.host.models.Message.name,t);case 8:if(a=(r=n).isForwarded,r.senderStatus!==Be.MessageSenderStatus.FAILED&&Ze.Validator.raise("message","invalid","Message to retry must be in a FAILED senderStatus and sent from current user"),this.host.events.deferEventQueue(),n.senderStatus=Be.MessageSenderStatus.RETRYING,this.host.models.Message.inject(n),this.host.emit("message:sending",n),a)return e.next=17,this.__retryApiForward(n);e.next=20;break;case 17:n=e.sent,e.next=23;break;case 20:return e.next=22,this.__retryApiSend(n);case 22:n=e.sent;case 23:return this.config.condensedReplays&&(o=this.host.conversations.getById(n.conversationId),n.unreadMessageCount&&(o.unreadCount=n.unreadMessageCount),n.unreadPriorityMessageCount&&(o.unreadPriorityCount=n.unreadPriorityMessageCount),o.lastMessage=n,o.highestSortNumber=n.sortNumber,this.host.models.Conversation.inject(o)),this.host.events.resumeEventQueue(),e.abrupt("return",n);case 26:case"end":return e.stop()}},e,this)})),function(e){return L.apply(this,arguments)})},{key:"resend",value:(q=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},E=x.priority,k=x.retrieveMessage,T=void 0!==k&&k,I=x.senderId;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(n=this._resolveMessage(t),void 0===E&&(E=n.priority),void 0===I&&(I=n.senderId),r=n.attachments,a=n.body,o=n.conversationId,i=n.counterParty,s=n.counterPartyId,u=n.deleteOnRead,c=n.isForwarded,l=n.metadata,d=n.originalMessageId,f=n.recipientOrganizationId,p=n.ttl,!c){e.next=14;break}if(this.config.condensedReplays)return e.abrupt("return",this.forwardToConversation(d,o,{organizationId:f,priority:E}));e.next=11;break;case 11:return e.abrupt("return",this.forward(d,s,{organizationId:f,priority:E,retrieveMessage:T,senderId:I}));case 14:if(h=[],l=l.filter(function(e){return"tigertext:message:role:sender"!==e.namespace}),!r){e.next=50;break}if(!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected attachments to be iterable, got "+Se(r));e.next=19;break;case 19:if(!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected attachments to be iterable, got "+Me(r));e.next=21;break;case 21:g=!(y=!0),v=void 0,e.prev=24,m=(0,Ce.default)(r);case 26:if(y=(b=m.next()).done){e.next=36;break}return w=b.value,e.next=30,this._downloadAttachmentBlobAndUrl(t,w.id);case 30:(_=e.sent.blob).name=w.name,h.push(_);case 33:y=!0,e.next=26;break;case 36:e.next=42;break;case 38:e.prev=38,e.t0=e.catch(24),g=!0,v=e.t0;case 42:e.prev=42,e.prev=43,!y&&m.return&&m.return();case 45:if(e.prev=45,g)throw v;e.next=48;break;case 48:return e.finish(45);case 49:return e.finish(42);case 50:if(this.config.condensedReplays)return e.abrupt("return",this.sendToConversation(o,a,{attachmentFiles:h,deleteOnRead:u,organizationId:f,priority:E,metadata:l,senderId:I,ttl:p}));e.next=52;break;case 52:return e.abrupt("return",this.__sendToCounterParty(i,a,{attachmentFiles:h,deleteOnRead:u,organizationId:f,priority:E,senderId:I,metadata:l,ttl:p}));case 53:case"end":return e.stop()}},e,this,[[24,38,42,50],[43,,45,49]])})),function(e){return q.apply(this,arguments)})},{key:"forwardToConversation",value:(D=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward(t,n,E));case 6:if(r=E.metadata,a=void 0===r?[]:r,o=E.priority,i=E.senderId,s=void 0===i?this.host.currentUserId:i,u=this.host.conversations.getById(n)){e.next=10;break}throw new Error("conversation not found");case 10:if(this.host.requireUser(),c=this._resolveMessage(t)){e.next=14;break}throw new Le.NotFoundError(this.host.models.Message.name,id);case 14:if(l=c.attachments,d=c.body,f=c.serverId){e.next=17;break}throw new Error("original message was not sent");case 17:return s=this.__resolveSenderId({senderId:s}),void 0===o&&(o=c.priority),p=u.counterPartyId,h=u.counterPartyType,y=u.organizationId,g=this._resolveEntity(p,h),v=y,m=(0,Ie.default)(c,"originalMetadata"),b={metadata:a,priority:o,senderId:s,originalMetadata:m},b=this.__normalizeSendOptions(b,{counterParty:g,senderOrganizationId:v}),a=b.metadata,(w=this.__createNewMessage(g,d,(0,fe.default)({conversationId:n,organizationId:y,isForwarded:!0},b))).attachments=l,this.__setForwardedMessageProperties({origMessage:c,organizationId:y,message:w}),this.host.events.deferEventQueue(),this.host.models.Message.inject(w),this.host.emit("message:sending",w),e.prev=32,e.next=35,this.host.api.messages.forward(f,null,{conversationId:n,localId:w.id,metadata:a,priority:Be.MessagePriority.toServer(o)});case 35:return _=e.sent,e.next=38,this.__retrieveSentMessage(_.message,{instance:w});case 38:(x=e.sent).unreadMessageCount&&(u.unreadCount=x.unreadMessageCount),x.unreadPriorityMessageCount&&(u.unreadPriorityCount=x.unreadPriorityMessageCount),this.host.models.Conversation.inject(u),this.host.emit("message:sent",x),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(32),this.logger.error("error while forwarding message",e.t0),w.senderStatus=Be.MessageSenderStatus.FAILED,this.host.models.Message.inject(w);case 50:return this.host.events.resumeEventQueue(),e.abrupt("return",w);case 52:case"end":return e.stop()}},e,this,[[32,45]])})),function(e,t){return D.apply(this,arguments)})},{key:"forwardToUser",value:($=(0,ye.default)(Ve.default.mark(function e(t,n){for(var r=arguments.length,a=Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var i,s,u,c,l,d,f,p,h,y,g,v,m,b;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward.apply(this,[t,n].concat(a)));case 6:if(i=a[0],u=(s=void 0===i?{}:i).organizationId,c=s.senderId,l=void 0===c?this.host.currentUserId:c,d=s.groupName,f=s.groupMetadata,u){e.next=10;break}throw new Error("organizationId is required");case 10:if(n=this._resolveModelIdWithTypes(n,"user"),(p=this._resolveEntity(n,"user"))&&p.profileByOrganizationId&&p.profileByOrganizationId[u]){e.next=16;break}return e.next=15,this.host.users.find(n,{organizationId:u});case 15:p=e.sent;case 16:return e.next=18,this.__resolveRoleBotId(l,u);case 18:if(h=e.sent,y=h.isRole,g=h.roleBotId,y)return e.next=24,this.__prepareRoleP2PGroup(u,n,g,d,{groupMetadata:f});e.next=26;break;case 24:return v=e.sent,e.abrupt("return",this.forwardToGroup(t,v,(0,fe.default)({},s,{organizationId:u,senderId:l})));case 26:if(m=p&&p.profileByOrganizationId[u],b=m&&m.conversationId){e.next=30;break}throw new Error("conversationId not found for p2p message");case 30:return this.host.conversations.getById(b)||this.host.models.Conversation.inject({counterPartyId:p.id,counterPartyType:p.$entityType,id:b,organizationId:u}),e.abrupt("return",this.forwardToConversation.apply(this,[t,b].concat(a)));case 33:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"forwardToGroup",value:(F=(0,ye.default)(Ve.default.mark(function e(t,n){for(var r=arguments.length,a=Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var i;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward.apply(this,[t,n].concat(a)));case 6:if(n=this._resolveModelId(n),i=this._resolveEntity(n,"group")){e.next=12;break}return e.next=11,this.host.groups.find(n);case 11:i=e.sent;case 12:if(i&&i.conversationId){e.next=14;break}throw new Error("group "+n+" not found");case 14:return this.host.conversations.getById(i.conversationId)||this.host.models.Conversation.inject({counterPartyId:i.id,counterPartyType:i.$entityType,id:i.conversationId,organizationId:i.organizationId}),e.abrupt("return",this.forwardToConversation.apply(this,[t,i.conversationId].concat(a)));case 17:case"end":return e.stop()}},e,this)})),function(e,t){return F.apply(this,arguments)})},{key:"forwardToDistributionList",value:(U=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(n));case 8:if(this.config.condensedReplays){e.next=10;break}return e.abrupt("return",this.forward(t,n,a));case 10:if(n=this._resolveModelId(n),r=this._resolveEntity(n,"distributionList")){e.next=16;break}return e.next=15,this.host.distributionLists.find(n);case 15:r=e.sent;case 16:if(r&&r.conversationId){e.next=18;break}throw new Error("distributionList "+n+" not found");case 18:return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),e.abrupt("return",this.forwardToConversation(t,r.conversationId,a));case 21:case"end":return e.stop()}},e,this)})),function(e,t){return U.apply(this,arguments)})},{key:"forwardToGroupOfUsers",value:(N=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=o.groupMetadata,s=o.groupName,u=o.organizationId,c=o.senderId,l=(0,de.default)(o,["groupMetadata","groupName","organizationId","senderId"]);return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Me(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Se(n));case 8:return e.next=10,this.__prepareGroupForUsers(u,n,c,s,!1,{groupMetadata:i});case 10:if(r=e.sent,this.config.condensedReplays)return a=r.conversationId,e.next=15,this.host.conversations.find(a);e.next=16;break;case 15:return e.abrupt("return",this.forwardToConversation(t,a,(0,fe.default)({},l,{organizationId:u,senderId:c})));case 16:return e.abrupt("return",this.forwardToGroup(t,r,(0,fe.default)({},l,{organizationId:u,senderId:c})));case 17:case"end":return e.stop()}},e,this)})),function(e,t){return N.apply(this,arguments)})},{key:"forwardToRole",value:(G=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.organizationId,a=f.senderId,o=void 0===a?this.host.currentUserId:a,i=f.groupMetadata,s=f.groupName,!this.host.config.condensedReplays){e.next=12;break}if(r){e.next=4;break}throw new Error("organizationId is required");case 4:return e.next=6,this.__resolveRoleBotId(n,r);case 6:if(u=e.sent,c=u.isRole,l=u.roleBotId,c){e.next=11;break}throw new Error("recipient must be a role");case 11:n=l;case 12:return e.next=14,this.__prepareRoleP2PGroup(r,n,o,s,{groupMetadata:i});case 14:return d=e.sent,e.abrupt("return",this.forwardToGroup(t,d.id,(0,fe.default)({},f,{organizationId:r,senderId:o})));case 16:case"end":return e.stop()}},e,this)})),function(e,t){return G.apply(this,arguments)})},{key:"forward",value:(V=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_=this,x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},E=x.organizationId,k=x.senderOrganizationId,T=void 0===k?E:k,I=x.recipientOrganizationId,A=void 0===I?T:I,O=x.groupMetadata,j=x.groupName,S=x.metadata,M=void 0===S?[]:S,R=(x.preferExistingGroup,x.priority),z=x.retrieveMessage,C=void 0!==z&&z,P=x.senderId,V=void 0===P?this.host.currentUserId:P;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Me(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Se(n));case 8:if(this.config.condensedReplays)throw new Error("the forward() method has been deprecated in favor of forwardToUser(), forwardToGroup(), etc.");e.next=10;break;case 10:if(this.host.requireUser(),r=this._resolveMessage(t)){e.next=14;break}throw new Le.NotFoundError(this.host.models.Message.name,t);case 14:if(a=r.attachments,o=r.body,i=r.serverId){e.next=17;break}throw new Error("original message was not sent");case 17:if(V=this.__resolveSenderId({senderId:V}),Array.isArray(n))return s=n.map(function(e){return _._resolveModelIdWithTypes(e,["user","role"])}),e.next=22,this.__prepareGroupForUsers(E,s,V,j,!1,{groupMetadata:O});e.next=24;break;case 22:u=e.sent,n=u.id;case 24:return void 0===R&&(R=r.priority),e.next=27,this.__resolveCounterPartyEntityAndOrganizationId(n,T);case 27:return c=e.sent,l=c.counterParty,(d=c.organizationId)&&(T=A=d),A=A||T,l&&(n=l.serverId),e.next=35,this.__resolveSender({organizationId:E,senderId:V,senderOrganizationId:T});case 35:if(f=e.sent,p=function(e){return e&&"user"===e.$entityType},h=function(e){return p(e)&&e.isRoleBot},y=(0,Ie.default)(r,"originalMetadata"),h(l)||p(l)&&h(f))return e.next=42,this.__prepareRoleP2PGroup(E,l.id,V,j,{groupMetadata:O});e.next=45;break;case 42:g=e.sent,n=(l=g).id;case 45:return Ze.Validator.notEmpty("entityId",n,"entityId not found"),v={metadata:M,priority:R,senderId:V,originalMetadata:y},v=this.__normalizeSendOptions(v,{counterParty:l,senderOrganizationId:T}),M=v.metadata,(m=this.__createNewMessage(l,o,(0,fe.default)({organizationId:E,senderOrganizationId:T,recipientOrganizationId:A,isForwarded:!0},v))).attachments=a,this.__setForwardedMessageProperties({origMessage:r,organizationId:E,message:m}),this.host.events.deferEventQueue(),this.host.models.Message.inject(m),this.host.emit("message:sending",m),e.prev=55,e.next=58,this.host.api.messages.forward(i,n,{localId:m.id,metadata:M,priority:Be.MessagePriority.toServer(R),recipientOrganizationId:A,senderOrganizationId:T});case 58:if(b=e.sent,w=b.message_id,C)return e.next=63,this.find(w,{instance:m,replace:!0});e.next=66;break;case 63:m=e.sent,e.next=70;break;case 66:m.senderStatus=Be.MessageSenderStatus.SENT,m.serverId=w,m.$synced=void 0,this.host.models.Message.inject(m);case 70:this.host.emit("message:sent",m),e.next=78;break;case 73:e.prev=73,e.t0=e.catch(55),this.logger.error("error while forwarding message",e.t0),m.senderStatus=Be.MessageSenderStatus.FAILED,this.host.models.Message.inject(m);case 78:return this.host.events.resumeEventQueue(),e.abrupt("return",m);case 80:case"end":return e.stop()}},e,this,[[55,73]])})),function(e,t){return V.apply(this,arguments)})},{key:"__setForwardedMessageProperties",value:function(e){var t=e.origMessage,n=e.organizationId,r=e.message,a=t.createdAt,o=t.currentSenderRole,i=t.originalForwardedMessageCreatedAt,s=t.originalMessageId,u=t.originalSender,c=t.originalSenderRole,l=t.sender,d=t.senderRole,f=t.serverId,p=t.subType;return r.originalForwardedMessageCreatedAt||(r.originalForwardedMessageCreatedAt=i||a),r.originalMessageId||(r.originalMessageId=s||f),r.originalSender?r.originalSender=u:l&&(r.originalSender={displayName:l.displayName,id:l.id,organizationId:n}),r.originalSenderRole||(p===Be.MessageSubType.ROLE_AWAY_NOTIFICATION&&o?r.originalSenderRole={$entityType:"role",botUserId:o.botUserId,displayName:o.displayName,id:o.id,organizationId:n}:c?r.originalSenderRole=(0,fe.default)({},c):d&&(r.originalSenderRole=(0,fe.default)({},d))),r.subType||(r.subType=p),r}},{key:"reactToMessageStatusEvent",value:function(e){var t=e.data;if(this.config.condensedReplays)this.reactToMessageStatusEventCR({data:t});else{var n=(t=(0,Ze.jsonCloneDeep)(t)).client_id,r=t.is_recalled,a=this.host.models.Message.get(n);if(a){if(r)return void this.host.models.Message.eject(a);this.__injectMessageStatus(a,t),Ke.MESSAGE_STATUS_ORDER[a.markedRecipientStatus]<Ke.MESSAGE_STATUS_ORDER[Be.MessageRecipientStatus.DELIVERED]&&this.markAsReceived(a)}}}},{key:"reactToMessageStatusEventCR",value:function(e){var t=e.data,n=(t=(0,Ze.jsonCloneDeep)(t)).client_id,r=t.is_recalled,a=t.is_unread,o=this.host.models.Message.get(n);if(o){t.conversation_id||(t.conversation_id=o.conversationId);var i=this.host.conversations.getById(t.conversation_id);i&&(r?this.host.models.Message.eject(o):(o.shouldEnsureRecipientStatus=!0,void 0!==a&&(o.isUnread=a),this.host.models.Message.inject(o),i._markingAsReadSortNumber&&o.sortNumber>=i._markingAsReadSortNumber&&this.host.conversations.__clearOptimisticStatus([i])),this.host.conversations.__injectConversation(t))}}},{key:"__injectMessageStatus",value:function(e,t){if(e){var n=t.account_id||t.accountId,r={createdAt:t.timestamp||t.createdAt,id:e.id+":"+n,messageId:e.id,status:Be.MessageRecipientStatus.resolve(t.status)};return"distributionList"===e.counterPartyType?r.distributionListId=n:(r.userId=n,this.host.models.User.ensureEntity(n,{onlyPlaceholder:!0})),this.host.models.MessageStatusPerRecipient.inject(r)}}},{key:"_findCR",value:(P=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=u.includeCounterParty,l=void 0===c||c,d=u.includeStatuses,f=void 0===d||d,p=u.instance,h=u.replace,y=void 0!==h&&h;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=4;break;case 4:return this.host.requireUser(),e.next=7,this.host.api.messages.find(t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:if(r=n.message){e.next=13;break}return e.abrupt("return",null);case 13:if(r.conversationId=n.conversation_id,p&&y&&this.__setDefaultAttributes(r,{instance:p}),l)return a=r.recipient_token,o=r.sender_organization,e.next=20,this.__lookupCounterParty(a,{organizationId:o});e.next=27;break;case 20:if(!(i=e.sent)){e.next=26;break}r.counterParty=i,r.conversationHandle||(r.conversationHandle=this.host.conversations.getConversationKey(i.$entityType,i.serverId,o)),e.next=27;break;case 26:return e.abrupt("return",null);case 27:if((s=y?this.host.models.Message.replaceExisting(r,{instance:p}):this.host.models.Message.inject(r)).$synced=void 0,f)return e.next=32,this.findRecipientStatus(s,{queue:!1});e.next=32;break;case 32:return e.abrupt("return",s);case 33:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"find",value:(C=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=u.includeCounterParty,l=void 0===c||c,d=u.includeStatuses,f=void 0===d||d,p=u.instance,h=u.replace,y=void 0!==h&&h;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=4;break;case 4:if(this.config.condensedReplays)return e.next=7,this._findCR(t,{includeCounterParty:l,includeStatuses:f,instance:p,replace:y});e.next=9;break;case 7:return n=e.sent,e.abrupt("return",n);case 9:return this.host.requireUser(),e.next=12,this.host.api.messages.find(t);case 12:if(r=e.sent){e.next=15;break}return e.abrupt("return",null);case 15:if(p&&y&&this.__setDefaultAttributes(r,{instance:p}),l)return a=r.recipient_token,o=r.sender_organization,e.next=21,this.__lookupCounterParty(a,{organizationId:o});e.next=28;break;case 21:if(!(i=e.sent)){e.next=27;break}r.counterParty=i,this.config.condensedReplays||r.conversationId||(r.conversationId=this.host.conversations.getConversationKey(i.$entityType,i.serverId,o)),e.next=28;break;case 27:return e.abrupt("return",null);case 28:if((s=y?this.host.models.Message.replaceExisting(r,{instance:p}):this.host.models.Message.inject(r)).$synced=void 0,f)return e.next=33,this.findRecipientStatus(s,{queue:!1});e.next=33;break;case 33:return e.abrupt("return",s);case 34:case"end":return e.stop()}},e,this)})),function(e){return C.apply(this,arguments)})},{key:"findAttachment",value:(z=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=8;break;case 8:if(r=this._resolveMessage(t),a=!1,r){e.next=15;break}return a=!0,e.next=14,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 14:r=e.sent;case 15:if(r){e.next=17;break}return e.abrupt("return",null);case 17:if(!(o=this.__getMessageAttachment(r,n))||o.isLocal||a||"name"in o){e.next=24;break}return e.next=21,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 21:r=e.sent,(o=this.__getMessageAttachment(r,n)).name||(o.name=null);case 24:return e.abrupt("return",o);case 25:case"end":return e.stop()}},e,this)})),function(e,t){return z.apply(this,arguments)})},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+Me(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+Se(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:(R=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b=this,w=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=4;break;case 4:if("function"!=typeof(n=[{model:this.host.models.User,finder:function(){return b.host.users.find(t,{organizationId:w})}},{model:this.host.models.Group,finder:function(){return b.host.groups.find(t)}},{model:this.host.models.DistributionList,finder:function(){return b.host.distributionLists.find(t)}}])[Pe.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Se(n));e.next=7;break;case 7:if(!n||"function"!=typeof n[Pe.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Me(n));e.next=9;break;case 9:a=!(r=!0),o=void 0,e.prev=12,i=(0,Ce.default)(n);case 14:if(r=(s=i.next()).done){e.next=23;break}if(u=s.value,c=u.model,l=c.get(t))return e.abrupt("return",l);e.next=20;break;case 20:r=!0,e.next=14;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),a=!0,o=e.t0;case 29:e.prev=29,e.prev=30,!r&&i.return&&i.return();case 32:if(e.prev=32,a)throw o;e.next=35;break;case 35:return e.finish(32);case 36:return e.finish(29);case 37:if(!n||"function"!=typeof n[Pe.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Se(n));e.next=39;break;case 39:if(!n||"function"!=typeof n[Pe.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Me(n));e.next=41;break;case 41:f=!(d=!0),p=void 0,e.prev=44,h=(0,Ce.default)(n);case 46:if(d=(y=h.next()).done){e.next=64;break}return g=y.value,v=g.finder,e.prev=49,e.next=52,v();case 52:if(m=e.sent)return e.abrupt("return",m);e.next=55;break;case 55:e.next=61;break;case 57:if(e.prev=57,e.t1=e.catch(49),e.t1.code!==Le.NotFoundError.CODE)throw e.t1;e.next=61;break;case 61:d=!0,e.next=46;break;case 64:e.next=70;break;case 66:e.prev=66,e.t2=e.catch(44),f=!0,p=e.t2;case 70:e.prev=70,e.prev=71,!d&&h.return&&h.return();case 73:if(e.prev=73,f)throw p;e.next=76;break;case 76:return e.finish(73);case 77:return e.finish(70);case 78:return e.abrupt("return",null);case 79:case"end":return e.stop()}},e,this,[[12,25,29,37],[30,,32,36],[44,66,70,78],[49,57],[71,,73,77]])})),function(e){return R.apply(this,arguments)})},{key:"_isMessageOutgoing",value:function(e){var t=e.counterParty,n=e.counterPartyType,r=e.currentSenderRole,a=e.senderId;if(!a)return!1;var o=this.host,i=o.currentUser,s=o.currentUserId,u=t||{},c=u.groupType,l=u.members,d=u.p2pRecipient,f=u.p2pSender,p="group"===n&&c===Be.GroupType.ROLE_P2P,h=i.roles,y=[s],g=[],v=0;if(!h||"function"!=typeof h[Pe.default]&&!Array.isArray(h))throw new TypeError("Expected myRoles to be iterable, got "+Se(h));if(!h||"function"!=typeof h[Pe.default]&&!Array.isArray(h))throw new TypeError("Expected myRoles to be iterable, got "+Me(h));var m=!0,b=!1,w=void 0;try{for(var _,x=(0,Ce.default)(h);!(m=(_=x.next()).done);m=!0){var E=_.value.botUserId;y.push(E)}}catch(e){b=!0,w=e}finally{try{!m&&x.return&&x.return()}finally{if(b)throw w}}if(l){if(!l||"function"!=typeof l[Pe.default]&&!Array.isArray(l))throw new TypeError("Expected members to be iterable, got "+Se(l));if(!l||"function"!=typeof l[Pe.default]&&!Array.isArray(l))throw new TypeError("Expected members to be iterable, got "+Me(l));var k=!0,T=!1,I=void 0;try{for(var A,O=(0,Ce.default)(l);!(k=(A=O.next()).done);k=!0){var j=A.value,S=j.botRole;j.isRoleBot&&S&&!g.includes(S)&&g.push(S)}}catch(e){T=!0,I=e}finally{try{!k&&O.return&&O.return()}finally{if(T)throw I}}if(p){if(f){var M=f.botRole;f.isRoleBot&&M&&!g.includes(M)&&g.push(M)}if(d){var R=d.botRole;d.isRoleBot&&R&&!g.includes(R)&&g.push(R)}}if(!g||"function"!=typeof g[Pe.default]&&!Array.isArray(g))throw new TypeError("Expected roleMembers to be iterable, got "+Se(g));if(!g||"function"!=typeof g[Pe.default]&&!Array.isArray(g))throw new TypeError("Expected roleMembers to be iterable, got "+Me(g));var z=!0,C=!1,P=void 0;try{for(var V,G=(0,Ce.default)(g);!(z=(V=G.next()).done);z=!0){var N=V.value;h.includes(N)&&v++}}catch(e){C=!0,P=e}finally{try{!z&&G.return&&G.return()}finally{if(C)throw P}}}return p?!(d===i&&a===s&&!r)&&(!(!f||a!==f.id&&a!==f.botUserId)||h.includes(r)&&(1===v||r===f)):"distributionList"===n||h.includes(r)||y.includes(a)}},{key:"_setRecipientStatus",value:function(e){var t=e.__organizationId,n=e._markingAsStatus,r=e.conversation,a=e.counterParty,o=e.counterPartyType,i=e.createdAt,s=e.deleteOnRead,u=e.expiresAt,c=e.isOutgoing,l=e.messageType,d=e.senderId,f=e.statusesPerRecipient,p=e.ttl,h=this.host,y=h.currentUser,g=h.currentUserId,v=a||{},m=v.groupType,b=v.p2pRecipient,w=[],_=[],x=[g],E=void 0,k=void 0;if(!(S=y.roles)||"function"!=typeof S[Pe.default]&&!Array.isArray(S))throw new TypeError("Expected _currentUser$roles to be iterable, got "+Se(S));if(!S||"function"!=typeof S[Pe.default]&&!Array.isArray(S))throw new TypeError("Expected _currentUser$roles to be iterable, got "+Me(S));var T=!0,I=!1,A=void 0;try{for(var O,j=(0,Ce.default)(S);!(T=(O=j.next()).done);T=!0){var S,M=O.value;M.organizationId===t&&x.push(M.botUserId)}}catch(e){I=!0,A=e}finally{try{!T&&j.return&&j.return()}finally{if(I)throw A}}var R=d&&x.includes(d),z=[],C=Be.MessageRecipientStatus.READ,P=Be.MessageRecipientStatus.NEW,V=m===Be.GroupType.ROLE_P2P&&b===y;if(!f||"function"!=typeof f[Pe.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(f));if(!f||"function"!=typeof f[Pe.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Me(f));var G=!0,N=!1,U=void 0;try{for(var F,$=(0,Ce.default)(f);!(G=(F=$.next()).done);G=!0){var D=F.value.userId;x.includes(D)&&z.push(D)}}catch(e){N=!0,U=e}finally{try{!G&&$.return&&$.return()}finally{if(N)throw U}}var q=1<z.length;if(!f||"function"!=typeof f[Pe.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(f));if(!f||"function"!=typeof f[Pe.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Me(f));var L=!0,B=!1,K=void 0;try{for(var Z,H=(0,Ce.default)(f);!(L=(Z=H.next()).done);L=!0){var W=Z.value,X=W.distributionListId,Q=(D=W.userId,W.status),Y=x.includes(D);V||!(!c&&Y)&&!(c&&(X||!Y))||q&&D===g||_.push(Q),(V||R&&x.includes(d))&&(Ke.MESSAGE_STATUS_ORDER[P]<Ke.MESSAGE_STATUS_ORDER[Q]&&(P=Q),Ke.MESSAGE_STATUS_ORDER[P]<Ke.MESSAGE_STATUS_ORDER[Be.MessageRecipientStatus.READ]&&(P=Be.MessageRecipientStatus.READ)),!Y||V||R&&d===D||w.push(Q)}}catch(e){B=!0,K=e}finally{try{!L&&H.return&&H.return()}finally{if(B)throw K}}if(0<_.length){k=_[0];for(var J=1;J<_.length;J++){var ee=_[J];0===z.length?Ke.MESSAGE_STATUS_ORDER[k]<Ke.MESSAGE_STATUS_ORDER[ee]&&(k=ee):Ke.MESSAGE_STATUS_ORDER[k]>Ke.MESSAGE_STATUS_ORDER[ee]&&(k=ee)}}else k=P;if(E=C,0<w.length){if(!w||"function"!=typeof w[Pe.default]&&!Array.isArray(w))throw new TypeError("Expected applicableLeastStatuses to be iterable, got "+Se(w));if(!w||"function"!=typeof w[Pe.default]&&!Array.isArray(w))throw new TypeError("Expected applicableLeastStatuses to be iterable, got "+Me(w));var te=!0,ne=!1,re=void 0;try{for(var ae,oe=(0,Ce.default)(w);!(te=(ae=oe.next()).done);te=!0){var ie=ae.value;Ke.MESSAGE_STATUS_ORDER[E]>Ke.MESSAGE_STATUS_ORDER[ie]&&(E=ie)}}catch(e){ne=!0,re=e}finally{try{!te&&oe.return&&oe.return()}finally{if(ne)throw re}}}if(this.config.condensedReplays&&r&&r._markingAsRead&&r._markingAsReadSortNumber>=e.sortNumber&&(k=Be.MessageRecipientStatus.READ),n){var se=!1;Ke.MESSAGE_STATUS_ORDER[k]<Ke.MESSAGE_STATUS_ORDER[n]&&(k=n,se=!0),!this.config.condensedReplays&&c&&Ke.MESSAGE_STATUS_ORDER[E]<Ke.MESSAGE_STATUS_ORDER[n]&&(E=n,se=!0),se||this.config.condensedReplays||(e._markingAsStatus=void 0)}if(s&&"user"===o&&k===Be.MessageRecipientStatus.READ){var ue=Date.now()+6e4;(!u||ue<u)&&(u=ue)}else u||void 0===p||(u=i.getTime()+60*p*1e3);e.expiresAt=u,this.config.condensedReplays?e.isUnread=!e.isEphemeral&&e.isUnread:(e.isUnread=!e.isEphemeral&&l===Be.MessageType.USER_SENT&&!c&&-1===this.compareRecipientStatus(k,Be.MessageRecipientStatus.READ),e.markedRecipientStatus=E),e.ttl=p}},{key:"compareRecipientStatus",value:function(e,t){return Be.MessageRecipientStatus.isValid(e)&&(e=Ke.MESSAGE_STATUS_ORDER[e]),Be.MessageRecipientStatus.isValid(t)&&(t=Ke.MESSAGE_STATUS_ORDER[t]),t<e?1:e===t?0:e<t?-1:void 0}},{key:"__getMessageAttachment",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));var n=this._resolveMessage(e);return n?(t=t.toString(),n.attachments?(0,ke.default)(n.attachments,{id:t}):null):null}},{key:"__getAttachmentPath",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));return"/"+this.host.api.messages.getVersion().version+"/message/"+e+"/attachment/"+t}},{key:"downloadAttachmentUrl",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));return this._downloadAttachmentBlobAndUrl(e,t).then(function(e){return e.url})}},{key:"downloadAttachmentUrlWithToken",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));return this._downloadAttachmentBlobAndUrlWithToken(e,t).then(function(e){return e.url})}},{key:"downloadAttachment",value:(M=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).fileName;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=8;break;case 8:e.next=25;break;case 16:return e.next=18,this._downloadAttachmentBlobAndUrl(r.serverId,n);case 18:a=e.sent.blob;case 19:return(i=i||(void 0).name)||(i="Attachment",r.sender.$placeholder||(i+=" from "+r.sender.displayName),i+=" at "+(0,$e.default)(r.createdAt).format("YYYY-MM-DD h-mma"),(o=(0,We.getMimeType)({mime:(void 0).contentType}))&&(i+=o.ext)),e.next=23,(0,He.downloadFile)({attachmentContentType:(void 0).contentType,blob:a,fileName:i});case 23:e.next=26;break;case 25:Le.TargetNotSupportedError.raise();case 26:case"end":return e.stop()}},e,this)})),function(e,t){return M.apply(this,arguments)})},{key:"_downloadAttachmentBlobAndUrl",value:(S=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=8;break;case 8:e.next=27;break;case 13:if(r=e.sent){e.next=16;break}throw new Le.NotFoundError("MessageAttachment",(void 0).serverId+":"+n);case 16:if(r.isLocal&&r.localFile instanceof Blob)return e.next=19,r.localPathPromise;e.next=23;break;case 19:return a=e.sent,e.abrupt("return",{blob:r.localFile,url:a});case 23:return o=this.__getAttachmentPath((void 0).serverId,n),e.abrupt("return",this.httpClient.downloadFileBlobAndUrl(o));case 25:e.next=28;break;case 27:Le.TargetNotSupportedError.raise();case 28:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"_downloadAttachmentBlobAndUrlWithToken",value:(j=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=8;break;case 8:e.next=29;break;case 13:if(r=e.sent){e.next=16;break}throw new Le.NotFoundError("MessageAttachment",(void 0).serverId+":"+n);case 16:if(r.isLocal&&r.localFile instanceof Blob)return e.next=19,r.localPathPromise;e.next=23;break;case 19:return a=e.sent,e.abrupt("return",{blob:r.localFile,url:a});case 23:return e.next=25,this.getAttachmentUrlWithToken((void 0).serverId,n);case 25:return o=e.sent,e.abrupt("return",this.httpClient.downloadFileBlobAndUrl(o));case 27:e.next=30;break;case 29:Le.TargetNotSupportedError.raise();case 30:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"downloadAttachmentToFile",value:(O=(0,ye.default)(Ve.default.mark(function e(t,n,r){var a,o,i;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(r));e.next=6;break;case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(r));e.next=12;break;case 12:return n=n.toString(),a=this._resolveMessage(t),e.next=17,this.findAttachment(t,n);case 17:if(o=e.sent){e.next=20;break}throw new Le.NotFoundError("MessageAttachment",a.serverId+":"+n);case 20:if(!/(\/|\\)$/.test(r)){e.next=26;break}if(!o.name){e.next=25;break}r+=o.name,e.next=26;break;case 25:throw new Error("missing file name in downloadAttachmentToFile(..., dest)");case 26:return i=this.__getAttachmentPath(a.serverId,n),e.abrupt("return",this.httpClient.downloadToFile(i,r));case 30:Le.TargetNotSupportedError.raise();case 31:case"end":return e.stop()}},e,this)})),function(e,t,n){return O.apply(this,arguments)})},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){var e=this.host.models.Product.getAll()[0];return e?e.unreadCount:0}},{key:"getTotalUnreadPriorityCount",value:function(){var e=this.host.models.Product.getAll()[0];return e?e.unreadPriorityCount:0}},{key:"markAsRead",value:(A=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=l.localOnly,f=void 0!==d&&d,p=l.queue,h=void 0===p?this.host.currentlyServingOfflineMessages:p;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Se(t));case 4:if(0===(t=(n=(n=t,Ze.arrayWrapBound).call(n).map(this._resolveModelId),Ue.default).call(n)).length)return e.abrupt("return");e.next=7;break;case 7:if(this.config.condensedReplays||!f){e.next=34;break}if(!(r=this.host.models.Message.getMulti(t))||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected readMessages to be iterable, got "+Se(r));e.next=11;break;case 11:if(!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected readMessages to be iterable, got "+Me(r));e.next=13;break;case 13:for(o=!(a=!0),i=void 0,e.prev=16,s=(0,Ce.default)(r);!(a=(u=s.next()).done);a=!0)(c=u.value)&&(c._markingAsStatus=Be.MessageRecipientStatus.READ,this.host.models.Message.inject(c));e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),o=!0,i=e.t0;case 24:e.prev=24,e.prev=25,!a&&s.return&&s.return();case 27:if(e.prev=27,o)throw i;e.next=30;break;case 30:return e.finish(27);case 31:return e.finish(24);case 32:e.next=39;break;case 34:if(h)return e.abrupt("return",this.__queueSetMessageStatuses({readIds:t}));e.next=38;break;case 38:return e.abrupt("return",this.__setMessagesStatus({readIds:t}));case 39:case"end":return e.stop()}},e,this,[[16,20,24,32],[25,,27,31]])})),function(e){return A.apply(this,arguments)})},{key:"markAsDelivered",value:(I=(0,ye.default)(Ve.default.mark(function e(t){var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Se(t));case 4:if(r=(0,Te.default)(r,{queue:this.host.currentlyServingOfflineMessages}),0===(t=(n=(n=t,Ze.arrayWrapBound).call(n).map(this._resolveModelId),Ue.default).call(n)).length)return e.abrupt("return");e.next=8;break;case 8:if(r.queue)return e.abrupt("return",this.__queueSetMessageStatuses({deliveredIds:t}));e.next=12;break;case 12:return e.abrupt("return",this.__setMessagesStatus({deliveredIds:t}));case 13:case"end":return e.stop()}},e,this)})),function(e){return I.apply(this,arguments)})},{key:"markAsReceived",value:(T=(0,ye.default)(Ve.default.mark(function e(){var t=arguments;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.markAsDelivered.apply(this,t));case 1:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"__queueSetMessageStatuses",value:(k=(0,ye.default)(Ve.default.mark(function e(t){var n,r=t.deliveredIds,a=t.readIds,o=arguments;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=o[0]&&(void 0===o[0].deliveredIds||null==o[0].deliveredIds||Array.isArray(o[0].deliveredIds)&&o[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(void 0===o[0].readIds||null==o[0].readIds||Array.isArray(o[0].readIds)&&o[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds?: ?Array<string>;\n  readIds?: ?Array<string>;\n}\n\nGot:\n"+Me(o[0]));case 2:if(null!=o[0]&&(void 0===o[0].deliveredIds||null==o[0].deliveredIds||Array.isArray(o[0].deliveredIds)&&o[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(void 0===o[0].readIds||null==o[0].readIds||Array.isArray(o[0].readIds)&&o[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds?: ?Array<string>;\n  readIds?: ?Array<string>;\n}\n\nGot:\n"+Se(o[0]));case 4:if(n=this._queuedSetMessageStatuses,r&&(n.deliveredIds=(0,Ee.default)(n.deliveredIds,r)),a&&(n.readIds=(0,Ee.default)(n.readIds,a)),n.deliveredIds.length+n.readIds.length>=this.config.flushSetMessageStatusMaxCount)return this.logger.log("reached "+this.config.flushSetMessageStatusMaxCount+" -- flushing"),e.abrupt("return",this.__flushSetMessageStatusesQueue());e.next=13;break;case 13:this._throttled_flushSetMessageStatusesQueue();case 14:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"__setMessagesStatus",value:(E=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P=t.deliveredIds,V=void 0===P?[]:P,G=t.readIds,N=void 0===G?[]:G;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),V=(n=V.map(this._resolveModelId),Ue.default).call(n),N=(n=N.map(this._resolveModelId),Ue.default).call(n),V=this.config.condensedReplays?(0,xe.default)(V,N):(r=this.host.models.Message.getMulti(V).filter(function(e){return e&&Ke.MESSAGE_STATUS_ORDER[e.markedRecipientStatus]>=Ke.MESSAGE_STATUS_ORDER[Be.MessageRecipientStatus.DELIVERED]}),a=r.map(function(e){return e.id}),o=this.host.models.Message.getMulti(N).filter(function(e){return e&&Ke.MESSAGE_STATUS_ORDER[e.markedRecipientStatus]>=Ke.MESSAGE_STATUS_ORDER[Be.MessageRecipientStatus.READ]}),i=o.map(function(e){return e.id}),N=(0,xe.default)(N,i),(0,xe.default)(V,N,a)),s={},0<V.length&&(s.delivered=V),!(0<N.length)){e.next=32;break}if(s.read=N,!(u=this.host.models.Message.getMulti(N))||"function"!=typeof u[Pe.default]&&!Array.isArray(u))throw new TypeError("Expected readMessages to be iterable, got "+Se(u));e.next=11;break;case 11:if(!u||"function"!=typeof u[Pe.default]&&!Array.isArray(u))throw new TypeError("Expected readMessages to be iterable, got "+Me(u));e.next=13;break;case 13:for(l=!(c=!0),d=void 0,e.prev=16,f=(0,Ce.default)(u);!(c=(p=f.next()).done);c=!0)(h=p.value)&&(h._markingAsStatus=Be.MessageRecipientStatus.READ,this.host.models.Message.inject(h));e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),l=!0,d=e.t0;case 24:e.prev=24,e.prev=25,!c&&f.return&&f.return();case 27:if(e.prev=27,l)throw d;e.next=30;break;case 30:return e.finish(27);case 31:return e.finish(24);case 32:if(0===(0,ze.default)(s).length)return e.abrupt("return",!1);e.next=34;break;case 34:return e.prev=34,e.next=37,this.host.api.messages.updateRecipientStatusMulti(s);case 37:if(y=e.sent,!this.config.condensedReplays){e.next=63;break}if(!(_=(0,le.default)(y))||"function"!=typeof _[Pe.default]&&!Array.isArray(_))throw new TypeError("Expected _Object$entries2 to be iterable, got "+Se(_));e.next=42;break;case 42:if(!_||"function"!=typeof _[Pe.default]&&!Array.isArray(_))throw new TypeError("Expected _Object$entries2 to be iterable, got "+Me(_));e.next=44;break;case 44:for(v=!(g=!0),m=void 0,e.prev=47,b=(0,Ce.default)(_);!(g=(w=b.next()).done);g=!0)x=(0,ce.default)(w.value,2),E=x[0],k=x[1],T=k.unread_message_count,I=k.unread_priority_message_count,(A=this.host.models.Conversation.get(E))&&(A.unreadMessageCount=T,A.unreadPriorityMessageCount=I,this.host.models.Conversation.inject(A));e.next=55;break;case 51:e.prev=51,e.t1=e.catch(47),v=!0,m=e.t1;case 55:e.prev=55,e.prev=56,!g&&b.return&&b.return();case 58:if(e.prev=58,v)throw m;e.next=61;break;case 61:return e.finish(58);case 62:return e.finish(55);case 63:e.next=92;break;case 65:if(e.prev=65,e.t2=e.catch(34),!(O=this.host.models.Message.getMulti(N))||"function"!=typeof O[Pe.default]&&!Array.isArray(O))throw new TypeError("Expected readMessages to be iterable, got "+Se(O));e.next=70;break;case 70:if(!O||"function"!=typeof O[Pe.default]&&!Array.isArray(O))throw new TypeError("Expected readMessages to be iterable, got "+Me(O));e.next=72;break;case 72:for(S=!(j=!0),M=void 0,e.prev=75,R=(0,Ce.default)(O);!(j=(z=R.next()).done);j=!0)(C=z.value)&&C._markingAsStatus&&(C._markingAsStatus=void 0,this.host.models.Message.inject(C));e.next=83;break;case 79:e.prev=79,e.t3=e.catch(75),S=!0,M=e.t3;case 83:e.prev=83,e.prev=84,!j&&R.return&&R.return();case 86:if(e.prev=86,S)throw M;e.next=89;break;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.abrupt("return",he.default.reject(e.t2));case 92:return e.abrupt("return",!0);case 93:case"end":return e.stop()}},e,this,[[16,20,24,32],[25,,27,31],[34,65],[47,51,55,63],[56,,58,62],[75,79,83,91],[84,,86,90]])})),function(e){return E.apply(this,arguments)})},{key:"setMessageTTLInMinutes",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Me(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Se(t));var n=this._resolveMessage(e);if(n){var r=(0,$e.default)().add(t,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}}},{key:"_clearOptimisticMarkAsReadState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();if(e.getTime&&(e=e.getTime()),!(i=this.host.organizations.getAll())||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g to be iterable, got "+Se(i));if(!i||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g to be iterable, got "+Me(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Ce.default)(i);!(t=(a=o.next()).done);t=!0)for(var i,s=a.value.__markingAsReadConversations,u=!1;!u&&0<s.length;){var c=s[0],l=this.host.conversations.getById(c.id);if(!l)return;l._markingAsReadExpiration<e?(l._markingAsRead=!1,l._markingAsReadSortNumber=null,l._markingAsReadExpiration=null,this.host.models.Conversation.inject(l),this.host.conversations.find(l.id,{ensureEntities:!1})):u=!0}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"ensureRecipientStatus",value:(x=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},g=y.includeUsers,v=void 0===g||g,m=y.queue,b=void 0===m||m;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),t=this._resolveModelId(t),n=this._resolveMessage(t)){e.next=9;break}return e.abrupt("return",null);case 9:if(r=n.counterPartyType,a=n.senderStatus,o=n.shouldEnsureRecipientStatus,i=n.statusesPerRecipient,a===Be.MessageSenderStatus.SENDING)return e.abrupt("return",null);e.next=12;break;case 12:if("distributionList"===r)return e.abrupt("return",null);e.next=14;break;case 14:if(o||!(0<i.length)){e.next=42;break}if(s=!1,!v){e.next=40;break}if(!i||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(i));e.next=19;break;case 19:if(!i||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Me(i));e.next=21;break;case 21:for(c=!(u=!0),l=void 0,e.prev=24,d=(0,Ce.default)(i);!(u=(f=d.next()).done);u=!0)f.value.user||(s=!0);e.next=32;break;case 28:e.prev=28,e.t0=e.catch(24),c=!0,l=e.t0;case 32:e.prev=32,e.prev=33,!u&&d.return&&d.return();case 35:if(e.prev=35,c)throw l;e.next=38;break;case 38:return e.finish(35);case 39:return e.finish(32);case 40:if(s){e.next=42;break}return e.abrupt("return",i);case 42:if(p=void 0,b)return e.next=46,this.__queueFindRecipientStatuses([{id:t,includeUsers:v}]);e.next=50;break;case 46:h=e.sent,p=h[0],e.next=53;break;case 50:return e.next=52,this.__findRecipientStatus(t,{includeUsers:v});case 52:p=e.sent;case 53:return e.abrupt("return",p);case 54:case"end":return e.stop()}},e,this,[[24,28,32,40],[33,,35,39]])})),function(e){return x.apply(this,arguments)})},{key:"findRecipientStatus",value:(_=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.includeUsers,s=void 0!==i&&i,u=o.queue,c=void 0===u||u;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}return e.abrupt("return",null);case 8:if(n.senderStatus===Be.MessageSenderStatus.SENDING)return e.abrupt("return",null);e.next=10;break;case 10:if("distributionList"===n.counterPartyType)return e.abrupt("return",null);e.next=12;break;case 12:if(t=this._resolveModelId(t),r=void 0,c)return e.next=17,this.__queueFindRecipientStatuses([{id:t,includeUsers:s}]);e.next=21;break;case 17:a=e.sent,r=a[0],e.next=24;break;case 21:return e.next=23,this.__findRecipientStatus(t,{includeUsers:s});case 23:r=e.sent;case 24:return e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"ensureRecipientStatusMulti",value:(w=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},z=R.includeUsers,C=void 0===z||z,P=R.queue,V=void 0===P||P;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Me(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Se(t));case 4:if(t=(n=(n=t,Ze.arrayWrapBound).call(n).map(this._resolveModelId),Ue.default).call(n),r=[],a={},!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Se(t));e.next=9;break;case 9:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Me(t));e.next=11;break;case 11:i=!(o=!0),s=void 0,e.prev=14,u=(0,Ce.default)(t);case 16:if(o=(c=u.next()).done){e.next=53;break}if(l=c.value,d={id:l,includeUsers:C},f=this._resolveMessage(l),p=!0,!f){e.next=49;break}if(h=f.shouldEnsureRecipientStatus,y=f.statusesPerRecipient,h||!(0<y.length)){e.next=49;break}if(p=!1,!C){e.next=49;break}if(!y||"function"!=typeof y[Pe.default]&&!Array.isArray(y))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(y));e.next=28;break;case 28:if(!y||"function"!=typeof y[Pe.default]&&!Array.isArray(y))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Me(y));e.next=30;break;case 30:for(v=!(g=!0),m=void 0,e.prev=33,b=(0,Ce.default)(y);!(g=(w=b.next()).done);g=!0)w.value.user||(p=!0);e.next=41;break;case 37:e.prev=37,e.t0=e.catch(33),v=!0,m=e.t0;case 41:e.prev=41,e.prev=42,!g&&b.return&&b.return();case 44:if(e.prev=44,v)throw m;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:p?r.push(d):a[d.id]=f.statusesPerRecipient;case 50:o=!0,e.next=16;break;case 53:e.next=59;break;case 55:e.prev=55,e.t1=e.catch(14),i=!0,s=e.t1;case 59:e.prev=59,e.prev=60,!o&&u.return&&u.return();case 62:if(e.prev=62,i)throw s;e.next=65;break;case 65:return e.finish(62);case 66:return e.finish(59);case 67:if(0===r.length)return e.abrupt("return");e.next=69;break;case 69:if(_=void 0,V)return e.next=73,this.__queueFindRecipientStatuses(r);e.next=76;break;case 73:_=e.sent,e.next=79;break;case 76:return e.next=78,this.__findRecipientStatusMulti(r);case 78:_=e.sent;case 79:if(_)for(x=0;x<r.length;x++)_.length>x&&(E=r[x],k=_[x],a[E.id]=k);if(T=[],!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Se(t));e.next=83;break;case 83:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Me(t));e.next=85;break;case 85:for(A=!(I=!0),O=void 0,e.prev=88,j=(0,Ce.default)(t);!(I=(S=j.next()).done);I=!0)M=S.value,T.push(a[M]);e.next=96;break;case 92:e.prev=92,e.t2=e.catch(88),A=!0,O=e.t2;case 96:e.prev=96,e.prev=97,!I&&j.return&&j.return();case 99:if(e.prev=99,A)throw O;e.next=102;break;case 102:return e.finish(99);case 103:return e.finish(96);case 104:return e.abrupt("return",T);case 105:case"end":return e.stop()}},e,this,[[14,55,59,67],[33,37,41,49],[42,,44,48],[60,,62,66],[88,92,96,104],[97,,99,103]])})),function(e){return w.apply(this,arguments)})},{key:"findRecipientStatusMulti",value:(b=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=d.includeUsers,p=void 0!==f&&f,h=d.queue,y=void 0!==h&&h;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Me(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Se(t));case 4:if(t=(n=(n=t,Ze.arrayWrapBound).call(n).map(this._resolveModelId),Ue.default).call(n),r=[],!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Se(t));e.next=8;break;case 8:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Me(t));e.next=10;break;case 10:for(o=!(a=!0),i=void 0,e.prev=13,s=(0,Ce.default)(t);!(a=(u=s.next()).done);a=!0)c=u.value,l={id:c,includeUsers:p},r.push(l);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),o=!0,i=e.t0;case 21:e.prev=21,e.prev=22,!a&&s.return&&s.return();case 24:if(e.prev=24,o)throw i;e.next=27;break;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(0===r.length)return e.abrupt("return");e.next=31;break;case 31:if(y)return e.abrupt("return",this.__queueFindRecipientStatuses(r));e.next=35;break;case 35:return e.abrupt("return",this.__findRecipientStatusMulti(r));case 36:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28]])})),function(e){return b.apply(this,arguments)})},{key:"__queueFindRecipientStatuses",value:(m=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "statusRequests" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Me(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "statusRequests" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Se(t));case 4:if(n=[],!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected statusRequests to be iterable, got "+Se(t));e.next=7;break;case 7:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected statusRequests to be iterable, got "+Me(t));e.next=9;break;case 9:a=!(r=!0),o=void 0,e.prev=12,i=(0,Ce.default)(t);case 14:if(r=(s=i.next()).done){e.next=59;break}if(u=s.value,c=u.id,l=u.includeUsers,p=!(f=d=void 0),n.push(new he.default(function(e,t){d=e,f=t})),!(b=this._queuedFindRecipientStatuses)||"function"!=typeof b[Pe.default]&&!Array.isArray(b))throw new TypeError("Expected _queuedFindRecipientS to be iterable, got "+Se(b));e.next=23;break;case 23:if(!b||"function"!=typeof b[Pe.default]&&!Array.isArray(b))throw new TypeError("Expected _queuedFindRecipientS to be iterable, got "+Me(b));e.next=25;break;case 25:y=!(h=!0),g=void 0,e.prev=28,v=(0,Ce.default)(b);case 30:if(h=(m=v.next()).done){e.next=41;break}if(w=m.value,c===w.id)return w.includeUsers=w.includeUsers||l,w.onCompletes.push(d),w.onErrors.push(f),p=!1,e.abrupt("break",41);e.next=38;break;case 38:h=!0,e.next=30;break;case 41:e.next=47;break;case 43:e.prev=43,e.t0=e.catch(28),y=!0,g=e.t0;case 47:e.prev=47,e.prev=48,!h&&v.return&&v.return();case 50:if(e.prev=50,y)throw g;e.next=53;break;case 53:return e.finish(50);case 54:return e.finish(47);case 55:p&&this._queuedFindRecipientStatuses.push({id:c,includeUsers:l,onCompletes:[d],onErrors:[f]});case 56:r=!0,e.next=14;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(12),a=!0,o=e.t1;case 65:e.prev=65,e.prev=66,!r&&i.return&&i.return();case 68:if(e.prev=68,a)throw o;e.next=71;break;case 71:return e.finish(68);case 72:return e.finish(65);case 73:return this._queuedFindRecipientStatuses.length>=this.config.flushFindRecipientStatusMaxCount?(this.logger.log("reached "+this.config.flushFindRecipientStatusMaxCount+" -- flushing"),this.__flushFindRecipientStatusesQueue()):0<this._queuedFindRecipientStatuses.length&&this._throttled_flushFindRecipientStatusesQueue(),e.next=76,he.default.all(n);case 76:return _=e.sent,e.abrupt("return",_);case 78:case"end":return e.stop()}},e,this,[[12,61,65,73],[28,43,47,55],[48,,50,54],[66,,68,72]])})),function(e){return m.apply(this,arguments)})},{key:"__flushFindRecipientStatusesQueue",value:(v=(0,ye.default)(Ve.default.mark(function e(){var v,m,b,t,n;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this._queuedFindRecipientStatuses.length)return e.abrupt("return");e.next=2;break;case 2:return v=this._queuedFindRecipientStatuses,this._queuedFindRecipientStatuses=[],b=m=void 0,e.prev=5,e.next=8,this.__findRecipientStatusMulti(v);case 8:b=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),m=e.t0;case 14:for(e.prev=14,t=function(e){var t=void 0;b&&b.length>e&&(t=b[e]);var n=v[e],r=n.onCompletes,a=n.onErrors;if(m){if(!a||"function"!=typeof a[Pe.default]&&!Array.isArray(a))throw new TypeError("Expected onErrors to be iterable, got "+Se(a));if(!a||"function"!=typeof a[Pe.default]&&!Array.isArray(a))throw new TypeError("Expected onErrors to be iterable, got "+Me(a));var o=!0,i=!1,s=void 0;try{for(var u,c=function(){var e=u.value;setTimeout(function(){return e(m)},0)},l=(0,Ce.default)(a);!(o=(u=l.next()).done);o=!0)c()}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}}else{if(!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected onCompletes to be iterable, got "+Se(r));if(!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected onCompletes to be iterable, got "+Me(r));var d=!0,f=!1,p=void 0;try{for(var h,y=function(){var e=h.value;setTimeout(function(){return e(t)},0)},g=(0,Ce.default)(r);!(d=(h=g.next()).done);d=!0)y()}catch(e){f=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw p}}}},n=0;n<v.length;n++)t(n);return e.finish(14);case 18:case"end":return e.stop()}},e,this,[[5,11,14,18]])})),function(){return v.apply(this,arguments)})},{key:"__findRecipientStatus",value:(g=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k=this,T=n.includeUsers;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),r=this._resolveMessage(t),a=!1,this._pendingFindRecipientStatuses[r.id])return e.abrupt("return",null);e.next=5;break;case 5:return o=void 0,e.prev=6,i=new he.default(function(e,t){k._pendingFindRecipientStatuses[r.id]=function(){return e(null)}}),e.next=10,he.default.race([i,this.host.api.messages.findRecipientStatus(r.serverId)]);case 10:o=e.sent;case 11:return e.prev=11,delete this._pendingFindRecipientStatuses[r.id],e.finish(11);case 14:if(o){e.next=16;break}return e.abrupt("return",null);case 16:if(o.is_recalled)return this.host.models.Message.eject(r),e.abrupt("return",null);e.next=19;break;case 19:if(!(f=o.statuses)||"function"!=typeof f[Pe.default]&&!Array.isArray(f))throw new TypeError("Expected _data$statuses to be iterable, got "+Se(f));e.next=22;break;case 22:if(!f||"function"!=typeof f[Pe.default]&&!Array.isArray(f))throw new TypeError("Expected _data$statuses to be iterable, got "+Me(f));e.next=24;break;case 24:for(u=!(s=!0),c=void 0,e.prev=27,l=(0,Ce.default)(f);!(s=(d=l.next()).done);s=!0)p=d.value,this.__injectMessageStatus(r,p);e.next=35;break;case 31:e.prev=31,e.t0=e.catch(27),u=!0,c=e.t0;case 35:e.prev=35,e.prev=36,!s&&l.return&&l.return();case 38:if(e.prev=38,u)throw c;e.next=41;break;case 41:return e.finish(38);case 42:return e.finish(35);case 43:if(!T){e.next=72;break}if(h=r.recipientOrganizationId,y=r.statusesPerRecipient,g=[],!y||"function"!=typeof y[Pe.default]&&!Array.isArray(y))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(y));e.next=48;break;case 48:if(!y||"function"!=typeof y[Pe.default]&&!Array.isArray(y))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Me(y));e.next=50;break;case 50:for(m=!(v=!0),b=void 0,e.prev=53,w=(0,Ce.default)(y);!(v=(_=w.next()).done);v=!0)x=_.value,(E=x.userId)&&usersIds.push(E);e.next=61;break;case 57:e.prev=57,e.t1=e.catch(53),m=!0,b=e.t1;case 61:e.prev=61,e.prev=62,!v&&w.return&&w.return();case 64:if(e.prev=64,m)throw b;e.next=67;break;case 67:return e.finish(64);case 68:return e.finish(61);case 69:return e.next=71,this.host.users.ensureUsers(g,h);case 71:a=!0;case 72:return r.shouldEnsureRecipientStatus&&(r.shouldEnsureRecipientStatus=!1,a=!0),a&&this.host.models.Message.inject(r),!this.config.condensedReplays&&Ke.MESSAGE_STATUS_ORDER[r.markedRecipientStatus]<Ke.MESSAGE_STATUS_ORDER[Be.MessageRecipientStatus.DELIVERED]&&this.markAsReceived(r),e.abrupt("return",r.statusesPerRecipient);case 77:case"end":return e.stop()}},e,this,[[6,,11,14],[27,31,35,43],[36,,38,42],[53,57,61,69],[62,,64,68]])})),function(e,t){return g.apply(this,arguments)})},{key:"__findRecipientStatusMulti",value:(y=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P,V,G,N,U,F,$,D,q,L,B,K,Z,H,W,X,Q,Y,J,ee,te,ne,re,ae,oe,ie,se,ue,ce,le,de,fe,pe,he,ye,ge,ve,me,be,we,_e,xe,Ee,ke,Te,Ie,Ae,Oe,je=this;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "requests" violates contract.\n\nExpected:\nArray<Object>\n\nGot:\n'+Me(t));case 2:if(Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "requests" violates contract.\n\nExpected:\nArray<Object>\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n={},r=t,t=[],!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected inRequests to be iterable, got "+Se(r));e.next=10;break;case 10:if(!r||"function"!=typeof r[Pe.default]&&!Array.isArray(r))throw new TypeError("Expected inRequests to be iterable, got "+Me(r));e.next=12;break;case 12:o=!(a=!0),i=void 0,e.prev=15,s=(0,Ce.default)(r);case 17:if(a=(u=s.next()).done){e.next=35;break}if(c=u.value,l=c.id,d=c.includeUsers,f=this._resolveMessage(l),h=(p=f||{}).counterParty,y=p.serverId,g={id:l,includeUsers:d,message:f},t.push(g),y){e.next=26;break}return e.abrupt("continue",32);case 26:if(this._pendingFindRecipientStatuses[y])return e.abrupt("continue",32);e.next=28;break;case 28:if(h&&"distributionList"===h.$entityType)return e.abrupt("continue",32);e.next=30;break;case 30:g.id=y,n[y]=!0;case 32:a=!0,e.next=17;break;case 35:e.next=41;break;case 37:e.prev=37,e.t0=e.catch(15),o=!0,i=e.t0;case 41:e.prev=41,e.prev=42,!a&&s.return&&s.return();case 44:if(e.prev=44,o)throw i;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:if(v=(0,Ge.default)((0,ze.default)(n),20),m={},b={},!v||"function"!=typeof v[Pe.default]&&!Array.isArray(v))throw new TypeError("Expected idGroupChunks to be iterable, got "+Se(v));e.next=54;break;case 54:if(!v||"function"!=typeof v[Pe.default]&&!Array.isArray(v))throw new TypeError("Expected idGroupChunks to be iterable, got "+Me(v));e.next=56;break;case 56:_=!(w=!0),x=void 0,e.prev=59,E=(0,Ce.default)(v);case 61:if(w=(k=E.next()).done){e.next=156;break}return T=k.value,I=void 0,e.prev=64,e.delegateYield(Ve.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l,d,f,p,h,y;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},!T||"function"!=typeof T[Pe.default]&&!Array.isArray(T))throw new TypeError("Expected idsInGroup to be iterable, got "+Se(T));e.next=3;break;case 3:if(!T||"function"!=typeof T[Pe.default]&&!Array.isArray(T))throw new TypeError("Expected idsInGroup to be iterable, got "+Me(T));e.next=5;break;case 5:for(r=!(n=!0),a=void 0,e.prev=8,o=function(){var e=s.value;je._pendingFindRecipientStatuses[e]=function(){t[e]=!0}},i=(0,Ce.default)(T);!(n=(s=i.next()).done);n=!0)o();e.next=17;break;case 13:e.prev=13,e.t0=e.catch(8),r=!0,a=e.t0;case 17:e.prev=17,e.prev=18,!n&&i.return&&i.return();case 20:if(e.prev=20,r)throw a;e.next=23;break;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.next=27,je.host.api.messages.findRecipientStatusMulti(T);case 27:if(u=e.sent,I=[],!u||"function"!=typeof u[Pe.default]&&!Array.isArray(u))throw new TypeError("Expected rawResults to be iterable, got "+Se(u));e.next=31;break;case 31:if(!u||"function"!=typeof u[Pe.default]&&!Array.isArray(u))throw new TypeError("Expected rawResults to be iterable, got "+Me(u));e.next=33;break;case 33:for(l=!(c=!0),d=void 0,e.prev=36,f=(0,Ce.default)(u);!(c=(p=f.next()).done);c=!0)h=p.value,y=h.client_id,t[y]||I.push(h);e.next=44;break;case 40:e.prev=40,e.t1=e.catch(36),l=!0,d=e.t1;case 44:e.prev=44,e.prev=45,!c&&f.return&&f.return();case 47:if(e.prev=47,l)throw d;e.next=50;break;case 50:return e.finish(47);case 51:return e.finish(44);case 52:case"end":return e.stop()}},e,je,[[8,13,17,25],[18,,20,24],[36,40,44,52],[45,,47,51]])})(),"t1",66);case 66:if(e.prev=66,!T||"function"!=typeof T[Pe.default]&&!Array.isArray(T))throw new TypeError("Expected idsInGroup to be iterable, got "+Se(T));e.next=69;break;case 69:if(!T||"function"!=typeof T[Pe.default]&&!Array.isArray(T))throw new TypeError("Expected idsInGroup to be iterable, got "+Me(T));e.next=71;break;case 71:for(O=!(A=!0),j=void 0,e.prev=74,S=(0,Ce.default)(T);!(A=(M=S.next()).done);A=!0)R=M.value,delete this._pendingFindRecipientStatuses[R];e.next=82;break;case 78:e.prev=78,e.t2=e.catch(74),O=!0,j=e.t2;case 82:e.prev=82,e.prev=83,!A&&S.return&&S.return();case 85:if(e.prev=85,O)throw j;e.next=88;break;case 88:return e.finish(85);case 89:return e.finish(82);case 90:return e.finish(66);case 91:if(I){e.next=93;break}return e.abrupt("return",[]);case 93:if(!I||"function"!=typeof I[Pe.default]&&!Array.isArray(I))throw new TypeError("Expected results to be iterable, got "+Se(I));e.next=95;break;case 95:if(!I||"function"!=typeof I[Pe.default]&&!Array.isArray(I))throw new TypeError("Expected results to be iterable, got "+Me(I));e.next=97;break;case 97:C=!(z=!0),P=void 0,e.prev=100,V=(0,Ce.default)(I);case 102:if(z=(G=V.next()).done){e.next=139;break}if(N=G.value,U=N.client_id,F=N.statuses,$=this.host.models.Message.get(U),N.is_recalled)return this.host.models.Message.eject($),b[U]=!0,e.abrupt("continue",136);e.next=111;break;case 111:if(!(F&&0<F.length)){e.next=136;break}if(!F||"function"!=typeof F[Pe.default]&&!Array.isArray(F))throw new TypeError("Expected statuses to be iterable, got "+Se(F));e.next=114;break;case 114:if(!F||"function"!=typeof F[Pe.default]&&!Array.isArray(F))throw new TypeError("Expected statuses to be iterable, got "+Me(F));e.next=116;break;case 116:for(q=!(D=!0),L=void 0,e.prev=119,B=(0,Ce.default)(F);!(D=(K=B.next()).done);D=!0)Z=K.value,this.__injectMessageStatus($,Z);e.next=127;break;case 123:e.prev=123,e.t3=e.catch(119),q=!0,L=e.t3;case 127:e.prev=127,e.prev=128,!D&&B.return&&B.return();case 130:if(e.prev=130,q)throw L;e.next=133;break;case 133:return e.finish(130);case 134:return e.finish(127);case 135:m[U]=$;case 136:z=!0,e.next=102;break;case 139:e.next=145;break;case 141:e.prev=141,e.t4=e.catch(100),C=!0,P=e.t4;case 145:e.prev=145,e.prev=146,!z&&V.return&&V.return();case 148:if(e.prev=148,C)throw P;e.next=151;break;case 151:return e.finish(148);case 152:return e.finish(145);case 153:w=!0,e.next=61;break;case 156:e.next=162;break;case 158:e.prev=158,e.t5=e.catch(59),_=!0,x=e.t5;case 162:e.prev=162,e.prev=163,!w&&E.return&&E.return();case 165:if(e.prev=165,_)throw x;e.next=168;break;case 168:return e.finish(165);case 169:return e.finish(162);case 170:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Se(t));e.next=172;break;case 172:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Me(t));e.next=174;break;case 174:W=!(H=!0),X=void 0,e.prev=177,Q=(0,Ce.default)(t);case 179:if(H=(Y=Q.next()).done){e.next=219;break}if(J=Y.value,d=J.includeUsers,ee=J.message,te=!1,!ee||b[ee.serverId])return e.abrupt("continue",216);e.next=185;break;case 185:if(ne=ee.recipientOrganizationId,re=ee.shouldEnsureRecipientStatus,ae=ee.statusesPerRecipient,!d){e.next=214;break}if(oe=[],!ae||"function"!=typeof ae[Pe.default]&&!Array.isArray(ae))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(ae));e.next=190;break;case 190:if(!ae||"function"!=typeof ae[Pe.default]&&!Array.isArray(ae))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Me(ae));e.next=192;break;case 192:for(se=!(ie=!0),ue=void 0,e.prev=195,ce=(0,Ce.default)(ae);!(ie=(le=ce.next()).done);ie=!0)de=le.value,(fe=de.userId)&&oe.push(fe);e.next=203;break;case 199:e.prev=199,e.t6=e.catch(195),se=!0,ue=e.t6;case 203:e.prev=203,e.prev=204,!ie&&ce.return&&ce.return();case 206:if(e.prev=206,se)throw ue;e.next=209;break;case 209:return e.finish(206);case 210:return e.finish(203);case 211:return e.next=213,this.host.users.ensureUsers(oe,ne);case 213:te=!0;case 214:re&&(ee.shouldEnsureRecipientStatus=!1,te=!0),te&&this.host.models.Message.inject(ee);case 216:H=!0,e.next=179;break;case 219:e.next=225;break;case 221:e.prev=221,e.t7=e.catch(177),W=!0,X=e.t7;case 225:e.prev=225,e.prev=226,!H&&Q.return&&Q.return();case 228:if(e.prev=228,W)throw X;e.next=231;break;case 231:return e.finish(228);case 232:return e.finish(225);case 233:if(this.config.condensedReplays){e.next=258;break}if(!(me=(0,Re.default)(m))||"function"!=typeof me[Pe.default]&&!Array.isArray(me))throw new TypeError("Expected _Object$values to be iterable, got "+Se(me));e.next=237;break;case 237:if(!me||"function"!=typeof me[Pe.default]&&!Array.isArray(me))throw new TypeError("Expected _Object$values to be iterable, got "+Me(me));e.next=239;break;case 239:for(he=!(pe=!0),ye=void 0,e.prev=242,ge=(0,Ce.default)(me);!(pe=(ve=ge.next()).done);pe=!0)be=ve.value,Ke.MESSAGE_STATUS_ORDER[be.markedRecipientStatus]<Ke.MESSAGE_STATUS_ORDER[Be.MessageRecipientStatus.DELIVERED]&&this.markAsReceived(be);e.next=250;break;case 246:e.prev=246,e.t8=e.catch(242),he=!0,ye=e.t8;case 250:e.prev=250,e.prev=251,!pe&&ge.return&&ge.return();case 253:if(e.prev=253,he)throw ye;e.next=256;break;case 256:return e.finish(253);case 257:return e.finish(250);case 258:if(we=[],!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Se(t));e.next=261;break;case 261:if(!t||"function"!=typeof t[Pe.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Me(t));e.next=263;break;case 263:for(xe=!(_e=!0),Ee=void 0,e.prev=266,ke=(0,Ce.default)(t);!(_e=(Te=ke.next()).done);_e=!0)Ie=Te.value,Ae=Ie.id,Oe=m[Ae],we.push(Oe?Oe.statusesPerRecipient:null);e.next=274;break;case 270:e.prev=270,e.t9=e.catch(266),xe=!0,Ee=e.t9;case 274:e.prev=274,e.prev=275,!_e&&ke.return&&ke.return();case 277:if(e.prev=277,xe)throw Ee;e.next=280;break;case 280:return e.finish(277);case 281:return e.finish(274);case 282:return e.abrupt("return",we);case 283:case"end":return e.stop()}},e,this,[[15,37,41,49],[42,,44,48],[59,158,162,170],[64,,66,91],[74,78,82,90],[83,,85,89],[100,141,145,153],[119,123,127,135],[128,,130,134],[146,,148,152],[163,,165,169],[177,221,225,233],[195,199,203,211],[204,,206,210],[226,,228,232],[242,246,250,258],[251,,253,257],[266,270,274,282],[275,,277,281]])})),function(e){return y.apply(this,arguments)})}]),r((p=et).prototype,"__prepareGroupForUsers",[a],(0,ue.default)(p.prototype,"__prepareGroupForUsers"),p.prototype),r(p.prototype,"__prepareRoleP2PGroup",[o],(0,ue.default)(p.prototype,"__prepareRoleP2PGroup"),p.prototype),r(p.prototype,"find",[i],(0,ue.default)(p.prototype,"find"),p.prototype),r(p.prototype,"downloadAttachmentUrl",[s],(0,ue.default)(p.prototype,"downloadAttachmentUrl"),p.prototype),r(p.prototype,"downloadAttachment",[u],(0,ue.default)(p.prototype,"downloadAttachment"),p.prototype),r(p.prototype,"_downloadAttachmentBlobAndUrl",[c],(0,ue.default)(p.prototype,"_downloadAttachmentBlobAndUrl"),p.prototype),r(p.prototype,"findRecipientStatus",[l],(0,ue.default)(p.prototype,"findRecipientStatus"),p.prototype),r(p.prototype,"findRecipientStatusMulti",[d],(0,ue.default)(p.prototype,"findRecipientStatusMulti"),p.prototype),p);function et(){var e,t,g,n,r,a,o,i,s,u,v=this;(0,ve.default)(this,et);for(var c=arguments.length,l=Array(c),d=0;d<c;d++)l[d]=arguments[d];return t=g=(0,be.default)(this,(e=et.__proto__||(0,ge.default)(et)).call.apply(e,[this].concat(l))),g.DELETE_ON_READ_MS=6e4,g.__retrieveSentMessage=(u=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y=n.instance;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.message_id){e.next=3;break}throw new Error("Missing message_id from /message response");case 3:if(t.sort_number){e.next=16;break}return e.next=6,g.find(r,{instance:y,replace:!0});case 6:if(a=e.sent){e.next=13;break}return e.next=10,new he.default(function(e){return setTimeout(e,1e3)});case 10:return e.next=12,g.find(r,{instance:y,replace:!0});case 12:a=e.sent;case 13:a&&(y=a),e.next=32;break;case 16:if(void 0===t.is_forwarded&&(t.is_forwarded=!1),o=t.status||"New",g.__setDefaultAttributes(t,{instance:y}),(y=g.host.models.Message.replaceExisting(t,{instance:y})).$synced=void 0,s=(i=y).counterPartyType,u=i.createdAt,c=i.group,l=i.recipientId,f=(d=c||{}).groupType,p=d.p2pRecipient,h=void 0,f===Be.GroupType.ROLE_P2P&&p?h="role"===p.$entityType?p.botUserId:p.id:"user"===s&&(h=l),!h){e.next=29;break}g.__injectMessageStatus(y,{accountId:h,createdAt:u,status:o}),e.next=32;break;case 29:if(f===Be.GroupType.GROUP)return e.next=32,g.findRecipientStatus(y,{queue:!1});e.next=32;break;case 32:return e.abrupt("return",y);case 33:case"end":return e.stop()}},e,v)})),function(e,t){return u.apply(this,arguments)}),g.__generateAttachmentDescriptor=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));var t="local:"+qe.default.v4();"string"==typeof e||e instanceof Buffer||Ze.Validator.raise("attachment","invalid","attachment (string or Buffer) is invalid");var n=void 0,r=void 0,a=void 0,o=f(54),i=f(63),s=f(284),u=f(85);if("string"==typeof e)n=o.statSync(e).size,r=s.lookup(e),a=i.basename(e);else{var c=u(e);if(c)a="attachment."+c.ext,r=c.mime;n=e.byteLength}return{id:t,localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:a,size:n,contentType:r,isLocal:!0}},g.__retryApiSend=(s=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t)._originalBody,a=n.attachments,o=n.conversationId,i=n.counterPartyId,s=n.deleteOnRead,u=n.id,c=n.metadata,l=n.priority,d=n.recipientOrganizationId,f=n.senderOrganizationId,p=n.shouldEscalate,h=n.ttl,e.prev=1,e.next=4,g.host.api.messages.send({attachment:(0,Ie.default)(a,"0.localFile"),body:r,conversationId:o,counterPartyId:i,deleteOnRead:s,escalate:p,localId:u,metadata:c,priority:Be.MessagePriority.toServer(l),recipientOrganizationId:d,senderOrganizationId:f,ttl:h});case 4:return y=e.sent,g.host.config.condensedReplays&&y.last_message&&(y=y.last_message),e.next=8,g.__retrieveSentMessage(y,{instance:t});case 8:t=e.sent,g.host.emit("message:sent",t),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(1),g.logger.warn("error while sending message",e.t0),t.senderStatus=Be.MessageSenderStatus.FAILED,g.host.models.Message.inject(t);case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}},e,v,[[1,12]])})),function(e){return s.apply(this,arguments)}),g.__retryApiForward=(i=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t).conversationId,a=n.counterPartyId,o=n.id,i=n.metadata,s=n.originalMessageId,u=n.priority,c=n.recipientOrganizationId,l=n.senderOrganizationId,e.prev=1,e.next=4,g.host.api.messages.forward(s,a,{conversationId:r,localId:o,metadata:i,priority:Be.MessagePriority.toServer(u),recipientOrganizationId:c,senderOrganizationId:l});case 4:return d=e.sent,f=d.message_id,e.next=8,g.find(f,{instance:t,replace:!0});case 8:t=e.sent,g.host.emit("message:sent",t),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(1),g.logger.error("error while forwarding message",e.t0),t.senderStatus=Be.MessageSenderStatus.FAILED,g.host.models.Message.inject(t);case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}},e,v,[[1,12]])})),function(e){return i.apply(this,arguments)}),g._resolveMessage=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Me(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));return g.host.models.Message.is(e)?e:"string"==typeof e?g.host.models.Message.get(e):null},g._looksLikeDistributionListMessage=function(e){var t=e.body;if(!t)return!1;var n=t.match(/^\[(.+?)\]: /);return!!n&&n[1]},g.__setDefaultAttributes=function(e,t){var n=t.instance,r={is_forwarded:n.isForwarded,attachments:n.attachments,conversationId:n.conversationId,counterParty:n.counterParty,senderStatus:Be.MessageSenderStatus.SENT,shouldEscalate:!1};return n.isForwarded&&(r.originalForwardedMessageCreatedAt=n.originalForwardedMessageCreatedAt,r.originalMessageId=n.originalMessageId,n.originalSender&&(r.originalSender=n.originalSender)),(0,Te.default)(e,r),e},g.__flushSetMessageStatusesQueue=function(){if(0<g._queuedSetMessageStatuses.deliveredIds.length+g._queuedSetMessageStatuses.readIds.length){var e=g._queuedSetMessageStatuses;g._queuedSetMessageStatuses={deliveredIds:[],readIds:[]},g.__setMessagesStatus(e)}},g._onTick=function(){g._deleteExpiredMessages(),g._deleteExpiredMutes(),g.config.condensedReplays&&g._clearOptimisticMarkAsReadState()},g._deleteExpiredMessages=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();if(e.getTime&&(e=e.getTime()),!(i=g.host.organizations.getAll())||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g2 to be iterable, got "+Se(i));if(!i||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g2 to be iterable, got "+Me(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Ce.default)(i);!(t=(a=o.next()).done);t=!0)for(var i,s=a.value.__expirableMessages,u=!1;!u&&0<s.length;){var c=s[0];c.expiresAt<e?g.host.models.Message.eject(c):u=!0}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},g._deleteExpiredMutes=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();if(e.getTime&&(e=e.getTime()),!(i=g.host.organizations.getAll())||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g3 to be iterable, got "+Se(i));if(!i||"function"!=typeof i[Pe.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g3 to be iterable, got "+Me(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Ce.default)(i);!(t=(a=o.next()).done);t=!0)for(var i,s=a.value.__expirableMutes,u=!1;!u&&0<s.length;){var c=s[0];if(c.expiresAt<e){g.host.models.Mute.eject(c);var l=g.host.models.Conversation.get(c.conversationId);if(!l)continue;l.muted=null,g.host.models.Conversation.inject(l)}else u=!0}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},g._onChangeMessageStatus=function(e,t){var n=t.messageId,r=g.host.models.Message.get(n);r&&g.host.models.Message.inject(r)},g._fetchAttachmentTokens=function(){var t,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20;if(void 0!==o&&"number"!=typeof o)throw new TypeError('Value of optional argument "count" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Me(o));if(void 0!==o&&"number"!=typeof o)throw new TypeError('Value of optional argument "count" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Se(o));return g._fetchingAttachmentTokens||(g._fetchingAttachmentTokens=new he.default((t=(0,ye.default)(Ve.default.mark(function e(t){var n,r,a;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.host.api.messages.createAttachmentTokens(o);case 3:r=e.sent,a=r.attachment_tokens,(n=g._attachmentTokens).push.apply(n,(0,pe.default)(a)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),g.logger.error("error while requesting attachment tokens",e.t0);case 11:g._fetchingAttachmentTokens=null,t();case 13:case"end":return e.stop()}},e,v,[[0,8]])})),function(e){return t.apply(this,arguments)}))),g._fetchingAttachmentTokens},g._useAttachmentToken=(o=(0,ye.default)(Ve.default.mark(function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n&&"number"!=typeof n)throw new TypeError('Value of optional argument "count" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Me(n));e.next=2;break;case 2:if(void 0!==r&&"number"!=typeof r)throw new TypeError('Value of optional argument "retries" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Me(r));e.next=4;break;case 4:if(void 0!==n&&"number"!=typeof n)throw new TypeError('Value of optional argument "count" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Se(n));e.next=6;break;case 6:if(void 0!==r&&"number"!=typeof r)throw new TypeError('Value of optional argument "retries" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Se(r));e.next=8;break;case 8:if(3<r)throw new Error("Attachment tokens can not be fetched at this time.");e.next=10;break;case 10:if(g._attachmentTokens.length<n)return e.next=13,g._fetchAttachmentTokens(n);e.next=13;break;case 13:if(t=g._attachmentTokens.shift()){e.next=18;break}return e.next=17,g._useAttachmentToken(n,++r);case 17:return e.abrupt("return",e.sent);case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}},e,v)})),function(){return o.apply(this,arguments)}),g.getAttachmentUrlWithToken=(a=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("boolean"!=typeof i)throw new TypeError('Value of argument "includeBaseUrl" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+Me(i));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if("boolean"!=typeof i)throw new TypeError('Value of argument "includeBaseUrl" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+Se(i));e.next=12;break;case 12:return r=g._resolveMessage(t),e.next=15,g.findAttachment(r.serverId,n);case 15:return a=e.sent,e.next=18,g._useAttachmentToken();case 18:return o=e.sent,e.abrupt("return",""+(i?g.host.config.baseUrl:"")+g.__getAttachmentPath(r.serverId,a.id)+"?token="+o);case 20:case"end":return e.stop()}},e,v)})),function(e,t){return a.apply(this,arguments)}),g.openAttachmentWithToken=(r=(0,ye.default)(Ve.default.mark(function e(t,n){var r,a,o;return Ve.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Me(t));e.next=2;break;case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Me(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=6;break;case 6:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=8;break;case 8:return r=n.toString(),a=g._resolveMessage(t),e.next=12,g.findAttachment(t,r);case 12:if(e.sent){e.next=15;break}throw new Le.NotFoundError("MessageAttachment",a.serverId+":"+r);case 15:return e.next=17,g.getAttachmentUrlWithToken(a.serverId,r);case 17:o=e.sent,window.open(g.host.config.baseUrl+o,"_blank");case 19:case"end":return e.stop()}},e,v)})),function(e,t){return r.apply(this,arguments)}),n=t,(0,be.default)(g,n)}t.default=Je,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,y.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function E(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,y.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=E(t[0],n);return t.every(function(e){return E(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return E(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+E(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h=r(n(3)),y=r(n(5)),g=r(n(11)),v=r(n(30)),m=r(n(29)),k=r(n(10)),T=r(n(19)),I=r(n(12)),b=r(n(18)),A=r(n(13)),O=r(n(22)),w=r(n(4)),_=r(n(9)),j=r(n(16)),S=r(n(6)),M=r(n(1)),R=r(n(2)),z=r(n(8)),C=r(n(7)),P=r(n(254)),V=r(n(57)),G=r(n(60)),N=r(n(25)),U=r(n(15)),F=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),$=n(20),D=n(23),q=(o=(0,$.decorator)(),i=(0,$.decorator)(),u=U.default,(0,C.default)(L,u),(0,R.default)(L,[{key:"fullUpdate",value:(p=(0,_.default)(k.default.mark(function e(t,n,r){var a,o,i,s,u,c,l,d;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+E(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+E(n));case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(r));e.next=6;break;case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+x(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+x(n));case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(r));e.next=12;break;case 12:if(r){e.next=14;break}throw new F.ValidationError("organizationId","required");case 14:if(0<this.host.config.maxMetadataKeyCount&&(0,w.default)(n).length>this.host.config.maxMetadataKeyCount)throw new F.ValidationError("entireData","invalid","Total number of metadata keys is "+(0,w.default)(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);e.next=16;break;case 16:if(!(c=(0,O.default)(n))||"function"!=typeof c[A.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+x(c));e.next=19;break;case 19:if(!c||"function"!=typeof c[A.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+E(c));e.next=21;break;case 21:o=!(a=!0),i=void 0,e.prev=24,s=(0,I.default)(c);case 26:if(a=(u=s.next()).done){e.next=33;break}if(l=(0,T.default)(u.value,2),d=l[0],"string"!=typeof l[1])throw new F.ValidationError("value","invalid","Value for metadata key "+d+" must be a string");e.next=30;break;case 30:a=!0,e.next=26;break;case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(24),o=!0,i=e.t0;case 39:e.prev=39,e.prev=40,!a&&s.return&&s.return();case 42:if(e.prev=42,o)throw i;e.next=45;break;case 45:return e.finish(42);case 46:return e.finish(39);case 47:return this.host.requireUser(),t=this._resolveModelId(t),e.prev=49,e.next=52,this.host.api.metadata.update(t,n,r);case 52:return this.__injectMetadata(t,r,n),e.abrupt("return",n);case 56:if(e.prev=56,e.t1=e.catch(49),e.t1.response&&404===e.t1.response.status)throw new F.NotFoundError("metadata",t);e.next=62;break;case 62:return e.abrupt("return",b.default.reject(e.t1));case 63:case"end":return e.stop()}},e,this,[[24,35,39,47],[40,,42,46],[49,56]])})),function(e,t,n){return p.apply(this,arguments)})},{key:"update",value:(f=(0,_.default)(k.default.mark(function e(t,n,r){var a,o;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+E(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+E(n));case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(r));e.next=6;break;case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+x(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+x(n));case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(r));e.next=12;break;case 12:if(r){e.next=14;break}throw new F.ValidationError("organizationId","required");case 14:return e.next=16,this.find(t,r,{bypassCache:!0});case 16:return a=e.sent,o=(0,m.default)({},a,n),e.abrupt("return",this.fullUpdate(t,o,r));case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return f.apply(this,arguments)})},{key:"find",value:(d=(0,_.default)(k.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+E(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+x(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new F.ValidationError("organizationId","required");case 10:if(a=(0,N.default)(a,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),t=this._resolveModelId(t),r=void 0,a.bypassCache){e.next=18;break}if(r=this.get(t,n))return e.abrupt("return",r);e.next=18;break;case 18:return e.prev=18,e.next=21,this.host.api.metadata.find(t,n);case 21:return r=e.sent,this.__injectMetadata(t,n,r),e.abrupt("return",r);case 26:if(e.prev=26,e.t0=e.catch(18),!e.t0.response||404!==e.t0.response.status){e.next=33;break}if(a.ignoreNotFound){e.next=31;break}throw new F.NotFoundError("metadata",t);case 31:e.next=34;break;case 33:return e.abrupt("return",b.default.reject(e.t0));case 34:case"end":return e.stop()}},e,this,[[18,26]])})),function(e,t){return d.apply(this,arguments)})},{key:"findMulti",value:(l=(0,_.default)(k.default.mark(function e(t,n){var r,a,o,i,s=this,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+E(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+x(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new F.ValidationError("organizationId","required");case 10:return this.host.requireUser(),t=(0,G.default)((0,D.arrayWrap)(t).map(this._resolveModelId)),r=(0,V.default)(t,20),a=r.map(function(e){return s.__findMultiPaged(e,n,u)}),e.next=16,b.default.all(a);case 16:return o=e.sent,i=P.default.apply(void 0,[{}].concat((0,v.default)(o))),e.abrupt("return",i);case 19:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"__findMultiPaged",value:(c=(0,_.default)(k.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+E(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+x(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:return e.next=10,this.host.api.entities.findMulti({users:[],metadata:t,organizationId:n});case 10:if(r=e.sent,a=r.metadata,o={},!a||"function"!=typeof a[A.default]&&!Array.isArray(a))throw new TypeError("Expected allMetadata to be iterable, got "+x(a));e.next=15;break;case 15:if(!a||"function"!=typeof a[A.default]&&!Array.isArray(a))throw new TypeError("Expected allMetadata to be iterable, got "+E(a));e.next=17;break;case 17:s=!(i=!0),u=void 0,e.prev=20,c=(0,I.default)(a);case 22:if(i=(l=c.next()).done){e.next=60;break}if(d=l.value,!(v=(0,O.default)(d))||"function"!=typeof v[A.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+x(v));e.next=27;break;case 27:if(!v||"function"!=typeof v[A.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+E(v));e.next=29;break;case 29:p=!(f=!0),h=void 0,e.prev=32,y=(0,I.default)(v);case 34:if(f=(g=y.next()).done){e.next=43;break}if(m=(0,T.default)(g.value,2),b=m[0],w=m[1]){e.next=38;break}return e.abrupt("continue",40);case 38:_=this.__injectMetadata(b,n,w),o[b]=_;case 40:f=!0,e.next=34;break;case 43:e.next=49;break;case 45:e.prev=45,e.t0=e.catch(32),p=!0,h=e.t0;case 49:e.prev=49,e.prev=50,!f&&y.return&&y.return();case 52:if(e.prev=52,p)throw h;e.next=55;break;case 55:return e.finish(52);case 56:return e.finish(49);case 57:i=!0,e.next=22;break;case 60:e.next=66;break;case 62:e.prev=62,e.t1=e.catch(20),s=!0,u=e.t1;case 66:e.prev=66,e.prev=67,!i&&c.return&&c.return();case 69:if(e.prev=69,s)throw u;e.next=72;break;case 72:return e.finish(69);case 73:return e.finish(66);case 74:return e.abrupt("return",o);case 75:case"end":return e.stop()}},e,this,[[20,62,66,74],[32,45,49,57],[50,,52,56],[67,,69,73]])})),function(e,t){return c.apply(this,arguments)})},{key:"get",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));var n="metadata:"+e+":"+t;return this.host.models.Metadata.get(n)||null}},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+E(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+E(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+x(n));var r="metadata:"+e+":"+t;return this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),a((s=L).prototype,"find",[o],(0,g.default)(s.prototype,"find"),s.prototype),a(s.prototype,"findMulti",[i],(0,g.default)(s.prototype,"findMulti"),s.prototype),s);function L(){var e,t,n,r;(0,M.default)(this,L);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=n=(0,z.default)(this,(e=L.__proto__||(0,S.default)(L)).call.apply(e,[this].concat(o))),n.__parseMessageMetadata=function(e){var t=e.mimetype,n=e.payload,r=t.indexOf(";");if(-1<r&&(t=t.slice(0,r)),"application/json"!==t||"string"!=typeof n)return e;var a=void 0;try{a=JSON.parse(n)}catch(t){return console.warn("Invalid metadata payload",e),null}return(0,j.default)({},e,{payload:a})},r=t,(0,z.default)(n,r)}t.default=q,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,R.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function y(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=y(t[0],n);return t.every(function(e){return y(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return y(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,R.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+y(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,g,v,m,b=r(n(3)),w=r(n(5)),_=r(n(11)),x=r(n(10)),E=r(n(38)),k=r(n(12)),T=r(n(13)),I=r(n(9)),A=r(n(6)),O=r(n(1)),j=r(n(2)),S=r(n(8)),M=r(n(7)),R=r(n(4)),z=r(n(232)),C=n(20),P=n(23),V=r(n(15)),G={account:"user",group:"group"},N=new z.default((0,R.default)(G)),U=(a=(0,C.decorator)(),f=V.default,(0,M.default)(F,f),(0,j.default)(F,[{key:"mounted",value:function(){this._fetched=!1,this._muteEntriesByConversationHandle={}}},{key:"dispose",value:function(){this._fetched=!1,this._muteEntriesByConversationHandle=null}},{key:"findAll",value:(m=(0,I.default)(x.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched){e.next=37;break}return e.next=3,this.host.api.mute.findAll();case 3:if(!(t=e.sent)||"function"!=typeof t[T.default]&&!Array.isArray(t))throw new TypeError("Expected muteEntries to be iterable, got "+h(t));e.next=6;break;case 6:if(!t||"function"!=typeof t[T.default]&&!Array.isArray(t))throw new TypeError("Expected muteEntries to be iterable, got "+y(t));e.next=8;break;case 8:r=!(n=!0),a=void 0,e.prev=11,o=(0,k.default)(t);case 13:if(n=(i=o.next()).done){e.next=22;break}if(s=i.value,N.has(s.sender_type)){e.next=17;break}return e.abrupt("continue",19);case 17:u=this._parseMuteEntry(s),c=u.conversationId,l=u.entry,this._addEntry(c,l);case 19:n=!0,e.next=13;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(11),r=!0,a=e.t0;case 28:e.prev=28,e.prev=29,!n&&o.return&&o.return();case 31:if(e.prev=31,r)throw a;e.next=34;break;case 34:return e.finish(31);case 35:return e.finish(28);case 36:this._fetched=!0;case 37:return e.abrupt("return",(0,E.default)(this._muteEntriesByConversationHandle));case 38:case"end":return e.stop()}},e,this,[[11,24,28,36],[29,,31,35]])})),function(){return m.apply(this,arguments)})},{key:"_removeAllEntries",value:function(){if(this.config.condensedReplays){if(!(o=this.host.conversations.getAll())||"function"!=typeof o[T.default]&&!Array.isArray(o))throw new TypeError("Expected _host$conversations$g to be iterable, got "+h(o));if(!o||"function"!=typeof o[T.default]&&!Array.isArray(o))throw new TypeError("Expected _host$conversations$g to be iterable, got "+y(o));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,k.default)(o);!(e=(r=a.next()).done);e=!0){var o,i=r.value;i.muted&&this._removeEntry(i.id)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}else{if(!(f=(0,R.default)(this._muteEntriesByConversationHandle))||"function"!=typeof f[T.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$keys to be iterable, got "+h(f));if(!f||"function"!=typeof f[T.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$keys to be iterable, got "+y(f));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,k.default)(f);!(s=(l=d.next()).done);s=!0){var f,p=l.value;this._removeEntry(p)}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}}},{key:"_getByConversationHandle",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationHandle" violates contract.\n\nExpected:\nstring\n\nGot:\n'+y(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationHandle" violates contract.\n\nExpected:\nstring\n\nGot:\n'+h(e));var t=this._muteEntriesByConversationHandle[e];return t?t.expiresAt<Date.now()?(delete this._muteEntriesByConversationHandle[e],null):t:null}},{key:"unmuteAll",value:(v=(0,I.default)(x.default.mark(function e(){return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.mute.unmuteAll();case 2:this._removeAllEntries();case 3:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"muteConversation",value:(g=(0,I.default)(x.default.mark(function e(t,n){var r,a,o,i;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+y(t));case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+y(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+h(t));case 6:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+h(n));e.next=8;break;case 8:if(this.__validateDurationInMinutes(n),t=this._resolveModelId(t),r=this._resolveEntity(t,"conversation")){e.next=13;break}throw new Error("conversation "+t+" not found");case 13:if(t=r.id,a=r.counterPartyId,o=r.counterPartyType,i=r.organizationId,"user"===o)return e.next=18,this.host.api.mute.muteUser(a,n,i,{recipientOrganizationId:i});e.next=21;break;case 18:this._addEntry(t,{durationInMinutes:n,organizationId:i}),e.next=25;break;case 21:if("group"===o)return e.next=24,this.host.api.mute.muteGroup(a,n,i);e.next=25;break;case 24:this._addEntry(t,{durationInMinutes:n,organizationId:i});case 25:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"unmuteConversation",value:(p=(0,I.default)(x.default.mark(function e(t){var n,r,a,o;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+y(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+h(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new Error("conversation "+t+" not found");case 7:if(t=n.id,r=n.counterPartyId,a=n.counterPartyType,o=n.organizationId,"user"===a)return e.next=12,this.host.api.mute.unmuteUser(r,o,{recipientOrganizationId:o});e.next=15;break;case 12:this._removeEntry(t),e.next=19;break;case 15:if("group"===a)return e.next=18,this.host.api.mute.unmuteGroup(r,o);e.next=19;break;case 18:this._removeEntry(t);case 19:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"reactToMuteEvent",value:function(e){var t=e.data;if((t=(0,P.jsonCloneDeep)(t)).token===this.host.currentUser.id){var n=t.action;if("clear"===n)return void this._removeAllEntries();var r=this._parseMuteEntry(t),a=r.conversationId,o=r.entry;"add"===n?this._addEntry(a,o):this._removeEntry(a)}}},{key:"getById",value:function(e){return e.startsWith("mute:")||(e="mute:"+e),this.host.models.Mute.get(e)}},{key:"__validateDurationInMinutes",value:function(e){if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+y(e));if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+h(e));(e<0||525600<e||e%1!=0)&&P.Validator.raise("durationInMinutes","invalid","should be a positive integer from 1 to 525600 (1 year)")}}]),i=(o=F).prototype,s="findAll",u=[a],c=(0,_.default)(o.prototype,"findAll"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function F(){var e,t,c,n;(0,O.default)(this,F);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=c=(0,S.default)(this,(e=F.__proto__||(0,A.default)(F)).call.apply(e,[this].concat(a))),c._parseMuteEntry=function(e){var t=+e.mute_duration,n=e.mute_start,r=e.caller_organization||e.organization_id;n=n&&1e3*+n;var a=void 0;if(c.config.condensedReplays)a=e.conversation_id;else{var o=G[e.sender_type],i=e.sender_token;a=c.host.conversations.getConversationKey(o,i,r)}return{conversationId:a,entry:{durationInMinutes:t,organizationId:r,startedAt:n}}},c._addEntry=function(e,t){var n=t.durationInMinutes,r=t.organizationId,a=t.startedAt,o=void 0===a?Date.now():a,i=+o+60*n*1e3;if(!(i<Date.now())){var s=c.host.models.Mute.inject({id:"mute:"+e,conversationId:e,durationInMinutes:n,expiresAt:i,organizationId:r,startedAt:o});if(c.config.condensedReplays){var u=c.host.conversations.getById(e);if(!u)return s;u.muted=s,c.host.models.Conversation.inject(u)}else c._muteEntriesByConversationHandle[e]=s,c.host.models.Conversation.touch(e);return s}},c._removeEntry=function(e){c.config.condensedReplays||delete c._muteEntriesByConversationHandle[e];var t=c.host.conversations.getById(e);t&&t.muted&&(c.host.models.Mute.eject(t.muted),t.muted=null,c.host.models.Conversation.inject(t))},n=t,(0,S.default)(c,n)}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i=r(n(3)),s=r(n(4)),u=r(n(5)),x=r(n(19)),E=r(n(12)),k=r(n(13)),T=r(n(22)),I=r(n(31)),A=r(n(6)),O=r(n(1)),o=r(n(2)),j=r(n(8)),c=r(n(7)),l=r(n(15)),d=(a=l.default,(0,c.default)(S,a),(0,o.default)(S,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.info("unhandled event: "+e.type,e.data)}}]),S);function S(e,t){var n;(0,O.default)(this,S);var r=(0,j.default)(this,(S.__proto__||(0,A.default)(S)).call(this,e,t));if(r.EVENTS=(n={},(0,I.default)(n,"message|group_message",function(e){this.host.notifications.reactToMessageEvent(e)}),(0,I.default)(n,"message:status|group:message:status",function(e){this.host.notifications.reactToMessageStatusEvent(e)}),(0,I.default)(n,"remote_wipe",function(e){this.host.notifications.disconnect({source:"Notifications remote_wipe"}),this.host.notifications.signOut({fromServer:!0})}),(0,I.default)(n,"sse:heartbeat",function(){return null}),n),!(c=(0,T.default)(r.EVENTS))||"function"!=typeof c[k.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+w(c));if(!c||"function"!=typeof c[k.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+_(c));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,E.default)(c);!(a=(s=u.next()).done);a=!0){var c,l=(0,x.default)(s.value,2),d=l[0],f=l[1];if(d.includes("|")){if(!(m=d.split("|"))||"function"!=typeof m[k.default]&&!Array.isArray(m))throw new TypeError("Expected _eventName$split to be iterable, got "+w(m));if(!m||"function"!=typeof m[k.default]&&!Array.isArray(m))throw new TypeError("Expected _eventName$split to be iterable, got "+_(m));var p=!0,h=!1,y=void 0;try{for(var g,v=(0,E.default)(m);!(p=(g=v.next()).done);p=!0){var m,b=g.value;r.EVENTS[b]=f}}catch(e){h=!0,y=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw y}}delete r.EVENTS[d]}}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}return r}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i,s,u,c,l,d,f,p,h,y,g,v,m=r(n(11)),b=r(n(18)),w=r(n(10)),_=r(n(9)),x=r(n(16)),E=r(n(6)),k=r(n(1)),T=r(n(2)),I=r(n(8)),A=r(n(7)),O=n(20),j=r(n(64)),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),M=r(n(82)),R=r(n(15)),z=r(n(79)),C=(a=(0,O.decorator)({serializeArguments:function(e){return""}}),h=R.default,(0,A.default)(P,h),(0,T.default)(P,[{key:"mounted",value:function(){this.events.mounted(),this.events.on("connected",this._emitConnected),this.events.on("disconnected",this._emitDisconnected),this.events.on("event",this._emitEvent)}},{key:"dispose",value:function(){this.events.removeListener("connected",this._emitConnected),this.events.removeListener("disconnected",this._emitDisconnected),this.events.removeListener("event",this._emitEvent),this.events.dispose()}},{key:"signIn",value:(v=(0,_.default)(w.default.mark(function e(){var t,n,r;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.host.getAuth())&&t.key&&t.secret){e.next=3;break}throw new S.RequiresBasicAuthError;case 3:if(this.emit("signingIn"),this.events.isSignedIn){e.next=9;break}return e.next=7,this.host.api.notifications.signIn(t.key,t.secret);case 7:n=e.sent,this.events.setAuth(n);case 9:return r=this.events.getAuth(),this.emit("signedIn",r),e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"signOut",value:(g=(0,_.default)(w.default.mark(function e(){var t,n,r=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).fromServer,a=void 0!==r&&r;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.events.getAuth()){e.next=3;break}return e.abrupt("return",!1);case 3:return this.emit("signingOut",{fromServer:a}),n=void 0,e.prev=5,e.next=8,this.host.api.notifications.signOut(t.key,t.secret);case 8:n=!0,e.next=22;break;case 11:if(e.prev=11,e.t0=e.catch(5),!this.httpClient.isUnauthorizedError(e.t0)){e.next=17;break}n=!0,e.next=22;break;case 17:if(!a){e.next=21;break}this.logger.error("error while logging out of desktop notifications",e.t0,e.t0.stack),e.next=22;break;case 21:return e.abrupt("return",b.default.reject(e.t0));case 22:return n&&this.events.removeAuth(),this.emit("signedOut",{fromServer:a,signedOut:n}),e.abrupt("return",n);case 25:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return g.apply(this,arguments)})},{key:"authenticate",value:(y=(0,_.default)(w.default.mark(function e(t,n){return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.events.setAuth({key:t,secret:n});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"connect",value:function(){return this.events.connect()}},{key:"disconnect",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).source;return this.events.disconnect({source:e})}},{key:"reconnect",value:function(){return this.events.reconnect()}},{key:"reactToMessageEvent",value:function(e){var t=e.data;t=(0,M.default)(t);var n=this.host.models.Message.createInstance((0,x.default)({},t,{id:j.default.v4()}));this.emit("unread:change",n.unreadMessageCount),this.emit("message",n)}},{key:"reactToMessageStatusEvent",value:function(e){this.emit("unread:change",e.unread_message_count)}},{key:"isSignedIn",get:function(){return this.events.isSignedIn}},{key:"hasConnection",get:function(){return this.events.hasConnection}},{key:"isConnected",get:function(){return this.events.isConnected}},{key:"isOpen",get:function(){return this.events.isOpen}}]),i=P,s=function(){var t=this;this._emitConnected=function(){t.emit("connected")},this._emitDisconnected=function(e){t.emit("disconnected",e)},this._emitEvent=function(e){t.emit("event",e)}},u=(o=i).prototype,c="signOut",l=[a],d=(0,m.default)(o.prototype,"signOut"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(u,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(u,c,p),p=null),o);function P(e,t){(0,k.default)(this,P);var n=(0,I.default)(this,(P.__proto__||(0,E.default)(P)).call(this,e,t));return s.call(n),n.events=new z.default(e,(0,x.default)({},t,{endpointType:"simpleNotifications"})),n}t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,E.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,E.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,_=r(n(3)),x=r(n(4)),E=r(n(5)),k=r(n(11)),T=r(n(19)),I=r(n(22)),A=r(n(16)),O=r(n(10)),j=r(n(9)),S=r(n(12)),M=r(n(30)),R=r(n(13)),z=r(n(6)),C=r(n(1)),P=r(n(2)),V=r(n(8)),G=r(n(7)),N=r(n(25)),U=r(n(280)),F=r(n(258)),$=r(n(15)),D=n(20),q=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),L=r(n(93)),B=r(n(27)),K=(o=(0,D.decorator)(),i=(0,D.decorator)(),s=(0,D.decorator)({memoize:!0}),u=(0,D.decorator)(),l=$.default,(0,G.default)(Z,l),(0,P.default)(Z,[{key:"mounted",value:function(){this._deferConversationChanges=!1,this._lastMyRoles=[],this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onChangeConversation),this.host.models.User.on("afterInject",this._onChangeUser)}},{key:"dispose",value:function(){this._deferConversationChanges=!1,this._lastMyRoles=[],this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onChangeConversation),this.host.models.User.removeListener("afterInject",this._onChangeUser),D.decorator.clear(this._findAll)}},{key:"create",value:(m=(0,j.default)(O.default.mark(function e(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{allowPublicGroups:void 0,autologoutTime:void 0,deleteOnRead:void 0,groupLifespan:void 0,lifecycleCallback:void 0,name:void 0,pinLock:void 0,settingsRestricted:void 0,ttl:void 0,welcomeEmailSettings:void 0};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.abrupt("return",this.httpClient.post("/v2/organization",{data:r}).then(function(e){var t=e.getHeader("TT-X-Organization-Key");return n.host.models.Organization.inject({id:t,name:r.name})}));case 2:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"update",value:(v=(0,j.default)(O.default.mark(function e(){var t,n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{allowPublicGroups:void 0,autologoutTime:void 0,autoSendWelcomeEmail:void 0,deleteOnRead:void 0,groupLifespan:void 0,id:void 0,lifecycleCallback:void 0,name:void 0,pinLock:void 0,settingsRestricted:void 0,ttl:void 0,welcomeEmailLogo:void 0,welcomeEmailSettings:void 0};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),t=B.default.underscoreObject({allowPublicGroups:r.allowPublicGroups,autologoutTime:r.autologoutTime,autoSendWelcomeEmail:r.autoSendWelcomeEmail,dor:r.deleteOnRead,groupLifespan:r.groupLifespan,lifecycleCallback:r.lifecycleCallback,name:r.name,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,ttl:r.ttl,welcomeEmailLogo:r.welcomeEmailLogo,welcomeEmailSettings:r.welcomeEmailSettings}),e.abrupt("return",this.httpClient.post("/v2/organization/:id",{urlParams:{id:r.id},data:t}).then(function(e){return n.host.models.Organization.inject((0,A.default)({id:r.id},t))}));case 3:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"findAll",value:(g=(0,j.default)(O.default.mark(function e(){var t,n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=r.filter,o=void 0===a?{onlyApproved:!1}:a,i=r.findRoles,s=void 0===i||i;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.next=3,this._findAll();case 3:if(t=e.sent,s)return e.next=7,this.host.userRoles.findAll();e.next=7;break;case 7:return o.onlyApproved&&(t=(0,F.default)(t,{pending:!1})),(t=(0,U.default)(t,function(e){return e.name.toLowerCase()})).forEach(function(e){return n.__reloadConversations(e)}),e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"refreshAll",value:(y=(0,j.default)(O.default.mark(function e(){var t;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return D.decorator.clear(this._findAll),e.next=3,this._findAll();case 3:return t=e.sent,e.next=6,this.host.userRoles.refreshAll();case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"_findAll",value:(h=(0,j.default)(O.default.mark(function e(){var t,n,r,a,o,i,s,u,c;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.organizations.findAllOfUser(this.host.currentUserId);case 2:if(t=e.sent,n=[],!t||"function"!=typeof t[R.default]&&!Array.isArray(t))throw new TypeError("Expected items to be iterable, got "+b(t));e.next=6;break;case 6:if(!t||"function"!=typeof t[R.default]&&!Array.isArray(t))throw new TypeError("Expected items to be iterable, got "+w(t));e.next=8;break;case 8:for(a=!(r=!0),o=void 0,e.prev=11,i=(0,S.default)(t);!(r=(s=i.next()).done);r=!0)u=s.value,c=this.host.models.Organization.inject(u),this.host.models.Organization.removePlaceholder({entity:c,attrs:u}),n.push(c);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),a=!0,o=e.t0;case 19:e.prev=19,e.prev=20,!r&&i.return&&i.return();case 22:if(e.prev=22,a)throw o;e.next=25;break;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return",n);case 28:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])})),function(){return h.apply(this,arguments)})},{key:"find",value:(p=(0,j.default)(O.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=4;break;case 4:if(a=(0,N.default)(a,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=void 0,a.bypassCache){e.next=11;break}if((n=this.host.models.Organization.get(t))&&!n.$placeholder)return e.abrupt("return",n);e.next=11;break;case 11:return e.next=13,this.host.api.organizations.find(this.host.currentUserId,t);case 13:return r=e.sent,e.next=16,this.host.userRoles.findAll({organizationId:t});case 16:if(!r){e.next=21;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),e.next=23;break;case 21:if(a.ignoreNotFound){e.next=23;break}throw new q.NotFoundError(this.host.models.Organization.name,t);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"_getAllowedSenders",value:function(e){var t=e.id,n=[],r=this.host.currentUser;if(r){var a=r.roles;if(!a||"function"!=typeof a[R.default]&&!Array.isArray(a))throw new TypeError("Expected currentRoles to be iterable, got "+b(a));if(!a||"function"!=typeof a[R.default]&&!Array.isArray(a))throw new TypeError("Expected currentRoles to be iterable, got "+w(a));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,S.default)(a);!(o=(u=c.next()).done);o=!0){var l=u.value;l.organizationId===t&&n.push(l)}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}n.push(r)}return n}},{key:"getPendingEulas",value:(f=(0,j.default)(O.default.mark(function e(){var t,n;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findAll();case 2:return t=e.sent,n=t.filter(function(e){return e.eulaEnabled&&!e.isEulaAccepted}).reduce(function(e,t){var n=t.id,r=t.eulaUrl;return e[r]?e[r].push(n):e[r]=[n],e},{}),e.abrupt("return",(0,I.default)(n).map(function(e){var t=(0,T.default)(e,2);return{url:t[0],organizationIds:t[1]}}));case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"findEulaContent",value:(d=(0,j.default)(O.default.mark(function e(t){var n;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("http://","https://"),e.next=3,this.httpClient.get(t,{withCredentials:!1,withHeaders:!1,resFormat:"text"});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"getSettingValue",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(t));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e=this._resolveModelId(e);var n=this.getById(e);return n?n.getSettingValue(t):null}},{key:"getAll",value:function(){return this.host.models.Organization.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+w(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+b(e));return this.host.models.Organization.getMulti(e)}},{key:"__reloadConversations",value:function(e){if(e){var t=e.conversations,n=0,r=0,a=0,o=0,i=0;if(!t||"function"!=typeof t[R.default]&&!Array.isArray(t))throw new TypeError("Expected conversations to be iterable, got "+b(t));if(!t||"function"!=typeof t[R.default]&&!Array.isArray(t))throw new TypeError("Expected conversations to be iterable, got "+w(t));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,S.default)(t);!(s=(l=d.next()).done);s=!0){var f=l.value,p=f.highestSortNumber,h=f.unreadCount,y=f.unreadPriorityCount,g=f.lastIncomingMessageSortNumber,v=f.shouldDisplay,m=f.metadata;v&&(n=Math.max(n,p),m&&"patient_messaging"===m.feature_service?(r+=h,o+=y):(a+=h,i+=y),!this.config.condensedReplays&&g&&(!e.lastIncomingMessageSortNumber||e.lastIncomingMessageSortNumber<g)&&(e.lastIncomingMessageSortNumber=g))}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}e.highestSortNumber=n,e.unreadCount=a+r,e.unreadPriorityCount=i+o,e.networks.provider.unreadCount=a,e.networks.provider.unreadPriorityCount=i,e.networks.patient.unreadCount=r,e.networks.patient.unreadPriorityCount=o,this.host.models.Organization.inject(e),e.emit("change")}}},{key:"reactToOrganizationPreferencesEvent",value:function(e){this.emit("preferences:change",B.default.camelizeObject(e))}}]),a((c=Z).prototype,"findAll",[o],(0,k.default)(c.prototype,"findAll"),c.prototype),a(c.prototype,"refreshAll",[i],(0,k.default)(c.prototype,"refreshAll"),c.prototype),a(c.prototype,"_findAll",[s],(0,k.default)(c.prototype,"_findAll"),c.prototype),a(c.prototype,"find",[u],(0,k.default)(c.prototype,"find"),c.prototype),c);function Z(){var e,t,v,n,r,a,o=this;(0,C.default)(this,Z);for(var i=arguments.length,s=Array(i),u=0;u<i;u++)s[u]=arguments[u];return t=v=(0,V.default)(this,(e=Z.__proto__||(0,z.default)(Z)).call.apply(e,[this].concat(s))),v._onChangeConversation=function(e,t){var n=t.organization;n&&(v.host.currentlyServingOfflineMessages||v._deferConversationChanges||v.__reloadConversations(n))},v._onChangeUser=function(e,t){var n=t.id,r=v.host.models.Organization.getAll();if(!r||"function"!=typeof r[R.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+b(r));if(!r||"function"!=typeof r[R.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+w(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,S.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value;c.autoForwardReceiverId===n&&c.autoForwardReceiver!==t&&v.host.models.Organization.inject(c)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}if(t===v.host.currentUser&&!v.host.currentlyServingOfflineMessages&&!v._deferConversationChanges){var l=v.host.currentUser.roles;if(!(0,L.default)(l,v._lastMyRoles)){if(v._lastMyRoles=[].concat((0,M.default)(l)),!r||"function"!=typeof r[R.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+b(r));if(!r||"function"!=typeof r[R.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+w(r));var d=!0,f=!1,p=void 0;try{for(var h,y=(0,S.default)(r);!(d=(h=y.next()).done);d=!0){var g=h.value;(0,L.default)(g.allowedSenders,v._getAllowedSenders(g))||v.host.models.Organization.inject(g)}}catch(e){f=!0,p=e}finally{try{!d&&y.return&&y.return()}finally{if(f)throw p}}}}},v.getPreferences=(a=(0,j.default)(O.default.mark(function e(t){return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new q.ValidationError("organizationId","required");case 2:return e.next=4,v.host.api.organizations.getPreferences(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,o)})),function(e){return a.apply(this,arguments)}),v.editPreferences=(r=(0,j.default)(O.default.mark(function e(t){var n=t.quickReplies,r=void 0===n?[]:n,a=t.organizationId;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new q.ValidationError("quickReplies","required");case 2:if(a){e.next=4;break}throw new q.ValidationError("organizationId","required");case 4:return e.next=6,v.host.api.organizations.editPreferences({organizationId:a,quickReplies:r});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,o)})),function(e){return r.apply(this,arguments)}),n=t,(0,V.default)(v,n)}t.default=K,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function d(e){if(2<e.length)throw new V.ValidationError("contacts count","larger than 2");for(var t=0;t<e.length;t++){var n=e[t],r=n.firstName,a=n.lastName,o=n.phoneNumber,i=n.relation;if(!r)throw new V.ValidationError("contact firstName","required");if(!a)throw new V.ValidationError("contact lastName","required");if(!o)throw new V.ValidationError("contact phoneNumber","required");if(!i)throw new V.ValidationError("contact relation","required")}if(2===e.length&&(0,_.default)(e[0],e[1]))throw new V.ValidationError("contacts being unique","required")}function f(e){if(null==e)throw new V.ValidationError("version","of type string or number");return"string"==typeof e?parseInt(e)+1:e+1}function p(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){var t=e.phoneNumber,n=(0,a.default)(e,["phoneNumber"]);return(0,h.default)({},n,{phoneNumber:(0,G.normalizePhone)(t)})})}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(3)),c=r(n(4)),l=r(n(5)),a=r(n(34)),h=r(n(16)),y=r(n(10)),o=r(n(9)),g=r(n(6)),v=r(n(1)),m=r(n(2)),b=r(n(8)),w=r(n(7)),_=r(n(270));t.checkContactsAreValid=d,t.updateEditVersion=f,t.validateContactPhoneNumbers=p;var x,E,k,T,I,A,O,j,S,M,R,z,C,P=r(n(15)),V=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),G=n(28),N=["patient","user"],U=(x=P.default,(0,w.default)(F,x),(0,m.default)(F,[{key:"create",value:(C=(0,o.default)(y.default.mark(function e(t){var n,r=t.contacts,a=t.dob,o=t.firstName,i=t.lastName,s=t.mrn,u=t.organizationId,c=t.phoneNumber,l=t.gender;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}throw new V.ValidationError("mrn","required");case 2:if(o){e.next=4;break}throw new V.ValidationError("firstName","required");case 4:if(i){e.next=6;break}throw new V.ValidationError("lastName","required");case 6:if(c){e.next=8;break}throw new V.ValidationError("phoneNumber","required");case 8:if((0,G.isPhone)(c)){e.next=10;break}throw new V.ValidationError("phoneNumber","not a valid format");case 10:if(a){e.next=12;break}throw new V.ValidationError("dob","required");case 12:if(/^(19|20)\d\d[- \/.](0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])$/.test(a)){e.next=14;break}throw new V.ValidationError("dob","not a valid format of YYYY-MM-DD");case 14:if(l){e.next=16;break}throw new V.ValidationError("gender","required");case 16:if(u){e.next=18;break}throw new V.ValidationError("organizationId","required");case 18:return r&&r.length&&d(r),e.next=21,this.host.api.patients.create({contacts:p(r),dob:a,firstName:o,gender:l,lastName:i,mrn:s,organizationId:u,phoneNumber:(0,G.normalizePhone)(c)});case 21:return n=e.sent,e.abrupt("return",this.host.models.User.inject(n.entity));case 23:case"end":return e.stop()}},e,this)})),function(e){return C.apply(this,arguments)})},{key:"update",value:(z=(0,o.default)(y.default.mark(function e(t){var n,r=t.currentEditVersion,a=t.dob,o=t.firstName,i=t.patientId,s=t.lastName,u=t.organizationId,c=t.phoneNumber,l=t.gender;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new V.ValidationError("currentEditVersion","required");case 2:if(u){e.next=4;break}throw new V.ValidationError("organizationId","required");case 4:if(i){e.next=6;break}throw new V.ValidationError("patientId","required");case 6:return e.next=8,this.host.api.patients.update({dob:a,editVersion:f(r),firstName:o,gender:l,patientId:i,lastName:s,organizationId:u,phoneNumber:(0,G.normalizePhone)(c)});case 8:return n=e.sent,e.abrupt("return",this.host.models.User.inject(n.entity));case 10:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"delete",value:(R=(0,o.default)(y.default.mark(function e(t,n){var r;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new V.ValidationError("organizationId","required");case 10:return(r=this.host.models.Patient.get(t))&&this.host.models.Patient.eject(r),e.next=14,this.host.api.patients.delete(t,n);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return R.apply(this,arguments)})},{key:"createContact",value:(M=(0,o.default)(y.default.mark(function e(t){var n,r=t.firstName,a=t.lastName,o=t.organizationId,i=t.patientId,s=t.phoneNumber,u=t.relation;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}throw new V.ValidationError("patientId","required");case 2:if(r){e.next=4;break}throw new V.ValidationError("firstName","required");case 4:if(a){e.next=6;break}throw new V.ValidationError("lastName","required");case 6:if(s){e.next=8;break}throw new V.ValidationError("phoneNumber","required");case 8:if((0,G.isPhone)(s)){e.next=10;break}throw new V.ValidationError("phoneNumber","not a valid format");case 10:if(u){e.next=12;break}throw new V.ValidationError("relation","required");case 12:if(o){e.next=14;break}throw new V.ValidationError("organizationId","required");case 14:return e.next=16,this.host.api.patients.createContact({firstName:r,lastName:a,organizationId:o,patientId:i,phoneNumber:(0,G.normalizePhone)(s),relation:u});case 16:return n=e.sent,e.abrupt("return",this.host.models.User.inject(n.entity));case 18:case"end":return e.stop()}},e,this)})),function(e){return M.apply(this,arguments)})},{key:"updateContact",value:(S=(0,o.default)(y.default.mark(function e(t){var n,r=t.contactId,a=t.currentEditVersion,o=t.firstName,i=t.lastName,s=t.organizationId,u=t.patientId,c=t.phoneNumber,l=t.relation;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}throw new V.ValidationError("currentEditVersion","required");case 2:if(s){e.next=4;break}throw new V.ValidationError("organizationId","required");case 4:if(u){e.next=6;break}throw new V.ValidationError("patientId","required");case 6:if(r){e.next=8;break}throw new V.ValidationError("contactId","required");case 8:if(o){e.next=10;break}throw new V.ValidationError("firstName","required");case 10:if(i){e.next=12;break}throw new V.ValidationError("lastName","required");case 12:if(c){e.next=14;break}throw new V.ValidationError("phoneNumber","required");case 14:if((0,G.isPhone)(c)){e.next=16;break}throw new V.ValidationError("phoneNumber","not a valid format");case 16:if(l){e.next=18;break}throw new V.ValidationError("relation","required");case 18:return e.next=20,this.host.api.patients.updateContact({contactId:r,editVersion:f(a),firstName:o,lastName:i,organizationId:s,patientId:u,phoneNumber:(0,G.normalizePhone)(c),relation:l});case 20:return n=e.sent,e.abrupt("return",this.host.models.User.inject(n.entity));case 22:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"deleteContact",value:(j=(0,o.default)(y.default.mark(function e(t){var n,r=t.contactId,a=t.organizationId,o=t.patientId;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new V.ValidationError("contactId","required");case 2:if(a){e.next=4;break}throw new V.ValidationError("organizationId","required");case 4:if(o){e.next=6;break}throw new V.ValidationError("patientId","required");case 6:return e.next=8,this.host.api.patients.deleteContact({contactId:r,patientId:o,organizationId:a});case 8:(n=this.host.models.PatientContact.get("patientContact:"+r))&&this.host.models.PatientContact.eject(n);case 10:case"end":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)})},{key:"login",value:(O=(0,o.default)(y.default.mark(function e(t){var n,r,a,o,i,s,u=t.accessToken,c=t.dateOfBirth,l=t.linkToken,d=t.sessions;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.emit("signingIn"),e.next=3,this.host.api.patients.login(l,u,c,d);case 3:return n=e.sent,r=n.api_key,a=n.api_secret,o=n.group_id,i=n.organization_id,this.host.configure({events:(0,h.default)({},this.host.config.events,{singleConversation:o})}),this.host._setAuth({key:r,secret:a}),this.host.setDefaultOrganization(i),e.next=10,this.host.users.findMe({ignoreNotFound:!0});case 10:return s=e.sent,this.host._setCurrentUser(s),this.host.emit("signedIn",s,this.host.getAuth()),this.host.messages._fetchAttachmentTokens(),e.abrupt("return",n);case 15:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"loginCheck",value:(A=(0,o.default)(y.default.mark(function e(t){var n=t.linkToken,r=t.sessions;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.host.api.patients.loginCheck(n,r));case 1:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"requestAccessToken",value:(I=(0,o.default)(y.default.mark(function e(t){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.host.api.patients.requestAccessToken(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return I.apply(this,arguments)})},{key:"csvUpload",value:(T=(0,o.default)(y.default.mark(function e(t,n){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.host.api.patients.csvUpload(t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return T.apply(this,arguments)})},{key:"getWhiteLabel",value:(k=(0,o.default)(y.default.mark(function e(t){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.host.api.patients.getWhiteLabel(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"setWhiteLabel",value:(E=(0,o.default)(y.default.mark(function e(t,n){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.host.api.patients.setWhiteLabel(t,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"_createPatientGroupMetadata",value:function(e){var t=e.displayName,n=e.patient,r=e.id;return{feature_service:"patient_messaging",is_patient_contact:"false",patient_dob:n.dob,patient_gender:n.gender,patient_id:r,patient_mrn:n.mrn,patient_name:t,phone_number:n.phoneNumber,sms_opted_out:n.smsOptedOut}}},{key:"_createPatientContactGroupMetadata",value:function(e){var t=e.patient,n=e.patientContact,r=e.id,a=t.dob,o=t.gender,i=t.mrn,s=t.user,u=n.phoneNumber,c=n.relation,l=n.smsOptedOut;return{feature_service:"patient_messaging",is_patient_contact:"true",patient_contact_id:r,patient_dob:a,patient_gender:o,patient_id:s.id,patient_mrn:i,patient_name:s.displayName,phone_number:u,relation_name:c,sms_opted_out:l}}},{key:"getAll",value:function(){return this.host.models.Patient.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));return e=this.__resolvePatientId(e),this.host.models.Patient.get("patient:"+e)}}]),F);function F(){var e,t,n,r;(0,v.default)(this,F);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=n=(0,b.default)(this,(e=F.__proto__||(0,g.default)(F)).call.apply(e,[this].concat(o))),n.__resolvePatientId=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "patientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+u(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "patientId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+s(e));if("string"!=typeof e){if(!N.includes(e.$entityType))return e;e=n._resolveModelId(e)}return e.replace("patient:","")},r=t,(0,b.default)(n,r)}t.default=U},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=r(n(6)),i=r(n(1)),s=r(n(2)),u=r(n(8)),c=r(n(7)),l=r(n(15)),d=n(26),f=(a=l.default,(0,c.default)(p,a),(0,s.default)(p,[{key:"mounted",value:function(){this._data={}}},{key:"dispose",value:function(){this._data=null}},{key:"reactToPresenceEvent",value:function(e){var t=e.data;this.set(t.from,d.PresenceStatus.resolve(t.type))}},{key:"set",value:function(e,t){if(this._data[e]!==t){this._data[e]=t;var n=this.host.models.User.inject({id:e,presence:t});this.emit("change",{presence:t,user:n,userId:e})}}},{key:"get",value:function(e){return e===this.host.currentUserId?d.PresenceStatus.AVAILABLE:this._data[e]||d.PresenceStatus.UNKNOWN}}]),p);function p(e,t){return(0,i.default)(this,p),(0,u.default)(this,(p.__proto__||(0,o.default)(p)).call(this,e,t))}t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function T(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=T(t[0],n);return t.every(function(e){return T(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return T(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+T(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function I(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=I(t[0],n);return t.every(function(e){return I(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return I(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+I(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d=r(n(3)),f=r(n(4)),p=r(n(5)),h=r(n(11)),y=r(n(10)),g=r(n(9)),A=r(n(19)),O=r(n(12)),j=r(n(22)),S=r(n(13)),v=r(n(6)),m=r(n(1)),b=r(n(2)),w=r(n(8)),_=r(n(7)),x=n(20),M=r(n(93)),E=r(n(49)),k=r(n(15)),R=(o=(0,x.decorator)(),i=(0,x.decorator)(),u=k.default,(0,_.default)(z,u),(0,b.default)(z,[{key:"mounted",value:function(){this.host.models.Organization.on("afterInject",this._onChangeOrganization),this.host.models.Organization.on("afterEject",this._onChangeOrganization)}},{key:"dispose",value:function(){this.host.models.Organization.removeListener("afterInject",this._onChangeOrganization),this.host.models.Organization.removeListener("afterEject",this._onChangeOrganization)}},{key:"findAll",value:(l=(0,g.default)(y.default.mark(function e(){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.findAll();case 2:return e.abrupt("return",this.getAll());case 3:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"refreshAll",value:(c=(0,g.default)(y.default.mark(function e(){return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.refreshAll();case 2:return e.abrupt("return",this.getAll());case 3:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Product.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+T(e));return this.host.models.Product.get(e)}}]),a((s=z).prototype,"findAll",[o],(0,h.default)(s.prototype,"findAll"),s.prototype),a(s.prototype,"refreshAll",[i],(0,h.default)(s.prototype,"refreshAll"),s.prototype),s);function z(){var e,t,k,n;(0,m.default)(this,z);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=k=(0,w.default)(this,(e=z.__proto__||(0,v.default)(z)).call.apply(e,[this].concat(a))),k._addProcessingEvent=function(e){var t=k.host.models.Product.getAll()[0];if(t){var n=e.actionType,r=e.entity;n===E.default.ROLE_OPT_IN&&t.rolesOptingIn.push(r.id),t.activeProcessingEvents.push(e),k.host.models.Product.inject(t),k.emit("processing:start",e)}},k._removeProcessingEvent=function(e){var t=k.host.models.Product.getAll()[0];if(t){for(var n=t.activeProcessingEvents,r=t.rolesOptingIn,a=e.actionType,o=e.entity,i=n.length-1;0<=i;i--){var s=n[i];if(a===s.actionType&&o.id===s.entity.id&&(n.splice(i,1),a===E.default.ROLE_OPT_IN&&r.includes(o.id)&&r.splice(r.indexOf(o.id),1),a!==E.default.MESSAGE_REPLAY))break}k.host.models.Product.inject(t),k.emit("processing:stop",e)}},k._onChangeOrganization=function(e,t){var n=k.host.models.Product.getAll()[0];if(n){var r=k.host.models.Organization.getAll();if(0!==r.length){var a={organizations:r},o=0,i=0,s=0;if(!r||"function"!=typeof r[S.default]&&!Array.isArray(r))throw new TypeError("Expected organizations to be iterable, got "+T(r));if(!r||"function"!=typeof r[S.default]&&!Array.isArray(r))throw new TypeError("Expected organizations to be iterable, got "+I(r));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,O.default)(r);!(u=(d=f.next()).done);u=!0){var p=d.value;p.$placeholder||(o+=p.conversations.length,i+=p.unreadCount,s+=p.unreadPriorityCount)}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}a.conversationCount=o,a.unreadCount=i,a.unreadPriorityCount=s;var h=!1;if(!(w=(0,j.default)(a))||"function"!=typeof w[S.default]&&!Array.isArray(w))throw new TypeError("Expected _Object$entries to be iterable, got "+T(w));if(!w||"function"!=typeof w[S.default]&&!Array.isArray(w))throw new TypeError("Expected _Object$entries to be iterable, got "+I(w));var y=!0,g=!1,v=void 0;try{for(var m,b=(0,O.default)(w);!(y=(m=b.next()).done);y=!0){var w,_=(0,A.default)(m.value,2),x=_[0],E=_[1];(0,M.default)(n[x],E)||(n[x]=E,h=!0)}}catch(e){g=!0,v=e}finally{try{!y&&b.return&&b.return()}finally{if(g)throw v}}h&&k.host.models.Product.inject(n)}}},n=t,(0,w.default)(k,n)}t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,c,l,d,f,p,h,y,g,v=r(n(3)),m=r(n(4)),b=r(n(5)),w=r(n(11)),_=r(n(16)),x=r(n(10)),E=r(n(18)),k=r(n(9)),T=r(n(6)),I=r(n(1)),A=r(n(2)),O=r(n(8)),j=r(n(7)),S=r(n(262)),M=r(n(25)),R=n(20),z=n(23),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),P=r(n(15)),V=(a=(0,R.decorator)(),h=P.default,(0,j.default)(G,h),(0,A.default)(G,[{key:"findAll",value:(g=(0,k.default)(x.default.mark(function e(){var t,n,r=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,M.default)(a,{ignoreNotFound:!0,bypassCache:!1}),0===(t=this.host.models.Organization.getAll()).length)return e.next=5,this.host.organizations.findAll();e.next=6;break;case 5:t=e.sent;case 6:return e.next=8,E.default.all(t.map(function(e){return r.findAllForOrganization(e.id,a)}));case 8:return n=e.sent,e.abrupt("return",(0,S.default)(n));case 10:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"findAllForOrganization",value:(y=(0,k.default)(x.default.mark(function e(n){var t,r,a,o=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof n||n instanceof Object){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+u(n));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+s(n));case 4:if(i=(0,M.default)(i,{ignoreNotFound:!0,bypassCache:!1}),n=this._resolveModelId(n),(t=this._resolveEntity(n)).rolesEnabled&&t.canAdminRoles){e.next=9;break}return e.abrupt("return",[]);case 9:return e.next=11,this.host.api.roleTags.findAll(n);case 11:if(r=e.sent){e.next=16;break}if(i.ignoreNotFound)return e.abrupt("return",[]);e.next=15;break;case 15:throw new C.NotFoundError("roleTags",n);case 16:return a=r.map(function(e){var t=n+":"+e.tag_id;return o.host.models.RoleTag.inject((0,_.default)({},e,{id:t,organizationId:n}))}),this.host.models.Organization.touch(n),e.abrupt("return",a);case 19:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"reactToUpdateEventCR",value:function(e){var t=e.data,n=t=(0,z.jsonCloneDeep)(t),r=n.entity,a=n.organization_id,o=r.color,i=r.display_name,s=r.id||r.token,u=o.color_id,c=o.color_value;return this.host.models.RoleTag.inject({color:u,colorValue:c,id:a+":"+s,name:i,organizationId:a,tagId:s})}},{key:"reactToUpdateEvent",value:function(e){var t=e.data;if(!this.config.condensedReplays||!t.entity){var n=t=(0,z.jsonCloneDeep)(t),r=n.color,a=n.display_name,o=n.organization_key,i=n.token,s=r.color_id,u=r.color_value;return this.host.models.RoleTag.inject({color:s,colorValue:u,id:o+":"+i,name:a,organizationId:o,tagId:i})}this.reactToUpdateEventCR({data:t})}},{key:"getAll",value:function(){return this.host.models.RoleTag.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));return this.host.models.RoleTag.get(e)}}]),i=(o=G).prototype,c="findAllForOrganization",l=[a],d=(0,w.default)(o.prototype,"findAllForOrganization"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(i,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(i,c,p),p=null),o);function G(){return(0,I.default)(this,G),(0,O.default)(this,(G.__proto__||(0,T.default)(G)).apply(this,arguments))}t.default=V,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function $(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,I.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=$(t[0],n);return t.every(function(e){return $(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return $(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,S.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,M.default)(e))+": "+$(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function D(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,I.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=D(t[0],n);return t.every(function(e){return D(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return D(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,S.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,M.default)(e))+": "+D(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I=r(n(5)),A=r(n(11)),O=r(n(19)),j=r(n(34)),S=r(n(4)),M=r(n(3)),q=r(n(10)),L=r(n(18)),R=r(n(9)),B=r(n(12)),K=r(n(13)),z=r(n(16)),C=r(n(6)),P=r(n(1)),V=r(n(2)),G=r(n(8)),N=r(n(7)),U=r(n(46)),F=r(n(25)),Z=n(20),H=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),W=r(n(48)),X=r(n(15)),Q=["role","user"],Y=(o=(0,Z.decorator)(),i=(0,Z.decorator)(),s=(0,Z.decorator)(),u=(0,Z.decorator)(),c=(0,Z.decorator)(),l=(0,Z.decorator)(),d=(0,Z.decorator)(),f=(0,Z.decorator)(),h=X.default,(0,N.default)(J,h),(0,V.default)(J,[{key:"mounted",value:function(){this._previouslyInRoles={},this._roleConversations={},this._roleP2PConversations={},this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onRemoveConversation)}},{key:"dispose",value:function(){this._previouslyInRoles={},this._roleConversations={},this._roleP2PConversations={},this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onRemoveConversation)}},{key:"createP2PGroup",value:(T=(0,R.default)(q.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R=this,z=t.metadata,C=t.name,P=t.organizationId,V=t.recipientId,G=t.replayHistory,N=void 0===G||G,U=t.senderId,F=void 0===U?this.host.currentUserId:U;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),V){e.next=3;break}throw new H.ValidationError("recipientId","required");case 3:if(P){e.next=5;break}throw new H.ValidationError("organizationId","required");case 5:if(n=this.host.currentUserId,a=[],"function"!=typeof(r=[F,V])[K.default]&&!Array.isArray(r))throw new TypeError("Expected initialUserIds to be iterable, got "+$(r));e.next=10;break;case 10:if(!r||"function"!=typeof r[K.default]&&!Array.isArray(r))throw new TypeError("Expected initialUserIds to be iterable, got "+D(r));e.next=12;break;case 12:for(i=!(o=!0),s=void 0,e.prev=15,u=(0,B.default)(r);!(o=(c=u.next()).done);o=!0)l=c.value,l=this.host.roles.__resolveRoleId(l),l=this._resolveModelIdWithTypes(l,"user"),a.includes(l)||a.push(l);e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),i=!0,s=e.t0;case 23:e.prev=23,e.prev=24,!o&&u.return&&u.return();case 26:if(e.prev=26,i)throw s;e.next=29;break;case 29:return e.finish(26);case 30:return e.finish(23);case 31:if(2!==a.length)throw new H.ValidationError("recipientId","same user as senderId");e.next=33;break;case 33:return e.next=35,L.default.all(a.map(function(e){return R.host.users.find(e,{organizationId:P})}));case 35:return d=e.sent,C=C||d.map(function(e){return e.isRoleBot?e.displayName:e.firstName}).filter(Boolean).join(", ")||"Group",e.next=39,this.host.api.roles.createP2PGroup({createdByUserId:F,memberIds:a,name:C,organizationId:P,replayHistory:N});case 39:if(f=e.sent,h=p=void 0,this.config.condensedReplays?(h=f.entity||f,p=f.conversation_id):h=f,!d||"function"!=typeof d[K.default]&&!Array.isArray(d))throw new TypeError("Expected users to be iterable, got "+$(d));e.next=44;break;case 44:if(!d||"function"!=typeof d[K.default]&&!Array.isArray(d))throw new TypeError("Expected users to be iterable, got "+D(d));e.next=46;break;case 46:g=!(y=!0),v=void 0,e.prev=49,m=(0,B.default)(d);case 51:if(y=(b=m.next()).done){e.next=85;break}if(w=b.value,_=w.botRole,w.isRoleBot&&_){e.next=56;break}return e.abrupt("continue",82);case 56:if(x=_.memberIds){e.next=59;break}return e.abrupt("continue",82);case 59:if(!x||"function"!=typeof x[K.default]&&!Array.isArray(x))throw new TypeError("Expected botMemberIds to be iterable, got "+$(x));e.next=61;break;case 61:if(!x||"function"!=typeof x[K.default]&&!Array.isArray(x))throw new TypeError("Expected botMemberIds to be iterable, got "+D(x));e.next=63;break;case 63:for(k=!(E=!0),T=void 0,e.prev=66,I=(0,B.default)(x);!(E=(A=I.next()).done);E=!0)O=A.value,a.includes(O)||a.push(O);e.next=74;break;case 70:e.prev=70,e.t1=e.catch(66),k=!0,T=e.t1;case 74:e.prev=74,e.prev=75,!E&&I.return&&I.return();case 77:if(e.prev=77,k)throw T;e.next=80;break;case 80:return e.finish(77);case 81:return e.finish(74);case 82:y=!0,e.next=51;break;case 85:e.next=91;break;case 87:e.prev=87,e.t2=e.catch(49),g=!0,v=e.t2;case 91:e.prev=91,e.prev=92,!y&&m.return&&m.return();case 94:if(e.prev=94,g)throw v;e.next=97;break;case 97:return e.finish(94);case 98:return e.finish(91);case 99:if(j=h.id||h.token,S=this.host.models.Group.get(j),M=void 0,M=S&&S.memberIds?S.memberIds:h.members=a,S=this.host.conversations.__injectCounterParty({conversationId:p,entityAttrs:h,entityType:"group",groupType:W.default.ROLE_P2P,hasCurrentUser:M.includes(n),isPlaceholder:!0,organizationId:P}),z)return e.next=107,this.host.metadata.update(S.id,z,P);e.next=107;break;case 107:return e.abrupt("return",S);case 108:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30],[49,87,91,99],[66,70,74,82],[75,,77,81],[92,,94,98]])})),function(e){return T.apply(this,arguments)})},{key:"findAll",value:(k=(0,R.default)(q.default.mark(function e(){var t,n,r,a,o=this;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=4,this.host.organizations.findAll();e.next=5;break;case 4:t=e.sent;case 5:if(0===(t=t.filter(function(e){return e.rolesEnabled})).length)return e.abrupt("return",[]);e.next=8;break;case 8:return e.next=10,this.host.search.query({types:["user"],organizationIds:t.map(function(e){return e.id}),query:{displayName:"",featureService:"role"},followContinuations:!0});case 10:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),t.map(function(e){var t=e.id;return o.host.models.Organization.touch(t)}),e.abrupt("return",a);case 15:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)})},{key:"findByOrganizationId",value:(E=(0,R.default)(q.default.mark(function e(t){var n,r,a,o;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 4:return t=this._resolveModelId(t),e.next=7,this.host.organizations.find(t);case 7:if((n=e.sent).rolesEnabled){e.next=10;break}return e.abrupt("return",[]);case 10:return e.next=12,this.host.search.query({types:["user"],organizationIds:n.id,query:{displayName:"",featureService:"role"},followContinuations:!0});case 12:return r=e.sent,a=r.results,o=a.map(function(e){return e.entity}),this.host.models.Organization.touch(t),e.abrupt("return",o);case 17:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"find",value:(x=(0,R.default)(q.default.mark(function e(t,n){var r,a,o,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 4:if(i instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+D(i));case 6:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=8;break;case 8:if("string"==typeof n||n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(n));case 10:if(i instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+$(i));case 12:if(this.host.requireUser(),i=(0,F.default)(i,{bypassCache:!1,ignoreNotFound:!1}),t=this.__resolveRoleId(t),n=this._resolveModelId(n),i.bypassCache){e.next=20;break}if(r=this.getById(t))return e.abrupt("return",r);e.next=20;break;case 20:return e.next=22,this.host.api.roles.find(t,n);case 22:if(a=e.sent){e.next=27;break}if(i.ignoreNotFound)return e.abrupt("return");e.next=26;break;case 26:throw new H.NotFoundError(this.host.models.Role.name,t);case 27:return o=this.__injectSearchResult({entity:{id:t,displayName:a.display_name},metadata:a,organizationId:n}),this.host.models.Organization.touch(n),e.abrupt("return",o);case 30:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"saveRole",value:(_=(0,R.default)(q.default.mark(function e(t,n){return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(n));e.next=8;break;case 8:return this.host.requireUser(),n=this._resolveModelId(n),t=this.__resolveRoleId(t),e.next=13,this.host.api.roles.saveRole(t,this.host.currentUserId,n);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return _.apply(this,arguments)})},{key:"removeSavedRole",value:(w=(0,R.default)(q.default.mark(function e(t,n){return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(n));e.next=8;break;case 8:return this.host.requireUser(),n=this._resolveModelId(n),t=this.__resolveRoleId(t),e.next=13,this.host.api.roles.removeSavedRole(t,this.host.currentUserId,n);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"findSavedRoles",value:(b=(0,R.default)(q.default.mark(function e(t){var n,r,a=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if(o instanceof Object){e.next=4;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+D(o));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=6;break;case 6:if(o instanceof Object){e.next=8;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+$(o));case 8:return o=(0,F.default)(o,{ignoreNotFound:!1}),this.host.requireUser(),t=this._resolveModelId(t),e.next=13,this.host.api.roles.findSavedRoles(this.host.currentUserId,t);case 13:if(n=e.sent){e.next=18;break}if(o.ignoreNotFound)return e.abrupt("return");e.next=17;break;case 17:throw new H.NotFoundError("saved roles",t);case 18:return r=n.map(function(e){return a.__injectSearchResult({entity:{id:e.token,displayName:e.display_name},metadata:e,organizationId:t})}).filter(Boolean),this.host.models.Organization.touch(t),e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"reactToUpdateEventCR",value:function(e){var t,n=e.entity,r=n.display_name,a=n.metadata,o=n.organizationId;return t="group"===n.type?a.id:n.id,a=(0,z.default)({},a,{display_name:r,token:this.__resolveRoleId(t)}),this.__injectRoleFromMetadata({metadata:a,organizationId:o})}},{key:"reactToUpdateEvent",value:function(e){var t,n=e.data,r=n.display_name,a=n.metadata,o=n.organization_key;return t="tigertext:entity:group"===n.type?a.id:n.token,a=(0,z.default)({},a,{display_name:r,token:this.__resolveRoleId(t)}),this.__injectRoleFromMetadata({metadata:a,organizationId:o})}},{key:"__injectRoleFromMetadata",value:function(e){var t=e.metadata,n=void 0===t?{}:t,r=e.organizationId,a=e.replaceExisting,o=void 0===a||a,i=n.escalation_policy,s=n.token;if(!s)return null;var u="role:"+s;if(!o){var c=this.host.models.Role.get(u);if(c)return c}var l=this.host.models.Organization.get(r);this.host.metadata.__injectMetadata(s,r,(0,z.default)({feature_service:"role"},n)),this.host.models.User.injectPlaceholder({id:s,organizationId:r,displayName:n.display_name});var d={botUserId:s,displayName:n.display_name,id:u,organizationId:r};if(n.description&&(d.description=n.description),i&&i.escalation_path){var f=JSON.parse((0,M.default)(i));f.id="escalationPolicy:"+s,f.targetId=s;var p=this.host.models.EscalationPolicy.inject(f);d.escalationPolicyId=p.id}else d.escalationPolicyId=null;if(n.room_assignment_id&&(d.assignmentGroupId=n.room_assignment_id),n.owners)if("string"==typeof n.owners)d.memberIds=n.owners.split(","),this.host.models.User.injectPlaceholder({id:n.owners});else{if(d.memberIds=n.owners.map(function(e){return e.token}),!(b=n.owners)||"function"!=typeof b[K.default]&&!Array.isArray(b))throw new TypeError("Expected _metadata$owners to be iterable, got "+$(b));if(!b||"function"!=typeof b[K.default]&&!Array.isArray(b))throw new TypeError("Expected _metadata$owners to be iterable, got "+D(b));var h=!0,y=!1,g=void 0;try{for(var v,m=(0,B.default)(b);!(h=(v=m.next()).done);h=!0){var b,w=v.value;this.host.models.User.injectPlaceholder(w)}}catch(e){y=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(y)throw g}}}return n.tag_id?(d.roleTagId=r+":"+n.tag_id,this.host.models.RoleTag.inject((0,z.default)({},(0,U.default)(n,"tag_id","tag_color","tag_name"),{id:d.roleTagId,organizationId:r}))):l&&(d.roleTagId=null),this.host.models.Role.inject(d)}},{key:"__parseRoleFromMetadata",value:function(e){var t=e.metadata,n=void 0===t?{}:t,r=e.organizationId,a=n.token;if(!a)return null;var o={$entityType:"role",botUserId:a,displayName:n.display_name,id:"role:"+a,organizationId:r},i=null;return n.tag_id&&(i={id:r+":"+n.tag_id,organizationId:r,color:n.tag_color,tagId:n.tag_id,name:n.tag_name,displayName:n.tag_name}).color&&(i.color=i.color.replace("0x","#")),o.roleTag=i,o}},{key:"getAll",value:function(){return this.host.models.Role.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(e));return e=this.__resolveRoleId(e),this.host.models.Role.get("role:"+e)}},{key:"refresh",value:(m=(0,R.default)(q.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=4;break;case 4:if(0===(n=(0,S.default)(this._roleConversations)).length)return e.abrupt("return");e.next=7;break;case 7:return e.next=9,this.host.entities.findMulti(n,t);case 9:if(!(r=e.sent)||"function"!=typeof r[K.default]&&!Array.isArray(r))throw new TypeError("Expected entities to be iterable, got "+$(r));e.next=12;break;case 12:if(!r||"function"!=typeof r[K.default]&&!Array.isArray(r))throw new TypeError("Expected entities to be iterable, got "+D(r));e.next=14;break;case 14:for(o=!(a=!0),i=void 0,e.prev=17,s=(0,B.default)(r);!(a=(u=s.next()).done);a=!0)c=u.value,l=c.entity,d=c.metadata,l&&d&&(d.owners||(d.owners=[]),this.__injectSearchResult({entity:{id:l.token,displayName:l.display_name},metadata:d,organizationId:t}));e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),o=!0,i=e.t0;case 25:e.prev=25,e.prev=26,!a&&s.return&&s.return();case 28:if(e.prev=28,o)throw i;e.next=31;break;case 31:return e.finish(28);case 32:return e.finish(25);case 33:case"end":return e.stop()}},e,this,[[17,21,25,33],[26,,28,32]])})),function(e){return m.apply(this,arguments)})},{key:"reactToFriendsEventCR",value:(v=(0,R.default)(q.default.mark(function e(t){var n,r,a,o,i,s;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.action,r=t.attrs,a=r.id,o=r.metadata,i=void 0===o?{}:o,s=r.organizationId,r.action=n,r.token=a,e.next=6,this.__reactToRoleChange(i.id,s,i.triggered_id,r);case 6:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"reactToFriendsEvent",value:(g=(0,R.default)(q.default.mark(function e(t){var n,r,a,o,i;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data.friend,r=n.metadata,a=void 0===r?{}:r,o=n.organization_id,i=(0,j.default)(n,["metadata","organization_id"]),e.next=3,this.__reactToRoleChange(a.id,o,a.triggered_id,i);case 3:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"__reactToRoleChange",value:(y=(0,R.default)(q.default.mark(function e(t,n,r,a){var o,i,s,u,c,l,d,f,p,h,y,g,v,m;return q.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "triggeredId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "triggeredId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(r));e.next=12;break;case 12:if(n=this._resolveModelId(n),t=this.__resolveRoleId(t),r=this._resolveModelId(r),o=this.host.currentUser,i=a.action,s=a.token,u=function(){return o.roles.some(function(e){return e.botUserId===t})},c=this._previouslyInRoles[t]||u(),l=a.event_status,"del"!==i){e.next=27;break}if(l&&"end"!==l)return this._previouslyInRoles[t]=c,e.abrupt("return");e.next=26;break;case 26:delete this._previouslyInRoles[t];case 27:return d=this.getById(t),e.next=30,L.default.all([this.find(t,n,{bypassCache:!0,ignoreNotFound:!0}),this.host.users.find(r,{organizationId:n,ignoreNotFound:!0})]);case 30:if(f=e.sent,p=(0,O.default)(f,2),h=p[0],y=p[1],d||h){e.next=36;break}return e.abrupt("return");case 36:(g="del"===i&&d&&!h)&&(h=d,v="role:"+t,this.host.models.Role.inject({id:v,memberIds:[]}),this.host.models.Role.eject(h)),(m=u())&&!c?this.emit("change",{type:"OPT_IN",role:h,target:o,triggeredBy:y}):!m&&c&&(this.host.models.Group.eject(s),this.host.models.User.touch(this.host.currentUserId),this.emit("change",{type:"OPT_OUT",isRoleDeleted:g,role:h,target:o,triggeredBy:y}));case 40:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return y.apply(this,arguments)})}]),a((p=J).prototype,"findAll",[o],(0,A.default)(p.prototype,"findAll"),p.prototype),a(p.prototype,"findByOrganizationId",[i],(0,A.default)(p.prototype,"findByOrganizationId"),p.prototype),a(p.prototype,"find",[s],(0,A.default)(p.prototype,"find"),p.prototype),a(p.prototype,"saveRole",[u],(0,A.default)(p.prototype,"saveRole"),p.prototype),a(p.prototype,"removeSavedRole",[c],(0,A.default)(p.prototype,"removeSavedRole"),p.prototype),a(p.prototype,"findSavedRoles",[l],(0,A.default)(p.prototype,"findSavedRoles"),p.prototype),a(p.prototype,"refresh",[d],(0,A.default)(p.prototype,"refresh"),p.prototype),a(p.prototype,"__reactToRoleChange",[f],(0,A.default)(p.prototype,"__reactToRoleChange"),p.prototype),p);function J(){var e,t,g,n;(0,P.default)(this,J);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=g=(0,G.default)(this,(e=J.__proto__||(0,C.default)(J)).call.apply(e,[this].concat(a))),g.__injectSearchResult=function(e){var t=e.entity,n=e.metadata,r=void 0===n?{}:n,a=e.organizationId;return r=(0,z.default)({},r,{display_name:t.displayName,token:g.__resolveRoleId(t.id)}),g.__injectRoleFromMetadata({metadata:r,organizationId:a})},g.__injectRoleAssignmentEntity=function(e,t,n){return g.__injectRoleFromMetadata({metadata:{display_name:e,meta_type:t.meta_type,owners:t.owner_id,tag_color:t.tag_color,tag_id:t.tag_id,tag_name:t.tag_name,token:t.id},organizationId:n,replaceExisting:!1})},g.__resolveRoleId=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(e));if("string"!=typeof e){if(!Q.includes(e.$entityType))return e;e=g._resolveModelId(e)}return e.replace("role:","")},g._onChangeConversation=function(e,t){var n=t.counterParty,r=t.counterPartyType,a=n&&n.members&&0<n.members.length;if("group"===r&&a){if(!(l=n.members)||"function"!=typeof l[K.default]&&!Array.isArray(l))throw new TypeError("Expected _counterParty$members to be iterable, got "+$(l));if(!l||"function"!=typeof l[K.default]&&!Array.isArray(l))throw new TypeError("Expected _counterParty$members to be iterable, got "+D(l));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,B.default)(l);!(o=(u=c.next()).done);o=!0){var l,d=u.value;if(d.isRoleBot){var f=g._roleConversations[d.id]||[];if(f.includes(t)||f.push(t),g._roleConversations[d.id]=f,"ROLE_P2P"===n.groupType){var p=g._roleP2PConversations[d.id]||[];p.includes(t)||p.push(t),g._roleP2PConversations[d.id]=p}}}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}},g._onRemoveConversation=function(e,t){var n=t.counterParty,r=t.counterPartyType,a=n&&n.members&&0<n.members.length;if("group"===r&&a){var o=n.memberIds;if(!o||"function"!=typeof o[K.default]&&!Array.isArray(o))throw new TypeError("Expected memberIds to be iterable, got "+$(o));if(!o||"function"!=typeof o[K.default]&&!Array.isArray(o))throw new TypeError("Expected memberIds to be iterable, got "+D(o));var i=!0,s=!1,u=void 0;try{for(var c,l=(0,B.default)(o);!(i=(c=l.next()).done);i=!0){var d=c.value,f=g._roleConversations[d],p=f?f.indexOf(t):-1;if(-1<p&&f.splice(p,1),f&&0===f.length&&delete g._roleConversations[d],"ROLE_P2P"===n.groupType){var h=g._roleP2PConversations[d],y=h?h.indexOf(t):-1;-1<y&&h.splice(y,1),h&&0===h.length&&delete g._roleP2PConversations[d]}}}catch(e){s=!0,u=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw u}}}},n=t,(0,G.default)(g,n)}t.default=Y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_=r(n(3)),x=r(n(4)),E=r(n(5)),k=r(n(11)),T=r(n(31)),I=r(n(16)),A=r(n(18)),O=r(n(19)),j=r(n(10)),S=r(n(9)),M=r(n(6)),R=r(n(1)),z=r(n(2)),C=r(n(8)),P=r(n(7)),V=n(20),G=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),N=n(52),U=r(n(15)),F=(o=(0,V.decorator)(),i=(0,V.decorator)(),s=(0,V.decorator)(),u=(0,V.decorator)(),c=(0,V.decorator)(),d=U.default,(0,P.default)($,d),(0,z.default)($,[{key:"batchDelete",value:(w=(0,S.default)(j.default.mark(function e(t){var n,r=this,a=t.ids,o=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(a)){e.next=2;break}throw new G.ValidationError("ids","required","ids must be an array");case 2:if(o){e.next=4;break}throw new G.ValidationError("organizationId","required");case 4:return e.next=6,this.host.api.scheduledMessages.batch({ids:a,operation:"destroy",organizationId:o});case 6:return n=a.map(function(e){return r.host.models.ScheduledMessage.inject({$deleted:!0,id:e})}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"create",value:(b=(0,S.default)(j.default.mark(function e(t){var n,r=this,a=t.attachment,o=t.body,i=t.endDate,s=t.network,u=void 0===s?"patient":s,c=t.noReply,l=void 0!==c&&c,d=t.organizationId,f=t.recipients,p=t.repeating,h=t.sendNow,y=void 0!==h&&h,g=t.startDate,v=t.startTime,m=t.templateId,b=t.timezoneName;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._validate({body:o,endDate:i,organizationId:d,recipients:f,repeating:p,sendNow:y,shouldCheckId:!1,startDate:g,startTime:v}),!1===["patient"].includes(u))throw new G.ValidationError("network","invalid",'network must be "patient"');e.next=3;break;case 3:return e.next=5,this.host.api.scheduledMessages.create({attachment:a,body:o,end_date:i,network:u,no_reply:l,organizationId:d,recipients:f,repeating:p,send_now:y,start_date:g,start_time:v,template_id:m,timezone_name:b});case 5:return n=e.sent,e.abrupt("return",n.map(function(e){e.sender_id=r.host.currentUserId,r.host.conversations.__injectCounterParty({entityAttrs:e,entityType:"scheduledMessage",organizationId:d})}));case 7:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"delete",value:(m=(0,S.default)(j.default.mark(function e(t,n){var r;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({id:t,organizationId:n,shouldCheckInvalid:!1}),e.next=3,this.host.api.scheduledMessages.delete(t,n);case 3:return r=this.host.models.ScheduledMessage.inject({$deleted:!0,id:t}),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"downloadScheduledMessageFile",value:(v=(0,S.default)(j.default.mark(function e(t){var n,r=t.scheduleId,a=t.fileName,o=t.organizationId;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.scheduledMessages.downloadScheduledMessageFile({scheduleId:r,fileName:a,organizationId:o});case 2:return n=e.sent,e.next=5,(0,N.downloadFile)({attachmentContentType:n.type,blob:n,fileName:a});case 5:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"fetchHits",value:(g=(0,S.default)(j.default.mark(function e(t,n){var r,a,o,i,s,u=this;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=["history","queue"].map(function(e){return u.search({category:e,feed:t,organizationId:n,pageSize:0})}),e.next=3,A.default.all(r);case 3:return a=e.sent,o=(0,O.default)(a,2),i=o[0],s=o[1],e.abrupt("return",{history:i.metadata.totalHits,queue:s.metadata.totalHits});case 8:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"find",value:(y=(0,S.default)(j.default.mark(function e(t,n){var r,a;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({id:t,organizationId:n,shouldCheckInvalid:!1}),e.next=3,this.host.api.scheduledMessages.find(t,n);case 3:return r=e.sent,a=this.host.models.ScheduledMessage.inject(r),e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"findCoarseTimezone",value:(h=(0,S.default)(j.default.mark(function e(t,n){var r,a,o;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.scheduledMessages.findCoarseTimezone(t,n);case 2:return r=e.sent,a=r.abbr,o=r.name,e.abrupt("return",{abbr:a,name:o});case 6:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.ScheduledMessage.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,E.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,E.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));return this.host.models.ScheduledMessage.get(e)}},{key:"search",value:(p=(0,S.default)(j.default.mark(function e(t){var n,r,a=t.category,o=t.continuation,i=t.feed,s=t.network,u=void 0===s?"patient":s,c=t.organizationId,l=t.pageSize,d=t.range,f=t.sortBy,p=void 0===f?"scheduled_time":f,h=t.sortOrder,y=void 0===h?"asc":h;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.search.query({query:(0,I.default)({},d?{range:d}:null,{schedule_message_category:a}),continuation:o,feedLevel:i,network:u,organizationId:c,pageSize:l,returnFields:[],sort:(0,T.default)({},p,y),types:["scheduledMessage"]});case 2:return n=e.sent,r=this._processSearchResults(n.results),e.abrupt("return",{metadata:n.metadata,results:r});case 5:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"update",value:(f=(0,S.default)(j.default.mark(function e(t){var n,r,a=t.attachment,o=t.body,i=t.endDate,s=t.id,u=t.organizationId,c=t.repeating,l=t.startDate,d=t.startTime,f=t.templateId,p=t.timezoneName;return j.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._validate({body:o,endDate:i,id:s,organizationId:u,repeating:c,startDate:l,startTime:d}),e.next=3,this.host.api.scheduledMessages.update({attachment:a,body:o,end_date:i,id:s,organizationId:u,repeating:c,start_date:l,start_time:d,template_id:f,timezone_name:p});case 3:return n=e.sent,r=this.host.models.ScheduledMessage.inject(n),e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_processSearchResults",value:function(e){return e.map(function(e){return e.entity}).filter(function(e){return!e.$deleted})}},{key:"_validate",value:function(e){var t=e.body,n=e.endDate,r=e.id,a=e.organizationId,o=e.recipients,i=e.repeating,s=e.sendNow,u=e.shouldCheckId,c=void 0===u||u,l=e.shouldCheckInvalid,d=void 0===l||l,f=e.startDate,p=e.startTime;if(c&&!r)throw new G.ValidationError("id","required");if(!a)throw new G.ValidationError("organizationId","required");if(d){if(!t||0===t.trim().length)throw new G.ValidationError("body","invalid","body must be at least 1 character");if(!(c||Array.isArray(o)&&0<o.length&&o.length<=5))throw new G.ValidationError("recipients","invalid","recipients must be an array of ids between 1 and 5 elements");if(!s){var h=Date.parse(f+"T"+p);if(isNaN(h))throw new G.ValidationError("startDate","invalid","start date and time must be the correct format");if(Date.now()>=h)throw new G.ValidationError("startDate","invalid","start date and time must be in the future");if(i){if(!1===["daily","weekly","biweekly","monthly"].includes(i))throw new G.ValidationError("repeating","invalid",'repeating must be either "daily", "weekly", "biweekly", or "monthly"');var y=Date.parse(n+"T"+p);if(isNaN(y))throw new G.ValidationError("endDate","invalid","endDate must be the correct format");if(y<=h)throw new G.ValidationError("endDate","invalid","endDate must be after startDate")}}}}}]),a((l=$).prototype,"downloadScheduledMessageFile",[o],(0,k.default)(l.prototype,"downloadScheduledMessageFile"),l.prototype),a(l.prototype,"fetchHits",[i],(0,k.default)(l.prototype,"fetchHits"),l.prototype),a(l.prototype,"find",[s],(0,k.default)(l.prototype,"find"),l.prototype),a(l.prototype,"findCoarseTimezone",[u],(0,k.default)(l.prototype,"findCoarseTimezone"),l.prototype),a(l.prototype,"search",[c],(0,k.default)(l.prototype,"search"),l.prototype),l);function $(){return(0,R.default)(this,$),(0,C.default)(this,($.__proto__||(0,M.default)($)).apply(this,arguments))}t.default=F,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function fe(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,ye.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=fe(t[0],n);return t.every(function(e){return fe(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return fe(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,be.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+fe(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function pe(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,ye.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=pe(t[0],n);return t.every(function(e){return pe(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return pe(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,be.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+pe(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,h=r(n(3)),y=r(n(11)),he=r(n(29)),ye=r(n(5)),ge=r(n(19)),ve=r(n(22)),me=r(n(10)),be=r(n(4)),we=r(n(18)),_e=r(n(12)),xe=r(n(13)),Ee=r(n(16)),g=r(n(9)),v=r(n(6)),m=r(n(1)),b=r(n(2)),w=r(n(8)),_=r(n(7)),x=r(n(38)),ke=r(n(281)),Te=r(n(45)),Ie=r(n(60)),E=n(20),Ae=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),Oe=n(26),se=r(n(153)),G=n(47),je=n(23),k=n(32),T=n(28),I=r(n(15)),Se=["avatar","conversation_id","department","description","display_name","dnd_auto_forward_receiver","dnd","first_name","group_token","is_public","last_login_time","last_name","members","name","network","num_members","organization_key","pagers","status","title","token","total_members"],Me={distributionList:Oe.SearchType.toServer(Oe.SearchType.DISTRIBUTION_LIST),distributionListMember:Oe.SearchType.toServer(Oe.SearchType.DISTRIBUTION_LIST_MEMBER),forum:Oe.SearchType.toServer(Oe.SearchType.FORUM),group:Oe.SearchType.toServer(Oe.SearchType.GROUP),messageTemplate:Oe.SearchType.toServer(Oe.SearchType.MESSAGE_TEMPLATE),organization:Oe.SearchType.toServer(Oe.SearchType.ORGANIZATION),patient_account:Oe.SearchType.toServer(Oe.SearchType.PATIENT),patientDistributionList:Oe.SearchType.toServer(Oe.SearchType.PATIENT_DISTRIBUTION_LIST),scheduledMessage:Oe.SearchType.toServer(Oe.SearchType.SCHEDULED_MESSAGE),tag:Oe.SearchType.toServer(Oe.SearchType.TAG),team:Oe.SearchType.toServer(Oe.SearchType.TEAM),user:Oe.SearchType.toServer(Oe.SearchType.USER)},Re=(0,x.default)(Me),A=(a=(0,E.decorator)(),f=I.default,(0,_.default)(O,f),(0,b.default)(O,[{key:"query",value:(p=(0,g.default)(me.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P,V,G,N,U,F,$,D,q,L,B,K,Z,H,W,X,Q,Y,J,ee,te,ne,re,ae,oe,ie,se,ue,ce,le,de;return me.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.continuation,r=void 0===n?null:n,a=t.enabledCapabilities,o=void 0===a?[]:a,i=t.excludeEmptyLists,s=void 0!==i&&i,u=t.excludeIds,c=void 0===u?[]:u,l=t.excludeSelf,d=void 0!==l&&l,f=t.followContinuations,p=void 0!==f&&f,h=t.includeDisabled,y=void 0!==h&&h,g=t.network,v=void 0===g?"provider":g,m=t.organizationId,b=void 0===m?null:m,w=t.organizationIds,_=void 0===w?[]:w,x=t.pageSize,E=t.query,k=void 0===E?{}:E,T=t.resultsFormat,I=void 0===T?"entities":T,A=t.returnFields,O=void 0===A?Se:A,j=t.sort,S=void 0===j?[]:j,M=t.types,0===(R=void 0===M?[]:M).length)throw new Ae.ValidationError("types","required","no types specified");e.next=3;break;case 3:if(R=(0,Ie.default)(R.map(function(e){return Oe.SearchType.isValid(e)?Oe.SearchType.toServer(e):Me[e]})),0<(z=(0,Te.default)(R,Re)).length)throw new Ae.ValidationError("types","invalid","invalid types: "+z.join(", "));e.next=7;break;case 7:if(b&&(_=[b]),0===_.length)throw new Ae.ValidationError("organizationIds","invalid","search must be done in a context of an organization");e.next=10;break;case 10:if(1!==_.length){e.next=15;break}if((C=this.host.models.Organization.get(b))&&C.isContacts)return P=this._queryLocalOrganization({organization:C,query:k,types:R}),V=P.results,G=P.metadata,e.abrupt("return",{results:V,metadata:G});e.next=15;break;case 15:if("ids"===I&&(I="tokens"),c=(0,je.arrayWrap)(c),N={directory:_,include_disabled:y,render_metadata:!0,results_format:I,return_fields:O,type:R},o.length&&(N.enabled_capabilities=o),S&&S.length?N.sort=S.map(function(e){return je.Camelizer.underscoreKey(e)}):"object"===(void 0===S?"undefined":(0,ye.default)(S))&&(N.sort=S),N.type.includes("schedule_message")&&t.feedLevel&&(N.feed_level=t.feedLevel),isNaN(parseInt(x))||(N.page_size=x),U={},!(k&&0<(0,be.default)(k).length)){e.next=50;break}if(!(B=(0,ve.default)(k))||"function"!=typeof B[xe.default]&&!Array.isArray(B))throw new TypeError("Expected _Object$entries to be iterable, got "+fe(B));e.next=27;break;case 27:if(!B||"function"!=typeof B[xe.default]&&!Array.isArray(B))throw new TypeError("Expected _Object$entries to be iterable, got "+pe(B));e.next=29;break;case 29:for($=!(F=!0),D=void 0,e.prev=32,q=(0,_e.default)(B);!(F=(L=q.next()).done);F=!0)K=(0,ge.default)(L.value,2),Z=K[0],H=K[1],Z.includes(",")&&(W=Z.split(",").map(je.Camelizer.underscoreKey).join(","),U[W]=H,delete k[Z]);e.next=40;break;case 36:e.prev=36,e.t0=e.catch(32),$=!0,D=e.t0;case 40:e.prev=40,e.prev=41,!F&&q.return&&q.return();case 43:if(e.prev=43,$)throw D;e.next=46;break;case 46:return e.finish(43);case 47:return e.finish(40);case 48:U=(0,Ee.default)({},U,je.Camelizer.underscoreObject(k)),N.bool={must:U};case 50:return s&&(R.includes("distribution_list")||R.includes("patient_distribution_list"))&&(N.bool=(0,he.default)({},N.bool,{must_not:{total_members:"0"}})),X=[{continuation:r,excludeIds:c,excludeSelf:d,followContinuations:p,network:v,params:N}],e.next=55,we.default.all(X.map(this._query));case 55:if(Q=e.sent,Y=[],!Q||"function"!=typeof Q[xe.default]&&!Array.isArray(Q))throw new TypeError("Expected allResults to be iterable, got "+fe(Q));e.next=59;break;case 59:if(!Q||"function"!=typeof Q[xe.default]&&!Array.isArray(Q))throw new TypeError("Expected allResults to be iterable, got "+pe(Q));e.next=61;break;case 61:ee=!(J=!0),te=void 0,e.prev=64,ne=(0,_e.default)(Q);case 66:if(J=(re=ne.next()).done){e.next=95;break}if(ae=re.value,!(oe=ae.results)||"function"!=typeof oe[xe.default]&&!Array.isArray(oe))throw new TypeError("Expected results to be iterable, got "+fe(oe));e.next=71;break;case 71:if(!oe||"function"!=typeof oe[xe.default]&&!Array.isArray(oe))throw new TypeError("Expected results to be iterable, got "+pe(oe));e.next=73;break;case 73:for(se=!(ie=!0),ue=void 0,e.prev=76,ce=(0,_e.default)(oe);!(ie=(le=ce.next()).done);ie=!0)de=le.value,Y.push(de);e.next=84;break;case 80:e.prev=80,e.t1=e.catch(76),se=!0,ue=e.t1;case 84:e.prev=84,e.prev=85,!ie&&ce.return&&ce.return();case 87:if(e.prev=87,se)throw ue;e.next=90;break;case 90:return e.finish(87);case 91:return e.finish(84);case 92:J=!0,e.next=66;break;case 95:e.next=101;break;case 97:e.prev=97,e.t2=e.catch(64),ee=!0,te=e.t2;case 101:e.prev=101,e.prev=102,!J&&ne.return&&ne.return();case 104:if(e.prev=104,ee)throw te;e.next=107;break;case 107:return e.finish(104);case 108:return e.finish(101);case 109:return Y=(0,ke.default)(Y,"entity"),e.abrupt("return",{results:Y,metadata:Q[0].metadata});case 111:case"end":return e.stop()}},e,this,[[32,36,40,48],[41,,43,47],[64,97,101,109],[76,80,84,92],[85,,87,91],[102,,104,108]])})),function(e){return p.apply(this,arguments)})},{key:"_queryLocalOrganization",value:function(e){var t=e.organization,n=e.query,r=e.types,a=t.id,o=this._searchLocalOrganization({organization:t,query:n,types:r}),i={firstHit:1,totalHits:o.length},s=(0,be.default)(n);if(0===o.length&&0<s.length){var u=s.find(function(e){return e.includes("displayName")}),c=u?n[u]:n[s[0]];if((0,k.isEmail)(c)||(0,T.isPhone)(c)){var l=(0,k.isEmail)(c)?c:(0,T.normalizePhoneUS)(c),d=this.host.models.User.createInstance({displayName:(0,T.isPhone)(c)?(0,T.formatPhone)(c):c,id:l,messageAnyoneRecipient:!0,organizationId:a});return{results:[new se.default(d,a,i)],metadata:i}}}return{results:o,metadata:i}}}]),i=(o=O).prototype,s="query",u=[a],c=(0,y.default)(o.prototype,"query"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function O(){var e,t,oe,n,r,ie=this;(0,m.default)(this,O);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=oe=(0,w.default)(this,(e=O.__proto__||(0,v.default)(O)).call.apply(e,[this].concat(o))),oe._query=(r=(0,g.default)(me.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,C,P,V,G,N,U,F,$,D,q,L,B,K,Z,H,W,X,Q,Y,J,ee,te,ne,re,ae;return me.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.continuation,r=void 0===n?null:n,a=t.excludeIds,o=void 0===a?[]:a,i=t.excludeSelf,s=void 0!==i&&i,u=t.followContinuations,c=void 0!==u&&u,l=t.network,d=void 0===l?"provider":l,f=t.params,r&&(f=(0,Ee.default)({},f,{continuation:r})),p=void 0,h=[],"patient"===d||f.type.includes("patient_account"))return e.next=7,oe.host.api.search.patientQuery(f);e.next=11;break;case 7:(p=e.sent).metadata.continuation||(p.metadata.continuation=null),e.next=14;break;case 11:return e.next=13,oe.host.api.search.query(f);case 13:p=e.sent;case 14:if(h=p.results,y=[],!h||"function"!=typeof h[xe.default]&&!Array.isArray(h))throw new TypeError("Expected entries to be iterable, got "+fe(h));e.next=18;break;case 18:if(!h||"function"!=typeof h[xe.default]&&!Array.isArray(h))throw new TypeError("Expected entries to be iterable, got "+pe(h));e.next=20;break;case 20:v=!(g=!0),m=void 0,e.prev=23,b=(0,_e.default)(h);case 25:if(g=(w=b.next()).done){e.next=41;break}if(_=w.value,x=_.type,E=_.entity,k=_.organization_id,T={entityAttrs:E,organizationId:k,type:x},oe.config.condensedReplays?E.conversation_id?(T.conversationId=E.conversation_id,delete E.conversation_id):T.conversationId=_.conversation_id:delete E.conversation_id,0===(0,be.default)(E).length)return e.abrupt("continue",38);e.next=34;break;case 34:"tigertext:entity:account"===x?(0,je.replaceKey)(E,"status","account_status"):"tigertext:entity:tag"===x&&(E.token=k+":"+E.token),(I=E.metadata)&&oe.host.metadata.__injectMetadata(E.token,k,I),y.push(T);case 38:g=!0,e.next=25;break;case 41:e.next=47;break;case 43:e.prev=43,e.t0=e.catch(23),v=!0,m=e.t0;case 47:e.prev=47,e.prev=48,!g&&b.return&&b.return();case 50:if(e.prev=50,v)throw m;e.next=53;break;case 53:return e.finish(50);case 54:return e.finish(47);case 55:return A=p.metadata,O=A.continuation,j=A.first_hit,S=A.total_hits,M={firstHit:j,totalHits:S},O&&(c?M.firstHit=1:M.continuation=O),R=[],z=[],C=function(e){var t=e.results;if(!t||"function"!=typeof t[xe.default]&&!Array.isArray(t))throw new TypeError("Expected results to be iterable, got "+fe(t));if(!t||"function"!=typeof t[xe.default]&&!Array.isArray(t))throw new TypeError("Expected results to be iterable, got "+pe(t));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,_e.default)(t);!(n=(o=i.next()).done);n=!0){var s=o.value;R.push(s)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}},c&&O&&z.push(oe._query((0,Ee.default)({},t,{continuation:O})).then(C)),e.next=64,we.default.all(z);case 64:if(P=[],!y||"function"!=typeof y[xe.default]&&!Array.isArray(y))throw new TypeError("Expected candidates to be iterable, got "+fe(y));e.next=67;break;case 67:if(!y||"function"!=typeof y[xe.default]&&!Array.isArray(y))throw new TypeError("Expected candidates to be iterable, got "+pe(y));e.next=69;break;case 69:G=!(V=!0),N=void 0,e.prev=72,U=(0,_e.default)(y);case 74:if(V=(F=U.next()).done){e.next=98;break}if($=F.value,D=$.conversationId,q=$.entityAttrs,L=$.organizationId,B=$.type,K=oe.host.modelNameByTypeNS(B),(Z="group"===K&&oe.host.groups.__extractGroupTypeFromAttrs(q))===Oe.GroupType.FORUM&&delete q.members,H=oe.host.metadata.get(q.token,L),W=H?H.data:null,"user"===(X=oe.host.conversations.__injectCounterParty({conversationId:D,entityAttrs:q,entityType:K,groupType:Z,hasCurrentUser:!1,organizationId:L})).$entityType&&W&&"role"===W.feature_service&&oe.host.roles.__injectSearchResult({entity:X,metadata:W,organizationId:L}),o.length&&o.includes(X.id))return e.abrupt("continue",95);e.next=86;break;case 86:if(Q=oe.host.currentUserId,s&&X.id===Q)return e.abrupt("continue",95);e.next=89;break;case 89:if(X){e.next=92;break}return oe.logger.warn("no entity for ",$),e.abrupt("continue",95);case 92:X.isRoleBot&&X.botRole&&(X=X.botRole),Y=new se.default(X,L,D,W),P.unshift(Y);case 95:V=!0,e.next=74;break;case 98:e.next=104;break;case 100:e.prev=100,e.t1=e.catch(72),G=!0,N=e.t1;case 104:e.prev=104,e.prev=105,!V&&U.return&&U.return();case 107:if(e.prev=107,G)throw N;e.next=110;break;case 110:return e.finish(107);case 111:return e.finish(104);case 112:if(!P||"function"!=typeof P[xe.default]&&!Array.isArray(P))throw new TypeError("Expected immediateResults to be iterable, got "+fe(P));e.next=114;break;case 114:if(!P||"function"!=typeof P[xe.default]&&!Array.isArray(P))throw new TypeError("Expected immediateResults to be iterable, got "+pe(P));e.next=116;break;case 116:for(ee=!(J=!0),te=void 0,e.prev=119,ne=(0,_e.default)(P);!(J=(re=ne.next()).done);J=!0)ae=re.value,R.unshift(ae);e.next=127;break;case 123:e.prev=123,e.t2=e.catch(119),ee=!0,te=e.t2;case 127:e.prev=127,e.prev=128,!J&&ne.return&&ne.return();case 130:if(e.prev=130,ee)throw te;e.next=133;break;case 133:return e.finish(130);case 134:return e.finish(127);case 135:return e.abrupt("return",{results:R,metadata:M});case 136:case"end":return e.stop()}},e,ie,[[23,43,47,55],[48,,50,54],[72,100,104,112],[105,,107,111],[119,123,127,135],[128,,130,134]])})),function(e){return r.apply(this,arguments)}),oe._searchLocalOrganization=function(e){var t=e.organization,n=e.query,r=e.types,a=void 0===r?[]:r,o=t.conversations,i=t.id,s=[];if(!o||"function"!=typeof o[xe.default]&&!Array.isArray(o))throw new TypeError("Expected conversations to be iterable, got "+fe(o));if(!o||"function"!=typeof o[xe.default]&&!Array.isArray(o))throw new TypeError("Expected conversations to be iterable, got "+pe(o));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,_e.default)(o);!(u=(d=f.next()).done);u=!0){var p=d.value,h=p.counterParty,y=p.counterPartyType,g=p.metadata,v=Me[y];if(a.includes(v))if(n&&0!==(0,be.default)(n).length){var m=!0;if(!(k=(0,ve.default)(n))||"function"!=typeof k[xe.default]&&!Array.isArray(k))throw new TypeError("Expected _Object$entries2 to be iterable, got "+fe(k));if(!k||"function"!=typeof k[xe.default]&&!Array.isArray(k))throw new TypeError("Expected _Object$entries2 to be iterable, got "+pe(k));var b=!0,w=!1,_=void 0;try{for(var x,E=(0,_e.default)(k);!(b=(x=E.next()).done);b=!0){var k,T=(0,ge.default)(x.value,2),I=T[0],A=T[1];I=I.split(","),A=A.toLowerCase();var O=!1;if(!I||"function"!=typeof I[xe.default]&&!Array.isArray(I))throw new TypeError("Expected fields to be iterable, got "+fe(I));if(!I||"function"!=typeof I[xe.default]&&!Array.isArray(I))throw new TypeError("Expected fields to be iterable, got "+pe(I));var j=!0,S=!1,M=void 0;try{for(var R,z=(0,_e.default)(I);!(j=(R=z.next()).done);j=!0){var C=R.value,P="user"===y&&G.PROFILE_ATTRIBUTES_PER_ORG.includes(C)?h.profileByOrganizationId[i]:h;if(P){var V=P[C];if(void 0!==V&&V.toLowerCase().includes(A)){O=!0;break}}}}catch(e){S=!0,M=e}finally{try{!j&&z.return&&z.return()}finally{if(S)throw M}}if(!O){m=!1;break}}}catch(e){w=!0,_=e}finally{try{!b&&E.return&&E.return()}finally{if(w)throw _}}m&&s.push(new se.default(h,i,g))}else s.push(new se.default(h,i,g))}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}return s},n=t,(0,w.default)(oe,n)}t.default=A,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,O.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,A.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,I.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,O.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,A.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,I.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I=r(n(3)),A=r(n(4)),O=r(n(5)),j=r(n(11)),S=r(n(29)),M=r(n(12)),R=r(n(13)),z=r(n(18)),C=r(n(10)),P=r(n(9)),V=r(n(6)),G=r(n(1)),N=r(n(2)),U=r(n(8)),F=r(n(7)),$=r(n(35)),D=n(20),q=r(n(15)),L=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),B=(o=(0,D.decorator)(),i=(0,D.decorator)(),c=(0,D.decorator)(),l=(0,D.decorator)(),d=(0,D.decorator)(),p=q.default,(0,F.default)(K,p),(0,N.default)(K,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"find",value:(T=(0,P.default)(C.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.organizationId,s=o.bypassCache,u=void 0!==s&&s;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),t){e.next=3;break}throw new L.ValidationError("id","required");case 3:if(i){e.next=5;break}throw new L.ValidationError("organizationId","required");case 5:if(n=void 0,u){e.next=10;break}if((n=this.host.models.Team.get(t))&&!n.$placeholder)return e.abrupt("return",n);e.next=10;break;case 10:return e.next=12,this.host.api.teams.find(t,{organizationId:i});case 12:return r=e.sent,a=r.team,n=this.host.models.Team.inject(a),e.abrupt("return",n);case 16:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"refresh",value:(k=(0,P.default)(C.default.mark(function e(t){var n,r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t,{organizationId:r,bypassCache:!0});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"findAll",value:(E=(0,P.default)(C.default.mark(function e(){var t,n,r,a,o=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).bypassCache,i=void 0!==o&&o;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i&&this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["team"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(){return E.apply(this,arguments)})},{key:"findByOrganizationId",value:(x=(0,P.default)(C.default.mark(function e(t){var n,r,a,o;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+u(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+s(t));case 4:return t=this._resolveModelId(t),e.next=7,this.host.organizations.find(t);case 7:return n=e.sent,e.next=10,this.host.search.query({types:["team"],organizationIds:n.id,query:{displayName:""},followContinuations:!0});case 10:return r=e.sent,a=r.results,o=a.map(function(e){return e.entity}),e.abrupt("return",o);case 14:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"refreshAll",value:(_=(0,P.default)(C.default.mark(function e(){var t;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findAll({bypassCache:!0});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Team.getAll()}},{key:"create",value:(w=(0,P.default)(C.default.mark(function e(t){var n,r,a,o,i=this,s=t.avatar,u=t.canMembersLeave,c=void 0===u||u,l=t.canRequestToJoin,d=void 0===l||l,f=t.description,p=t.displayName,h=t.memberIds,y=void 0===h?[]:h,g=t.organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),g){e.next=3;break}throw new L.ValidationError("organizationId","required");case 3:if(y.length<2)throw new L.ValidationError("memberIds","required to have 2 or more IDs");e.next=5;break;case 5:return e.next=7,z.default.all(y.map(this.host.roles.__resolveRoleId).filter(Boolean).map(function(e){return i._resolveModelIdWithTypes(e,"user")}).map(function(e){return i.host.users.find(e,{organizationId:g})}));case 7:return n=e.sent,e.t0=n,r=$.default.call(e.t0),y=r.map(function(e){return i._resolveModelIdWithTypes(e,"user")}),e.next=13,this.host.api.teams.create({avatar:s,canMembersLeave:c,canRequestToJoin:d,description:f,displayName:p,memberIds:y,organizationId:g});case 13:return a=e.sent,o=this.host.models.Team.inject(a.team),e.abrupt("return",o);case 16:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"update",value:(b=(0,P.default)(C.default.mark(function e(t){var n,r,a=t.avatar,o=t.canMembersLeave,i=void 0===o||o,s=t.canRequestToJoin,u=void 0===s||s,c=t.description,l=t.displayName,d=t.id,f=t.memberIds,p=void 0===f?[]:f,h=t.organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),d){e.next=3;break}throw new L.ValidationError("id","required");case 3:if(h){e.next=5;break}throw new L.ValidationError("organizationId","required");case 5:if(p.length<2)throw new L.ValidationError("memberIds","required to have 2 or more IDs");e.next=7;break;case 7:return p=p.map(this.host.roles.__resolveRoleId),e.next=10,this.host.api.teams.update({avatar:a,canMembersLeave:i,canRequestToJoin:u,description:c,displayName:l,id:d,memberIds:p,organizationId:h});case 10:return n=e.sent,r=this.host.models.Team.inject(n.team),e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"delete",value:(m=(0,P.default)(C.default.mark(function e(t,n){var r,a,o=n.organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}throw new L.ValidationError("organizationId","required");case 2:if(t){e.next=4;break}throw new L.ValidationError("teamId","required");case 4:return e.next=6,this.host.api.teams.delete(t,{organizationId:o});case 6:return 204===(r=e.sent)&&(a=this.host.models.Team.get(t))&&this.host.models.Team.eject(a),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"requestToJoin",value:(v=(0,P.default)(C.default.mark(function e(t,n){var r,a=n.requestedById,o=n.organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}throw new L.ValidationError("organizationId","required");case 2:if(t){e.next=4;break}throw new L.ValidationError("teamId","required");case 4:if(a){e.next=6;break}throw new L.ValidationError("requestedById","required");case 6:return e.next=8,this.host.api.teams.requestToJoin(t,{requestedById:a,organizationId:o});case 8:return 204===(r=e.sent)&&this.host.models.Team.inject({id:t,hasCurrentUserPending:!0}),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"acceptJoinRequest",value:(g=(0,P.default)(C.default.mark(function e(t,n){var r,a=n.teamId,o=n.organizationId,i=n.handledAsId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}throw new L.ValidationError("organizationId","required");case 2:if(a){e.next=4;break}throw new L.ValidationError("teamId","required");case 4:if(t){e.next=6;break}throw new L.ValidationError("requestId","required");case 6:if(i){e.next=8;break}throw new L.ValidationError("handledAsId","required");case 8:return e.next=10,this.host.api.teams.updateJoinRequest(t,{teamId:a,organizationId:o,handledAsId:i,status:"accepted"});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"declineJoinRequest",value:(y=(0,P.default)(C.default.mark(function e(t,n){var r,a=n.teamId,o=n.organizationId,i=n.handledAsId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}throw new L.ValidationError("organizationId","required");case 2:if(a){e.next=4;break}throw new L.ValidationError("teamId","required");case 4:if(t){e.next=6;break}throw new L.ValidationError("requestId","required");case 6:if(i){e.next=8;break}throw new L.ValidationError("handledAsId","required");case 8:return e.next=10,this.host.api.teams.updateJoinRequest(t,{teamId:a,organizationId:o,handledAsId:i,status:"declined"});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"leave",value:(h=(0,P.default)(C.default.mark(function e(t){var n,r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return C.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new L.ValidationError("teamId","required");case 2:if(r){e.next=4;break}throw new L.ValidationError("organizationId","required");case 4:return e.next=6,this.host.api.teams.leave(t,{organizationId:r});case 6:return 204===(n=e.sent)&&this.refresh(t,{organizationId:r}),e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"_setHasUserPending",value:function(e){if(e.pendingRequestUserIds){if(!(i=e.pendingRequestUserIds)||"function"!=typeof i[R.default]&&!Array.isArray(i))throw new TypeError("Expected _entity$pendingReques to be iterable, got "+s(i));if(!i||"function"!=typeof i[R.default]&&!Array.isArray(i))throw new TypeError("Expected _entity$pendingReques to be iterable, got "+u(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,M.default)(i);!(t=(a=o.next()).done);t=!0){var i;if(a.value===this.host.currentUserId)return void(e.hasCurrentUserPending=!0)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}}},{key:"__injectTeamRequest",value:function(e){if(!e.id)return null;var t=void 0;if(e.created_by&&e.created_by.token&&(t=this.host.models.User.inject(e.created_by)),e.team&&e.team.id){var n=e.status,r=(0,S.default)({},e.team);t&&t.id===this.host.currentUserId&&("accepted"===n?(r.hasCurrentUserBeenDeclined=!1,r.hasCurrentUserPending=!1):"declined"===n&&(r.hasCurrentUserBeenDeclined=!0,r.hasCurrentUserPending=!1)),this.host.models.Team.inject(r)}return this.host.models.TeamRequest.inject(e)}},{key:"resetDeclinedUserOnTeam",value:function(e){this.host.models.Team.inject({id:e,hasCurrentUserBeenDeclined:!1})}}]),a((f=K).prototype,"find",[o],(0,j.default)(f.prototype,"find"),f.prototype),a(f.prototype,"refresh",[i],(0,j.default)(f.prototype,"refresh"),f.prototype),a(f.prototype,"findAll",[c],(0,j.default)(f.prototype,"findAll"),f.prototype),a(f.prototype,"findByOrganizationId",[l],(0,j.default)(f.prototype,"findByOrganizationId"),f.prototype),a(f.prototype,"refreshAll",[d],(0,j.default)(f.prototype,"refreshAll"),f.prototype),f);function K(){return(0,G.default)(this,K),(0,U.default)(this,(K.__proto__||(0,V.default)(K)).apply(this,arguments))}t.default=B,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,f,p,h,y=r(n(3)),g=r(n(4)),v=r(n(5)),m=r(n(11)),b=r(n(10)),w=r(n(9)),_=r(n(6)),x=r(n(1)),E=r(n(2)),k=r(n(8)),T=r(n(7)),I=r(n(61)),A=r(n(88)),O=r(n(55)),j=r(n(56)),S=r(n(62)),M=n(20),R=r(n(15)),z=r(n(71)),C=z.default.GLOBAL,P=(o=(0,M.decorator)(),i=(0,M.decorator)(),u=R.default,(0,T.default)(V,u),(0,E.default)(V,[{key:"mounted",value:function(){this._lastStartTypingAPICalls={},this._lastStopTypingAPICalls={},this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)}},{key:"dispose",value:function(){var e;(e=(e=(e=(e=this._typers,A.default).call(e),j.default).call(e,I.default),O.default).call(e),j.default).call(e,"timer").forEach(function(e){return null!==e&&clearTimeout(e)}),(e=(e=this._currentUserTyping,A.default).call(e),j.default).call(e,"timer").forEach(function(e){return null!==e&&clearTimeout(e)}),this._lastStartTypingAPICalls=null,this._lastStopTypingAPICalls=null,this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)}},{key:"reactToIsTypingEvent",value:function(e){var t,n=e.data;if(this.host.requireUser(),(t=n.proxy_token?n.proxy_token:n.sender_token)!==this.host.currentUserId){var r=n.group_token,a=n.org_token,o=r||a||null,i=r?z.default.GROUP:a?z.default.ORGANIZATION:C,s="typing"===n.status;this.host.models.User.ensureEntity(t,{onlyPlaceholder:!1}),this._setTypingStatusOfUser(o,i,t,s)}}},{key:"startTyping",value:(h=(0,w.default)(b.default.mark(function e(t){var n,r,a=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.autoStopAfterTimeout,s=o.senderId,u=o.organizationId;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||null==t){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object||null==t){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+l(t));case 4:if(void 0===t)return e.abrupt("return");e.next=6;break;case 6:return t=this._resolveModelId(t),s=this._resolveModelId(s),this.host.requireUser(),e.next=11,this._sendStartTyping(t,s,u);case 11:(n=this._currentUserTyping[t])?(clearTimeout(this._currentUserTyping[t].timer),n.timer=null):(n={},this._currentUserTyping[t]=n),r="number"==typeof i?i:this.host.config.clearTypingStatusTimeout,n.timer=setTimeout(function(){a.logger.info("auto stop typing for current user",t),a.stopTyping(t,{senderId:s})},r);case 15:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"_sendStartTyping",value:(p=(0,w.default)(b.default.mark(function e(t,n,r){var a,o,i,s,u,c;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._lastStartTypingAPICalls[t]){e.next=7;break}if(a=this._lastStartTypingAPICalls[t],o=a.expiresAt,i=a.retVal,s=a.lastSenderId,n!==s)return e.next=5,this.stopTyping(t,{senderId:s});e.next=5;break;case 5:if((0,S.default)().isBefore(o))return e.abrupt("return",i);e.next=7;break;case 7:return e.next=9,this.host.api.typingStatus.startTyping(t,n,r);case 9:return u=e.sent,c=(0,S.default)().add(this.config.clearTypingStatusThrottleDelay,"ms"),this._lastStartTypingAPICalls[t]={expiresAt:c,retVal:u,lastSenderId:n},e.abrupt("return",u);case 13:case"end":return e.stop()}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"stopTyping",value:(f=(0,w.default)(b.default.mark(function e(t){var n,r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).senderId;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||null==t){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object||null==t){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+l(t));case 4:if(void 0===t)return e.abrupt("return");e.next=6;break;case 6:return t=this._resolveModelId(t),r=this._resolveModelId(r),this.host.requireUser(),(n=this._currentUserTyping[t])&&null!==n.timer&&(clearTimeout(n.timer),n.timer=null),e.next=13,this._sendStopTyping(t,r);case 13:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_sendStopTyping",value:(c=(0,w.default)(b.default.mark(function e(t,n){var r,a,o,i,s;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._lastStopTypingAPICalls[t])){e.next=5;break}if(a=r.expiresAt,o=r.retVal,(0,S.default)().isBefore(a))return e.abrupt("return",o);e.next=5;break;case 5:return e.next=7,this.host.api.typingStatus.stopTyping(t,n);case 7:return i=e.sent,s=(0,S.default)().add(this.config.clearTypingStatusThrottleDelay,"ms"),this._lastStopTypingAPICalls[t]={expiresAt:s,retVal:i,senderId:n},e.abrupt("return",i);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"_setTypingStatusOfUser",value:function(e,t,n,r){var a=this,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];if("string"!=typeof e&&null!=e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring | null\n\nGot:\n'+d(e));if("string"!=typeof t)throw new TypeError('Value of argument "contextType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));if("boolean"!=typeof r)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+d(r));if(null!=o&&"boolean"!=typeof o)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+d(o));if("string"!=typeof e&&null!=e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring | null\n\nGot:\n'+l(e));if("string"!=typeof t)throw new TypeError('Value of argument "contextType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));if("boolean"!=typeof r)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+l(r));if(null!=o&&"boolean"!=typeof o)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+l(o));e=e||z.default.GLOBAL;var i=this._typers[e];if(r){i||(i={},this._typers[e]=i);var s=i[n],u=s&&null!==s.timer;if(s?clearTimeout(s.timer):(s={},i[n]=s),s.timer=setTimeout(function(){a.logger.info("auto stop typing for other typer",e,n),a._setTypingStatusOfUser(e,t,n,!1,!0)},this.host.config.clearTypingStatusTimeout),u)return}else{var c=i&&i[n];if(!c||null===c.timer)return;clearTimeout(c.timer),c.timer=null}this.emit("change",{userId:n,contextId:e,contextType:t,isTyping:r,timedOut:o})}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+d(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(e));return e=this._resolveModelId(e),this._isUserTypingInContext(C,e)}},{key:"isCurrentUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+d(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(e));e=this._resolveModelId(e);var t=this._currentUserTyping[e];return!!t&&null!==t.timer}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+d(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+d(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));var n=this._typers[e],r=n&&n[t];return!!r&&null!==r.timer}}]),a((s=V).prototype,"_sendStartTyping",[o],(0,m.default)(s.prototype,"_sendStartTyping"),s.prototype),a(s.prototype,"_sendStopTyping",[i],(0,m.default)(s.prototype,"_sendStopTyping"),s.prototype),s);function V(){var e,t,n,r;(0,x.default)(this,V);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=n=(0,k.default)(this,(e=V.__proto__||(0,_.default)(V)).call.apply(e,[this].concat(o))),n._onMessageSending=function(e){n.stopTyping(e.counterPartyId,{senderId:e.senderId})},r=t,(0,k.default)(n,r)}t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,h,y=r(n(3)),g=r(n(4)),v=r(n(5)),m=r(n(11)),b=r(n(16)),w=r(n(10)),_=r(n(9)),x=r(n(6)),E=r(n(1)),k=r(n(2)),T=r(n(8)),I=r(n(7)),A=r(n(15)),O=n(20),j=(o=(0,O.decorator)(),u=(0,O.decorator)(),c=(0,O.decorator)({memoize:!0,serializeArguments:function(e){return e[0]}}),d=A.default,(0,I.default)(S,d),(0,k.default)(S,[{key:"dispose",value:function(){O.decorator.clear(this._findAll)}},{key:"findAll",value:(h=(0,_.default)(w.default.mark(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.userId,r=void 0===n?this.host.currentUserId:n,a=t.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.abrupt("return",this._findAll(r,a));case 2:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"refreshAll",value:(p=(0,_.default)(w.default.mark(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.userId,r=void 0===n?this.host.currentUserId:n,a=t.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),O.decorator.clear(this._findAll),e.abrupt("return",this._findAll(r,a));case 3:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"_findAll",value:(f=(0,_.default)(w.default.mark(function e(u){var t,c,l=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._pickOrganizationId();return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof u)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(u));e.next=2;break;case 2:if("string"!=typeof u)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(u));e.next=4;break;case 4:return e.next=6,this.host.api.userRoles.findAll(u,n);case 6:return t=e.sent,c={userRoles:[],productRoles:[]},t.forEach(function(e){var t=e.organization,n=e.product;if(t){var r=t.organization_id,a=l.host.organizations.getById(r),o=l.host.models.UserRoles.inject((0,b.default)({id:l._getOrganizationKey({organizationId:r,userId:u}),userId:u},t));a&&l.host.models.Organization.touch(a),c.userRoles.push(o)}else if(n){var i=n.product_id,s=l.host.models.ProductRoles.inject((0,b.default)({id:l._getProductKey({productId:i,userId:u}),userId:u},n));l.host.models.Product.inject({id:i}),c.productRoles.push(s)}}),e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_pickOrganizationId",value:function(){var e=this.host.organizations.getAll();return 0===e.length?"placeholder":e[0].id}},{key:"getAllUserRoles",value:function(){return this.host.models.UserRoles.getAll()}},{key:"getByOrganizationId",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).userId,n=void 0===t?this.host.currentUserId:t;if("string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));var r=this._getOrganizationKey({organizationId:e,userId:n});return this.host.models.UserRoles.get(r)}},{key:"_getOrganizationKey",value:function(e){var t=e.organizationId,n=e.userId,r=void 0===n?this.host.currentUserId:n;if(null==e||"string"!=typeof e.organizationId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  organizationId: string;\n  userId?: ?string;\n}\n\nGot:\n"+s(e));if(null==e||"string"!=typeof e.organizationId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  organizationId: string;\n  userId?: ?string;\n}\n\nGot:\n"+i(e));return"userRoles:"+r+":"+t}},{key:"getAllProductRoles",value:function(){return this.host.models.ProductRoles.getAll()}},{key:"getByProductId",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).userId,n=void 0===t?this.host.currentUserId:t;if("string"!=typeof e)throw new TypeError('Value of argument "productId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "productId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));var r=this._getProductKey({productId:e,userId:n});return this.host.models.ProductRoles.get(r)}},{key:"_getProductKey",value:function(e){var t=e.productId,n=e.userId,r=void 0===n?this.host.currentUserId:n;if(null==e||"string"!=typeof e.productId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  productId: string;\n  userId?: ?string;\n}\n\nGot:\n"+s(e));if(null==e||"string"!=typeof e.productId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  productId: string;\n  userId?: ?string;\n}\n\nGot:\n"+i(e));return"productRoles:"+r+":"+t}}]),a((l=S).prototype,"findAll",[o],(0,m.default)(l.prototype,"findAll"),l.prototype),a(l.prototype,"refreshAll",[u],(0,m.default)(l.prototype,"refreshAll"),l.prototype),a(l.prototype,"_findAll",[c],(0,m.default)(l.prototype,"_findAll"),l.prototype),l);function S(){return(0,E.default)(this,S),(0,T.default)(this,(S.__proto__||(0,x.default)(S)).apply(this,arguments))}t.default=j,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function C(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,q.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=C(t[0],n);return t.every(function(e){return C(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return C(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,D.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,$.default)(e))+": "+C(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function P(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,q.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=P(t[0],n);return t.every(function(e){return P(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return P(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,D.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,$.default)(e))+": "+P(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,h,y,g,v,m,b,w,_,x,E,k,T,I,A,O,j,S,M,R,z,V,G,N,U,F,$=r(n(3)),D=r(n(4)),q=r(n(5)),L=r(n(11)),B=r(n(16)),K=r(n(30)),Z=r(n(18)),H=r(n(10)),W=r(n(9)),X=r(n(19)),Q=r(n(22)),Y=r(n(12)),J=r(n(13)),ee=r(n(6)),te=r(n(1)),ne=r(n(2)),re=r(n(8)),ae=r(n(7)),oe=r(n(40)),ie=r(n(45)),se=r(n(25)),ue=r(n(87)),ce=n(20),le=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17)),de=n(47),fe=n(32),pe=n(28),he=r(n(27)),ye=r(n(15)),ge=(o=(0,ce.decorator)({serializeArguments:function(e){return""}}),i=(0,ce.decorator)(),s=(0,ce.decorator)(),u=(0,ce.decorator)(),c=(0,ce.decorator)(),l=(0,ce.decorator)(),d=(0,ce.decorator)(),f=(0,ce.decorator)(),g=ye.default,(0,ae.default)(ve,g),(0,ne.default)(ve,[{key:"mounted",value:function(){this._defaultOrganizationId=null,this._roleMemberIds={},this.host.models.Metadata.on("afterInject",this._onChangeMetadata),this.host.models.Metadata.on("afterEject",this._onChangeMetadata),this.host.models.Role.on("afterInject",this._onChangeRole),this.host.models.Role.on("afterEject",this._onRemoveRole)}},{key:"dispose",value:function(){this._defaultOrganizationId=null,this._roleMemberIds={},this.host.models.Metadata.removeListener("afterInject",this._onChangeMetadata),this.host.models.Metadata.removeListener("afterEject",this._onChangeMetadata),this.host.models.Role.removeListener("afterInject",this._onChangeRole),this.host.models.Role.removeListener("afterEject",this._onRemoveRole)}},{key:"signInWithMagicToken",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new TypeError('Value of argument "magicToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(e));if("string"!=typeof e)throw new TypeError('Value of argument "magicToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));var n={Authorization:"magic-token "+e};return this._signInWithHeaders(n,t)}},{key:"signInWithApiKeyAndSecret",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw new TypeError('Value of argument "apiKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(e));if("string"!=typeof t)throw new TypeError('Value of argument "apiSecret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));if("string"!=typeof e)throw new TypeError('Value of argument "apiKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof t)throw new TypeError('Value of argument "apiSecret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));var r=this.httpClient.getAuthHeaders({key:e,secret:t});return this._signInWithHeaders(r,n)}},{key:"signIn",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));(0,pe.isPhone)(e)&&(e=(0,pe.normalizePhoneUS)(e));var r={Authorization:this.getSignInAuthHeader(e,t)};return this._signInWithHeaders(r,n)}},{key:"_checkPartnerName",value:function(){if(!this.config.partnerName)throw new Error("`partnerName` must be supplied as a config option for `new TigerConnect.Client()`")}},{key:"_signInWithHeaders",value:(F=(0,W.default)(H.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkPartnerName(),e.next=3,this.host.api.users.signIn(t,o);case 3:return n=e.sent,r=this.host.models.User.inject(n.data.user),a=n.data.auth,e.abrupt("return",{auth:a,user:r});case 7:case"end":return e.stop()}},e,this)})),function(e){return F.apply(this,arguments)})},{key:"checkLogin",value:(U=(0,W.default)(H.default.mark(function e(t){var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{udid:void 0};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=4;break;case 4:return this._checkPartnerName(),e.next=7,this.host.api.users.checkLogin(t,r);case 7:return n=e.sent,e.abrupt("return",n.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return U.apply(this,arguments)})},{key:"signUp",value:(N=(0,W.default)(H.default.mark(function e(){var t,n,r,a,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.users.signUp(o);case 2:return t=e.sent,n=this.host.models.User.inject(t.data.user),r=t.data.auth,a={user:n,auth:r},this.host.emit("signUp",a),e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)})),function(){return N.apply(this,arguments)})},{key:"signOut",value:(G=(0,W.default)(H.default.mark(function e(){var t,n,r,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=a.fromServer,i=void 0!==o&&o,s=a.resetClient,u=void 0===s||s;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.isSignedIn){e.next=2;break}return e.abrupt("return",!1);case 2:return n=t=!1,this.host.emit("signingOut",{fromServer:i,resetClient:u}),r=void 0,e.prev=6,e.next=9,this.host.api.users.signOut();case 9:r=e.sent,t=!0,e.next=25;break;case 13:if(e.prev=13,e.t0=e.catch(6),n=!0,!this.httpClient.isUnauthorizedError(e.t0)){e.next=20;break}t=!0,e.next=25;break;case 20:if(!i){e.next=24;break}this.logger.error("error while logging out",e.t0,e.t0.stack),e.next=25;break;case 24:return e.abrupt("return",Z.default.reject(e.t0));case 25:return t&&(this.host._setCurrentUser(null),this.host._removeAuth()),this.host.emit("signedOut",{externalLogoutUrl:n?null:r.data.external_logout_url,fromServer:i,resetClient:u&&t,signedOut:t}),e.abrupt("return",t);case 28:case"end":return e.stop()}},e,this,[[6,13]])})),function(){return G.apply(this,arguments)})},{key:"createQRCode",value:(V=(0,W.default)(H.default.mark(function e(){var t;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.qrCode.create();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)})),function(){return V.apply(this,arguments)})},{key:"findOrCreate",value:(z=(0,W.default)(H.default.mark(function e(t){var n,r,a,o,i,s,u,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if(null!=c&&(null==c||void 0!==c.organizationId&&null!=c.organizationId&&"string"!=typeof c.organizationId))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string\n}\n\nGot:\n'+P(c));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if(null!=c&&(null==c||void 0!==c.organizationId&&null!=c.organizationId&&"string"!=typeof c.organizationId))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string\n}\n\nGot:\n'+C(c));e.next=8;break;case 8:if(n=c.organizationId,r=!1,n)return e.next=13,this.host.organizations._findAll();e.next=15;break;case 13:a=this.host.models.Organization.get(n),r=!!a&&a.isContacts;case 15:if(o=r&&((0,fe.isEmail)(t)||(0,pe.isPhone)(t)),i=void 0,!o||t===this.host.currentUserId||this.getById(t))return e.next=20,this.find(t,{organizationId:n,ignoreNotFound:!0});e.next=21;break;case 20:i=e.sent;case 21:if(!i&&o)return e.next=24,this.host.api.users.lookup(t);e.next=37;break;case 24:if(s=e.sent){e.next=27;break}return e.abrupt("return",null);case 27:if(this.config.condensedReplays){e.next=33;break}return e.next=30,this.find(s.token,{organizationId:n});case 30:i=e.sent,e.next=37;break;case 33:(u=s.entity).conversationId=s.conversation_id,u.organizationId=s.organization_id,i=this.host.models.User.inject(u);case 37:return e.abrupt("return",i);case 38:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"signOutAllDevices",value:(R=(0,W.default)(H.default.mark(function e(){var t;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.users.wipe(this.host.currentUserId);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)})),function(){return R.apply(this,arguments)})},{key:"findMe",value:(M=(0,W.default)(H.default.mark(function e(){var t,n,r,a,o,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,se.default)(i,{ignoreNotFound:!1}),this.host.requireUser(),e.next=4,this.host.api.users.findMe();case 4:if(t=e.sent)return t.entity&&(t.entity.organization_token=t.organization_id,t=t.entity),r=(n=t).metadata,a=n.organization_token,this._defaultOrganizationId=a,o=this.host.models.User.inject(t),r&&this.host.metadata.__injectMetadata(o.id,a,r),e.abrupt("return",o);e.next=14;break;case 14:if(i.ignoreNotFound){e.next=16;break}throw new le.NotFoundError(this.host.models.User.name,"me");case 16:case"end":return e.stop()}},e,this)})),function(){return M.apply(this,arguments)})},{key:"findDefaultOrganizationId",value:(S=(0,W.default)(H.default.mark(function e(){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._defaultOrganizationId){e.next=3;break}return e.next=3,this.findMe();case 3:return e.abrupt("return",this._defaultOrganizationId);case 4:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:"findMyProfilesForAllOrganizations",value:(j=(0,W.default)(H.default.mark(function e(){var t;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.findAll();case 2:return e.t0=function(e){return e.id},t=e.sent.map(e.t0),e.abrupt("return",this.findProfileForOrganizations(this.host.currentUserId,t));case 5:case"end":return e.stop()}},e,this)})),function(){return j.apply(this,arguments)})},{key:"find",value:(O=(0,W.default)(H.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,h,y,g,v,m=this,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if(null==b||null!=b&&(void 0===b.organizationId||null==b.organizationId||"string"==typeof b.organizationId)&&(void 0===b.organizationIds||null==b.organizationIds||Array.isArray(b.organizationIds)&&b.organizationIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string;\n  organizationIds?: ?string[];\n}\n\nGot:\n'+P(b));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if(null==b||null!=b&&(void 0===b.organizationId||null==b.organizationId||"string"==typeof b.organizationId)&&(void 0===b.organizationIds||null==b.organizationIds||Array.isArray(b.organizationIds)&&b.organizationIds.every(function(e){return"string"==typeof e}))){e.next=8;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string;\n  organizationIds?: ?string[];\n}\n\nGot:\n'+C(b));case 8:if(b=(0,se.default)(b,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=this.host.models.User.get(t),a=!(r=void 0),!b.organizationIds){e.next=17;break}r=b.organizationIds,e.next=27;break;case 17:if(!b.organizationId){e.next=21;break}r=[b.organizationId],e.next=27;break;case 21:return a=!1,r=n?[].concat((0,K.default)(n.organizationIds)):[],e.next=25,this.findDefaultOrganizationId();case 25:o=e.sent,r.includes(o)||r.push(o);case 27:if(i=(0,B.default)({},b,{ignoreNotFound:!0}),s=[],!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected organizationIds to be iterable, got "+C(r));e.next=31;break;case 31:if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected organizationIds to be iterable, got "+P(r));e.next=33;break;case 33:for(c=!(u=!0),l=void 0,e.prev=36,d=(0,Y.default)(r);!(u=(f=d.next()).done);u=!0)p=f.value,s.push(this.__find(t,p,i));e.next=44;break;case 40:e.prev=40,e.t0=e.catch(36),c=!0,l=e.t0;case 44:e.prev=44,e.prev=45,!u&&d.return&&d.return();case 47:if(e.prev=47,c)throw l;e.next=50;break;case 50:return e.finish(47);case 51:return e.finish(44);case 52:return e.next=54,Z.default.all(s);case 54:if(h=e.sent,y=h.map(function(e){return e.data}).find(Boolean),g=!!h.find(function(e){return!e.cached}),y&&y.id&&(n=this.host.models.User.get(y.id)),!y||t===y.id||a){e.next=63;break}if(0<(v=(0,ie.default)(n.organizationIds,r)).length)return e.next=63,Z.default.all(v.map(function(e){return m.__find(t,e,i)}));e.next=63;break;case 63:if(this.host.models.User.removePlaceholder({entity:n,attrs:y}),!g||b.ignoreNotFound||y){e.next=66;break}throw new le.NotFoundError(this.host.models.User.name,t);case 66:return e.abrupt("return",n);case 67:case"end":return e.stop()}},e,this,[[36,40,44,52],[45,,47,51]])})),function(e){return O.apply(this,arguments)})},{key:"__find",value:(A=(0,W.default)(H.default.mark(function e(t,n){var r,a,o,i,s,u,c=this,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(n));e.next=8;break;case 8:if(l=(0,se.default)(l,{bypassCache:!1,ignoreNotFound:!1}),r=this.host.models.User.get(t),l.bypassCache){e.next=16;break}if(r&&!r.$placeholder&&r.profileByOrganizationId&&r.profileByOrganizationId[n])return e.next=14,this.host.metadata.find(t,n,l);e.next=16;break;case 14:return this.host.models.User.touch(t),e.abrupt("return",{cached:!0,user:r});case 16:return e.next=18,this.host.api.users.find(t,{organizationId:n});case 18:if((a=e.sent)&&(a.entity&&(a.entity.organization_token=a.organization_id,a.entity.conversation_id=a.conversation_id,a=a.entity),a.token&&(a.id=a.token,delete a.token),i=(o=a).dnd_auto_forward_receivers,s=void 0===i?[]:i,u=o.metadata,s.forEach(function(e){return c.host.models.User.injectPlaceholder(e)}),a.dnd_auto_forward_receivers=s,r=this.host.models.User.inject(a),u&&("role"===u.feature_service?this.host.roles.__injectSearchResult({entity:r,metadata:u,organizationId:n}):this.host.metadata.__injectMetadata(r.id,n,u))),l.ignoreNotFound||a){e.next=22;break}throw new le.NotFoundError(this.host.models.User.name,t);case 22:return e.abrupt("return",{cached:!1,data:a,user:r});case 23:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"findProfileForOrganizations",value:(I=(0,W.default)(H.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+P(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+C(n));case 8:return a=(0,se.default)(a,{bypassCache:!1,ignoreNotFound:!1}),e.next=11,this.find(t,(0,B.default)({},a,{organizationIds:n}));case 11:return r=e.sent,e.abrupt("return",r?r.profileByOrganizationId:r);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return I.apply(this,arguments)})},{key:"findProfileForOrganization",value:(T=(0,W.default)(H.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+P(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+C(n));case 8:return o=(0,se.default)(o,{bypassCache:!1,ignoreNotFound:!0}),"string"!=typeof n&&(n=n.id),e.next=12,this.find(t,(0,B.default)({},o,{organizationId:n}));case 12:return r=e.sent,a=r&&r.profileByOrganizationId&&r.profileByOrganizationId[n],e.abrupt("return",a||null);case 15:case"end":return e.stop()}},e,this)})),function(e,t){return T.apply(this,arguments)})},{key:"ensureUsers",value:(k=(0,W.default)(H.default.mark(function e(t,n){var r,a,o,i,s,u,c,l;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+P(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+P(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+C(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+C(n));case 8:if(this.host.requireUser(),"string"!=typeof n&&(n=n.id),r=[],!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+C(t));e.next=13;break;case 13:if(!t||"function"!=typeof t[J.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+P(t));e.next=15;break;case 15:for(o=!(a=!0),i=void 0,e.prev=18,s=(0,Y.default)(t);!(a=(u=s.next()).done);a=!0)c=u.value,r.push(this.find(c,{organizationId:n,ignoreNotFound:!0}));e.next=26;break;case 22:e.prev=22,e.t0=e.catch(18),o=!0,i=e.t0;case 26:e.prev=26,e.prev=27,!a&&s.return&&s.return();case 29:if(e.prev=29,o)throw i;e.next=32;break;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.next=36,Z.default.all(r);case 36:return l=e.sent,e.abrupt("return",l);case 38:case"end":return e.stop()}},e,this,[[18,22,26,34],[27,,29,33]])})),function(e,t){return k.apply(this,arguments)})},{key:"refresh",value:(E=(0,W.default)(H.default.mark(function e(t){var n;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t,{ignoreNotFound:!0,bypassCache:!0});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"update",value:(x=(0,W.default)(H.default.mark(function e(t){var n,r,a,o,i,s=t.firstName,u=t.lastName,c=t.displayName,l=t.status,d=t.dnd,f=t.dndText,p=t.avatarFile,h=t.removeAvatar,y=arguments;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==y[0]||void 0!==y[0].firstName&&null!=y[0].firstName&&"string"!=typeof y[0].firstName||void 0!==y[0].lastName&&null!=y[0].lastName&&"string"!=typeof y[0].lastName||void 0!==y[0].displayName&&null!=y[0].displayName&&"string"!=typeof y[0].displayName||void 0!==y[0].status&&null!=y[0].status&&"string"!=typeof y[0].status||void 0!==y[0].dnd&&null!=y[0].dnd&&"boolean"!=typeof y[0].dnd||void 0!==y[0].dndText&&null!=y[0].dndText&&"string"!=typeof y[0].dndText||!(void 0===y[0].avatarFile||null==y[0].avatarFile||y[0].avatarFile instanceof Object)||void 0!==y[0].removeAvatar&&null!=y[0].removeAvatar&&"boolean"!=typeof y[0].removeAvatar)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName?: ?string;\n  lastName?: ?string;\n  displayName?: ?string;\n  status?: ?string;\n  dnd?: ?boolean;\n  dndText?: ?string;\n  avatarFile?: ?Object;\n  removeAvatar?: ?boolean;\n}\n\nGot:\n"+P(y[0]));e.next=2;break;case 2:if(null==y[0]||void 0!==y[0].firstName&&null!=y[0].firstName&&"string"!=typeof y[0].firstName||void 0!==y[0].lastName&&null!=y[0].lastName&&"string"!=typeof y[0].lastName||void 0!==y[0].displayName&&null!=y[0].displayName&&"string"!=typeof y[0].displayName||void 0!==y[0].status&&null!=y[0].status&&"string"!=typeof y[0].status||void 0!==y[0].dnd&&null!=y[0].dnd&&"boolean"!=typeof y[0].dnd||void 0!==y[0].dndText&&null!=y[0].dndText&&"string"!=typeof y[0].dndText||!(void 0===y[0].avatarFile||null==y[0].avatarFile||y[0].avatarFile instanceof Object)||void 0!==y[0].removeAvatar&&null!=y[0].removeAvatar&&"boolean"!=typeof y[0].removeAvatar)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName?: ?string;\n  lastName?: ?string;\n  displayName?: ?string;\n  status?: ?string;\n  dnd?: ?boolean;\n  dndText?: ?string;\n  avatarFile?: ?Object;\n  removeAvatar?: ?boolean;\n}\n\nGot:\n"+C(y[0]));e.next=4;break;case 4:return this.host.requireUser(),r=(n={firstName:s,lastName:u,displayName:c,status:l,dnd:d,dndText:f,avatarFile:p,removeAvatar:h},ue.default).call(n,function(e,t){return void 0===e}),e.next=8,this.host.api.users.update(this.host.currentUserId,r);case 8:return a=e.sent,o=(0,oe.default)(r,"removeAvatar","avatarFile"),h?o.avatarUrl=null:void 0!==a.avatarUrl&&(o.avatarUrl=a.avatarUrl),i=this.host.models.User.inject((0,B.default)({id:this.host.currentUserId},o)),e.abrupt("return",i);case 13:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"updatePassword",value:(_=(0,W.default)(H.default.mark(function e(t,n){var r;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(n));e.next=8;break;case 8:return this.host.requireUser(),r=this.host.api.users.updatePassword(this.host.currentUserId,t,n,this.config.productKey),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return _.apply(this,arguments)})},{key:"setAutoForward",value:(w=(0,W.default)(H.default.mark(function e(t,n){var r;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "receiverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "receiverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(n));e.next=8;break;case 8:return this.host.requireUser(),r=this.host.currentUser.dnd,e.next=12,this.host.api.users.setAutoForward(this.host.currentUserId,t,{dnd:r,receiverId:n});case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"removeAutoForward",value:(b=(0,W.default)(H.default.mark(function e(t){return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=4;break;case 4:return this.host.requireUser(),e.next=7,this.host.api.users.removeAutoForward(this.host.currentUserId,t);case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"setEulaAccepted",value:(m=(0,W.default)(H.default.mark(function e(t,n){var r;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if("boolean"!=typeof n)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+P(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if("boolean"!=typeof n)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+C(n));e.next=8;break;case 8:return this.host.requireUser(),e.next=11,this.host.api.users.setEulaAccepted(this.host.currentUserId,t,n);case 11:return r=e.sent,e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"setAwayMessage",value:(v=(0,W.default)(H.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));e.next=2;break;case 2:if(null!=o&&(null==o||"boolean"!=typeof o.dnd||void 0!==o.dndText&&null!=o.dndText&&"string"!=typeof o.dndText))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  dnd: boolean;\n  dndText?: ?string;\n}\n\nGot:\n'+P(o));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=6;break;case 6:if(null!=o&&(null==o||"boolean"!=typeof o.dnd||void 0!==o.dndText&&null!=o.dndText&&"string"!=typeof o.dndText))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  dnd: boolean;\n  dndText?: ?string;\n}\n\nGot:\n'+C(o));e.next=8;break;case 8:return n=o.dnd,r=o.dndText,a=void 0===r?"":r,this.host.requireUser(),e.next=12,this.host.api.users.setAwayMessage(this.host.currentUserId,t,{dnd:n,dndText:a});case 12:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));return this.host.api.users.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"getAll",value:function(){return this.host.models.User.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+P(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+P(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+C(e));return this.host.models.User.getMulti(e)}},{key:"_onChangeCurrentUserRole",value:function(e){var t=e.botUser;if(t){var n=this.host.roles._roleConversations[t.id];if(n){if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected roleConversations to be iterable, got "+C(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected roleConversations to be iterable, got "+P(n));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,Y.default)(n);!(r=(i=s.next()).done);r=!0){var u=i.value,c=!1;if(!(y=u.content)||"function"!=typeof y[J.default]&&!Array.isArray(y))throw new TypeError("Expected _conversation$content to be iterable, got "+C(y));if(!y||"function"!=typeof y[J.default]&&!Array.isArray(y))throw new TypeError("Expected _conversation$content to be iterable, got "+P(y));var l=!0,d=!1,f=void 0;try{for(var p,h=(0,Y.default)(y);!(l=(p=h.next()).done);l=!0){var y,g=p.value;g.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(g),c=!0}}catch(e){d=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw f}}c||this.host.models.Conversation.inject(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}}},{key:"reactToUserPreferencesEvent",value:function(e){this.emit("preferences:change",he.default.camelizeObject(e))}}]),y=h=ve,h.PROFILE_ATTRIBUTES_PER_ORG=de.PROFILE_ATTRIBUTES_PER_ORG,a((p=y).prototype,"signOut",[o],(0,L.default)(p.prototype,"signOut"),p.prototype),a(p.prototype,"findOrCreate",[i],(0,L.default)(p.prototype,"findOrCreate"),p.prototype),a(p.prototype,"signOutAllDevices",[s],(0,L.default)(p.prototype,"signOutAllDevices"),p.prototype),a(p.prototype,"findMe",[u],(0,L.default)(p.prototype,"findMe"),p.prototype),a(p.prototype,"findMyProfilesForAllOrganizations",[c],(0,L.default)(p.prototype,"findMyProfilesForAllOrganizations"),p.prototype),a(p.prototype,"find",[l],(0,L.default)(p.prototype,"find"),p.prototype),a(p.prototype,"__find",[d],(0,L.default)(p.prototype,"__find"),p.prototype),a(p.prototype,"refresh",[f],(0,L.default)(p.prototype,"refresh"),p.prototype),p);function ve(){var e,t,z,n,r,a,s=this;(0,te.default)(this,ve);for(var o=arguments.length,i=Array(o),u=0;u<o;u++)i[u]=arguments[u];return t=z=(0,re.default)(this,(e=ve.__proto__||(0,ee.default)(ve)).call.apply(e,[this].concat(i))),z.PROFILE_ATTRIBUTES_PER_ORG=de.PROFILE_ATTRIBUTES_PER_ORG,z._setMembersOnEntity=function(e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"members",n=e[1<arguments.length&&void 0!==arguments[1]?arguments[1]:"memberIds"],r=e[t];if(n){if(r?r.length=0:r=[],!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected memberIds to be iterable, got "+C(n));if(!n||"function"!=typeof n[J.default]&&!Array.isArray(n))throw new TypeError("Expected memberIds to be iterable, got "+P(n));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Y.default)(n);!(a=(s=u.next()).done);a=!0){var c=s.value,l=z.host.models.User.get(c);l&&r.push(l)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}else r=null;e[t]=r},z._injectPatientEntity=function(e,t,n){var r="patient:"+t;if(e.id=r,e.organizationId=n,e.userId=t,z.host.models.Patient.inject(e),e.patient_contacts){if(!(c=e.patient_contacts)||"function"!=typeof c[J.default]&&!Array.isArray(c))throw new TypeError("Expected _patient$patient_cont to be iterable, got "+C(c));if(!c||"function"!=typeof c[J.default]&&!Array.isArray(c))throw new TypeError("Expected _patient$patient_cont to be iterable, got "+P(c));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Y.default)(c);!(a=(s=u.next()).done);a=!0){var c,l=s.value,d=l.entity?l.entity:l,f=d.token||d.id;d.id=f,d.patientId=r,z.host.models.User.inject(d)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}},z._injectPatientContactEntity=function(e,t){e.entity&&(e=e.entity);var n=e.metadata,r={editVersion:n.edit_version,id:"patientContact:"+e.id,organizationId:t,patientDob:n.patient_dob,patientGender:n.patient_gender,patientId:"patient:"+n.patient_id,patientMrn:n.patient_mrn,phoneNumber:n.phone_number,relationName:n.relation_name,smsOptedOut:n.sms_opted_out,userId:e.id};z.host.models.PatientContact.inject(r)},z._onChangeMetadata=function(e,t){var n=t.entityId,r=z.host.models.User.get(n);r&&z.host.models.User.inject(r)},z._onChangeRole=function(e,t){var n=z.host.currentUserId,r=t.botUserId,a=t.memberIds;a=a||[],r&&z.host.models.User.injectPlaceholder({id:r,botRole:t});var o={},i=z._roleMemberIds[t.id];if(i){if(!i||"function"!=typeof i[J.default]&&!Array.isArray(i))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+C(i));if(!i||"function"!=typeof i[J.default]&&!Array.isArray(i))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+P(i));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,Y.default)(i);!(s=(l=d.next()).done);s=!0){var f=l.value,p=z.host.models.User.get(f);if(p&&!a.includes(f)){var h=p.roles,y=h.indexOf(t);-1<y&&(h.splice(y,1),o[f]=h)}}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}if(!(z._roleMemberIds[t.id]=a)||"function"!=typeof a[J.default]&&!Array.isArray(a))throw new TypeError("Expected memberIds to be iterable, got "+C(a));if(!a||"function"!=typeof a[J.default]&&!Array.isArray(a))throw new TypeError("Expected memberIds to be iterable, got "+P(a));var g=!0,v=!1,m=void 0;try{for(var b,w=(0,Y.default)(a);!(g=(b=w.next()).done);g=!0){var _=b.value,x=z.host.models.User.get(_),E=x?x.roles:[];E.includes(t)||(E.push(t),o[_]=E)}}catch(e){v=!0,m=e}finally{try{!g&&w.return&&w.return()}finally{if(v)throw m}}if(!(j=(0,Q.default)(o))||"function"!=typeof j[J.default]&&!Array.isArray(j))throw new TypeError("Expected _Object$entries to be iterable, got "+C(j));if(!j||"function"!=typeof j[J.default]&&!Array.isArray(j))throw new TypeError("Expected _Object$entries to be iterable, got "+P(j));var k=!0,T=!1,I=void 0;try{for(var A,O=(0,Y.default)(j);!(k=(A=O.next()).done);k=!0){var j,S=(0,X.default)(A.value,2),M=S[0],R=S[1];z.host.models.User.injectPlaceholder({id:M,roles:R}),M===n&&z._onChangeCurrentUserRole(t)}}catch(e){T=!0,I=e}finally{try{!k&&O.return&&O.return()}finally{if(T)throw I}}},z._onRemoveRole=function(e,t){var n=t.botUserId;n&&z.host.models.User.injectPlaceholder({id:n,botRole:null});var r=z._roleMemberIds[t.id];if(r){if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+C(r));if(!r||"function"!=typeof r[J.default]&&!Array.isArray(r))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+P(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Y.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value,l=z.host.models.User.get(c);if(l){var d=l.roles,f=d.indexOf(t);-1<f&&(d.splice(f,1),z.host.models.User.inject(l))}}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}delete z._roleMemberIds[t.id]}},z.getPreferences=(a=(0,W.default)(H.default.mark(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:z.host.currentUserId;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new le.ValidationError("userId","required");case 2:return e.next=4,z.host.api.users.getPreferences(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,s)})),function(){return a.apply(this,arguments)}),z.editPreferences=(r=(0,W.default)(H.default.mark(function e(t){var n=t.quickReplies,r=void 0===n?[]:n,a=t.organizationId,o=t.userId,i=void 0===o?z.host.currentUserId:o;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new le.ValidationError("quickReplies","required");case 2:if(a){e.next=4;break}throw new le.ValidationError("organizationId","required");case 4:if(i){e.next=6;break}throw new le.ValidationError("userId","required");case 6:return e.next=8,z.host.api.users.editPreferences({organizationId:a,quickReplies:r,userId:i});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,s)})),function(e){return r.apply(this,arguments)}),n=t,(0,re.default)(z,n)}t.default=ge,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Users=t.UserRoles=t.TypingStatus=t.Teams=t.Search=t.ScheduledMessages=t.RoleTags=t.Roles=t.Products=t.Presence=t.Patients=t.Organizations=t.Notifications=t.NotificationRouter=t.Mute=t.Metadata=t.MessageTemplates=t.Messages=t.Groups=t.Forums=t.Events=t.EventRouter=t.Escalations=t.Entities=t.DistributionLists=t.Conversations=t.Calls=void 0;var a=r(n(184)),o=r(n(185)),i=r(n(186)),s=r(n(187)),u=r(n(188)),c=r(n(189)),l=r(n(79)),d=r(n(190)),f=r(n(191)),p=r(n(193)),h=r(n(192)),y=r(n(194)),g=r(n(195)),v=r(n(196)),m=r(n(197)),b=r(n(198)),w=r(n(199)),_=r(n(200)),x=r(n(201)),E=r(n(203)),k=r(n(202)),T=r(n(204)),I=r(n(205)),A=r(n(206)),O=r(n(207)),j=r(n(208)),S=r(n(209));t.Calls=a.default,t.Conversations=o.default,t.DistributionLists=i.default,t.Entities=s.default,t.Escalations=u.default,t.EventRouter=c.default,t.Events=l.default,t.Forums=d.default,t.Groups=f.default,t.Messages=p.default,t.MessageTemplates=h.default,t.Metadata=y.default,t.Mute=g.default,t.NotificationRouter=v.default,t.Notifications=m.default,t.Organizations=b.default,t.Patients=w.default,t.Presence=_.default,t.Products=x.default,t.Roles=E.default,t.RoleTags=k.default,t.ScheduledMessages=T.default,t.Search=I.default,t.Teams=A.default,t.TypingStatus=O.default,t.UserRoles=j.default,t.Users=S.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function G(e,t){return"organization"===e&&"conversations"===t}function N(e,t,n){for(var r=(2<arguments.length&&void 0!==n?n:{}).previousValue,a=[],o={},i=[],s=0,u=!1,c=1/0,l=0;l<e.length;l++){var d=e[l],f=d._origIndex,p=d.id,h=d.highestSortNumber,y={_origIndex:f,id:p,highestSortNumber:h,sortNumber:d.sortNumber};if(a.push(y),o[p]=(o[p]||0)+1,1<o[p]&&s++,r&&r.id===p&&r.highestSortNumber===h&&c<h||!r&&c<h){u=!0;var g=e[l-1],v=g._origIndex,m=g.id,b=g.highestSortNumber,w=g.sortNumber;i.push({_origIndex:v,id:m,highestSortNumber:b,sortNumber:w}),i.push(y)}c=h}return{copy:a,duplicateCount:s,outOfOrder:u,outOfOrderElements:i}}function U(e,t,n,r,a){var o=4<arguments.length&&void 0!==a?a:{},i=o.action,s=o.previousValue,u=o.source,c=[],l={},d=0;if(!n||"function"!=typeof n[R.default]&&!Array.isArray(n))throw new TypeError("Expected currModels to be iterable, got "+j(n));if(!n||"function"!=typeof n[R.default]&&!Array.isArray(n))throw new TypeError("Expected currModels to be iterable, got "+S(n));var f=!0,p=!1,h=void 0;try{for(var y,g=(0,M.default)(n);!(f=(y=g.next()).done);f=!0){var v=y.value,m=v._origIndex,b=v.id,w=v.highestSortNumber,_=v.sortNumber;c.push({_origIndex:m,id:b,highestSortNumber:w,sortNumber:_}),l[b]=(l[b]||0)+1,1<l[b]&&d++}}catch(e){p=!0,h=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw h}}if(0<t||0<d){var x=r._origIndex,E=r.id,k=r.highestSortNumber,T=r.sortNumber;return console.error(i+"\n"+u+"\nBefore duplicate count: "+t+"\nAfter duplicate count: "+d,"\nBefore elements ("+e.length+"): ",e,"\nAfter elements ("+c.length+"): ",c,"\nElement info: ",{_origIndex:x,id:E,highestSortNumber:k,sortNumber:T}),s&&console.error("Previous value",{_origIndex:s._origIndex,id:s.id,highestSortNumber:s.highestSortNumber,sortNumber:s.sortNumber}),console.log(new Error("Duplicate items stack trace")),{logged:!0,currCopy:c,counts:l}}return{logged:!1,currCopy:c,counts:l}}function F(e,t,n,r){var a=3<arguments.length&&void 0!==r?r:{},o=a.action,i=a.previousValue,s=a.source,u=t._origIndex,c=t.id,l=t.highestSortNumber,d=t.sortNumber;0===Y&&t.$entityClass.emit("displayInfoDialog","We have automatically corrected a Conversation Store problem, please reach out to Mike O to help us debug it further."),global.duplicateDebug.outOfOrderElements[Y]=e,console.error(o+"\n"+s+"\n\nBefore elements (also saved in window.duplicateDebug.outOfOrderElements["+Y+++"]): ",e,"\nOut of order elements: ",n,"\nElement info: ",{_origIndex:u,id:c,highestSortNumber:l,sortNumber:d}),i&&console.error("Previous value",{_origIndex:i._origIndex,id:i.id,highestSortNumber:i.highestSortNumber,sortNumber:i.sortNumber}),console.log(new Error("Elements out of order stack trace"))}function j(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,s.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=j(t[0],n);return t.every(function(e){return j(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return j(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+j(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function S(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,s.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=S(t[0],n);return t.every(function(e){return S(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return S(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+S(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(3)),s=r(n(5)),u=r(n(16)),c=r(n(4)),a=r(n(19)),o=r(n(31)),g=r(n(230)),l=r(n(83)),d=r(n(228)),f=r(n(231)),v=r(n(29)),p=r(n(1)),h=r(n(2)),M=r(n(12)),R=r(n(13)),y=r(n(53)),m=r(n(61)),b=r(n(91)),w=r(n(39)),_=r(n(40)),x=r(n(277)),E=r(n(278)),k=r(n(25)),$=r(n(46)),D=r(n(263)),T=r(n(272)),I=r(n(261)),A=r(n(59)),O=r(n(58)),z=r(n(265)),C=r(n(249)),q=r(n(55)),P=r(n(252)),V=r(n(56)),L=r(n(253)),B=r(n(35)),K=r(n(88)),Z=r(n(89)),H=r(n(33)),W=n(23),X={computed:{},defaultValues:null,idAttribute:"id",methods:{},parseAttrs:z.default,relations:{belongsTo:{},hasMany:{}}},Q=(0,y.default)("NOT_PROVIDED"),Y=0,J={initRelations:!(global.duplicateDebug={initRelations:{},outOfOrderElements:[],setHighestSortNumber:{conversationId:null},updateRelations:{}}),updateRelationsAdd:!1,updateRelationsRemove:!1},ee=((0,h.default)(te,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,h.default)(te,[{key:"__initRelations",value:function(){var r=this,O=this,e=(0,A.default)(this.options.relations.belongsTo,function(e,t,n){e[n]={get:function(){return O.store.get(t.type,this[t.foreignKey])},set:function(e){this[t.foreignKey]=O.store.resolveId(t.type,e)}}},{});(0,v.default)(this.options.computed,e);var t=(0,A.default)(this.options.relations.hasMany,function(e,t,x){var E=t.filter,k=t.foreignKey,n=t.sortBy,T=t.type,I=r.__getSorted(n),A=r.options;e[x]={get:function(){if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={}),this.$$transientAttrs.relations[x])return this.$$transientAttrs.relations[x];var e=[],t=O.store.models[T];if(t.hasManySortFields){if(!(s=t.getAll())||"function"!=typeof s[R.default]&&!Array.isArray(s))throw new TypeError("Expected _entityModel$getAll to be iterable, got "+j(s));if(!s||"function"!=typeof s[R.default]&&!Array.isArray(s))throw new TypeError("Expected _entityModel$getAll to be iterable, got "+S(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,M.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;if(u[k]===this[O.idAttribute]&&(!E||E(u,this))){var c=(0,D.default)(this.previousHasManySortValues,u[this.idAttribute])?this.previousHasManySortValues[u[this.idAttribute]]:Q;t.previousHasManySortValues[u[t.idAttribute]]=(0,$.default)(u,t.hasManySortFields);var l=A.host,d=[],f=0;if(l.config.condensedReplays&&G(O.name,x)){var p=N(e,u,{previousValue:c===Q?void 0:c}),h=p.copy,y=p.duplicateCount,g=p.outOfOrder,v=p.outOfOrderElements;d=h,f=y,g&&(F(d,u,v,{action:"__initRelations - "+(c===Q?"sorted.add":"sorted.update"),previousValue:c===Q?void 0:c,source:"Elements are out of order in "+O.name+"."+x}),e.sort(I.cmp))}if(c===Q?I.add(e,u):I.update(e,u,{previousValue:c}),l.config.condensedReplays&&!J.initRelations&&G(O.name,x)){var m=U(d,f,e,u,{action:"__initRelations - "+(c===Q?"sorted.add":"sorted.update"),previousValue:c===Q?void 0:c,source:"There are duplicates in "+O.name+"."+x}),b=m.logged,w=m.currCopy,_=m.counts;(J.initRelations=b)&&(global.duplicateDebug.initRelations={beforeElements:d,afterElements:w,counts:_})}}}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}}return this.$$transientAttrs.relations[x]=e},set:function(e){}}},{});(0,v.default)(this.options.computed,t)}},{key:"__getSorted",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[[this.idAttribute,"asc"]],t=(0,W.generateComparator)(e);return new W.SortedArray(t)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,r={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},a={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(n){e.options.defaultValues&&n in e.options.defaultValues&&(a[n]=(0,W.jsonCloneDeep)(e.options.defaultValues[n]),delete e.options.defaultValues[n]),r[n]={get:function(){return n in this.$$transientAttrs?this.$$transientAttrs[n]:n in a?this.$$transientAttrs[n]=a[n]:void 0},set:function(e){var t=global.duplicateDebug.setHighestSortNumber;"conversation"!==this.$entityType||"highestSortNumber"!==n||(0,f.default)(t)||(t.conversationId=this.id,t.highestSortNumber=e,t.stackTrace=new Error("Set Conversation.highestSortNumber")),this.$$transientAttrs[n]=e}}}),(0,v.default)(this.options.computed,r)}},{key:"createInstance",value:function(e){1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||(e=this.parseAttrs(e));var t=e[this.idAttribute];if(this.entitiesById[t]||this.entitiesByServerId[t])throw new Error("called createInstance on an existing instance");return this.__wireInstance(e)}},{key:"__wireInstance",value:function(t){var a=this;this.options.defaultValues&&(0,k.default)(t,(0,W.jsonCloneDeep)(this.options.defaultValues));var n={};this._writablePropertyKeys.forEach(function(e){(0,W.isConfigurableProperty)(t,e)&&(n[e]=t[e],delete t[e])}),(0,d.default)(t,this.options.computed),(0,v.default)(t,n),this.options.instanceEvents&&(0,v.default)(t,H.default.prototype),(0,v.default)(t,this.options.methods),(0,v.default)(t,{toPlainObject:function(e){var t=this,n={};a._computedKeys.forEach(function(e){return n[e]=t[e]});var r=(0,v.default)({},this,n);return delete r.setMaxListeners,delete r.emit,delete r.addListener,delete r.on,delete r.once,delete r.removeListener,delete r.removeAllListeners,delete r.listeners,delete r.listenerCount,delete r.off,delete r.toPlainObject,delete r._events,delete r._maxListeners,r}});var e=t[this.idAttribute];return!e||"serverId"in t||(t.serverId=e),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(t),t}},{key:"inject",value:function(e){var t=void 0,n=void 0;if(this.is(e)){if(n=e,t=this.resolveId(n),this.entitiesById[t]){if(this.__beforeInject(n),this.__register(t,n),this.options.afterAssignment&&this.options.afterAssignment(n),this.__addToHasManyRelationships(n),this.options.afterInject&&this.options.afterInject(n),this.emit("afterInject",this,n),"conversation"===n.$entityType){var r=global.duplicateDebug.setHighestSortNumber;(0,f.default)(r)||null===r.conversationId||(r.conversationId!==n.id?((0,l.default)(r),console.error("Injected a different conversation after setting Conversation.highestSortNumber.\nCheck `window.duplicateDebug.setHighestSortNumber` for details.")):r.conversationId=null)}return n}(0,f.default)(global.duplicateDebug.setHighestSortNumber)||"conversation"!==n.$entityType||(global.duplicateDebug.setHighestSortNumber.conversationId=null)}if(!n&&(e=this.parseAttrs(e),t=this.resolveId(e),!this.isValidId(t)))throw new Error("'"+this.idAttribute+"' is required");var a=!1,o=this.entitiesById[t]||this.entitiesByServerId[t];return n?(o||(a=!0),this.__beforeInject(n)):o?(n=o,this.__beforeInject(e,n),(0,v.default)(n,e)):(a=!0,n=this.__wireInstance(e),this.__beforeInject(n)),this.__register(t,n),this.options.afterAssignment&&this.options.afterAssignment(n),this.__addToHasManyRelationships(n),this.options.afterInject&&this.options.afterInject(n),this.emit("afterInject",this,n),a&&(this.options.afterCreate&&this.options.afterCreate(n),this.emit("afterCreate",this,n)),n}},{key:"__beforeInject",value:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],o=n[1];!o||"serverId"in a||(a.serverId=o.serverId),this.options.beforeInject&&(e=this.options).beforeInject.apply(e,n),this.emit("beforeInject",this,a)}},{key:"replaceExisting",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).instance,n=this.options.idAttribute;if(this.is(e))throw new Error("cannot call replaceExisting() on an instance; should be plain object");if(t&&!this.is(t))throw new Error("provided 'instance' option is not an instance of this model");e=this.parseAttrs(e);var r=this.resolveId(e);if(!this.isValidId(r))throw new Error("'"+n+"' is required");var a=r,o=void 0;if(t){var i=this.resolveId(t);a!==i&&(this.entitiesById[a]?(this.eject(t),t=null):a=i)}if(t||(t=this.entitiesById[a]||this.entitiesByServerId[a])&&(a=t[n]),t){var s={};for(var u in e)s[u]=!0;if(this.__beforeInject(e,t),!(h=(0,g.default)(t))||"function"!=typeof h[R.default]&&!Array.isArray(h))throw new TypeError("Expected _Object$getOwnPropert to be iterable, got "+j(h));if(!h||"function"!=typeof h[R.default]&&!Array.isArray(h))throw new TypeError("Expected _Object$getOwnPropert to be iterable, got "+S(h));var c=!0,l=!1,d=void 0;try{for(var f,p=(0,M.default)(h);!(c=(f=p.next()).done);c=!0){var h,y=f.value;!s[y]&&(0,W.isConfigurableProperty)(t,y)&&delete t[y]}}catch(e){l=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw d}}(0,v.default)(t,e),t[n]=a,t.serverId=r,this.__wireInstance(t)}else o=!0,t=this.__wireInstance(e),this.__beforeInject(t);return this.__register(a,t),this.options.afterAssignment&&this.options.afterAssignment(t),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),o&&(this.options.afterCreate&&this.options.afterCreate(t),this.emit("afterCreate",this,t)),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e]||this.entitiesByServerId[e];t&&(this.emit("beforeEject",this,t),this.__removeFromHasManyRelationships(t),this.__unregister(e,t),this.emit("afterEject",this,t))}},{key:"__register",value:function(e,t){this.entitiesById[e]!==t&&(this.entitiesById[e]=t,this.entitiesList.push(t));var n=this.previousServerIds[e],r=t.serverId;n&&n!==r&&(delete this.entitiesByServerId[n],r===e?delete this.previousServerIds[e]:(this.entitiesByServerId[r]=t,this.previousServerIds[e]=r)),n||r===e||(this.entitiesByServerId[r]=t,this.previousServerIds[e]=r)}},{key:"__unregister",value:function(e,t){delete this.entitiesById[e],(0,E.default)(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e];var n=this.previousServerIds[e];n&&(delete this.entitiesByServerId[n],delete this.previousServerIds[e])}},{key:"injectPlaceholder",value:function(e){var t=e.token||e[this.idAttribute];if(this.get(t))return this.inject(e);var n=this.createInstance(e);return Object.defineProperty(n,"$placeholder",{value:!0,configurable:!0}),this.inject(n)}},{key:"removePlaceholder",value:function(e){var t=e.entity,n=e.attrs;t&&t.$placeholder&&(n?(delete t.$placeholder,delete t.$notFound):Object.defineProperty(t,"$notFound",{value:!0,configurable:!0}),this.inject(t))}},{key:"touch",value:function(e){e=this.resolveId(e),(this.entitiesById[e]||this.entitiesByServerId[e])&&this.inject((0,o.default)({},this.idAttribute,e))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(z,C){var P=this,e=this.store.getParentRelationshipsOfModel(this.name);if(e){var t;this.hasManySortFields||(this.hasManySortFields=(t=(t=e.map(function(e){var t=e.sortBy;return t&&t.map(function(e){return(0,a.default)(e,1)[0]})}).filter(Boolean),q.default).call(t).concat([this.idAttribute]),B.default).call(t));var V=(0,D.default)(this.previousHasManySortValues,z[this.idAttribute])?this.previousHasManySortValues[z[this.idAttribute]]:Q;this.previousHasManySortValues[z[this.idAttribute]]=(0,$.default)(z,this.hasManySortFields),e.forEach(function(e){var t=e.filter,n=e.foreignKey,r=e.relationKey,a=e.sortBy,o=e.sorted,i=P.store.get(e.parent,z[n]);if(i&&i.$$transientAttrs.relations&&i.$$transientAttrs.relations[r]){var s=!1;if("remove"===C||t&&!t(z,i))if(a){var u=P.options.host,c=[],l=0;if(u.config.condensedReplays&&G(e.parent,r)){var d=N(i[r],z,{previousValue:V===Q?void 0:V}),f=d.copy,p=d.duplicateCount,h=d.outOfOrder,y=d.outOfOrderElements;c=f,l=p,h&&(F(c,z,y,{action:"__updateRelationsIfNeeded action:remove - sorted.remove",previousValue:V===Q?void 0:V,source:"Elements are out of order in "+e.parent+"."+r}),i[r].sort(o.cmp))}if(s=V===Q?o.remove(i[r],z):o.remove(i[r],z,{previousValue:V}),u.config.condensedReplays&&!J.updateRelationsRemove&&G(e.parent,r)){var g=U(c,l,i[r],z,{action:"__updateRelationsIfNeeded action:remove - sorted.remove",previousValue:V===Q?void 0:V,source:"There are duplicates in "+e.parent+"."+r}),v=g.logged,m=g.currCopy,b=g.counts;(J.updateRelationsRemove=v)&&(global.duplicateDebug.updateRelations.remove={beforeElements:c,afterElements:m,counts:b})}}else{var w=i[r].indexOf(z);-1!==w&&(i[r].splice(w,1),s=!0)}else if("add"===C)if(a){var _=P.options.host,x=[],E=0;if(_.config.condensedReplays&&G(e.parent,r)){var k=N(i[r],z,{previousValue:V===Q?void 0:V}),T=k.copy,I=k.duplicateCount,A=k.outOfOrder,O=k.outOfOrderElements;x=T,E=I,A&&(F(x,z,O,{action:"__updateRelationsIfNeeded action:add - sorted.update",previousValue:V===Q?void 0:V,source:"Elements are out of order in "+e.parent+"."+r}),i[r].sort(o.cmp))}if(s=V===Q?o.update(i[r],z):o.update(i[r],z,{previousValue:V}),_.config.condensedReplays&&!J.updateRelationsAdd&&G(e.parent,r)){var j=U(x,E,i[r],z,{action:"__updateRelationsIfNeeded action:add - sorted.update",previousValue:V===Q?void 0:V,source:"There are duplicates in "+e.parent+"."+r}),S=j.logged,M=j.currCopy,R=j.counts;(J.updateRelationsAdd=S)&&(global.duplicateDebug.updateRelations.add={beforeElements:x,afterElements:M,counts:R})}}else i[r].includes(z)||(i[r].push(z),s=!0);i.$$transientAttrs.$$wasUpdatedByRelation||(i.$$transientAttrs.$$wasUpdatedByRelation=s)}})}}},{key:"ejectAll",value:function(){for(;0<this.entitiesList.length;)this.eject(this.entitiesList[0])}},{key:"parseAttrs",value:function(e){var t=this,n=(0,x.default)(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=(0,$.default)(e,this.options.transientAttrs),a=(0,_.default)(e,(0,c.default)(n),this.options.transientAttrs),o=this.options.parseAttrs((0,W.jsonCloneDeep)(a));return(0,u.default)({},o,n,r)}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get)}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass===this}}]),te);function te(e,t){var n,r=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};(0,p.default)(this,te),this.get=function(e){return r.entitiesById[e]||r.entitiesByServerId[e]||null},this.options=(0,O.default)({},a,X),this.idAttribute=this.options.idAttribute,this.name=t,this.store=e,this.entitiesById={},this.entitiesByServerId={},this.entitiesList=[],this.hasManySortFields=null,this.previousHasManySortValues={},this.previousServerIds={},this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,v.default)(this.options.computed,{$entityType:{enumerable:!0,value:t,writable:!1},$entityClass:{enumerable:!1,value:this,writable:!1}}),this.options.computed=(0,A.default)(this.options.computed,function(e,t,n){e[n]="function"==typeof t?{get:t,enumerable:!1}:t},{}),this._computedKeys=(n=(n=this.options.computed,P.default).call(n),Z.default).call(n,"$entityType","$entityClass","$$transientAttrs"),this._writablePropertyKeys=(n=(n=(n=this.options.computed,L.default).call(n),C.default).call(n,function(e){return e[1].set}),V.default).call(n,I.default),this._relationKeys=(n=(n=(n=this.options.relations,K.default).call(n),V.default).call(n,T.default),q.default).call(n)}(0,v.default)(ee.prototype,H.default.prototype);var ne=((0,h.default)(re,[{key:"defineModel",value:function(o){var i=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.models[o])throw new Error(o+" already defined");e=(0,u.default)({},this.options,e),this.models[o]=ee.create(this,o,e);var t=this.models[o].options.relations.hasMany;return(0,w.default)(t)||(0,b.default)(t,function(e,t){var n=e.sortBy,r=e.type,a=i.models[o].__getSorted(n);i.__relationsOfHasManyByContainedItem[r]||(i.__relationsOfHasManyByContainedItem[r]=[]),i.__relationsOfHasManyByContainedItem[r].push((0,u.default)({},e,{relationKey:t,sorted:a,parent:o}))}),this.models[o]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===ee}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,m.default)(this.models).forEach(function(e){return e.ejectAll()})}}]),re);function re(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,p.default)(this,re),this.options=e,this.models={},this.__relationsOfHasManyByContainedItem={},["filter","get","getAll","inject","injectPlaceholder","is","resolveId"].forEach(function(o){i[o]=function(e){for(var t,n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=i.models[e])[o].apply(t,r)}})}t.default=ne,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(16)),a=r(n(34)),i=r(n(1)),s=r(n(2)),u=r(n(46)),c=r(n(40)),l=r(n(39)),d=r(n(25)),f=r(n(91)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(168)),h=n(23),y=r(n(211)),g=((0,s.default)(v,[{key:"defineModels",value:function(){var n=this,r={},a=(0,o.default)({},this.options,{host:this.host,logger:this.logger});(0,f.default)(p,function(e,t){r[t]=e(n,a)}),this.models=r}},{key:"defineModel",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return(0,d.default)(a,{replaceKeys:{},skipCamelizationForKeys:null}),(0,d.default)(a.replaceKeys,{token:"id"}),this.store.defineModel(e,(0,o.default)({},a,{afterInject:function(e){var t=Date.now();e.$lastModified===t&&(t+=1e-5),e.$lastModified=t,a.afterInject&&a.afterInject(e)},parseAttrs:function(e){var t=void 0;if((0,l.default)(a.skipCamelizationForKeys))t=h.Camelizer.camelizeObject(e);else{var n=(0,c.default)(e,a.skipCamelizationForKeys),r=(0,u.default)(e,a.skipCamelizationForKeys);t=(0,o.default)({},h.Camelizer.camelizeObject(n),r)}return(0,h.replaceKeys)(t,a.replaceKeys),a.parseAttrs&&(t=a.parseAttrs(t,e)),t}}))}},{key:"clear",value:function(){this.store.clear()}}]),v);function v(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.logger,r=(0,a.default)(t,["logger"]);(0,i.default)(this,v),this.host=e,this.options=r,this.logger=n,this.store=new y.default((0,o.default)({},r,{host:e,logger:n})),this.store.host=e}t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),o=r(n(2)),i=r(n(53)),s=r(n(287)),u=Object.prototype.hasOwnProperty,c=(0,i.default)("NOT_PROVIDED"),l=((0,o.default)(d,[{key:"add",value:function(e,t){var n=s.default.gt(e,t,this.cmp);-1!==n?e.splice(n,0,t):e.push(t)}},{key:"indexOf",value:function(e,t,n){var r=n&&u.call(n,"previousValue")?n.previousValue:c,a=e.length;if(r===c||0===this.cmp(t,r)){var o=s.default.gt(e,t,this.cmp);if(-1!=(o=-1===o?a-1:o-1)){for(;0<o&&0===this.cmp(e[o-1],t);)o--;for(;o<a&&0===this.cmp(e[o],t);){if(e[o]===t)return o;o++}}}else for(var i=0;i<a;){if(e[i]===t)return i;i++}return-1}},{key:"remove",value:function(e,t,n){var r=this.indexOf(e,t,n);return-1!==r&&(e.splice(r,1),!0)}},{key:"removeAll",value:function(e,t,n){var r=n&&u.call(n,"previousValue")?n.previousValue:c,a=this.indexOf(e,t,n),o=!1;if(-1!==a)for(var i=r===c||0===this.cmp(t,r);a<e.length&&(!i||0===this.cmp(e[a],t));)e[a]===t?(e.splice(a,1),o=!0):a++;return o}},{key:"update",value:function(e,t,n){var r=n&&u.call(n,"previousValue")?n.previousValue:c,a=r===c||0===this.cmp(t,r),o=this.indexOf(e,t,n);if(-1!==o){if(a)return!1;e.splice(o,1)}return-1!==(o=s.default.gt(e,t,this.cmp))?e.splice(o,0,t):e.push(t),!0}}]),d);function d(e){(0,a.default)(this,d),this.cmp=e}t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(66),o=(r=a)&&r.__esModule?r:{default:r},i={isNotEmpty:function(e,t){return!!t},notEmpty:function(e,t,n){i.isNotEmpty(e,t)||(n=n||"expected "+e+" to be provided",i.raise(e,void 0,n))},isOneOf:function(e,t,n){return n.includes(t)},oneOf:function(e,t,n,r){i.isOneOf(e,t,n)||(r=r||"expected "+t+" to be one of ("+n.join(", ")+")",i.raise(e,void 0,r))},raise:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"invalid",n=arguments[2];throw new o.default(e,t,n)}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=r(n(18)),o=r(n(53));if(!("find"in Array.prototype))throw new Error("Missing polyfill for Array.find");if(!("from"in Array))throw new Error("Missing polyfill for Array.from");if(!("includes"in Array.prototype))throw new Error("Missing polyfill for Array.includes");if(!("assign"in Object))throw new Error("Missing polyfill for Object.assign");if(!("entries"in Object))throw new Error("Missing polyfill for Object.entries");if(!("values"in Object))throw new Error("Missing polyfill for Object.values");if(!("endsWith"in String.prototype))throw new Error("Missing polyfill for String.endsWith");if(!("includes"in String.prototype))throw new Error("Missing polyfill for String.includes");if(void 0===o.default)throw new Error("Missing polyfill for Symbol");if(void 0===a.default)throw new Error("Missing polyfill for Promise");if(!("finally"in a.default.prototype))throw new Error("Missing polyfill for Promise.finally");if("undefined"==typeof AbortController)throw new Error("Missing polyfill for AbortController");if("undefined"==typeof fetch)throw new Error("Missing polyfill for fetch");if("undefined"==typeof Headers)throw new Error("Missing polyfill for Headers (part of fetch polyfill)");if("undefined"==typeof Request)throw new Error("Missing polyfill for Request (part of fetch polyfill)");if("undefined"==typeof Response)throw new Error("Missing polyfill for Response (part of fetch polyfill)")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(3)),f=r(n(4)),p=r(n(5)),h=r(n(19)),y=r(n(12)),g=r(n(13));t.default=function(e){var t=0,n=[];if(!e||"function"!=typeof e[g.default]&&!Array.isArray(e))throw new TypeError("Expected rules to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));if(!e||"function"!=typeof e[g.default]&&!Array.isArray(e))throw new TypeError("Expected rules to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,y.default)(e);!(r=(i=s.next()).done);r=!0){var u=(0,h.default)(i.value,2),c=u[0],l=u[1];if(n.push("const a"+t+" = a['"+c+"']"),n.push("const b"+t+" = b['"+c+"']"),"asc"===l)n.push("if (a"+t+" === undefined && b"+t+" !== undefined) return -1"),n.push("if (a"+t+" !== undefined && b"+t+" === undefined) return 1"),n.push("if (a"+t+" === null && b"+t+" !== null) return -1"),n.push("if (a"+t+" !== null && b"+t+" === null) return 1"),n.push("if (a"+t+" < b"+t+") return -1"),n.push("if (a"+t+" > b"+t+") return 1");else{if("desc"!==l)throw new Error("unsupported sort ordering for field "+c+": "+l);n.push("if (a"+t+" === undefined && b"+t+" !== undefined) return 1"),n.push("if (a"+t+" !== undefined && b"+t+" === undefined) return -1"),n.push("if (a"+t+" === null && b"+t+" !== null) return 1"),n.push("if (a"+t+" !== null && b"+t+" === null) return -1"),n.push("if (a"+t+" < b"+t+") return 1"),n.push("if (a"+t+" > b"+t+") return -1")}t++}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n.push("return 0"),new Function("a","b",n.join("\n"))},e.exports=t.default},function(e,t,n){"use strict";var r,a=n(18);if((r=a)&&r.__esModule,n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),"undefined"==typeof fetch){var o=n(225);global.fetch=o.default,global.Headers=o.Headers,global.Request=o.Request,global.Response=o.Response,n(226)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(3)),f=r(n(4)),p=r(n(5)),h=r(n(19)),y=r(n(12)),g=r(n(13)),v=r(n(22));t.default=function(e,t){if(!(s=(0,v.default)(t))||"function"!=typeof s[g.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$entries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(s));if(!s||"function"!=typeof s[g.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$entries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,y.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=(0,h.default)(o.value,2),c=u[0],l=u[1];!(l in e)&&c in e&&(e[l]=e[c],delete e[c])}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return e},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(i){return function(e){for(var t=e[0],n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var o=0;o<r.length;++o)t+=i(r[o]),t+=e[o+1];return t}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(220),o=(r=a)&&r.__esModule?r:{default:r};t.default=(0,o.default)(encodeURIComponent),e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(223),o=((r=a)&&r.__esModule?r:{default:r}).default.version;o=o.replace("-dev",""),t.default=o,e.exports=t.default},function(e,t){e.exports={name:"tigerconnect",private:!0,version:"11.7.0-beta1",description:"JS (web and node) SDK for TigerConnect",homepage:"https://tigerconnect.github.io/js-sdk/",repository:"tigerconnect/js-sdk",author:{name:"TigerConnect Developers",email:"developersupport@tigerconnect.com",url:"https://tigerconnect.github.io/js-sdk/"},main:"lib/index.js",keywords:["tigerconnect","tigertext","communications","messenger","sdk"],scripts:{"build:clean":"rimraf lib dist","build:js":"babel -d lib/ src/","build:travis":"run-s lint coverage:travis build","build:webpack":"webpack","build:webpack:node":"webpack --target node",build:"run-p build:clean build:js build:webpack","build:node":"run-s build:webpack:node",coverage:"run-s coverage:clean coverage:test coverage:report:html","coverage:check":"nyc check-coverage","coverage:clean":"rimraf .nyc_output","coverage:open":"open-cli coverage/index.html","coverage:report":"run-s coverage:report:*","coverage:report:codecov":"nyc report --reporter=lcov > coverage.lcov && codecov","coverage:report:html":"rimraf coverage && nyc report --reporter=html","coverage:test":'cross-env NODE_ENV=coverage nyc mocha "test/**/*.test.js"',"coverage:travis":"run-s coverage:test coverage:report coverage:check","deploy:docs":"gulp npm:publish:docs:prepare",deps:"npm-check -s","deps:update":"npm-check -u",lint:"eslint . --ext .js","lint:fix":"eslint . --ext .js --fix",test:'mocha "test/**/*.test.js"',watch:"run-s build:clean && gulp build:js && run-p watch:js watch:webpack","watch:js":"gulp watch:js","watch:test":"npm test -- -w","watch:webpack":"webpack --watch"},husky:{hooks:{"pre-push":"./hooks/pre-push"}},nyc:{statements:79,branches:70,lines:80,include:["src/**/*.js"],exclude:["test/**/*.test.js"],require:["babel-register"],sourceMap:!1,instrument:!1,cache:!0},dependencies:{"@tigerconnect/node-fetch":"^2.6.0-tc1","abortcontroller-polyfill":"^1.3.0",btoa:"^1.1.2",events:"^3.1.0","file-saver":"^1.3.3","file-type":"^4.0.0","humanize-list":"^1.0.1",invariant:"^2.2.2","is-email":"^1.0.0",jshashes:"^1.0.7",lodash:"^4.17.15","lodash-bound":"^1.1.2","lodash.throttle":"^4.1.1",maltypart:"^1.5.0",mime:"^1.6.0",moment:"^2.24.0",promise:"^8.0.3",raf:"^3.4.0",request:"^2.88.0","reuse-promise":"^1.1.0",shallowequal:"^0.2.2","sorted-array-functions":"^1.1.0",superagent:"^5.1.0","superagent-prefix":"0.0.2",uuid:"^3.0.0",visibilityjs:"^2.0.2"},devDependencies:{"assets-webpack-plugin":"^4.0.0","babel-cli":"~6.18.0","babel-core":"~6.21.0","babel-eslint":"^7.1.1","babel-loader":"^6.2.8","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-conditional-compilation":"0.0.1","babel-plugin-flow-comments":"^6.3.19","babel-plugin-import-asserts":"^3.0.0","babel-plugin-istanbul":"^4.1.5","babel-plugin-lodash":"^3.2.10","babel-plugin-macros":"^1.0.15","babel-plugin-syntax-flow":"^6.18.0","babel-plugin-transform-class-properties":"~6.19.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-plugin-transform-es2015-classes":"^6.18.0","babel-plugin-transform-flow-strip-types":"^6.18.0","babel-plugin-transform-runtime":"~6.15.0","babel-plugin-typecheck":"^3.9.0","babel-preset-es2015":"^6.18.0","babel-preset-stage-0":"^6.16.0",busboy:"^0.2.14",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-deep-match":"^1.2.1",codecov:"^3.6.5","core-js":"^3.2.1","cross-env":"^3.2.4",decache:"^4.1.0","dom-storage":"^2.0.2",eslint:"^3.17.1",gulp:"^4.0.2","gulp-babel":"^6.1.2","gulp-changed":"^4.0.1","gulp-debug":"^4.0.0","gulp-file":"^0.4.0","gulp-if":"^3.0.0","gulp-load-plugins":"^2.0.1","gulp-plumber":"^1.2.1","gulp-uglify":"^3.0.2","gulp-watch":"^5.0.1",husky:"^3.0.3",jsdom:"^15.1.1","jsdom-global":"^3.0.2","json-loader":"^0.5.4","lodash-webpack-plugin":"^0.11.2",mocha:"^6.2.0","mocha-clean":"^1.0.0",nock:"^9.0.2","npm-check":"^5.9.0","npm-run-all":"^4.0.2",nyc:"^14.1.1","open-cli":"^5.0.0","performance-now":"^2.0.0","promisify-child-process":"^3.1.1",rimraf:"^2.5.4",sinon:"^7.4.1","sinon-chai":"^3.3.0","strip-loader":"^0.1.2",timekeeper:"1.0.0",watch:"^1.0.1",webpack:"^1.13.3","webpack-node-externals":"^1.5.4",yargs:"^6.4.0"},license:{type:"Commercial",url:"https://tigerconnect.com/terms/end-user-terms-use-license-agreement/"}}},function(e,t,n){function r(e){return n(a(e))}function a(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./node":77,"./node.js":77,"./web":78,"./web.js":78};r.keys=function(){return Object.keys(o)},r.resolve=a,(e.exports=r).id=224},function(e,t){e.exports=require("@tigerconnect/node-fetch")},function(e,t){e.exports=require("abortcontroller-polyfill/dist/polyfill-patch-fetch")},function(e,t){e.exports=require("babel-runtime/core-js/object/create")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-property")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-names")},function(e,t){e.exports=require("babel-runtime/core-js/object/is-frozen")},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/has-instance")},function(e,t){e.exports=require("core-js/features/array/find")},function(e,t){e.exports=require("core-js/features/array/from")},function(e,t){e.exports=require("core-js/features/array/includes")},function(e,t){e.exports=require("core-js/features/object/assign")},function(e,t){e.exports=require("core-js/features/object/entries")},function(e,t){e.exports=require("core-js/features/object/values")},function(e,t){e.exports=require("core-js/features/string/ends-with")},function(e,t){e.exports=require("core-js/features/string/includes")},function(e,t){e.exports=require("core-js/features/string/starts-with")},function(e,t){e.exports=require("core-js/features/symbol")},function(e,t){e.exports=require("file-saver")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("invariant")},function(e,t){e.exports=require("is-email")},function(e,t){e.exports=require("lodash-bound/each")},function(e,t){e.exports=require("lodash-bound/filter")},function(e,t){e.exports=require("lodash-bound/initial")},function(e,t){e.exports=require("lodash-bound/keyBy")},function(e,t){e.exports=require("lodash-bound/keys")},function(e,t){e.exports=require("lodash-bound/toPairs")},function(e,t){e.exports=require("lodash/assign")},function(e,t){e.exports=require("lodash/camelCase")},function(e,t){e.exports=require("lodash/castArray")},function(e,t){e.exports=require("lodash/compact")},function(e,t){e.exports=require("lodash/filter")},function(e,t){e.exports=require("lodash/find")},function(e,t){e.exports=require("lodash/findKey")},function(e,t){e.exports=require("lodash/first")},function(e,t){e.exports=require("lodash/flatten")},function(e,t){e.exports=require("lodash/has")},function(e,t){e.exports=require("lodash/head")},function(e,t){e.exports=require("lodash/identity")},function(e,t){e.exports=require("lodash/includes")},function(e,t){e.exports=require("lodash/intersection")},function(e,t){e.exports=require("lodash/invert")},function(e,t){e.exports=require("lodash/isArray")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("lodash/isObject")},function(e,t){e.exports=require("lodash/keys")},function(e,t){e.exports=require("lodash/last")},function(e,t){e.exports=require("lodash/mapKeys")},function(e,t){e.exports=require("lodash/memoize")},function(e,t){e.exports=require("lodash/orderBy")},function(e,t){e.exports=require("lodash/pickBy")},function(e,t){e.exports=require("lodash/pull")},function(e,t){e.exports=require("lodash/snakeCase")},function(e,t){e.exports=require("lodash/sortBy")},function(e,t){e.exports=require("lodash/uniqBy")},function(e,t){e.exports=require("lodash/without")},function(e,t){e.exports=require("maltypart")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("raf")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("sorted-array-functions")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-prefix")}]);