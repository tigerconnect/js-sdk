module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=35)}([function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("reuse-promise")},function(e,t){e.exports=require("lodash-bound/uniq")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("lodash/get")},function(e,t){e.exports=require("lodash-bound/map")},function(e,t){e.exports=require("lodash-bound/flatten")},function(e,t){e.exports=require("invariant")},function(e,t){e.exports=require("btoa")},function(e,t){e.exports=require("lodash.throttle")},function(e,t){e.exports=require("shallowequal")},function(e,t){e.exports=require("lodash-bound/values")},function(e,t){e.exports=require("lodash-bound/omitBy")},function(e,t){e.exports=require("jshashes")},function(e,t){e.exports=require("lodash-bound/without")},function(e,t){e.exports=require("sorted-array-functions")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("raf")},function(e,t){e.exports=require("superagent-prefix")},function(e,t){e.exports=require("maltypart")},function(e,t,n){"use strict"},function(e,t,n){"use strict";!function(){try{var e=n(52).request().constructor.prototype;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(e){}}()},function(e,t){e.exports=require("is-email")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("lodash-bound/initial")},function(e,t){e.exports=require("lodash-bound/keyBy")},function(e,t){e.exports=require("lodash-bound/each")},function(e,t){e.exports=require("lodash-bound/filter")},function(e,t){e.exports=require("lodash-bound/keys")},function(e,t){e.exports=require("lodash-bound/toPairs")},function(e){e.exports=JSON.parse('{"name":"tigerconnect","private":true,"version":"12.6.0","description":"JS (web and node) SDK for TigerConnect","homepage":"https://tigerconnect.github.io/js-sdk/","repository":"tigerconnect/js-sdk","author":{"name":"TigerConnect Developers","email":"developersupport@tigerconnect.com","url":"https://tigerconnect.github.io/js-sdk/"},"main":"lib/index.js","keywords":["tigerconnect","tigertext","communications","messenger","sdk"],"scripts":{"build:clean":"shx rm -fr lib dist","build:js":"babel -d lib/ src/","build:travis":"run-s lint coverage:test build","build:webpack":"webpack","build:webpack:node":"webpack --target node","build":"run-s build:clean build:webpack","build:node":"run-s build:webpack:node","coverage":"run-s coverage:clean coverage:test coverage:report:html","coverage:check":"nyc check-coverage","coverage:clean":"shx rm -fr .nyc_output","coverage:open":"open-cli coverage/index.html","coverage:report":"run-s coverage:report:*","coverage:report:html":"shx rm -fr coverage && nyc report --reporter=html","coverage:test":"jest --collectCoverage test/**/*.test.ts  > coverage.lcov","coverage:travis":"run-s coverage:test coverage:report coverage:check","deploy:docs":"gulp npm:publish:docs:prepare","deps":"npm-check -s","deps:update":"npm-check -u","lint":"eslint ./src --ext .js,.ts,.tsx","lint:fix":"eslint ./src --ext .js,.ts,.tsx --fix","test":"mocha \\"test/**/*.test.js\\"","watch":"run-s build:clean && gulp build:js && run-p watch:js watch:webpack","watch:js":"gulp watch:js","watch:test":"npm test -- -w","watch:webpack":"webpack --watch","test:jest":"jest test/**/*.test.ts --watch","tsc":"tsc --project tsconfig.json"},"husky":{"hooks":{"pre-commit":"lint-staged","pre-push":"./hooks/pre-push"}},"lint-staged":{"*":["pretty-quick --staged"]},"jest":{"collectCoverageFrom":["src/**/*.ts","!<rootDir>/node_modules/**","!<rootDir>/src/**/*.d.ts"],"coverageThreshold":{"global":{"statements":10,"branches":3,"lines":11,"functions":12}}},"dependencies":{"@tigerconnect/node-fetch":"^2.6.0-tc1","abortcontroller-polyfill":"^1.3.0","btoa":"^1.1.2","events":"^3.1.0","file-saver":"^1.3.3","file-type":"^4.0.0","humanize-list":"^1.0.1","invariant":"^2.2.2","is-email":"^1.0.0","jshashes":"^1.0.7","lodash":"^4.17.19","lodash-bound":"^1.1.2","lodash.throttle":"^4.1.1","maltypart":"^1.5.0","mime":"^1.6.0","moment":"^2.24.0","promise":"^8.0.3","raf":"^3.4.0","request":"^2.88.0","reuse-promise":"^1.1.0","shallowequal":"^0.2.2","sorted-array-functions":"^1.1.0","superagent":"^5.1.0","superagent-prefix":"0.0.2","uuid":"^3.0.0","visibilityjs":"^2.0.2"},"devDependencies":{"@babel/core":"^7.11.6","@babel/plugin-proposal-class-properties":"^7.10.4","@babel/plugin-proposal-decorators":"^7.10.5","@babel/plugin-proposal-function-bind":"^7.11.5","@babel/plugin-proposal-object-rest-spread":"^7.11.0","@babel/plugin-syntax-flow":"^7.10.4","@babel/plugin-transform-flow-strip-types":"^7.10.4","@babel/plugin-transform-runtime":"^7.11.5","@babel/preset-env":"^7.11.5","@babel/preset-es2015":"^7.0.0-beta.53","@babel/preset-typescript":"^7.10.4","@babel/register":"^7.11.5","@types/events":"^3.0.0","@types/jest":"^26.0.14","@types/lodash":"^4.14.161","@types/node":"^14.11.5","@typescript-eslint/eslint-plugin":"^4.3.0","@typescript-eslint/parser":"^4.3.0","assets-webpack-plugin":"^4.0.0","awesome-typescript-loader":"^5.2.1","babel-eslint":"^10.1.0","babel-jest":"^26.3.0","babel-loader":"^8.1.0","babel-plugin-istanbul":"^6.0.0","busboy":"^0.2.14","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-deep-match":"^1.2.1","core-js":"^3.2.1","decache":"^4.1.0","dom-storage":"^2.0.2","eslint":"^7.10.0","eslint-config-prettier":"^6.11.0","eslint-config-react-app":"^5.2.1","eslint-plugin-flowtype":"^5.2.0","eslint-plugin-import":"^2.22.0","eslint-plugin-jsx-a11y":"^6.3.1","eslint-plugin-prettier":"^3.1.4","eslint-plugin-react":"^7.21.2","eslint-plugin-react-hooks":"^4.1.2","gulp":"^4.0.2","gulp-babel":"^8.0.0","gulp-changed":"^4.0.1","gulp-debug":"^4.0.0","gulp-file":"^0.4.0","gulp-if":"^3.0.0","gulp-load-plugins":"^2.0.1","gulp-plumber":"^1.2.1","gulp-uglify":"^3.0.2","gulp-watch":"^5.0.1","husky":"^3.0.3","jest":"^26.4.2","jsdom":"^15.1.1","jsdom-global":"^3.0.2","json-loader":"^0.5.4","lint-staged":"^10.3.0","lodash-webpack-plugin":"^0.11.2","mocha":"^7.2.0","mocha-clean":"^1.0.0","nock":"^9.0.2","npm-check":"^5.9.0","npm-run-all":"^4.0.2","nyc":"^15.1.0","open-cli":"^6.0.1","performance-now":"^2.0.0","prettier":"^2.1.2","pretty-quick":"^3.0.2","promisify-child-process":"^3.1.1","shelljs":"^0.8.4","shx":"^0.3.3","sinon":"^7.4.1","sinon-chai":"^3.3.0","source-map-loader":"^1.1.0","strip-loader":"^0.1.2","timekeeper":"1.0.0","tslint":"^6.1.3","tslint-loader":"^3.5.4","typescript":"^4.0.3","watch":"^1.0.1","webpack":"^4.44.2","webpack-cli":"^3.3.12","webpack-node-externals":"^1.5.4","webpack-utf8-bom":"^1.2.0","yargs":"^16.1.1"},"eslintConfig":{"extends":["react-app","prettier"],"globals":{"__SDK_VERSION__":"readonly","__DEV__":"readonly"},"plugins":["react","prettier"],"rules":{"prettier/prettier":"error"}},"prettier":{"arrowParens":"always","bracketSpacing":true,"jsxBracketSameLine":false,"jsxSingleQuote":false,"printWidth":100,"proseWrap":"always","quoteProps":"as-needed","semi":true,"singleQuote":true,"tabWidth":2,"trailingComma":"es5","useTabs":false},"license":{"type":"Commercial","url":"https://tigerconnect.com/terms/end-user-terms-use-license-agreement/"}}')},function(e,t,n){"use strict";n.r(t),n.d(t,"Client",(function(){return r})),global._babelPolyfill||!1===global._tcShouldPolyfill?n(50):n(36);n(51)("./node");var r=n(56).TigerConnectClient},function(e,t,n){"use strict";(0,n(37).getGlobals)();if(n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),"undefined"==typeof fetch){var r=n(48);global.fetch=r.default,global.Headers=r.Headers,global.Request=r.Request,global.Response=r.Response,n(49)}},function(e,t,n){"use strict";e.exports={getGlobals:function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}}},function(e,t){e.exports=require("core-js/features/array/find")},function(e,t){e.exports=require("core-js/features/array/from")},function(e,t){e.exports=require("core-js/features/array/includes")},function(e,t){e.exports=require("core-js/features/object/assign")},function(e,t){e.exports=require("core-js/features/object/entries")},function(e,t){e.exports=require("core-js/features/object/values")},function(e,t){e.exports=require("core-js/features/string/ends-with")},function(e,t){e.exports=require("core-js/features/string/includes")},function(e,t){e.exports=require("core-js/features/string/starts-with")},function(e,t){e.exports=require("core-js/features/symbol")},function(e,t){e.exports=require("@tigerconnect/node-fetch")},function(e,t){e.exports=require("abortcontroller-polyfill/dist/polyfill-patch-fetch")},function(e,t,n){"use strict";if(!("find"in Array.prototype))throw new Error("Missing polyfill for Array.find");if(!("from"in Array))throw new Error("Missing polyfill for Array.from");if(!("includes"in Array.prototype))throw new Error("Missing polyfill for Array.includes");if(!("assign"in Object))throw new Error("Missing polyfill for Object.assign");if(!("entries"in Object))throw new Error("Missing polyfill for Object.entries");if(!("values"in Object))throw new Error("Missing polyfill for Object.values");if(!("endsWith"in String.prototype))throw new Error("Missing polyfill for String.endsWith");if(!("includes"in String.prototype))throw new Error("Missing polyfill for String.includes");if("undefined"==typeof Symbol)throw new Error("Missing polyfill for Symbol");if("undefined"==typeof Promise)throw new Error("Missing polyfill for Promise");if(!("finally"in Promise.prototype))throw new Error("Missing polyfill for Promise.finally");if("undefined"==typeof AbortController)throw new Error("Missing polyfill for AbortController");if("undefined"==typeof fetch)throw new Error("Missing polyfill for fetch");if("undefined"==typeof Headers)throw new Error("Missing polyfill for Headers (part of fetch polyfill)");if("undefined"==typeof Request)throw new Error("Missing polyfill for Request (part of fetch polyfill)");if("undefined"==typeof Response)throw new Error("Missing polyfill for Response (part of fetch polyfill)")},function(e,t,n){var r={"./node":23,"./node.ts":23,"./web":24,"./web.ts":24};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=51},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("file-saver")},function(e,t){e.exports=require("mime")},function(e,t,n){"use strict";n.r(t),n.d(t,"TigerConnectClient",(function(){return Wd}));var r={};n.r(r),n.d(r,"ConnectionUnavailableError",(function(){return E})),n.d(r,"NotFoundError",(function(){return C})),n.d(r,"NotSignedInError",(function(){return P})),n.d(r,"NotSupportedError",(function(){return j})),n.d(r,"PermissionDeniedError",(function(){return z})),n.d(r,"RequiresBasicAuthError",(function(){return N})),n.d(r,"TargetNotSupportedError",(function(){return U})),n.d(r,"ValidationError",(function(){return q})),n.d(r,"WrongCredentialsError",(function(){return B}));var o={};n.r(o),n.d(o,"isEmail",(function(){return It.a}));var i={};n.r(i),n.d(i,"isPhone",(function(){return Fr})),n.d(i,"formatPhone",(function(){return Gr})),n.d(i,"formatPhoneWithDash",(function(){return Vr})),n.d(i,"normalizePhone",(function(){return Kr})),n.d(i,"normalizePhoneUS",(function(){return Hr}));var s={};n.r(s),n.d(s,"Calls",(function(){return je})),n.d(s,"Conversations",(function(){return Ne})),n.d(s,"DistributionLists",(function(){return Fe})),n.d(s,"Entities",(function(){return Xe})),n.d(s,"Escalations",(function(){return nt})),n.d(s,"Events",(function(){return ct})),n.d(s,"Groups",(function(){return bt})),n.d(s,"Messages",(function(){return kt})),n.d(s,"MessageTemplates",(function(){return Dt})),n.d(s,"Metadata",(function(){return Ht})),n.d(s,"Mute",(function(){return Zt})),n.d(s,"Notifications",(function(){return rn})),n.d(s,"Organizations",(function(){return hn})),n.d(s,"Patients",(function(){return yn})),n.d(s,"QRCode",(function(){return wn})),n.d(s,"Reporting",(function(){return Sn})),n.d(s,"Roles",(function(){return Un})),n.d(s,"RoleTags",(function(){return Fn})),n.d(s,"Roster",(function(){return Qn})),n.d(s,"Scheduler",(function(){return tr})),n.d(s,"ScheduledMessages",(function(){return ar})),n.d(s,"Search",(function(){return pr})),n.d(s,"Teams",(function(){return Ir})),n.d(s,"Twilio",(function(){return Ar})),n.d(s,"TypingStatus",(function(){return Sr})),n.d(s,"UserRoles",(function(){return Nr})),n.d(s,"Users",(function(){return no})),n.d(s,"VirtualWaitingRoom",(function(){return ao}));var a={};n.r(a),n.d(a,"AllowedSendersReason",(function(){return Io})),n.d(a,"ConversationAnchorPoints",(function(){return Oo})),n.d(a,"EscalationChangeAction",(function(){return To})),n.d(a,"EscalationStatus",(function(){return Eo})),n.d(a,"GroupType",(function(){return Ao})),n.d(a,"MessagePriority",(function(){return Co})),n.d(a,"MessageRecipientStatus",(function(){return So})),n.d(a,"MessageSenderStatus",(function(){return jo})),n.d(a,"MessageSubType",(function(){return Mo})),n.d(a,"MessageType",(function(){return zo})),n.d(a,"Networks",(function(){return ko})),n.d(a,"PatientCareCardActionType",(function(){return No})),n.d(a,"PatientCareCardType",(function(){return xo})),n.d(a,"PatientCareCardUIType",(function(){return Uo})),n.d(a,"PresenceStatus",(function(){return Lo})),n.d(a,"ProcessingActionTypes",(function(){return qo})),n.d(a,"SearchType",(function(){return Do})),n.d(a,"TypingContext",(function(){return Bo})),n.d(a,"VisibilityType",(function(){return Fo}));var u={};n.r(u),n.d(u,"allContentTypes",(function(){return $i})),n.d(u,"allExtensions",(function(){return Wi})),n.d(u,"getMimeEntryByContentType",(function(){return Xi})),n.d(u,"getMimeEntryByExtension",(function(){return Qi}));var c={};n.r(c),n.d(c,"formatDob",(function(){return bs})),n.d(c,"secondsToDurationFormat",(function(){return ws}));var l={};n.r(l),n.d(l,"downloadFile",(function(){return Ts})),n.d(l,"loadLocalFilePathWithFileReader",(function(){return Es})),n.d(l,"saveByteArray",(function(){return As}));var d={};n.r(d),n.d(d,"Calls",(function(){return $s})),n.d(d,"Conversations",(function(){return Ta})),n.d(d,"DistributionLists",(function(){return Ma})),n.d(d,"Entities",(function(){return Ua})),n.d(d,"Escalations",(function(){return Fa})),n.d(d,"EventRouter",(function(){return Ha})),n.d(d,"Events",(function(){return su})),n.d(d,"Forums",(function(){return hu})),n.d(d,"Groups",(function(){return _u})),n.d(d,"Messages",(function(){return Pu})),n.d(d,"MessageTemplates",(function(){return Nu})),n.d(d,"Metadata",(function(){return Fu})),n.d(d,"Mute",(function(){return Xu})),n.d(d,"NotificationRouter",(function(){return Yu})),n.d(d,"Notifications",(function(){return rc})),n.d(d,"Organizations",(function(){return hc})),n.d(d,"Patients",(function(){return _c})),n.d(d,"Presence",(function(){return Oc})),n.d(d,"Products",(function(){return Rc})),n.d(d,"Roles",(function(){return xc})),n.d(d,"RoleTags",(function(){return Fc})),n.d(d,"ScheduledMessages",(function(){return Wc})),n.d(d,"Search",(function(){return yl})),n.d(d,"Teams",(function(){return wl})),n.d(d,"TypingStatus",(function(){return Pl})),n.d(d,"UserRoles",(function(){return Nl})),n.d(d,"Users",(function(){return Fl})),n.d(d,"VirtualWaitingRoom",(function(){return $l}));var h={};n.r(h),n.d(h,"Call",(function(){return Xl})),n.d(h,"CallLogEntry",(function(){return Ql})),n.d(h,"Conversation",(function(){return Jl})),n.d(h,"DistributionList",(function(){return Zl})),n.d(h,"EscalationExecution",(function(){return ed})),n.d(h,"EscalationExecutionChange",(function(){return td})),n.d(h,"EscalationPolicy",(function(){return nd})),n.d(h,"Group",(function(){return rd})),n.d(h,"GroupMembersChange",(function(){return od})),n.d(h,"Message",(function(){return id})),n.d(h,"MessageStatusPerRecipient",(function(){return sd})),n.d(h,"MessageTemplate",(function(){return ad})),n.d(h,"Metadata",(function(){return ud})),n.d(h,"Mute",(function(){return cd})),n.d(h,"Organization",(function(){return vd})),n.d(h,"Patient",(function(){return yd})),n.d(h,"PatientContact",(function(){return gd})),n.d(h,"Product",(function(){return md})),n.d(h,"ProductRoles",(function(){return bd})),n.d(h,"Role",(function(){return wd})),n.d(h,"RoleTag",(function(){return Id})),n.d(h,"ScheduledMessage",(function(){return Od})),n.d(h,"Team",(function(){return Td})),n.d(h,"TeamRequest",(function(){return Ed})),n.d(h,"User",(function(){return al})),n.d(h,"UserRoles",(function(){return Ad})),n.d(h,"VirtualWaitingRoom",(function(){return Cd})),n.d(h,"VirtualWaitingRoomVisit",(function(){return Rd}));var p,f=n(3),v=n.n(f),y=n(9),g=n.n(y),m=n(0),_=n.n(m),b=n(20),w=n.n(b),I=n(4),O=n.n(I),T=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),E=function(e){function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.call(this,"No internet connection")||this;return o.code=t.CODE,o}return T(t,e),t.CODE="connection-unavailable",t}(Error),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),C=function(e){function t(n,r,o){var i=this;return o||(o=n+" '"+r+"' not found"),(i=e.call(this,o)||this).code=t.CODE,i.resource=n,i.id=r,i}return A(t,e),t.CODE="not-found",t}(Error),R=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),P=function(e){function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.apply(this,n)||this;return o.code=t.CODE,o}return R(t,e),t.CODE="not-signed-in",t}(Error),S=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(e){function t(n){var r=e.call(this,n)||this;return r.code=t.CODE,r}return S(t,e),t.CODE="not-supported",t}(Error),M=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),z=function(e){function t(n,r,o,i){void 0===i&&(i="can't perform action '"+o+"' on "+(n.name||n)+" #"+r);var s=e.call(this,i)||this;return s.code=t.CODE,s.resource=n,s.action=o,s.id=r,s}return M(t,e),t.CODE="permission-denied",t}(Error),k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(e){function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.apply(this,n)||this;return o.code=t.CODE,o}return k(t,e),t.CODE="requires-basic-auth",t}(Error),x=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),U=function(e){function t(t){return e.call(this,"method"+(t?" "+t:"")+" not supported in target node")||this}return x(t,e),t.raise=function(e){throw new this(e)},t.CODE="target-not-supported",t}(Error),L=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),q=function(e){function t(n,r,o){void 0===r&&(r="invalid"),void 0===o&&(o=n+" is "+r);var i=e.call(this,o)||this;return i.code=t.CODE,i.name=n,i.reason=r,i}return L(t,e),t.CODE="validation",t}(Error),D=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),B=function(e){function t(n){void 0===n&&(n={});for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var i=e.apply(this,r)||this,s=n.tt_login_attempts_left;return i.code=t.CODE,i.loginAttemptsLeft=void 0===s?null:s,i}return D(t,e),t.CODE="wrong-credentials",t}(Error),F=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},G=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},V=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},K=[403,404],H="conversations.findAll",$="distributionLists.find",W="entities.findAll",X="escalation",Q="events.ack",Y="events.closeAllConnections",J="group.addMembers",Z="group.create",ee="group.destroy",te="group.find",ne="group.update",re="messages.find",oe="message.forward",ie="message.send",se="messages.updateRecipientStatusMulti",ae="metadata.find",ue="mute.findAll",ce="organization.find",le="organization.findAllOfUser",de="roles.createP2PGroup",he="search.query",pe="teams.create",fe="teams.find",ve="teams.leave",ye="teams.update",ge="user.find",me="user.findMe",_e="v2",be="v5",we=function(){function e(e,t){Object.assign(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient}return e.prototype.getVersion=function(e){var t=_e,n=be;return{version:this.config.condensedReplays?n:t}},e}(),Ie=we;function Oe(e){var t=void 0===e?{}:e,n=t.fallbackValue,r=void 0===n?null:n,o=t.httpStatusCodes,i=void 0===o?K:o;return function(e,t,n){var o=n.value;return n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return F(this,void 0,void 0,(function(){var t;return G(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,o.call.apply(o,V([this],e))];case 1:return[2,n.sent()];case 2:if((t=n.sent()).response&&i.includes(t.response.status))return[2,r];if(t.code===z.CODE&&i.includes(403))return[2,r];if(t.code===B.CODE&&i.includes(401))return[2,r];throw t;case 3:return[2]}}))}))},n}}Object.assign(we.prototype,v.a.prototype);var Te={camelizeKey:_.a.memoize(_.a.camelCase),underscoreKey:_.a.memoize(_.a.snakeCase),camelizeObject:function(e){return Ee(e,Te.camelizeKey)},underscoreObject:function(e){return Ee(e,Te.underscoreKey)}};function Ee(e,t){return _.a.isArray(e)?e.map((function(e){return Ee(e,t)})):_.a.isObject(e)?_.a.transform(e,(function(e,n,r){e[t(r)]=Ee(n,t)}),{}):e}var Ae=Te,Ce=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Re=function(){return(Re=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Pe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Se=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ce(t,e),t.prototype.start=function(e){return Pe(this,void 0,void 0,(function(){var t,n,r;return Se(this,(function(o){switch(o.label){case 0:return[4,this.httpClient.post("/v2/voip_call",{data:Ae.underscoreObject(e),headers:{"TT-X-Organization-Key":e.organizationId}})];case 1:return t=o.sent(),n=Object(m.get)(t,"data.disabled_participants",{}),(r=Ae.camelizeObject(t.data)).disabledParticipants=n,[2,r]}}))}))},t.prototype.end=function(e,t,n){var r=n.callId,o=n.payload,i=n.reason;return Pe(this,void 0,void 0,(function(){var n,s;return Se(this,(function(a){switch(a.label){case 0:return n=Object(m.get)(o,"disabledParticipants",{}),(s=Ae.underscoreObject({payload:o,reason:i,callId:r})).payload.disabled_participants=n,[4,this.httpClient.post("/v2/voip_call/"+e+"/end",{data:s,headers:{"TT-X-Organization-Key":t}})];case 1:return a.sent(),[2]}}))}))},t.prototype.decline=function(e,t,n){var r=n.callId,o=n.payload;return Pe(this,void 0,void 0,(function(){var n,i;return Se(this,(function(s){switch(s.label){case 0:return n=Object(m.get)(o,"disabledParticipants",{}),"declined",(i=Ae.underscoreObject({payload:Re(Re({},o),{reason:"declined",callId:r}),reason:"declined",callId:r,type:"call_ended",roomName:e})).payload.disabled_participants=n,[4,this.httpClient.post("/v2/voip_call/"+e+"/end",{data:i,headers:{"TT-X-Organization-Key":t}})];case 1:return s.sent(),[2]}}))}))},t.prototype.join=function(e,t){return Pe(this,void 0,void 0,(function(){return Se(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.get("/v2/voip_call/"+e,{headers:{"TT-X-Organization-Key":t}})];case 1:return[2,n.sent().data]}}))}))},t.prototype.answer=function(e,t,n){var r=n.callId,o=n.payload;return Pe(this,void 0,void 0,(function(){var n,i;return Se(this,(function(s){switch(s.label){case 0:return n=Object(m.get)(o,"disabledParticipants",{}),"answered",(i=Ae.underscoreObject({callId:r,payload:Re(Re({},o),{reason:"answered",callId:r}),reason:"answered",type:"call_answered",roomName:e})).payload.disabled_participants=n,[4,this.httpClient.post("/v2/voip_call/"+e+"/answer",{data:i,headers:{"TT-X-Organization-Key":t}})];case 1:return s.sent(),[2]}}))}))},t.prototype.invite=function(e,t,n){var r=n.callId,o=n.payload,i=n.recipients;return Pe(this,void 0,void 0,(function(){var n,s;return Se(this,(function(a){switch(a.label){case 0:return n=Object(m.get)(o,"disabledParticipants",{}),(s=Ae.underscoreObject({callId:r,payload:o,recipients:i})).payload.disabled_participants=n,[4,this.httpClient.post("/v2/voip_call/"+e+"/add_participants",{data:s,headers:{"TT-X-Organization-Key":t}})];case 1:return a.sent(),[2]}}))}))},t.prototype.state=function(e,t,n){var r=n.callId,o=n.payload;return Pe(this,void 0,void 0,(function(){var n,i;return Se(this,(function(s){switch(s.label){case 0:return n=Object(m.get)(o,"disabledParticipants",{}),(i=Ae.underscoreObject({callId:r,payload:Re(Re({},o),{callId:r})})).payload.disabled_participants=n,[4,this.httpClient.post("/v2/voip_call/"+e+"/state",{data:i,headers:{"TT-X-Organization-Key":t}})];case 1:return s.sent(),[2]}}))}))},t.prototype.log=function(e){var t=e.network,n=e.organizationId,r=e.page;return Pe(this,void 0,void 0,(function(){var e,o;return Se(this,(function(i){switch(i.label){case 0:return e={network:t,size:10},r&&(e.page=r),[4,this.httpClient.get("/v2/call_log",{headers:{"TT-X-Organization-Key":n},query:e})];case 1:return o=i.sent(),[2,Ae.camelizeObject(o.data)]}}))}))},t}(Ie),Me=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ze=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},ke=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.find=function(e){return ze(this,void 0,void 0,(function(){return ke(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.get("/v5/conversation/:id",{urlParams:{id:e}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.updateConversationStatus=function(e,t,n){var r=void 0===n?{}:n,o=r.highestSortNumber,i=r.lowestSortNumber;return ze(this,void 0,void 0,(function(){var n;return ke(this,(function(r){switch(r.label){case 0:return n={status:t},o&&(n.highest_sort_number=o),i&&(n.lowest_sort_number=i),[4,this.httpClient.post("/v5/conversation/:id/status",{urlParams:{id:e},data:n})];case 1:return[2,r.sent().data]}}))}))},t.prototype.fetchTimeline=function(e,t,n,r){var o=r.continuation,i=r.markAsDelivered,s=void 0===i||i;return ze(this,void 0,void 0,(function(){return ke(this,(function(r){switch(r.label){case 0:return[4,this.httpClient.post("/v5/conversation/:id/timeline",{urlParams:{id:e},data:{anchor_point:t,continuation:o,mark_as_delivered:s,max_items:n}})];case 1:return[2,r.sent().data]}}))}))},t}(Ie),xe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ue=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Le=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},qe=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},De=_e,Be=$,Fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xe(t,e),t.prototype.batch=function(e){var t=e.ids,n=e.operation,r=e.organizationId;return Le(this,void 0,void 0,(function(){var e;return qe(this,(function(o){switch(o.label){case 0:return e={"TT-X-Organization-Key":r},[4,this.httpClient.patch("/v5/dist_list",{data:{ids:t,operation:n},headers:e})];case 1:return o.sent(),[2]}}))}))},t.prototype.create=function(e){var t=e.adminOnly,n=e.members,r=e.name,o=e.network,i=e.organizationId;return Le(this,void 0,void 0,(function(){var e;return qe(this,(function(s){switch(s.label){case 0:return e={"TT-X-Organization-Key":i},[4,this.httpClient.post("/v5/dist_list",{data:{admin_only:t,members:n,name:r,network:o},headers:e})];case 1:return[2,s.sent().data]}}))}))},t.prototype.delete=function(e,t){return Le(this,void 0,void 0,(function(){var n;return qe(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.del("/v5/dist_list/:id",{headers:n,urlParams:{id:e}})];case 1:return r.sent(),[2]}}))}))},t.prototype.find=function(t,n){var r=(void 0===n?{}:n).organizationId;return Le(this,void 0,void 0,(function(){var n,o,i;return qe(this,(function(s){switch(s.label){case 0:return n=e.prototype.getVersion.call(this,Be).version,o=void 0===n?De:n,i={},r&&(i["TT-X-Organization-Key"]=r),[4,this.httpClient.get("/:version/dist_list/:id",{headers:i,urlParams:{id:t,version:o}})];case 1:return[2,s.sent().data]}}))}))},t.prototype.findMemberIds=function(t,n,r){var o=(void 0===r?{}:r).continuation;return Le(this,void 0,void 0,(function(){var r,i,s,a;return qe(this,(function(u){switch(u.label){case 0:return r=e.prototype.getVersion.call(this,Be).version,i=void 0===r?De:r,s={"TT-X-Organization-Key":n},a="/:version/dist_list/:id/members",o&&(a+="/?continuation=:continuation"),[4,this.httpClient.get(a,{headers:s,urlParams:{continuation:o,id:t,version:i}})];case 1:return[2,u.sent().data]}}))}))},t.prototype.membersBatch=function(e){var t=e.id,n=e.members,r=e.operation,o=e.organizationId;return Le(this,void 0,void 0,(function(){var e;return qe(this,(function(i){switch(i.label){case 0:return e={"TT-X-Organization-Key":o},[4,this.httpClient.patch("/v5/dist_list/:id/members",{data:{members:n,operation:r},headers:e,urlParams:{id:t}})];case 1:return[2,i.sent().data]}}))}))},t.prototype.update=function(e){var t=e.adminOnly,n=e.id,r=e.name,o=e.organizationId;return Le(this,void 0,void 0,(function(){var e;return qe(this,(function(i){switch(i.label){case 0:return e={"TT-X-Organization-Key":o},[4,this.httpClient.put("/v5/dist_list/:id",{data:{admin_only:t,name:r},headers:e,urlParams:{id:n}})];case 1:return[2,i.sent().data]}}))}))},Ue([Oe()],t.prototype,"delete",null),Ue([Oe()],t.prototype,"find",null),Ue([Oe()],t.prototype,"findMemberIds",null),Ue([Oe()],t.prototype,"membersBatch",null),Ue([Oe()],t.prototype,"update",null),t}(Ie),Ge=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ve=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ke=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},He=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},$e=_e,We=W,Xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ge(t,e),t.prototype.findMulti=function(t){var n=t.users,r=t.metadata,o=t.organizationId;return Ke(this,void 0,void 0,(function(){var t,i,s,a;return He(this,(function(u){switch(u.label){case 0:return t=e.prototype.getVersion.call(this,We).version,i=void 0===t?$e:t,s={"TT-X-Organization-Key":o},a={render_owner_object:"true"},[4,this.httpClient.post("/:version/entities_bulk",{urlParams:{version:i},data:{users:n,metadata:r},headers:s,query:a})];case 1:return[2,u.sent().data]}}))}))},Ve([Oe()],t.prototype,"findMulti",null),t}(Ie),Qe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ye=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Je=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ze=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},et=_e,tt=X,nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qe(t,e),t.prototype.escalateMessage=function(t){return Je(this,void 0,void 0,(function(){var n,r;return Ze(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,tt).version,r=void 0===n?et:n,[4,this.httpClient.post("/:version/message/:messageId/escalation",{urlParams:{version:r,messageId:t}})];case 1:return[2,o.sent().data]}}))}))},t.prototype.acknowledge=function(t,n){var r=n.messageId,o=n.userTokens;return Je(this,void 0,void 0,(function(){var n,i;return Ze(this,(function(s){switch(s.label){case 0:return n=e.prototype.getVersion.call(this,tt).version,i=void 0===n?et:n,[4,this.httpClient.post("/:version/message/:messageId/escalation/:escalationId/confirm",{urlParams:{version:i,escalationId:t,messageId:r},data:{confirm_as:o}})];case 1:return[2,s.sent().data]}}))}))},t.prototype.cancel=function(t){return Je(this,void 0,void 0,(function(){var n,r;return Ze(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,tt).version,r=void 0===n?et:n,[4,this.httpClient.del("/:version/message/:messageId/escalation",{urlParams:{version:r,messageId:t}})];case 1:return o.sent(),[2]}}))}))},t.prototype.skip=function(t,n){var r=n.messageId,o=n.userTokens;return Je(this,void 0,void 0,(function(){var n,i;return Ze(this,(function(s){switch(s.label){case 0:return n=e.prototype.getVersion.call(this,tt).version,i=void 0===n?et:n,[4,this.httpClient.post("/:version/message/:messageId/escalation/:escalationId/skip",{urlParams:{version:i,escalationId:t,messageId:r},data:{skip_as:o}})];case 1:return[2,s.sent().data]}}))}))},Ye([Oe()],t.prototype,"escalateMessage",null),Ye([Oe()],t.prototype,"acknowledge",null),Ye([Oe()],t.prototype,"cancel",null),Ye([Oe()],t.prototype,"skip",null),t}(Ie),rt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ot=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},it=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},st=_e,at=Q,ut=Y,ct=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rt(t,e),t.prototype.ack=function(t){return ot(this,void 0,void 0,(function(){var n,r;return it(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,at).version,r=void 0===n?st:n,[4,this.httpClient.post("/:version/events/ack",{urlParams:{version:r},data:{events:t}})];case 1:return o.sent(),[2]}}))}))},t.prototype.closeAllConnections=function(){return ot(this,void 0,void 0,(function(){var t,n;return it(this,(function(r){switch(r.label){case 0:return t=e.prototype.getVersion.call(this,ut).version,n=void 0===t?st:t,[4,this.httpClient.del("/:version/events",{urlParams:{version:n}})];case 1:return r.sent(),[2]}}))}))},t}(Ie),lt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),dt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ht=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},pt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ft=_e,vt=J,yt=Z,gt=ee,mt=te,_t=ne,bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lt(t,e),t.prototype.create=function(t){var n=t.avatarFile,r=t.description,o=t.excludeCreator,i=t.isPublic,s=void 0!==i&&i,a=t.memberIds,u=void 0===a?[]:a,c=t.metadata,l=t.name,d=t.organizationId,h=t.renderEntity,p=void 0===h||h,f=t.replayHistory,v=void 0!==f&&f;return ht(this,void 0,void 0,(function(){var t,i,a,h,f,y;return pt(this,(function(g){switch(g.label){case 0:return t=e.prototype.getVersion.call(this,yt).version,i=void 0===t?ft:t,a={},h={is_public:s,members:u.join(","),metadata:c,name:l,replay_history:v},f={},y={exclude_creator:o,render_entity:p},n&&(f.avatar=n),r&&(h.description=r),d&&(a["TT-X-Organization-Key"]=d),[4,this.httpClient.post("/:version/group",{urlParams:{version:i},query:y,headers:a,data:h,files:f})];case 1:return[2,g.sent().data]}}))}))},t.prototype.update=function(t,n){var r=n.name,o=void 0===r?void 0:r,i=n.avatarFile,s=void 0===i?void 0:i,a=n.replayHistory,u=void 0===a?void 0:a,c=n.memberIds;return ht(this,void 0,void 0,(function(){var n,r,i,a,l,d;return pt(this,(function(h){switch(h.label){case 0:return n=e.prototype.getVersion.call(this,_t).version,r=void 0===n?ft:n,i={},a={},void 0!==o&&(i.name=o),void 0!==c&&(i.members=c.join(",")),void 0!==u&&(i.replay_history=u),s&&(a.avatar=s),[4,this.httpClient.post("/:version/group/:id",{urlParams:{id:t,version:r},data:i,files:a})];case 1:return l=h.sent(),d=l.getHeader("TT-X-Group-Avatar"),[2,{id:t,avatarUrl:d}]}}))}))},t.prototype.find=function(t){return ht(this,void 0,void 0,(function(){var n,r;return pt(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,mt).version,r=void 0===n?ft:n,[4,this.httpClient.get("/:version/group/:id",{urlParams:{id:t,version:r},query:{render_metadata:"true"}})];case 1:return[2,o.sent().data]}}))}))},t.prototype.findAllMemberIds=function(e){return ht(this,void 0,void 0,(function(){return pt(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.get("/:version/group/:id/members",{urlParams:{id:e,version:ft}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.destroy=function(t){return ht(this,void 0,void 0,(function(){var n,r;return pt(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,gt).version,r=void 0===n?ft:n,[4,this.httpClient.del("/:version/group/:id",{urlParams:{id:t,version:r}})];case 1:return o.sent(),[2,!0]}}))}))},t.prototype.addMembers=function(t,n){return ht(this,void 0,void 0,(function(){var r,o;return pt(this,(function(i){switch(i.label){case 0:return r=e.prototype.getVersion.call(this,vt).version,o=void 0===r?ft:r,[4,this.httpClient.post("/:version/group/:id/members",{urlParams:{id:t,version:o},data:{members:n}})];case 1:return[2,i.sent().data]}}))}))},t.prototype.removeMembers=function(e,t){return ht(this,void 0,void 0,(function(){return pt(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.post("/v2/group/:id/members/remove",{urlParams:{id:e},data:{members:t}})];case 1:return n.sent(),[2]}}))}))},dt([Oe()],t.prototype,"find",null),dt([Oe()],t.prototype,"findAllMemberIds",null),dt([Oe()],t.prototype,"destroy",null),t}(Ie),wt=n(25),It=n.n(wt),Ot=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Tt=function(){return(Tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Et=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},At=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ct=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Rt=be,Pt=_e,St=re,jt=oe,Mt=ie,zt=se,kt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ot(t,e),t.prototype.send=function(t){var n=t.attachment,r=t.body,o=t.conversationId,i=t.counterPartyId,s=t.deleteOnRead,a=t.escalate,u=t.localId,c=t.metadata,l=t.priority,d=t.recipientOrganizationId,h=t.senderOrganizationId,p=t.ttl;return At(this,void 0,void 0,(function(){var t,f,v,y,g,m,_,b,w,I;return Ct(this,(function(O){switch(O.label){case 0:t=e.prototype.getVersion.call(this,Mt).version,v={body:r},y={},g={},(f=void 0===t?Pt:t)===Pt?(It()(i)&&(i=i.toLowerCase()),v.recipient=i,y.response_format="message",d||(d=h),h&&(v.sender_organization=h),d&&(v.recipient_organization=d)):f===Rt&&(v.conversation_id=o),c&&(v.data=c.map((function(e){return Tt(Tt({},e),{payload:JSON.stringify(e.payload)})}))),n&&(g.attachment=n),s&&(v.dor=s),a&&(v.escalate=a),void 0!==l&&(v.priority=l),p&&(v.ttl=p),O.label=1;case 1:return O.trys.push([1,5,,6]),[4,this.httpClient.post("/:version/message",{urlParams:{version:f},data:v,files:g,query:y,requestId:u,timeout:!n})];case 2:return m=O.sent(),_=m.headers["tt-x-message-id"],this.config.condensedReplays&&m.data.last_message&&_!==m.data.last_message.message_id?[4,this.host.api.messages.find(_)]:[3,4];case 3:(b=O.sent())&&(m.data.last_message=b.message),O.label=4;case 4:return[2,m.data];case 5:return 304!==(w=O.sent()).status?[2,Promise.reject(w)]:(I=w.response.headers["TT-X-Message-Id".toLowerCase()])?[2,{message_id:I}]:[2,Promise.reject(w)];case 6:return[2]}}))}))},t.prototype.destroy=function(e){return At(this,void 0,void 0,(function(){return Ct(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.httpClient.del("/v2/message/:id",{urlParams:{id:e}})];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.forward=function(t,n,r){var o=r.conversationId,i=r.localId,s=r.metadata,a=r.priority,u=r.recipientOrganizationId,c=r.senderOrganizationId;return At(this,void 0,void 0,(function(){var r,l,d,h;return Ct(this,(function(p){switch(p.label){case 0:return r=e.prototype.getVersion.call(this,jt).version,d={},(l=void 0===r?Pt:r)===Pt?(d.recipient=n,u||(u=c),c&&(d.sender_organization=c),u&&(d.recipient_organization=u)):l===Rt&&(d.conversation_id=o),s&&(d.data=s.map((function(e){return Tt(Tt({},e),{payload:JSON.stringify(e.payload)})}))),void 0!==a&&(d.priority=a),[4,this.httpClient.post("/:version/message/:id/forward",{urlParams:{id:t,version:l},data:d,requestId:i})];case 1:return h=p.sent(),l===Pt?[2,{message_id:h.getHeader("TT-X-Message-Id")}]:[2,h.data]}}))}))},t.prototype.find=function(t){return At(this,void 0,void 0,(function(){var n,r;return Ct(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,St).version,r=void 0===n?Pt:n,[4,this.httpClient.get("/:version/message/:id",{urlParams:{id:t,version:r}})];case 1:return[2,o.sent().data]}}))}))},t.prototype.findRecipientStatus=function(e){return At(this,void 0,void 0,(function(){return Ct(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.get("/:version/message/:id/status",{urlParams:{id:e,version:Pt}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.findRecipientStatusMulti=function(e){return At(this,void 0,void 0,(function(){return Ct(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/:version/get_bulk_message_status",{urlParams:{version:Pt},data:{messages:e}})];case 1:return[2,t.sent().data.bulk_message_statuses]}}))}))},t.prototype.updateRecipientStatusMulti=function(t){return At(this,void 0,void 0,(function(){var n,r;return Ct(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,zt).version,r=void 0===n?Pt:n,[4,this.httpClient.post("/:version/message/status",{urlParams:{version:r},data:t})];case 1:return[2,o.sent().data]}}))}))},t.prototype.createAttachmentTokens=function(e){return void 0===e&&(e=20),At(this,void 0,void 0,(function(){return Ct(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/attachment_tokens_bulk",{data:{count:e,expire_after_sec:43200,expire_after_used_sec:5}})];case 1:return[2,t.sent().data]}}))}))},Et([Oe()],t.prototype,"find",null),Et([Oe()],t.prototype,"findRecipientStatus",null),t}(Ie),Nt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=function(){return(xt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ut=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Lt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},qt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Nt(t,e),t.prototype.batch=function(e){var t=e.ids,n=e.operation,r=e.organizationId;return Lt(this,void 0,void 0,(function(){var e;return qt(this,(function(o){switch(o.label){case 0:return e={"TT-X-Organization-Key":r},[4,this.httpClient.patch("/v5/message_template",{data:{ids:t,operation:n},headers:e})];case 1:return o.sent(),[2]}}))}))},t.prototype.create=function(e){var t=e.attachment,n=e.body,r=e.network,o=e.organizationId,i=e.repository,s=e.title;return Lt(this,void 0,void 0,(function(){var e,a;return qt(this,(function(u){switch(u.label){case 0:return e={},a={"TT-X-Organization-Key":o},t&&(e.attachment=t),[4,this.httpClient.post("/v5/message_template",{files:e,data:{body:n,network:r,repository:i,template_label:s},headers:a,timeout:!t})];case 1:return[2,u.sent().data]}}))}))},t.prototype.delete=function(e,t){return Lt(this,void 0,void 0,(function(){var n;return qt(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.del("/v5/message_template/:id",{headers:n,urlParams:{id:e}})];case 1:return r.sent(),[2]}}))}))},t.prototype.downloadTemplateFile=function(e){var t=e.templateId,n=e.fileName,r=e.organizationId;return Lt(this,void 0,void 0,(function(){var e,o;return qt(this,(function(i){return e={"TT-X-Organization-Key":r},o="/v5/message_template/"+t+"/attachment/"+n,[2,this.httpClient.downloadFileBlob(o,{headers:e})]}))}))},t.prototype.find=function(e,t){return Lt(this,void 0,void 0,(function(){var n;return qt(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.get("/v5/message_template/:id",{headers:n,urlParams:{id:e}})];case 1:return[2,r.sent().data]}}))}))},t.prototype.update=function(e){var t=e.attachment,n=e.body,r=e.id,o=e.organizationId,i=e.repository,s=e.title;return Lt(this,void 0,void 0,(function(){var e,a;return qt(this,(function(u){switch(u.label){case 0:return e={},a={"TT-X-Organization-Key":o},t&&(e.attachment=t),[4,this.httpClient.put("/v5/message_template/:id",{files:e,data:xt(xt({},e.attachment?null:{attachment:t}),{body:n,repository:i,template_label:s}),headers:a,timeout:!t,urlParams:{id:r}})];case 1:return[2,u.sent().data]}}))}))},Ut([Oe()],t.prototype,"delete",null),Ut([Oe()],t.prototype,"downloadTemplateFile",null),Ut([Oe()],t.prototype,"find",null),Ut([Oe()],t.prototype,"update",null),t}(Ie),Bt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ft=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Gt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Vt=_e,Kt=ae,Ht=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Bt(t,e),t.prototype.update=function(e,t,n){return Ft(this,void 0,void 0,(function(){return Gt(this,(function(r){switch(r.label){case 0:return[4,this.httpClient.post("/v2/metadata/:id",{urlParams:{id:e},data:t,headers:{"TT-X-Organization-Key":n}})];case 1:return r.sent(),[2]}}))}))},t.prototype.find=function(t,n){return Ft(this,void 0,void 0,(function(){var r,o;return Gt(this,(function(i){switch(i.label){case 0:return r=e.prototype.getVersion.call(this,Kt).version,o=void 0===r?Vt:r,[4,this.httpClient.get("/:version/metadata/:id",{urlParams:{id:t,version:o},headers:{"TT-X-Organization-Key":n}})];case 1:return[2,i.sent().data]}}))}))},t}(Ie),$t=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Xt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Qt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Yt=_e,Jt=ue,Zt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $t(t,e),t.prototype.findAll=function(){return Xt(this,void 0,void 0,(function(){var t,n;return Qt(this,(function(r){switch(r.label){case 0:return t=e.prototype.getVersion.call(this,Jt).version,n=void 0===t?Yt:t,[4,this.httpClient.get("/:version/mute",{urlParams:{version:n}})];case 1:return[2,r.sent().data]}}))}))},t.prototype.unmuteAll=function(){return Xt(this,void 0,void 0,(function(){return Qt(this,(function(e){switch(e.label){case 0:return[4,this.httpClient.del("/v2/mute")];case 1:return e.sent(),[2]}}))}))},t.prototype.muteUser=function(e,t,n,r){var o=(void 0===r?{}:r).recipientOrganizationId,i=void 0===o?n:o;return Xt(this,void 0,void 0,(function(){return Qt(this,(function(r){switch(r.label){case 0:return[4,this.httpClient.post("/v2/mute/p2p",{data:{sender_token:e,sender_organization:n,receiver_organization:i,duration:t.toString()}})];case 1:return r.sent(),[2]}}))}))},t.prototype.unmuteUser=function(e,t,n){var r=(void 0===n?{}:n).recipientOrganizationId,o=void 0===r?t:r;return Xt(this,void 0,void 0,(function(){return Qt(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.del("/v2/mute/p2p",{headers:{"TT-X-Sender-Token":e,"TT-X-Sender-Organization":t,"TT-X-Receiver-Organization":o}})];case 1:return n.sent(),[2]}}))}))},t.prototype.muteGroup=function(e,t,n){return Xt(this,void 0,void 0,(function(){return Qt(this,(function(r){switch(r.label){case 0:return[4,this.httpClient.post("/v2/mute/group/:groupId",{urlParams:{groupId:e},data:{duration:t.toString(),receiver_organization:n}})];case 1:return r.sent(),[2]}}))}))},t.prototype.unmuteGroup=function(e,t){return Xt(this,void 0,void 0,(function(){return Qt(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.del("/v2/mute/group/:groupId",{urlParams:{groupId:e},headers:{"TT-X-Receiver-Organization":t}})];case 1:return n.sent(),[2]}}))}))},t.prototype.muteOrganization=function(e,t){return Xt(this,void 0,void 0,(function(){return Qt(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.post("/v2/mute/organization/:organizationId",{urlParams:{organizationId:e},data:{duration:t.toString(),receiver_organization:e}})];case 1:return n.sent(),[2]}}))}))},t.prototype.unmuteOrganization=function(e){return Xt(this,void 0,void 0,(function(){return Qt(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.del("/v2/mute/organization/:organizationId",{urlParams:{organizationId:e},headers:{"TT-X-Receiver-Organization":e}})];case 1:return t.sent(),[2]}}))}))},Wt([Oe()],t.prototype,"muteUser",null),Wt([Oe()],t.prototype,"unmuteUser",null),Wt([Oe()],t.prototype,"muteGroup",null),Wt([Oe()],t.prototype,"unmuteGroup",null),Wt([Oe()],t.prototype,"muteOrganization",null),Wt([Oe()],t.prototype,"unmuteOrganization",null),t}(Ie),en=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),tn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},nn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},rn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return en(t,e),t.prototype.closeAllConnections=function(e,t){return tn(this,void 0,void 0,(function(){var n;return nn(this,(function(r){switch(r.label){case 0:return n=this.httpClient.getAuthHeaders({key:e,secret:t}),[4,this.httpClient.del("/v2/events/simple_notifications",{headers:n})];case 1:return r.sent(),[2]}}))}))},t.prototype.signIn=function(){return tn(this,void 0,void 0,(function(){var e,t,n;return nn(this,(function(r){switch(r.label){case 0:return[4,this.host.httpClient.post("/v2/events/simple_notifications/key")];case 1:return e=r.sent(),t=e.getHeader("TT-X-Api-Key"),n=e.getHeader("TT-X-Api-Secret"),[2,{key:t,secret:n}]}}))}))},t.prototype.signOut=function(e,t){return tn(this,void 0,void 0,(function(){var n;return nn(this,(function(r){return n=this.httpClient.getAuthHeaders({key:e,secret:t}),[2,this.httpClient.post("/v2/logout",{headers:n})]}))}))},t}(Ie),on=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),sn=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},an=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},un=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},cn=_e,ln=le,dn=ce,hn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return on(t,e),t.prototype.find=function(t,n){return an(this,void 0,void 0,(function(){var r,o;return un(this,(function(i){switch(i.label){case 0:return r=e.prototype.getVersion.call(this,dn).version,o=void 0===r?cn:r,[4,this.httpClient.get("/:version/user/:userId/organization/:id",{urlParams:{version:o,userId:t,id:n}})];case 1:return[2,i.sent().data]}}))}))},t.prototype.findAllOfUser=function(t){return an(this,void 0,void 0,(function(){var n,r;return un(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,ln).version,r=void 0===n?cn:n,[4,this.httpClient.get("/:version/user/:userId/organization",{urlParams:{version:r,userId:t}})];case 1:return[2,o.sent().data]}}))}))},t.prototype.getPreferences=function(e){return an(this,void 0,void 0,(function(){return un(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.get("/v2/organization/:organizationId/preferences",{urlParams:{organizationId:e}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.editPreferences=function(e){var t=e.organizationId,n=e.quickReplies;return an(this,void 0,void 0,(function(){return un(this,(function(e){switch(e.label){case 0:return[4,this.httpClient.post("/v2/organization/:organizationId/preferences",{headers:{"TT-X-Organization-Key":t},data:Ae.underscoreObject({network:{patient:{quickReplies:n}}}),urlParams:{organizationId:t}})];case 1:return[2,e.sent().data]}}))}))},sn([Oe()],t.prototype,"find",null),sn([Oe()],t.prototype,"findAllOfUser",null),sn([Oe()],t.prototype,"getPreferences",null),sn([Oe()],t.prototype,"editPreferences",null),t}(Ie),pn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},vn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pn(t,e),t.prototype.create=function(e){return fn(this,void 0,void 0,(function(){return vn(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/patient",{data:Ae.underscoreObject(Object(m.omit)(e,"organizationId")),headers:{"TT-X-Organization-Key":e.organizationId}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.delete=function(e,t){return fn(this,void 0,void 0,(function(){return vn(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.del("/v5/patient/:id",{urlParams:{id:e},headers:{"TT-X-Organization-Key":t}})];case 1:return[2,n.sent().data]}}))}))},t.prototype.update=function(e){return fn(this,void 0,void 0,(function(){return vn(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/patient/:id",{data:Ae.underscoreObject(Object(m.omit)(e,["organizationId","patientId"])),headers:{"TT-X-Organization-Key":e.organizationId},urlParams:{id:e.patientId}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.createContact=function(e){return fn(this,void 0,void 0,(function(){return vn(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/patient/:patient_id/contact",{data:Ae.underscoreObject(Object(m.omit)(e,["organizationId","patientId"])),headers:{"TT-X-Organization-Key":e.organizationId},urlParams:{patient_id:e.patientId}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.deleteContact=function(e){return fn(this,void 0,void 0,(function(){return vn(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.del("/v5/patient/:patient_id/contact/:contact_id",{urlParams:{contact_id:e.contactId,patient_id:e.patientId},headers:{"TT-X-Organization-Key":e.organizationId}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.updateContact=function(e){return fn(this,void 0,void 0,(function(){return vn(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/patient/:patient_id/contact/:contact_id",{data:Ae.underscoreObject(Object(m.omit)(e,["organizationId","patientId","contactId"])),headers:{"TT-X-Organization-Key":e.organizationId},urlParams:{patient_id:e.patientId,contact_id:e.contactId}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.login=function(e,t,n,r){return fn(this,void 0,void 0,(function(){var o,i,s,a,u,c,l;return vn(this,(function(d){switch(d.label){case 0:return o={want_condensed_replays:this.config.wantCondensedReplays,want_processing_events:this.config.wantCondensedReplays},t?(o.auth={access_token:t},n&&(o.auth.dob=n)):n&&(o.auth={dob:n}),Array.isArray(r)&&(o.session_tokens=Ae.underscoreObject(r)),[4,this.httpClient.post("/v5/patient/login/:linkToken",{urlParams:{linkToken:e},data:o})];case 1:return(i=d.sent()).data&&(s=i.data,a=s.condensed_replays,u=void 0!==a&&a,c=s.processing_events,l=void 0!==c&&c,this.host.configure({condensedReplays:u,processingEvents:l})),[2,i.data]}}))}))},t.prototype.loginCheck=function(e,t){return fn(this,void 0,void 0,(function(){var n;return vn(this,(function(r){switch(r.label){case 0:return n={},Array.isArray(t)&&(n.session_tokens=Ae.underscoreObject(t)),[4,this.httpClient.post("/v5/patient/login_check/:linkToken",{urlParams:{linkToken:e},data:n})];case 1:return[2,r.sent().data]}}))}))},t.prototype.requestAccessToken=function(e){return fn(this,void 0,void 0,(function(){return vn(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/patient/request_access_token/:linkToken",{urlParams:{linkToken:e},data:{}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.csvUpload=function(e,t){return fn(this,void 0,void 0,(function(){return vn(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.post("/v5/patient/csv/upload",{data:t,headers:{"TT-X-Organization-Key":e}})];case 1:return[2,n.sent().data]}}))}))},t.prototype.getWhiteLabel=function(e){return fn(this,void 0,void 0,(function(){var t;return vn(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.get("/v5/patient/white_label/:organizationId",{urlParams:{organizationId:e},headers:{"TT-X-Organization-Key":e}})];case 1:return t=n.sent(),[2,Ae.camelizeObject(t.data)]}}))}))},t.prototype.setWhiteLabel=function(e,t){return fn(this,void 0,void 0,(function(){return vn(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.post("/v5/patient/white_label/:organizationId",{urlParams:{organizationId:e},headers:{"TT-X-Organization-Key":e},data:Ae.underscoreObject(t)})];case 1:return[2,n.sent()]}}))}))},t}(Ie),gn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mn=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_n=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},bn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},wn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return gn(t,e),t.prototype.create=function(){return _n(this,void 0,void 0,(function(){var e;return bn(this,(function(t){switch(t.label){case 0:return e=this.httpClient.getAuthHeaders(),[4,this.httpClient.get("/v2/qr_login_code/",{headers:e})];case 1:return[2,t.sent().data.qr_key]}}))}))},mn([Oe()],t.prototype,"create",null),t}(Ie),In=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),On=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Tn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},En=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},An=["messageId","sender.name","sender.title","sender.department","sender.mrn","senderRoleDisplayName","recipient.name","recipient.title","recipient.department","recipient.mrn","recipientRoleDisplayName","group.name","distributionList.name","sentTimestamp","attachment.hasAttachment","recalledTimestamp","forwardedMessageId","expireTimestamp","dndAutoForwardedFrom"],Cn={script:"(doc['deliveredTimestamp'].empty ? '' : _source.deliveredTimestamp < _source.sentTimestamp ? _source.sentTimestamp : _source.deliveredTimestamp)"},Rn={script:"(doc['readTimestamp'].empty ? '' :_source.readTimestamp < _source.sentTimestamp ? _source.sentTimestamp : _source.readTimestamp)"},Pn=["sender.title","recipient.title","sender.department","sender.mrn","recipient.mrn","senderRoleDisplayName","recipient.department","recipientRoleDisplayName","sender.username","recipient.username","sender.verifiedEmails","recipient.verifiedEmails","sender.unverifiedEmails","recipient.unverifiedEmails","sender.verifiedPhones","recipient.verifiedPhones","sender.unverifiedPhones","recipient.unverifiedPhones","group.groupId","group.name","distributionList.distributionListId","distributionList.name","forwardedMessageId","messageId"],Sn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.generateLookerEmbed=function(e,n){return Tn(t,void 0,void 0,(function(){var t,r;return En(this,(function(o){switch(o.label){case 0:return t={"TT-X-Organization-Key":e},[4,this.httpClient.post("/v2/looker",{headers:t,data:{dashboard_type:n}})];case 1:return[2,(r=o.sent().data)&&r.looker_url]}}))}))},t}return In(t,e),t.prototype.fetchTransactions=function(e,t){var n=t.page,r=t.size,o=t.startDate,i=t.endDate,s=t.query;return Tn(this,void 0,void 0,(function(){var t,a,u,c,l,d;return En(this,(function(h){switch(h.label){case 0:return t={"TT-X-Organization-Key":e},a=n*r-r,u=e,l=(c=s)&&s.split(" ").join("*"),d=[{range:{sentTimestamp:{from:o,to:i}}},{match:{"sender.organization.orgId":u}},{constant_score:{filter:{missing:{field:"message.hideMessage"}}}},{bool:{should:[{query_string:{query:"*"+l+"*",fields:["sender.name","recipient.name"]}},{multi_match:{query:c,fields:Pn}}]}}],[4,this.httpClient.post("/v2/report/messages",{headers:t,data:{from:a,size:r,fields:An,script_fields:{deliveredTimestamp:Cn,readTimestamp:Rn},sort:{sentTimestamp:{order:"desc"}},query:{bool:{must:d}}}})];case 1:return[2,h.sent()]}}))}))},On([Oe()],t.prototype,"fetchTransactions",null),t}(Ie),jn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mn=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},zn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},kn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Nn=_e,xn=de,Un=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jn(t,e),t.prototype.createP2PGroup=function(t){var n=t.createdByUserId,r=t.name,o=t.replayHistory,i=void 0!==o&&o,s=t.memberIds,a=void 0===s?[]:s,u=t.organizationId;return zn(this,void 0,void 0,(function(){var t,o,s,c,l,d,h,p,f;return kn(this,(function(v){switch(v.label){case 0:return t=e.prototype.getVersion.call(this,xn).version,o=void 0===t?Nn:t,s={"TT-X-Organization-Key":u},c={created_by:n,members:a,name:r,replay_history:i},[4,this.httpClient.post("/:version/role_group",{urlParams:{version:o},headers:s,data:c})];case 1:return l=v.sent(),d=l.data,h=d.conversation_id,p=d.metadata,f=l.data.token,[2,{conversationId:h,memberIds:a,metadata:p,name:r,organizationId:u,token:f}]}}))}))},t.prototype.find=function(e,t){return zn(this,void 0,void 0,(function(){var n;return kn(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.get("/v2/role/:id",{urlParams:{id:e},headers:n})];case 1:return[2,r.sent().data]}}))}))},t.prototype.createRole=function(e){var t=e.description,n=e.escalationPolicy,r=e.name,o=e.noOwnersMessage,i=e.openAssignment,s=e.organizationId,a=e.ownerRequired,u=e.owners,c=e.replayHistory,l=e.tagColor,d=e.tagName,h=e.tagToken;return zn(this,void 0,void 0,(function(){var e,p,f;return kn(this,(function(v){switch(v.label){case 0:return e={"TT-X-Organization-Key":s},p={display_name:r,open_assignment:i?"1":"0",replay_history:c},void 0!==t&&(p.description=t),void 0!==n&&(p.escalation_policy=n),void 0!==o&&(p.no_owners_message=o),void 0!==a&&(p.owner_required=a?"1":"0"),void 0!==u&&(p.owners=u),void 0!==l&&(p.tag_color=l),void 0!==d&&(p.tag_name=d),void 0!==h&&(p.tag_id=h),[4,this.httpClient.post("/v2/role",{headers:e,data:p})];case 1:return(f=v.sent()).token=f.headers["tt-x-role-token"],[2,f]}}))}))},t.prototype.updateRole=function(e,t){var n=t.description,r=t.name,o=t.noOwnersMessage,i=t.openAssignment,s=t.organizationId,a=t.ownerRequired,u=t.owners,c=t.replayHistory,l=t.tagColor,d=t.tagName,h=t.tagToken,p=t.escalationPolicy;return zn(this,void 0,void 0,(function(){var t,f,v;return kn(this,(function(y){switch(y.label){case 0:return t={"TT-X-Organization-Key":s},f={},void 0!==n&&(f.description=n),void 0!==r&&(f.display_name=r),void 0!==o&&(f.no_owners_message=o),void 0!==p&&(f.escalation_policy=p),void 0!==i&&(f.open_assignment=i?"1":"0"),void 0!==a&&(f.owner_required=a?"1":"0"),void 0!==u&&(f.owners=u),void 0!==c&&(f.replay_history=c),void 0!==l&&(f.tag_color=l),void 0!==h&&(f.tag_id=h),void 0!==d&&(f.tag_name=d),[4,this.httpClient.put("/v2/role/:token",{urlParams:{token:e},headers:t,data:f})];case 1:return(v=y.sent()).token=e,[2,v]}}))}))},t.prototype.deleteRole=function(e,t){return zn(this,void 0,void 0,(function(){var n;return kn(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":e},[4,this.httpClient.del("/v2/role/:token",{urlParams:{token:t},headers:n})];case 1:return[2,r.sent()]}}))}))},t.prototype.findSavedRoles=function(e,t){return zn(this,void 0,void 0,(function(){var n;return kn(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.get("/v2/user/:userId/saved_roles",{urlParams:{userId:e},headers:n})];case 1:return[2,r.sent().data]}}))}))},t.prototype.saveRole=function(e,t,n){return zn(this,void 0,void 0,(function(){var r;return kn(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":n},[4,this.httpClient.post("/v2/user/:userId/saved_roles",{urlParams:{userId:t},data:{role_id:e},headers:r})];case 1:return[2,o.sent()]}}))}))},t.prototype.removeSavedRole=function(e,t,n){return zn(this,void 0,void 0,(function(){var r;return kn(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":n},[4,this.httpClient.del("/v2/user/:userId/saved_roles/:roleId",{urlParams:{userId:t,roleId:e},headers:r})];case 1:return[2,o.sent()]}}))}))},t.prototype.optIn=function(e,t,n){return zn(this,void 0,void 0,(function(){var r;return kn(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":n},[4,this.httpClient.post("/v2/role/:roleId/members/:userId",{urlParams:{roleId:e,userId:t},headers:r})];case 1:return[2,o.sent()]}}))}))},t.prototype.optOut=function(e,t,n){return zn(this,void 0,void 0,(function(){var r;return kn(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":n},[4,this.httpClient.del("/v2/role/:roleId/members/:userId",{urlParams:{roleId:e,userId:t},headers:r})];case 1:return[2,o.sent()]}}))}))},t.prototype.saveAwayResponse=function(e,t,n){return zn(this,void 0,void 0,(function(){var r;return kn(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":t},[4,this.httpClient.post("/v2/role/:roleId/away",{urlParams:{roleId:e},headers:r,data:{status:n}})];case 1:return[2,o.sent()]}}))}))},t.prototype.removeAwayResponse=function(e,t){return zn(this,void 0,void 0,(function(){var n;return kn(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.del("/v2/role/:roleId/away",{urlParams:{roleId:e},headers:n})];case 1:return[2,r.sent()]}}))}))},Mn([Oe()],t.prototype,"find",null),Mn([Oe()],t.prototype,"findSavedRoles",null),t}(Ie),Ln=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qn=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Dn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Bn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Fn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ln(t,e),t.prototype.findAll=function(e){return Dn(this,void 0,void 0,(function(){var t;return Bn(this,(function(n){switch(n.label){case 0:return t={"TT-X-Organization-Key":e},[4,this.httpClient.get("/v2/role/tags",{headers:t})];case 1:return[2,n.sent().data]}}))}))},t.prototype.createOrUpdateTag=function(e,t,n,r){return Dn(this,void 0,void 0,(function(){var o,i;return Bn(this,(function(s){switch(s.label){case 0:return o={color:e,name:t,organizationId:n},r?[4,this.updateTag(r,o)]:[3,2];case 1:return i=s.sent(),[3,4];case 2:return[4,this.createTag(o)];case 3:i=s.sent(),s.label=4;case 4:return[2,i]}}))}))},t.prototype.createTag=function(e){var t=e.color,n=e.name,r=e.organizationId;return Dn(this,void 0,void 0,(function(){var e,o;return Bn(this,(function(i){switch(i.label){case 0:return e={"TT-X-Organization-Key":r},[4,this.httpClient.post("/v2/tags",{data:{color:t,name:n},headers:e})];case 1:return(o=i.sent()).token=o.headers["tt-x-tag-id"],[2,o]}}))}))},t.prototype.updateTag=function(e,t){var n=t.color,r=t.name,o=t.organizationId;return Dn(this,void 0,void 0,(function(){var t,i;return Bn(this,(function(s){switch(s.label){case 0:return t={"TT-X-Organization-Key":o},[4,this.httpClient.put("/v2/tags/:token",{urlParams:{token:e},data:{color:n,name:r},headers:t})];case 1:return(i=s.sent()).token=e,[2,i]}}))}))},t.prototype.destroy=function(e,t){return Dn(this,void 0,void 0,(function(){var n;return Bn(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":e},[4,this.httpClient.del("/v2/tags/:token",{urlParams:{token:t},headers:n})];case 1:return[2,r.sent().data]}}))}))},t.prototype.findColors=function(e){return Dn(this,void 0,void 0,(function(){var t;return Bn(this,(function(n){switch(n.label){case 0:return t={"TT-X-Organization-Key":e},[4,this.httpClient.get("/v2/tag/color_list/:organizationId",{urlParams:{organizationId:e},headers:t})];case 1:return[2,n.sent().data]}}))}))},t.prototype.findTag=function(e,t){return Dn(this,void 0,void 0,(function(){var n;return Bn(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":e},[4,this.httpClient.get("/v2/tags/:tagId",{urlParams:{tagId:t},headers:n})];case 1:return[2,r.sent().data]}}))}))},qn([Oe()],t.prototype,"findAll",null),t}(Ie),Gn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Kn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Hn=_e,$n=be,Wn=["user","distributionList"],Xn=H,Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gn(t,e),t.prototype.findAll=function(t){return void 0===t&&(t={organizationId:null}),Vn(this,void 0,void 0,(function(){var n,r,o,i,s;return Kn(this,(function(a){switch(a.label){case 0:return n=e.prototype.getVersion.call(this,Xn).version,i={render_metadata:"true"},(r=void 0===n?Hn:n)===$n&&(o=t.organizationId,i.mark_as_delivered="true",i.paginated="true",i.organization_id=o||void 0),[4,this.httpClient.get("/:version/roster",{query:i,urlParams:{version:r}})];case 1:return(s=a.sent()).data.continuation?[4,this._findAllPaginated(s.data.continuation,o,s.data.items)]:[3,3];case 2:return[2,a.sent()];case 3:return[2,s.data.items||s.data]}}))}))},t.prototype._findAllPaginated=function(e,t,n){return Vn(this,void 0,void 0,(function(){var r;return Kn(this,(function(o){switch(o.label){case 0:return null===e?[2,n]:[4,this.httpClient.get("/v5/roster",{query:{render_metadata:"true",mark_as_delivered:"true",paginated:"true",continuation:encodeURI(e),organization_id:t||void 0}})];case 1:return r=o.sent(),n=n.concat(r.data.items),[2,this._findAllPaginated(r.data.continuation,t,n)]}}))}))},t.prototype.add=function(e,t,n){return Vn(this,void 0,void 0,(function(){var r,o;return Kn(this,(function(i){switch(i.label){case 0:return _.a.includes(Wn,e)?(r={},n&&(r["TT-X-Organization-Key"]=n),o=this.__typeToNS(e),[4,this.httpClient.post("/v2/roster",{headers:r,data:{entity:t,type:o}})]):[2];case 1:return i.sent(),[2]}}))}))},t.prototype.remove=function(e,t,n){return Vn(this,void 0,void 0,(function(){var r,o;return Kn(this,(function(i){switch(i.label){case 0:return _.a.includes(Wn,e)?(r={},o=this.__typeToNS(e),n&&(r["TT-X-Organization-Key"]=n,r["TT-X-Type"]=o),[4,this.httpClient.del("/v2/roster/:counterPartyId",{headers:r,urlParams:{counterPartyId:t},data:{type:o}})]):[2];case 1:return i.sent(),[2]}}))}))},t.prototype.__typeToNS=function(e){return Yn[e]},t}(Ie),Yn={user:"tigertext:entity:account",distributionList:"tigertext:entity:list"},Jn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zn=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},er=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},tr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Jn(t,e),t.prototype.findIntegrationIds=function(e){return Zn(this,void 0,void 0,(function(){var t;return er(this,(function(n){switch(n.label){case 0:return t={Accept:"*/*","TT-X-Organization-Key":e},[4,this.httpClient.post("/v1/integrations/scheduler/configs/info/org",{headers:t,data:{org:e}})];case 1:return[2,n.sent().data]}}))}))},t.prototype.sendCsvSchedule=function(e,t,n,r){return Zn(this,void 0,void 0,(function(){var o,i,s,a,u;return er(this,(function(c){switch(c.label){case 0:o={"Content-Type":"text/csv","TT-X-Organization-Key":n,"TT-X-Integration-Id":e,"TT-X-Timezone":r},c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.httpClient.post("/v1/integrations/scheduler/webhook/csv",{data:t,headers:o})];case 2:return a=c.sent(),i=a.data,s=a.status,[3,4];case 3:return 400!==(u=c.sent()).status?[2,Promise.reject(u)]:(i=u.response&&(u.response.body||u.response.text),s=u.status,[3,4]);case 4:return[2,{json:i,status:s}]}}))}))},t.prototype.findCsv=function(e,t){return Zn(this,void 0,void 0,(function(){var n;return er(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":e},[4,this.httpClient.post("/v1/integrations/scheduler/webhook/csv/download",{headers:n,data:{org:e,id:t},resFormat:"text"})];case 1:return[2,r.sent()]}}))}))},t.prototype.clearSchedule=function(e,t){return Zn(this,void 0,void 0,(function(){var n;return er(this,(function(r){switch(r.label){case 0:return n={Accept:"*/*","TT-X-Organization-Key":e},[4,this.httpClient.post("/v1/integrations/scheduler/configs/truncate",{headers:n,data:{id:t}})];case 1:return[2,r.sent().status]}}))}))},t}(Ie),nr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rr=function(){return(rr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},or=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ir=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},sr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return nr(t,e),t.prototype.batch=function(e){var t=e.ids,n=e.operation,r=e.organizationId;return ir(this,void 0,void 0,(function(){var e;return sr(this,(function(o){switch(o.label){case 0:return e={"TT-X-Organization-Key":r},[4,this.httpClient.patch("/v5/schedule_message",{data:{ids:t,operation:n},headers:e})];case 1:return o.sent(),[2]}}))}))},t.prototype.create=function(e){var t=e.attachment,n=e.body,r=e.end_date,o=e.network,i=e.no_reply,s=e.organizationId,a=e.recipients,u=e.repeating,c=e.send_now,l=e.start_date,d=e.start_time,h=e.template_id,p=e.timezone_name;return ir(this,void 0,void 0,(function(){var e,f;return sr(this,(function(v){switch(v.label){case 0:return e={},f={"TT-X-Organization-Key":s},t&&(e.attachment=t),[4,this.httpClient.post("/v5/schedule_message",{files:e,data:rr(rr(rr(rr(rr(rr(rr(rr({},e.attachment?null:{attachment:t}),{body:n}),u?{end_date:r}:null),{network:o,no_reply:i,recipients:a}),u?{repeating:u}:null),{send_now:c,start_date:l,start_time:d}),h?{template_id:h}:null),{timezone_name:p}),headers:f,timeout:!(t||h)})];case 1:return[2,v.sent().data]}}))}))},t.prototype.delete=function(e,t){return ir(this,void 0,void 0,(function(){var n;return sr(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.del("/v5/schedule_message/:id",{headers:n,urlParams:{id:e}})];case 1:return r.sent(),[2]}}))}))},t.prototype.downloadScheduledMessageFile=function(e){var t=e.scheduleId,n=e.fileName,r=e.organizationId;return ir(this,void 0,void 0,(function(){var e,o;return sr(this,(function(i){return e={"TT-X-Organization-Key":r},o="/v5/schedule_message/"+t+"/attachment/"+n,[2,this.httpClient.downloadFileBlob(o,{headers:e})]}))}))},t.prototype.find=function(e){var t=e.id,n=e.organizationId,r=e.isHistoryCategory;return ir(this,void 0,void 0,(function(){var e;return sr(this,(function(o){switch(o.label){case 0:return e={"TT-X-Organization-Key":n},[4,this.httpClient.get("/v5/schedule_message/:id?history="+r,{headers:e,urlParams:{id:t}})];case 1:return[2,o.sent().data]}}))}))},t.prototype.findCoarseTimezone=function(e,t){return ir(this,void 0,void 0,(function(){var n;return sr(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.get("/v5/timezone/:timezone",{headers:n,urlParams:{timezone:e}})];case 1:return[2,r.sent().data]}}))}))},t.prototype.update=function(e){var t=e.attachment,n=e.body,r=e.end_date,o=e.id,i=e.organizationId,s=e.repeating,a=e.start_date,u=e.start_time,c=e.template_id,l=e.timezone_name;return ir(this,void 0,void 0,(function(){var e,d;return sr(this,(function(h){switch(h.label){case 0:return e={},d={"TT-X-Organization-Key":i},t&&(e.attachment=t),[4,this.httpClient.put("/v5/schedule_message/:id",{files:e,data:rr(rr(rr(rr(rr(rr(rr({},e.attachment?null:{attachment:t}),{body:n}),s?{end_date:r}:null),s?{repeating:s}:null),{start_date:a,start_time:u}),c?{template_id:c}:null),{timezone_name:l}),headers:d,timeout:!(t||c),urlParams:{id:o}})];case 1:return[2,h.sent().data]}}))}))},or([Oe()],t.prototype,"delete",null),or([Oe()],t.prototype,"downloadScheduledMessageFile",null),or([Oe()],t.prototype,"find",null),or([Oe()],t.prototype,"update",null),t}(Ie),ur=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},lr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},dr=_e,hr=he,pr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ur(t,e),t.prototype.query=function(t){return cr(this,void 0,void 0,(function(){var n,r;return lr(this,(function(o){switch(o.label){case 0:return n=e.prototype.getVersion.call(this,hr).version,r=void 0===n?dr:n,[4,this.httpClient.post("/:version/search",{data:t,urlParams:{version:r}})];case 1:return[2,o.sent().data]}}))}))},t.prototype.patientQuery=function(e){return cr(this,void 0,void 0,(function(){return lr(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v5/patient/search",{data:e})];case 1:return[2,t.sent().data]}}))}))},t}(Ie),fr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},yr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},gr=_e,mr=pe,_r=fe,br=ve,wr=ye,Ir=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return fr(t,e),t.prototype.find=function(t,n){var r=n.organizationId;return vr(this,void 0,void 0,(function(){var n,o;return yr(this,(function(i){switch(i.label){case 0:return n=e.prototype.getVersion.call(this,_r).version,o=void 0===n?gr:n,[4,this.httpClient.get("/:version/team/:team_id",{headers:{"TT-X-Organization-Key":r},urlParams:{team_id:t,version:o}})];case 1:return[2,i.sent().data]}}))}))},t.prototype.create=function(t){var n=t.avatar,r=t.canMembersLeave,o=void 0===r||r,i=t.canRequestToJoin,s=void 0===i||i,a=t.description,u=t.displayName,c=t.memberIds,l=void 0===c?[]:c,d=t.organizationId;return vr(this,void 0,void 0,(function(){var t,r,i,c,h;return yr(this,(function(p){switch(p.label){case 0:return t=e.prototype.getVersion.call(this,mr).version,r=void 0===t?gr:t,i={},c={can_members_leave:o,can_request_to_join:s,display_name:u,members:l},h={},n&&(h.avatar=n),a&&(c.description=a),d&&(i["TT-X-Organization-Key"]=d),[4,this.httpClient.post("/:version/team",{urlParams:{version:r},headers:i,data:c,files:h})];case 1:return[2,p.sent().data]}}))}))},t.prototype.update=function(t){var n=t.avatar,r=t.canMembersLeave,o=void 0===r||r,i=t.canRequestToJoin,s=void 0===i||i,a=t.description,u=t.displayName,c=t.id,l=t.memberIds,d=void 0===l?[]:l,h=t.organizationId;return vr(this,void 0,void 0,(function(){var t,r,i,l,p;return yr(this,(function(f){switch(f.label){case 0:return t=e.prototype.getVersion.call(this,wr).version,r=void 0===t?gr:t,i={},l={can_members_leave:o,can_request_to_join:s,display_name:u,members:d},p={},n&&(p.avatar=n),a&&(l.description=a),h&&(i["TT-X-Organization-Key"]=h),[4,this.httpClient.post("/:version/team/:id",{urlParams:{id:c,version:r},headers:i,data:l,files:p})];case 1:return[2,f.sent().data]}}))}))},t.prototype.delete=function(t,n){var r=n.organizationId;return vr(this,void 0,void 0,(function(){var n,o;return yr(this,(function(i){switch(i.label){case 0:return n=e.prototype.getVersion.call(this,mr).version,o=void 0===n?gr:n,[4,this.httpClient.del("/:version/team/:id",{headers:{"TT-X-Organization-Key":r},urlParams:{version:o,id:t}})];case 1:return[2,i.sent().status]}}))}))},t.prototype.requestToJoin=function(t,n){var r=n.organizationId,o=n.requestedById;return vr(this,void 0,void 0,(function(){var n,i;return yr(this,(function(s){switch(s.label){case 0:return n=e.prototype.getVersion.call(this,mr).version,i=void 0===n?gr:n,[4,this.httpClient.post("/:version/team/:id/request",{headers:{"TT-X-Organization-Key":r},urlParams:{id:t,version:i},data:{requested_by:o}})];case 1:return[2,s.sent().status]}}))}))},t.prototype.updateJoinRequest=function(t,n){var r=n.organizationId,o=n.teamId,i=n.handledAsId,s=n.status;return vr(this,void 0,void 0,(function(){var n,a;return yr(this,(function(u){switch(u.label){case 0:return n=e.prototype.getVersion.call(this,mr).version,a=void 0===n?gr:n,[4,this.httpClient.post("/:version/team/:team_id/request/:request_id",{headers:{"TT-X-Organization-Key":r},urlParams:{version:a,team_id:o,request_id:t},data:{handled_as:i,status:s}})];case 1:return[2,u.sent()]}}))}))},t.prototype.leave=function(t,n){var r=n.organizationId;return vr(this,void 0,void 0,(function(){var n,o;return yr(this,(function(i){switch(i.label){case 0:return n=e.prototype.getVersion.call(this,br).version,o=void 0===n?gr:n,[4,this.httpClient.post("/:version/team/:team_id/leave",{headers:{"TT-X-Organization-Key":r},urlParams:{team_id:t,version:o},data:{}})];case 1:return[2,i.sent().status]}}))}))},t}(Ie),Or=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Tr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Er=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Or(t,e),t.prototype.getTwilioNumbers=function(e,t){return Tr(this,void 0,void 0,(function(){var n;return Er(this,(function(r){switch(r.label){case 0:return n={"TT-X-Organization-Key":e},[4,this.httpClient.post("/v2/twilio/numbers",{headers:n,data:{area_code:t}})];case 1:return[2,r.sent().data]}}))}))},t.prototype.assignPagerNumber=function(e,t,n){return Tr(this,void 0,void 0,(function(){var r;return Er(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":e},[4,this.httpClient.post("/v2/user/:roleToken/organization/:organizationId/pagers?process_number=true",{headers:r,urlParams:{organizationId:e,roleToken:n},data:{pager_numbers:t}})];case 1:return[2,o.sent()]}}))}))},t.prototype.removePagerNumber=function(e,t,n){return Tr(this,void 0,void 0,(function(){var r;return Er(this,(function(o){switch(o.label){case 0:return r={"TT-X-Organization-Key":e},[4,this.httpClient.del("/v2/user/:roleToken/organization/:organizationId/pagers/:number?process_number=true",{headers:r,urlParams:{organizationId:e,roleToken:n,number:t}})];case 1:return[2,o.sent()]}}))}))},t}(Ie),Cr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Pr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Sr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Cr(t,e),t.prototype.startTyping=function(e,t,n){return Rr(this,void 0,void 0,(function(){var r;return Pr(this,(function(o){switch(o.label){case 0:return r={recipient:e},t&&t!==this.host.currentUserId&&(r.proxy_token=t),[4,this.httpClient.post("/v2/message/typing",{data:r,headers:{"TT-X-Organization-Key":n}})];case 1:return o.sent(),[2]}}))}))},t.prototype.stopTyping=function(e,t){return Rr(this,void 0,void 0,(function(){return Pr(this,(function(n){switch(n.label){case 0:return t?[4,this.httpClient.del("/v2/message/typing/:recipientId/:senderId",{urlParams:{recipientId:e,senderId:t}})]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this.httpClient.del("/v2/message/typing/:recipientId",{urlParams:{recipientId:e}})];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t}(Ie),jr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mr=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},zr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},kr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Nr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jr(t,e),t.prototype.findAll=function(e,t){return zr(this,void 0,void 0,(function(){return kr(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.get("/v2/user/:userId/organization/:organizationId/roles",{urlParams:{userId:e,organizationId:t}})];case 1:return[2,n.sent().data.roles]}}))}))},Mr([Oe()],t.prototype,"findAll",null),t}(Ie),xr=n(14),Ur=n.n(xr),Lr=n(10),qr=n.n(Lr),Dr=n(15),Br=n.n(Dr);function Fr(e){return e&&/^\+?([0-9]{7,15})$/.test(e.replace(/[-.● ()]/g,""))}function Gr(e){var t=e.replace(/\D/g,"");return/^\+?1/.test(e)?t.replace(/^(1)(\d{3})(\d{3})(\d{4})/,"+$1 $2 $3 $4"):("1"===t[0]&&(t=t.slice(1)),t.replace(/^(\d{3})(\d{3})(\d{4})/,"$1 $2 $3"))}function Vr(e){var t=e.replace(/\D/g,"");return"1"===t[0]&&(t=t.slice(1)),t.replace(/^(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}function Kr(e){return e.replace(/\D/g,"")}function Hr(e){var t=e.replace(/\D/g,"");return"1"!==t[0]&&(t="1"+t),"+"+t}var $r=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wr=function(){return(Wr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Xr=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Qr=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Yr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Jr=_e,Zr=ge,eo=me,to=new Br.a.MD5,no=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $r(t,e),t.getSignInAuthHeader=function(e,t,n){var r=[e,t,n].join(":");return"XMPP-Simple "+qr()(r)},t.prototype.getAnonymousAuthHeader=function(e){var t=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=[t,n,e].join(":"),o=to.hex(r),i=[o.substr(0,2),o.substr(o.length-2)].join(""),s=[this.config.productKey,t,n,e,i].join(":");return"XMPP-Anonymous "+qr()(s)},t.prototype.getSignInAuthHeader=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.constructor).getSignInAuthHeader.apply(e,t)},t.prototype.checkLogin=function(e,t){return Qr(this,void 0,void 0,(function(){var n,r;return Yr(this,(function(o){switch(o.label){case 0:return n={Authorization:this.getAnonymousAuthHeader(t.udid)},r={device:t.udid,tt_product_version:this.config.partnerName},Fr(e)?r.phones=Hr(e):r.emails=e,[4,this.httpClient.get("/v4/login_check",{headers:n,query:r})];case 1:return[2,o.sent()]}}))}))},t.prototype.signUp=function(e){return Qr(this,void 0,void 0,(function(){var t,n;return Yr(this,(function(r){switch(r.label){case 0:return t={Authorization:this.getAnonymousAuthHeader(e.udid)},n={primary_email:e.email,unique_id:e.email,password:e.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:e.countryCode,device_id:e.udid,version:this.config.version},[4,this.httpClient.post("/v2/signup",{headers:t,data:n})];case 1:return[2,r.sent()]}}))}))},t.prototype.signIn=function(e,t){return Qr(this,void 0,void 0,(function(){var n,r,o,i,s,a,u;return Yr(this,(function(c){switch(c.label){case 0:return n={device_id:t.udid,metadata:{device_type:"js_sdk",device_version:"12.6.0",tt_product_version:this.config.partnerName,user_agent:global.navigator&&global.navigator.userAgent},push_routing:this.config.pushAgent,version:this.config.version,want_condensed_replays:this.config.wantCondensedReplays,want_processing_events:this.config.wantCondensedReplays},[4,this.httpClient.post("/v5/login",{headers:e,data:n})];case 1:return(r=c.sent()).data&&r.data.settings&&(o=r.data.settings,i=o.condensed_replays,s=void 0!==i&&i,a=o.processing_events,u=void 0!==a&&a,this.host.configure({condensedReplays:s,processingEvents:u})),[2,r]}}))}))},t.prototype.signOut=function(){return Qr(this,void 0,void 0,(function(){return Yr(this,(function(e){switch(e.label){case 0:return[4,this.httpClient.post("/v2/logout")];case 1:return[2,e.sent()]}}))}))},t.prototype.lookup=function(t){return Qr(this,void 0,void 0,(function(){var n,r,o;return Yr(this,(function(i){switch(i.label){case 0:return n=e.prototype.getVersion.call(this,Zr).version,r=void 0===n?Jr:n,o={display_name:t},It()(t)?o.email_address=t:Fr(t)&&(o.phone_number=Hr(t)),[4,this.httpClient.post("/:version/user_lookup/:id",{urlParams:{id:t,version:r},data:o})];case 1:return[2,i.sent().data]}}))}))},t.prototype.wipe=function(e){return Qr(this,void 0,void 0,(function(){return Yr(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.post("/v2/wipe",{data:{},query:{token:e}})];case 1:return[2,t.sent()]}}))}))},t.prototype.find=function(t,n){var r=(void 0===n?{}:n).organizationId;return Qr(this,void 0,void 0,(function(){var n,o,i;return Yr(this,(function(s){switch(s.label){case 0:return n=e.prototype.getVersion.call(this,Zr).version,o=void 0===n?Jr:n,It()(t)&&(t=t.toLowerCase()),i=r?{"TT-X-Organization-Key":r}:null,[4,this.httpClient.get("/:version/user/:id",{headers:i,urlParams:{id:t,version:o},query:{render_metadata:!0}})];case 1:return[2,s.sent().data]}}))}))},t.prototype.findMe=function(t){var n=(void 0===t?{}:t).organizationId;return Qr(this,void 0,void 0,(function(){var t,r,o;return Yr(this,(function(i){switch(i.label){case 0:return t=e.prototype.getVersion.call(this,eo).version,r=void 0===t?Jr:t,o=n?{"TT-X-Organization-Key":n}:null,[4,this.httpClient.get("/:version/user",{headers:o,query:{render_metadata:!0},urlParams:{version:r}})];case 1:return[2,i.sent().data]}}))}))},t.prototype.update=function(e,t){var n=t.firstName,r=void 0===n?void 0:n,o=t.lastName,i=void 0===o?void 0:o,s=t.displayName,a=void 0===s?void 0:s,u=t.status,c=void 0===u?void 0:u,l=t.dnd,d=void 0===l?void 0:l,h=t.dndText,p=void 0===h?void 0:h,f=t.avatarFile,v=void 0===f?void 0:f,y=t.removeAvatar,g=void 0===y?void 0:y;return Qr(this,void 0,void 0,(function(){var t,n;return Yr(this,(function(o){switch(o.label){case 0:return t={},g?t.avatar=null:v&&(t.avatar=v),n=Ur.a.call({first_name:r,last_name:i,display_name:a,status:c,dnd:d,dnd_text:p},(function(e,t){return void 0===e})),[4,this.httpClient.post("/v2/user/:id/settings",{urlParams:{id:e},data:n,files:t})];case 1:return o.sent(),[2,Wr({id:e},v&&v.preview?{avatarUrl:v.preview}:null)]}}))}))},t.prototype.updatePassword=function(e,t,n,r){return Qr(this,void 0,void 0,(function(){var o;return Yr(this,(function(i){switch(i.label){case 0:return o={Authorization:this.getSignInAuthHeader(r,e,t)},[4,this.httpClient.post("/v2/user/:id/password",{urlParams:{id:e},headers:o,data:{password:n}})];case 1:return[2,i.sent()]}}))}))},t.prototype.setAutoForward=function(e,t,n){var r=n.dnd,o=n.receiverId;return Qr(this,void 0,void 0,(function(){return Yr(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.post("/v2/user/:userId/organization/:organizationId",{urlParams:{userId:e,organizationId:t},data:{dnd:r,dnd_auto_forward_receiver:o}})];case 1:return[2,n.sent()]}}))}))},t.prototype.removeAutoForward=function(e,t){return Qr(this,void 0,void 0,(function(){return Yr(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.del("/v2/user/:userId/organization/:organizationId/dnd_auto_forward_receiver",{urlParams:{userId:e,organizationId:t}})];case 1:return[2,n.sent()]}}))}))},t.prototype.setAwayMessage=function(e,t,n){var r=n.dnd,o=n.dndText;return Qr(this,void 0,void 0,(function(){return Yr(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.post("/v5/user/:userId/organization/:organizationId",{urlParams:{userId:e,organizationId:t},data:{network:{patient:{dnd:r,dnd_text:o}}}})];case 1:return n.sent(),[2]}}))}))},t.prototype.setEulaAccepted=function(e,t,n){return Qr(this,void 0,void 0,(function(){return Yr(this,(function(r){switch(r.label){case 0:return[4,this.httpClient.post("/v2/user/:userId/organization/:organizationId",{urlParams:{userId:e,organizationId:t},data:{eula:!n}})];case 1:return[2,r.sent()]}}))}))},t.prototype.getPreferences=function(e){return Qr(this,void 0,void 0,(function(){return Yr(this,(function(t){switch(t.label){case 0:return[4,this.httpClient.get("/v2/user/:userId/preferences",{urlParams:{userId:e}})];case 1:return[2,t.sent().data]}}))}))},t.prototype.editPreferences=function(e){var t=e.organizationId,n=e.quickReplies,r=e.userId;return Qr(this,void 0,void 0,(function(){return Yr(this,(function(e){switch(e.label){case 0:return[4,this.httpClient.post("/v2/user/:userId/preferences",{headers:{"TT-X-Organization-Key":t},data:Ae.underscoreObject({quickReplies:n}),urlParams:{userId:r}})];case 1:return[2,e.sent().data]}}))}))},Xr([Oe({httpStatusCodes:[400]})],t.prototype,"lookup",null),Xr([Oe()],t.prototype,"find",null),Xr([Oe()],t.prototype,"getPreferences",null),Xr([Oe()],t.prototype,"editPreferences",null),t}(Ie),ro=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),oo=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},io=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},so=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ro(t,e),t.prototype.findAll=function(e,t){var n=(void 0===t?{showAll:!1}:t).showAll;return io(this,void 0,void 0,(function(){var t;return so(this,(function(r){switch(r.label){case 0:return[4,this.httpClient.get("/vwr/v1/rooms?show_all="+n,{headers:{"TT-X-Organization-Key":e}})];case 1:return t=r.sent(),[2,Ae.camelizeObject(t.data)]}}))}))},t.prototype.find=function(e,t){return io(this,void 0,void 0,(function(){var n,r;return so(this,(function(o){switch(o.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.get("/vwr/v1/room/:id",{headers:n,urlParams:{id:e}})];case 1:return r=o.sent(),[2,Ae.camelizeObject(r.data)]}}))}))},t.prototype.create=function(e,t){var n=t.staff,r=t.name;return io(this,void 0,void 0,(function(){var t,o,i;return so(this,(function(s){switch(s.label){case 0:return t={"TT-X-Organization-Key":e},o=Ae.underscoreObject({staff:n,name:r}),[4,this.httpClient.post("/vwr/v1/room",{headers:t,data:o})];case 1:return i=s.sent(),[2,Ae.camelizeObject(i.data)]}}))}))},t.prototype.update=function(e,t,n){var r=n.staff,o=n.name,i=n.status,s=n.version;return io(this,void 0,void 0,(function(){var n,a,u;return so(this,(function(c){switch(c.label){case 0:return n={"TT-X-Organization-Key":t},a=Ae.underscoreObject({staff:r,name:o,status:i,version:s}),[4,this.httpClient.put("/vwr/v1/room/:id",{headers:n,urlParams:{id:e},data:a})];case 1:return u=c.sent(),[2,Ae.camelizeObject(u.data)]}}))}))},t.prototype.delete=function(e,t){return io(this,void 0,void 0,(function(){var n,r;return so(this,(function(o){switch(o.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.del("/vwr/v1/room/:id",{headers:n,urlParams:{id:e}})];case 1:return r=o.sent(),[2,Ae.camelizeObject(r.data)]}}))}))},t.prototype.getVisitInfo=function(e){return io(this,void 0,void 0,(function(){var t;return so(this,(function(n){switch(n.label){case 0:return[4,this.httpClient.get("/vwr/v1/visit/join?join_id=:joinId",{urlParams:{joinId:e}})];case 1:return t=n.sent(),[2,Ae.camelizeObject(t.data)]}}))}))},t.prototype.createVisit=function(e){var t=e.firstName,n=e.lastName,r=e.mobilePhone,o=e.visitReason,i=e.joinId;return io(this,void 0,void 0,(function(){var e;return so(this,(function(s){switch(s.label){case 0:return[4,this.httpClient.post("/vwr/v1/visit/join?join_id=:joinId",{data:Ae.underscoreObject({firstName:t,lastName:n,mobilePhone:r,visitReason:o,processingEvents:!0,condensedReplays:!0}),urlParams:{joinId:i}})];case 1:return e=s.sent(),[2,Ae.camelizeObject(e.data)]}}))}))},t.prototype.rejoinVisit=function(e){var t=e.rejoinToken,n=e.sessionTokens;return io(this,void 0,void 0,(function(){var e,r;return so(this,(function(o){switch(o.label){case 0:return e=Ae.underscoreObject({rejoinToken:t,sessionTokens:n,wantProcessingEvents:!0,wantCondensedReplays:!0}),[4,this.httpClient.post("/vwr/v1/visit/rejoin",{data:e})];case 1:return r=o.sent(),[2,Ae.camelizeObject(r.data)]}}))}))},t.prototype.rejoinWithAuthForm=function(e){var t=e.rejoinToken,n=e.challengeAnswers;return io(this,void 0,void 0,(function(){var e,r;return so(this,(function(o){switch(o.label){case 0:return e=Ae.underscoreObject({rejoinToken:t,challengeAnswers:n,wantProcessingEvents:!0,wantCondensedReplays:!0}),[4,this.httpClient.put("/vwr/v1/visit/rejoin",{data:e})];case 1:return r=o.sent(),[2,Ae.camelizeObject(r.data)]}}))}))},t.prototype.cleanupVisits=function(e){var t=e.type,n=e.roomId,r=e.organizationId;return io(this,void 0,void 0,(function(){var e;return so(this,(function(o){switch(o.label){case 0:return e={"TT-X-Organization-Key":r},[4,this.httpClient.put("/vwr/v1/room/:roomId/cleanup",{headers:e,data:{type:t},urlParams:{roomId:n}})];case 1:return o.sent(),[2]}}))}))},t.prototype.findAllVisits=function(e,t){return io(this,void 0,void 0,(function(){var n,r;return so(this,(function(o){switch(o.label){case 0:return n={"TT-X-Organization-Key":t},[4,this.httpClient.get("/vwr/v1/room/:roomId/visits",{headers:n,urlParams:{roomId:e}})];case 1:return r=o.sent(),[2,Ae.camelizeObject(r.data)]}}))}))},t.prototype.informProvider=function(e,t){var n=t.roomId,r=t.visitId,o=t.accountToken;return io(this,void 0,void 0,(function(){var t,i;return so(this,(function(s){switch(s.label){case 0:return t={"TT-X-Organization-Key":e},[4,this.httpClient.post("/vwr/v1/room/:roomId/visit/:visitId/provider/:accountToken",{headers:t,urlParams:{roomId:n,visitId:r,accountToken:o}})];case 1:return i=s.sent(),[2,Ae.camelizeObject(i.data)]}}))}))},t.prototype.updateVisit=function(e,t){var n=t.roomId,r=t.visitId,o=t.options;return io(this,void 0,void 0,(function(){var t,i;return so(this,(function(s){switch(s.label){case 0:return t={"TT-X-Organization-Key":e},[4,this.httpClient.put("/vwr/v1/room/:roomId/visit/:visitId",{headers:t,urlParams:{roomId:n,visitId:r},data:o})];case 1:return i=s.sent(),[2,Ae.camelizeObject(i.data)]}}))}))},oo([Oe()],t.prototype,"findAll",null),oo([Oe()],t.prototype,"find",null),oo([Oe()],t.prototype,"create",null),oo([Oe()],t.prototype,"update",null),oo([Oe()],t.prototype,"delete",null),oo([Oe()],t.prototype,"createVisit",null),oo([Oe()],t.prototype,"rejoinVisit",null),oo([Oe()],t.prototype,"informProvider",null),oo([Oe()],t.prototype,"updateVisit",null),t}(Ie),uo={CONSUMER_ORGANIZATION_ID:"UpM28mnfW65vJkbqEATtKvxm",BASE_URLS:{local:"http://localhost:8888",productionOauth:"http://52.41.133.15:8000/tigertextapi"},ADMIN_URLS:{},CN_URLS:{},FORGOT_PASSWORD_URLS:{},ROLES_URLS:{},CLOUDFRONT:{development:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},production:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},tt:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},ihis:{avatar:"",groupAvatar:""}},CONFIG_DEFAULT:{adminFeatureBranch:null,allowProviderCalling:!1,apiEnv:"production",assetDomain:"assets.tigerconnect.com",autoAckSuccessfullyHandledEvents:!0,autoSignOutOnBrowserUnload:!0,baseUrl:null,botUsers:[],clearTypingStatusThrottleDelay:2e3,clearTypingStatusTimeout:8e3,cloudfrontDomain:"cloudfront.net",cloudfront:{},condensedReplays:!1,consumerOrganizationId:"UpM28mnfW65vJkbqEATtKvxm",detectBangReplayTimeout:1e3,events:{autoAck:!1,autoDeliver:!1,canConfirm:!0,closeAfterMessages:!1,heartbeat:!0,hidden:!1,includeDistributionListEvents:!0,isTyping:!0,keepAlive:!1,msgDeliveryDelay:0,multiOrg:!0,noOfflineMessages:!1,renderMetadata:!0},eventCollectionInterval:50,eventDrainTimeout:4e3,eventsAutoReconnect:!0,eventsAutoReconnectDelay:2e3,eventsAutoReconnectMaxDelay:16e3,eventsClearRetryHistoryInterval:6e4,eventsDebugging:!1,eventsHeartbeatIntervalVisible:12e3,eventsHeartbeatIntervalInvisible:3e4,eventsOpenTimeout:6e3,flushAckInterval:1e3,flushAckMaxConnections:2,flushAckMaxEvents:50,flushFindRecipientStatusInterval:150,flushFindRecipientStatusMaxCount:20,flushSetMessageStatusInterval:1e3,flushSetMessageStatusMaxCount:500,keepConversationsForAllForums:!1,localAdminUrl:null,localCnUrl:null,localRolesUrl:null,logLevel:"error",manuallyRequestEventQueueBatch:!1,maxEventBatch:50,maxMetadataKeyCount:11,organizationRostersChangeThrottleDelay:500,placeholderEntityAllowLoading:!0,placeholderEntityDelayBeforeRefreshing:100,processingEvents:!1,productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",pushAgent:"consumer",rolesFeatureBranch:null,serviceLogLevels:{},signUpHashKey:"21d2ff3ffbf",signUpHashSalt:"%(xx*&x$&*%&",ttRoute:null,version:"1.0",wantCondensedReplays:!0}};["stag","uat"].forEach((function(e){uo.BASE_URLS[e]="https://"+e+"-devapi.tigertext.me",uo.FORGOT_PASSWORD_URLS[e]="https://"+e+"-forget.tigertext.com",uo.CN_URLS[e]="https://"+e+"-console.tigertext.me",uo.ADMIN_URLS[e]="https://"+e+"-console.tigertext.me/app/admin",uo.ROLES_URLS[e]="/"+e+"/app/roles/index.html"}));["ihis","prod","prod-a","prod-c","production","tt"].forEach((function(e){uo.BASE_URLS[e]="https://api.tigertext.me",uo.FORGOT_PASSWORD_URLS[e]="https://forget.tigertext.com",uo.CN_URLS[e]="https://home.tigertext.com",uo.ADMIN_URLS[e]="https://home.tigertext.com/app/admin",uo.ROLES_URLS[e]="/app/roles/index.html"}));["prod-a","prod-c"].forEach((function(e){var t=e.replace("prod-","");uo.BASE_URLS[e]="https://"+t+"-api.tigertext.me"}));["ihis"].forEach((function(e){uo.CN_URLS[e]="https://"+e+".tigertext.com",uo.ADMIN_URLS[e]="https://"+e+".tigertext.com/app/admin"}));["prod-dr"].forEach((function(e){uo.BASE_URLS[e]="https://"+e+"-api.tigertext.me",uo.CN_URLS[e]="https://"+e+".tigertext.com",uo.ADMIN_URLS[e]="https://"+e+".tigertext.com/app/admin",uo.ROLES_URLS[e]="/"+e+"/app/roles/index.html"}));var co=uo,lo=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},ho=function(){function e(e){var t=e.name,n=e.level;this.name=t,this.level=n}return e.prototype.setLevel=function(e){this.level=e.toLowerCase()},e}(),po=ho,fo=["debug","log","info","warn","error"],vo=fo.reduce((function(e,t,n){return e[t]=n,e}),{});fo.forEach((function(e){var t=vo[e];ho.prototype[e]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t>=vo[this.level]&&(n=lo(["["+this.name+"]"],n),Function.prototype.apply.call(console[e],console,n))}}));for(var yo,go=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mo=function(){return(mo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},_o=function(){function e(e,t){for(var n in void 0===t&&(t={}),Array.isArray(e)&&(e=e.reduce((function(e,t){return e[t]={},e}),{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=t.defaultValue||null,e){this[n]=t.valueFn?t.valueFn(n):n;var r=mo({key:n},e[n]);this.entriesByKey[n]=r,this.entries.push(r),this.keys.push(n)}Object.freeze(this.keys),Object.freeze(this.entries),Object.freeze(this.entriesByKey)}return e.prototype.resolve=function(e){return e||this.defaultValue},e.prototype.isValid=function(e){return!!this.entriesByKey[e]},e}(),bo=_o,wo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return go(t,e),t.prototype.mapEnumKeyToServerValue=function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=_.a.transform(this.entries,(function(e,t){return e[t.key]=t.serverValue}),{}))},t.prototype.mapServerValueToEnumKey=function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=_.a.invert(this.mapEnumKeyToServerValue()))},t.prototype.fromServer=function(e){return this.mapServerValueToEnumKey()[e]},t.prototype.toServer=function(e){return this.mapEnumKeyToServerValue()[this.resolve(e)]},t.prototype.resolve=function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue},t}(_o),Io=new bo(["CONTACTS_MESSAGING_BLOCKED_BY_ADMIN","CONVERSATION_NOT_FULLY_LOADED","CONVERSATION_WITH_ROLE_YOU_ARE_CURRENTLY_IN","COUNTER_PARTY_IS_TIGERPAGE","COUNTER_PARTY_NOT_FULLY_LOADED","COUNTER_PARTY_TYPE_NOT_SUPPORTED","GROUP_HAS_NO_MEMBERS","GROUP_MEMBERS_NOT_LOADED","IS_ROLE_ASSIGNMENT_GROUP","NO_COUNTER_PARTY","ORGANIZATION_DOES_NOT_EXIST","USER_IS_NOT_IN_THIS_ROLE_CONVERSATION","USER_IS_NOT_MEMBER_OF_GROUP","NONE"]),Oo=new wo({CONTINUATION:{serverValue:"continuation"},CONVERSATION_END:{serverValue:"conversation_end"},FIRST_UNREAD_ITEM:{serverValue:"first_unread_item"}}),To=new wo({ACKNOWLEDGED:{serverValue:"escalation_acknowledged"},CANCELLED:{serverValue:"escalation_cancelled"},INITIATED:{serverValue:"escalation_initiated"},MEMBER_ADDED:{serverValue:"escalation_member_added"},NO_RESPONSE:{serverValue:"escalation_no_response"}}),Eo=new wo({ACKNOWLEDGED:{serverValue:"confirmed"},CANCELLED:{serverValue:"cancelled"},IN_PROGRESS:{serverValue:"in_progress"},NO_RESPONSE:{serverValue:"no_response"}}),Ao=new bo(["ACTIVATED_TEAM","ESCALATION","FORUM","GROUP","INTRA_TEAM","PATIENT_CARE","PATIENT_MESSAGING","ROLE_ASSIGNMENT","ROLE_P2P"]),Co=new wo({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"}),Ro=new wo({NA:{key:"NA"},NEW:{serverValue:"New"},DELIVERED:{serverValue:"Delivered"},READ:{serverValue:"Read"},ACKNOWLEDGED:{serverValue:"Confirmed"}},{defaultValue:"NA"}),Po=((yo={})[Ro.NA]=0,yo[Ro.NEW]=1,yo[Ro.DELIVERED]=2,yo[Ro.READ]=3,yo[Ro.ACKNOWLEDGED]=4,yo),So=Ro,jo=new bo(["SENDING","SENT","FAILED","RETRYING","NEW","NA"]),Mo=new wo({EMPTY_ROLE_NOTIFICATION:{serverValue:"empty_role_notification"},NA:{key:"NA"},ROLE_AWAY_NOTIFICATION:{serverValue:"role_away_notification"},SCHEDULE_MESSAGE:{serverValue:"schedule_message"},SMS_OPT_IN_NOTIFICATION:{serverValue:"sms_optin_notification"},SMS_OPT_OUT_NOTIFICATION:{serverValue:"sms_optout_notification"},SYSTEM:{serverValue:"system"},TEAM_REQUEST:{serverValue:"team_request"},USER_AWAY_NOTIFICATION:{serverValue:"user_away_notification"}},{defaultValue:"NA"}),zo=new bo(["CALL_CHANGE","ESCALATION_EXECUTION_CHANGE","GROUP_MEMBERSHIP_CHANGE","HIGHER_CONTINUATION","LOWER_CONTINUATION","USER_SENT"]),ko=new bo(["PATIENT","PROVIDER"]),No=new wo({ADD_MEMBERS:{serverValue:"add_members"}},{defaultValue:"NA"}),xo=new wo({ADMIT:{serverValue:"admit"},DISCHARGE:{serverValue:"discharge"},LAB:{serverValue:"lab"},TRANSFER:{serverValue:"transfer"}},{defaultValue:"NA"}),Uo=new wo({ACTION:{serverValue:"ehr_action_item"},HEADER:{serverValue:"ehr_header"},ITEM:{serverValue:"table_item"},TEXT:{serverValue:"ehr_text_view"}},{defaultValue:"NA"}),Lo=new wo({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}}),qo=new wo({CONVERSATION_MESSAGE_STATUS:{serverValue:"conversation_message_status"},GROUP_REPLAY:{serverValue:"group_replay"},MESSAGE_REPLAY:{serverValue:"message_replay"},OFFLINE:{serverValue:"offline"},ORGANIZATION_MESSAGE_STATUS:{serverValue:"organization_message_status"},ORGANIZATION_REPLAY:{serverValue:"organization_replay"},ROLE_OPT_IN:{serverValue:"optin"},ROLE_OPT_OUT:{serverValue:"optout"}}),Do=new wo({DISTRIBUTION_LIST_MEMBER:{serverValue:"dist_list_member"},DISTRIBUTION_LIST:{serverValue:"distribution_list"},FORUM:{serverValue:"public_group"},GROUP:{serverValue:"group"},MESSAGE_TEMPLATE:{serverValue:"message_template"},ORGANIZATION:{serverValue:"organization"},PATIENT_DISTRIBUTION_LIST:{serverValue:"patient_distribution_list"},PATIENT:{serverValue:"patient_account"},SCHEDULED_MESSAGE:{serverValue:"schedule_message"},TAG:{serverValue:"tag"},TEAM:{serverValue:"team"},USER:{serverValue:"account"}}),Bo=new bo(["GLOBAL","GROUP","ORGANIZATION"],{valueFn:function(e){return e.toLowerCase()}}),Fo=new bo(["VISIBLE","HIDDEN","PRERENDER"]),Go={WAITING:-1,CONNECTING:0,OPEN:1,CLOSED:2},Vo={},Ko=0,Ho=["\n","\r"," ",":"];Ko<Ho.length;Ko++){var $o=Ho[Ko];Vo[$o]=$o.charCodeAt(0)}var Wo=Vo,Xo=function(e){this.type=e,this.target=void 0},Qo=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yo=function(e){function t(t,n){var r=n.headers,o=n.message,i=n.status,s=n.statusText,a=e.call(this,t)||this;return a.headers=r,a.message=o,a.status=i,a.statusText=s,a}return Qo(t,e),t}(Xo),Jo=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zo=function(e){function t(t,n){var r=e.call(this,t)||this;return r.data=n.data,r.lastEventId=n.lastEventId,r}return Jo(t,e),t}(Xo),ei={AFTER_CR:-1,FIELD_START:0,FIELD:1,VALUE_START:2,VALUE:3},ti=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},ni=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ri=/^text\/event-stream?(\s*charset=utf-8)?$/i,oi=function(){function e(e){var t=e.RequestClass,n=e.dispatchEvent,r=e.headers,o=e.lastEventId,i=void 0===o?"":o,s=e.onError,a=e.onMessage,u=e.onOpen,c=e.onReadyStateChange,l=e.url,d=e.withCredentials;this.RequestClass=t,this.dispatchEvent=n,this.headers=r,this.lastEventId=i,this.onError=s,this.onMessage=a,this.onOpen=u,this.onReadyStateChange=c,this.url=l,this.withCredentials=d,this.currentState=Go.WAITING,this.parserState={dataBuffer:"",eventTypeBuffer:"",fieldStart:0,lastEventIdBuffer:i,state:ei.FIELD_START,textBuffer:"",valueStart:0},this.request=void 0}return e.prototype.start=function(){return ti(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,a,u,c,l=this;return ni(this,(function(d){switch(d.label){case 0:if(this.onReadyStateChange(Go.CONNECTING),this.currentState=Go.CONNECTING,t=(e=this).url,n=e.withCredentials,"data:"!==t.slice(0,5)&&"blob:"!==t.slice(0,5)&&(t+=-1===t.indexOf("?")?"?":"&",t+="lastEventId="+encodeURIComponent(this.lastEventId)),(r={}).Accept="text/event-stream",this.headers)for(o=0,i=Object.entries(this.headers);o<i.length;o++)s=i[o],a=s[0],u=s[1],r[a]=u;d.label=1;case 1:return d.trys.push([1,3,,4]),this.request=new this.RequestClass({headers:r,onProgress:function(e){return l.onProgress(e)},onStart:function(e){return l.onStart(e)},url:t,withCredentials:n}),[4,this.request.fetch()];case 2:throw d.sent(),new Error("Connection closed by server");case 3:return c=d.sent(),this.request.isAborted?[2]:(this.close(),this.onFinish(c),[3,4]);case 4:return[2]}}))}))},e.prototype.onStart=function(e){var t=e.contentType,n=e.headers,r=e.status,o=e.statusText;if(this.currentState===Go.CONNECTING)if(200===r&&t&&ri.test(t)){this.currentState=Go.OPEN,this.onReadyStateChange(Go.OPEN);var i=new Yo("open",{headers:n,status:r,statusText:o});this.dispatchEvent(i),this.onOpen(i)}else{var s="";200!==r?(o&&(o=o.replace(/\s+/g," ")),s="EventSource's response has a status "+r+" "+o+" that is not 200. Aborting the connection."):s="EventSource's response has a Content-Type specifying an unsupported type: "+(t?"-":t.replace(/\s+/g," "))+". Aborting the connection.";var a=new Yo("error",{headers:n,message:s,status:r,statusText:o});this.close(),this.dispatchEvent(a),this.onError(a)}},e.prototype.onProgress=function(e){if(this.currentState===Go.OPEN){for(var t=this.parserState,n=t.dataBuffer,r=t.eventTypeBuffer,o=t.fieldStart,i=t.lastEventIdBuffer,s=t.state,a=t.textBuffer,u=t.valueStart,c=-1,l=0;l<e.length;l+=1){(p=e.charCodeAt(l))!==Wo["\n"]&&p!==Wo["\r"]||(c=l)}var d=(-1!==c?a:"")+e.slice(0,c+1);a=(-1===c?a:"")+e.slice(c+1);for(var h=0;h<d.length;h+=1){var p=d.charCodeAt(h);if(s!==ei.AFTER_CR||p!==Wo["\n"])if(s===ei.AFTER_CR&&(s=ei.FIELD_START),p===Wo["\n"]||p===Wo["\r"]){if(s!==ei.FIELD_START){s===ei.FIELD&&(u=h+1);var f=d.slice(o,u-1),v=u<h&&d.charCodeAt(u)===Wo[" "]?1:0,y=d.slice(u+v,h);"data"===f?(n+="\n",n+=y):"id"===f?i=y:"event"===f&&(r=y)}if(s===ei.FIELD_START){if(""!==n){this.lastEventId=i,""===r&&(r="message");var g=new Zo(r,{data:n.slice(1),lastEventId:i});if(this.dispatchEvent(g),"message"===r&&this.onMessage(g),this.currentState===Go.CLOSED)return}n="",r=""}s=p===Wo["\r"]?ei.AFTER_CR:ei.FIELD_START}else s===ei.FIELD_START&&(o=h,s=ei.FIELD),s===ei.FIELD?p===Wo[":"]&&(u=h+1,s=ei.VALUE_START):s===ei.VALUE_START&&(s=ei.VALUE);else s=ei.FIELD_START}this.parserState={dataBuffer:n,eventTypeBuffer:r,fieldStart:o,lastEventIdBuffer:i,state:s,textBuffer:a,valueStart:u}}},e.prototype.onFinish=function(e){var t=new Xo("error");e&&(t.message=e.message,t.stack=e.stack),this.dispatchEvent(t),this.onError(t)},e.prototype.close=function(){return ti(this,void 0,void 0,(function(){return ni(this,(function(e){switch(e.label){case 0:return this.currentState=Go.CLOSED,this.onReadyStateChange(Go.CLOSED),!this.request||this.request.isAborted?[3,2]:[4,this.request.abort()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e}(),ii=global.TextDecoder;function si(e,t,n){if(1===n)return e>=128>>t&&e<<t<=2047;if(2===n)return e>=2048>>t&&e<<t<=55295||e>=57344>>t&&e<<t<=65535;if(3===n)return e>=65536>>t&&e<<t<=1114111;throw new Error("Invalid octetsCount")}function ai(e,t){if(6===e)return t>>6>15?3:t>31?2:1;if(12===e)return t>15?3:2;if(18===e)return 3;throw new Error}var ui=function(){function e(){this.bitsNeeded=0,this.codePoint=0}return e.prototype.decode=function(e){for(var t="",n=this.bitsNeeded,r=this.codePoint,o=0;o<e.length;o+=1){var i=e[o];0!==n&&(i<128||i>191||!si(r<<6|63&i,n-6,ai(n,r)))&&(n=0,r=65533,t+=String.fromCharCode(r)),0===n?(i>=0&&i<=127?(n=0,r=i):i>=192&&i<=223?(n=6,r=31&i):i>=224&&i<=239?(n=12,r=15&i):i>=240&&i<=247?(n=18,r=7&i):(n=0,r=65533),0===n||si(r,n,ai(n,r))||(n=0,r=65533)):(n-=6,r=r<<6|63&i),0===n&&(r<=65535?t+=String.fromCharCode(r):(t+=String.fromCharCode(55296+(r-65535-1>>10)),t+=String.fromCharCode(56320+(r-65535-1&1023))))}return this.bitsNeeded=n,this.codePoint=r,t},e}(),ci=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},li=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},di=!1,hi=!!di&&di.includes("Trident/"),pi=!!di&&/\/([0-9]|1[0-2])[.\d]* Mobile\/[0-9A-F]* Safari/.test(di),fi=!(hi||pi||!global.fetch||!global.Headers||!global.Response||!global.AbortController),vi=function(){if(!ii||"undefined"==typeof TextEncoder)return!1;try{return"test"===(new ii).decode((new TextEncoder).encode("test"),{stream:!0})}catch(e){}return!1}()?ii:ui,yi=global.fetch,gi=function(){function e(e){this._headers=e}return e.prototype.get=function(e){return this._headers.get(e)},e}(),mi=function(){function e(e){var t=e.headers,n=e.onProgress,r=e.onStart,o=e.url,i=e.withCredentials;this.controller=new AbortController,this.headers=new Headers(t),this.isAborted=!1,this.onProgress=n,this.onStart=r,this.response=null,this.textDecoder=new vi,this.url=o,this.withCredentials=i,this._reader=null,this._stream=null}return e.prototype.fetch=function(){return ci(this,void 0,void 0,(function(){var e,t;return li(this,(function(n){switch(n.label){case 0:return this.isAborted?[2]:(t=this,[4,yi(this.url,{headers:this.headers,credentials:this.withCredentials?"include":"same-origin",signal:this.controller.signal,cache:"no-store"})]);case 1:return(e=t.response=n.sent()).body.on?(this._emitStart(),[4,this._streamBody()]):[3,3];case 2:return n.sent(),[3,6];case 3:return"getReader"in e.body?(this._emitStart(),[4,this._readBody()]):[3,5];case 4:return n.sent(),[3,6];case 5:throw new Error("Cannot read from response.body, lacks 'getReader' or 'on' property");case 6:return[2]}}))}))},e.prototype._emitStart=function(){var e=this.response,t=e.headers,n=e.status,r=e.statusText;this.onStart({contentType:t.get("Content-Type"),headers:new gi(t),status:n,statusText:r})},e.prototype._streamBody=function(){return ci(this,void 0,void 0,(function(){var e=this;return li(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=!1,o=function(){r||(r=!0,t())};e._stream=e.response.body.on("data",(function(t){var n=t.toString("utf8");e.onProgress(n)})).on("close",o).on("end",o).on("error",(function(e){return n(e)}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype._readBody=function(){return ci(this,void 0,void 0,(function(){var e,t,n;return li(this,(function(r){switch(r.label){case 0:this._reader=this.response.body.getReader(),e=!1,r.label=1;case 1:return e||this.isAborted?[3,3]:[4,this._reader.read()];case 2:return(t=r.sent()).done?e=!0:(n=this.textDecoder.decode(t.value,{stream:!0}),this.onProgress(n)),[3,1];case 3:return[2]}}))}))},e.prototype.abort=function(){return ci(this,void 0,void 0,(function(){return li(this,(function(e){switch(e.label){case 0:if(this.isAborted)return[2];if(this.isAborted=!0,!this._reader)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._reader.cancel()];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:this._reader=null,e.label=5;case 5:return this._stream&&(this._stream.destroy(),this._stream=null),this.controller.abort(),[2]}}))}))},e}();function _i(e){return e.replace(/[A-Z]/g,(function(e){return String.fromCharCode(e.charCodeAt(0)+32)}))}var bi=function(){function e(e){for(var t=Object.create(null),n=e.split("\r\n"),r=0;r<n.length;r+=1){var o=n[r].split(": "),i=o.shift(),s=o.join(": ");t[_i(i)]=s}this._map=t}return e.prototype.get=function(e){return this._map[_i(e)]},e}(),wi=function(){},Ii=function(){function e(e){this.withCredentials=!1,this.responseType="",this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=wi,this.onreadystatechange=wi,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=wi}return e.prototype.open=function(e,t){this._abort(!0);var n=this,r=this._xhr,o=1,i=0;this._abort=function(e){0!==n._sendTimeout&&(clearTimeout(n._sendTimeout),n._sendTimeout=0),1!==o&&2!==o&&3!==o||(o=4,r.onload=wi,r.onerror=wi,r.onabort=wi,r.onprogress=wi,r.onreadystatechange=wi,r.abort(),0!==i&&(clearTimeout(i),i=0),e||(n.readyState=4,n.onreadystatechange())),o=0};var s=function(){if(1===o){var e="",t=void 0,i=0;if("contentType"in r)i=200,e="OK",t=r.contentType;else try{i=r.status,e=r.statusText,t=r.getResponseHeader("Content-Type")}catch(n){i=0,e="",t=void 0}0!==i&&(o=2,n.readyState=2,n.status=i,n.statusText=e,n._contentType=t,n.onreadystatechange())}},a=function(){if(s(),2===o||3===o){o=3;var e="";try{e=r.responseText}catch(e){}n.readyState=3,n.responseText=e,n.onprogress()}},u=function(){a(),1!==o&&2!==o&&3!==o||(o=4,0!==i&&(clearTimeout(i),i=0),n.readyState=4,n.onreadystatechange())},c=function(){i=setTimeout((function(){c()}),500),3===r.readyState&&a()};r.onload=u,r.onerror=u,r.onabort=u,"sendAsBinary"in XMLHttpRequest.prototype||"mozAnon"in XMLHttpRequest.prototype||(r.onprogress=a),r.onreadystatechange=function(){r&&(4===r.readyState?u():3===r.readyState?a():2===r.readyState&&s())},"contentType"in r&&(t+=(-1===t.indexOf("?")?"?":"&")+"padding=true"),r.open(e,t,!0),"readyState"in r&&(i=setTimeout((function(){c()}),0))},e.prototype.abort=function(){this._abort(!1)},e.prototype.getResponseHeader=function(e){return this._contentType},e.prototype.setRequestHeader=function(e,t){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(e,t)},e.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders?this._xhr.getAllResponseHeaders():""},e.prototype.send=function(){if(!("ontimeout"in XMLHttpRequest.prototype)&&document&&document.readyState&&"complete"!==document.readyState){var e=this;e._sendTimeout=setTimeout((function(){e._sendTimeout=0,e.send()}),4)}else{var t=this._xhr;t.withCredentials=this.withCredentials,t.responseType=this.responseType;try{t.send(void 0)}catch(e){throw e}}},e}(),Oi=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ti=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ei=function(){function e(e){var t=e.headers,n=e.onProgress,r=e.onStart,o=e.url,i=e.withCredentials;this.headers=t,this.isAborted=!1,this.offset=0,this.onProgress=n,this.onStart=r,this.url=o,this.withCredentials=i,this.xhr=new Ii(new XMLHttpRequest)}return e.prototype.fetch=function(){return Oi(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,a=this;return Ti(this,(function(u){switch(u.label){case 0:if(this.isAborted)return[2];for(t=new Promise((function(t){e=t})),this.xhr.open("GET",this.url),this.xhr.onprogress=function(){var e=a.xhr.responseText.slice(a.offset);a.offset+=e.length,a.onProgress(e)},this.xhr.onreadystatechange=function(){if(a.xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){var t=a.xhr.getResponseHeader("Content-Type"),n=a.xhr.getAllResponseHeaders();a.onStart({contentType:t,headers:new bi(n),status:a.xhr.status,statusText:a.xhr.statusText})}else a.xhr.readyState===XMLHttpRequest.DONE&&e()},this.xhr.withCredentials=this.withCredentials,this.xhr.responseType="text",n=0,r=Object.entries(this.headers);n<r.length;n++)o=r[n],i=o[0],s=o[1],this.xhr.setRequestHeader(i,s);return this.xhr.send(),[4,t];case 1:return u.sent(),[2]}}))}))},e.prototype.abort=function(){return Oi(this,void 0,void 0,(function(){return Ti(this,(function(e){return this.isAborted||(this.isAborted=!0,this.xhr.abort()),[2]}))}))},e}(),Ai=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ci=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ri=function(){function e(e,t){var n=this,r=void 0===t?{}:t,o=r.RequestClass,i=r.headers,s=r.lastEventId,a=r.withCredentials;this.CLOSED=Go.CLOSED,this.CONNECTING=Go.CONNECTING,this.OPEN=Go.OPEN,this.FetchRequest=mi,this.XHRRequest=Ei,this.isFetchSupported=fi,this._events=new v.a,this.onerror=void 0,this.onmessage=void 0,this.onopen=void 0,this.readyState=Go.WAITING,this.url=e=String(e),this.withCredentials=a,o||(o=fi?mi:Ei),this._esRequest=new oi({RequestClass:o,dispatchEvent:function(e){return n.dispatchEvent(e)},headers:i,lastEventId:s,onError:function(e){return n.onerror&&n.onerror(e)},onMessage:function(e){return n.onmessage&&n.onmessage(e)},onOpen:function(e){return n.onopen&&n.onopen(e)},onReadyStateChange:function(e){n.readyState=e},url:e,withCredentials:a})}return e.prototype.addEventListener=function(e,t){this._events.on(e,t)},e.prototype.removeEventListener=function(e,t){this._events.removeListener(e,t)},e.prototype.dispatchEvent=function(e){e&&e.type&&this._events.emit(e.type,e)},e.prototype.start=function(){return Ai(this,void 0,void 0,(function(){return Ci(this,(function(e){switch(e.label){case 0:return this.readyState!==Go.WAITING?[2]:[4,this._esRequest.start()];case 1:return e.sent(),[2]}}))}))},e.prototype.close=function(){this.readyState!==Go.CLOSED&&(this._esRequest.close(),this._esRequest.onFinish(new Error("Connection closed by caller")))},e.CLOSED=Go.CLOSED,e.CONNECTING=Go.CONNECTING,e.OPEN=Go.OPEN,e.FetchRequest=mi,e.XHRRequest=Ei,e.isFetchSupported=fi,e}(),Pi=(global.EventSource,Ri),Si=new bo(["ONLINE","OFFLINE","CONNECTING","UNREACHABLE"]),ji=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mi=function(e){function t(t){var n=t.config,r=t.httpClient,o=t.logger,i=e.call(this)||this;return i.config=n,i.httpClient=r,i.logger=o,i}return ji(t,e),t.prototype.createEventSource=function(e,t){var n=this,r=t.auth,o=void 0===r?this.httpClient.getAuth():r,i=t.features,s=t.onOpen,a=t.onMessage,u=t.onError,c=/https?:/.test(e)?e:this.config.baseUrl+e,l=this.httpClient.getAuthHeaders(o,i);"TT-Route-Xmpp"===this.config.ttRoute&&(l["TT-Route-Xmpp"]="true"),i&&(l["TT-X-Features"]=i);var d=new Pi(c,{headers:l}),h=!1,p=!1,f=!1,v=function(){f||(f=!0,d.removeEventListener("open",v),s&&s())},y=function(t){if(!h){h=!0,d.removeEventListener("error",y);var r,o=t?t.status:void 0;if(401===o)r=new B,n.emit("auth:invalid");else if(403===o){r=new z(e,"403","get"),n.emit("auth:invalid")}else t&&t.message&&t.stack?(r=new Error(t.message)).stack=t.stack:r=p?new Error("EventSource connection closed"+(o?": status "+o:"")):new Error("Could not establish EventSource connection"+(o?": status "+o:""));o&&(r.status=o),n.httpClient.networkStatus!==Si.OFFLINE&&n.httpClient._setNetworkStatus(Si.UNREACHABLE),u&&u(r)}};return d.addEventListener("open",v),d.addEventListener("error",y),d.addEventListener("message",(function(e){var t=!p;p||(p=!0,n.httpClient._setNetworkStatus(Si.ONLINE)),a&&a(e,{isFirstMessage:t})})),d},t}(v.a),zi=n(1),ki=n(27),Ni=n.n(ki),xi=n(21),Ui=n.n(xi),Li=n(22);function qi(e){return function(e){for(var t=new Uint8Array(e),n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return n}(function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}(e))}for(var Di={},Bi={},Fi=0,Gi=[{ext:"csv",mime:"text/csv"},{ext:"csv",mime:"text/plain"},{ext:"doc",mime:"application/msword"},{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{ext:"gif",mime:"image/gif"},{ext:"gz",mime:"application/gzip"},{ext:"gz",mime:"application/x-gzip"},{ext:"gz",mime:"application/x-compressed"},{ext:"jpg",mime:"image/jpeg"},{ext:"jpeg",mime:"image/jpeg"},{ext:"m4a",mime:"audio/m4a"},{ext:"m4a",mime:"audio/x-m4a"},{ext:"m4a",mime:"audio/mp4"},{ext:"m4v",mime:"video/x-m4v"},{ext:"mov",mime:"video/quicktime"},{ext:"mp3",mime:"audio/mpeg"},{ext:"mp3",mime:"audio/mp3"},{ext:"mp3",mime:"audio/mpeg3"},{ext:"mp3",mime:"audio/x-mpeg"},{ext:"mp3",mime:"audio/x-mpeg-3"},{ext:"mp3",mime:"video/mpeg"},{ext:"mp3",mime:"video/x-mpeg"},{ext:"mp4",mime:"video/mp4"},{ext:"pdf",mime:"application/pdf"},{ext:"png",mime:"image/png"},{ext:"ppsx",mime:"application/vnd.openxmlformats-officedocument.presentationml.slideshow"},{ext:"ppt",mime:"application/vnd.ms-powerpoint"},{ext:"ppt",mime:"application/ms-powerpoint"},{ext:"ppt",mime:"application/mspowerpoint"},{ext:"ppt",mime:"application/powerpoint"},{ext:"ppt",mime:"application/x-mspowerpoint"},{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"},{ext:"svg",mime:"image/svg+xml"},{ext:"txt",mime:"text/plain"},{ext:"wav",mime:"audio/wav"},{ext:"wav",mime:"audio/wave"},{ext:"wav",mime:"audio/x-pn-wav"},{ext:"wav",mime:"audio/x-wav"},{ext:"xls",mime:"application/vnd.ms-excel"},{ext:"xls",mime:"application/excel"},{ext:"xls",mime:"application/x-excel"},{ext:"xls",mime:"application/x-msexcel"},{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{ext:"zip",mime:"application/zip"}];Fi<Gi.length;Fi++){var Vi=Gi[Fi],Ki=Vi.ext,Hi=Vi.mime;Di[Hi]||(Di[Hi]=[]),Di[Hi].push(Vi),Bi[Ki]||(Bi[Ki]=[]),Bi[Ki].push(Vi)}var $i=Object.keys(Di),Wi=Object.keys(Bi);function Xi(e){return Di[e]}function Qi(e){return e&&"."===e[0]&&(e=e.slice(1)),Bi[e]}var Yi=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function Ji(e){var t=e.provideDefault,r=void 0!==t&&t;return function(e){var t=e.fileBuffer,r=e.filename;var o=n(26)(t),i=r&&n(18).extname(r),s=i&&Qi(i);if(o){var a=o.ext,u=o.mime;return{ext:a="."+a,mime:u}}return s?s[0]:{ext:i||".bin",mime:"application/octet-stream"}}(Yi(e,["provideDefault"]))||(r?{ext:".bin",mime:"application/octet-stream"}:void 0)}var Zi=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},es=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function ts(e,t){var r,o,i,s=this,a=(void 0===t?{}:t).idx,u=n(19),c=n(18);return void 0!==a&&(a="-"+a),Promise.resolve().then((function(){return Zi(s,void 0,void 0,(function(){var t,n,s;return es(this,(function(l){switch(l.label){case 0:return"string"!=typeof e?[3,2]:[4,new Promise((function(t,n){u.readFile(e,(function(e,r){e?n(e):t(r)}))}))];case 1:return r=l.sent(),o=c.basename(e),s=Ji({fileBuffer:r,filename:o,provideDefault:!0}).mime,i=s,[3,3];case 2:if(!(e instanceof Buffer))throw new Error("Unsupported file attachment type");t=Ji({fileBuffer:r=e,provideDefault:!0}),n=t.ext,s=t.mime,o="attachment"+a+n,i=s,l.label=3;case 3:return[2,{fieldValue:r.toString("binary"),mimetype:i,filename:o}]}}))}))}))}for(var ns,rs,os=function(e,t){return Zi(this,void 0,void 0,(function(){var n;return es(this,(function(r){switch(r.label){case 0:return n="",[4,ts(e,t)];case 1:return n=r.sent(),[3,4];case 2:return[3,4];case 3:n=r.sent(),r.label=4;case 4:return[2,n]}}))}))},is=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},ss=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},as=["application/json","text/plain"],us=function(){function e(){this.body=new Li.RequestBody,this.fileIdx=0,this.body.setType("multipart")}return e.prototype.appendField=function(e,t){return void 0===t&&(t=""),is(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,l,d;return ss(this,(function(h){if(Array.isArray(t))for(n=0,r=0,o=t;r<o.length;r++){if(i=o[r],"data"===e&&"object"==typeof i){if(s=i.mimetype,a=void 0===s?"application/json":s,u=i.namespace,c=i.payload,l=void 0===c?"":c,!u)throw new Error("Missing namespace on data["+n+"] object");null,d={"TT-X-Namespace":u},this._appendParsedField(e,{fieldValue:String(l),mimetype:a,filename:null,headers:d})}else this.appendField(e,i);n++}else t&&t.nodeType&&t.nodeName&&t.getAttribute&&(t=t.value),"object"==typeof t?this._appendParsedField(e,{fieldValue:JSON.stringify(t),mimetype:"application/json"}):this._appendParsedField(e,{fieldValue:String(t),mimetype:"text/plain"});return[2]}))}))},e.prototype._appendParsedField=function(e,t){var n=t.fieldValue,r=t.filename,o=t.headers,i=t.mimetype,s=this.body.fields;r?r=qi(r):n=qi(n),as.includes(i)&&(i+='; charset="utf-8"');var a=new Li.RequestField(n,i,r,o);s.hasOwnProperty(e)?(Array.isArray(s[e])||(s[e]=[s[e]]),s[e].push(a)):s[e]=a},e.prototype.appendFile=function(e,t){return is(this,void 0,void 0,(function(){var n;return ss(this,(function(r){switch(r.label){case 0:return n="",t?[4,os(t,{idx:this.fileIdx++})]:[3,2];case 1:n=r.sent(),r.label=2;case 2:return this._appendParsedField(e,n),[2]}}))}))},e.prototype.getContentType=function(){return this.body.getContentType()},e.prototype.getPayload=function(){return is(this,void 0,void 0,(function(){return ss(this,(function(e){return[2,this.body.toString()]}))}))},e}(),cs=function(){return(cs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ls=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},ds=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},hs=[z.CODE,B.CODE],ps=function(){function e(e){var t=e.config,n=e.logger;this.downloadFileBlobAndUrl=function(){return U.raise()},this.config=t,this.logger=n,this._prefixBaseUrl=Ui()(this.config.baseUrl),this._watchNetworkConnection()}return e.prototype.mounted=function(){this._prefixBaseUrl=Ui()(this.config.baseUrl)},e.prototype._contentType=function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}},e.prototype.getAuth=function(e){return this._auth},e.prototype.setAuth=function(e){this._auth=e},e.prototype.removeAuth=function(){this._auth=null},Object.defineProperty(e.prototype,"isSignedIn",{get:function(){return!!this._auth},enumerable:!1,configurable:!0}),e.prototype.getAuthForKeyAndSecret=function(e,t){return e&&t?qr()(e+":"+t):null},e.prototype.getAuthHeaders=function(e){if(void 0===e&&(e=this._auth),!e)return{};var t={};if(e.key&&e.secret)t.Authorization="Basic "+this.getAuthForKeyAndSecret(e.key,e.secret);else{if(!e.bearerToken||!e.udid)return{};t.Authorization="Bearer "+e.bearerToken,t["X-Device-ID"]=e.udid}return t},e.prototype.isUnauthorizedError=function(e){return e&&hs.includes(e.code)},e.prototype.downloadFileBlob=function(e,t){(void 0===t?{}:t).headers;U.raise()},e.prototype.downloadToFile=function(e,t){var r=this,o=n(19);return new Promise((function(i,s){var a=r.config.baseUrl+e;n(53)({url:a,headers:r.getAuthHeaders()},(function(e,t){e||t&&t.statusCode<200||t.statusCode>299?s(new Error("Failed downloading "+a+". Error: "+e.message+" | Status: "+(t?t.statusCode:null))):i()})).pipe(o.createWriteStream(t))}))},e.prototype._watchNetworkConnection=function(){this.networkStatus=Si.ONLINE},e.prototype._setNetworkStatus=function(e){var t=this.networkStatus;e!==t&&(this.networkStatus=e,this.emit("networkStatus:change",{networkStatus:e,previousStatus:t}))},e}(),fs=function(e){ps.prototype[e]=function(t,n){return void 0===n&&(n={}),ls(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m=this;return ds(this,(function(b){switch(b.label){case 0:if((n=_.a.defaults(n||{},{reqFormat:"json",resFormat:"json",withCredentials:!0,withHeaders:!0})).urlParams&&(t=t.replace(/:([\w-]+)/g,(function(e,t){var r=n.urlParams[t];return void 0!==r?encodeURIComponent(r):":"+t}))),this.logger&&this.logger.info("start",e.toUpperCase(),t,n),(r=cs(cs({},n.headers),"TT-Route-Xmpp"===this.config.ttRoute?{"TT-Route-Xmpp":"true"}:null)).Accept=r.Accept||this._contentType(n.resFormat),n.requestId&&(r["Request-ID"]=n.requestId),"Authorization"in r||Object.assign(r,this.getAuthHeaders(n.auth)),o=Ni.a[e](t).use(this._prefixBaseUrl).query(n.query||{}),n.withCredentials&&(o=o.withCredentials()),!1!==n.retry&&(o=o.retry(n.retryCount||3)),!1!==n.timeout&&(o=o.timeout(!0===n.timeout?1e4:n.timeout)),(s=n.files&&Object.entries(n.files))&&s.length>0?(i=new us,r["Content-Type"]=i.getContentType()):r["Content-Type"]=r["Content-Type"]||this._contentType(n.reqFormat),n.withHeaders&&(o=o.set(r)),!i)return[3,3];if(a=[],n.data)for(u=0,c=Object.entries(n.data);u<c.length;u++)l=c[u],v=l[0],d=l[1],a.push(i.appendField(v,d));for(h=0,p=s;h<p.length;h++)f=p[h],v=f[0],y=f[1],a.push(i.appendFile(v,y));return[4,Promise.all(a)];case 1:return b.sent(),[4,i.getPayload(i)];case 2:return g=b.sent(),o=o.send(g),[3,4];case 3:o=o.send(n.data),b.label=4;case 4:return[2,new Promise((function(r,i){o.end((function(o,s){var a=(s||{}).headers;if(o)if(m.logger&&m.logger.info("error",e.toUpperCase(),t,o),o.status)if(401===o.status)i(new B(a));else if(403===o.status){var u=(n.urlParams||{}).userId;i(new z(t,void 0===u?"403":u,e,_.a.get(s,"body.error.message")))}else i(o);else i(new E);else switch(n.resFormat){case"json":var c=s.body||{};"reply"in c&&(c=c.reply);var l={data:c,headers:a,getHeader:function(e){return a[e.toLowerCase()]},status:s.status};m.logger&&m.logger.info("success",e.toUpperCase(),t,l),r(l);break;default:m.logger&&m.logger.info("success",e.toUpperCase(),t,s.text?s.text.substr(0,80)+"...":"[null]"),r(s.text)}}))}))]}}))}))}},vs=0,ys=["get","post","put","patch","del"];vs<ys.length;vs++){fs(ys[vs])}ns=ps.prototype.get,rs=Object(zi.decorator)(ns),ps.prototype.get=function(e,t){return void 0===t&&(t={}),t.reusePromise?rs.call(this,e,t):ns.call(this,e,t)},Object.assign(ps.prototype,v.a.prototype);var gs=ps,ms=n(6),_s=n.n(ms);function bs(e){if(!e)return e;var t=e.split("T")[0];if(t.includes("-")){var n=t.split("-"),r=n[0];return[n[1],n[2],r].join("/")}if(t.includes("/")){var o=t.split("/");return[o[0],o[1],r=o[2]].join("/")}return e}function ws(e){if(!e||!parseInt(e))return"";var t=parseInt(e),n=Math.floor(t/86400),r=t%86400,o=new Date(0);o.setSeconds(r);var i=o.toISOString().substr(11,8).split(":").map((function(e){return parseInt(e)})),s=i[0],a=i[1],u=i[2]+" sec";return(a||s||n)&&(u=a+" min "+u),(s||n)&&(u=s+24*n+" hr "+u),u}var Is=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Os=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function Ts(e){var t=e.attachmentContentType,r=e.blob,o=e.fileName;return Is(this,void 0,void 0,(function(){var e,i,s,a;return Os(this,(function(u){switch(u.label){case 0:return[3,4];case 1:return i=u.sent(),s=function(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),o=0;o<n;o++){var i=t.charCodeAt(o);r[o]=i}return r}(i),As(o,s,t),[3,3];case 2:e?(a=window.URL.createObjectURL(r),window.open(a,"_blank")):(0,n(54).saveAs)(r,o),u.label=3;case 3:return[3,5];case 4:U.raise(),u.label=5;case 5:return[2]}}))}))}function Es(e){return new Promise((function(t,n){var r=new FileReader;r.addEventListener("load",(function(){t(r.result)}),!1),r.addEventListener("error",(function(e){n(e)}),!1),r.readAsDataURL(e)}))}function As(e,t,n){var r=new FileReader,o=new Blob([t],{type:n});r.fileName=e,r.onload=function(e){window.open(r.result,"_blank")},r.readAsDataURL(o)}var Cs=function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return n&&n.configurable},Rs=function(e){return void 0!==e?JSON.parse(JSON.stringify(e)):null};function Ps(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])}var Ss=n(17),js=n.n(Ss),Ms=Object.prototype.hasOwnProperty,zs=Symbol("NOT_PROVIDED"),ks=function(){function e(e){this.cmp=e}return e.prototype.add=function(e,t){var n=js.a.gt(e,t,this.cmp);-1!==n?e.splice(n,0,t):e.push(t)},e.prototype.indexOf=function(e,t,n){var r=n&&Ms.call(n,"previousValue")?n.previousValue:zs,o=e.length;if(r===zs||0===this.cmp(t,r)){if(-1!==(i=-1===(i=js.a.gt(e,t,this.cmp))?o-1:i-1)){for(;i>0&&0===this.cmp(e[i-1],t);)i--;for(;i<o&&0===this.cmp(e[i],t);){if(e[i]===t)return i;i++}}}else for(var i=0;i<o;){if(e[i]===t)return i;i++}return-1},e.prototype.remove=function(e,t,n){var r=this.indexOf(e,t,n);return-1!==r&&(e.splice(r,1),!0)},e.prototype.removeAll=function(e,t,n){var r=n&&Ms.call(n,"previousValue")?n.previousValue:zs,o=this.indexOf(e,t,n),i=!1;if(-1!==o)for(var s=r===zs||0===this.cmp(t,r);o<e.length&&(!s||0===this.cmp(e[o],t));)e[o]===t?(e.splice(o,1),i=!0):o++;return i},e.prototype.update=function(e,t,n){var r=n&&Ms.call(n,"previousValue")?n.previousValue:zs,o=r===zs||0===this.cmp(t,r),i=this.indexOf(e,t,n);if(-1!==i){if(o)return!1;e.splice(i,1)}return-1!==(i=js.a.gt(e,t,this.cmp))?e.splice(i,0,t):e.push(t),!0},e}();Ns=encodeURIComponent;var Ns,xs={isNotEmpty:function(e,t){return!!t},notEmpty:function(e,t,n){xs.isNotEmpty(e,t)||(n||(n="expected "+e+" to be provided"),xs.raise(e,void 0,n))},isOneOf:function(e,t,n){return n.includes(t)},oneOf:function(e,t,n,r){xs.isOneOf(e,t,n)||(r||(r="expected "+t+" to be one of ("+n.join(", ")+")"),xs.raise(e,void 0,r))},raise:function(e,t,n){throw void 0===t&&(t="invalid"),new q(e,t,n)}},Us=xs;function Ls(){return qs(this)}function qs(e){return Array.isArray(e)?e:null!=e?[e]:[]}var Ds=function(){function e(e,t){this._resolveModelId=function(e){return"string"==typeof e?e:e&&(e.serverId||e.id)||null},Object.assign(this,t),this.host=e,this.config=e.config,this.httpClient=e.httpClient}return e.prototype._resolveModelIdWithTypes=function(e,t){if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return Us.oneOf("thing",e.$entityType,qs(t)),e.serverId||e.id||null},e.prototype._resolveEntity=function(e,t){t=t?qs(t):this.host.allModelEntityTypes,"object"==typeof e&&(e.$entityType&&(Us.oneOf("thing",e.$entityType,t),t=[e.$entityType]),e=e.id);for(var n=0,r=t;n<r.length;n++){var o=r[n],i=this.host.modelsByEntityType[o].get(e);if(i)return i}return null},e.prototype.mounted=function(){},e.prototype.dispose=function(){},e}(),Bs=Ds;Object.assign(Ds.prototype,v.a.prototype);var Fs,Gs,Vs=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ks=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Hs=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},$s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vs(t,e),t.prototype.start=function(e){var t=e.organizationId,n=e.recipients,r=e.payload,o=e.context;return Ks(this,void 0,void 0,(function(){var e,i,s,a,u,c,l,d,h,p,f,v,y,g,m,_,b,w;return Hs(this,(function(I){switch(I.label){case 0:if(!t)throw new q("organizationId","required");if(!n)throw new q("recipients","required");if(!r)throw new q("payload","required");if(!n.length)throw new q("recipients array","required");if(e=r.callId,i=r.callerId,s=r.date,a=r.groupId,u=r.identity,c=r.isVideo,l=r.name,d=r.networkType,h=r.orgId,p=r.participantsTokens,f=r.recipientToken,v=r.roleTokens,!e)throw new q("payload.callId","required");if(!i)throw new q("payload.callerId","required");if(!s)throw new q("payload.date","required");if(!a)throw new q("payload.groupId","required");if(!u)throw new q("payload.identity","required");if(void 0===c)throw new q("payload.isVideo","required");if(!l)throw new q("payload.name","required");if(!d)throw new q("payload.networkType","required");if(!h)throw new q("payload.orgId","required");if(!p)throw new q("payload.participantsTokens","required");if(!f)throw new q("payload.recipientToken","required");if(!v)throw new q("payload.roleTokens","required");return[4,this.host.api.calls.start({organization:t,recipients:n,payload:Ae.underscoreObject(r),context:o||{}})];case 1:return y=I.sent(),g=y.accessToken,m=y.roomName,_=y.disabledParticipants,b=void 0===_?{}:_,w={},m?(w=this.host.models.Call.inject({id:m,payload:r,accessToken:g,roomName:m}),"patient"===d&&Object.keys(b).length?[4,this.host.api.calls.state(m,h,{callId:e,payload:{callState:"disabled_participants",disabledParticipants:b}})]:[3,3]):[3,3];case 2:I.sent(),I.label=3;case 3:return[2,w]}}))}))},t.prototype.decline=function(e,t){var n=t.payload;return Ks(this,void 0,void 0,(function(){var t,r,o,i,s;return Hs(this,(function(a){switch(a.label){case 0:if(t=this._resolveModelId(e),r=this._resolveEntity(t,"call"),o=r.callId,i=r.organizationId,s=r.id,!i)throw new q("organizationId","required");if(!n)throw new q("payload","required");if(!s)throw new q("roomName","required");if(!o)throw new q("callId","required");return[4,this.host.api.calls.decline(s,i,{callId:o,payload:n})];case 1:return a.sent(),[2]}}))}))},t.prototype.end=function(e,t){var n=t.payload,r=t.reason;return Ks(this,void 0,void 0,(function(){var t,o,i,s,a;return Hs(this,(function(u){switch(u.label){case 0:if(t=this._resolveModelId(e),o=this._resolveEntity(t,"call"),i=o.callId,s=o.organizationId,a=o.id,!s)throw new q("organizationId","required");if(!n)throw new q("payload","required");if(!r)throw new q("reason","required");if(!a)throw new q("roomName","required");if(!i)throw new q("callId","required");return[4,this.host.api.calls.end(a,s,{callId:i,payload:n,reason:r})];case 1:return u.sent(),[2]}}))}))},t.prototype.join=function(e){return Ks(this,void 0,void 0,(function(){var t,n,r,o,i;return Hs(this,(function(s){switch(s.label){case 0:if(t=this._resolveModelId(e),n=this._resolveEntity(t,"call"),r=n.organizationId,o=n.id,!r)throw new q("organizationId","required");if(!o)throw new q("roomName","required");return[4,this.host.api.calls.join(o,r)];case 1:return i=s.sent(),[2,Ae.camelizeObject(i)]}}))}))},t.prototype.answer=function(e,t){var n=t.payload;return Ks(this,void 0,void 0,(function(){var t,r,o,i,s,a;return Hs(this,(function(u){switch(u.label){case 0:if(t=this._resolveModelId(e),r=this._resolveEntity(t,"call"),o=r.callId,i=r.organizationId,!(s=r.id))throw new q("roomName","required");if(!i)throw new q("organizationId","required");if(!n)throw new q("payload","required");if(!o)throw new q("callId","required");return[4,this.host.api.calls.answer(s,i,{payload:n,callId:o})];case 1:return a=u.sent(),[2,Ae.camelizeObject(a)]}}))}))},t.prototype.invite=function(e,t){var n=t.currentUserId,r=t.payload,o=t.recipients;return Ks(this,void 0,void 0,(function(){var t,i,s,a,u;return Hs(this,(function(c){switch(c.label){case 0:if(t=this._resolveModelId(e),i=this._resolveEntity(t,"call"),s=i.callId,a=i.organizationId,u=i.id,!a)throw new q("organizationId","required");if(!u)throw new q("roomName","required");if(!r)throw new q("payload","required");if(!o)throw new q("recipients","required");if(!s)throw new q("callId","required");if(!n)throw new q("currentUserId","required");return[4,this.host.api.calls.invite(u,a,{callId:s,payload:r,recipients:o})];case 1:return c.sent(),[4,this.host.api.calls.state(u,a,{callId:s,payload:{callState:"participants_updated",inviteInitiator:n,newParticipants:o,roleTokens:{}}})];case 2:return c.sent(),[2]}}))}))},t.prototype.log=function(e){var t=e.network,n=e.organizationId,r=e.page;return Ks(this,void 0,void 0,(function(){var e,o,i,s=this;return Hs(this,(function(a){switch(a.label){case 0:if(!n)throw new q("organizationId","required");if(!t)throw new q("network","required");return[4,this.host.api.calls.log({network:t,organizationId:n,page:r})];case 1:return e=a.sent(),o=e.metadata,i=e.results,[2,{metadata:o,results:i.map((function(e){return s.host.models.CallLogEntry.inject(e)}))}]}}))}))},t.prototype.reactToVoipSSE=function(e){var t=e.data,n=e.type;if(t=Rs(t),"provider"!==_s()(t,"payload.network_type")||!1!==this.config.allowProviderCalling){var r=n.split(":")[1],o=this.host.models.Call.inject(Object.assign(t,{callStatus:r}));this.emit(r,o)}},t}(Bs),Ws=n(8),Xs=n.n(Ws),Qs=n(28),Ys=n.n(Qs),Js=n(7),Zs=n.n(Js),ea=n(2),ta=n.n(ea),na=n(16),ra=n.n(na),oa=n(5),ia=n.n(oa),sa=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),aa=function(){return(aa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ua=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ca=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},la=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},da=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},ha=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},pa=new Br.a.MD5,fa=[zo.ESCALATION_EXECUTION_CHANGE,zo.GROUP_MEMBERSHIP_CHANGE],va=So.toServer(So.DELIVERED),ya=((Fs={})[To.ACKNOWLEDGED]="Acknowledged",Fs[To.CANCELLED]="Cancelled",Fs[To.INITIATED]="Initiated",Fs[To.MEMBER_ADDED]="Added",Fs[To.NO_RESPONSE]="ended with No Response",Fs),ga=[Ao.GROUP,Ao.FORUM,Ao.ROLE_ASSIGNMENT,Ao.ROLE_P2P],ma={ADD:"added",JOIN:"joined",LEAVE:"left",REMOVE:"removed",DENY:"declined"},_a={ADD:"to",REMOVE:"from",DENY:"to join"},ba=((Gs={})[Ao.ACTIVATED_TEAM]="group",Gs[Ao.ESCALATION]="escalation",Gs[Ao.FORUM]="forum",Gs[Ao.GROUP]="group",Gs[Ao.PATIENT_CARE]="care team",Gs[Ao.ROLE_P2P]="conversation",Gs[Ao.PATIENT_MESSAGING]="group",Gs[Ao.INTRA_TEAM]="team",Gs),wa=[So.NEW,So.DELIVERED],Ia=So.toServer(So.READ),Oa={OPT_IN:"opted into",OPT_OUT:"opted out of"},Ta=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.__injectCounterParty=function(e){var n=e.conversationId,r=e.entityAttrs,o=e.entityType,i=e.groupType,s=e.hasCurrentUser,a=void 0!==s&&s,u=e.isPlaceholder,c=void 0!==u&&u,l=e.organizationId,d=r.id,h=r.metadata;if(d||(d=r.token),!o&&r.type&&(o=t.host.modelNameByEntityType(r.type)),n&&(r.conversationId=n),l&&(r.organizationId=l),"group"!==o||i||(i=t.host.groups.__extractGroupTypeFromAttrs(r)),h&&d&&l&&t.host.metadata.__injectMetadata(d,l,h),"group"===o){if(h){if(h.created_by){var p=t.__injectCreatedByEntity(h,l),f=p.role,v=void 0===f?null:f,y=p.user,g=void 0===y?null:y;(v||g)&&(r.createdByRole=v,r.createdByUser=g)}else if(r.created_by){g=t.host.models.User.injectPlaceholder({id:r.created_by});r.createdByUser=g}if(h.target_id){var m=t.__injectTargetEntity(h,l),_=m.role,b=(v=void 0===_?null:_,m.user);g=void 0===b?null:b;(v||g)&&(r.targetRole=v,r.targetUser=g)}if("role_assignment"===h.meta_type){var w=r.display_name||r.name;t.host.roles.__injectRoleAssignmentEntity(w,h,l)}}i===Ao.FORUM&&a&&(r.hasCurrentUser=!0)}else if("user"===o){var I=r.dnd_auto_forward_receiver;I&&"undefined"!==I&&t.host.models.User.injectPlaceholder({id:I})}else if("distributionList"===o)r.created_by&&t.host.injectPlaceholderModel({displayName:r.created_by_display_name,id:r.created_by},"user"),r.updated_by&&t.host.injectPlaceholderModel({displayName:r.updated_by_display_name,id:r.updated_by},"user");else if("messageTemplate"===o)r.created_by&&t.host.injectPlaceholderModel({displayName:r.created_by_display_name,id:r.created_by},"user"),r.updated_by&&t.host.injectPlaceholderModel({displayName:r.updated_by_display_name,id:r.updated_by},"user");else if("scheduledMessage"===o){if(r.event_id&&(r.scheduled_message_id=r.token,r.token=r.event_id,d=r.event_id),r.recipient)if("account"===r.recipient_type){for(var O={},T=0,E=["feature_service","is_patient_contact","patient_display_name","patient_dob","patient_gender","patient_id","patient_mrn","phone_number","relation_name"];T<E.length;T++){var A=E[T];O[A]=r[A]}O.patient_id||O.is_patient_contact||(O.patient_id=r.recipient),t.host.metadata.__injectMetadata(r.recipient,l,O),t.host.injectPlaceholderModel(aa(aa({},O),{displayName:r.recipient_display_name,id:r.recipient}),"user")}else"distribution_list"!==r.recipient_type&&"list"!==r.recipient_type||t.host.injectPlaceholderModel({id:r.recipient,name:r.recipient_display_name,totalMembers:r.total_members},"distributionList");r.sender_token&&t.host.injectPlaceholderModel({displayName:r.sender_display_name,id:r.sender_token},"user"),r.template_id&&t.host.injectPlaceholderModel({title:r.template_label,id:r.template_id},"messageTemplate"),r.updated_by&&t.host.injectPlaceholderModel({displayName:r.updated_by_display_name,id:r.updated_by},"user")}return d?c?t.host.injectPlaceholderModel(r,o):t.host.injectModel(r,o):null},t.__injectCreatedByEntity=function(e,n){var r={};if(void 0!==e.created_by_tag_id)r.role=t.host.roles.__injectRoleFromMetadata({metadata:{token:e.created_by,display_name:e.created_by_display_name,tag_color:e.created_by_tag_color,tag_id:e.created_by_tag_id,tag_name:e.created_by_tag_name},organizationId:n,replaceExisting:!1});else{var o=t.host.models.User.get(e.created_by);if(o)r.user=o;else{var i={id:e.created_by};"created_by_display_name"in e&&(i.displayName=e.created_by_display_name),r.user=t.host.models.User.injectPlaceholder(i)}}return r},t.__injectTargetEntity=function(e,n){var r={};if(void 0!==e.target_tag_id)r.role=t.host.roles.__injectRoleFromMetadata({metadata:{display_name:e.target_display_name,tag_color:e.target_tag_color,tag_id:e.target_tag_id,tag_name:e.target_tag_name,token:e.target_id},organizationId:n,replaceExisting:!1});else{var o=t.host.models.User.get(e.target_id);if(o)r.user=o;else{var i={id:e.target_id};"target_display_name"in e&&(i.displayName=e.target_display_name),r.user=t.host.models.User.injectPlaceholder(i)}}return r},t.__removeFriend=function(e){var n,r=e.attrs,o=e.entityType,i=e.id,s=e.organizationId,a=e.conversation||t.get(o,i,s),u="group"===o?t.host.models.Group.get(i):null,c=!(!u||u.groupType!==Ao.FORUM);if(n="user"===o||t.config.condensedReplays?a&&a.content.slice():a&&a.messages.slice(),c&&(r.hasCurrentUser=!1,r.members=null,t.host.models.Group.inject(r)),t.config.keepConversationsForAllForums&&c||(a&&t.__ejectConversation(a.id),u&&t.config.condensedReplays&&t.host.models.Group.eject(u)),Array.isArray(n))for(var l=0,d=n;l<d.length;l++){var h=d[l];t.host.ejectModel(h,h.$entityType)}},t._sanitizeGroupAttrs=function(e){var n=e.members;t.host.groups.__extractGroupTypeFromAttrs(e)===Ao.FORUM&&n&&0===n.length&&delete e.members},t._onSendingMessage=function(e){var n;if(n=t.config.condensedReplays?e.conversation:t.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId,{ensureEntities:{counterParty:"full",organization:"placeholder",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!0}})){var r=!1;t.host.config.condensedReplays&&e&&e.sortNumber&&(void 0===n.highestSortNumber||n.highestSortNumber<e.sortNumber)&&(n.highestSortNumber=e.sortNumber,r=!0),void 0===n.highestSortNumber&&(n.highestSortNumber=t.host.messages.__getNextSortNumber(n.organizationId),r=!0),r&&t.host.models.Conversation.inject(n),t.__addConversationCounterPartyToServerRosterIfShould(n)}},t._onSentMessage=function(e){var n=!1,r=t.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);r&&(t.host.config.condensedReplays&&(e&&e.sortNumber&&(void 0===r.highestSortNumber||r.highestSortNumber<e.sortNumber)?(r.highestSortNumber=e.sortNumber,n=!0):void 0===r.highestSortNumber&&(r.highestSortNumber=t.host.messages.__getNextSortNumber(r.organizationId),n=!0)),n&&t.host.models.Conversation.inject(r),r.emit("message",e))},t._onChangeMessage=function(e,n){n.conversation&&t.__queueReload(n.conversation)},t._onRemoveMessage=function(e,n){var r=n.conversation;if(r){if(t.config.condensedReplays){var o=r.firstExpiringUnreadMessage,i=r.id,s=r.lastMessage,a=r.timeline;if(!(r=t.getById(i)))return;var u=s===n,c=o===n,l=1===a.length&&u;(u||c)&&t.find(r.id),l&&(r.lastMessage=null)}t.__queueReload(r)}},t._onRemoveGroup=function(e,n){var r=n.conversationId?n.conversationId:t.getConversationKey("group",n.id,n.organizationId);t.__ejectConversation(r)},t._onRemoveTeam=function(e,n){var r=t.getConversationKey("team",n.id,n.organizationId);t.__ejectConversation(r)},t._onChangeGroup=function(e,n){n.conversationId&&t.host.models.Conversation.touch(n.conversationId)},t._onChangeOrganization=function(e,n){var r=n.conversations,o=t.__escalationEnabledOrganizations.indexOf(n),i=o>-1;if(i!==n.canEscalateMessages&&(i?t.__escalationEnabledOrganizations.splice(o,1):t.__escalationEnabledOrganizations.push(n),r))for(var s=0,a=r;s<a.length;s++){var u=a[s];t.__queueReload(u)}},t.__flushConversationsToReload=function(){if(!t.host.currentlyServingOfflineMessages&&t.__queuedConversationsToReload.length>0){var e=[];t.host.organizations._deferConversationChanges=!0;for(var n=0,r=t.__queuedConversationsToReload;n<r.length;n++){var o=r[n],i=o.organizationId;t.__reloadConversation(o),e.includes(i)||e.push(i)}t.host.organizations._deferConversationChanges=!1;for(var s=0,a=e;s<a.length;s++){i=a[s];var u=t.host.organizations.getById(i);u&&t.host.organizations.__reloadConversations(u)}t.__queuedConversationsToReload.length=0}},t}return sa(t,e),t.prototype.mounted=function(){this.__escalationEnabledOrganizations=[],this.__queuedConversationsToReload=[],this._convByConvHandle={},this._fetched=!1,this._roleConversationsProcessingEvent={},this._rolesFriendsEventPromise=null,this.host.on("message:sending",this._onSendingMessage),this.host.on("message:sent",this._onSentMessage),this.host.models.Group.on("afterEject",this._onRemoveGroup),this.host.models.Group.on("afterInject",this._onChangeGroup),this.host.models.Team.on("afterEject",this._onRemoveTeam),this.host.models.Message.on("afterInject",this._onChangeMessage),this.host.models.Message.on("afterEject",this._onRemoveMessage),this.host.models.Organization.on("afterInject",this._onChangeOrganization)},t.prototype.dispose=function(){this._convByConvHandle={},this._fetched=!1,this._rolesFriendsEventPromise=null,this.__escalationEnabledOrganizations=[],this.__queuedConversationsToReload=[],this.host.removeListener("message:sending",this._onSendingMessage),this.host.removeListener("message:sent",this._onSentMessage),this.host.models.Group.removeListener("afterEject",this._onRemoveGroup),this.host.models.Group.removeListener("afterInject",this._onChangeGroup),this.host.models.Team.removeListener("afterEject",this._onRemoveTeam),this.host.models.Message.removeListener("afterInject",this._onChangeMessage),this.host.models.Message.removeListener("afterEject",this._onRemoveMessage),this.host.models.Organization.removeListener("afterInject",this._onChangeOrganization)},t.prototype.clearTimeline=function(e,t){var n=(void 0===t?{}:t).emit,r=void 0===n||n,o=this._resolveEntity(e,"conversation");if(!o)throw new C(this.host.models.Conversation.name,e);e=this._resolveModelId(e),this.clearMessageStatuses(o,{emit:!1});for(var i=o.higherContinuation,s=o.lowerContinuation,a=0,u=0,c=o.timeline;u<c.length;u++){var l=c[u];l.isEphemeral||(l.inTimeline=!1,a+=1)}return o.isLive=!1,i.itemsEstimate=null,s.itemsEstimate=null,r&&this.emit("clearTimeline",e),this.config.condensedReplays?this.host.models.Conversation.inject(o):this.__reloadConversation(o,{notify:!1}),a},t.prototype.fetchTimeline=function(e,t){var n=void 0===t?{}:t,r=n.anchorPoint,o=void 0===r?Oo.CONVERSATION_END:r,i=n.continuation,s=n.fetchAllItems,a=void 0!==s&&s,u=n.markAsDelivered,c=void 0===u||u,l=n.maxItems,d=void 0===l?15:l;return ca(this,void 0,void 0,(function(){var t,n,r,s,u,l,h,p,f,v,y,g,m,_,b,w,I,O,T,E;return la(this,(function(A){switch(A.label){case 0:if(!(t=this._resolveEntity(e,"conversation")))throw new C(this.host.models.Conversation.name,e);return e=this._resolveModelId(e),this.config.condensedReplays?[4,this._fetchTimelineCR(e,{anchorPoint:o,continuation:i,conversation:t,fetchAllItems:a,markAsDelivered:c,maxItems:d})]:[3,2];case 1:return[2,A.sent()];case 2:if(o!==Oo.CONTINUATION&&t.isLive&&(!a&&t.timeline.length>=d||t.lowerContinuation&&0===t.lowerContinuation.itemsEstimate))return[2,0];if(n=t.content,r=t.timeline,s=t.firstUnreadMessage,u=n.length,l=0,h=[],p=u-d,f=u,o===Oo.CONVERSATION_END)this.clearTimeline(t,{emit:!1});else if(o===Oo.FIRST_UNREAD_ITEM){for(this.clearTimeline(t,{emit:!1}),b=-1,v=0,y=n;v<y.length&&(E=y[v],b++,f=b,s!==E);v++);f<n.length&&(f=Math.min(f+d,n.length))}else if(o===Oo.CONTINUATION)if(g=r[0]?r[0].sortNumber:1/0,m=r[r.length-1]?r[r.length-1].sortNumber:0,0===(_="LOWER"===i?g:m))f-=d;else for(b=-1,w=0,I=n;w<I.length&&(E=I[w],b++,f=b,!("HIGHER"===i&&E.sortNumber>_))&&!("LOWER"===i&&E.sortNumber>=_);w++);for(o!==Oo.CONVERSATION_END&&(o===Oo.CONTINUATION&&"HIGHER"===i?u=(p=f)+d:(f===n.length-1&&(f+=1),u=f,p=f-d)),u=Math.min(u,n.length+1),p=Math.max(p,0),h.push.apply(h,n.slice(p,u)),O=0,T=h;O<T.length;O++)(E=T[O]).inTimeline||(E.inTimeline=!0,this.host.models.Message.inject(E),l+=1);return[2,l]}}))}))},t.prototype._fetchTimelineCR=function(e,t){var n=void 0===t?{}:t,r=n.anchorPoint,o=void 0===r?Oo.CONVERSATION_END:r,i=n.continuation,s=n.conversation,a=n.fetchAllItems,u=void 0!==a&&a,c=n.markAsDelivered,l=void 0===c||c,d=n.maxItems,h=void 0===d?15:d;return ca(this,void 0,void 0,(function(){var t,n,r,a,c,d,p,f,v,y,g,m,_,b,w,I,O,T,E,A,C;return la(this,(function(R){switch(R.label){case 0:return o!==Oo.CONTINUATION&&s.isLive&&(!u&&s.timeline.length>=h||s.lowerContinuation&&0===s.lowerContinuation.itemsEstimate)?[2,0]:(o===Oo.CONVERSATION_END?this.clearTimeline(s,{emit:!1}):o===Oo.FIRST_UNREAD_ITEM&&(s.firstUnreadMessage=null,this.clearTimeline(s,{emit:!1})),[4,this.host.api.conversations.fetchTimeline(e,Oo.toServer(o),h,{continuation:i,markAsDelivered:l})]);case 1:for(t=R.sent(),n=t.direction,r=t.higher_continuation,a=t.lower_continuation,c=t.max_items,d=t.timeline,p=s.higherContinuation,f=s.lowerContinuation,v=null,c&&(h=c),y=0,g=d;y<g.length;y++)m=g[y],"tigertext:iq:bang"===(_=m.xmlns)?(b=m.bang_id||""+m.sort_number)?this.host.groups.__handleBang({data:m,eventId:b,alwaysAddToTimeline:!0}):this.logger.warn("Skipping bang with no event id"):"tigertext:iq:message"===_||"tigertext:iq:group_message"===_?(m.conversation_id||(m.conversation_id=e),(w=this._reactToMessageEventCR({data:m,injectConversation:!1}).message).inTimeline=!0,w.isOutgoing||(I={id:w.id+":"+w.counterPartyId,messageId:w.id,status:So.resolve(m.status),userId:this.host.currentUserId},this.host.models.MessageStatusPerRecipient.inject(I)),w.senderStatus=jo.SENT,O=this.host.models.Message.inject(w),v||(v=O)):this.logger.warn("Skipping timeline entry with unrecognized xmlns: "+_);return"Higher"!==n&&"Initial"!==n||(A=0===d.length||d.length<h?0:1,o===Oo.CONVERSATION_END&&(A=0),1===A&&"Initial"===n&&(T=d[d.length-1],E=s.lastMessage,o===Oo.FIRST_UNREAD_ITEM&&v&&!v.isUnread?A=0:E&&T.message_id===E.id&&(A=E.isUnread?1:0)),p={continuation:{higher_continuation:r},itemsEstimate:A}),"Lower"!==n&&"Initial"!==n||(A=0===d.length||d.length<h?0:1,f={continuation:{lower_continuation:a},itemsEstimate:A}),C=d.length,s.isLive=0===p.itemsEstimate,s.higherContinuation=p,s.lowerContinuation=f,this.host.models.Conversation.inject(s),o===Oo.CONTINUATION||void 0===s.lowestSortNumber?[3,3]:[4,this.markAsDelivered(s.id)];case 2:R.sent(),R.label=3;case 3:return[2,C]}}))}))},t.prototype.findAll=function(e){return void 0===e&&(e={}),ca(this,void 0,void 0,(function(){var t;return la(this,(function(n){switch(n.label){case 0:return e=_.a.defaults(e,{includeMutes:!0}),this.config.condensedReplays&&(e.includeMutes=!1),this._fetched?[2,this.getAll()]:[4,Promise.all([this.host.api.roster.findAll(),e.includeMutes?this.host.mute.findAll():Promise.resolve()])];case 1:return t=n.sent()[0],this.config.condensedReplays?[2,this._processFindAllCR(t)]:[2,this._processFindAll(t)]}}))}))},t.prototype.findAllForOrganization=function(e){return ca(this,void 0,void 0,(function(){var t;return la(this,(function(n){switch(n.label){case 0:if(e=this._resolveModelIdWithTypes(e,"organization"),!this.config.condensedReplays)throw new j("findAllForOrganization() may not be called if this.config.condensedReplays=false");return this._fetched?[2,this.getAllForOrganization(e)]:[4,this.host.api.roster.findAll({organizationId:e})];case 1:return t=n.sent(),[2,this._processFindAllCR(t)]}}))}))},t.prototype._processFindAllCR=function(e){for(var t=[],n=[],r={counterParty:"full",groupMembers:"full",organization:"placeholder"},o=0;o<e.length;o++){var i=(c=e[o]).entity;if(i){var s=this.host.modelNameByEntityType(i.type);"user"===s?n.push({rawConversation:c,origIndex:o}):s&&t.push({rawConversation:c,origIndex:o})}}for(var a=0,u=n;a<u.length;a++){var c=(p=u[a]).rawConversation;o=p.origIndex;p.conversation=this.__injectConversation(c,{origIndex:o})}for(var l=0,d=t;l<d.length;l++){c=(p=d[l]).rawConversation,o=p.origIndex;p.conversation=this.__injectConversation(c,{hasCurrentUser:!0,origIndex:o})}for(var h=[];t.length>0||n.length>0;){var p,f=(p=0===t.length?n.shift():0===n.length||t[0].origIndex<n[0].origIndex?t.shift():n.shift()).conversation;this.__ensureEntities(f,r),h.push(f)}return this._fetched=!0,h},t.prototype._processFindAll=function(e){for(var t=[],n=[],r=[],o=0;o<e.length;o++){var i=(g=e[o]).organization_key,s=g.type,a=da(g,["organization_key","type"]),u=this.host.modelNameByTypeNS(s);if(a.organizationId=i,"user"===(g={entityAttrs:a,entityType:u,organizationId:i,origIndex:o}).entityType)g.counterParty=this.__injectCounterParty(g),r.push(g);else if(g.entityType){if("group"===u&&(g.groupType=this.host.groups.__extractGroupTypeFromAttrs(a)),g.groupType===Ao.FORUM)delete a.members;else if(g.groupType===Ao.PATIENT_MESSAGING&&g.entityAttrs&&g.entityAttrs.metadata){var c=g.entityAttrs,l=c.avatar,d=c.metadata,h=d.patient_id,p=d.patient_contact_id;this.host.models.User.injectPlaceholder({id:p||h,avatar:l,metadata:d})}n.push(g)}}for(var f=0,v=n;f<v.length;f++){(g=v[f]).counterParty=this.__injectCounterParty(aa(aa({},g),{hasCurrentUser:!0})),t.push(g)}for(var y=[];t.length>0||r.length>0;){var g,m=(g=0===t.length?r.shift():0===r.length||t[0].origIndex<r[0].origIndex?t.shift():r.shift()).conversationId,_=g.counterParty,b=g.lastMessage,w=g.muted,I=(i=g.organizationId,u=g.entityType,g.groupType),O="group"===u&&I&&"PATIENT_MESSAGING"===I?ko.PATIENT:ko.PROVIDER;delete _.$placeholder;var T=void 0;this.host.config.condensedReplays&&b&&b.sort_number&&(T=b.sort_number);var E=this.ensureConversation(_.$entityType,_.id,i,{conversationId:m,ensureEntities:{counterParty:"full",groupMembers:"full",organization:"placeholder"},highestSortNumber:T,muted:w,network:O});E._counterPartyAddedOnServer=!0,y.push(E)}return this._fetched=!0,y},t.prototype.find=function(e,t){return void 0===t&&(t={}),ca(this,void 0,void 0,(function(){var n,r,o,i,s,a;return la(this,(function(u){switch(u.label){case 0:return t=_.a.defaultsDeep(t,{ensureEntities:{counterParty:"full",escalationExecution:"full",groupMembers:"placeholder",messageCounterParties:"full",organization:"placeholder",touchOnRelatedEntityLoad:!1}}),this.config.condensedReplays?(n=this.getById(e))&&n.$localOnly?[3,2]:[4,this.host.api.conversations.find(e)]:[3,3];case 1:if(!(r=u.sent()))throw new C(this.host.models.Conversation.name,e);if(!(n=this.__injectConversation(r)))throw new C(this.host.models.Conversation.name,e);u.label=2;case 2:return[3,6];case 3:return o=t.groupId,i=t.organizationId,s=t.includeMutes,a=o&&i?this.getConversationKey("group",o,i):e,(n=this.getById(a))?[3,5]:[4,this.findAll({includeMutes:s})];case 4:u.sent(),n=this.getById(a),u.label=5;case 5:if(!n)throw new C(this.host.models.Conversation.name,e);u.label=6;case 6:return t.ensureEntities?[4,this.__ensureEntities(n,t.ensureEntities)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[2,n]}}))}))},t.prototype.__injectConversation=function(e,t){var n,r=void 0===t?{}:t,o=r.hasCurrentUser,i=r.highestSortNumber,s=r.origIndex,a=void 0===s?this.host.models.Conversation.getAll().length:s,u=e.conversation_id,c=e.entity,l=e.first_expiring_unread_message,d=e.in_progress_escalation_count,h=e.last_message,p=e.lowest_sort_number,f=e.muted,v=e.organization_id,y=e.unread_message_count,g=e.unread_priority_message_count,m=this.getById(u);if(m)n=m.counterParty,v=m.organizationId;else{if(v||(v=e.organization_key),!f&&c&&c.muted&&(f=c.muted,delete c.muted),c&&(n=this.__injectCounterParty({conversationId:u,entityAttrs:c,entityType:c.$entityType,hasCurrentUser:o,organizationId:v})),!n)return null;delete n.$placeholder,m||(m=this.host.models.Conversation.createInstance({id:u,counterParty:n,organizationId:v,_origIndex:a}))}var _=n.id,b=n.$entityType,w=n.groupType;if("group"!==b||w!==Ao.FORUM||n.hasCurrentUser||(h=null),l?(h&&(h.message_id===l.message_id?l=h:(l.senderId=h.sender_token,l.senderOrganizationId=h.sender_organization)),m.firstExpiringUnreadMessage=this._ensureFirstExpiringUnreadMessage({rawFirstExpiringUnreadMessage:l,conversationId:u,counterParty:n})):null===l&&(m.firstExpiringUnreadMessage=null),void 0!==h){var I=h?this._ensureLastMessage({rawLastMessage:h,conversationId:u,counterParty:n}):null;if(I&&I.isEphemeral)(!(O=m.lastEphemeralMessage)||I.sortNumber>O.sortNumber)&&(m.lastEphemeralMessage=I);if(m.lastEphemeralMessage){var O=m.lastEphemeralMessage;(!I||O.sortNumber>I.sortNumber)&&(I=O)}m.lastMessage=I,void 0===i&&h&&h.sort_number&&(i=h.sort_number)}m._counterPartyAddedOnServer=!0,c&&c.metadata&&(m.metadata=c.metadata),void 0!==i&&i>m.highestSortNumber&&(m.highestSortNumber=i),void 0!==p&&0!==p&&(m.lowestSortNumber=p),void 0!==d&&(m.inProgressEscalationCount=d),void 0!==f&&(m.muted=f),m._markingAsRead&&(void 0===i||i<=m._markingAsReadSortNumber)||(void 0!==y&&(m.unreadCount=y),void 0!==g&&(m.unreadPriorityCount=g)),this.host.models.Conversation.inject(m);var T=this.getConversationKey(b,_,v);return this._convByConvHandle[T]=m,m},t.prototype.refetch=function(){return ca(this,void 0,void 0,(function(){return la(this,(function(e){return this._fetched=!1,[2,this.findAll()]}))}))},t.prototype._ensureLastMessage=function(e){var t=e.rawLastMessage,n=e.conversationId,r=e.counterParty,o=t.message_id,i=da(t,["message_id"]);if(!o)return null;var s=this.host.messages.getById(o);return s?(s.shouldEnsureRecipientStatus=!0,s.senderStatus=jo.SENT,this.host.models.Message.inject(s)):(i.senderStatus=jo.SENT,i.id=o,i.shouldEnsureRecipientStatus=!0,i.conversationId=n,i.counterParty=r,s=this.host.models.Message.injectPlaceholder(i)),s},t.prototype._ensureFirstExpiringUnreadMessage=function(e){var t=e.rawFirstExpiringUnreadMessage,n=e.conversationId,r=e.counterParty,o=t.expire_in,i=t.message_id,s=da(t,["expire_in","message_id"]);if(i){var a=this.host.messages.getById(i);return a?(a.shouldEnsureRecipientStatus=!0,a.expireIn=o,this.host.models.Message.inject(a)):(s.id=i,s.shouldEnsureRecipientStatus=!0,s.expireIn=o,s.conversationId=n,s.counterParty=r,a=this.host.models.Message.injectPlaceholder(s)),a}return null},t.prototype.markAsDelivered=function(e){return ca(this,void 0,void 0,(function(){var t,n,r;return la(this,(function(o){switch(o.label){case 0:if(!(t=this._resolveEntity(e,"conversation")))throw new C(this.host.models.Conversation.name,e);if(e=this._resolveModelId(e),!this.config.condensedReplays)return[3,5];n=t.highestSortNumber,r=t.lowestSortNumber,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.host.api.conversations.updateConversationStatus(e,va,{highestSortNumber:n,lowestSortNumber:r})];case 2:return o.sent(),t.lowestSortNumber=null,[3,4];case 3:return o.sent(),this.logger.warn("failed to mark conversation "+e+" as delivered"),[3,4];case 4:return this.host.models.Conversation.inject(t),[3,6];case 5:return[2,this.host.messages.markAsDelivered(t.messages)];case 6:return[2]}}))}))},t.prototype.markAsRead=function(e,t){return void 0===t&&(t={}),ca(this,void 0,void 0,(function(){var n,r,o;return la(this,(function(i){switch(i.label){case 0:if(!(n=this._resolveEntity(e,"conversation")))throw new C(this.host.models.Conversation.name,e);if(e=this._resolveModelId(e),!this.config.condensedReplays)return[3,5];if(r=n.highestSortNumber,o=n.unreadCount,!n._markingAsRead){if(0===o)return[2];n._markingAsRead=!0,n._markingAsReadSortNumber=r,n._markingAsReadExpiration=(new Date).getTime()+3e4,this.__reloadConversation(n)}if(t.localOnly)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.host.api.conversations.updateConversationStatus(e,Ia,{highestSortNumber:r})];case 2:return i.sent(),[3,4];case 3:return i.sent(),this.logger.warn("failed to mark conversation "+e+" as read"),[3,4];case 4:return[3,6];case 5:return[2,this.host.messages.markAsRead(n.markableAsReadMessages,t)];case 6:return[2]}}))}))},t.prototype.add=function(e,t,n){return ca(this,void 0,void 0,(function(){var r,o;return la(this,(function(i){switch(i.label){case 0:r=this.ensureConversation(e,t,n),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.host.api.roster.add(e,t,n)];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),this.logger.warn("can't add "+t+" "+e,o),[3,4];case 4:return r._counterPartyAddedOnServer=!0,[2]}}))}))},t.prototype.remove=function(e){return ca(this,void 0,void 0,(function(){var t,n,r,o;return la(this,(function(i){switch(i.label){case 0:if(e=this._resolveModelId(e),!(t=this._resolveEntity(e,"conversation")))throw new C(this.host.models.Conversation.name,e);n=t.counterPartyId,r=t.counterPartyType,o=t.organizationId,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.host.api.roster.remove(r,n,o)];case 2:return i.sent(),[3,4];case 3:return i.sent(),this.logger.warn("can't remove conversation "+e),[3,4];case 4:return[2]}}))}))},t.prototype.ensureConversation=function(e,t,n,r){void 0===r&&(r={});var o=(r=_.a.defaultsDeep(r,{ensureEntities:{counterParty:!1,organization:!1,messageCounterParties:!1,groupMembers:!1,touchOnRelatedEntityLoad:!0}})).conversationId,i=this.getConversationKey(e,t,n);if(this.config.condensedReplays&&!o){var s=this._convByConvHandle[i];s&&(o=s.id)}o||(o=i);var a=this.getById(o);if(a){this.__ensureEntities(a,r.ensureEntities);var u=!1;return this.config.condensedReplays&&void 0!==r.highestSortNumber&&(a.highestSortNumber=r.highestSortNumber,u=!0),this.config.condensedReplays&&void 0!==r.muted&&(a.muted=r.muted,u=!0),this._convByConvHandle[i]=a,u&&this.host.models.Conversation.inject(a),a}var c={id:o,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length};r.highestSortNumber&&(c.highestSortNumber=r.highestSortNumber),r.muted&&(c.muted=r.muted),r.network&&(c.network=r.network);var l=this.host.models.Group.get(t);l&&l.groupType===Ao.PATIENT_MESSAGING&&(c.network=ko.PATIENT);var d=this.host.metadata.get(t,n);if(d){var h=d.data;c.metadata=h}return a=this.host.models.Conversation.createInstance(c),this.__ensureEntities(a,r.ensureEntities),this.host.models.Conversation.inject(a),this._convByConvHandle[i]=a,a},t.prototype.__ejectConversation=function(e){var t=this.getById(e);if(t){var n=t.counterPartyType,r=t.counterPartyId,o=t.organizationId,i=this.getConversationKey(n,r,o);delete this._convByConvHandle[i],this.host.models.Conversation.eject(t),this.__queuedConversationsToReload=this.__queuedConversationsToReload.filter((function(e){return e.id!==t.id}))}return t},t.prototype.reactToMessageEvent=function(e){var t=e.data;if(this.config.condensedReplays)this.reactToMessageEventCR({data:t});else{var n=this._reactToMessageEvent({data:t}),r=n.message,o=n.conversation;this.host.models.Message.inject(r),this.emit("message",r),o&&(this.__addConversationCounterPartyToServerRosterIfShould(o),o.emit("message",r),this.config.condensedReplays&&o._markingAsRead&&r.sortNumber>o._markingAsReadSortNumber&&this.__clearOptimisticStatus([o]));Po[r.markedRecipientStatus]<Po[So.DELIVERED]&&this.host.messages.markAsReceived(r,{})}},t.prototype.reactToMessageEventCR=function(e){var t=e.data,n={},r=this._reactToMessageEventCR({data:t}),o=r.message,i=r.conversation;this.emit("message",o),i&&(this.__addConversationCounterPartyToServerRosterIfShould(i),i.emit("message",o)),n.queue=!0,this.host.messages.markAsReceived(o,n)},t.prototype._reactToMessageEvent=function(e){var t=e.data,n=e.conversationId,r=void 0===n?null:n;t=Rs(t);var o=this.host.currentUserId,i=t.recipient_status;i||(i=[]);var s={status:t.status,timestamp:t.created_time};t.team_request&&this.host.teams.__injectTeamRequest(t.team_request);var a=this.host.models.Message.parseAttrs(t);a.messageType=zo.USER_SENT;var u=!0;if(a.groupId)a.counterPartyType="group",a.counterPartyId=a.groupId;else if(a.recipientId){if(this.host.distributionLists.getById(a.recipientId))a.counterPartyType="distributionList";else if(this.host.users.getById(a.recipientId))a.counterPartyType="user";else{u=!1;var c=this.host.messages._looksLikeDistributionListMessage(a);a.counterPartyType=c?"distributionList":"user"}a.counterPartyId="distributionList"===a.counterPartyType||a.senderId===o?a.recipientId:a.senderId}var l=this.host.messages._isMessageOutgoing(a);"distributionList"!==a.counterPartyType&&(s.account_id=l?a.recipientId:this.host.currentUserId,s.account_id&&i.push(s)),a.senderStatus=jo.SENT;var d=u&&this.ensureConversation(a.counterPartyType,a.counterPartyId,a.recipientOrganizationId,{conversationId:r,ensureEntities:{counterParty:"placeholder",groupMembers:"placeholder",organization:"placeholder"}});a.conversationId=d?d.id:null;var h=this.host.models.Message.get(a.id);if(h){var p=a.body,f=a.escalationExecutionId,v=a.isForwardedFromPatientNetwork,y=a.originalSender,g=a.patientDetails,m=a.priority,_=a.sortNumber,b=a.sortSeries;h.body=p,h.escalationExecutionId=f||null,h.isForwardedFromPatientNetwork=v,h.originalSender=y,h.patientDetails=g,h.priority=m,h.shouldEscalate=!1,h.sortNumber=_,h.sortSeries=b}else h=this.host.models.Message.createInstance(a,!1);var w=h.senderId===o?h.recipientId:h.senderId;w&&"distributionList"!==h.counterPartyType&&this.__ensureMessageCounterParty(d,w,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0});for(var I=0,O=i;I<O.length;I++){var T=O[I];this.config.condensedReplays||this.host.messages.__injectMessageStatus(h,T)}return("group"===a.counterPartyType||this.config.condensedReplays)&&(h.shouldEnsureRecipientStatus=!0),h.inTimeline=!(!d||!d.isLive),{message:h,conversation:d}},t.prototype._reactToMessageEventCR=function(e){var t=void 0===e?{}:e,n=t.data,r=void 0===n?{}:n,o=t.injectConversation,i=void 0===o||o;r=Rs(r);var s,a=this.host.currentUserId,u=r.first_expiring_unread_message,c=r.last_message,l=(r.type,r.unread_message_count),d=r.unread_priority_message_count,h=(r.xmlns,da(r,["first_expiring_unread_message","last_message","type","unread_message_count","unread_priority_message_count","xmlns"]));h.team_request&&this.host.teams.__injectTeamRequest(h.team_request),c&&(c.conversation_id=h.conversation_id,s=c.sort_number,c.is_group&&!c.group_token&&(c.group_token=c.recipient_token),c.message_id===h.client_id&&(h.attachmentName=c.attachment_name)),h.is_group&&!h.group_token&&(h.group_token=h.recipient_token);var p=this.host.models.Message.parseAttrs(h);if(p.messageType=zo.USER_SENT,p.groupId)p.counterPartyType="group",p.counterPartyId=p.groupId;else if(p.recipientId){if(this.host.distributionLists.getById(p.recipientId))p.counterPartyType="distributionList";else if(this.host.users.getById(p.recipientId))p.counterPartyType="user";else{var f=this.host.messages._looksLikeDistributionListMessage(p);p.counterPartyType=f?"distributionList":"user"}p.counterPartyId="distributionList"===p.counterPartyType||p.senderId===a?p.recipientId:p.senderId}p.senderStatus=jo.SENT;var v,y=this.host.models.Message.get(p.id);if(y?this.host.models.Message.inject(aa({shouldEscalate:!1},p)):y=this.host.models.Message.inject(p),i){var g={conversation_id:y.conversationId,entity:this._resolveEntity(p.counterPartyId,p.counterPartyType),first_expiring_unread_message:u,last_message:c,organization_id:y.__organizationId,unread_message_count:l,unread_priority_message_count:d};if(c&&c.sort_number<y.sortNumber?(s=y.sortNumber,g.last_message={message_id:y.id},(v=this.__injectConversation(g,{highestSortNumber:s}))&&this._ensureLastMessage({rawLastMessage:c,conversationId:v.id,counterParty:v.counterParty})):v=this.__injectConversation(g,{highestSortNumber:s}),c&&c.message_id&&v&&v.isLive){var m=this.host.models.Message.get(c.message_id);m&&!m.inTimeline&&(m.inTimeline=!0,this.host.models.Message.inject(m))}}else v=this.host.conversations.getById(h.conversation_id);var _=y.senderId===a?y.recipientId:y.senderId,b="group"!==y.counterPartyType||y.counterParty&&"FORUM"===y.counterParty.groupType;return _&&"distributionList"!==y.counterPartyType&&b&&this.__ensureMessageCounterParty(v,_,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),y.inTimeline=!!y.isEphemeral||!(!v||!v.isLive),y.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(y),{conversation:v,message:y}},t.prototype.reactToFriendsEventCR=function(e){var t=e.data,n=e.eventId,r=(t=Rs(t)).action,o=(t.xmlns,da(t,["action","xmlns"])),i=o.entity,s=o.organization_id||o.organization_key,a=i.metadata,u=i.id||i.token;if("group"===i&&"del"===r&&!a){var c=this.host.models.Group.get(o.token),l=this.getById(c.conversation.id);return this.__removeFriend({conversation:l,entityType:i,id:o.token,organizationId:s}),l&&this.__clearOptimisticStatus([l]),void this.emit("friends",aa(aa({action:r},l.entity),{organizationId:s}))}if(i.type){var d=this.host.modelNameByEntityType(i.type);if(a&&"patient_messaging"===a.feature_service&&"string"==typeof a.is_patient_contact&&(a.is_patient_contact="true"===a.is_patient_contact),i.organizationId=s,"group"===d&&a&&"role"===a.feature_service&&"role_assignment"===a.meta_type)this._rolesFriendsEventPromise=this.host.roles.reactToFriendsEventCR({action:r,attrs:i,id:n});else{var h=o.conversation_id,p=o.last_message,f=o.lowest_sort_number,v=this.getById(h);if("add"===r||"update"===r){v&&"update"===r&&this.clearMessageStatuses(v);var y=p&&p.sort_number?p.sort_number:void 0,g=!1,m=_.a.get(t,"entity.is_public")||_.a.get(t,"entity.metadata.team");if((void 0===y||m)&&"add"===r)if("group"===d){if(i.proxied_members&&i.proxied_members[this.host.currentUserId])for(var b=this.host.models.Product.getAll()[0],w=0,I=i.proxied_members[this.host.currentUserId];w<I.length;w++){var O=I[w];if(b.rolesOptingIn.includes(O.token)){g=!0;break}}y=g?1:this.host.messages.__getNextSortNumber(s)}else y=v?v.highestSortNumber:1;var T=v&&v.lastMessage;if("add"===r){var E="group"===d&&this.host.groups.__extractGroupTypeFromAttrs(i);E!==Ao.GROUP&&E!==Ao.FORUM||(i.members=null),this.__injectCounterParty({entityAttrs:i,entityType:d,groupType:E,hasCurrentUser:!0,isPlaceholder:!0,organizationId:s}),v=this.__injectConversation(o,{highestSortNumber:y}),T&&!p&&this.find(h),this.clearTimeline(v)}else"update"===r&&(v=this.__injectConversation(o,{highestSortNumber:y}),T&&!p&&this.find(h));f&&this.markAsDelivered(v)}else"del"===r?this.__removeFriend({attrs:i,entityType:d,id:u,organizationId:s}):this.logger.error("friends action not implemented",r,t);v&&this.__clearOptimisticStatus([v]),this.emit("friends",aa({action:r},i))}}},t.prototype.reactToFriendsEvent=function(e){var t=e.data,n=e.id;if(this.config.condensedReplays)this.reactToFriendsEventCR({data:t,eventId:n});else{var r=(t=Rs(t)).friend,o=r.action,i=r.organization_id,s=da(r,["action","organization_id"]),a=s.metadata,u=s.token,c=this.host.modelNameByTypeNS(s.xmlns);if(c)if("group"===c&&a&&"role"===a.feature_service&&"role_assignment"===a.meta_type)this._rolesFriendsEventPromise=this.host.roles.reactToFriendsEvent({data:t,id:n});else{if("add"===o){var l="group"===c&&this.host.groups.__extractGroupTypeFromAttrs(s);l!==Ao.GROUP&&l!==Ao.FORUM||(s.members=null);var d=l===Ao.PATIENT_MESSAGING?"PATIENT":"PROVIDER";this.__injectCounterParty({entityAttrs:s,entityType:c,groupType:l,hasCurrentUser:!0,isPlaceholder:!0,organizationId:i});var h="group"===c?this.host.messages.__getNextSortNumber(i):1;this.ensureConversation(c,u,i,{highestSortNumber:h,network:d})}else"del"===o?this.__removeFriend({attrs:s,entityType:c,id:u,organizationId:i}):this.logger.error("friends action not implemented",o,t);this.emit("friends",aa({action:o},s))}}},t.prototype.reactToUpdateTeamRequestEvent=function(e){var t=e.data,n=(t=Rs(t)).team_request;n&&this.host.teams.__injectTeamRequest(n)},t.prototype.reactToUpdateEventCR=function(e){var t=e.data,n=(t=Rs(t)).entity,r=t.organization_id,o=n.metadata,i=n.token,s=n.type;n.organizationId=r,this._sanitizeGroupAttrs(n);var a=this.host.modelNameByEntityType(s),u=this.host.groups.__extractGroupTypeFromAttrs(n);if(o&&r&&i&&ga.includes(u)&&this.host.metadata.__injectMetadata(i,r,o),o&&o.feature_service&&"role"===o.feature_service){if("group"===a&&o.target_id)return this.__injectTargetEntity(o,r);this.host.roles.reactToUpdateEventCR({entity:n})}this.host.injectModel(n,s)},t.prototype.reactToUpdateEvent=function(e){var t=e.data;if(this.config.condensedReplays)this.reactToUpdateEventCR({data:t});else{var n=(t=Rs(t)).metadata,r=t.organization_key,o=t.token,i=t.type;this._sanitizeGroupAttrs(t);var s=this.host.modelNameByTypeNS(i),a=this.host.groups.__extractGroupTypeFromAttrs(t);if(n&&r&&o&&ga.includes(a)&&this.host.metadata.__injectMetadata(o,r,n),n&&n.feature_service&&"role"===n.feature_service){if("group"===s&&n.target_id)return this.__injectTargetEntity(n,r);this.host.roles.reactToUpdateEvent({data:t})}var u=da(t,[]);this.host.injectModel(u,i)}},t.prototype.__queueReload=function(e){this.__queuedConversationsToReload.includes(e)||this.__queuedConversationsToReload.push(e),this.__flushConversationsToReload()},t.prototype.hasPendingReloads=function(){return this.__queuedConversationsToReload&&this.__queuedConversationsToReload.length>0},t.prototype.__updateTimeline=function(e){var t=e.content,n=e.timeline;n.length=0;for(var r=0,o=t;r<o.length;r++){var i=o[r];i.inTimeline&&n.push(i)}this.host.models.Conversation.inject(e)},t.prototype.__reloadConversation=function(e,t){var n=(void 0===t?{}:t).notify,r=void 0===n||n;if(this.config.condensedReplays)return this.__reloadConversationCR(e);var o=e.content,i=e.higherContinuation,s=e.lowerContinuation,a=e.markableAsReadMessages,u=e.messages,c=e.timeline,l=[],d=[],h=0,p=null,f=null,v=null;a.length=0,u.length=0,c.length=0;for(var y=-1,g=0,m=o;g<m.length;g++){var b=m[g];y++;var w=b.escalationExecution,I=b.inTimeline,O=b.isOutgoing,T=b.isUnread,E=b.markedRecipientStatus,A=b.messageType,C=b.priority;I&&(null===p&&(p=y),f=y,c.push(b)),A===zo.USER_SENT?(u.push(b),O||!T||v||(v=b),w&&"IN_PROGRESS"===w.status&&h++,wa.includes(E)&&a.push(b),O||(T&&(l.push(b),C===Co.HIGH&&d.push(b)),e.lastIncomingMessageSortNumber=b.sortNumber)):fa.includes(A)&&(e.lastBangMessageSortNumber=b.sortNumber)}s.itemsEstimate=p,i.itemsEstimate=null===f?null:o.length-1-f,e.isLive=0===i.itemsEstimate||0===o.length;var R=u.length>0?u[u.length-1]:null,P=R||_.a.last(o.filter((function(e){return e.messageType===zo.GROUP_MEMBERSHIP_CHANGE&&e.groupMembersChange&&"ADD"===e.groupMembersChange.action})));if(e.firstUnreadMessage=v,e.inProgressEscalationCount=h,e.lastMessage=R,e.unreadCount=l.length,e.unreadPriorityCount=d.length,e.highestSortNumber=P&&P.sortNumber||e.lastConversationSortNumber||0,r){var S=e.counterPartyType,j=e.counterPartyId,M=e.organizationId,z=this.getConversationKey(S,j,M);this._convByConvHandle[z]=e,this.host.models.Conversation.inject(e)}},t.prototype.__reloadConversationCR=function(e){var t=e._markingAsRead,n=e._markingAsReadSortNumber,r=e.content,o=e.higherContinuation,i=e.messages,s=e.timeline,a=[],u=[],c=null;i.length=0,s.length=0;for(var l=0,d=r;l<d.length;l++){var h=d[l],p=h.inTimeline,f=h.isOutgoing,v=h.isUnread,y=h.messageType,g=h.priority,m=h.sortNumber;p&&s.push(h),y===zo.USER_SENT?(i.push(h),!f&&v&&(c||(c=h),t&&m<=n||(a.push(h),g===Co.HIGH&&u.push(h)))):fa.includes(y)&&(e.lastBangMessageSortNumber=h.sortNumber)}e.firstUnreadMessage=c,e.highestSortNumber=e.highestSortNumber||0,e.isLive=0===o.itemsEstimate||0===r.length,t&&(e.unreadCount=a.length,e.unreadPriorityCount=u.length);var _=e.counterPartyType,b=e.counterPartyId,w=e.organizationId,I=this.getConversationKey(_,b,w);this._convByConvHandle[I]=e,this.host.models.Conversation.inject(e)},t.prototype.__addConversationCounterPartyToServerRosterIfShould=function(e){if(e&&!e._counterPartyAddedOnServer){var t=e.organization;t&&!t.$placeholder&&this.add(e.counterPartyType,e.counterPartyId,e.organizationId)}},t.prototype.addMembershipChangeLog=function(e){var t,n,r=e.action,o=e.actionTime,i=e.actor,s=e.alwaysAddToTimeline,a=e.createdAt,u=e.group,c=e.id,l=e.memberIds,d=e.members,h=e.removedFromGroup,p=void 0!==h&&h,f=e.sortNumber,v=i.id,y=u.id,g=u.organizationId,m=this.host.currentUser,_=this.get("group",y,g);if(this.config.condensedReplays){if(!_)return;t=_.id}else t=this.getConversationKey("group",y,g);n=!!s||!p&&(!!_&&_.isLive);var b=this.host.models.GroupMembersChange.inject({id:"groupMembersChange:"+c,action:r,actionTime:o,actor:i,memberIds:l,members:d});this.host.models.Message.inject({body:this.__generateGroupMembershipChangeBody(e),conversationId:t,counterPartyId:y,counterPartyType:"group",createdAt:a,groupId:y,groupMembersChange:b,id:"bang:"+c,inTimeline:n,isOutgoing:!1,messageType:zo.GROUP_MEMBERSHIP_CHANGE,recipient:m,senderId:v,sortNumber:f}),"OPT_IN"!==r&&"OPT_OUT"!==r||this.host.roles.refresh(g)},t.prototype.__generateGroupMembershipChangeBody=function(e){var t=this,n=e.action,r=e.actor,o=e.group,i=e.members,s=o.groupType,a=ma[n]||Oa[n],u=r.id===this.host.currentUserId?"You":r.displayName,c=_a[n]||"",l=null;return(n in _a||n in Oa)&&(l=Ys.a.call(Xs.a.call(i.map((function(e,n){return[e.id===t.host.currentUserId?"You":e.displayName,(n===i.length-2?" and":",")+" "]})))).join("")),n in Oa?[l,a,u].filter(Boolean).join(" "):[u,a,l,c,"this",ba[s]].filter(Boolean).join(" ")},t.prototype.addCallChangeLog=function(e){var t,n=e.caller,r=e.callee.id,o=e.conversationId,i=e.createdAt,s=e.group,a=e.id,u=e.organizationId,c=e.sortNumber,l=s.id,d=n&&n.id===this.host.currentUser.id;if(this.config.condensedReplays)t=o;else if(s)t=this.getConversationKey("group",l,u);else{var h=d?r:n.id;t=this.getConversationKey("user",h,u)}this.host.models.Message.inject({body:this.__generateCallChangeBody(e),conversationId:t,counterPartyId:r,counterPartyType:"group",createdAt:i,groupId:r,id:"bang:"+a,inTimeline:!0,isOutgoing:!1,messageType:zo.CALL_CHANGE,recipient:this.host.currentUser,senderId:n?n.id:null,sortNumber:c})},t.prototype.__generateCallChangeBody=function(e){var t=e.action,n=e.caller,r=e.duration,o=e.group,i=e.isVideo,s=e.userStartTime,a=s?ia()(s).format("h:mm A"):"";if("CALL_CHANGE"===t){var u=n.id===this.host.currentUser.id,c=!o||u||"PATIENT_MESSAGING"===o.groupType&&o.memberCount<3?"":" from "+n.displayName+" + "+(o.memberCount-1)+" members";return(u?"Outgoing":"Incoming")+" "+(i?"Video Call":"Call")+" ("+ws(r)+")"+c+" at "+a}if("MISSED_CALL"===t)return"Missed Call"+(c=o?" from "+n.displayName:"")+" at "+a},t.prototype.addEscalationExecutionChangeLog=function(e){var t,n=e.action,r=e.actionTime,o=e.actor,i=e.alwaysAddToTimeline,s=e.createdAt,a=e.escalationExecution,u=e.group,c=e.members,l=e.id,d=e.sortNumber,h=u.id,p=u.organizationId,f=this.host.currentUser,v=this.get("group",h,p),y=v?v.id:null;if(!v){if(this.config.condensedReplays)return;y=this.getConversationKey("group",h,p)}t=!!i||!!v&&v.isLive;var g=this.host.models.EscalationExecutionChange.inject({id:"escalationExecutionChange:"+l,action:n,actionTime:r,actor:o,members:c});this.host.models.Message.inject({body:this.__generateGroupEscalationChangeBody(e,a),conversationId:y,counterPartyId:h,counterPartyType:"group",createdAt:s,escalationExecutionChange:g,escalationExecutionId:a?a.id:null,groupId:h,id:"bang:"+l,inTimeline:t,isOutgoing:!1,messageType:zo.ESCALATION_EXECUTION_CHANGE,recipient:f,senderId:o?o.id:null,sortNumber:d})},t.prototype.__generateGroupEscalationChangeBody=function(e,t){var n=e.action,r=e.actor,o=e.members,i=ya[n],s=t&&t.displayId||"";return s.startsWith("#")&&(s=s.slice(1,s.length)),""!==s&&(s+=" "),n===To.MEMBER_ADDED?i+" "+o[0].displayName+" to this escalation":n!==To.INITIATED&&r&&r.displayName?"Escalation "+s+i+" by "+r.displayName:"Escalation "+s+i},t.prototype.getMessageConversationKey=function(e){if(e.groupId)return this.conversationHashForListEntityId(e.groupId);if(e.distributionListId)return this.conversationHashForListEntityId(e.distributionListId);var t=e.senderId===this.host.currentUserId?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)},t.prototype.getConversationKey=function(e,t,n,r){switch(void 0===r&&(r=n),e){case"user":return this.conversationHashForUserMessage(t,n,r);case"distributionList":case"group":case"team":return this.conversationHashForListEntityId(t);default:throw new Error("type "+e+" not supported in conversation")}},t.prototype.conversationHashForUserMessage=function(e,t,n){void 0===n&&(n=t);var r=[e,t,n].join(":");return pa.b64(r)},t.prototype.conversationHashForListEntityId=function(e){return pa.b64(e)},t.prototype.conversationHashForGroupId=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.conversationHashForListEntityId.apply(this,e)},t.prototype.conversationHashForDistributionListId=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.conversationHashForListEntityId.apply(this,e)},t.prototype.looksLikeConversationHandle=function(e){return/^[a-zA-Z0-9/+=]{24}$/.test(e)},t.prototype.findConversationWithUser=function(e,t){return ca(this,void 0,void 0,(function(){return la(this,(function(n){return[2,this.get(this.host.models.User.name,e,t)]}))}))},t.prototype.findConversationWithGroup=function(e,t){return ca(this,void 0,void 0,(function(){return la(this,(function(n){return[2,this.get(this.host.models.Group.name,e,t)]}))}))},t.prototype.findAllGroupConversationsWithMembers=function(e,t,n){var r=void 0===n?{}:n,o=r.exact,i=void 0===o||o,s=r.includeCurrentUser,a=void 0===s||s,u=r.includeForums,c=void 0===u||u,l=r.includeRoles,d=void 0===l||l,h=r.localOnly,p=void 0!==h&&h,f=r.senderId,v=void 0===f?null:f;return ca(this,void 0,void 0,(function(){var n,r,o,s,u,l;return la(this,(function(h){switch(h.label){case 0:return[4,this.resolveMembers(qs(e))];case 1:return e=(e=h.sent()).map(this._resolveModelId),[4,this.host.groups.findAllWithSpecificMembers(e,t,{exact:i,includeCurrentUser:a,includeForums:c,includeRoles:d,localOnly:p,senderId:v})];case 2:for(n=h.sent(),r=[],o=0,s=n;o<s.length;o++)u=s[o],(l=this.get(this.host.models.Group.name,u.id,t))&&r.push(l);return[2,r]}}))}))},t.prototype.findLocalRoleP2PConversation=function(e,t){var n,r;e=this.host.roles.__resolveRoleId(e),t=this.host.roles.__resolveRoleId(t);var o=this.host.models.User.get(e),i=this.host.models.User.get(t);if(i&&i.isRoleBot&&i.botRole)r=this.host.roles._roleP2PConversations[t];else{if(!(o&&o.isRoleBot&&o.botRole))return null;r=this.host.roles._roleP2PConversations[e]}if(r)for(var s=0,a=r;s<a.length;s++){var u=a[s],c=u.$lastModified,l=u.counterParty,d=l.p2pRecipient,h=l.p2pSender;if(d&&h){var p=this.host.roles.__resolveRoleId(d.id),f=this.host.roles.__resolveRoleId(h.id);(p===e&&f===t||p===t&&f===e)&&(!n||n.$lastModified<c)&&(n=u)}}return n},t.prototype.resolveMembers=function(e){return ca(this,void 0,void 0,(function(){var t=this;return la(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return ca(t,void 0,void 0,(function(){return la(this,(function(t){switch(t.label){case 0:if(!It()(e)&&!Fr(e))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.host.users.find(e)];case 2:return[2,t.sent().id];case 3:return t.sent(),[2,e];case 4:return[2,e]}}))}))})))];case 1:return[2,n.sent()]}}))}))},t.prototype.selectConversation=function(e,t){var n=void 0===t?{}:t,r=n.anchorPoint,o=void 0===r?Oo.CONVERSATION_END:r,i=n.fetchAllItems,s=void 0!==i&&i,a=n.markAsDelivered,u=void 0===a||a,c=n.markAsRead,l=void 0===c||c,d=n.maxItemsPerBatch,h=n.minItemsToFetch,p=void 0===h?20:h;return ca(this,void 0,void 0,(function(){var t,n,r,i;return la(this,(function(a){switch(a.label){case 0:if(e=this._resolveModelId(e),!(t=this._resolveEntity(e,"conversation")))throw new C(this.host.models.Conversation.name,e);if(o===Oo.CONTINUATION)throw new Error("Cannot call selectConversation() with anchorPoint='CONTINUATION'");return this.config.condensedReplays?[4,this._selectConversationCR(e,{anchorPoint:o,conversation:t,fetchAllItems:s,markAsDelivered:u,markAsRead:l,maxItemsPerBatch:d,minItemsToFetch:p})]:[3,2];case 1:return[2,a.sent()];case 2:return r=n=0,[4,this.fetchTimeline(e,{anchorPoint:o,markAsDelivered:u,maxItems:p})];case 3:return n=r+a.sent(),t.markableAsReadMessages.length>0?t.firstUnreadMessage=t.markableAsReadMessages[0]:t.firstUnreadMessage=null,i=t.firstUnreadMessage,l&&t.unreadCount>0&&this.markAsRead(e,{localOnly:!0}),[4,this._fetchContinuations(e,{addedMessages:n,conversation:t,fetchAllItems:s,markAsDelivered:u,minItemsToFetch:p})];case 4:return n=a.sent(),l&&this.markAsRead(e),[2,{addedMessages:n,previousFirstUnreadMessage:i}]}}))}))},t.prototype._selectConversationCR=function(e,t){var n=t.anchorPoint,r=t.conversation,o=t.fetchAllItems,i=void 0!==o&&o,s=t.markAsDelivered,a=t.markAsRead,u=t.minItemsToFetch,c=t.maxItemsPerBatch,l=void 0===c?u:c;return ca(this,void 0,void 0,(function(){var t,o,c,d;return la(this,(function(h){switch(h.label){case 0:return t=a&&r.unreadCount>0,o=0,t&&this.markAsRead(e,{localOnly:!0}),c=o,[4,this.fetchTimeline(e,{anchorPoint:n,fetchAllItems:i,markAsDelivered:s,maxItems:l})];case 1:return o=c+h.sent(),[4,this._fetchContinuations(e,{addedMessages:o,conversation:r,fetchAllItems:i,markAsDelivered:s,maxItemsPerBatch:l,minItemsToFetch:u})];case 2:return o=h.sent(),d=r.firstUnreadMessage,t&&this.markAsRead(e),this.__ensureEntities(r,{messageCounterParties:"full"}),[2,{addedMessages:o,previousFirstUnreadMessage:d}]}}))}))},t.prototype._fetchContinuations=function(e,t){var n=void 0===t?{}:t,r=n.addedMessages,o=void 0===r?0:r,i=n.conversation,s=n.fetchAllItems,a=void 0!==s&&s,u=n.markAsDelivered,c=void 0===u||u,l=n.minItemsToFetch,d=void 0===l?20:l;n.maxItemsPerBatch;return ca(this,void 0,void 0,(function(){var t,n;return la(this,(function(r){switch(r.label){case 0:if(0===o)return[2,0];r.label=1;case 1:return(a||o<d)&&i.higherContinuation.itemsEstimate>0?(t=o,[4,this.fetchTimeline(e,{anchorPoint:Oo.CONTINUATION,markAsDelivered:c,continuation:i.higherContinuation.continuation,fetchAllItems:a})]):[3,3];case 2:return o=t+r.sent(),[3,1];case 3:return(a||o<d)&&i.lowerContinuation.itemsEstimate>0?(n=o,[4,this.fetchTimeline(e,{anchorPoint:Oo.CONTINUATION,markAsDelivered:c,continuation:i.lowerContinuation.continuation,fetchAllItems:a})]):[3,5];case 4:return o=n+r.sent(),[3,3];case 5:return[2,o]}}))}))},t.prototype.getWithUser=function(e,t,n){var r,o=(void 0===n?{}:n).createIfNotFound,i=void 0!==o&&o;if(e=this._resolveModelId(e),t=this._resolveModelId(t),this.config.condensedReplays){var s=this.host.users.getById(e);if(s&&s.profileByOrganizationId&&s.profileByOrganizationId[t]){var a=s.profileByOrganizationId[t].conversationId;a&&(r=this.getById(a))}}else{var u=this.conversationHashForUserMessage(e,t);r=this.getById(u)}return!r&&i&&(r=this.ensureConversation("user",e,t)),r||null},t.prototype.getWithListEntity=function(e,t,n){var r,o=void 0===n?{createIfNotFound:!1}:n,i=o.createIfNotFound,s=void 0!==i&&i,a=o.organizationId,u=o.conversationId,c=void 0===u?null:u;if(t=this._resolveModelId(t),this.config.condensedReplays)c&&(r=this.getById(c));else{var l=this.conversationHashForListEntityId(t);r=this.getById(l)}if(!r&&s){var d=this._resolveEntity(t,e);if(!d)throw new Error("Entity required when using createIfNotFound");a=d.organizationId,r=this.ensureConversation(e,t,a,{conversationId:c}),this.config.condensedReplays&&!c&&(r.$localOnly=!0)}return r},t.prototype.getWithGroup=function(e){return this.getWithListEntity("group",e)},t.prototype.getWithDistributionList=function(e){return this.getWithListEntity("distributionList",e)},t.prototype.get=function(e,t,n){var r=this.getConversationKey(e,t,n);return(this.config.condensedReplays?this._convByConvHandle[r]:this.host.models.Conversation.get(r))||null},t.prototype.getAll=function(){return this.host.models.Conversation.getAll()},t.prototype.getById=function(e){return this.host.models.Conversation.get(e)},t.prototype.getMultiById=function(e){return this.host.models.Conversation.getMulti(e)},t.prototype.getAllForOrganization=function(e){var t=this._resolveEntity(e,"organization");return t?t.conversations:null},t.prototype.__ensureEntities=function(e,t){return void 0===t&&(t={}),ca(this,void 0,void 0,(function(){var n,r,o;return la(this,(function(i){switch(i.label){case 0:if(n=[],r=Promise.resolve(),t.counterParty&&(r=this.__ensureCounterParty(e,t),n.push(r)),t.escalationExecution&&n.push(this.__ensureEscalationExecution(e,r,t)),t.messageCounterParties&&n.push(this.__ensureMessageCounterParties(e,t)),t.organization&&n.push(this.__ensureOrganization(e,t)),0===(n=n.filter(Boolean)).length)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(n)];case 2:return i.sent(),t.onLoad&&t.onLoad(),this.host.models.Conversation.inject(e),[3,4];case 3:return o=i.sent(),console.error(o),[3,4];case 4:return[2]}}))}))},t.prototype.__ensureOrganization=function(e,t){return void 0===t&&(t={}),ca(this,void 0,void 0,(function(){var n=this;return la(this,(function(r){switch(r.label){case 0:return[4,this.host.organizations._findAll()];case 1:return r.sent(),this.host.models.Organization.shouldEnsure(e.organization,"full"!==t.organization)?[4,new Promise((function(r,o){n.host.models.Organization.ensureEntity(e.organizationId,{onlyPlaceholder:"placeholder"===t.organization,onMissing:function(){n.logger.info("org "+e.organizationId+" not found, created placeholder org"),e.$loadingOrganization=!0,r()},onLoad:function(){n.logger.info("org "+e.organizationId+" loaded"),e.$loadingOrganization=!1,t.touchOnRelatedEntityLoad&&n.host.models.Conversation.inject(e)},onFinish:r})}))]:[2,null];case 2:return r.sent(),[2]}}))}))},t.prototype.__ensureCounterParty=function(e,t){return void 0===t&&(t={}),ca(this,void 0,void 0,(function(){var n,r,o,i=this;return la(this,(function(s){if(t=aa({},t),"group"===e.counterPartyType&&e.counterParty&&e.counterParty.groupType===Ao.ROLE_P2P&&(t.counterParty="full",t.groupMembers="full"),n=this.host.modelsByEntityType[e.counterPartyType],!n.shouldEnsure(e.counterParty,"full"!==t.counterParty,{groupMembersOnlyPlaceholder:"full"!==t.groupMembers}))return[2,null];switch(r={},e.counterPartyType){case"user":break;case"group":case"distributionList":r.organizationId=e.organizationId;break;default:throw new Error("unsupported counterPartyType",e.counterPartyType)}return o=function(e){if("group"===n.name&&"placeholder"!==t.counterParty&&t.groupMembers)return i.host.groups.ensureMembers(e,{onlyPlaceholder:"placeholder"===t.groupMembers})},[2,new Promise((function(s,a){n.ensureEntity(e.counterPartyId,{attrs:r,onlyPlaceholder:"placeholder"===t.counterParty,onMissing:function(){i.logger.info("entry "+e.counterPartyId+" not found, created placeholder on org "+e.organizationId),e.$loadingCounterParty=!0},onLoad:function(){e.$loadingCounterParty=!1,t.touchOnRelatedEntityLoad&&i.host.models.Conversation.inject(e)},onFinish:function(e){e&&o(e),s()}})}))]}))}))},t.prototype.__ensureEscalationExecution=function(e,t,n){return void 0===n&&(n={}),ca(this,void 0,void 0,(function(){var n,r,o;return la(this,(function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),n=e.counterPartyType,(r=e.counterParty)&&"group"===n?(o=r.escalationExecution,r.groupType===Ao.ESCALATION&&o?[4,this.host.escalations.ensureEscalationExecution(o)]:[2]):[2];case 2:return i.sent(),[2]}}))}))},t.prototype.__ensureMessageCounterParties=function(e,t){var n=this;void 0===t&&(t={});var r=ra.a.call(ta.a.call(Zs.a.call(e.messages,"senderId").filter(Boolean)),this.host.currentUserId,e.counterPartyId);return Promise.all(r.map((function(r){return n.__ensureMessageCounterParty(e,r,t)})))},t.prototype.__ensureMessageCounterParty=function(e,t,n){var r=this;void 0===n&&(n={});var o=this.host.models.User.get(t);return this.host.models.User.shouldEnsure(o,"full"!==n.messageCounterParties)?new Promise((function(o,i){r.host.models.User.ensureEntity(t,{onlyPlaceholder:"placeholder"===n.messageCounterParties,onMissing:function(){var n=e?"entry "+e.counterPartyId+" not found, created placeholder on org "+e.organizationId:"counterParty "+t+" not found";r.logger.info(n)},onLoad:function(){e&&n.touchOnRelatedEntityLoad&&r.host.models.Conversation.inject(e)},onFinish:o})})):null},t.prototype._setAllowedSenders=function(e){var t=e.counterParty,n=e.counterPartyType,r=e.organization,o=this.host.currentUser,i=[o];if(!r)return e.allowedSenders=[],void(e.allowedSendersReason=Io.ORGANIZATION_DOES_NOT_EXIST);if(o.contactsMessagingBlocked&&r.isContacts)return e.allowedSenders=[],void(e.allowedSendersReason=Io.CONTACTS_MESSAGING_BLOCKED_BY_ADMIN);if(!n)return e.allowedSenders=i,void(e.allowedSendersReason=Io.CONVERSATION_NOT_FULLY_LOADED);if(!t)return e.allowedSenders=[],void(e.allowedSendersReason=Io.NO_COUNTER_PARTY);switch(n){case"user":return t.$placeholder?(e.allowedSenders=[],void(e.allowedSendersReason=Io.COUNTER_PARTY_NOT_FULLY_LOADED)):"TigerPage"===t.displayName?(e.allowedSenders=[],void(e.allowedSendersReason=Io.COUNTER_PARTY_IS_TIGERPAGE)):(e.allowedSenders=i,void(e.allowedSendersReason=Io.NONE));case"distributionList":return e.allowedSenders=i,void(e.allowedSendersReason=Io.NONE);case"group":var s=t.createdByRole,a=t.createdByUser,u=t.groupType,c=t.p2pRecipient,l=t.p2pSender,d=t.targetRole,h=t.targetUser,p=t.members,f=t.proxiedMembers,v=r.allowedSenders;if(u===Ao.FORUM)return e.allowedSenders=i,void(e.allowedSendersReason=Io.NONE);if(u===Ao.ROLE_ASSIGNMENT)return e.allowedSenders=[],void(e.allowedSendersReason=Io.IS_ROLE_ASSIGNMENT_GROUP);if(u===Ao.ROLE_P2P&&c&&l){var y=[],g=s&&s.botUser,m=d&&d.botUser;!g||p&&p.includes(g)?!a||p&&p.includes(a)||y.push(a):y.push(g),!m||p&&p.includes(m)?!h||p&&p.includes(h)||y.push(h):y.push(m),y.length>0&&(p=ha(p||[],y))}else if(t.$placeholder)return e.allowedSenders=[],void(e.allowedSendersReason=Io.COUNTER_PARTY_NOT_FULLY_LOADED);if(!p)return e.allowedSenders=[],void(e.allowedSendersReason=Io.GROUP_MEMBERS_NOT_LOADED);if(0===p.length)return e.allowedSenders=[],void(e.allowedSendersReason=Io.GROUP_HAS_NO_MEMBERS);for(var _=[],b=0,w=v;b<w.length;b++){var I=w[b],O="role"===I.$entityType?I.botUser:I;if(p.includes(O)){var T=O.id,E=f&&f[T];if(E){for(var A=!1,C=0,R=E;C<R.length;C++){R[C].token===T&&(A=!0)}if(!A)continue}_.push(I)}}return 0===_.length?(e.allowedSenders=_,void(e.allowedSendersReason=Io.USER_IS_NOT_MEMBER_OF_GROUP)):u!==Ao.ROLE_P2P?(e.allowedSenders=_,void(e.allowedSendersReason=Io.NONE)):l&&_.includes(l)?c===o||o.roles.includes(c)?(e.allowedSenders=[],void(e.allowedSendersReason=Io.CONVERSATION_WITH_ROLE_YOU_ARE_CURRENTLY_IN)):(e.allowedSenders=[l],void(e.allowedSendersReason=Io.NONE)):(e.allowedSenders=[],void(e.allowedSendersReason=Io.USER_IS_NOT_IN_THIS_ROLE_CONVERSATION));default:return e.allowedSenders=[],void(e.allowedSendersReason=Io.COUNTER_PARTY_TYPE_NOT_SUPPORTED)}},t.prototype.reactToProcessingStart=function(e){var t=e.data,n=(t=Rs(t)).action_type,r=t.conversation_id,o=t.entity,i=t.organization_id,s=o.token||o.id,a=qo.resolve(n);if(this.host.products._addProcessingEvent({actionType:a,entity:aa({id:s},o)}),a===qo.ROLE_OPT_OUT)this._roleConversationsProcessingEvent[s]=this.host.roles._roleConversations[s];else if(a===qo.ORGANIZATION_MESSAGE_STATUS||a===qo.ORGANIZATION_REPLAY){var u=this.host.organizations.getById(i);if(!u)return;u._markingAsReadConversations&&this.__clearOptimisticStatus(u._markingAsReadConversations)}else if(a===qo.GROUP_REPLAY){var c=void 0;if(r&&(c=this.getById(r)),!c)return;this.__clearOptimisticStatus([c])}else if(a===qo.ROLE_OPT_IN||a===qo.ROLE_OPT_OUT){var l=this.host.roles._roleConversations[s];if(!l)return;this.__clearOptimisticStatus(l)}},t.prototype.reactToProcessingStop=function(e){var t=e.data,n=(t=Rs(t)).action_type,r=t.conversation_id,o=t.entity,i=t.organization_id;!r&&o.conversation_id&&(r=o.conversation_id,delete o.conversation_id),!i&&o.organization_key&&(i=o.organization_key,delete o.organization_key);var s=o.token||o.id,a=qo.resolve(n);if(a===qo.GROUP_REPLAY){var u=void 0;if(r&&(u=this.getById(r)),!u)return;this.clearTimeline(u),this.__clearOptimisticStatus([u])}else if(a===qo.ROLE_OPT_IN||a===qo.ROLE_OPT_OUT){this.clearTimelineForAllRoleConversations(a,s);var c=this.host.roles._roleConversations[s];if(!c)return void this.host.products._removeProcessingEvent({actionType:a,entity:aa({id:s},o)});this.__clearOptimisticStatus(c)}else if(a===qo.ORGANIZATION_MESSAGE_STATUS)this.clearMessageStatusesForOrganization(i);else if(a===qo.CONVERSATION_MESSAGE_STATUS){u=void 0;if(r&&(u=this.getById(r)),!u)return;this.clearMessageStatuses(u)}if(a===qo.ORGANIZATION_MESSAGE_STATUS||a===qo.ORGANIZATION_REPLAY){var l=this.host.organizations.getById(i);if(!l)return;l._markingAsReadConversations&&this.__clearOptimisticStatus(l._markingAsReadConversations)}this.host.products._removeProcessingEvent({actionType:a,entity:aa({id:s},o)})},t.prototype.__clearOptimisticStatus=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];r._markingAsRead&&(r._markingAsRead=!1,r._markingAsReadSortNumber=null,r._markingAsReadExpiration=null,this.host.models.Conversation.inject(r))}},t.prototype.clearTimelineForAllRoleConversations=function(e,t){var n;if(n=e===qo.ROLE_OPT_OUT?this._roleConversationsProcessingEvent[t]:this.host.roles._roleConversations[t])for(var r=0,o=n;r<o.length;r++){var i=o[r];this.clearTimeline(i)}},t.prototype.clearMessageStatusesForOrganization=function(e){var t=this.host.organizations.getById(e);if(t){var n=t.conversations;if(n)for(var r=0,o=n;r<o.length;r++){var i=o[r];this.clearMessageStatuses(i)}}},t.prototype.clearMessageStatuses=function(e,t){for(var n=this,r=(void 0===t?{}:t).emit,o=void 0===r||r,i=e.timeline,s=0,a=i;s<a.length;s++){var u=a[s];u.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(u)}return setTimeout((function(){for(var e=0,t=i;e<t.length;e++){var r=t[e];if(!n.host.messages._pendingFindRecipientStatuses)return;var o=n.host.messages._pendingFindRecipientStatuses[r.id];o&&o()}}),0),o&&this.emit("clearMessageStatuses",i),i.length},t.prototype.mute=function(e,t){return ca(this,void 0,void 0,(function(){return la(this,(function(n){switch(n.label){case 0:return[4,this.host.mute.muteConversation(e,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.unmute=function(e){return ca(this,void 0,void 0,(function(){return la(this,(function(t){switch(t.label){case 0:return[4,this.host.mute.unmuteConversation(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.unmuteAll=function(){return ca(this,void 0,void 0,(function(){return la(this,(function(e){switch(e.label){case 0:return[4,this.host.mute.unmuteAll()];case 1:return e.sent(),[2]}}))}))},ua([Object(zi.decorator)()],t.prototype,"findAll",null),ua([Object(zi.decorator)()],t.prototype,"add",null),ua([Object(zi.decorator)()],t.prototype,"remove",null),t}(Bs),Ea=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Aa=function(){return(Aa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ca=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ra=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Pa=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Sa=["display_name"].join(","),ja=["name"].join(","),Ma=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ea(t,e),t.prototype.mounted=function(){this._fetched=!1},t.prototype.dispose=function(){this._fetched=!1},t.prototype.addMembers=function(e){var t=e.id,n=e.members,r=e.organizationId;return Ra(this,void 0,void 0,(function(){return Pa(this,(function(e){switch(e.label){case 0:if(!t)throw new q("id","required");if(!Array.isArray(n))throw new q("members","required","members must be an array");if(!r)throw new q("organizationId","required");return[4,this.host.api.distributionLists.membersBatch({id:t,members:n,operation:"add",organizationId:r})];case 1:return e.sent(),[2]}}))}))},t.prototype.batchDelete=function(e){var t=e.ids,n=e.organizationId;return Ra(this,void 0,void 0,(function(){var e=this;return Pa(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))throw new q("ids","required","ids must be an array");if(!n)throw new q("organizationId","required");return[4,this.host.api.distributionLists.batch({ids:t,operation:"destroy",organizationId:n})];case 1:return r.sent(),[2,t.map((function(t){return e.host.models.DistributionList.inject({$deleted:!0,id:t})}))]}}))}))},t.prototype.create=function(e){var t=e.adminOnly,n=e.members,r=e.name,o=e.network,i=void 0===o?"patient":o,s=e.organizationId;return Ra(this,void 0,void 0,(function(){var e;return Pa(this,(function(o){switch(o.label){case 0:if(this._validate({adminOnly:t,members:n,name:r,organizationId:s,shouldCheckId:!1}),!1===["patient"].includes(i))throw new q("network","invalid",'network must be "patient"');return[4,this.host.api.distributionLists.create({adminOnly:t,members:n,name:r,network:i,organizationId:s})];case 1:return e=o.sent(),[2,this.host.models.DistributionList.inject(Aa({conversationId:e.conversation_id,organizationId:e.organization_id},e.entity))]}}))}))},t.prototype.delete=function(e,t){return Ra(this,void 0,void 0,(function(){return Pa(this,(function(n){switch(n.label){case 0:return this._validate({id:e,organizationId:t,shouldCheckInvalid:!1}),[4,this.host.api.distributionLists.delete(e,t)];case 1:return n.sent(),[2,this.host.models.DistributionList.inject({$deleted:!0,id:e})]}}))}))},t.prototype.find=function(e,t){return void 0===t&&(t={}),Ra(this,void 0,void 0,(function(){var n,r;return Pa(this,(function(o){switch(o.label){case 0:return t=_.a.defaults(t,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,!t.bypassCache&&(n=this.host.models.DistributionList.get(e))?[2,n]:[4,this.host.api.distributionLists.find(e,{organizationId:t.organizationId})];case 1:if(r=o.sent())delete(n=this.config.condensedReplays||r.entity?this.host.models.DistributionList.inject(Aa({conversationId:r.conversation_id,organizationId:r.organization_id},r.entity)):this.host.models.DistributionList.inject(r)).$placeholder;else if(!t.ignoreNotFound)throw new C(this.host.models.DistributionList.name,e);return[2,n]}}))}))},t.prototype.findAll=function(){return Ra(this,void 0,void 0,(function(){var e,t,n;return Pa(this,(function(r){switch(r.label){case 0:return this._fetched?[2,this.getAll()]:0!==(e=this.host.models.Organization.getAll()).length?[3,2]:[4,this.host.organizations.findAll()];case 1:e=r.sent(),r.label=2;case 2:return[4,this.host.search.query({types:["distributionList"],organizationIds:e.map((function(e){return e.id})),query:{displayName:""},followContinuations:!0})];case 3:return t=r.sent().results,n=t.map((function(e){return e.entity})),this._fetched=!0,[2,n]}}))}))},t.prototype.getAll=function(){return this.host.models.DistributionList.getAll()},t.prototype.getById=function(e){return this.host.models.DistributionList.get(e)},t.prototype.getMultiById=function(e){return this.host.models.DistributionList.getMulti(e)},t.prototype.removeMembers=function(e){var t=e.id,n=e.members,r=e.organizationId;return Ra(this,void 0,void 0,(function(){return Pa(this,(function(e){switch(e.label){case 0:if(!t)throw new q("id","required");if(!Array.isArray(n))throw new q("members","required","members must be an array");if(!r)throw new q("organizationId","required");return[4,this.host.api.distributionLists.membersBatch({id:t,members:n,operation:"remove",organizationId:r})];case 1:return e.sent(),[2]}}))}))},t.prototype.search=function(e){var t=e.continuation,n=e.network,r=void 0===n?"patient":n,o=e.organizationId,i=e.query,s=void 0===i?"":i,a=e.sortBy,u=void 0===a?"name":a,c=e.sortOrder,l=void 0===c?"asc":c,d=e.types,h=void 0===d?[Do.PATIENT_DISTRIBUTION_LIST]:d;return Ra(this,void 0,void 0,(function(){var e,n,i,a;return Pa(this,(function(c){switch(c.label){case 0:return[4,this.host.search.query({continuation:t,network:r,organizationId:o,query:(i={},i[ja]=s,i),returnFields:[],sort:(a={},a[u]=l,a),types:h})];case 1:return e=c.sent(),n=this._processSearchResults(e.results),[2,{metadata:e.metadata,results:n}]}}))}))},t.prototype.findMembers=function(e,t){var n=void 0===t?{}:t,r=n.continuation,o=n.network,i=void 0===o?"patient":o,s=n.organizationId,a=n.query,u=void 0===a?"":a,c=n.sortBy,l=void 0===c?["display_name"]:c,d=n.sortOrder,h=void 0===d?["asc"]:d;return Ra(this,void 0,void 0,(function(){var t,n,o,a,c;return Pa(this,(function(d){switch(d.label){case 0:if(!e)throw new q("id","required");if(!s)throw new q("organizationId","required");if(l.length!==h.length)throw new q("sortBy","invalid","sortBy and sortOrder must be the same length");for(t={},n=0;n<l.length;n++)t[l[n]]=h[n];return[4,this.host.search.query({continuation:r,network:i,organizationId:s,query:(c={},c[Sa]=u,c.dist_list_token=e,c),returnFields:[],sort:t,types:[Do.DISTRIBUTION_LIST_MEMBER]})];case 1:return o=d.sent(),a=this._processSearchResults(o.results),[2,{metadata:o.metadata,results:a}]}}))}))},t.prototype.findMemberIds=function(e,t,n){var r=(void 0===n?{}:n).continuation;return Ra(this,void 0,void 0,(function(){var n,o,i,s,a;return Pa(this,(function(u){switch(u.label){case 0:if(!e)throw new q("id","required");if(!t)throw new q("organizationId","required");return[4,this.host.api.distributionLists.findMemberIds(e,t,{continuation:r})];case 1:return n=u.sent(),o=n.members,i=void 0===o?[]:o,s=n.metadata,a=i.map((function(e){return e.token})),[2,{metadata:s,results:a}]}}))}))},t.prototype.update=function(e){var t=e.adminOnly,n=e.id,r=e.name,o=e.organizationId;return Ra(this,void 0,void 0,(function(){var e;return Pa(this,(function(i){switch(i.label){case 0:return this._validate({adminOnly:t,name:r,id:n,organizationId:o}),[4,this.host.api.distributionLists.update({adminOnly:t,id:n,name:r,organizationId:o})];case 1:return e=i.sent(),[2,this.host.models.DistributionList.inject(Aa({conversationId:e.conversation_id,organizationId:e.organization_id},e.entity))]}}))}))},t.prototype._processSearchResults=function(e){return e.map((function(e){return e.entity})).filter((function(e){return!e.$deleted}))},t.prototype._validate=function(e){var t=e.adminOnly,n=e.id,r=(e.members,e.name),o=e.organizationId,i=e.shouldCheckId,s=void 0===i||i,a=e.shouldCheckInvalid,u=void 0===a||a;if(s&&!n)throw new q("id","required");if(!o)throw new q("organizationId","required");if(u){if(void 0!==t&&"boolean"!=typeof t)throw new q("adminOnly","invalid","adminOnly must be a boolean value");if(r&&(0===r.length||r.length>60))throw new q("name","invalid","name must be less than 60 alphanumeric characters")}},Ca([Object(zi.decorator)()],t.prototype,"find",null),Ca([Object(zi.decorator)()],t.prototype,"findAll",null),Ca([Object(zi.decorator)()],t.prototype,"search",null),t}(Bs),za=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ka=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Na=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},xa=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ua=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return za(t,e),t.prototype.findMulti=function(e,t){return Na(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m,b,w,I,O,T,E,A,C,R=this;return xa(this,(function(P){switch(P.label){case 0:if(!t)throw new q("organizationId","required");return e=_.a.uniq(qs(e).map(this._resolveModelId)),n=_.a.chunk(e,10),r=n.map((function(e){return R.host.api.entities.findMulti({users:e,metadata:e,organizationId:t})})),[4,Promise.all(r)];case 1:for(o=P.sent(),i={},s=0,a=o;s<a.length;s++){if(u=a[s],c=u.users,l=u.metadata,c)for(d=0,h=c;d<h.length;d++)for(p=h[d],f=0,v=Object.entries(p);f<v.length;f++)y=v[f],E=y[0],g=y[1],i[E]={entity:g};if(l)for(m=0,b=l;m<b.length;m++)for(w=b[m],I=0,O=Object.entries(w);I<O.length;I++)T=O[I],E=T[0],A=T[1],(C=i[E])&&(C.metadata=A)}return[2,Object.values(i)]}}))}))},ka([Object(zi.decorator)()],t.prototype,"findMulti",null),t}(Bs),La=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qa=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Da=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ba=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Fa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return La(t,e),t.prototype.escalateMessage=function(e){return Da(this,void 0,void 0,(function(){var t,n,r;return Ba(this,(function(o){switch(o.label){case 0:if(!(t=this._resolveEntity(e,"message")))throw new C(this.host.models.Message.name,e);return[4,this.host.api.escalations.escalateMessage(t.serverId)];case 1:return n=o.sent(),r=(n||{}).escalation,[2,this._updateEscalation(r)]}}))}))},t.prototype.acknowledge=function(e){return Da(this,void 0,void 0,(function(){var t,n,r,o,i,s,a;return Ba(this,(function(u){switch(u.label){case 0:if(!(t=this._resolveEntity(e,"escalationExecution")))throw new C(this.host.models.EscalationExecution.name,e);return e=t.id,n=t.originalMessageId,r=this.host,o=r.currentUser,i=r.currentUserId,(s=o.roles.map((function(e){return e.botUserId}))).push(i),[4,this.host.api.escalations.acknowledge(e,{messageId:n,userTokens:s})];case 1:return a=u.sent(),[2,this.host.models.EscalationExecution.inject(a)]}}))}))},t.prototype.cancel=function(e){return Da(this,void 0,void 0,(function(){var t,n;return Ba(this,(function(r){switch(r.label){case 0:if(!(t=this._resolveEntity(e,"escalationExecution")))throw new C(this.host.models.EscalationExecution.name,e);return n=t.originalMessageId,[4,this.host.api.escalations.cancel(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.ensureEscalationExecution=function(e){return Da(this,void 0,void 0,(function(){var t,n,r,o;return Ba(this,(function(i){switch(i.label){case 0:if(!(t=this._resolveEntity(e,"escalationExecution")))throw new C(this.host.models.EscalationExecution.name,e);return n=t.carbonCopyMessageId,r=t.originalMessageId,o=[],n&&o.push(n),r&&o.push(r),[4,this.host.messages.ensureRecipientStatusMulti(o)];case 1:return i.sent(),[2]}}))}))},t.prototype.skip=function(e){return Da(this,void 0,void 0,(function(){var t,n,r,o,i,s,a;return Ba(this,(function(u){switch(u.label){case 0:if(!(t=this._resolveEntity(e,"escalationExecution")))throw new C(this.host.models.EscalationExecution.name,e);return e=t.id,n=t.originalMessageId,r=this.host,o=r.currentUser,i=r.currentUserId,(s=o.roles.map((function(e){return e.botUserId}))).push(i),[4,this.host.api.escalations.skip(e,{messageId:n,userTokens:s})];case 1:return a=u.sent(),[2,this.host.models.EscalationExecution.inject(a)]}}))}))},t.prototype.removeEscalationGroup=function(e){return Da(this,void 0,void 0,(function(){var t,n;return Ba(this,(function(r){switch(r.label){case 0:if(!(t=this._resolveEntity(e,"escalationExecution")))throw new C(this.host.models.EscalationExecution.name,e);return n=t.groupId,[4,this.host.api.groups.destroy(n)];case 1:if(!r.sent())throw new C(this.host.models.Group.name,n);return[2]}}))}))},t.prototype.reactToEscalationsEvent=function(e){var t=e.data;this._updateEscalation(t.escalation)},t.prototype._updateEscalation=function(e,t){var n=(void 0===t?{}:t).inGroupInject,r=void 0!==n&&n,o={};e&&e.display_name&&(o=this.host.models.EscalationExecution.inject(e));var i=o.id,s=o.carbonCopyMessage,a=o.groupId,u=o.organizationId,c=o.originalMessage;return c&&this.host.models.Message.inject({escalationExecutionId:i,id:c.id}),s&&this.host.models.Message.inject({escalationExecutionId:i,id:s.id}),a&&!r&&this.host.models.Group.inject({id:a,escalationExecutionId:i,organizationId:u}),o},t.prototype.getAll=function(){return this.host.models.EscalationExecution.getAll()},t.prototype.getById=function(e){return this.host.models.EscalationExecution.get(e)},qa([Object(zi.decorator)()],t.prototype,"escalateMessage",null),qa([Object(zi.decorator)()],t.prototype,"acknowledge",null),qa([Object(zi.decorator)()],t.prototype,"cancel",null),qa([Object(zi.decorator)()],t.prototype,"skip",null),qa([Object(zi.decorator)()],t.prototype,"removeEscalationGroup",null),t}(Bs),Ga=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Va=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ka=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Ha=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.EVENTS={bang:function(e){this.host.groups.reactToBangEvent(e)},client_advisory:function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}},escalations:function(e){this.host.escalations.reactToEscalationsEvent(e)},friends:function(e){this.host.conversations.reactToFriendsEvent(e)},"message|group_message":function(e){this.host.conversations.reactToMessageEvent(e)},"message:status|group:message:status":function(e){this.host.messages.reactToMessageStatusEvent(e)},user_preferences:function(e){this.host.users.reactToUserPreferencesEvent(e)},org_preferences:function(e){this.host.organizations.reactToOrganizationPreferencesEvent(e)},presence:function(e){this.host.presence.reactToPresenceEvent(e)},update:function(e){this.host.conversations.reactToUpdateEvent(e)},"update:tag":function(e){this.host.roleTags.reactToUpdateEvent(e)},"update:team_request":function(e){this.host.conversations.reactToUpdateTeamRequestEvent(e)},"account:settings":function(e){var t=this;e.data.services.forEach((function(n){switch(n.xmlns){case"tigertext:iq:update:account":var r=n.account||e.data.token;t.host.users.refresh(r);break;case"tigertext:iq:update:org_settings":t.host.organizations.refreshAll();break;default:t.logger.warn("unhandled account:settings service type "+n.xmlns)}}))},"message:is_typing":function(e){this.host.typingStatus.reactToIsTypingEvent(e)},"processing:start":function(e){this.host.conversations.reactToProcessingStart(e)},"processing:stop":function(e){this.host.conversations.reactToProcessingStop(e)},remote_wipe:function(e){return Va(this,void 0,void 0,(function(){return Ka(this,(function(e){switch(e.label){case 0:return this.host.notifications.disconnect({source:"remote_wipe event"}),[4,this.host.notifications.signOut({fromServer:!0})];case 1:return e.sent(),this.host.signOut({fromServer:!0}),[2]}}))}))},validated:function(e){this.logger.warn("validated not implemented")},"msg:metadata_update":function(e){this.logger.warn("msg:metadata_update not implemented")},conversation_mute:function(e){this.host.mute.reactToMuteEvent(e)},reconnect:function(e){this.host.events.reconnect()},"vwr:joinablecall":function(e){this.host.virtualWaitingRooms.reactToJoinableCallSSE(e)},"voip:incoming|voip:ended|voip:answered|voip:state":function(e){this.host.calls.reactToVoipSSE(e)},"push:credentials":function(){return null},"sse:heartbeat":function(){return null},"sse:keepalive":function(){return null}};for(var o=0,i=Object.entries(r.EVENTS);o<i.length;o++){var s=i[o],a=s[0],u=s[1];if(a.includes("|")){for(var c=0,l=a.split("|");c<l.length;c++){var d=l[c];r.EVENTS[d]=u}delete r.EVENTS[a]}}return r}return Ga(t,e),t.prototype.emit=function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.info("unhandled event: "+e.type,e.data)},t}(Bs),$a=n(11),Wa=n.n($a),Xa=function(){function e(e,t,n){this.id=e,this.type=t,this.data=n}return e.is=function(e){return e instanceof this},e}(),Qa=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ya=function(){return(Ya=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ja=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Za=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},eu=["message:is_typing","presence","remote_wipe","sse:heartbeat"],tu=["message:is_typing","presence","sse:heartbeat"],nu=["00000000-0000-0000-0000-000000000001"],ru=["remote_wipe"],ou={autoDeliver:"auto-deliver",canConfirm:"can-confirm",closeAfterMessages:"close-after-messages",heartbeat:"heartbeat_5",hidden:"hidden",includeDistributionListEvents:"dl_sender_event",isTyping:"is-typing",keepAlive:"keep_alive_15_1",msgDeliveryDelay:"msg_delivery_delay",multiOrg:"multi-org",noOfflineMessages:"no-offline-messages",renderMetadata:"render_metadata",singleConversation:"single_conversation"},iu={events:{allowManualRequestBatch:!0,basicAuthParam:"auth_basic",features:null,requiresBasicAuth:!1,routerName:"eventRouter",url:"/events"},simpleNotifications:{allowManualRequestBatch:!1,basicAuthParam:"auth",features:{heartbeat:!0},requiresBasicAuth:!0,routerName:"notificationRouter",url:"/events/simple_notifications"}},su=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.onNetworkStatusChanged=function(e){var t=e.networkStatus,n=e.previousStatus;if(r.__allEvents.push({networkStatusChange:{previousStatus:n,networkStatus:t,timestamp:new Date}}),t===Si.CONNECTING){if(r._reconnectIfHeartbeatIntervalPassed()&&r.eventSource)return;r._connectionRetryCount=1,r._disconnectAndRetry()}else t===Si.OFFLINE&&(r._connectionRetryCount=0,r.disconnect({unwatchNetwork:!1,source:"Network went offline"}))},r._closeAllConnections=function(){return Ja(r,void 0,void 0,(function(){var e,t,n;return Za(this,(function(r){switch(r.label){case 0:if(this.eventSource)throw new Error("Existing connections must be closed first");if("simpleNotifications"!==this.endpointType)return[3,2];if(e=this._auth,t=e.key,n=e.secret,!t||!n)throw new N;return[4,this.host.api.notifications.closeAllConnections(t,n)];case 1:return r.sent(),[3,4];case 2:return[4,this.host.api.events.closeAllConnections()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},r._processImmediateEvent=function(e,t){return Ja(r,void 0,void 0,(function(){return Za(this,(function(n){switch(n.label){case 0:return this._eventQueue=[t],this._eventQueueDeferred=!1,this._autoAck?[4,this.ack([e])]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.processEventQueue(),[2]}}))}))},r._scheduleEventQueue=function(e){var t=(void 0===e?{}:e).immediate,n=void 0!==t&&t;if(r.allowManualRequestBatch&&r.config.manuallyRequestEventQueueBatch&&(r._eventQueueIsManual=!0),n&&(clearTimeout(r._eventQueueTimeout),r._eventQueueTimeout=null),null===r._eventQueueTimeout){var o=r.config.eventCollectionInterval;if(n||null===o)r._eventQueueIsManual?r._emitBatch({immediate:n}):r.processEventQueue(r._eventQueue.length);else{var i=r._eventQueueIsManual?r._emitBatch:r.processEventQueue;r._eventQueueTimeout=setTimeout(i,o)}}},r._emitBatch=function(e){var t=(void 0===e?{}:e).immediate,n=void 0!==t&&t;r._eventQueueTimeout=null,r.emit("batch:available",{maxEventBatch:r._eventQueue.length,immediate:n})},r.deferEventQueue=function(){r._eventQueueDeferred=!0,r._eventQueueTimeout&&(clearTimeout(r._eventQueueTimeout),r._eventQueueTimeout=null)},r.resumeEventQueue=function(){r._eventQueueDeferred=!1,r._eventQueueTimeout&&(clearTimeout(r._eventQueueTimeout),r._eventQueueTimeout=null),r._eventQueue.length>0&&r._scheduleEventQueue()},r.processEventQueue=function(e){var t,n,o;if(void 0===e&&(e=r.config.maxEventBatch),r._eventQueueIsManual||(r._eventQueueTimeout=null),!r._eventQueueDeferred&&0!==r._eventQueue.length)try{for(var i=r._eventQueue.splice(0,e),s=0,a=i;s<a.length;s++)t=a[s],n=!1,o=JSON.parse(t),n=!0,r._handleEvent(o);r._eventQueue.length>0?r._scheduleEventQueue():r._reconnectWhenQueuesAreEmpty&&0===r._queuedAcks.length&&0===r._pendingAckConnections&&r._scheduleConnectRetry()}catch(e){n?(r.logger.error("error while processing SSE payload",e,e.stack,{data:o}),r.disconnect({isRecoverable:!1,source:"Error processing SSE payload"})):(r.logger.error("error parsing SSE payload: <"+t+">"),r._disconnectAndRetry())}},r._flushQueuedAcks=function(){return Ja(r,void 0,void 0,(function(){var e,t;return Za(this,(function(n){switch(n.label){case 0:return 0===this._queuedAcks.length?[2]:this._pendingAckConnections>=this.config.flushAckMaxConnections?(this._throttled_flushQueuedAcks(),[2]):(e=this._queuedAcks.splice(0,this.config.flushAckMaxEvents),t=this.ack(e),this._queuedAcks.length>0?(this._throttled_flushQueuedAcks(),[3,5]):[3,1]);case 1:return n.trys.push([1,3,,4]),[4,t];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:this._reconnectWhenQueuesAreEmpty&&0===this._eventQueue.length&&0===this._pendingAckConnections&&this._scheduleConnectRetry(),n.label=5;case 5:return[2]}}))}))},r._onVisibilityChange=function(e,t){t=t.toUpperCase();var n=r._visibilityState;r._visibilityState=t,r.isConnected&&(r.__allEvents.push({visibilityChange:{previousState:n,state:t,timestamp:new Date}}),t===Fo.HIDDEN?(r.host.configure({eventCollectionInterval:null}),r._setHeartbeatTimeout(r.config.eventsHeartbeatIntervalInvisible)):t===Fo.VISIBLE&&(r.host.configure({eventCollectionInterval:co.eventCollectionInterval}),r._setHeartbeatTimeout(r.config.eventsHeartbeatIntervalVisible))),n===Fo.HIDDEN&&t===Fo.VISIBLE&&r.httpClient.networkStatus===Si.CONNECTING&&r._reconnectIfHeartbeatIntervalPassed(),r.emit("visibilityChange",e,t)},r._reconnectIfHeartbeatIntervalPassed=function(){return null!==r._lastHeartbeatTime&&(Date.now()-r._lastHeartbeatTime>=r._heartbeatInterval&&(r._lastHeartbeatTime=null,r.reconnect(),!0))},r.endpointType||(r.endpointType="events");for(var o=0,i=Object.entries(iu[r.endpointType]);o<i.length;o++){var s=i[o],a=s[0],u=s[1];"url"!==a&&(r[a]=u)}return r}return Qa(t,e),t.prototype.mounted=function(){this._throttled_flushQueuedAcks=Wa()(this._flushQueuedAcks,this.config.flushAckInterval,{leading:!1}),this.__allEvents=[],this._connectionRetryCount=0,this._eventQueue=[],this._eventQueueDeferred=!1,this._eventQueueIsManual=!1,this._eventQueueTimeout=null,this._heartbeatInterval=this.config.eventsHeartbeatIntervalVisible,this._heartbeatTimeout=null,this._lastHeartbeatTime=null,this._openTimeout=null,this._pendingAckConnections=0,this._processedEventIds={},this._queuedAcks=[],this._reconnectWhenQueuesAreEmpty=!1,this._reconnectWhenQueuesAreEmpty=!1,this._retryHistoryTimeout=null,this._visibilityState=Fo.VISIBLE,this.isConnected=!1,this.isOpen=!1},t.prototype.dispose=function(){this._throttled_flushQueuedAcks.cancel&&this._throttled_flushQueuedAcks.cancel(),this.disconnect({source:"EventsService cleanup"})},Object.defineProperty(t.prototype,"_autoAck",{get:function(){return"events"===this.endpointType&&this.config.autoAckSuccessfullyHandledEvents},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasConnection",{get:function(){return!!this.eventSource},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return!!this._auth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"router",{get:function(){return this.host[this.routerName]},enumerable:!1,configurable:!0}),t.prototype.setAuth=function(e){this._auth=Ya({basicAuthParam:this.basicAuthParam},e)},t.prototype.removeAuth=function(){this._auth=null},t.prototype.getAuth=function(){return this._auth},t.prototype.connect=function(){var e=this;if(!this.isSignedIn)throw this._cancelSessionTimers({source:"Connection attempt while not signed in"}),new P;if(this.requiresBasicAuth&&(!this._auth.key||!this._auth.secret))throw this._cancelSessionTimers({source:"Connection attempt without valid authorization"}),new N;if(this.eventSource)throw new Error("Already connected to EventSource");for(var t=[],n=0,r=Object.entries(this.features||this.config.events);n<r.length;n++){var o=r[n],i=o[0],s=o[1];if(s||0===s){var a=ou[i],u=!0===s?a:a+":"+s;t.push(u)}}var c=t.join(",");this.logger.info("connecting "+this.endpointType+". networkStatus="+this.httpClient.networkStatus+" features="+c);var l,d=!this._watchingNetworkConnection;if(this.httpClient.networkStatus!==Si.OFFLINE&&d&&this.httpClient._setNetworkStatus(Si.CONNECTING),this._watchNetworkConnection(),this.httpClient.networkStatus===Si.OFFLINE)throw new Error("Cannot connect while network is offline, but will autoconnect when online");this._isClosed=!1,this._isHeartbeatTimeout=!1,this._reconnectWhenQueuesAreEmpty=!1,this._requestedClose=!1;var h=!1,p=!1;this._openTimeout=setTimeout((function(){e._openTimeout=null,p=!0,l.close()}),this.config.eventsOpenTimeout),this.eventSource=l=this.host.eventSourceClient.createEventSource(this.url,{auth:this._auth,features:c,onOpen:function(){e.logger.info("open"),e._cancelSessionTimers({source:"Event source opened"}),e._setHeartbeatTimeout(),h=!0,e.isOpen=!0,e.emit("opened")},onMessage:function(t,n){var r=n.isFirstMessage;e._setHeartbeatTimeout(),r&&(e._setRetryHistoryTimeout(),e.isConnected=!0,e.emit("connected")),e._queueEvent(t)},onError:function(t){var n=!!t&&e.httpClient.isUnauthorizedError(t),r=e._isHeartbeatTimeout,o=e.httpClient.networkStatus,i=e._requestedClose;r?t=new Error("No activity within "+e._heartbeatInterval+" milliseconds; reconnecting"):p&&(t=new Error("Open timed out after "+e.config.eventsOpenTimeout+" milliseconds; reconnecting")),e.logger.info("error",t,t.message||"",t.code||"",void 0!==t.status?t.status:""),e.__allEvents.push({clientDisconnect:{error:{code:t.code,message:t.message,status:t.status},hasConnected:h,isHeartbeatTimeout:r,isUnauthorized:n,networkStatus:o,openTimedOut:p,requestedClose:i,timestamp:new Date}}),i||(n?e.disconnect({isRecoverable:!1,source:"Unauthorized during eventSource error handling"}):o!==Si.OFFLINE&&(h||0!==e._connectionRetryCount||(e._connectionRetryCount=1),e._disconnectAndRetry()))}}),this.eventSource.start()},t.prototype._scheduleConnectRetry=function(){var e=this;this._cancelSessionTimers({source:"Scheduling connection retry"}),this.logger.info("scheduleConnectRetry",this._connectionRetryCount);var t=Math.min(this.config.eventsAutoReconnectDelay*this._connectionRetryCount,this.config.eventsAutoReconnectMaxDelay);this._scheduleConnectRetryTimeout=setTimeout((function(){return e.connect()}),t),this._connectionRetryCount++},t.prototype._watchNetworkConnection=function(){this._watchingNetworkConnection||(this._watchingNetworkConnection=!0,this.host.on("networkStatus:change",this.onNetworkStatusChanged))},t.prototype._unwatchNetworkConnection=function(){this._watchingNetworkConnection&&(this.host.removeListener("networkStatus:change",this.onNetworkStatusChanged),this._watchingNetworkConnection=!1)},t.prototype._cancelSessionTimers=function(e){var t=(void 0===e?{}:e).source;this._heartbeatTimeout&&(clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=null),this._openTimeout&&(clearTimeout(this._openTimeout),this._openTimeout=null),this._scheduleConnectRetryTimeout&&(this.__allEvents.push({cancelSessionTimer:{source:t,timestamp:new Date}}),clearTimeout(this._scheduleConnectRetryTimeout),this._scheduleConnectRetryTimeout=null),null!==this._eventQueueTimeout&&(clearTimeout(this._eventQueueTimeout),this._eventQueueTimeout=null)},t.prototype._setHeartbeatTimeout=function(e){var t=this;this._heartbeatTimeout&&clearTimeout(this._heartbeatTimeout),void 0!==e&&(this._heartbeatInterval=e),this._heartbeatTimeout=setTimeout((function(){t._heartbeatTimeout=null,t._isHeartbeatTimeout=!0,0===t._connectionRetryCount&&(t._connectionRetryCount=1),t._disconnectAndRetry()}),this._heartbeatInterval)},t.prototype._cancelRetryHistoryTimeout=function(){this._retryHistoryTimeout&&(clearTimeout(this._retryHistoryTimeout),this._retryHistoryTimeout=null)},t.prototype._setRetryHistoryTimeout=function(){var e=this;this._retryHistoryTimeout&&clearTimeout(this._retryHistoryTimeout),this._retryHistoryTimeout=setTimeout((function(){e._retryHistoryTimeout=null,e._connectionRetryCount=0}),this.config.eventsClearRetryHistoryInterval)},t.prototype.reconnect=function(){this._connectionRetryCount=0,this.disconnect({unwatchNetwork:!1,source:"Reconnect"}),this.connect()},t.prototype._disconnectAndRetry=function(){var e=this;this.__allEvents.push({eventsDisconnectAndRetry:{eventQueueLength:this._eventQueue.length,pendingAckConnections:this._pendingAckConnections,queuedAcksLength:this._queuedAcks.length,connectionRetryCount:this._connectionRetryCount,timestamp:new Date}}),this.disconnect({clearQueues:!1,unwatchNetwork:!1,source:"Disconnect and retry"}),this.config.eventsAutoReconnect&&(this._reconnectWhenQueuesAreEmpty=!0),this.config.eventsAutoReconnect&&0===this._eventQueue.length&&0===this._pendingAckConnections&&0===this._queuedAcks.length?this._scheduleConnectRetry():this.config.eventsAutoReconnect&&(this._scheduleConnectRetryTimeout=setTimeout((function(){return e.connect()}),this.config.eventDrainTimeout)),this._eventQueue.length>0&&this._scheduleEventQueue({immediate:!0}),(this._pendingAckConnections>0||this._queuedAcks.length>0)&&this._flushQueuedAcks()},t.prototype.disconnect=function(e){var t=void 0===e?{}:e,n=t.clearQueues,r=void 0===n||n,o=t.isRecoverable,i=void 0===o||o,s=t.unwatchNetwork,a=void 0===s||s,u=t.source;if(this.__allEvents.push({eventsDisconnect:{clearQueues:r,source:u,unwatchNetwork:a}}),this._cancelSessionTimers({source:"Disconnect"}),this._cancelRetryHistoryTimeout(),a&&this._unwatchNetworkConnection(),this.eventSource){var c=this.eventSource;this.eventSource=null,this._requestedClose=!0,this._isClosed||(this._isClosed=!0,c.close()),this.emit("disconnected",{isRecoverable:i})}this.isConnected=!1,this.isOpen=!1,r&&(this._eventQueue=[],this._queuedAcks=[])},t.prototype._queueEvent=function(e){var t=e.data;if(t){if(ru.some((function(e){return t.includes(e)}))){var n=void 0;try{n=JSON.parse(t)}catch(e){return this.logger.error("error parsing SSE payload: <"+t+">"),void this._disconnectAndRetry()}var r=Object.keys(n.event)[0].replace("tigertext:iq:","");if(ru.includes(r)){this.disconnect({source:"Immediate event "+r});var o=n.event_id;return void this._processImmediateEvent(o,t)}}this._eventQueue.push(t),this._scheduleEventQueue()}},t.prototype._handleEvent=function(e){var t=e.event_id;if(this._autoAck||!this._processedEventIds[t]||nu.includes(t)){var n=Object.keys(e.event)[0],r=n.replace("tigertext:iq:",""),o=e.event[n];!this.config.eventsDebugging&&tu.includes(r)||this.__allEvents.push(e),"sse:heartbeat"===r&&(this._lastHeartbeatTime=Date.now()),this.logger.debug("incoming",r,o);var i=new Xa(t,r,o);try{this.router.emit(i),this.emit("event",i),this._autoAck?eu.includes(r)||this.__queueAck(t):this._processedEventIds[t]=!0}catch(e){this.logger.error("error in event "+r,e,e.stack,{data:o}),this.disconnect({isRecoverable:!1,source:"Error in event "+r})}}},t.prototype.__queueAck=function(e){var t;e=qs(e),(t=this._queuedAcks).push.apply(t,e),this._throttled_flushQueuedAcks()},t.prototype.ack=function(e){return Ja(this,void 0,void 0,(function(){var t,n;return Za(this,(function(r){switch(r.label){case 0:this.host.requireUser(),t=!1,e=qs(e),this.logger.log("ack",e),this._pendingAckConnections++,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.host.api.events.ack(e)];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),t=this.httpClient.isUnauthorizedError(n),this.logger.warn("some events not acked",e),[3,4];case 4:return this._pendingAckConnections--,t&&(this.logger.warn("no longer authorized, terminating session"),this.disconnect({isRecoverable:!1,source:"Unauthorized during ack"})),[2]}}))}))},Object.defineProperty(t.prototype,"url",{get:function(){var e=iu[this.endpointType].url;return"/"+("events"===this.endpointType&&this.config.condensedReplays?"v5":"v2")+e},enumerable:!1,configurable:!0}),t}(Bs),au=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),uu=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},cu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},lu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},du=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},hu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return au(t,e),t.prototype.mounted=function(){this._fetched=!1},t.prototype.dispose=function(){this._fetched=!1},t.prototype.create=function(e){var t=e.avatarFile,n=e.description,r=e.memberIds,o=void 0===r?[]:r,i=e.metadata,s=e.name,a=e.organizationId,u=e.replayHistory,c=void 0===u||u,l=e.senderId,d=void 0===l?this.host.currentUserId:l;return cu(this,void 0,void 0,(function(){var e,r,u,l,h=this;return lu(this,(function(p){switch(p.label){case 0:if(this.host.requireUser(),!a)throw new q("organizationId","required");return[4,Promise.all(du([d],o).map(this.host.roles.__resolveRoleId).filter(Boolean).map((function(e){return h._resolveModelIdWithTypes(e,"user")})).map((function(e){return h.host.users.findOrCreate(e,{organizationId:a})})))];case 1:return e=p.sent(),r=ta.a.call(e),o=r.map((function(e){return h._resolveModelIdWithTypes(e,"user")})),[4,this.host.api.groups.create({avatarFile:t,description:n,excludeCreator:!1,isPublic:!0,memberIds:o,metadata:i,name:s,organizationId:a,replayHistory:c})];case 2:return u=p.sent(),l=this.config.condensedReplays&&u.entity?this.host.conversations.__injectCounterParty({conversationId:u.conversation_id,entityAttrs:u.entity,entityType:"group",hasCurrentUser:!0,organizationId:u.organization_id}):this.host.models.Group.inject(u),i&&this.host.metadata.__injectMetadata(l.id,a,i),[2,l]}}))}))},t.prototype.find=function(e,t){return void 0===t&&(t={}),cu(this,void 0,void 0,(function(){var n,r;return lu(this,(function(o){switch(o.label){case 0:return t=_.a.defaults(t,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=null,t.bypassCache?[3,2]:!(n=this.host.models.Group.get(e))||n.$placeholder?[3,2]:[4,this.host.groups.__ensureEntitiesLoaded(n.id,t)];case 1:return o.sent(),[2,n];case 2:return[4,this.host.groups.__find(e)];case 3:if(r=o.sent(),n=this.host.models.Group.get(e),!r){if(!t.ignoreNotFound)throw new C(this.host.models.Group.name,e);return[2,n]}return n?[4,this.host.groups.__ensureEntitiesLoaded(n.id,t)]:[3,5];case 4:o.sent(),o.label=5;case 5:return[2,n]}}))}))},t.prototype.findAll=function(e){var t=(void 0===e?{}:e).bypassCache,n=void 0!==t&&t;return cu(this,void 0,void 0,(function(){var e,t,r;return lu(this,(function(o){switch(o.label){case 0:return!n&&this._fetched?[2,this.getAll()]:0!==(e=this.host.models.Organization.getAll()).length?[3,2]:[4,this.host.organizations.findAll()];case 1:e=o.sent(),o.label=2;case 2:return[4,this.host.search.query({types:["forum"],organizationIds:e.map((function(e){return e.id})),query:{displayName:""},followContinuations:!0})];case 3:return t=o.sent().results,r=t.map((function(e){return e.entity})),this._fetched=!0,[2,r]}}))}))},t.prototype.getAll=function(){return this.host.models.Group.getAll().filter((function(e){return e.isPublic}))},t.prototype.getById=function(e){return this.host.models.Group.get(e)},t.prototype.join=function(e){return cu(this,void 0,void 0,(function(){return lu(this,(function(t){return[2,this.host.groups.addMembers(e,[this.host.currentUserId])]}))}))},uu([Object(zi.decorator)()],t.prototype,"find",null),uu([Object(zi.decorator)()],t.prototype,"findAll",null),t}(Bs),pu=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fu=function(){return(fu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},vu=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},yu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},gu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},mu=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},_u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._setP2PEntities=function(e){var n=e.createdByRole,r=e.createdByUser,o=e.groupType,i=e.targetUser,s=e.targetRole,a=t.host.currentUser;if(a&&o===Ao.ROLE_P2P){var u=a.roles,c=[],l=[];n?l.push(n):r&&r!==a&&c.push(r),s?l.push(s):i&&i!==a&&c.push(i);var d=null,h=null;1===l.length?r===a||i===a?u.includes(l[0])?(d=a,h=l[0]):(d=l[0],h=a):(d=c[0],h=l[0]):2===l.length&&(u.includes(l[0])?(d=l[1],h=l[0]):u.includes(l[1])&&(d=l[0],h=l[1])),e.p2pRecipient=d,e.p2pSender=h}},t._onChangeConversation=function(e,n){var r=n.counterPartyId;if("group"===n.counterPartyType){var o=t.host.models.Group.get(r);o&&(o.conversation||t.host.models.Group.inject(o))}},t._onRemoveConversation=function(e,n){var r=n.counterPartyId;if("group"===n.counterPartyType){var o=t.host.models.Group.get(r);o&&o.conversation&&t.host.models.Group.inject(o)}},t._onChangeGroup=function(e,n){var r=n.id,o=n.memberIds,i=t._groupMemberIds[r];if(i)for(var s=0,a=i;s<a.length;s++){var u=a[s],c=(h=t._userGroups[u])?h.indexOf(n):-1;c>-1&&o&&!o.includes(u)&&h.splice(c,1)}if(o){t._groupMemberIds[r]=o;for(var l=0,d=o;l<d.length;l++){var h;u=d[l];(h=t._userGroups[u]||[]).includes(n)||h.push(n),t._userGroups[u]=h}}},t._onRemoveGroup=function(e,n){var r=n.id,o=n.memberIds;if(delete t._groupMemberIds[r],o)for(var i=0,s=o;i<s.length;i++){var a=s[i],u=t._userGroups[a],c=u?u.indexOf(n):-1;c>-1&&u.splice(c,1)}},t._onChangeMetadata=function(e,n){var r=n.entityId,o=t.host.models.Group.get(r);o&&t.host.models.Group.inject(o)},t._onChangeUser=function(e,n){var r=n.botRole,o=n.id,i=n.isRoleBot,s=t._userGroups[o],a=t._userState[o],u=a&&(a.botRole!==r||a.isRoleBot!==i);if(a&&!u||(t._userState[o]={botRole:r,isRoleBot:i}),s)for(var c=0,l=s;c<l.length;c++){var d=l[c],h=d.conversation,p=d.groupType,f=d.members;p!==Ao.ROLE_P2P&&!u&&f&&f.includes(n)||(t.host.models.Group.inject(d),h&&t.host.models.Conversation.inject(h))}},t._onRemoveUser=function(e,n){var r=n.id,o=t._userGroups[r];if(o&&o.length>0)for(var i=0,s=o;i<s.length;i++){var a=s[i],u=a.members;u&&u.includes(n)&&t.host.models.Group.inject(a)}delete t._userGroups[r],delete t._userState[r]},t}return pu(t,e),t.prototype.mounted=function(){this._fetched=!1,this._groupMemberIds={},this._userGroups={},this._userState={},this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onRemoveConversation),this.host.models.Group.on("afterInject",this._onChangeGroup),this.host.models.Group.on("afterEject",this._onRemoveGroup),this.host.models.Metadata.on("afterInject",this._onChangeMetadata),this.host.models.Metadata.on("afterEject",this._onChangeMetadata),this.host.models.User.on("afterInject",this._onChangeUser),this.host.models.User.on("afterEject",this._onRemoveUser)},t.prototype.dispose=function(){this._fetched=!1,this._groupMemberIds={},this._userGroups={},this._userState={},this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onRemoveConversation),this.host.models.Group.removeListener("afterInject",this._onChangeGroup),this.host.models.Group.removeListener("afterEject",this._onRemoveGroup),this.host.models.Metadata.removeListener("afterInject",this._onChangeMetadata),this.host.models.Metadata.removeListener("afterEject",this._onChangeMetadata),this.host.models.User.removeListener("afterInject",this._onChangeUser),this.host.models.User.removeListener("afterEject",this._onRemoveUser)},t.prototype.create=function(e){var t=e.avatarFile,n=e.description,r=e.isPatientGroup,o=void 0!==r&&r,i=e.isTeamActivation,s=void 0!==i&&i,a=e.memberIds,u=void 0===a?[]:a,c=e.metadata,l=e.name,d=e.organizationId,h=e.replayHistory,p=void 0!==h&&h,f=e.senderId,v=void 0===f?this.host.currentUserId:f;return yu(this,void 0,void 0,(function(){var e,r,i,a,h,f=this;return gu(this,(function(y){switch(y.label){case 0:if(this.host.requireUser(),!d)throw new q("organizationId","required");return[4,Promise.all(mu([v],u).map(this.host.roles.__resolveRoleId).filter(Boolean).map((function(e){return f._resolveModelIdWithTypes(e,["user","team"])})).map((function(e){var t=f._resolveEntity(e);return"team"===Object(m.get)(t,"$entityType")?t:f.host.users.findOrCreate(e,{organizationId:d})})))];case 1:return e=y.sent(),r=ta.a.call(e),u=r.map((function(e){return f._resolveModelIdWithTypes(e,["user","team"])})),i=this._shouldExcludeSender(d,u,v),l||o||s||(l=this._getGroupName(r)),[4,this.host.api.groups.create({avatarFile:t,description:n,excludeCreator:i,memberIds:u,metadata:c,name:l,organizationId:d,replayHistory:p})];case 2:return a=y.sent(),this.config.condensedReplays&&a.entity?(h=this.host.conversations.__injectCounterParty({conversationId:a.conversation_id,entityAttrs:a.entity,entityType:"group",organizationId:a.organization_id}),this.host.conversations.__injectConversation(fu(fu({},a),{entity:h}))):h=this.host.models.Group.inject(a),c?(this.host.metadata.__injectMetadata(h.id,d,c),[3,5]):[3,3];case 3:return this.config.condensedReplays?[3,5]:[4,this.host.metadata.find(h.id,d)];case 4:y.sent(),y.label=5;case 5:return[2,h]}}))}))},t.prototype.createPatientGroup=function(e){var t=e.metadata,n=e.name,r=e.organizationId,o=e.recipientId,i=e.senderId;return this.create({isPatientGroup:!0,metadata:t,name:n,organizationId:r,memberIds:mu([i],o)})},t.prototype._shouldExcludeSender=function(e,t,n){var r,o=this.host.models.User.get(n);return!!(function(e){return e&&"user"===e.$entityType}(r=o)&&r.isRoleBot&&o.botRole&&o.botRole.members.length>0)&&!t.includes(o.botRole.memberIds[0])},t.prototype._getGroupName=function(e,t){return void 0===t&&(t=!1),e.map((function(e){var t=e.displayName,n=e.firstName;return e.isRoleBot||"role"===e.$entityType||"team"===e.$entityType?t:n||(It()(t)||Fr(t)?t:"")})).filter(Boolean).join(", ")+(t?" ####":"")||"Group"},t.prototype.update=function(e,t){var n=t.name,r=t.avatarFile,o=t.replayHistory,i=t.memberIds,s=t.metadata;return yu(this,void 0,void 0,(function(){var t,a,u;return gu(this,(function(c){switch(c.label){case 0:return this.host.requireUser(),e=this._resolveModelId(e),t={},void 0!==n&&(t.name=n),void 0!==o&&(t.replayHistory=o),void 0!==i&&(t.memberIds=i.map(this.host.roles.__resolveRoleId)),[4,this.host.api.groups.update(e,{name:n,avatarFile:r,replayHistory:o,memberIds:i})];case 1:return void 0!==(a=c.sent()).avatarUrl&&(t.avatarUrl=a.avatarUrl),u=this.host.models.Group.inject(fu({id:e},t)),s?[4,this.host.metadata.update(e,s,u.organizationId)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2,u]}}))}))},t.prototype.find=function(e,t){return void 0===t&&(t={}),yu(this,void 0,void 0,(function(){var n,r;return gu(this,(function(o){switch(o.label){case 0:return t=Object(m.defaults)(t,{bypassCache:!1,ignoreNotFound:!1,includeMembers:!1}),this.host.requireUser(),n=null,t.bypassCache?[3,2]:!(n=this.host.models.Group.get(e))||n.$placeholder?[3,2]:[4,this.__ensureEntitiesLoaded(n.id,t)];case 1:return o.sent(),[2,n];case 2:return[4,this.__find(e)];case 3:if(r=o.sent(),n=this.host.models.Group.get(e),!r){if(!t.ignoreNotFound)throw new C(this.host.models.Group.name,e);return[2,n]}return n?[4,this.__ensureEntitiesLoaded(n.id,t)]:[3,5];case 4:o.sent(),o.label=5;case 5:return[2,n]}}))}))},t.prototype.__find=function(e){return yu(this,void 0,void 0,(function(){var t,n,r,o,i;return gu(this,(function(s){switch(s.label){case 0:return t=this.host.models.Group.get(e),[4,this.host.api.groups.find(e)];case 1:return n=s.sent(),this.config.condensedReplays&&n&&n.entity?(r=n.entity,t=this.host.conversations.__injectCounterParty({conversationId:n.conversation_id,entityAttrs:r,entityType:"group",organizationId:n.organization_id}),this.host.models.Group.removePlaceholder({entity:t,attrs:r}),[2,r]):(n&&(this.__removeForumMembers(n),o=n.metadata,t=this.host.models.Group.inject(n),i=t.organizationId,o&&i&&this.host.metadata.__injectMetadata(e,i,o)),this.host.models.Group.removePlaceholder({entity:t,attrs:n}),[2,n])}}))}))},t.prototype.__removeForumMembers=function(e){var t=e.members,n=this.__extractGroupTypeFromAttrs(e);n===Ao.FORUM?t&&0===t.length&&delete e.members:n===Ao.ROLE_ASSIGNMENT||t||(e.members=[])},t.prototype.__extractGroupTypeFromAttrs=function(e){var t=e.id||e.token,n=e.organizationId||e.organization_key,r=n?this.host.metadata.get(t,n):null,o=e.metadata||(r?r.data:null),i=Ao.GROUP;if(o&&"role_assignment"===o.meta_type)i=Ao.ROLE_ASSIGNMENT;else if(o&&"role"===o.feature_service)i=Ao.ROLE_P2P;else if(o&&"escalation"===o.feature_service)i=Ao.ESCALATION;else if(o&&"patient_care"===o.feature_service)i=Ao.PATIENT_CARE;else if(o&&"patient_messaging"===o.feature_service)i=Ao.PATIENT_MESSAGING;else if(o&&"teams"===o.feature_service){var s=o.meta_type;"activated_team"===s?i=Ao.ACTIVATED_TEAM:"intra_team"===s&&(i=Ao.INTRA_TEAM)}else(e.isPublic||e.is_public)&&(i=Ao.FORUM);return i},t.prototype.__ensureEntitiesLoaded=function(e,t){return yu(this,void 0,void 0,(function(){var n,r;return gu(this,(function(o){switch(o.label){case 0:return n=this.host.models.Group.get(e),r=[this.ensureMetadata(n)],t.includeMembers&&r.push(this.ensureMembers(n)),[4,Promise.all(r)];case 1:return o.sent(),[2]}}))}))},t.prototype.findAll=function(e){var t=(void 0===e?{}:e).includeMembers,n=void 0!==t&&t;return yu(this,void 0,void 0,(function(){var e,t,r,o,i,s,a,u,c,l,d,h,p,f,v,y;return gu(this,(function(g){switch(g.label){case 0:return this._fetched?[2,this.getAll()]:0!==(e=this.host.models.Organization.getAll()).length?[3,2]:[4,this.host.organizations.findAll()];case 1:e=g.sent(),g.label=2;case 2:return[4,this.host.search.query({types:["group"],organizationIds:e.map((function(e){return e.id})),query:{displayName:""},followContinuations:!0})];case 3:if(t=g.sent().results,r=t.map((function(e){return e.entity})),!n)return[3,5];for(o={},i=0,s=r;i<s.length;i++)for(a=s[i],v=a.organizationId,y=a.memberIds,u=0,c=y;u<c.length;u++)l=c[u],o[v]||(o[v]=[]),o[v].includes(l)||o[v].push(l);for(d=[],h=0,p=Object.entries(o);h<p.length;h++)f=p[h],v=f[0],y=f[1],d.push(this.host.users.ensureUsers(y,v));return[4,Promise.all(d)];case 4:g.sent(),g.label=5;case 5:return this._fetched=!0,[2,r]}}))}))},t.prototype.findAllWithSpecificMembers=function(e,t,n){return yu(this,void 0,void 0,(function(){var r;return gu(this,(function(o){switch(o.label){case 0:return t=this._resolveModelId(t),e=qs(e).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),r=this.__findAllLocalWithSpecificMembers(e,t,n),!!n&&!!n.localOnly||0!==r.length?[3,2]:[4,this.findAll()];case 1:o.sent(),r=this.__findAllLocalWithSpecificMembers(e,t,n),o.label=2;case 2:return[2,r]}}))}))},t.prototype.ensureMembers=function(e,t){return void 0===t&&(t={}),yu(this,void 0,void 0,(function(){var n,r,o,i;return gu(this,(function(s){switch(s.label){case 0:return n=e.groupType===Ao.ROLE_ASSIGNMENT,e.memberIds?[3,5]:e.groupType!==Ao.FORUM?[3,2]:[4,this.findAllMemberIds(e.id)];case 1:return(r=s.sent())&&this.host.models.Group.inject({id:e.id,members:r}),[3,5];case 2:return n?[3,5]:[3,3];case 3:return[4,this.__find(e.id)];case 4:s.sent(),s.label=5;case 5:return o=t.attrs?fu({},t.attrs):{},i=n&&!e.memberIds?[]:e.memberIds,o.organizationId=e.organizationId,[4,this.ensureMembersWithIds(e.id,i,fu(fu({},t),{attrs:o}))];case 6:return s.sent(),[2]}}))}))},t.prototype.ensureMembersWithIds=function(e,t,n){return void 0===n&&(n={}),yu(this,void 0,void 0,(function(){var r=this;return gu(this,(function(o){switch(o.label){case 0:return this.host.requireUser(),0===(t=Object(m.without)(t,this.host.currentUserId)).length?[2]:(n=Object(m.defaults)(n,{onlyPlaceholder:!1}),[4,Promise.all(t.map((function(e){return r.__ensureMember(e,n)})).filter(Boolean))]);case 1:return o.sent().length>0&&this.host.models.Group.touch(e),[2]}}))}))},t.prototype.__ensureMember=function(e,t){if(void 0===t&&(t={}),!this.host.models.User.shouldEnsure(e,t.onlyPlaceholder))return null;var n=this.host.models.User.get(e);return n&&t.attrs&&this.host.models.User.injectPlaceholder(fu({id:n.id},t.attrs)),this.host.models.User.waitForEnsuredEntity(e,t)},t.prototype.ensureMetadata=function(e){return yu(this,void 0,void 0,(function(){var t,n,r;return gu(this,(function(o){switch(o.label){case 0:return t=e.groupType,n=e.id,r=e.organizationId,(r?this.host.metadata.get(n,r):null)?[3,3]:t!==Ao.FORUM&&t!==Ao.ROLE_ASSIGNMENT?[3,1]:[3,3];case 1:return[4,this.__find(n)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},t.prototype.getAll=function(){return this.host.models.Group.getAll()},t.prototype.getById=function(e){return this.host.models.Group.get(e)},t.prototype.getMultiById=function(e){return this.host.models.Group.getMulti(e)},t.prototype.__findAllLocalWithSpecificMembers=function(e,t,n){var r=void 0===n?{}:n,o=r.exact,i=void 0===o||o,s=r.includeCurrentUser,a=void 0===s||s,u=r.includeForums,c=void 0===u||u,l=r.includeRoles,d=void 0===l||l,h=r.senderId,p=void 0===h?null:h,f=this.host,v=f.currentUser,y=f.currentUserId,g=v.roles.map((function(e){return e.botUserId}));p&&g.includes(p)?(e=e.slice()).push(p,y):a&&!e.includes(y)&&(e=e.slice()).push(y);for(var m=e.includes(y),_=e.length,b=[],w=0,I=this.host.models.Group.getAll();w<I.length;w++){var O=I[w];if(c||O.groupType!==Ao.FORUM){var T=O.memberIds;if(O.organizationId===t&&T){for(var E=!0,A=0,C=e;A<C.length;A++){var R=C[A];if(!T.includes(R)){E=!1;break}}if(E){if(i){if(!p&&!m)continue;var P=_;if(d)for(var S=0,j=g;S<j.length;S++){var M=j[S];O.memberIds.includes(M)&&P++}if(P!==O.memberIds.length)continue}b.push(O)}}}}return b},t.prototype.destroy=function(e){return yu(this,void 0,void 0,(function(){return gu(this,(function(t){switch(t.label){case 0:return this.host.requireUser(),e=this._resolveModelId(e),[4,this.host.api.groups.destroy(e)];case 1:if(!t.sent())throw new C(this.host.models.Group.name,e);return[2]}}))}))},t.prototype.findAllMemberIds=function(e){return yu(this,void 0,void 0,(function(){return gu(this,(function(t){return this.host.requireUser(),e=this._resolveModelId(e),[2,this.host.api.groups.findAllMemberIds(e)]}))}))},t.prototype.addMembers=function(e,t){return yu(this,void 0,void 0,(function(){var n,r,o,i,s;return gu(this,(function(a){switch(a.label){case 0:if(this.host.requireUser(),e=this._resolveModelId(e),t=qs(t).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),(n=this.getById(e))&&n.groupType===Ao.ROLE_P2P)throw new z("role p2p group",n.id,"add users");return n?"FORUM"!==n.groupType||n.memberIds?[3,2]:(r=n,[4,this.findAllMemberIds(e)]):[3,3];case 1:r.memberIds=a.sent(),a.label=2;case 2:t=Object(m.difference)(t,n.memberIds),a.label=3;case 3:return 0===t.length?[2]:[4,this.host.api.groups.addMembers(e,t)];case 4:return o=a.sent(),this.config.condensedReplays?(i=this.host.conversations.getById(o.conversation_id))?[3,6]:[4,this.host.api.conversations.find(o.conversation_id)]:[3,7];case 5:if(!(s=a.sent()))throw new C(this.host.models.Conversation.name,e);i=this.host.conversations.__injectConversation(s),a.label=6;case 6:o.unread_message_count&&(i.unreadCount=o.unread_message_count),o.unread_priority_message_count&&(i.unreadPriorityCount=o.unread_priority_message_count),this.host.models.Conversation.inject(i),a.label=7;case 7:return[2]}}))}))},t.prototype.removeMembers=function(e,t){return yu(this,void 0,void 0,(function(){var n,r,o,i,s,a;return gu(this,(function(u){switch(u.label){case 0:if(this.host.requireUser(),e=this._resolveModelId(e),t=qs(t).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),!(n=this.getById(e)))return[3,3];if(r=n.groupType,o=n.id,i=n.p2pSender,s=i&&"role"===i.$entityType&&i.botUserId,r===Ao.ROLE_P2P&&s&&t.includes(s))throw new z("role p2p group",o,"remove an on-duty user");return"FORUM"!==r||n.memberIds?[3,2]:(a=n,[4,this.findAllMemberIds(e)]);case 1:a.memberIds=u.sent(),u.label=2;case 2:t=Object(m.intersection)(t,n.memberIds),u.label=3;case 3:return 0===t.length?[2]:[4,this.host.api.groups.removeMembers(e,t)];case 4:return u.sent(),[2]}}))}))},t.prototype.addMember=function(e,t){return yu(this,void 0,void 0,(function(){return gu(this,(function(n){return[2,this.addMembers(e,[t])]}))}))},t.prototype.removeMember=function(e,t){return yu(this,void 0,void 0,(function(){return gu(this,(function(n){return[2,this.removeMembers(e,[t])]}))}))},t.prototype.leave=function(e){return yu(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d,h;return gu(this,(function(p){switch(p.label){case 0:return e=this._resolveModelId(e),(t=this.getById(e))?(n=this.host,r=n.currentUser,o=n.currentUserId,i=t.groupType,s=t.p2pSender,a=t.memberIds,u=r.roles.map((function(e){return e.botUserId})),c=[o],i!==Ao.FORUM?[3,2]:[4,this.findAllMemberIds(e)]):[2];case 1:a=p.sent(),p.label=2;case 2:if(i===Ao.ROLE_P2P&&s)c=["user"===s.$entityType?s.id:s.botUserId];else if(a)for(l=0,d=a;l<d.length;l++)h=d[l],u.includes(h)&&c.push(h);return[4,this.removeMembers(e,c)];case 3:return p.sent(),[2]}}))}))},t.prototype.reactToBangEvent=function(e){var t=e.data,n=(t=Rs(t)).bang_id||""+t.sort_number;return this.__handleBang({data:t,eventId:n,alwaysAddToTimeline:!1})},t.prototype.__handleBang=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,o=void 0!==r&&r,i=t.event;"added"===i?this.__addedToGroup({data:t,eventId:n,alwaysAddToTimeline:o}):"removed"===i?this.__removedFromGroup({data:t,eventId:n,alwaysAddToTimeline:o}):"teams_request_accepted"===i?this.__acceptedToTeam({data:t,eventId:n,alwaysAddToTimeline:o}):"teams_request_declined"===i||"teams_request_declined_full"===i?this.__deniedToTeam({data:t,eventId:n,alwaysAddToTimeline:o}):To.fromServer(i)?this.__handleEscalationBang({data:t,eventId:n,alwaysAddToTimeline:o}):"ended_voip_call"!==i&&"missed_voip_call"!==i||this.__handleEndedCall({data:t,eventId:n,alwaysAddToTimeline:o})},t.prototype.__handleEndedCall=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline;return yu(this,void 0,void 0,(function(){var e,o,i,s,a,u,c,l,d,h,p,f,v,y,g,_,b,w,I,O;return gu(this,(function(T){switch(T.label){case 0:e=t.event,o=t.participants_duration,i=t.caller_entity,s=t.conversation_id,a=t.created_on,u=t.is_video,c=t.organization_id,l=t.sort_number,d=t.subject_entity,h=t.target_entity,p="ended_voip_call"===e?"CALL_CHANGE":"MISSED_CALL";try{f=JSON.parse(o)}catch(e){return[2]}return!f||Object(m.isEmpty)(f)||("CALL_CHANGE"===p&&Object(m.isEmpty)(f[this.host.currentUserId])||"MISSED_CALL"===p&&i&&i.token===this.host.currentUserId)?[2]:("CALL_CHANGE"===p?(v=f[this.host.currentUserId].duration,y=f[this.host.currentUserId].start_time):"MISSED_CALL"===p&&(v=Object.values(f)[0].duration,y=Object.values(f)[0].start_time),v&&Object(m.get)(i,"token")&&Object(m.get)(h,"token")?(g=[i,h].map((function(e){var t=e.display_name,n=e.token,r=e.type;return{displayName:t,id:n,organizationId:c,type:r}})),_=g[0],(b=g[1]).type.includes("group")?(w=this.host.models.Group.get(b.id),[3,3]):[3,1]):[2]);case 1:return b.type.includes("account")?[4,this.findAllWithSpecificMembers([b.id,_.id],c)]:[3,3];case 2:I=T.sent(),O=1===I.length&&2===I[0].memberCount,w=O&&I[0],T.label=3;case 3:return this.host.conversations.addCallChangeLog({action:p,alwaysAddToTimeline:r,callee:b,callEntity:d,caller:_,conversationId:s,createdAt:a,duration:v,group:w,id:n,isVideo:u,organizationId:c,sortNumber:+l,userStartTime:y}),[2]}}))}))},t.prototype.__addedToGroup=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,o=t.caller_entity,i=t.subject_entity,s=t.target_entity,a=t.organization_id;if(o&&o.token&&s&&s.token&&i&&i.token){i&&!i.display_name&&(r=!1);var u=this.host.models.Group.get(s.token);if(u){var c,l={displayName:o.display_name,id:o.token,organizationId:a,type:"user"},d={displayName:i.display_name,id:i.token,organizationId:a,type:"user"},h=this.host.models.User.get(l.id),p={action:c=h&&h.isRoleBot||o.metadata&&"role"===o.metadata.feature_service?"OPT_IN":d.id===l.id?"JOIN":"ADD",actionTime:t.action_time||t.created_on,actor:l,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[d],memberIds:[d.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(p),"OPT_IN"!==c&&u.memberIds&&u.memberIds.includes(d.id)||(this.host.models.Group.touch(u),this.emit("membership:change",p))}}},t.prototype.__removedFromGroup=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,o=t.caller_entity,i=t.subject_entity,s=t.target_entity,a=t.organization_id,u=!1;if(o&&o.token&&s&&s.token&&i&&i.token){var c=this.host.models.Group.get(s.token);if(c){if(t.reason&&("leave_org"===t.reason||"delete_account"===t.reason)&&(t.reason_subject_token||t.subject_entity.token)){r=!1,u=!0;var l=t.reason_subject_token||t.subject_entity.token;this.host.models.User.inject({id:l,removedFromOrg:!0})}var d,h={displayName:o.display_name,id:o.token,organizationId:a,type:"user"},p={displayName:i.display_name,id:i.token,organizationId:a,type:"user"},f=this.host.models.User.get(h.id),v={action:d=f&&f.isRoleBot||o.metadata&&"role"===o.metadata.feature_service?"OPT_OUT":p.id===h.id?"LEAVE":"REMOVE",actionTime:t.action_time||t.created_on,actor:h,alwaysAddToTimeline:r,createdAt:t.created_on,group:c,id:n,members:[p],memberIds:[p.id],removedFromGroup:u,sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(v),"OPT_OUT"!==d&&c.memberIds&&!c.memberIds.includes(p.id)||this.emit("membership:change",v)}}},t.prototype.__acceptedToTeam=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,o=t.caller_entity,i=t.subject_entity,s=t.target_entity,a=t.organization_id;if(o&&o.token&&s&&s.token&&i&&i.token){var u=this.host.models.Group.get(s.token);if(u){var c={displayName:t.action_user_name,id:t.action_user_id,organizationId:a,type:"user"},l={displayName:o.display_name,id:o.token,organizationId:a,type:"user"},d={action:"ADD",actionTime:t.action_time||t.created_on,actor:c,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[l],memberIds:[l.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(d)}}},t.prototype.__deniedToTeam=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,o=t.caller_entity,i=t.subject_entity,s=t.target_entity,a=t.organization_id;if(o&&o.token&&s&&s.token&&i&&i.token){var u=this.host.models.Group.get(s.token);if(u){var c={displayName:t.action_user_name,id:t.action_user_id,organizationId:a,type:"user"},l={displayName:o.display_name,id:o.token,organizationId:a,type:"user"},d={action:"DENY",actionTime:t.action_time||t.created_on,actor:c,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[l],memberIds:[l.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(d)}}},t.prototype.__handleEscalationBang=function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,o=t.caller_entity,i=t.subject_entity,s=t.target_entity,a=t.organization_id;if(i.token&&s.token){var u=this.host.models.Group.get(s.token);u||(u=this.host.models.Group.injectPlaceholder({id:s.token,organizationId:a}));var c=To.resolve(t.event),l=this.host.models.EscalationExecution.get(i.token);l||(l=u.escalationExecution),l||(l=c===To.MEMBER_ADDED?null:this.host.models.EscalationExecution.inject({id:i.token,organizationId:a}));var d=t.action_user_name,h=t.action_time||t.created_on,p=null,f=null;c===To.INITIATED?p={displayName:o.display_name,id:o.token,organizationId:a,type:"user"}:c===To.MEMBER_ADDED?f=[{displayName:t.member_name,id:t.member_id,organizationId:a,type:"user"}]:c!==To.NO_RESPONSE&&(p={displayName:d,id:null,organizationId:a,type:"user"});var v={action:c,actionTime:h,actor:p,alwaysAddToTimeline:r,createdAt:t.created_on,escalationExecution:l,group:u,members:f,id:n,sortNumber:+t.sort_number};this.host.conversations.addEscalationExecutionChangeLog(v)}},t.prototype._setMembership=function(e){var t=this.host.currentUser.roles.reduce((function(e,t){var n=t.botUserId;return n&&(e[n]=!0),e}),{});if(e.hasCurrentUserOrRole=!1,e.memberIds)for(var n=0,r=e.memberIds;n<r.length;n++){var o=r[n];if(o===this.host.currentUserId||t[o])return void(e.hasCurrentUserOrRole=!0)}},vu([Object(zi.decorator)()],t.prototype,"find",null),vu([Object(zi.decorator)()],t.prototype,"__find",null),vu([Object(zi.decorator)()],t.prototype,"__ensureEntitiesLoaded",null),vu([Object(zi.decorator)()],t.prototype,"findAll",null),vu([Object(zi.decorator)()],t.prototype,"findAllWithSpecificMembers",null),vu([Object(zi.decorator)()],t.prototype,"findAllMemberIds",null),t}(Bs),bu=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wu=function(){return(wu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Iu=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ou=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Tu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Eu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},Au=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},Cu=["escalationExecutionId","id","serverId"],Ru=["distributionList","group","user"],Pu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.DELETE_ON_READ_MS=6e4,t.__retrieveSentMessage=function(e,n){var r=n.instance;return Ou(t,void 0,void 0,(function(){var t,n,o,i,s,a,u,c,l,d,h;return Tu(this,(function(p){switch(p.label){case 0:if(!(t=e.message_id))throw new Error("Missing message_id from /message response");return e.sort_number?[3,5]:[4,this.find(t,{instance:r,replace:!0})];case 1:return(n=p.sent())?[3,4]:[4,new Promise((function(e){return setTimeout(e,1e3)}))];case 2:return p.sent(),[4,this.find(t,{instance:r,replace:!0})];case 3:n=p.sent(),p.label=4;case 4:return n&&(r=n),[3,8];case 5:return void 0===e.is_forwarded&&(e.is_forwarded=!1),o=e.status||"New",this.__setDefaultAttributes(e,{instance:r}),(r=this.host.models.Message.replaceExisting(e,{instance:r})).$synced=void 0,i=r.counterPartyType,s=r.createdAt,a=r.group,u=r.recipientId,l=(c=a||{}).groupType,d=c.p2pRecipient,h=void 0,l===Ao.ROLE_P2P&&d?h="role"===d.$entityType?d.botUserId:d.id:"user"===i&&(h=u),h?(this.__injectMessageStatus(r,{accountId:h,createdAt:s,status:o}),[3,8]):[3,6];case 6:return l!==Ao.GROUP?[3,8]:[4,this.findRecipientStatus(r,{queue:!1})];case 7:p.sent(),p.label=8;case 8:return[2,r]}}))}))},t.__generateAttachmentDescriptor=function(e){var t="local:"+O.a.v4();"string"==typeof e||e instanceof Buffer||Us.raise("attachment","invalid","attachment (string or Buffer) is invalid");var r,o=void 0,i=void 0,s=n(19),a=n(18),u=n(55),c=n(26);if("string"==typeof e)o=s.statSync(e).size,i=u.lookup(e),r=a.basename(e);else{var l=c(e);if(l)r="attachment."+l.ext,i=l.mime;o=e.byteLength}return{id:t,localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:r,size:o,contentType:i,isLocal:!0}},t.__retryApiSend=function(e){return Ou(t,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d,h,p,f;return Tu(this,(function(v){switch(v.label){case 0:t=e._originalBody,n=e.attachments,r=e.conversationId,o=e.counterPartyId,i=e.deleteOnRead,s=e.id,a=e.metadata,u=e.priority,c=e.recipientOrganizationId,l=e.senderOrganizationId,d=e.shouldEscalate,h=e.ttl,v.label=1;case 1:return v.trys.push([1,4,,5]),[4,this.host.api.messages.send({attachment:_.a.get(n,"0.localFile"),body:t,conversationId:r,counterPartyId:o,deleteOnRead:i,escalate:d,localId:s,metadata:a,priority:Co.toServer(u),recipientOrganizationId:c,senderOrganizationId:l,ttl:h})];case 2:return p=v.sent(),this.host.config.condensedReplays&&p.last_message&&(p=p.last_message),[4,this.__retrieveSentMessage(p,{instance:e})];case 3:return e=v.sent(),this.host.emit("message:sent",e),[3,5];case 4:return f=v.sent(),this.logger.warn("error while sending message",f),e.senderStatus=jo.FAILED,this.host.models.Message.inject(e),[3,5];case 5:return[2,e]}}))}))},t.__retryApiForward=function(e){return Ou(t,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d;return Tu(this,(function(h){switch(h.label){case 0:t=e.conversationId,n=e.counterPartyId,r=e.id,o=e.metadata,i=e.originalMessageId,s=e.priority,a=e.recipientOrganizationId,u=e.senderOrganizationId,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,this.host.api.messages.forward(i,n,{conversationId:t,localId:r,metadata:o,priority:Co.toServer(s),recipientOrganizationId:a,senderOrganizationId:u})];case 2:return c=h.sent(),l=c.message_id,[4,this.find(l,{instance:e,replace:!0})];case 3:return e=h.sent(),this.host.emit("message:sent",e),[3,5];case 4:return d=h.sent(),this.logger.error("error while forwarding message",d),e.senderStatus=jo.FAILED,this.host.models.Message.inject(e),[3,5];case 5:return[2,e]}}))}))},t._resolveMessage=function(e){return t.host.models.Message.is(e)?e:"string"==typeof e?t.host.models.Message.get(e):null},t._looksLikeDistributionListMessage=function(e){var t=e.body;if(!t)return!1;var n=t.match(/^\[(.+?)\]: /);return!!n&&n[1]},t.__setDefaultAttributes=function(e,t){var n=t.instance,r={is_forwarded:n.isForwarded,attachments:n.attachments,conversationId:n.conversationId,counterParty:n.counterParty,senderStatus:jo.SENT,shouldEscalate:!1};return n.isForwarded&&(r.originalForwardedMessageCreatedAt=n.originalForwardedMessageCreatedAt,r.originalMessageId=n.originalMessageId,n.originalSender&&(r.originalSender=n.originalSender)),_.a.defaults(e,r),e},t.__flushSetMessageStatusesQueue=function(){if(t._queuedSetMessageStatuses.deliveredIds.length+t._queuedSetMessageStatuses.readIds.length>0){var e=t._queuedSetMessageStatuses;t._queuedSetMessageStatuses={deliveredIds:[],readIds:[]},t.__setMessagesStatus(e)}},t._onTick=function(){t._deleteExpiredMessages(),t._deleteExpiredMutes(),t.config.condensedReplays&&t._clearOptimisticMarkAsReadState()},t._deleteExpiredMessages=function(e){void 0===e&&(e=Date.now()),e.getTime&&(e=e.getTime());for(var n=0,r=t.host.organizations.getAll();n<r.length;n++)for(var o=r[n].__expirableMessages,i=!1;!i&&o.length>0;){var s=o[0];s.expiresAt<e?t.host.models.Message.eject(s):i=!0}},t._deleteExpiredMutes=function(e){void 0===e&&(e=Date.now()),e.getTime&&(e=e.getTime());for(var n=0,r=t.host.organizations.getAll();n<r.length;n++)for(var o=r[n].__expirableMutes,i=!1;!i&&o.length>0;){var s=o[0];if(s.expiresAt<e){t.host.models.Mute.eject(s);var a=t.host.models.Conversation.get(s.conversationId);if(!a)continue;a.muted=null,t.host.models.Conversation.inject(a)}else i=!0}},t._onChangeMessageStatus=function(e,n){var r=n.messageId,o=t.host.models.Message.get(r);o&&t.host.models.Message.inject(o)},t._fetchAttachmentTokens=function(e){return void 0===e&&(e=20),t._fetchingAttachmentTokens||(t._fetchingAttachmentTokens=new Promise((function(n){return Ou(t,void 0,void 0,(function(){var t,r,o;return Tu(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.host.api.messages.createAttachmentTokens(e)];case 1:return t=i.sent().attachment_tokens,(o=this._attachmentTokens).push.apply(o,t),[3,3];case 2:return r=i.sent(),this.logger.error("error while requesting attachment tokens",r),[3,3];case 3:return this._fetchingAttachmentTokens=null,n(),[2]}}))}))}))),t._fetchingAttachmentTokens},t._useAttachmentToken=function(e,n){return void 0===e&&(e=20),void 0===n&&(n=0),Ou(t,void 0,void 0,(function(){var t;return Tu(this,(function(r){switch(r.label){case 0:if(n>3)throw new Error("Attachment tokens can not be fetched at this time.");return this._attachmentTokens.length<e?[4,this._fetchAttachmentTokens(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return(t=this._attachmentTokens.shift())?[3,4]:[4,this._useAttachmentToken(e,++n)];case 3:return[2,r.sent()];case 4:return[2,t]}}))}))},t.getAttachmentUrlWithToken=function(e,n,r){return void 0===r&&(r=!1),Ou(t,void 0,void 0,(function(){var t,o,i;return Tu(this,(function(s){switch(s.label){case 0:return t=this._resolveMessage(e),[4,this.findAttachment(t.serverId,n)];case 1:return o=s.sent(),[4,this._useAttachmentToken()];case 2:return i=s.sent(),[2,""+(r?this.host.config.baseUrl:"")+this.__getAttachmentPath(t.serverId,o.id)+"?token="+i]}}))}))},t.openAttachmentWithToken=function(e,n){return Ou(t,void 0,void 0,(function(){var t,r,o;return Tu(this,(function(i){switch(i.label){case 0:return t=n.toString(),r=this._resolveMessage(e),[4,this.findAttachment(e,t)];case 1:if(!i.sent())throw new C("MessageAttachment",r.serverId+":"+t);return[4,this.getAttachmentUrlWithToken(r.serverId,t)];case 2:return o=i.sent(),window.open(this.host.config.baseUrl+o,"_blank"),[2]}}))}))},t}return bu(t,e),t.prototype.mounted=function(){this._throttled_flushFindRecipientStatusesQueue=this.config.flushFindRecipientStatusInterval?Wa()(this.__flushFindRecipientStatusesQueue,this.config.flushFindRecipientStatusInterval,{leading:!1}):this.__flushFindRecipientStatusesQueue,this._throttled_flushSetMessageStatusesQueue=this.config.flushSetMessageStatusInterval?Wa()(this.__flushSetMessageStatusesQueue,this.config.flushSetMessageStatusInterval,{leading:!1}):this.__flushSetMessageStatusesQueue,this._attachmentTokens=[],this._pendingFindRecipientStatuses={},this._queuedFindRecipientStatuses=[],this._queuedSetMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this._onTick),this.host.models.MessageStatusPerRecipient.on("afterInject",this._onChangeMessageStatus),this.host.models.MessageStatusPerRecipient.on("afterEject",this._onChangeMessageStatus)},t.prototype.dispose=function(){this._attachmentTokens=null,this._pendingFindRecipientStatuses=null,this._queuedFindRecipientStatuses=null,this._queuedSetMessageStatuses=null,this._downloadAttachmentBlobAndUrl&&zi.decorator.clear(this._downloadAttachmentBlobAndUrl),this.downloadAttachmentUrl&&zi.decorator.clear(this.downloadAttachmentUrl),this.downloadAttachment&&zi.decorator.clear(this.downloadAttachment),this._throttled_flushFindRecipientStatusesQueue.cancel&&this._throttled_flushFindRecipientStatusesQueue.cancel(),this._throttled_flushSetMessageStatusesQueue.cancel&&this._throttled_flushSetMessageStatusesQueue.cancel(),this.host.removeListener("tick",this._onTick),this.host.models.MessageStatusPerRecipient.removeListener("afterInject",this._onChangeMessageStatus),this.host.models.MessageStatusPerRecipient.removeListener("afterEject",this._onChangeMessageStatus)},t.prototype.send=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l;return Tu(this,(function(d){switch(d.label){case 0:if(this.config.condensedReplays)throw new Error("the send() method has been deprecated in favor of sendToUser(), sendToGroup(), etc.");return Array.isArray(e)?[4,this.__resolveSender(n)]:[3,2];case 1:return d.sent(),[2,this.sendToGroupOfUsers(e,t,n)];case 2:return[4,this.__resolveCounterPartyEntityAndOrganizationId(e,n.senderOrganizationId||n.organizationId)];case 3:return r=d.sent(),o=r.counterParty,i=r.organizationId,Us.notEmpty("counterPartyId",o,"counterPartyId not found"),i?n=wu(wu({},_.a.omit(n,"organizationId","senderOrganizationId","recipientOrganizationId")),{organizationId:i}):i=n.organizationId,[4,this.__resolveSender(n)];case 4:return s=d.sent(),a=function(e){return e&&"user"===e.$entityType},(u=function(e){return a(e)&&e.isRoleBot})(o)||a(o)&&u(s)?[2,this.sendToRole(e,t,n)]:(c=o.groupType,l=o.memberIds,c!==Ao.FORUM||l&&l.includes(this.host.currentUserId)?[3,6]:[4,this.host.forums.join(o)]);case 5:d.sent(),d.label=6;case 6:return[2,this.__sendToCounterParty(o,t,n)]}}))}))},t.prototype.__resolveSender=function(e){return Ou(this,void 0,void 0,(function(){var t,n,r;return Tu(this,(function(o){switch(o.label){case 0:return t=this.__resolveSenderId(e),n=e.senderOrganizationId||e.organizationId,t===this.host.currentUserId?[2,this.host.currentUser]:(n||Us.raise("senderOrganizationId","missing","When senderId is provided, senderOrganizationId or organizationId must also be provided"),[4,this.host.users.find(t,{organizationId:n})]);case 1:return(r=o.sent())||Us.raise("senderId","invalid","The provided senderId was not found"),r.isRoleBot||Us.raise("senderId","invalid","senderId must be either the current user or a role"),[4,this.host.roles.find(t,n)];case 2:return o.sent(),[2,r]}}))}))},t.prototype.__resolveSenderId=function(e){void 0===e&&(e={});var t=e.senderId;return t?(t=this._resolveModelId(t),t=this.host.roles.__resolveRoleId(t)):t=this.host.currentUserId,e.senderId=t,t},t.prototype.__resolveCounterPartyEntityAndOrganizationId=function(e,t){return void 0===t&&(t=null),Ou(this,void 0,void 0,(function(){var n,r,o;return Tu(this,(function(i){switch(i.label){case 0:return"string"==typeof e&&(e=this.host.roles.__resolveRoleId(e)),n=this._resolveEntity(e,Au(Ru,["conversation"])),r=t,n?[3,2]:this.host.conversations.looksLikeConversationHandle(e)?[4,this.host.conversations.find(e)]:[3,2];case 1:(o=i.sent())&&(n=o.counterParty,r=o.organizationId),i.label=2;case 2:return n?[3,4]:[4,this.__resolveRemoteCounterPartyEntity(e,r)];case 3:n=i.sent(),i.label=4;case 4:return n&&(n.organizationId&&"user"!==n.$entityType&&(r=n.organizationId),"conversation"===n.$entityType&&(n=n.counterParty)),[2,{counterParty:n,organizationId:r}]}}))}))},t.prototype.__resolveRemoteCounterPartyEntity=function(e,t){return Ou(this,void 0,void 0,(function(){var n,r,o,i,s,a,u=this;return Tu(this,(function(c){switch(c.label){case 0:n=null,e=this.host.roles.__resolveRoleId(e),r=_.a.compact([function(){return Ou(u,void 0,void 0,(function(){return Tu(this,(function(n){return[2,this.host.users.findOrCreate(e,{organizationId:t})]}))}))},function(){return Ou(u,void 0,void 0,(function(){return Tu(this,(function(t){return[2,this.host.groups.find(e)]}))}))},function(){return Ou(u,void 0,void 0,(function(){return Tu(this,(function(t){return[2,this.host.distributionLists.find(e)]}))}))}]),o=0,i=r,c.label=1;case 1:if(!(o<i.length))return[3,6];s=i[o],c.label=2;case 2:return c.trys.push([2,4,,5]),[4,s()];case 3:return(n=c.sent())?[3,6]:[3,5];case 4:if((a=c.sent()).code!==C.CODE)throw a;return[3,5];case 5:return o++,[3,1];case 6:return[2,n]}}))}))},t.prototype.__sendToCounterParty=function(e,t,n){var r=n.organizationId,o=n.senderOrganizationId,i=void 0===o?r:o,s=n.recipientOrganizationId,a=void 0===s?i:s,u=Eu(n,["organizationId","senderOrganizationId","recipientOrganizationId"]);return Ou(this,void 0,void 0,(function(){var n,o,s,c,l,d,h,p,f,v,y;return Tu(this,(function(g){switch(g.label){case 0:n=e.$entityType,o=e.serverId,this.host.requireUser(),Us.oneOf("counterPartyType",n,["user","group","distributionList"]),Us.notEmpty("counterPartyId",o),i=this.__ensureOrganization(i),a=a||i,u=this.__normalizeSendOptions(u,{counterParty:e,senderOrganizationId:i}),s=this.__createNewMessage(e,t,wu({organizationId:r,senderOrganizationId:i,recipientOrganizationId:a},u)),this.host.events.deferEventQueue(),this.host.models.Message.inject(s),this.host.emit("message:sending",s),c=u.attachmentFiles,l=u.deleteOnRead,d=u.escalate,h=u.metadata,p=u.priority,f=u.ttl,g.label=1;case 1:return g.trys.push([1,4,,5]),[4,this.host.api.messages.send({attachment:_.a.head(c),body:t,counterPartyId:o,deleteOnRead:l,escalate:d,localId:s?s.id:O.a.v4(),metadata:h,priority:Co.toServer(p),recipientOrganizationId:a,senderOrganizationId:i,ttl:f})];case 2:return v=g.sent(),[4,this.__retrieveSentMessage(v,{instance:s})];case 3:return s=g.sent(),this.host.emit("message:sent",s),[3,5];case 4:return y=g.sent(),this.logger.error("error while sending message",y),s.senderStatus=jo.FAILED,this.host.models.Message.inject(s),[3,5];case 5:return this.host.events.resumeEventQueue(),[2,s]}}))}))},t.prototype.__createNewMessage=function(e,t,n){var r,o=n.conversationId,i=n.isForwarded,s=void 0!==i&&i,a=n.organizationId,u=n.senderOrganizationId,c=void 0===u?a:u,l=n.recipientOrganizationId,d=void 0===l?c:l,h=Eu(n,["conversationId","isForwarded","organizationId","senderOrganizationId","recipientOrganizationId"]),p=h.attachmentFiles,f=h.deleteOnRead,v=h.escalate,y=h.metadata,g=h.originalMetadata,m=h.priority,_=h.senderId,b=h.ttl,w=e.$entityType,I=e.serverId;this.host.requireUser(),Us.oneOf("counterPartyType",w,["user","group","distributionList"]),Us.notEmpty("counterPartyId",I),o&&(r=this.host.conversations.getById(o)),r||(r=this.host.conversations.ensureConversation(w,I,c));var T=r.isLive,E=this.__getNextSortNumber(c,{conversation:r}),A=_&&_!==this.host.currentUserId?_:void 0,C=t;"distributionList"===w&&(t="["+e.displayName+"]: "+t);var R=this.host.models.Message.createInstance({$synced:!1,body:t,conversationId:r.id,counterPartyId:I,counterPartyType:w,createdAt:new Date,currentSenderRoleId:A,deleteOnRead:f,id:O.a.v4(),inTimeline:T,isForwarded:s,isOutgoing:!0,messageType:zo.USER_SENT,metadata:y,originalMetadata:g,priority:m,recipientOrganizationId:d,senderId:this.host.currentUserId,senderOrganizationId:c,senderStatus:jo.SENDING,shouldEscalate:v,sortNumber:E,ttl:b});return R._originalBody=C,p&&(R.attachments=p.map(this.__generateAttachmentDescriptor)),"group"===w?R.groupId=I:"user"===w?R.recipientId=I:"distributionList"===w&&(R.distributionListId=I),this.config.condensedReplays||(R.markedRecipientStatus=So.READ),R},t.prototype.__normalizeSendOptions=function(e,t){var n=e.attachmentFile,r=e.attachmentFiles,o=e.deleteOnRead,i=e.escalate,s=e.metadata,a=e.originalMetadata,u=e.priority,c=e.senderId,l=e.ttl,d=t.counterParty,h=t.senderOrganizationId;s=this.__normalizeMetadata({metadata:s,organizationId:h,senderId:c}),r=qs(r||n),!_.a.isEmpty(r)&&r.length>1&&Us.raise("attachmentFiles","invalid","currently only a single attachment is supported");var p=this.host.models.Organization.get(h);void 0===l&&(l=p?p.messageTimeToLive:-1),!o&&p&&(o=p.deleteOnRead);var f=d.groupType,v=d.p2pRecipient;f===Ao.ROLE_P2P&&v&&v.escalationPolicy&&(v.escalationPolicy.alwaysEscalate&&(i=!0,u=Co.NORMAL));return{attachmentFiles:r,deleteOnRead:o,escalate:i,metadata:s,originalMetadata:a,priority:u,senderId:c,ttl:l}},t.prototype.__ensureOrganization=function(e){return e||(this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void Us.raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)"))},t.prototype.__normalizeMetadata=function(e){var t=e.metadata,n=(e.organizationId,e.senderId);if(t||(t=[]),t=qs(t),n!==this.host.currentUserId){var r=this.host.roles.getById(n),o=r.roleTag;t.push({namespace:"tigertext:message:role:sender",payload:{token:n,display_name:r.displayName,tag_id:o?o.tagId:"",tag_color:o?o.color.replace("#","0x"):"",tag_name:o?o.name:""}})}return t.length>0?t.map((function(e){return wu({mimetype:"application/json"},e)})):void 0},t.prototype.__getNextSortNumber=function(e,t){var n=(void 0===t?{}:t).conversation,r=this.host.models.Organization.get(e);r&&!n&&(n=r.conversations[0]);var o=r&&r.highestSortNumber||0,i=n&&n.lastBangMessageSortNumber||0;return Math.max(o,i)+1},t.prototype.previewMessage=function(e,t){void 0===t&&(t={});for(var n=this._resolveMessage(e),r={},o=0,i=Object.entries(n);o<i.length;o++){var s=i[o],a=s[0],u=s[1];Cs(n,a)&&!Cu.includes(a)&&(r[a]=u)}r=wu(wu(wu({},r),{id:O.a.v4(),conversationId:null}),t),this.__setForwardedMessageProperties({origMessage:n,organizationId:n.__organizationId,message:r});for(var c=this.host.models.Message.inject(r),l=0,d=n.statusesPerRecipient;l<d.length;l++){var h=d[l],p=h.userId||h.distributionListId,f=c.id+":"+p;this.host.models.MessageStatusPerRecipient.inject(wu(wu({},h),{id:f,messageId:c.id}))}return c},t.prototype.endPreviewMessage=function(e){var t=this._resolveMessage(e);if(t){for(var n=0,r=t.statusesPerRecipient;n<r.length;n++){var o=r[n];this.host.models.MessageStatusPerRecipient.eject(o)}this.host.models.Message.eject(t)}},t.prototype.sendToUser=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,h,p,f;return Tu(this,(function(v){switch(v.label){case 0:if(!this.host.config.condensedReplays)return[2,this.send(e,t,n)];if(r=n.organizationId,o=n.senderId,i=void 0===o?this.host.currentUserId:o,s=n.groupName,a=n.groupMetadata,!r)throw new Error("organizationId is required");return e=this._resolveModelIdWithTypes(e,"user"),(u=this._resolveEntity(e,"user"))&&u.profileByOrganizationId&&u.profileByOrganizationId[r]?[3,2]:[4,this.host.users.findOrCreate(e,{organizationId:r})];case 1:u=v.sent(),v.label=2;case 2:return[4,this.__resolveRoleBotId(i,r)];case 3:return c=v.sent(),l=c.isRole,d=c.roleBotId,l?[4,this.__prepareRoleP2PGroup(r,e,d,s,{groupMetadata:a})]:[3,5];case 4:return h=v.sent(),[2,this.sendToGroup(h,t,wu(wu({},n),{organizationId:r,senderId:i}))];case 5:if(p=u&&u.profileByOrganizationId[r],!(f=p&&p.conversationId))throw new Error("conversationId not found for p2p message");return this.host.conversations.getById(f)||this.host.models.Conversation.inject({counterPartyId:u.id,counterPartyType:u.$entityType,id:f,organizationId:r}),[2,this.sendToConversation(f,t,n)]}}))}))},t.prototype.sendToGroup=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r;return Tu(this,(function(o){switch(o.label){case 0:return this.config.condensedReplays?(e=this._resolveModelId(e),(r=this._resolveEntity(e,"group"))?[3,2]:[4,this.host.groups.find(e)]):[2,this.send(e,t,n)];case 1:r=o.sent(),o.label=2;case 2:if(!r||!r.conversationId)throw new Error("group conversationId not found");return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),[2,this.sendToConversation(r.conversationId,t,n)]}}))}))},t.prototype.sendToRole=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d;return Tu(this,(function(h){switch(h.label){case 0:if(r=n.organizationId,o=n.senderId,i=void 0===o?this.host.currentUserId:o,s=n.groupMetadata,a=n.groupName,!this.host.config.condensedReplays)return[3,2];if(!r)throw new Error("organizationId is required");return[4,this.__resolveRoleBotId(e,r)];case 1:if(u=h.sent(),c=u.isRole,l=u.roleBotId,!c)throw new Error("recipient must be a role");e=l,h.label=2;case 2:return[4,this.__prepareRoleP2PGroup(r,e,i,a,{groupMetadata:s})];case 3:return d=h.sent(),[2,this.sendToGroup(d,t,wu(wu({},n),{organizationId:r,senderId:i}))]}}))}))},t.prototype.sendToPatient=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l;return Tu(this,(function(d){switch(d.label){case 0:if(n.groupMetadata,r=n.organizationId,o=n.senderId,i=void 0===o?this.host.currentUserId:o,s=Eu(n,["groupMetadata","organizationId","senderId"]),n=wu(wu({},s),{organizationId:r,senderId:i}),this.host.config.condensedReplays&&!r)throw new Error("organizationId is required");if(a=e&&1===e.length?e[0]:e,!(c=this._resolveEntity(a,"user")))throw new Error("user could not be resolved");return u=c.isPatientContact?this.host.patients._createPatientContactGroupMetadata(c):this.host.patients._createPatientGroupMetadata(c),[4,this.host.groups.createPatientGroup({organizationId:r,recipientId:e,senderId:i,metadata:u})];case 1:return l=d.sent(),this.host.metadata.__injectMetadata(l.id,r,u),[2,this.sendToGroup(l,t,wu(wu({},n),{organizationId:r,senderId:i}))]}}))}))},t.prototype.__resolveRoleBotId=function(e,t){return Ou(this,void 0,void 0,(function(){var n,r,o;return Tu(this,(function(i){switch(i.label){case 0:e=this.host.roles.__resolveRoleId(e);try{r=this._resolveModelIdWithTypes(e,"role"),n=!!this._resolveEntity(r,"role")}catch(e){n=!1}return n?[3,3]:(o=this._resolveEntity(e,"user"))&&o.profileByOrganizationId&&o.profileByOrganizationId[t]?[3,2]:[4,this.host.users.find(e,{organizationId:t})];case 1:o=i.sent(),i.label=2;case 2:o&&o.isRoleBot&&(n=!0),i.label=3;case 3:return[2,{isRole:n,roleBotId:e}]}}))}))},t.prototype.sendToConversation=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m,b,w,I,T;return Tu(this,(function(E){switch(E.label){case 0:if(!this.host.config.condensedReplays)return[2,this.send(e,t,n)];if(e=this._resolveModelIdWithTypes(e,"conversation"),!(r=this.host.conversations.getById(e)))throw new C(this.host.models.Conversation.name,e);return[4,this.__resolveSender(n)];case 1:return o=E.sent(),i=r.counterPartyId,s=r.counterPartyType,a=r.organizationId,u=this._resolveEntity(i,s),this.host.requireUser(),c=u.groupType,l=u.memberIds,c!==Ao.FORUM||l&&l.includes(this.host.currentUserId)?[3,3]:[4,this.host.forums.join(u)];case 2:E.sent(),E.label=3;case 3:h=d=a,n=this.__normalizeSendOptions(n,{counterParty:u,senderOrganizationId:d,senderId:o.id}),p=this.__createNewMessage(u,t,wu({conversationId:e,organizationId:a,senderOrganizationId:d,recipientOrganizationId:h},n)),this.host.events.deferEventQueue(),this.host.models.Message.inject(p),this.host.emit("message:sending",p),f=n.attachmentFiles,v=n.deleteOnRead,y=n.escalate,g=n.metadata,m=n.priority,b=n.ttl,E.label=4;case 4:return E.trys.push([4,7,,8]),[4,this.host.api.messages.send({attachment:_.a.head(f),body:t,conversationId:r.id,deleteOnRead:v,escalate:y,localId:p?p.id:O.a.v4(),metadata:g,priority:Co.toServer(m),senderOrganizationId:d,ttl:b})];case 5:return w=E.sent(),I=void 0,I=w.last_message?w.last_message:w,[4,this.__retrieveSentMessage(I,{instance:p})];case 6:return(p=E.sent()).unreadMessageCount&&(r.unreadCount=p.unreadMessageCount),p.unreadPriorityMessageCount&&(r.unreadPriorityCount=p.unreadPriorityMessageCount),r.lastMessage=p,r.highestSortNumber=p.sortNumber?p.sortNumber:this.__getNextSortNumber(d,{conversation:r}),r.isLive=!0,r.timeline.push(p),this.host.models.Conversation.inject(r),p.inTimeline=!0,this.host.models.Message.inject(p),this.host.emit("message:sent",p),[3,8];case 7:return T=E.sent(),this.logger.error("error while sending message",T),p.senderStatus=jo.FAILED,this.host.models.Message.inject(p),[3,8];case 8:return this.host.events.resumeEventQueue(),[2,p]}}))}))},t.prototype.sendToDistributionList=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o;return Tu(this,(function(i){switch(i.label){case 0:return this.config.condensedReplays?(e=this._resolveModelIdWithTypes(e,"distributionList"),(r=this._resolveEntity(e,"distributionList"))?[3,2]:[4,this.host.distributionLists.find(e)]):[2,this.send(e,t,n)];case 1:r=i.sent(),i.label=2;case 2:if(!r||!r.conversationId)throw new Error("distributionList conversationId not found");return(o=this.host.conversations.getById(r.conversationId))||(o=this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId})),[2,this.sendToConversation(o.id,t,n)]}}))}))},t.prototype.sendToGroupOfUsers=function(e,t,n){void 0===n&&(n={});var r=n.groupMetadata,o=n.groupName,i=n.isTeamActivation,s=n.organizationId,a=n.senderId,u=Eu(n,["groupMetadata","groupName","isTeamActivation","organizationId","senderId"]);return Ou(this,void 0,void 0,(function(){var n,c;return Tu(this,(function(l){switch(l.label){case 0:return[4,this.__prepareGroupForUsers(s,e,a,o,i,{groupMetadata:r})];case 1:return n=l.sent(),this.config.condensedReplays?(c=n.conversationId,[4,this.host.conversations.find(c)]):[3,3];case 2:return l.sent(),[2,this.sendToConversation(c,t,wu(wu({},u),{organizationId:s,senderId:a}))];case 3:return[2,this.sendToGroup(n,t,wu(wu({},u),{organizationId:s,senderId:a}))]}}))}))},t.prototype.__prepareGroupForUsers=function(e,t,n,r,o,i){var s=(void 0===i?{}:i).groupMetadata;return 0===t.length&&Us.raise("memberIds","required"),this.host.groups.create({isTeamActivation:o,memberIds:t,metadata:s,name:r,organizationId:e,senderId:n})},t.prototype.__prepareRoleP2PGroup=function(e,t,n,r,o){var i=(void 0===o?{}:o).groupMetadata;return Ou(this,void 0,void 0,(function(){var o;return Tu(this,(function(s){switch(s.label){case 0:return(o=this.host.conversations.findLocalRoleP2PConversation(t,n))?[2,o.counterParty]:[4,this.host.roles.createP2PGroup({metadata:i,name:r,organizationId:e,recipientId:t,senderId:n})];case 1:return[2,s.sent()]}}))}))},t.prototype.recall=function(e){return Ou(this,void 0,void 0,(function(){var t,n;return Tu(this,(function(r){switch(r.label){case 0:return this.host.requireUser(),t=qs(e).filter(Boolean),n=t.map(this.__recallSingle.bind(this)),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.__recallSingle=function(e){return Ou(this,void 0,void 0,(function(){var t;return Tu(this,(function(n){switch(n.label){case 0:if(!(t=this._resolveMessage(e)))return[3,4];if(t.senderId!==this.host.currentUserId)throw new z(t,t.serverId,"recall");return!1!==t.$synced&&t.serverId?[3,1]:(this.host.models.Message.eject(t),[3,3]);case 1:return[4,this.host.api.messages.destroy(t.serverId)];case 2:n.sent(),this.host.models.Message.eject(t),n.label=3;case 3:return[3,6];case 4:return[4,this.host.api.messages.destroy(e)];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},t.prototype.retrySend=function(e){return Ou(this,void 0,void 0,(function(){var t,n,r;return Tu(this,(function(o){switch(o.label){case 0:if(this.host.requireUser(),!(t=this._resolveMessage(e)))throw new C(this.host.models.Message.name,e);return n=t.isForwarded,t.senderStatus!==jo.FAILED&&Us.raise("message","invalid","Message to retry must be in a FAILED senderStatus and sent from current user"),this.host.events.deferEventQueue(),t.senderStatus=jo.RETRYING,this.host.models.Message.inject(t),this.host.emit("message:sending",t),n?[4,this.__retryApiForward(t)]:[3,2];case 1:return t=o.sent(),[3,4];case 2:return[4,this.__retryApiSend(t)];case 3:t=o.sent(),o.label=4;case 4:return this.config.condensedReplays&&(r=this.host.conversations.getById(t.conversationId),t.unreadMessageCount&&(r.unreadCount=t.unreadMessageCount),t.unreadPriorityMessageCount&&(r.unreadPriorityCount=t.unreadPriorityMessageCount),r.lastMessage=t,r.highestSortNumber=t.sortNumber,this.host.models.Conversation.inject(r)),this.host.events.resumeEventQueue(),[2,t]}}))}))},t.prototype.resend=function(e,t){var n=void 0===t?{}:t,r=n.priority,o=n.retrieveMessage,i=void 0!==o&&o,s=n.senderId;return Ou(this,void 0,void 0,(function(){var t,n,o,a,u,c,l,d,h,p,f,v,y,g,m,_,b;return Tu(this,(function(w){switch(w.label){case 0:return t=this._resolveMessage(e),void 0===r&&(r=t.priority),void 0===s&&(s=t.senderId),n=t.attachments,o=t.body,a=t.conversationId,u=t.counterParty,c=t.counterPartyId,l=t.deleteOnRead,d=t.isForwarded,h=t.metadata,p=t.originalMessageId,f=t.recipientOrganizationId,v=t.ttl,d?this.config.condensedReplays?[2,this.forwardToConversation(p,a,{organizationId:f,priority:r})]:[2,this.forward(p,c,{organizationId:f,priority:r,retrieveMessage:i,senderId:s})]:[3,1];case 1:if(y=[],h=h.filter((function(e){return"tigertext:message:role:sender"!==e.namespace})),!n)return[3,5];g=0,m=n,w.label=2;case 2:return g<m.length?(_=m[g],[4,this._downloadAttachmentBlobAndUrl(e,_.id)]):[3,5];case 3:(b=w.sent().blob).name=_.name,y.push(b),w.label=4;case 4:return g++,[3,2];case 5:return this.config.condensedReplays?[2,this.sendToConversation(a,o,{attachmentFiles:y,deleteOnRead:l,organizationId:f,priority:r,metadata:h,senderId:s,ttl:v})]:[2,this.__sendToCounterParty(u,o,{attachmentFiles:y,deleteOnRead:l,organizationId:f,priority:r,senderId:s,metadata:h,ttl:v})]}}))}))},t.prototype.forwardToConversation=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m,b,w,I,O,T;return Tu(this,(function(E){switch(E.label){case 0:if(!this.config.condensedReplays)return[2,this.forward(e,t,n)];if(r=n.metadata,o=void 0===r?[]:r,i=n.priority,s=n.senderId,a=void 0===s?this.host.currentUserId:s,!(u=this.host.conversations.getById(t)))throw new Error("conversation not found");if(this.host.requireUser(),!(c=this._resolveMessage(e)))throw new C(this.host.models.Message.name,e);if(l=c.attachments,d=c.body,!(h=c.serverId))throw new Error("original message was not sent");a=this.__resolveSenderId({senderId:a}),void 0===i&&(i=c.priority),p=u.counterPartyId,f=u.counterPartyType,v=u.organizationId,y=this._resolveEntity(p,f),g=v,m=_.a.get(c,"originalMetadata"),b={metadata:o,priority:i,senderId:a,originalMetadata:m},b=this.__normalizeSendOptions(b,{counterParty:y,senderOrganizationId:g}),o=b.metadata,(w=this.__createNewMessage(y,d,wu({conversationId:t,organizationId:v,isForwarded:!0},b))).attachments=l,this.__setForwardedMessageProperties({origMessage:c,organizationId:v,message:w}),this.host.events.deferEventQueue(),this.host.models.Message.inject(w),this.host.emit("message:sending",w),E.label=1;case 1:return E.trys.push([1,4,,5]),[4,this.host.api.messages.forward(h,null,{conversationId:t,localId:w.id,metadata:o,priority:Co.toServer(i)})];case 2:return I=E.sent(),[4,this.__retrieveSentMessage(I.message,{instance:w})];case 3:return(O=E.sent()).unreadMessageCount&&(u.unreadCount=O.unreadMessageCount),O.unreadPriorityMessageCount&&(u.unreadPriorityCount=O.unreadPriorityMessageCount),this.host.models.Conversation.inject(u),this.host.emit("message:sent",O),[3,5];case 4:return T=E.sent(),this.logger.error("error while forwarding message",T),w.senderStatus=jo.FAILED,this.host.models.Message.inject(w),[3,5];case 5:return this.host.events.resumeEventQueue(),[2,w]}}))}))},t.prototype.forwardToUser=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,h,p,f,v,y;return Tu(this,(function(g){switch(g.label){case 0:if(!this.config.condensedReplays)return[2,this.forward.apply(this,Au([e,t],n))];if(r=n[0],i=(o=void 0===r?{}:r).organizationId,s=o.senderId,a=void 0===s?this.host.currentUserId:s,u=o.groupName,c=o.groupMetadata,!i)throw new Error("organizationId is required");return t=this._resolveModelIdWithTypes(t,"user"),(l=this._resolveEntity(t,"user"))&&l.profileByOrganizationId&&l.profileByOrganizationId[i]?[3,2]:[4,this.host.users.find(t,{organizationId:i})];case 1:l=g.sent(),g.label=2;case 2:return[4,this.__resolveRoleBotId(a,i)];case 3:return d=g.sent(),h=d.isRole,p=d.roleBotId,h?[4,this.__prepareRoleP2PGroup(i,t,p,u,{groupMetadata:c})]:[3,5];case 4:return f=g.sent(),[2,this.forwardToGroup(e,f,wu(wu({},o),{organizationId:i,senderId:a}))];case 5:if(v=l&&l.profileByOrganizationId[i],!(y=v&&v.conversationId))throw new Error("conversationId not found for p2p message");return this.host.conversations.getById(y)||this.host.models.Conversation.inject({counterPartyId:l.id,counterPartyType:l.$entityType,id:y,organizationId:i}),[2,this.forwardToConversation.apply(this,Au([e,y],n))]}}))}))},t.prototype.forwardToGroup=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return Ou(this,void 0,void 0,(function(){var r;return Tu(this,(function(o){switch(o.label){case 0:return this.config.condensedReplays?(t=this._resolveModelId(t),(r=this._resolveEntity(t,"group"))?[3,2]:[4,this.host.groups.find(t)]):[2,this.forward.apply(this,Au([e,t],n))];case 1:r=o.sent(),o.label=2;case 2:if(!r||!r.conversationId)throw new Error("group "+t+" not found");return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),[2,this.forwardToConversation.apply(this,Au([e,r.conversationId],n))]}}))}))},t.prototype.forwardToDistributionList=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r;return Tu(this,(function(o){switch(o.label){case 0:return this.config.condensedReplays?(t=this._resolveModelId(t),(r=this._resolveEntity(t,"distributionList"))?[3,2]:[4,this.host.distributionLists.find(t)]):[2,this.forward(e,t,n)];case 1:r=o.sent(),o.label=2;case 2:if(!r||!r.conversationId)throw new Error("distributionList "+t+" not found");return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),[2,this.forwardToConversation(e,r.conversationId,n)]}}))}))},t.prototype.forwardToGroupOfUsers=function(e,t,n){void 0===n&&(n={});var r=n.groupMetadata,o=n.groupName,i=n.organizationId,s=n.senderId,a=Eu(n,["groupMetadata","groupName","organizationId","senderId"]);return Ou(this,void 0,void 0,(function(){var n,u;return Tu(this,(function(c){switch(c.label){case 0:return[4,this.__prepareGroupForUsers(i,t,s,o,!1,{groupMetadata:r})];case 1:return n=c.sent(),this.config.condensedReplays?(u=n.conversationId,[4,this.host.conversations.find(u)]):[3,3];case 2:return c.sent(),[2,this.forwardToConversation(e,u,wu(wu({},a),{organizationId:i,senderId:s}))];case 3:return[2,this.forwardToGroup(e,n,wu(wu({},a),{organizationId:i,senderId:s}))]}}))}))},t.prototype.forwardToRole=function(e,t,n){return void 0===n&&(n={}),Ou(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d;return Tu(this,(function(h){switch(h.label){case 0:if(r=n.organizationId,o=n.senderId,i=void 0===o?this.host.currentUserId:o,s=n.groupMetadata,a=n.groupName,!this.host.config.condensedReplays)return[3,2];if(!r)throw new Error("organizationId is required");return[4,this.__resolveRoleBotId(t,r)];case 1:if(u=h.sent(),c=u.isRole,l=u.roleBotId,!c)throw new Error("recipient must be a role");t=l,h.label=2;case 2:return[4,this.__prepareRoleP2PGroup(r,t,i,a,{groupMetadata:s})];case 3:return d=h.sent(),[2,this.forwardToGroup(e,d.id,wu(wu({},n),{organizationId:r,senderId:i}))]}}))}))},t.prototype.forward=function(e,t,n){var r=void 0===n?{}:n,o=r.organizationId,i=r.senderOrganizationId,s=void 0===i?o:i,a=r.recipientOrganizationId,u=void 0===a?s:a,c=r.groupMetadata,l=r.groupName,d=r.metadata,h=void 0===d?[]:d,p=(r.preferExistingGroup,r.priority),f=r.retrieveMessage,v=void 0!==f&&f,y=r.senderId,g=void 0===y?this.host.currentUserId:y;return Ou(this,void 0,void 0,(function(){var n,r,i,a,d,f,y,m,b,w,I,O,T,E,A,R,P,S,j=this;return Tu(this,(function(M){switch(M.label){case 0:if(this.config.condensedReplays)throw new Error("the forward() method has been deprecated in favor of forwardToUser(), forwardToGroup(), etc.");if(this.host.requireUser(),!(n=this._resolveMessage(e)))throw new C(this.host.models.Message.name,e);if(r=n.attachments,i=n.body,!(a=n.serverId))throw new Error("original message was not sent");return g=this.__resolveSenderId({senderId:g}),Array.isArray(t)?(d=t.map((function(e){return j._resolveModelIdWithTypes(e,["user","role"])})),[4,this.__prepareGroupForUsers(o,d,g,l,!1,{groupMetadata:c})]):[3,2];case 1:T=M.sent(),t=T.id,M.label=2;case 2:return void 0===p&&(p=n.priority),[4,this.__resolveCounterPartyEntityAndOrganizationId(t,s)];case 3:return f=M.sent(),y=f.counterParty,(m=f.organizationId)&&(s=u=m),u=u||s,y&&(t=y.serverId),[4,this.__resolveSender({organizationId:o,senderId:g,senderOrganizationId:s})];case 4:return b=M.sent(),w=function(e){return e&&"user"===e.$entityType},I=function(e){return w(e)&&e.isRoleBot},O=_.a.get(n,"originalMetadata"),I(y)||w(y)&&I(b)?[4,this.__prepareRoleP2PGroup(o,y.id,g,l,{groupMetadata:c})]:[3,6];case 5:T=M.sent(),y=T,t=T.id,M.label=6;case 6:Us.notEmpty("entityId",t,"entityId not found"),E={metadata:h,priority:p,senderId:g,originalMetadata:O},E=this.__normalizeSendOptions(E,{counterParty:y,senderOrganizationId:s}),h=E.metadata,(A=this.__createNewMessage(y,i,wu({organizationId:o,senderOrganizationId:s,recipientOrganizationId:u,isForwarded:!0},E))).attachments=r,this.__setForwardedMessageProperties({origMessage:n,organizationId:o,message:A}),this.host.events.deferEventQueue(),this.host.models.Message.inject(A),this.host.emit("message:sending",A),M.label=7;case 7:return M.trys.push([7,12,,13]),[4,this.host.api.messages.forward(a,t,{localId:A.id,metadata:h,priority:Co.toServer(p),recipientOrganizationId:u,senderOrganizationId:s})];case 8:return R=M.sent(),P=R.message_id,v?[4,this.find(P,{instance:A,replace:!0})]:[3,10];case 9:return A=M.sent(),[3,11];case 10:A.senderStatus=jo.SENT,A.serverId=P,A.$synced=void 0,this.host.models.Message.inject(A),M.label=11;case 11:return this.host.emit("message:sent",A),[3,13];case 12:return S=M.sent(),this.logger.error("error while forwarding message",S),A.senderStatus=jo.FAILED,this.host.models.Message.inject(A),[3,13];case 13:return this.host.events.resumeEventQueue(),[2,A]}}))}))},t.prototype.__setForwardedMessageProperties=function(e){var t=e.origMessage,n=e.organizationId,r=e.message,o=t.createdAt,i=t.currentSenderRole,s=t.originalForwardedMessageCreatedAt,a=t.originalMessageId,u=t.originalSender,c=t.originalSenderRole,l=t.sender,d=t.senderRole,h=t.serverId,p=t.subType;return r.originalForwardedMessageCreatedAt||(r.originalForwardedMessageCreatedAt=s||o),r.originalMessageId||(r.originalMessageId=a||h),r.originalSender?r.originalSender=u:l&&(r.originalSender={displayName:l.displayName,id:l.id,organizationId:n}),r.originalSenderRole||(p===Mo.ROLE_AWAY_NOTIFICATION&&i?r.originalSenderRole={$entityType:"role",botUserId:i.botUserId,displayName:i.displayName,id:i.id,organizationId:n}:c?r.originalSenderRole=wu({},c):d&&(r.originalSenderRole=wu({},d))),r.subType||(r.subType=p),r},t.prototype.reactToMessageStatusEvent=function(e){var t=e.data;if(this.config.condensedReplays)this.reactToMessageStatusEventCR({data:t});else{var n=(t=Rs(t)).client_id,r=t.is_recalled,o=this.host.models.Message.get(n);o&&(r?this.host.models.Message.eject(o):(this.__injectMessageStatus(o,t),Po[o.markedRecipientStatus]<Po[So.DELIVERED]&&this.markAsReceived(o)))}},t.prototype.reactToMessageStatusEventCR=function(e){var t=e.data,n=(t=Rs(t)).client_id,r=t.is_recalled,o=t.is_unread,i=this.host.models.Message.get(n);if(i){t.conversation_id||(t.conversation_id=i.conversationId);var s=this.host.conversations.getById(t.conversation_id);s&&(r?this.host.models.Message.eject(i):(i.shouldEnsureRecipientStatus=!0,void 0!==o&&(i.isUnread=o),this.host.models.Message.inject(i),s._markingAsReadSortNumber&&i.sortNumber>=s._markingAsReadSortNumber&&this.host.conversations.__clearOptimisticStatus([s])),this.host.conversations.__injectConversation(t))}},t.prototype.__injectMessageStatus=function(e,t){if(e){var n=t.account_id||t.accountId,r={createdAt:t.timestamp||t.createdAt,id:e.id+":"+n,messageId:e.id,status:So.resolve(t.status)};return"distributionList"===e.counterPartyType?r.distributionListId=n:(r.userId=n,this.host.models.User.ensureEntity(n,{onlyPlaceholder:!0})),this.host.models.MessageStatusPerRecipient.inject(r)}},t.prototype._findCR=function(e,t){var n=void 0===t?{}:t,r=n.includeCounterParty,o=void 0===r||r,i=n.includeStatuses,s=void 0===i||i,a=n.instance,u=n.replace,c=void 0!==u&&u;return Ou(this,void 0,void 0,(function(){var t,n,r,i,u,l;return Tu(this,(function(d){switch(d.label){case 0:return this.host.requireUser(),[4,this.host.api.messages.find(e)];case 1:return(t=d.sent())&&(n=t.message)?(n.conversationId=t.conversation_id,a&&c&&this.__setDefaultAttributes(n,{instance:a}),o?(r=n.recipient_token,i=n.sender_organization,[4,this.__lookupCounterParty(r,{organizationId:i})]):[3,3]):[2,null];case 2:if(!(u=d.sent()))return[2,null];n.counterParty=u,n.conversationHandle||(n.conversationHandle=this.host.conversations.getConversationKey(u.$entityType,u.serverId,i)),d.label=3;case 3:return(l=c?this.host.models.Message.replaceExisting(n,{instance:a}):this.host.models.Message.inject(n)).$synced=void 0,s?[4,this.findRecipientStatus(l,{queue:!1})]:[3,5];case 4:d.sent(),d.label=5;case 5:return[2,l]}}))}))},t.prototype.find=function(e,t){var n=void 0===t?{}:t,r=n.includeCounterParty,o=void 0===r||r,i=n.includeStatuses,s=void 0===i||i,a=n.instance,u=n.replace,c=void 0!==u&&u;return Ou(this,void 0,void 0,(function(){var t,n,r,i,u;return Tu(this,(function(l){switch(l.label){case 0:return this.config.condensedReplays?[4,this._findCR(e,{includeCounterParty:o,includeStatuses:s,instance:a,replace:c})]:[3,2];case 1:return[2,l.sent()];case 2:return this.host.requireUser(),[4,this.host.api.messages.find(e)];case 3:return(t=l.sent())?(a&&c&&this.__setDefaultAttributes(t,{instance:a}),o?(n=t.recipient_token,r=t.sender_organization,[4,this.__lookupCounterParty(n,{organizationId:r})]):[3,5]):[2,null];case 4:if(!(i=l.sent()))return[2,null];t.counterParty=i,this.config.condensedReplays||t.conversationId||(t.conversationId=this.host.conversations.getConversationKey(i.$entityType,i.serverId,r)),l.label=5;case 5:return(u=c?this.host.models.Message.replaceExisting(t,{instance:a}):this.host.models.Message.inject(t)).$synced=void 0,s?[4,this.findRecipientStatus(u,{queue:!1})]:[3,7];case 6:l.sent(),l.label=7;case 7:return[2,u]}}))}))},t.prototype.findAttachment=function(e,t){return Ou(this,void 0,void 0,(function(){var n,r,o;return Tu(this,(function(i){switch(i.label){case 0:return n=this._resolveMessage(e),r=!1,n?[3,2]:(r=!0,[4,this.find(e,{includeStatuses:!1,includeCounterParty:!1})]);case 1:n=i.sent(),i.label=2;case 2:return n?!(o=this.__getMessageAttachment(n,t))||o.isLocal||r||"name"in o?[3,4]:[4,this.find(e,{includeStatuses:!1,includeCounterParty:!1})]:[2,null];case 3:n=i.sent(),(o=this.__getMessageAttachment(n,t)).name||(o.name=null),i.label=4;case 4:return[2,o]}}))}))},t.prototype.getById=function(e){return this.host.models.Message.get(e)},t.prototype.getMultiById=function(e){return this.host.models.Message.getMulti(e)},t.prototype.__lookupCounterParty=function(e,t){var n=(void 0===t?{}:t).organizationId;return Ou(this,void 0,void 0,(function(){var t,r,o,i,s,a,u,c,l,d=this;return Tu(this,(function(h){switch(h.label){case 0:for(t=[{model:this.host.models.User,finder:function(){return d.host.users.find(e,{organizationId:n})}},{model:this.host.models.Group,finder:function(){return d.host.groups.find(e)}},{model:this.host.models.DistributionList,finder:function(){return d.host.distributionLists.find(e)}}],r=0,o=t;r<o.length;r++)if(i=o[r].model,c=i.get(e))return[2,c];s=0,a=t,h.label=1;case 1:if(!(s<a.length))return[3,6];u=a[s].finder,h.label=2;case 2:return h.trys.push([2,4,,5]),[4,u()];case 3:return(c=h.sent())?[2,c]:[3,5];case 4:if((l=h.sent()).code!==C.CODE)throw l;return[3,5];case 5:return s++,[3,1];case 6:return[2,null]}}))}))},t.prototype._isMessageOutgoing=function(e){var t=e.counterParty,n=e.counterPartyType,r=e.currentSenderRole,o=e.senderId;if(!o)return!1;for(var i=this.host,s=i.currentUser,a=i.currentUserId,u=t||{},c=u.groupType,l=u.members,d=u.p2pRecipient,h=u.p2pSender,p="group"===n&&c===Ao.ROLE_P2P,f=s.roles,v=[a],y=[],g=0,m=0,_=f;m<_.length;m++){var b=_[m].botUserId;v.push(b)}if(l){for(var w=0,I=l;w<I.length;w++){var O=I[w],T=O.botRole;O.isRoleBot&&T&&!y.includes(T)&&y.push(T)}if(p){if(h){T=h.botRole;h.isRoleBot&&T&&!y.includes(T)&&y.push(T)}if(d){T=d.botRole;d.isRoleBot&&T&&!y.includes(T)&&y.push(T)}}for(var E=0,A=y;E<A.length;E++){var C=A[E];f.includes(C)&&g++}}return p?!(d===s&&o===a&&!r)&&(!(!h||o!==h.id&&o!==h.botUserId)||f.includes(r)&&(1===g||r===h)):"distributionList"===n||(f.includes(r)||v.includes(o))},t.prototype._setRecipientStatus=function(e){for(var t,n,r=e.__organizationId,o=e._markingAsStatus,i=e.conversation,s=e.counterParty,a=e.counterPartyType,u=e.createdAt,c=e.deleteOnRead,l=e.expiresAt,d=e.isOutgoing,h=e.messageType,p=e.senderId,f=e.statusesPerRecipient,v=e.ttl,y=this.host,g=y.currentUser,m=y.currentUserId,_=s||{},b=_.groupType,w=_.p2pRecipient,I=[],O=[],T=[m],E=0,A=g.roles;E<A.length;E++){var C=A[E];C.organizationId===r&&T.push(C.botUserId)}for(var R=p&&T.includes(p),P=[],S=So.READ,j=So.NEW,M=b===Ao.ROLE_P2P&&w===g,z=0,k=f;z<k.length;z++){var N=(q=k[z]).userId;(F=T.includes(N))&&P.push(N)}for(var x=P.length>1,U=0,L=f;U<L.length;U++){var q,D=(q=L[U]).distributionListId,B=(N=q.userId,q.status),F=T.includes(N);M||!(!d&&F)&&!(d&&(D||!F))||x&&N===m||O.push(B),(M||R&&T.includes(p))&&(Po[j]<Po[B]&&(j=B),Po[j]<Po[So.READ]&&(j=So.READ)),!F||M||R&&p===N||I.push(B)}if(O.length>0){n=O[0];for(var G=1;G<O.length;G++){var V=O[G];0===P.length?Po[n]<Po[V]&&(n=V):Po[n]>Po[V]&&(n=V)}}else n=j;if(t=S,I.length>0)for(var K=0,H=I;K<H.length;K++){V=H[K];Po[t]>Po[V]&&(t=V)}if(this.config.condensedReplays&&i&&i._markingAsRead&&i._markingAsReadSortNumber>=e.sortNumber&&(n=So.READ),o){var $=!1;Po[n]<Po[o]&&(n=o,$=!0),!this.config.condensedReplays&&d&&Po[t]<Po[o]&&(t=o,$=!0),$||this.config.condensedReplays||(e._markingAsStatus=void 0)}if(c&&"user"===a&&n===So.READ){var W=Date.now()+6e4;(!l||W<l)&&(l=W)}else l||void 0===v||(l=u.getTime()+60*v*1e3);e.expiresAt=l,this.config.condensedReplays?e.isUnread=!e.isEphemeral&&e.isUnread:(e.isUnread=!e.isEphemeral&&h===zo.USER_SENT&&!d&&-1===this.compareRecipientStatus(n,So.READ),e.markedRecipientStatus=t),e.ttl=v},t.prototype.compareRecipientStatus=function(e,t){return So.isValid(e)&&(e=Po[e]),So.isValid(t)&&(t=Po[t]),e>t?1:e===t?0:e<t?-1:void 0},t.prototype.__getMessageAttachment=function(e,t){var n=this._resolveMessage(e);return n?(t=t.toString(),n.attachments?_.a.find(n.attachments,{id:t}):null):null},t.prototype.__getAttachmentPath=function(e,t){return"/"+this.host.api.messages.getVersion().version+"/message/"+e+"/attachment/"+t},t.prototype.downloadAttachmentUrl=function(e,t){return this._downloadAttachmentBlobAndUrl(e,t).then((function(e){return e.url}))},t.prototype.downloadAttachmentBlobAndUrl=function(e,t){return this._downloadAttachmentBlobAndUrl(e,t)},t.prototype.downloadAttachmentUrlWithToken=function(e,t){return this._downloadAttachmentBlobAndUrlWithToken(e,t).then((function(e){return e.url}))},t.prototype.downloadAttachment=function(e,t,n){var r=(void 0===n?{}:n).fileName;return Ou(this,void 0,void 0,(function(){var e,n,o,i;return Tu(this,(function(s){switch(s.label){case 0:return[3,5];case 1:return[4,this._downloadAttachmentBlobAndUrl(e.serverId,t)];case 2:n=s.sent().blob,s.label=3;case 3:return(r=r||o.name)||(r="Attachment",e.sender.$placeholder||(r+=" from "+e.sender.displayName),r+=" at "+ia()(e.createdAt).format("YYYY-MM-DD h-mma"),(i=Ji({mime:o.contentType}))&&(r+=i.ext)),[4,Ts({attachmentContentType:o.contentType,blob:n,fileName:r})];case 4:return s.sent(),[3,6];case 5:U.raise(),s.label=6;case 6:return[2]}}))}))},t.prototype._downloadAttachmentBlobAndUrl=function(e,t){return Ou(this,void 0,void 0,(function(){var e,n,r;return Tu(this,(function(o){switch(o.label){case 0:return[3,5];case 1:if(!(n=o.sent()))throw new C("MessageAttachment",e.serverId+":"+t);return n.isLocal&&n.localFile instanceof Blob?[4,n.localPathPromise]:[3,3];case 2:return o.sent(),[2,{blob:n.localFile,url:URL.createObjectURL(n.localFile)}];case 3:return r=this.__getAttachmentPath(e.serverId,t),[2,this.httpClient.downloadFileBlobAndUrl(r)];case 4:return[3,6];case 5:U.raise(),o.label=6;case 6:return[2]}}))}))},t.prototype._downloadAttachmentBlobAndUrlWithToken=function(e,t){return Ou(this,void 0,void 0,(function(){var e,n,r,o;return Tu(this,(function(i){switch(i.label){case 0:return[3,6];case 1:if(!(n=i.sent()))throw new C("MessageAttachment",e.serverId+":"+t);return n.isLocal&&n.localFile instanceof Blob?[4,n.localPathPromise]:[3,3];case 2:return r=i.sent(),[2,{blob:n.localFile,url:r}];case 3:return[4,this.getAttachmentUrlWithToken(e.serverId,t)];case 4:return o=i.sent(),[2,this.httpClient.downloadFileBlobAndUrl(o)];case 5:return[3,7];case 6:U.raise(),i.label=7;case 7:return[2]}}))}))},t.prototype.downloadAttachmentToFile=function(e,t,n){return Ou(this,void 0,void 0,(function(){var r,o,i;return Tu(this,(function(s){switch(s.label){case 0:return t=t.toString(),r=this._resolveMessage(e),[4,this.findAttachment(e,t)];case 1:if(!(o=s.sent()))throw new C("MessageAttachment",r.serverId+":"+t);if(/(\/|\\)$/.test(n)){if(!o.name)throw new Error("missing file name in downloadAttachmentToFile(..., dest)");n+=o.name}return i=this.__getAttachmentPath(r.serverId,t),[2,this.httpClient.downloadToFile(i,n)];case 2:U.raise(),s.label=3;case 3:return[2]}}))}))},t.prototype.getMessageCount=function(){return this.host.models.Message.getAll().length},t.prototype.getTotalUnreadCount=function(){var e=this.host.models.Product.getAll()[0];return e?e.unreadCount:0},t.prototype.getTotalUnreadPriorityCount=function(){var e=this.host.models.Product.getAll()[0];return e?e.unreadPriorityCount:0},t.prototype.markAsRead=function(e,t){var n=void 0===t?{}:t,r=n.localOnly,o=void 0!==r&&r,i=n.queue,s=void 0===i?this.host.currentlyServingOfflineMessages:i;return Ou(this,void 0,void 0,(function(){var t,n,r,i,a;return Tu(this,(function(u){if(e=Ls.call(e).map(this._resolveModelId),0===(t=ta.a.call(e)).length)return[2];if(this.config.condensedReplays||!o)return s?[2,this.__queueSetMessageStatuses({readIds:t})]:[2,this.__setMessagesStatus({readIds:t})];for(n=this.host.models.Message.getMulti(t),r=0,i=n;r<i.length;r++)(a=i[r])&&(a._markingAsStatus=So.READ,this.host.models.Message.inject(a));return[2]}))}))},t.prototype.markAsDelivered=function(e,t){return void 0===t&&(t={}),Ou(this,void 0,void 0,(function(){var n;return Tu(this,(function(r){return t=_.a.defaults(t,{queue:this.host.currentlyServingOfflineMessages}),e=Ls.call(e).map(this._resolveModelId),0===(n=ta.a.call(e)).length?[2]:t.queue?[2,this.__queueSetMessageStatuses({deliveredIds:n})]:[2,this.__setMessagesStatus({deliveredIds:n})]}))}))},t.prototype.markAsReceived=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ou(this,void 0,void 0,(function(){return Tu(this,(function(t){return[2,this.markAsDelivered.apply(this,e)]}))}))},t.prototype.__queueSetMessageStatuses=function(e){var t=e.deliveredIds,n=e.readIds;return Ou(this,void 0,void 0,(function(){var e;return Tu(this,(function(r){return e=this._queuedSetMessageStatuses,t&&(e.deliveredIds=_.a.union(e.deliveredIds,t)),n&&(e.readIds=_.a.union(e.readIds,n)),e.deliveredIds.length+e.readIds.length>=this.config.flushSetMessageStatusMaxCount?(this.logger.log("reached "+this.config.flushSetMessageStatusMaxCount+" -- flushing"),[2,this.__flushSetMessageStatusesQueue()]):(this._throttled_flushSetMessageStatusesQueue(),[2])}))}))},t.prototype.__setMessagesStatus=function(e){var t=e.deliveredIds,n=void 0===t?[]:t,r=e.readIds,o=void 0===r?[]:r;return Ou(this,void 0,void 0,(function(){var e,t,r,i,s,a,u,c,l,d,h,p,f,v,y,g,m,b,w,I,O,T,E;return Tu(this,(function(A){switch(A.label){case 0:if(this.host.requireUser(),n=n.map(this._resolveModelId),o=o.map(this._resolveModelId),e=ta.a.call(n),t=ta.a.call(o),this.config.condensedReplays?e=_.a.difference(e,t):(r=this.host.models.Message.getMulti(e).filter((function(e){return e&&Po[e.markedRecipientStatus]>=Po[So.DELIVERED]})),i=r.map((function(e){return e.id})),s=this.host.models.Message.getMulti(t).filter((function(e){return e&&Po[e.markedRecipientStatus]>=Po[So.READ]})),a=s.map((function(e){return e.id})),t=_.a.difference(t,a),e=_.a.difference(e,t,i)),u={},e.length>0&&(u.delivered=e),t.length>0)for(u.read=t,I=this.host.models.Message.getMulti(t),c=0,l=I;c<l.length;c++)(E=l[c])&&(E._markingAsStatus=So.READ,this.host.models.Message.inject(E));if(0===Object.keys(u).length)return[2,!1];A.label=1;case 1:return A.trys.push([1,3,,4]),[4,this.host.api.messages.updateRecipientStatusMulti(u)];case 2:if(d=A.sent(),this.config.condensedReplays)for(h=0,p=Object.entries(d);h<p.length;h++)f=p[h],v=f[0],y=f[1],g=y.unread_message_count,m=y.unread_priority_message_count,(b=this.host.models.Conversation.get(v))&&(b.unreadMessageCount=g,b.unreadPriorityMessageCount=m,this.host.models.Conversation.inject(b));return[3,4];case 3:for(w=A.sent(),I=this.host.models.Message.getMulti(t),O=0,T=I;O<T.length;O++)(E=T[O])&&E._markingAsStatus&&(E._markingAsStatus=void 0,this.host.models.Message.inject(E));return[2,Promise.reject(w)];case 4:return[2,!0]}}))}))},t.prototype.setMessageTTLInMinutes=function(e,t){var n=this._resolveMessage(e);if(n){var r=ia()().add(t,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}},t.prototype._clearOptimisticMarkAsReadState=function(e){void 0===e&&(e=Date.now()),e.getTime&&(e=e.getTime());for(var t=0,n=this.host.organizations.getAll();t<n.length;t++)for(var r=n[t].__markingAsReadConversations,o=!1;!o&&r.length>0;){var i=r[0],s=this.host.conversations.getById(i.id);if(!s)return;s._markingAsReadExpiration<e?(s._markingAsRead=!1,s._markingAsReadSortNumber=null,s._markingAsReadExpiration=null,this.host.models.Conversation.inject(s),this.host.conversations.find(s.id,{ensureEntities:!1})):o=!0}},t.prototype.ensureRecipientStatus=function(e,t){var n=void 0===t?{}:t,r=n.includeUsers,o=void 0===r||r,i=n.queue,s=void 0===i||i;return Ou(this,void 0,void 0,(function(){var t,n,r,i,a,u,c,l,d,h;return Tu(this,(function(p){switch(p.label){case 0:if(this.host.requireUser(),e=this._resolveModelId(e),!(t=this._resolveMessage(e)))return[2,null];if(n=t.counterPartyType,r=t.senderStatus,i=t.shouldEnsureRecipientStatus,a=t.statusesPerRecipient,r===jo.SENDING)return[2,null];if("distributionList"===n)return[2,null];if(!i&&a.length>0){if(u=!1,o)for(c=0,l=a;c<l.length;c++)l[c].user||(u=!0);if(!u)return[2,a]}return s?[4,this.__queueFindRecipientStatuses([{id:e,includeUsers:o}])]:[3,2];case 1:return h=p.sent(),d=h[0],[3,4];case 2:return[4,this.__findRecipientStatus(e,{includeUsers:o})];case 3:d=p.sent(),p.label=4;case 4:return[2,d]}}))}))},t.prototype.findRecipientStatus=function(e,t){var n=void 0===t?{}:t,r=n.includeUsers,o=void 0!==r&&r,i=n.queue,s=void 0===i||i;return Ou(this,void 0,void 0,(function(){var t,n,r;return Tu(this,(function(i){switch(i.label){case 0:return this.host.requireUser(),(t=this._resolveMessage(e))?t.senderStatus===jo.SENDING||"distributionList"===t.counterPartyType?[2,null]:(e=this._resolveModelId(e),s?[4,this.__queueFindRecipientStatuses([{id:e,includeUsers:o}])]:[3,2]):[2,null];case 1:return r=i.sent(),n=r[0],[3,4];case 2:return[4,this.__findRecipientStatus(e,{includeUsers:o})];case 3:n=i.sent(),i.label=4;case 4:return[2,n]}}))}))},t.prototype.ensureRecipientStatusMulti=function(e,t){var n=void 0===t?{}:t,r=n.includeUsers,o=void 0===r||r,i=n.queue,s=void 0===i||i;return Ou(this,void 0,void 0,(function(){var t,n,r,i,a,u,c,l,d,h,p,f,v,y,g,m,_,b,w;return Tu(this,(function(I){switch(I.label){case 0:for(e=Ls.call(e).map(this._resolveModelId),t=ta.a.call(e),n=[],r={},i=0,a=t;i<a.length;i++){if(w=a[i],y={id:w,includeUsers:o},u=this._resolveMessage(w),c=!0,u&&(l=u.shouldEnsureRecipientStatus,d=u.statusesPerRecipient,!l&&d.length>0&&(c=!1,o)))for(h=0,p=d;h<p.length;h++)p[h].user||(c=!0);c?n.push(y):r[y.id]=u.statusesPerRecipient}return 0===n.length?[2]:s?[4,this.__queueFindRecipientStatuses(n)]:[3,2];case 1:return f=I.sent(),[3,4];case 2:return[4,this.__findRecipientStatusMulti(n)];case 3:f=I.sent(),I.label=4;case 4:if(f)for(v=0;v<n.length;v++)f.length>v&&(y=n[v],g=f[v],r[y.id]=g);for(m=[],_=0,b=t;_<b.length;_++)w=b[_],m.push(r[w]);return[2,m]}}))}))},t.prototype.findRecipientStatusMulti=function(e,t){var n=void 0===t?{}:t,r=n.includeUsers,o=void 0!==r&&r,i=n.queue,s=void 0!==i&&i;return Ou(this,void 0,void 0,(function(){var t,n,r,i,a,u;return Tu(this,(function(c){for(e=Ls.call(e).map(this._resolveModelId),t=ta.a.call(e),n=[],r=0,i=t;r<i.length;r++)a=i[r],u={id:a,includeUsers:o},n.push(u);return 0===n.length?[2]:s?[2,this.__queueFindRecipientStatuses(n)]:[2,this.__findRecipientStatusMulti(n)]}))}))},t.prototype.__queueFindRecipientStatuses=function(e){return Ou(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u;return Tu(this,(function(c){switch(c.label){case 0:for(t=[],n=function(e,n){var o,i,s=!0;t.push(new Promise((function(e,t){o=e,i=t})));for(var a=0,u=r._queuedFindRecipientStatuses;a<u.length;a++){var c=u[a];if(e===c.id){c.includeUsers=c.includeUsers||n,c.onCompletes.push(o),c.onErrors.push(i),s=!1;break}}s&&r._queuedFindRecipientStatuses.push({id:e,includeUsers:n,onCompletes:[o],onErrors:[i]})},r=this,o=0,i=e;o<i.length;o++)s=i[o],a=s.id,u=s.includeUsers,n(a,u);return this._queuedFindRecipientStatuses.length>=this.config.flushFindRecipientStatusMaxCount?(this.logger.log("reached "+this.config.flushFindRecipientStatusMaxCount+" -- flushing"),this.__flushFindRecipientStatusesQueue()):this._queuedFindRecipientStatuses.length>0&&this._throttled_flushFindRecipientStatusesQueue(),[4,Promise.all(t)];case 1:return[2,c.sent()]}}))}))},t.prototype.__flushFindRecipientStatusesQueue=function(){return Ou(this,void 0,void 0,(function(){var e,t,n,r,o,i;return Tu(this,(function(s){switch(s.label){case 0:if(0===this._queuedFindRecipientStatuses.length)return[2];e=this._queuedFindRecipientStatuses,this._queuedFindRecipientStatuses=[],s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,this.__findRecipientStatusMulti(e)];case 2:return n=s.sent(),[3,5];case 3:return r=s.sent(),t=r,[3,5];case 4:for(o=function(r){var o;n&&n.length>r&&(o=n[r]);var i=e[r],s=i.onCompletes,a=i.onErrors;if(t)for(var u=function(e){setTimeout((function(){return e(t)}),0)},c=0,l=a;c<l.length;c++){u(l[c])}else for(var d=function(e){setTimeout((function(){return e(o)}),0)},h=0,p=s;h<p.length;h++){d(p[h])}},i=0;i<e.length;i++)o(i);return[7];case 5:return[2]}}))}))},t.prototype.__findRecipientStatus=function(e,t){var n=t.includeUsers;return Ou(this,void 0,void 0,(function(){var t,r,o,i,s,a,u,c,l,d,h,p,f,v=this;return Tu(this,(function(y){switch(y.label){case 0:if(this.host.requireUser(),t=this._resolveMessage(e),r=!1,this._pendingFindRecipientStatuses[t.id])return[2,null];y.label=1;case 1:return y.trys.push([1,,3,4]),i=new Promise((function(e,n){v._pendingFindRecipientStatuses[t.id]=function(){return e(null)}})),[4,Promise.race([i,this.host.api.messages.findRecipientStatus(t.serverId)])];case 2:return o=y.sent(),[3,4];case 3:return delete this._pendingFindRecipientStatuses[t.id],[7];case 4:if(!o)return[2,null];if(o.is_recalled)return this.host.models.Message.eject(t),[2,null];for(s=0,a=o.statuses;s<a.length;s++)u=a[s],this.__injectMessageStatus(t,u);if(!n)return[3,6];for(c=t.recipientOrganizationId,l=t.statusesPerRecipient,d=[],h=0,p=l;h<p.length;h++)(f=p[h].userId)&&d.push(f);return[4,this.host.users.ensureUsers(d,c)];case 5:y.sent(),r=!0,y.label=6;case 6:return t.shouldEnsureRecipientStatus&&(t.shouldEnsureRecipientStatus=!1,r=!0),r&&this.host.models.Message.inject(t),!this.config.condensedReplays&&Po[t.markedRecipientStatus]<Po[So.DELIVERED]&&this.markAsReceived(t),[2,t.statusesPerRecipient]}}))}))},t.prototype.__findRecipientStatusMulti=function(e){return Ou(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m,b,w,I,O,T,E,A,C,R,P,S,j,M,z,k,N,x,U,L,q;return Tu(this,(function(D){switch(D.label){case 0:for(this.host.requireUser(),t={},n=e,e=[],r=0,o=n;r<o.length;r++)i=o[r],L=i.id,O=i.includeUsers,k=this._resolveMessage(L),a=(s=k||{}).counterParty,u=s.serverId,c={id:L,includeUsers:O,message:k},e.push(c),u&&(this._pendingFindRecipientStatuses[u]||a&&"distributionList"===a.$entityType||(c.id=u,t[u]=!0));l=_.a.chunk(Object.keys(t),20),d={},h={},p=function(e){var t,n,r,o,i,s,a,u,c,l,p,v,y,g,m,_,b,w,I,O;return Tu(this,(function(T){switch(T.label){case 0:t=void 0,T.label=1;case 1:for(T.trys.push([1,,3,4]),n={},r=function(e){f._pendingFindRecipientStatuses[e]=function(){n[e]=!0}},o=0,i=e;o<i.length;o++)p=i[o],r(p);return[4,f.host.api.messages.findRecipientStatusMulti(e)];case 2:for(s=T.sent(),t=[],a=0,u=s;a<u.length;a++)g=u[a],p=g.client_id,n[p]||t.push(g);return[3,4];case 3:for(c=0,l=e;c<l.length;c++)p=l[c],delete f._pendingFindRecipientStatuses[p];return[7];case 4:if(!t)return[2,{value:[]}];for(v=0,y=t;v<y.length;v++)if(g=y[v],m=g.client_id,_=g.statuses,b=f.host.models.Message.get(m),g.is_recalled)f.host.models.Message.eject(b),h[m]=!0;else if(_&&_.length>0){for(w=0,I=_;w<I.length;w++)O=I[w],f.__injectMessageStatus(b,O);d[m]=b}return[2]}}))},f=this,v=0,y=l,D.label=1;case 1:return v<y.length?(g=y[v],[5,p(g)]):[3,4];case 2:if("object"==typeof(m=D.sent()))return[2,m.value];D.label=3;case 3:return v++,[3,1];case 4:b=0,w=e,D.label=5;case 5:if(!(b<w.length))return[3,9];if(I=w[b],O=I.includeUsers,k=I.message,T=!1,!k||h[k.serverId])return[3,8];if(E=k.recipientOrganizationId,A=k.shouldEnsureRecipientStatus,C=k.statusesPerRecipient,!O)return[3,7];for(R=[],P=0,S=C;P<S.length;P++)(j=S[P].userId)&&R.push(j);return[4,this.host.users.ensureUsers(R,E)];case 6:D.sent(),T=!0,D.label=7;case 7:A&&(k.shouldEnsureRecipientStatus=!1,T=!0),T&&this.host.models.Message.inject(k),D.label=8;case 8:return b++,[3,5];case 9:if(!this.config.condensedReplays)for(M=0,z=Object.values(d);M<z.length;M++)k=z[M],Po[k.markedRecipientStatus]<Po[So.DELIVERED]&&this.markAsReceived(k);for(N=[],x=0,U=e;x<U.length;x++)L=U[x].id,q=d[L],N.push(q?q.statusesPerRecipient:null);return[2,N]}}))}))},Iu([Object(zi.decorator)()],t.prototype,"__prepareGroupForUsers",null),Iu([Object(zi.decorator)()],t.prototype,"__prepareRoleP2PGroup",null),Iu([Object(zi.decorator)({serializeArguments:function(e){return e[0]}})],t.prototype,"find",null),Iu([Object(zi.decorator)({memoize:!0})],t.prototype,"downloadAttachmentUrl",null),Iu([Object(zi.decorator)({memoize:!0})],t.prototype,"downloadAttachmentBlobAndUrl",null),Iu([Object(zi.decorator)()],t.prototype,"downloadAttachment",null),Iu([Object(zi.decorator)({memoize:!0})],t.prototype,"_downloadAttachmentBlobAndUrl",null),Iu([Object(zi.decorator)({serializeArguments:function(e){return"object"==typeof e[0]?e[0].id:e[0]}})],t.prototype,"findRecipientStatus",null),Iu([Object(zi.decorator)({serializeArguments:function(e){return e[0].map((function(e){return"object"==typeof e?e.id:e})).join(":")}})],t.prototype,"findRecipientStatusMulti",null),t}(Bs),Su=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ju=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Mu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},zu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},ku=["template_label"].join(","),Nu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Su(t,e),t.prototype.batchDelete=function(e){var t=e.ids,n=e.organizationId;return Mu(this,void 0,void 0,(function(){var e=this;return zu(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))throw new q("ids","required","ids must be an array");if(!n)throw new q("organizationId","required");return[4,this.host.api.messageTemplates.batch({ids:t,operation:"destroy",organizationId:n})];case 1:return r.sent(),[2,t.map((function(t){return e.host.models.MessageTemplate.inject({$deleted:!0,id:t})}))]}}))}))},t.prototype.create=function(e){var t=e.attachment,n=e.body,r=e.network,o=void 0===r?"patient":r,i=e.organizationId,s=e.repository,a=void 0===s?"personal":s,u=e.title;return Mu(this,void 0,void 0,(function(){var e,r,s;return zu(this,(function(c){switch(c.label){case 0:if(e=u?u.trim():"",r=n?n.trim():"",this._validate({body:r,organizationId:i,repository:a,shouldCheckId:!1,title:e}),!1===["patient"].includes(o))throw new q("network","invalid",'network must be "patient"');return[4,this.host.api.messageTemplates.create({attachment:t,body:r,network:o,organizationId:i,repository:a,title:e})];case 1:return s=c.sent(),[2,this.host.models.MessageTemplate.inject(s)]}}))}))},t.prototype.delete=function(e,t){return Mu(this,void 0,void 0,(function(){return zu(this,(function(n){switch(n.label){case 0:return this._validate({id:e,organizationId:t,shouldCheckInvalid:!1}),[4,this.host.api.messageTemplates.delete(e,t)];case 1:return n.sent(),[2,this.host.models.MessageTemplate.inject({$deleted:!0,id:e})]}}))}))},t.prototype.downloadTemplateFile=function(e){var t=e.templateId,n=e.fileName,r=e.organizationId;return Mu(this,void 0,void 0,(function(){var e;return zu(this,(function(o){switch(o.label){case 0:return[4,this.host.api.messageTemplates.downloadTemplateFile({templateId:t,fileName:n,organizationId:r})];case 1:return[4,Ts({attachmentContentType:(e=o.sent()).type,blob:e,fileName:n})];case 2:return o.sent(),[2]}}))}))},t.prototype.find=function(e,t){return Mu(this,void 0,void 0,(function(){var n;return zu(this,(function(r){switch(r.label){case 0:return this._validate({id:e,organizationId:t,shouldCheckInvalid:!1}),[4,this.host.api.messageTemplates.find(e,t)];case 1:return n=r.sent(),[2,this.host.models.MessageTemplate.inject(n)]}}))}))},t.prototype.getAll=function(){return this.host.models.MessageTemplate.getAll()},t.prototype.getById=function(e){return this.host.models.MessageTemplate.get(e)},t.prototype.search=function(e){var t=e.continuation,n=e.network,r=void 0===n?"patient":n,o=e.organizationId,i=e.query,s=void 0===i?"":i,a=e.repository,u=void 0===a?"personal":a,c=e.sortBy,l=void 0===c?"title":c,d=e.sortOrder,h=void 0===d?"asc":d;return Mu(this,void 0,void 0,(function(){var e,n,i,a;return zu(this,(function(c){switch(c.label){case 0:return[4,this.host.search.query({continuation:t,network:r,organizationId:o,query:(i={},i[ku]=s,i.repository=u,i),returnFields:[],sort:(a={},a[l]=h,a),types:["messageTemplate"]})];case 1:return e=c.sent(),n=this._processSearchResults(e.results),[2,{metadata:e.metadata,results:n}]}}))}))},t.prototype.update=function(e){var t=e.attachment,n=e.body,r=e.id,o=e.organizationId,i=e.repository,s=e.title;return Mu(this,void 0,void 0,(function(){var e,a,u;return zu(this,(function(c){switch(c.label){case 0:return e=s?s.trim():"",a=n?n.trim():"",this._validate({body:a,id:r,organizationId:o,repository:i,title:e}),[4,this.host.api.messageTemplates.update({attachment:t,body:a,id:r,organizationId:o,repository:i,title:e})];case 1:return u=c.sent(),[2,this.host.models.MessageTemplate.inject(u)]}}))}))},t.prototype._processSearchResults=function(e){return e.map((function(e){return e.entity})).filter((function(e){return!e.$deleted}))},t.prototype._validate=function(e){var t=e.body,n=e.id,r=(e.network,e.organizationId),o=e.repository,i=e.shouldCheckId,s=void 0===i||i,a=e.shouldCheckInvalid,u=void 0===a||a,c=e.title;if(s&&!n)throw new q("id","required");if(!r)throw new q("organizationId","required");if(u){if(!t||0===t.trim().length)throw new q("body","invalid","body must be at least 1 character");if(!o||!["general","personal"].includes(o))throw new q("repository","invalid",'repository must be either "general" or "personal"');if(!c||0===c.trim().length||c.trim().length>60)throw new q("title","invalid","title must be between 1 and 60 characters")}},ju([Object(zi.decorator)()],t.prototype,"downloadTemplateFile",null),ju([Object(zi.decorator)()],t.prototype,"find",null),ju([Object(zi.decorator)()],t.prototype,"search",null),t}(Bs),xu=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Uu=function(){return(Uu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Lu=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},qu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Du=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Bu=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},Fu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.__parseMessageMetadata=function(e){var t=e.mimetype,n=e.payload,r=t.indexOf(";");if(r>-1&&(t=t.slice(0,r)),"application/json"===t&&"string"==typeof n){var o=void 0;try{o=JSON.parse(n)}catch(t){return console.warn("Invalid metadata payload",e),null}return Uu(Uu({},e),{payload:o})}return e},t}return xu(t,e),t.prototype.fullUpdate=function(e,t,n){return qu(this,void 0,void 0,(function(){var r,o,i,s,a;return Du(this,(function(u){switch(u.label){case 0:if(!n)throw new q("organizationId","required");if(this.host.config.maxMetadataKeyCount>0&&Object.keys(t).length>this.host.config.maxMetadataKeyCount)throw new q("entireData","invalid","Total number of metadata keys is "+Object.keys(t)+" and should not exceed "+this.host.config.maxMetadataKeyCount);for(r=0,o=Object.entries(t);r<o.length;r++)if(i=o[r],s=i[0],"string"!=typeof i[1])throw new q("value","invalid","Value for metadata key "+s+" must be a string");this.host.requireUser(),e=this._resolveModelId(e),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.host.api.metadata.update(e,t,n)];case 2:return u.sent(),this.__injectMetadata(e,n,t),[2,t];case 3:if((a=u.sent()).response&&404===a.response.status)throw new C("metadata",e);return[2,Promise.reject(a)];case 4:return[2]}}))}))},t.prototype.update=function(e,t,n){return qu(this,void 0,void 0,(function(){var r,o;return Du(this,(function(i){switch(i.label){case 0:if(!n)throw new q("organizationId","required");return[4,this.find(e,n,{bypassCache:!0})];case 1:return r=i.sent(),o=Object.assign({},r,t),[2,this.fullUpdate(e,o,n)]}}))}))},t.prototype.find=function(e,t,n){return void 0===n&&(n={}),qu(this,void 0,void 0,(function(){var r,o;return Du(this,(function(i){switch(i.label){case 0:if(!t)throw new q("organizationId","required");if(n=_.a.defaults(n,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),e=this._resolveModelId(e),!n.bypassCache&&(r=this.get(e,t)))return[2,r];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.host.api.metadata.find(e,t)];case 2:return r=i.sent(),this.__injectMetadata(e,t,r),[2,r];case 3:if(!(o=i.sent()).response||404!==o.response.status)return[2,Promise.reject(o)];if(!n.ignoreNotFound)throw new C("metadata",e);return[3,4];case 4:return[2]}}))}))},t.prototype.findMulti=function(e,t,n){return void 0===n&&(n={}),qu(this,void 0,void 0,(function(){var r,o,i,s=this;return Du(this,(function(a){switch(a.label){case 0:if(!t)throw new q("organizationId","required");return this.host.requireUser(),e=_.a.uniq(qs(e).map(this._resolveModelId)),r=_.a.chunk(e,20),o=r.map((function(e){return s.__findMultiPaged(e,t,n)})),[4,Promise.all(o)];case 1:return i=a.sent(),[2,_.a.assign.apply(_.a,Bu([{}],i))]}}))}))},t.prototype.__findMultiPaged=function(e,t,n){return void 0===n&&(n={}),qu(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,l,d,h;return Du(this,(function(p){switch(p.label){case 0:return[4,this.host.api.entities.findMulti({users:[],metadata:e,organizationId:t})];case 1:for(n=p.sent().metadata,r={},o=0,i=n;o<i.length;o++)for(s=i[o],a=0,u=Object.entries(s);a<u.length;a++)c=u[a],l=c[0],(d=c[1])&&(h=this.__injectMetadata(l,t,d),r[l]=h);return[2,r]}}))}))},t.prototype.get=function(e,t){var n="metadata:"+e+":"+t;return this.host.models.Metadata.get(n)||null},t.prototype.__injectMetadata=function(e,t,n){var r="metadata:"+e+":"+t;return this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})},Lu([Object(zi.decorator)()],t.prototype,"find",null),Lu([Object(zi.decorator)()],t.prototype,"findMulti",null),t}(Bs),Gu=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vu=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ku=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Hu=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},$u={account:"user",group:"group"},Wu=new Set(Object.keys($u)),Xu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._parseMuteEntry=function(e){var n,r=+e.mute_duration,o=e.mute_start,i=e.caller_organization||e.organization_id;if(o&&(o=1e3*+o),t.config.condensedReplays)n=e.conversation_id;else{var s=$u[e.sender_type],a=e.sender_token;n=t.host.conversations.getConversationKey(s,a,i)}return{conversationId:n,entry:{durationInMinutes:r,organizationId:i,startedAt:o}}},t._addEntry=function(e,n){var r=n.durationInMinutes,o=n.organizationId,i=n.startedAt,s=void 0===i?Date.now():i,a=+s+60*r*1e3;if(!(a<Date.now())){var u=t.host.models.Mute.inject({id:"mute:"+e,conversationId:e,durationInMinutes:r,expiresAt:a,organizationId:o,startedAt:s});if(t.config.condensedReplays){var c=t.host.conversations.getById(e);if(!c)return u;c.muted=u,t.host.models.Conversation.inject(c)}else t._muteEntriesByConversationHandle[e]=u,t.host.models.Conversation.touch(e);return u}},t._removeEntry=function(e){t.config.condensedReplays||delete t._muteEntriesByConversationHandle[e];var n=t.host.conversations.getById(e);n&&n.muted&&(t.host.models.Mute.eject(n.muted),n.muted=null,t.host.models.Conversation.inject(n))},t}return Gu(t,e),t.prototype.mounted=function(){this._fetched=!1,this._muteEntriesByConversationHandle={}},t.prototype.dispose=function(){this._fetched=!1,this._muteEntriesByConversationHandle=null},t.prototype.findAll=function(){return Ku(this,void 0,void 0,(function(){var e,t,n,r,o,i,s;return Hu(this,(function(a){switch(a.label){case 0:return this._fetched?[3,2]:[4,this.host.api.mute.findAll()];case 1:for(e=a.sent(),t=0,n=e;t<n.length;t++)r=n[t],Wu.has(r.sender_type)&&(o=this._parseMuteEntry(r),i=o.conversationId,s=o.entry,this._addEntry(i,s));this._fetched=!0,a.label=2;case 2:return[2,Object.values(this._muteEntriesByConversationHandle)]}}))}))},t.prototype._removeAllEntries=function(){if(this.config.condensedReplays)for(var e=0,t=this.host.conversations.getAll();e<t.length;e++){var n=t[e];n.muted&&this._removeEntry(n.id)}else for(var r=0,o=Object.keys(this._muteEntriesByConversationHandle);r<o.length;r++){var i=o[r];this._removeEntry(i)}},t.prototype._getByConversationHandle=function(e){var t=this._muteEntriesByConversationHandle[e];return t?t.expiresAt<Date.now()?(delete this._muteEntriesByConversationHandle[e],null):t:null},t.prototype.unmuteAll=function(){return Ku(this,void 0,void 0,(function(){return Hu(this,(function(e){switch(e.label){case 0:return[4,this.host.api.mute.unmuteAll()];case 1:return e.sent(),this._removeAllEntries(),[2]}}))}))},t.prototype.muteConversation=function(e,t){return Ku(this,void 0,void 0,(function(){var n,r,o,i;return Hu(this,(function(s){switch(s.label){case 0:if(this.__validateDurationInMinutes(t),e=this._resolveModelId(e),!(n=this._resolveEntity(e,"conversation")))throw new Error("conversation "+e+" not found");return e=n.id,r=n.counterPartyId,o=n.counterPartyType,i=n.organizationId,"user"!==o?[3,2]:[4,this.host.api.mute.muteUser(r,t,i,{recipientOrganizationId:i})];case 1:return s.sent(),this._addEntry(e,{durationInMinutes:t,organizationId:i}),[3,4];case 2:return"group"!==o?[3,4]:[4,this.host.api.mute.muteGroup(r,t,i)];case 3:s.sent(),this._addEntry(e,{durationInMinutes:t,organizationId:i}),s.label=4;case 4:return[2]}}))}))},t.prototype.unmuteConversation=function(e){return Ku(this,void 0,void 0,(function(){var t,n,r,o;return Hu(this,(function(i){switch(i.label){case 0:if(!(t=this._resolveEntity(e,"conversation")))throw new Error("conversation "+e+" not found");return e=t.id,n=t.counterPartyId,r=t.counterPartyType,o=t.organizationId,"user"!==r?[3,2]:[4,this.host.api.mute.unmuteUser(n,o,{recipientOrganizationId:o})];case 1:return i.sent(),this._removeEntry(e),[3,4];case 2:return"group"!==r?[3,4]:[4,this.host.api.mute.unmuteGroup(n,o)];case 3:i.sent(),this._removeEntry(e),i.label=4;case 4:return[2]}}))}))},t.prototype.reactToMuteEvent=function(e){var t=e.data;if((t=Rs(t)).token===this.host.currentUser.id){var n=t.action;if("clear"!==n){var r=this._parseMuteEntry(t),o=r.conversationId,i=r.entry;"add"===n?this._addEntry(o,i):this._removeEntry(o)}else this._removeAllEntries()}},t.prototype.getById=function(e){return e.startsWith("mute:")||(e="mute:"+e),this.host.models.Mute.get(e)},t.prototype.__validateDurationInMinutes=function(e){(e<0||e>525600||e%1!=0)&&Us.raise("durationInMinutes","invalid","should be a positive integer from 1 to 525600 (1 year)")},Vu([Object(zi.decorator)()],t.prototype,"findAll",null),t}(Bs),Qu=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yu=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.EVENTS={"message|group_message":function(e){this.host.notifications.reactToMessageEvent(e)},"message:status|group:message:status":function(e){this.host.notifications.reactToMessageStatusEvent(e)},remote_wipe:function(e){this.host.notifications.disconnect({source:"Notifications remote_wipe"}),this.host.notifications.signOut({fromServer:!0})},"sse:heartbeat":function(){return null}};for(var o=0,i=Object.entries(r.EVENTS);o<i.length;o++){var s=i[o],a=s[0],u=s[1];if(a.includes("|")){for(var c=0,l=a.split("|");c<l.length;c++){var d=l[c];r.EVENTS[d]=u}delete r.EVENTS[a]}}return r}return Qu(t,e),t.prototype.emit=function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.info("unhandled event: "+e.type,e.data)},t}(Bs),Ju=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zu=function(){return(Zu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ec=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},tc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},nc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},rc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._emitConnected=function(){r.emit("connected")},r._emitDisconnected=function(e){r.emit("disconnected",e)},r._emitEvent=function(e){r.emit("event",e)},r.events=new su(t,Zu(Zu({},n),{endpointType:"simpleNotifications"})),r}return Ju(t,e),t.prototype.mounted=function(){this.events.mounted(),this.events.on("connected",this._emitConnected),this.events.on("disconnected",this._emitDisconnected),this.events.on("event",this._emitEvent)},t.prototype.dispose=function(){this.events.removeListener("connected",this._emitConnected),this.events.removeListener("disconnected",this._emitDisconnected),this.events.removeListener("event",this._emitEvent),this.events.dispose()},t.prototype.signIn=function(){return tc(this,void 0,void 0,(function(){var e,t,n;return nc(this,(function(r){switch(r.label){case 0:if(!(e=this.host.getAuth())||!e.key||!e.secret)throw new N;return this.emit("signingIn"),this.events.isSignedIn?[3,2]:[4,this.host.api.notifications.signIn(e.key,e.secret)];case 1:t=r.sent(),this.events.setAuth(t),r.label=2;case 2:return n=this.events.getAuth(),this.emit("signedIn",n),[2,n]}}))}))},t.prototype.signOut=function(e){var t=(void 0===e?{}:e).fromServer,n=void 0!==t&&t;return tc(this,void 0,void 0,(function(){var e,t,r;return nc(this,(function(o){switch(o.label){case 0:if(!(e=this.events.getAuth()))return[2,!1];this.emit("signingOut",{fromServer:n}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.host.api.notifications.signOut(e.key,e.secret)];case 2:return o.sent(),t=!0,[3,4];case 3:return r=o.sent(),this.httpClient.isUnauthorizedError(r)?(t=!0,[3,4]):[2,Promise.reject(r)];case 4:return t&&this.events.removeAuth(),this.emit("signedOut",{fromServer:n,signedOut:t}),[2,t]}}))}))},Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return this.events.isSignedIn},enumerable:!1,configurable:!0}),t.prototype.authenticate=function(e,t){return tc(this,void 0,void 0,(function(){return nc(this,(function(n){return this.events.setAuth({key:e,secret:t}),[2]}))}))},t.prototype.connect=function(){return this.events.connect()},t.prototype.disconnect=function(e){var t=(void 0===e?{}:e).source;return this.events.disconnect({source:t})},t.prototype.reconnect=function(){return this.events.reconnect()},Object.defineProperty(t.prototype,"hasConnection",{get:function(){return this.events.hasConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConnected",{get:function(){return this.events.isConnected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.events.isOpen},enumerable:!1,configurable:!0}),t.prototype.reactToMessageEvent=function(e){var t=e.data;t=Rs(t);var n=this.host.models.Message.createInstance(Zu(Zu({},t),{id:O.a.v4()}));this.emit("unread:change",n.unreadMessageCount),this.emit("message",n)},t.prototype.reactToMessageStatusEvent=function(e){this.emit("unread:change",e.unread_message_count)},ec([Object(zi.decorator)({serializeArguments:function(e){return""}})],t.prototype,"signOut",null),t}(Bs),oc=n(12),ic=n.n(oc),sc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ac=function(){return(ac=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},uc=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},cc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},lc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},dc=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},hc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onChangeConversation=function(e,n){var r=n.organization;r&&(t.host.currentlyServingOfflineMessages||t._deferConversationChanges||t.__reloadConversations(r))},t._onChangeUser=function(e,n){for(var r=n.id,o=t.host.models.Organization.getAll(),i=0,s=o;i<s.length;i++){(l=s[i]).autoForwardReceiverId===r&&l.autoForwardReceiver!==n&&t.host.models.Organization.inject(l)}if(n===t.host.currentUser&&!t.host.currentlyServingOfflineMessages&&!t._deferConversationChanges){var a=t.host.currentUser.roles;if(!ic()(a,t._lastMyRoles)){t._lastMyRoles=dc(a);for(var u=0,c=o;u<c.length;u++){var l=c[u];ic()(l.allowedSenders,t._getAllowedSenders(l))||t.host.models.Organization.inject(l)}}}},t.getPreferences=function(e){return cc(t,void 0,void 0,(function(){return lc(this,(function(t){switch(t.label){case 0:if(!e)throw new q("organizationId","required");return[4,this.host.api.organizations.getPreferences(e)];case 1:return[2,t.sent()]}}))}))},t.editPreferences=function(e){var n=e.quickReplies,r=void 0===n?[]:n,o=e.organizationId;return cc(t,void 0,void 0,(function(){return lc(this,(function(e){switch(e.label){case 0:if(!r)throw new q("quickReplies","required");if(!o)throw new q("organizationId","required");return[4,this.host.api.organizations.editPreferences({organizationId:o,quickReplies:r})];case 1:return[2,e.sent()]}}))}))},t}return sc(t,e),t.prototype.mounted=function(){this._deferConversationChanges=!1,this._lastMyRoles=[],this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onChangeConversation),this.host.models.User.on("afterInject",this._onChangeUser)},t.prototype.dispose=function(){this._deferConversationChanges=!1,this._lastMyRoles=[],this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onChangeConversation),this.host.models.User.removeListener("afterInject",this._onChangeUser),zi.decorator.clear(this._findAll)},t.prototype.create=function(e){return void 0===e&&(e={allowPublicGroups:void 0,autologoutTime:void 0,deleteOnRead:void 0,groupLifespan:void 0,lifecycleCallback:void 0,name:void 0,pinLock:void 0,settingsRestricted:void 0,ttl:void 0,welcomeEmailSettings:void 0}),cc(this,void 0,void 0,(function(){var t=this;return lc(this,(function(n){return this.host.requireUser(),[2,this.httpClient.post("/v2/organization",{data:e}).then((function(n){var r=n.getHeader("TT-X-Organization-Key");return t.host.models.Organization.inject({id:r,name:e.name})}))]}))}))},t.prototype.update=function(e){return void 0===e&&(e={allowPublicGroups:void 0,autologoutTime:void 0,autoSendWelcomeEmail:void 0,deleteOnRead:void 0,groupLifespan:void 0,id:void 0,lifecycleCallback:void 0,name:void 0,pinLock:void 0,settingsRestricted:void 0,ttl:void 0,welcomeEmailLogo:void 0,welcomeEmailSettings:void 0}),cc(this,void 0,void 0,(function(){var t,n=this;return lc(this,(function(r){return this.host.requireUser(),t=Ae.underscoreObject({allowPublicGroups:e.allowPublicGroups,autologoutTime:e.autologoutTime,autoSendWelcomeEmail:e.autoSendWelcomeEmail,dor:e.deleteOnRead,groupLifespan:e.groupLifespan,lifecycleCallback:e.lifecycleCallback,name:e.name,pinLock:e.pinLock,settingsRestricted:e.settingsRestricted,ttl:e.ttl,welcomeEmailLogo:e.welcomeEmailLogo,welcomeEmailSettings:e.welcomeEmailSettings}),[2,this.httpClient.post("/v2/organization/:id",{urlParams:{id:e.id},data:t}).then((function(r){return n.host.models.Organization.inject(ac({id:e.id},t))}))]}))}))},t.prototype.findAll=function(e){var t=void 0===e?{}:e,n=t.filter,r=void 0===n?{onlyApproved:!1}:n,o=t.findRoles,i=void 0===o||o;return cc(this,void 0,void 0,(function(){var e,t=this;return lc(this,(function(n){switch(n.label){case 0:return this.host.requireUser(),[4,this._findAll()];case 1:return e=n.sent(),i?[4,this.host.userRoles.findAll()]:[3,3];case 2:n.sent(),n.label=3;case 3:return r.onlyApproved&&(e=_.a.filter(e,{pending:!1})),(e=_.a.sortBy(e,(function(e){return e.name.toLowerCase()}))).forEach((function(e){return t.__reloadConversations(e)})),[2,e]}}))}))},t.prototype.refreshAll=function(){return cc(this,void 0,void 0,(function(){var e;return lc(this,(function(t){switch(t.label){case 0:return zi.decorator.clear(this._findAll),[4,this._findAll()];case 1:return e=t.sent(),[4,this.host.userRoles.refreshAll()];case 2:return t.sent(),[2,e]}}))}))},t.prototype._findAll=function(){return cc(this,void 0,void 0,(function(){var e,t,n,r,o,i;return lc(this,(function(s){switch(s.label){case 0:return[4,this.host.api.organizations.findAllOfUser(this.host.currentUserId)];case 1:for(e=s.sent(),t=[],n=0,r=e;n<r.length;n++)o=r[n],i=this.host.models.Organization.inject(o),this.host.models.Organization.removePlaceholder({entity:i,attrs:o}),t.push(i);return[2,t]}}))}))},t.prototype.find=function(e,t){return void 0===t&&(t={}),cc(this,void 0,void 0,(function(){var n,r;return lc(this,(function(o){switch(o.label){case 0:return t=_.a.defaults(t,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),t.bypassCache||!(n=this.host.models.Organization.get(e))||n.$placeholder?[4,this.host.api.organizations.find(this.host.currentUserId,e)]:[2,n];case 1:return r=o.sent(),[4,this.host.userRoles.findAll({organizationId:e})];case 2:if(o.sent(),r)n=this.host.models.Organization.inject(r),this.__reloadConversations(n);else if(!t.ignoreNotFound)throw new C(this.host.models.Organization.name,e);return[2,n]}}))}))},t.prototype._getAllowedSenders=function(e){var t=e.id,n=[],r=this.host.currentUser;if(r){for(var o=0,i=r.roles;o<i.length;o++){var s=i[o];s.organizationId===t&&n.push(s)}n.push(r)}return n},t.prototype.getPendingEulas=function(){return cc(this,void 0,void 0,(function(){var e,t;return lc(this,(function(n){switch(n.label){case 0:return[4,this._findAll()];case 1:return e=n.sent(),t=e.filter((function(e){return e.eulaEnabled&&!e.isEulaAccepted})).reduce((function(e,t){var n=t.id,r=t.eulaUrl;return e[r]?e[r].push(n):e[r]=[n],e}),{}),[2,Object.entries(t).map((function(e){return{url:e[0],organizationIds:e[1]}}))]}}))}))},t.prototype.findEulaContent=function(e){return cc(this,void 0,void 0,(function(){return lc(this,(function(t){switch(t.label){case 0:return e=e.replace("http://","https://"),[4,this.httpClient.get(e,{withCredentials:!1,withHeaders:!1,resFormat:"text"})];case 1:return[2,t.sent()]}}))}))},t.prototype.getSettingValue=function(e,t){e=this._resolveModelId(e);var n=this.getById(e);return n?n.getSettingValue(t):null},t.prototype.getAll=function(){return this.host.models.Organization.getAll()},t.prototype.getById=function(e){return this.host.models.Organization.get(e)},t.prototype.getMultiById=function(e){return this.host.models.Organization.getMulti(e)},t.prototype.__reloadConversations=function(e){if(e){for(var t=0,n=0,r=0,o=0,i=0,s=0,a=0,u=0,c=e.conversations;u<c.length;u++){var l=c[u],d=l.highestSortNumber,h=l.unreadCount,p=l.unreadPriorityCount,f=l.lastIncomingMessageSortNumber,v=l.shouldDisplay,y=l.metadata;v&&(t=Math.max(t,d),y&&"patient_messaging"===y.feature_service?(n+=h,i+=p,o+=h,a+=p):(r+=h,s+=p),!this.config.condensedReplays&&f&&(!e.lastIncomingMessageSortNumber||e.lastIncomingMessageSortNumber<f)&&(e.lastIncomingMessageSortNumber=f))}e.highestSortNumber=t,e.unreadCount=r+n,e.unreadPriorityCount=s+i,e.networks.provider.unreadCount=r,e.networks.provider.unreadPriorityCount=s,e.networks.patient.unreadCount=n,e.networks.patient.unreadPriorityCount=i,e.networks.virtualWaitingRoom.unreadCount=o,e.networks.virtualWaitingRoom.unreadPriorityCount=a,this.host.models.Organization.inject(e),e.emit("change")}},t.prototype.reactToOrganizationPreferencesEvent=function(e){this.emit("preferences:change",Ae.camelizeObject(e))},uc([Object(zi.decorator)()],t.prototype,"findAll",null),uc([Object(zi.decorator)()],t.prototype,"refreshAll",null),uc([Object(zi.decorator)({memoize:!0})],t.prototype,"_findAll",null),uc([Object(zi.decorator)()],t.prototype,"find",null),t}(Bs),pc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fc=function(){return(fc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},vc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},yc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},gc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},mc=["patient","user"],_c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.__resolvePatientId=function(e){if("string"!=typeof e){if(!mc.includes(e.$entityType))return e;e=t._resolveModelId(e)}return e.replace("patient:","")},t}return pc(t,e),t.prototype.create=function(e){var t=e.contacts,n=e.dob,r=e.firstName,o=e.lastName,i=e.mrn,s=e.organizationId,a=e.phoneNumber,u=e.gender;return vc(this,void 0,void 0,(function(){var e;return yc(this,(function(c){switch(c.label){case 0:if(!i)throw new q("mrn","required");if(!r)throw new q("firstName","required");if(!o)throw new q("lastName","required");if(!a)throw new q("phoneNumber","required");if(!Fr(a))throw new q("phoneNumber","not a valid format");if(!n)throw new q("dob","required");if(!/^(19|20)\d\d[- /.](0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])$/.test(n))throw new q("dob","not a valid format of YYYY-MM-DD");if(!u)throw new q("gender","required");if(!s)throw new q("organizationId","required");return t&&t.length&&function(e){if(e.length>2)throw new q("contacts count","larger than 2");for(var t=0;t<e.length;t++){var n=e[t],r=n.firstName,o=n.lastName,i=n.phoneNumber,s=n.relation;if(!r)throw new q("contact firstName","required");if(!o)throw new q("contact lastName","required");if(!i)throw new q("contact phoneNumber","required");if(!s)throw new q("contact relation","required")}if(2===e.length&&Object(m.isEqual)(e[0],e[1]))throw new q("contacts being unique","required")}(t),[4,this.host.api.patients.create({contacts:wc(t),dob:n,firstName:r,gender:u,lastName:o,mrn:i,organizationId:s,phoneNumber:Kr(a)})];case 1:return e=c.sent(),[2,this.host.models.User.inject(e.entity)]}}))}))},t.prototype.update=function(e){var t=e.currentEditVersion,n=e.dob,r=e.firstName,o=e.patientId,i=e.lastName,s=e.organizationId,a=e.phoneNumber,u=e.gender;return vc(this,void 0,void 0,(function(){var e;return yc(this,(function(c){switch(c.label){case 0:if(!t)throw new q("currentEditVersion","required");if(!s)throw new q("organizationId","required");if(!o)throw new q("patientId","required");return[4,this.host.api.patients.update({dob:n,editVersion:bc(t),firstName:r,gender:u,patientId:o,lastName:i,organizationId:s,phoneNumber:Kr(a)})];case 1:return e=c.sent(),[2,this.host.models.User.inject(e.entity)]}}))}))},t.prototype.delete=function(e,t){return vc(this,void 0,void 0,(function(){var n;return yc(this,(function(r){switch(r.label){case 0:if(!t)throw new q("organizationId","required");return(n=this.host.models.Patient.get(e))&&this.host.models.Patient.eject(n),[4,this.host.api.patients.delete(e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype.createContact=function(e){var t=e.firstName,n=e.lastName,r=e.organizationId,o=e.patientId,i=e.phoneNumber,s=e.relation;return vc(this,void 0,void 0,(function(){var e;return yc(this,(function(a){switch(a.label){case 0:if(!o)throw new q("patientId","required");if(!t)throw new q("firstName","required");if(!n)throw new q("lastName","required");if(!i)throw new q("phoneNumber","required");if(!Fr(i))throw new q("phoneNumber","not a valid format");if(!s)throw new q("relation","required");if(!r)throw new q("organizationId","required");return[4,this.host.api.patients.createContact({firstName:t,lastName:n,organizationId:r,patientId:o,phoneNumber:Kr(i),relation:s})];case 1:return e=a.sent(),[2,this.host.models.User.inject(e.entity)]}}))}))},t.prototype.updateContact=function(e){var t=e.contactId,n=e.currentEditVersion,r=e.firstName,o=e.lastName,i=e.organizationId,s=e.patientId,a=e.phoneNumber,u=e.relation;return vc(this,void 0,void 0,(function(){var e;return yc(this,(function(c){switch(c.label){case 0:if(!n)throw new q("currentEditVersion","required");if(!i)throw new q("organizationId","required");if(!s)throw new q("patientId","required");if(!t)throw new q("contactId","required");if(!r)throw new q("firstName","required");if(!o)throw new q("lastName","required");if(!a)throw new q("phoneNumber","required");if(!Fr(a))throw new q("phoneNumber","not a valid format");if(!u)throw new q("relation","required");return[4,this.host.api.patients.updateContact({contactId:t,editVersion:bc(n),firstName:r,lastName:o,organizationId:i,patientId:s,phoneNumber:Kr(a),relation:u})];case 1:return e=c.sent(),[2,this.host.models.User.inject(e.entity)]}}))}))},t.prototype.deleteContact=function(e){var t=e.contactId,n=e.organizationId,r=e.patientId;return vc(this,void 0,void 0,(function(){var e;return yc(this,(function(o){switch(o.label){case 0:if(!t)throw new q("contactId","required");if(!n)throw new q("organizationId","required");if(!r)throw new q("patientId","required");return[4,this.host.api.patients.deleteContact({contactId:t,patientId:r,organizationId:n})];case 1:return o.sent(),(e=this.host.models.PatientContact.get("patientContact:"+t))&&this.host.models.PatientContact.eject(e),[2]}}))}))},t.prototype.login=function(e){var t=e.accessToken,n=e.dateOfBirth,r=e.linkToken,o=e.sessions;return vc(this,void 0,void 0,(function(){var e,i,s,a,u,c;return yc(this,(function(l){switch(l.label){case 0:return this.host.emit("signingIn"),[4,this.host.api.patients.login(r,t,n,o)];case 1:return e=l.sent(),i=e.api_key,s=e.api_secret,a=e.group_id,u=e.organization_id,this.host.configure({events:fc(fc({},this.host.config.events),{singleConversation:a})}),this.host._setAuth({key:i,secret:s}),this.host.setDefaultOrganization(u),[4,this.host.users.findMe({ignoreNotFound:!0})];case 2:return c=l.sent(),this.host._setCurrentUser(c),this.host.emit("signedIn",c,this.host.getAuth()),this.host.messages._fetchAttachmentTokens(),[2,e]}}))}))},t.prototype.loginCheck=function(e){var t=e.linkToken,n=e.sessions;return vc(this,void 0,void 0,(function(){return yc(this,(function(e){return[2,this.host.api.patients.loginCheck(t,n)]}))}))},t.prototype.requestAccessToken=function(e){return vc(this,void 0,void 0,(function(){return yc(this,(function(t){return[2,this.host.api.patients.requestAccessToken(e)]}))}))},t.prototype.csvUpload=function(e,t){return vc(this,void 0,void 0,(function(){return yc(this,(function(n){return[2,this.host.api.patients.csvUpload(e,t)]}))}))},t.prototype.getWhiteLabel=function(e){return vc(this,void 0,void 0,(function(){return yc(this,(function(t){return[2,this.host.api.patients.getWhiteLabel(e)]}))}))},t.prototype.setWhiteLabel=function(e,t){return vc(this,void 0,void 0,(function(){return yc(this,(function(n){return[2,this.host.api.patients.setWhiteLabel(e,t)]}))}))},t.prototype._createPatientGroupMetadata=function(e){var t=e.displayName,n=e.patient,r=e.id;return{feature_service:"patient_messaging",is_patient_contact:"false",patient_dob:n.dob,patient_gender:n.gender,patient_id:r,patient_mrn:n.mrn,patient_name:t,phone_number:n.phoneNumber,sms_opted_out:n.smsOptedOut}},t.prototype._createPatientContactGroupMetadata=function(e){var t=e.patient,n=e.patientContact,r=e.id,o=t.dob,i=t.gender,s=t.mrn,a=t.user,u=n.phoneNumber,c=n.relation,l=n.smsOptedOut;return{feature_service:"patient_messaging",is_patient_contact:"true",patient_contact_id:r,patient_dob:o,patient_gender:i,patient_id:a.id,patient_mrn:s,patient_name:a.displayName,phone_number:u,relation_name:c,sms_opted_out:l}},t.prototype.getAll=function(){return this.host.models.Patient.getAll()},t.prototype.getById=function(e){return e=this.__resolvePatientId(e),this.host.models.Patient.get("patient:"+e)},t}(Bs);function bc(e){if(null==e)throw new q("version","of type string or number");return"string"==typeof e?parseInt(e)+1:e+1}function wc(e){return void 0===e&&(e=[]),e.map((function(e){var t=e.phoneNumber,n=gc(e,["phoneNumber"]);return fc(fc({},n),{phoneNumber:Kr(t)})}))}var Ic=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ic(t,e),t.prototype.mounted=function(){this._data={}},t.prototype.dispose=function(){this._data=null},t.prototype.reactToPresenceEvent=function(e){var t=e.data;this.set(t.from,Lo.resolve(t.type))},t.prototype.set=function(e,t){if(this._data[e]!==t){this._data[e]=t;var n=this.host.models.User.inject({id:e,presence:t});this.emit("change",{presence:t,user:n,userId:e})}},t.prototype.get=function(e){return e===this.host.currentUserId?Lo.AVAILABLE:this._data[e]||Lo.UNKNOWN},t}(Bs),Tc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ec=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ac=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Cc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Rc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._addProcessingEvent=function(e){var n=t.host.models.Product.getAll()[0];if(n){var r=e.actionType,o=e.entity;r===qo.ROLE_OPT_IN&&n.rolesOptingIn.push(o.id),n.activeProcessingEvents.push(e),t.host.models.Product.inject(n),t.emit("processing:start",e)}},t._removeProcessingEvent=function(e){var n=t.host.models.Product.getAll()[0];if(n){for(var r=n.activeProcessingEvents,o=n.rolesOptingIn,i=e.actionType,s=e.entity,a=r.length-1;a>=0;a--){var u=r[a];if(i===u.actionType&&s.id===u.entity.id&&(r.splice(a,1),i===qo.ROLE_OPT_IN&&o.includes(s.id)&&o.splice(o.indexOf(s.id),1),i!==qo.MESSAGE_REPLAY))break}t.host.models.Product.inject(n),t.emit("processing:stop",e)}},t._onChangeOrganization=function(e,n){var r=t.host.models.Product.getAll()[0];if(r){var o=t.host.models.Organization.getAll();if(0!==o.length){for(var i={organizations:o},s=0,a=0,u=0,c=0,l=0,d=0,h=o;d<h.length;d++){var p=h[d];p.$placeholder||(s+=p.conversations.length,a+=p.unreadCount,u+=p.unreadPriorityCount,p.networks.virtualWaitingRoom&&(c+=p.networks.patient.unreadCount,l+=p.networks.patient.unreadPriorityCount))}i.conversationCount=s,i.unreadCount=a,i.unreadPriorityCount=u,i.unreadVWRCount=c,i.unreadVWRPriorityCount=l;for(var f=!1,v=0,y=Object.entries(i);v<y.length;v++){var g=y[v],m=g[0],_=g[1];ic()(r[m],_)||(r[m]=_,f=!0)}f&&t.host.models.Product.inject(r)}}},t}return Tc(t,e),t.prototype.mounted=function(){this.host.models.Organization.on("afterInject",this._onChangeOrganization),this.host.models.Organization.on("afterEject",this._onChangeOrganization)},t.prototype.dispose=function(){this.host.models.Organization.removeListener("afterInject",this._onChangeOrganization),this.host.models.Organization.removeListener("afterEject",this._onChangeOrganization)},t.prototype.findAll=function(){return Ac(this,void 0,void 0,(function(){return Cc(this,(function(e){switch(e.label){case 0:return[4,this.host.organizations.findAll()];case 1:return e.sent(),[2,this.getAll()]}}))}))},t.prototype.refreshAll=function(){return Ac(this,void 0,void 0,(function(){return Cc(this,(function(e){switch(e.label){case 0:return[4,this.host.organizations.refreshAll()];case 1:return e.sent(),[2,this.getAll()]}}))}))},t.prototype.getAll=function(){return this.host.models.Product.getAll()},t.prototype.getById=function(e){return this.host.models.Product.get(e)},Ec([Object(zi.decorator)()],t.prototype,"findAll",null),Ec([Object(zi.decorator)()],t.prototype,"refreshAll",null),t}(Bs),Pc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Sc=function(){return(Sc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},jc=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Mc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},zc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},kc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},Nc=["role","user"],xc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.__injectSearchResult=function(e){var n=e.entity,r=e.metadata,o=void 0===r?{}:r,i=e.organizationId;return o=Sc(Sc({},o),{display_name:n.displayName,token:t.__resolveRoleId(n.id)}),t.__injectRoleFromMetadata({metadata:o,organizationId:i})},t.__injectRoleAssignmentEntity=function(e,n,r){return t.__injectRoleFromMetadata({metadata:{display_name:e,meta_type:n.meta_type,owners:n.owner_id,tag_color:n.tag_color,tag_id:n.tag_id,tag_name:n.tag_name,token:n.id},organizationId:r,replaceExisting:!1})},t.__resolveRoleId=function(e){if("string"!=typeof e){if(!Nc.includes(e.$entityType))return e;e=t._resolveModelId(e)}return e.replace("role:","")},t._onChangeConversation=function(e,n){var r=n.counterParty,o=n.counterPartyType,i=r&&r.members&&r.members.length>0;if("group"===o&&i)for(var s=0,a=r.members;s<a.length;s++){var u=a[s];if(u.isRoleBot){var c=t._roleConversations[u.id]||[];if(c.includes(n)||c.push(n),t._roleConversations[u.id]=c,"ROLE_P2P"===r.groupType){var l=t._roleP2PConversations[u.id]||[];l.includes(n)||l.push(n),t._roleP2PConversations[u.id]=l}}}},t._onRemoveConversation=function(e,n){var r=n.counterParty,o=n.counterPartyType,i=r&&r.members&&r.members.length>0;if("group"===o&&i)for(var s=0,a=r.memberIds;s<a.length;s++){var u=a[s],c=t._roleConversations[u],l=c?c.indexOf(n):-1;if(l>-1&&c.splice(l,1),c&&0===c.length&&delete t._roleConversations[u],"ROLE_P2P"===r.groupType){var d=t._roleP2PConversations[u],h=d?d.indexOf(n):-1;h>-1&&d.splice(h,1),d&&0===d.length&&delete t._roleP2PConversations[u]}}},t}return Pc(t,e),t.prototype.mounted=function(){this._previouslyInRoles={},this._roleConversations={},this._roleP2PConversations={},this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onRemoveConversation)},t.prototype.dispose=function(){this._previouslyInRoles={},this._roleConversations={},this._roleP2PConversations={},this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onRemoveConversation)},t.prototype.createP2PGroup=function(e){var t=e.metadata,n=e.name,r=e.organizationId,o=e.recipientId,i=e.replayHistory,s=void 0===i||i,a=e.senderId,u=void 0===a?this.host.currentUserId:a;return Mc(this,void 0,void 0,(function(){var e,i,a,c,l,d,h,p,f,v,y,g,m,_,b,w,I,O,T,E,A=this;return zc(this,(function(C){switch(C.label){case 0:if(this.host.requireUser(),!o)throw new q("recipientId","required");if(!r)throw new q("organizationId","required");for(e=this.host.currentUserId,i=[],a=0,c=[u,o];a<c.length;a++)l=c[a],l=this.host.roles.__resolveRoleId(l),l=this._resolveModelIdWithTypes(l,"user"),i.includes(l)||i.push(l);if(2!==i.length)throw new q("recipientId","same user as senderId");return[4,Promise.all(i.map((function(e){return A.host.users.find(e,{organizationId:r})})))];case 1:return d=C.sent(),n||(n=d.map((function(e){return e.isRoleBot?e.displayName:e.firstName})).filter(Boolean).join(", ")||"Group"),[4,this.host.api.roles.createP2PGroup({createdByUserId:u,memberIds:i,name:n,organizationId:r,replayHistory:s})];case 2:for(h=C.sent(),this.config.condensedReplays?(f=h.entity||h,p=h.conversation_id):f=h,v=0,y=d;v<y.length;v++)if(g=y[v],m=g.botRole,g.isRoleBot&&m&&(_=m.memberIds))for(b=0,w=_;b<w.length;b++)I=w[b],i.includes(I)||i.push(I);return O=f.id||f.token,(T=this.host.models.Group.get(O))&&T.memberIds?E=T.memberIds:(f.members=i,E=i),T=this.host.conversations.__injectCounterParty({conversationId:p,entityAttrs:f,entityType:"group",groupType:Ao.ROLE_P2P,hasCurrentUser:E.includes(e),isPlaceholder:!0,organizationId:r}),t?[4,this.host.metadata.update(T.id,t,r)]:[3,4];case 3:C.sent(),C.label=4;case 4:return[2,T]}}))}))},t.prototype.findAll=function(){return Mc(this,void 0,void 0,(function(){var e,t,n,r=this;return zc(this,(function(o){switch(o.label){case 0:return 0!==(e=this.host.models.Organization.getAll()).length?[3,2]:[4,this.host.organizations.findAll()];case 1:e=o.sent(),o.label=2;case 2:return 0===(e=e.filter((function(e){return e.rolesEnabled}))).length?[2,[]]:[4,this.host.search.query({types:["user"],organizationIds:e.map((function(e){return e.id})),query:{displayName:"",featureService:"role"},followContinuations:!0})];case 3:return t=o.sent().results,n=t.map((function(e){return e.entity})),e.map((function(e){var t=e.id;return r.host.models.Organization.touch(t)})),[2,n]}}))}))},t.prototype.findByOrganizationId=function(e){return Mc(this,void 0,void 0,(function(){var t,n,r;return zc(this,(function(o){switch(o.label){case 0:return e=this._resolveModelId(e),[4,this.host.organizations.find(e)];case 1:return(t=o.sent()).rolesEnabled?[4,this.host.search.query({types:["user"],organizationIds:t.id,query:{displayName:"",featureService:"role"},followContinuations:!0})]:[2,[]];case 2:return n=o.sent().results,r=n.map((function(e){return e.entity})),this.host.models.Organization.touch(e),[2,r]}}))}))},t.prototype.find=function(e,t,n){return void 0===n&&(n={}),Mc(this,void 0,void 0,(function(){var r,o,i;return zc(this,(function(s){switch(s.label){case 0:return this.host.requireUser(),n=_.a.defaults(n,{bypassCache:!1,ignoreNotFound:!1}),e=this.__resolveRoleId(e),t=this._resolveModelId(t),!n.bypassCache&&(r=this.getById(e))?[2,r]:[4,this.host.api.roles.find(e,t)];case 1:if(!(o=s.sent())){if(n.ignoreNotFound)return[2];throw new C(this.host.models.Role.name,e)}return i=this.__injectSearchResult({entity:{id:e,displayName:o.display_name},metadata:o,organizationId:t}),this.host.models.Organization.touch(t),[2,i]}}))}))},t.prototype.saveRole=function(e,t){return Mc(this,void 0,void 0,(function(){return zc(this,(function(n){switch(n.label){case 0:return this.host.requireUser(),t=this._resolveModelId(t),e=this.__resolveRoleId(e),[4,this.host.api.roles.saveRole(e,this.host.currentUserId,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.removeSavedRole=function(e,t){return Mc(this,void 0,void 0,(function(){return zc(this,(function(n){switch(n.label){case 0:return this.host.requireUser(),t=this._resolveModelId(t),e=this.__resolveRoleId(e),[4,this.host.api.roles.removeSavedRole(e,this.host.currentUserId,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.findSavedRoles=function(e,t){return void 0===t&&(t={}),Mc(this,void 0,void 0,(function(){var n,r,o=this;return zc(this,(function(i){switch(i.label){case 0:return t=_.a.defaults(t,{ignoreNotFound:!1}),this.host.requireUser(),e=this._resolveModelId(e),[4,this.host.api.roles.findSavedRoles(this.host.currentUserId,e)];case 1:if(!(n=i.sent())){if(t.ignoreNotFound)return[2];throw new C("saved roles",e)}return r=n.map((function(t){return o.__injectSearchResult({entity:{id:t.token,displayName:t.display_name},metadata:t,organizationId:e})})).filter(Boolean),this.host.models.Organization.touch(e),[2,r]}}))}))},t.prototype.reactToUpdateEventCR=function(e){var t,n=e.entity,r=n.display_name,o=n.metadata,i=n.organizationId;return t="group"===n.type?o.id:n.id,o=Sc(Sc({},o),{display_name:r,token:this.__resolveRoleId(t)}),this.__injectRoleFromMetadata({metadata:o,organizationId:i})},t.prototype.reactToUpdateEvent=function(e){var t,n=e.data,r=n.display_name,o=n.metadata,i=n.organization_key;return t="tigertext:entity:group"===n.type?o.id:n.token,o=Sc(Sc({},o),{display_name:r,token:this.__resolveRoleId(t)}),this.__injectRoleFromMetadata({metadata:o,organizationId:i})},t.prototype.__injectRoleFromMetadata=function(e){var t=e.metadata,n=void 0===t?{}:t,r=e.organizationId,o=e.replaceExisting,i=void 0===o||o,s=n.escalation_policy,a=n.token;if(!a)return null;var u="role:"+a;if(!i){var c=this.host.models.Role.get(u);if(c)return c}var l=this.host.models.Organization.get(r);this.host.metadata.__injectMetadata(a,r,Sc({feature_service:"role"},n)),this.host.models.User.injectPlaceholder({id:a,organizationId:r,displayName:n.display_name});var d={botUserId:a,displayName:n.display_name,id:u,organizationId:r};if(n.description&&(d.description=n.description),s&&s.escalation_path){var h=JSON.parse(JSON.stringify(s));h.id="escalationPolicy:"+a,h.targetId=a;var p=this.host.models.EscalationPolicy.inject(h);d.escalationPolicyId=p.id}else d.escalationPolicyId=null;if(n.room_assignment_id&&(d.assignmentGroupId=n.room_assignment_id),n.owners)if("string"==typeof n.owners)d.memberIds=n.owners.split(","),this.host.models.User.injectPlaceholder({id:n.owners});else{d.memberIds=n.owners.map((function(e){return e.token}));for(var f=0,v=n.owners;f<v.length;f++){var y=v[f];this.host.models.User.injectPlaceholder(y)}}return n.tag_id?(d.roleTagId=r+":"+n.tag_id,this.host.models.RoleTag.inject(Sc(Sc({},_.a.pick(n,"tag_id","tag_color","tag_name")),{id:d.roleTagId,organizationId:r}))):l&&(d.roleTagId=null),this.host.models.Role.inject(d)},t.prototype.__parseRoleFromMetadata=function(e){var t=e.metadata,n=void 0===t?{}:t,r=e.organizationId,o=n.token;if(!o)return null;var i={$entityType:"role",botUserId:o,displayName:n.display_name,id:"role:"+o,organizationId:r},s=null;n.tag_id&&((s={id:r+":"+n.tag_id,organizationId:r,color:n.tag_color,tagId:n.tag_id,name:n.tag_name,displayName:n.tag_name}).color&&(s.color=s.color.replace("0x","#")));return i.roleTag=s,i},t.prototype.getAll=function(){return this.host.models.Role.getAll()},t.prototype.getById=function(e){return e=this.__resolveRoleId(e),this.host.models.Role.get("role:"+e)},t.prototype.refresh=function(e){return Mc(this,void 0,void 0,(function(){var t,n,r,o,i,s,a;return zc(this,(function(u){switch(u.label){case 0:return 0===(t=Object.keys(this._roleConversations)).length?[2]:[4,this.host.entities.findMulti(t,e)];case 1:for(n=u.sent(),r=0,o=n;r<o.length;r++)i=o[r],s=i.entity,a=i.metadata,s&&a&&(a.owners||(a.owners=[]),this.__injectSearchResult({entity:{id:s.token,displayName:s.display_name},metadata:a,organizationId:e}));return[2]}}))}))},t.prototype.reactToFriendsEventCR=function(e){return Mc(this,void 0,void 0,(function(){var t,n,r,o,i,s;return zc(this,(function(a){switch(a.label){case 0:return t=e.action,n=e.attrs,r=n.id,o=n.metadata,i=void 0===o?{}:o,s=n.organizationId,n.action=t,n.token=r,[4,this.__reactToRoleChange(i.id,s,i.triggered_id,n)];case 1:return a.sent(),[2]}}))}))},t.prototype.reactToFriendsEvent=function(e){return Mc(this,void 0,void 0,(function(){var t,n,r,o,i;return zc(this,(function(s){switch(s.label){case 0:return t=e.data.friend,n=t.metadata,r=void 0===n?{}:n,o=t.organization_id,i=kc(t,["metadata","organization_id"]),[4,this.__reactToRoleChange(r.id,o,r.triggered_id,i)];case 1:return s.sent(),[2]}}))}))},t.prototype.__reactToRoleChange=function(e,t,n,r){return Mc(this,void 0,void 0,(function(){var o,i,s,a,u,c,l,d,h,p,f,v,y;return zc(this,(function(g){switch(g.label){case 0:if(t=this._resolveModelId(t),e=this.__resolveRoleId(e),n=this._resolveModelId(n),o=this.host.currentUser,i=r.action,s=r.token,a=function(){return o.roles.some((function(t){return t.botUserId===e}))},u=this._previouslyInRoles[e]||a(),c=r.event_status,"del"===i){if(c&&"end"!==c)return this._previouslyInRoles[e]=u,[2];delete this._previouslyInRoles[e]}return l=this.getById(e),[4,Promise.all([this.find(e,t,{bypassCache:!0,ignoreNotFound:!0}),this.host.users.find(n,{organizationId:t,ignoreNotFound:!0})])];case 1:return d=g.sent(),h=d[0],p=d[1],l||h?((f="del"===i&&l&&!h)&&(h=l,v="role:"+e,this.host.models.Role.inject({id:v,memberIds:[]}),this.host.models.Role.eject(h)),(y=a())&&!u?this.emit("change",{type:"OPT_IN",role:h,target:o,triggeredBy:p}):!y&&u&&(this.host.models.Group.eject(s),this.host.models.User.touch(this.host.currentUserId),this.emit("change",{type:"OPT_OUT",isRoleDeleted:f,role:h,target:o,triggeredBy:p})),[2]):[2]}}))}))},jc([Object(zi.decorator)()],t.prototype,"findAll",null),jc([Object(zi.decorator)()],t.prototype,"findByOrganizationId",null),jc([Object(zi.decorator)()],t.prototype,"find",null),jc([Object(zi.decorator)()],t.prototype,"saveRole",null),jc([Object(zi.decorator)()],t.prototype,"removeSavedRole",null),jc([Object(zi.decorator)()],t.prototype,"findSavedRoles",null),jc([Object(zi.decorator)()],t.prototype,"refresh",null),jc([Object(zi.decorator)()],t.prototype,"__reactToRoleChange",null),t}(Bs),Uc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Lc=function(){return(Lc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},qc=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Dc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Bc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Fc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uc(t,e),t.prototype.findAll=function(e){return void 0===e&&(e={}),Dc(this,void 0,void 0,(function(){var t,n,r=this;return Bc(this,(function(o){switch(o.label){case 0:return e=_.a.defaults(e,{ignoreNotFound:!0,bypassCache:!1}),0!==(t=this.host.models.Organization.getAll()).length?[3,2]:[4,this.host.organizations.findAll()];case 1:t=o.sent(),o.label=2;case 2:return[4,Promise.all(t.map((function(t){return r.findAllForOrganization(t.id,e)})))];case 3:return n=o.sent(),[2,_.a.flatten(n)]}}))}))},t.prototype.findAllForOrganization=function(e,t){return void 0===t&&(t={}),Dc(this,void 0,void 0,(function(){var n,r,o,i=this;return Bc(this,(function(s){switch(s.label){case 0:return t=_.a.defaults(t,{ignoreNotFound:!0,bypassCache:!1}),e=this._resolveModelId(e),(n=this._resolveEntity(e)).rolesEnabled&&n.canAdminRoles?[4,this.host.api.roleTags.findAll(e)]:[2,[]];case 1:if(!(r=s.sent())){if(t.ignoreNotFound)return[2,[]];throw new C("roleTags",e)}return o=r.map((function(t){var n=e+":"+t.tag_id;return i.host.models.RoleTag.inject(Lc(Lc({},t),{id:n,organizationId:e}))})),this.host.models.Organization.touch(e),[2,o]}}))}))},t.prototype.reactToUpdateEventCR=function(e){var t=e.data,n=(t=Rs(t)).entity,r=t.organization_id,o=n.color,i=n.display_name,s=n.id||n.token,a=o.color_id,u=o.color_value;return this.host.models.RoleTag.inject({color:a,colorValue:u,id:r+":"+s,name:i,organizationId:r,tagId:s})},t.prototype.reactToUpdateEvent=function(e){var t=e.data;if(!this.config.condensedReplays||!t.entity){var n=(t=Rs(t)).color,r=t.display_name,o=t.organization_key,i=t.token,s=n.color_id,a=n.color_value;return this.host.models.RoleTag.inject({color:s,colorValue:a,id:o+":"+i,name:r,organizationId:o,tagId:i})}this.reactToUpdateEventCR({data:t})},t.prototype.getAll=function(){return this.host.models.RoleTag.getAll()},t.prototype.getById=function(e){return this.host.models.RoleTag.get(e)},qc([Object(zi.decorator)()],t.prototype,"findAllForOrganization",null),t}(Bs),Gc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vc=function(){return(Vc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Kc=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Hc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},$c=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gc(t,e),t.prototype.batchDelete=function(e){var t=e.ids,n=e.organizationId;return Hc(this,void 0,void 0,(function(){var e=this;return $c(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))throw new q("ids","required","ids must be an array");if(!n)throw new q("organizationId","required");return[4,this.host.api.scheduledMessages.batch({ids:t,operation:"destroy",organizationId:n})];case 1:return r.sent(),[2,t.map((function(t){return e.host.models.ScheduledMessage.inject({$deleted:!0,id:t})}))]}}))}))},t.prototype.create=function(e){var t=e.attachment,n=e.body,r=e.endDate,o=e.network,i=void 0===o?"patient":o,s=e.noReply,a=void 0!==s&&s,u=e.organizationId,c=e.recipients,l=e.repeating,d=e.sendNow,h=void 0!==d&&d,p=e.startDate,f=e.startTime,v=e.templateId,y=e.timezoneName;return Hc(this,void 0,void 0,(function(){var e=this;return $c(this,(function(o){switch(o.label){case 0:if(this._validate({body:n,endDate:r,organizationId:u,recipients:c,repeating:l,sendNow:h,shouldCheckId:!1,startDate:p,startTime:f}),!1===["patient"].includes(i))throw new q("network","invalid",'network must be "patient"');return[4,this.host.api.scheduledMessages.create({attachment:t,body:n,end_date:r,network:i,no_reply:a,organizationId:u,recipients:c,repeating:l,send_now:h,start_date:p,start_time:f,template_id:v,timezone_name:y})];case 1:return[2,o.sent().map((function(t){return t.sender_id=e.host.currentUserId,e.host.conversations.__injectCounterParty({entityAttrs:t,entityType:"scheduledMessage",organizationId:u})}))]}}))}))},t.prototype.delete=function(e,t){return Hc(this,void 0,void 0,(function(){return $c(this,(function(n){switch(n.label){case 0:return this._validate({id:e,organizationId:t,shouldCheckInvalid:!1}),[4,this.host.api.scheduledMessages.delete(e,t)];case 1:return n.sent(),[2,this.host.models.ScheduledMessage.inject({$deleted:!0,id:e})]}}))}))},t.prototype.downloadScheduledMessageFile=function(e){var t=e.scheduleId,n=e.fileName,r=e.organizationId;return Hc(this,void 0,void 0,(function(){var e;return $c(this,(function(o){switch(o.label){case 0:return[4,this.host.api.scheduledMessages.downloadScheduledMessageFile({scheduleId:t,fileName:n,organizationId:r})];case 1:return[4,Ts({attachmentContentType:(e=o.sent()).type,blob:e,fileName:n})];case 2:return o.sent(),[2]}}))}))},t.prototype.fetchHits=function(e,t){return Hc(this,void 0,void 0,(function(){var n,r,o,i,s=this;return $c(this,(function(a){switch(a.label){case 0:return n=["history","queue"].map((function(n){return s.search({category:n,feed:e,organizationId:t,pageSize:0})})),[4,Promise.all(n)];case 1:return r=a.sent(),o=r[0],i=r[1],[2,{history:o.metadata.totalHits,queue:i.metadata.totalHits}]}}))}))},t.prototype.find=function(e){var t=e.id,n=e.organizationId,r=e.category;return Hc(this,void 0,void 0,(function(){var e;return $c(this,(function(o){switch(o.label){case 0:return this._validate({id:t,organizationId:n,shouldCheckInvalid:!1}),[4,this.host.api.scheduledMessages.find({id:t,organizationId:n,isHistoryCategory:"history"===r})];case 1:return e=o.sent(),[2,this.host.models.ScheduledMessage.inject(e)]}}))}))},t.prototype.findCoarseTimezone=function(e,t){return Hc(this,void 0,void 0,(function(){var n,r,o;return $c(this,(function(i){switch(i.label){case 0:return[4,this.host.api.scheduledMessages.findCoarseTimezone(e,t)];case 1:return n=i.sent(),r=n.abbr,o=n.name,[2,{abbr:r,name:o}]}}))}))},t.prototype.getAll=function(){return this.host.models.ScheduledMessage.getAll()},t.prototype.getById=function(e){return this.host.models.ScheduledMessage.get(e)},t.prototype.search=function(e){var t=e.category,n=e.continuation,r=e.feed,o=e.network,i=void 0===o?"patient":o,s=e.organizationId,a=e.pageSize,u=e.range,c=e.sortBy,l=void 0===c?"scheduled_time":c,d=e.sortOrder,h=void 0===d?"asc":d;return Hc(this,void 0,void 0,(function(){var e,o,c;return $c(this,(function(d){switch(d.label){case 0:return[4,this.host.search.query({query:Vc(Vc({},u?{range:u}:null),{schedule_message_category:t}),continuation:n,feedLevel:r,network:i,organizationId:s,pageSize:a,returnFields:[],sort:(c={},c[l]=h,c),types:["scheduledMessage"]})];case 1:return e=d.sent(),o=this._processSearchResults(e.results),[2,{metadata:e.metadata,results:o}]}}))}))},t.prototype.update=function(e){var t=e.attachment,n=e.body,r=e.endDate,o=e.id,i=e.organizationId,s=e.repeating,a=e.startDate,u=e.startTime,c=e.templateId,l=e.timezoneName;return Hc(this,void 0,void 0,(function(){var e;return $c(this,(function(d){switch(d.label){case 0:return this._validate({body:n,endDate:r,id:o,organizationId:i,repeating:s,startDate:a,startTime:u}),[4,this.host.api.scheduledMessages.update({attachment:t,body:n,end_date:r,id:o,organizationId:i,repeating:s,start_date:a,start_time:u,template_id:c,timezone_name:l})];case 1:return e=d.sent(),[2,this.host.models.ScheduledMessage.inject(e)]}}))}))},t.prototype._processSearchResults=function(e){return e.map((function(e){return e.entity})).filter((function(e){return!e.$deleted}))},t.prototype._validate=function(e){var t=e.body,n=e.endDate,r=e.id,o=e.organizationId,i=e.recipients,s=e.repeating,a=e.sendNow,u=e.shouldCheckId,c=void 0===u||u,l=e.shouldCheckInvalid,d=void 0===l||l,h=e.startDate,p=e.startTime;if(c&&!r)throw new q("id","required");if(!o)throw new q("organizationId","required");if(d){if(!t||0===t.trim().length)throw new q("body","invalid","body must be at least 1 character");if(!(c||Array.isArray(i)&&i.length>0&&i.length<=5))throw new q("recipients","invalid","recipients must be an array of ids between 1 and 5 elements");if(!a){var f=Date.parse(h+"T"+p);if(isNaN(f))throw new q("startDate","invalid","start date and time must be the correct format");if(s){if(!1===["daily","weekly","biweekly","monthly"].includes(s))throw new q("repeating","invalid",'repeating must be either "daily", "weekly", "biweekly", or "monthly"');var v=Date.parse(""+n);if(isNaN(v))throw new q("endDate","invalid","endDate must be the correct format")}}}},Kc([Object(zi.decorator)()],t.prototype,"downloadScheduledMessageFile",null),Kc([Object(zi.decorator)()],t.prototype,"fetchHits",null),Kc([Object(zi.decorator)()],t.prototype,"find",null),Kc([Object(zi.decorator)()],t.prototype,"findCoarseTimezone",null),Kc([Object(zi.decorator)()],t.prototype,"search",null),t}(Bs),Xc=function(){function e(e,t,n,r){this.id="searchResult:"+t+":"+e.id,this.entity=e,this.entityId=e.id,this.entityType=e.$entityType,this.metadata=r,this.organizationId=t,this.conversationId=n}return e.is=function(e){return e instanceof this},e}(),Qc=function(e,t){if(void 0===e&&(e=""),void 0===t&&(t={}),!e||_.a.isEmpty(t.cloudfront))return e;var n=t.cloudfront,r=_.a.findKey(n,(function(t,n){return-1!==e.indexOf(n)})),o=n[r]?r+"."+t.cloudfrontDomain:"",i=n[r]?t.assetDomain+"/"+n[r]:"",s=o&&i?e.replace(o,i):e;return s=s.replace("http://","https://")},Yc=function(){return(Yc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Jc=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Zc=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},el={},tl=function(e){return e.$entityType+":"+e.id};function nl(e,t,n){return Jc(this,void 0,void 0,(function(){var r,o,i,s,a,u,c;return Zc(this,(function(l){switch(l.label){case 0:if(!n.placeholderEntityAllowLoading)return[2];Object.defineProperty(t,"$$loading",{value:!0,configurable:!0}),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,n.finder(t.id)];case 2:return l.sent(),[3,4];case 3:return((o=l.sent()).code===C.CODE||o.code===z.CODE)&&(r=!0),[3,4];case 4:if(delete t.$$loading,r){for(i=0,s=Object.entries(n.notFoundAttributes);i<s.length;i++)a=s[i],u=a[0],c=a[1],Cs(t,u)&&(t[u]=c);Object.defineProperty(t,"$notFound",{value:!0,configurable:!0}),e.inject(t),n.onNotFound&&n.onNotFound(),n.onLoad&&n.onLoad(null),n.onFinish&&n.onFinish(null)}else delete t.$placeholder,delete t.$notFound,e.inject(t),n.onSuccess&&n.onSuccess(t),n.onLoad&&n.onLoad(t),n.onFinish&&n.onFinish(t);return[2]}}))}))}function rl(e,t,n){var r=tl(t);if(!el[r])return n.placeholderEntityDelayBeforeRefreshing?(Object.defineProperty(t,"$$loadingScheduled",{value:!0,configurable:!0}),void(el[r]=setTimeout((function(){return function(e,t,n){return Jc(this,void 0,void 0,(function(){return Zc(this,(function(r){try{return delete t.$$loadingScheduled,delete el[tl(t)],t.$placeholder?[2,nl(e,t,n)]:[2]}catch(e){console.error(e)}return[2]}))}))}(e,t,n)}),n.placeholderEntityDelayBeforeRefreshing))):nl(e,t,n).catch(console.error)}function ol(e,t){var n=t.finder,r=t.defaultPlaceholderAttrs,o=t.defaultNotFoundAttrs,i=t.placeholderEntityDelayBeforeRefreshing,s=t.placeholderEntityAllowLoading,a=t.shouldEnsure;e.ensureEntity=function(t,a){return void 0===a&&(a={}),"function"==typeof i&&(i=i()),"function"==typeof s&&(s=s()),function(e,t,n,r){var o;void 0===r&&(r={});var i=e.get(t);if(i)i.$placeholder?i.$$loading||i.$notFound||r.onlyPlaceholder||rl(e,i,r):(r.onExists&&r.onExists(i),r.onFinish&&r.onFinish(i));else{if(n=Yc(((o={})[e.idAttribute]=t,o),n),r.onMissing&&r.onMissing(),i=e.createInstance(n),Object.defineProperty(i,"$placeholder",{value:!0,configurable:!0}),e.inject(i),r.onlyPlaceholder)return i;rl(e,i,r)}}(e,t,Yc(Yc({},r),a.attrs),Yc({finder:n,notFoundAttributes:o,placeholderEntityDelayBeforeRefreshing:i,placeholderEntityAllowLoading:s},a))},e.waitForEnsuredEntity=function(t,n){return void 0===n&&(n={}),new Promise((function(r,o){e.ensureEntity(t,Yc(Yc({},n),{onFinish:r}))}))},e.shouldEnsure=function(t,n,r){return void 0===r&&(r={}),"string"==typeof t&&(t=e.get(t)),!t||(!(!a||!a(t,n,r))||!(!t.$placeholder||t.$$loading||n))}}var il=function(){return(il=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},sl=["autoForwardReceiverIds","conversationId","department","title"],al=function(e,t){var n=t.host,r=e.defineModel("user",{replaceKeys:{avatar:"avatarUrl",blockedPersonal:"contactsMessagingBlockedByOrganizationIds",organizationKey:"organizationId",organizationToken:"organizationId",timeToLive:"messagesTTL"},defaultValues:{botRole:null,contactsMessagingBlockedByOrganizationIds:[],isPatient:!1,isPatientContact:!1,organizationIds:[],presence:Lo.UNKNOWN,profileByOrganizationId:{},removedFromOrg:!1,roles:[]},skipCamelizationForKeys:["metadata"],parseAttrs:function(e){var t=e.organizationId;if(e.dndAutoForwardReceivers?e.autoForwardReceiverIds=e.dndAutoForwardReceivers.map((function(e){return e.token})):""===e.dndAutoForwardReceiver||"undefined"===e.dndAutoForwardReceiver?e.autoForwardReceiverIds=[]:void 0!==e.dndAutoForwardReceiver&&(e.autoForwardReceiverIds=[e.dndAutoForwardReceiver]),delete e.dndAutoForwardReceiver,delete e.dndAutoForwardReceivers,t){delete e.organizationId,e.organizationIds||(e.organizationIds=[]),e.organizationIds.includes(t)||e.organizationIds.push(t);var r=il(il({},_.a.pick(e,sl)),{userId:e.id,organizationId:t});delete e.autoForwardReceiverIds,delete e.conversationId,e.profileByOrganizationId||(e.profileByOrganizationId={}),e.profileByOrganizationId[t]=r}if("patientId"in e&&!e.patientId.startsWith("patient:")){var o="patient:"+e.patientId,i=e.patientId;e.isPatient=!e.isPatientContact,e.patientId=o,e.patientBroadcastListDetails={addedByDisplayName:e.addedByDisplayName,addedOn:e.addedOn};var s={id:o,dob:e.patientDob,gender:e.patientGender,mrn:e.patientMrn};if(e.isPatient)s.userId=e.id;else if(e.isPatientContact){var a="patientContact:"+e.id;e.patientContactId=a,n.models.User.injectPlaceholder({id:i,displayName:e.patientDisplayName,patientId:o}),n.models.PatientContact.injectPlaceholder({id:a,relation:e.relationName,userId:e.id,patientId:o}),s.userId=i}n.models.Patient.injectPlaceholder(s),delete e.addedByDisplayName,delete e.addedOn,delete e.patientDisplayName,delete e.patientDob,delete e.patientGender,delete e.patientMrn,delete e.relationName}if("metadata"in e){if("feature_service"in e.metadata&&"patient_messaging"===e.metadata.feature_service){var u=(s=e.metadata).is_patient_contact;"string"==typeof u&&"true"===u||"boolean"==typeof u&&u?(e.patientContactId="patientContact:"+e.id,e.isPatientContact=!0,n.users._injectPatientContactEntity(e,t)):(e.patientId="patient:"+e.id,e.isPatient=!0,n.users._injectPatientEntity(s,e.id,t))}"feature_service"in e.metadata&&"role"===e.metadata.feature_service&&t&&n.roles.__injectRoleFromMetadata({metadata:il(il({},e.metadata),{display_name:e.display_name,token:e.id}),organizationId:t}),delete e.metadata}return e.avatarUrl&&(e.avatarUrl=Qc(e.avatarUrl,n.config)),!e.displayName&&e.name&&(e.displayName=e.name),e.displayName&&Fr(e.displayName)&&(e.displayName=Gr(e.displayName)),e},beforeInject:function(e,t){if(t&&(e.organizationIds&&(e.organizationIds=_.a.union(t.organizationIds,e.organizationIds)),e.profileByOrganizationId)){var n={};if(t.profileByOrganizationId)for(var r=0,o=Object.entries(t.profileByOrganizationId);r<o.length;r++){var i=o[r],s=i[0],a=i[1];n[s]={},Object.assign(n[s],a)}for(var u=0,c=Object.entries(e.profileByOrganizationId);u<c.length;u++){var l=c[u];s=l[0],a=l[1];n[s]||(n[s]={}),Object.assign(n[s],a)}e.profileByOrganizationId=n}},afterAssignment:function(e){var t=e.profileByOrganizationId;e.contactsMessagingBlocked=e.contactsMessagingBlockedByOrganizationIds.length>0,e.isRoleBot=e.metadata.some((function(e){return"role"===e.data.feature_service})),e.shouldDisplay=!e.metadata.some((function(e){return"true"===e.data.invisible}));for(var r=0,o=Object.values(t);r<o.length;r++){var i=o[r];e.dnd||(i.autoForwardReceiverIds=[]),n.users._setMembersOnEntity(i,"autoForwardReceiverIds","autoForwardReceivers")}e.removedFromOrg&&(!e.displayName||e.$$loading||e.$$loadingScheduled||e.$notFound)&&(e.displayName="Removed User")},relations:{belongsTo:{patient:{type:"patient",foreignKey:"patientId"},patientContact:{type:"patientContact",foreignKey:"patientContactId"}},hasMany:{metadata:{type:"metadata",foreignKey:"entityId"}}}});return ol(r,{finder:function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=n.users).find.apply(e,t)},placeholderEntityDelayBeforeRefreshing:function(){return n.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return n.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<User Not Found>"}}),r},ul=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cl=function(){return(cl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ll=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},dl=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},hl=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},pl=["avatar","conversation_id","department","description","display_name","dnd_auto_forward_receiver","dnd","first_name","group_token","is_public","last_login_time","last_name","members","name","network","num_members","organization_key","pagers","status","title","token","total_members"],fl={distributionList:Do.toServer(Do.DISTRIBUTION_LIST),distributionListMember:Do.toServer(Do.DISTRIBUTION_LIST_MEMBER),forum:Do.toServer(Do.FORUM),group:Do.toServer(Do.GROUP),messageTemplate:Do.toServer(Do.MESSAGE_TEMPLATE),organization:Do.toServer(Do.ORGANIZATION),patient_account:Do.toServer(Do.PATIENT),patientDistributionList:Do.toServer(Do.PATIENT_DISTRIBUTION_LIST),scheduledMessage:Do.toServer(Do.SCHEDULED_MESSAGE),tag:Do.toServer(Do.TAG),team:Do.toServer(Do.TEAM),user:Do.toServer(Do.USER)},vl=Object.values(fl),yl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._query=function(e){return dl(t,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m,_,b,w,I,O,T,E,A,C,R,P,S,j,M,z,k,N,x,U,L,q,D,B,F,G;return hl(this,(function(V){switch(V.label){case 0:return t=e.continuation,n=void 0===t?null:t,r=e.excludeIds,o=void 0===r?[]:r,i=e.excludeSelf,s=void 0!==i&&i,a=e.followContinuations,u=void 0!==a&&a,c=e.network,l=void 0===c?"provider":c,d=e.params,n&&(d=cl(cl({},d),{continuation:n})),p=[],"patient"===l||d.type.includes("patient_account")?[4,this.host.api.search.patientQuery(d)]:[3,2];case 1:return(h=V.sent()).metadata.continuation||(h.metadata.continuation=null),[3,4];case 2:return[4,this.host.api.search.query(d)];case 3:h=V.sent(),V.label=4;case 4:for(p=h.results,f=[],v=0,y=p;v<y.length;v++)P=y[v],z=P.type,j=P.entity,M=P.organization_id,g={entityAttrs:j,organizationId:M,type:z},this.config.condensedReplays?j.conversation_id?(g.conversationId=j.conversation_id,delete j.conversation_id):g.conversationId=P.conversation_id:delete j.conversation_id,0!==Object.keys(j).length&&("tigertext:entity:account"===z?Ps(j,"status","account_status"):"tigertext:entity:tag"===z&&(j.token=M+":"+j.token),(U=j.metadata)&&this.host.metadata.__injectMetadata(j.token,M,U),f.push(g));return m=h.metadata,_=m.continuation,b=m.first_hit,w=m.total_hits,I={firstHit:b,totalHits:w},_&&(u?I.firstHit=1:I.continuation=_),O=[],T=[],E=function(e){for(var t=0,n=e.results;t<n.length;t++){var r=n[t];O.push(r)}},u&&_&&T.push(this._query(cl(cl({},e),{continuation:_})).then(E)),[4,Promise.all(T)];case 5:for(V.sent(),A=[],C=0,R=f;C<R.length;C++)P=R[C],S=P.conversationId,j=P.entityAttrs,M=P.organizationId,z=P.type,k=this.host.modelNameByTypeNS(z),(N="group"===k&&this.host.groups.__extractGroupTypeFromAttrs(j))===Ao.FORUM&&delete j.members,x=this.host.metadata.get(j.token,M),U=x?x.data:null,"user"===(L=this.host.conversations.__injectCounterParty({conversationId:S,entityAttrs:j,entityType:k,groupType:N,hasCurrentUser:!1,organizationId:M})).$entityType&&U&&"role"===U.feature_service&&this.host.roles.__injectSearchResult({entity:L,metadata:U,organizationId:M}),o.length&&o.includes(L.id)||(q=this.host.currentUserId,s&&L.id===q||(L?(L.isRoleBot&&L.botRole&&(L=L.botRole),D=new Xc(L,M,S,U),A.unshift(D)):this.logger.warn("no entity for ",P)));for(B=0,F=A;B<F.length;B++)G=F[B],O.unshift(G);return[2,{results:O,metadata:I}]}}))}))},t._searchLocalOrganization=function(e){for(var t=e.organization,n=e.query,r=e.types,o=void 0===r?[]:r,i=t.conversations,s=t.id,a=[],u=0,c=i;u<c.length;u++){var l=c[u],d=l.counterParty,h=l.counterPartyType,p=l.metadata,f=fl[h];if(o.includes(f))if(n&&0!==Object.keys(n).length){for(var v=!0,y=0,g=Object.entries(n);y<g.length;y++){var m=g[y],_=m[0],b=m[1];_=_.split(","),b=b.toLowerCase();for(var w=!1,I=0,O=_;I<O.length;I++){var T=O[I],E="user"===h&&sl.includes(T)?d.profileByOrganizationId[s]:d;if(E){var A=E[T];if(void 0!==A&&A.toLowerCase().includes(b)){w=!0;break}}}if(!w){v=!1;break}}v&&a.push(new Xc(d,s,p))}else a.push(new Xc(d,s,p))}return a},t}return ul(t,e),t.prototype.query=function(e){return dl(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d,h,p,f,v,y,g,m,b,w,I,O,T,E,A,C,R,P,S,j,M,z,k,N,x,U,L,D,B,F,G,V,K,H,$,W,X,Q,Y,J,Z,ee;return hl(this,(function(te){switch(te.label){case 0:if(t=e.continuation,n=void 0===t?null:t,r=e.enabledCapabilities,o=void 0===r?[]:r,i=e.excludeEmptyLists,s=void 0!==i&&i,a=e.excludeIds,u=void 0===a?[]:a,c=e.excludeSelf,l=void 0!==c&&c,d=e.followContinuations,h=void 0!==d&&d,p=e.includeDisabled,f=void 0!==p&&p,v=e.network,y=void 0===v?"provider":v,g=e.organizationId,m=void 0===g?null:g,b=e.organizationIds,w=void 0===b?[]:b,I=e.pageSize,O=e.query,T=void 0===O?{}:O,E=e.resultsFormat,A=void 0===E?"entities":E,C=e.returnFields,R=void 0===C?pl:C,P=e.sort,S=void 0===P?[]:P,j=e.types,0===(M=void 0===j?[]:j).length)throw new q("types","required","no types specified");if(M=_.a.uniq(M.map((function(e){return Do.isValid(e)?Do.toServer(e):fl[e]}))),(z=_.a.difference(M,vl)).length>0)throw new q("types","invalid","invalid types: "+z.join(", "));if(m&&(w=[m]),0===w.length)throw new q("organizationIds","invalid","search must be done in a context of an organization");if(1===w.length&&(k=this.host.models.Organization.get(m))&&k.isContacts)return N=this._queryLocalOrganization({organization:k,query:T,types:M}),Y=N.results,x=N.metadata,[2,{results:Y,metadata:x}];if("ids"===A&&(A="tokens"),u=qs(u),U={directory:w,include_disabled:f,render_metadata:!0,results_format:A,return_fields:R,type:M},o.length&&(U.enabled_capabilities=o),S&&S.length?U.sort=S.map((function(e){return Ae.underscoreKey(e)})):"object"==typeof S&&(U.sort=S),U.type.includes("schedule_message")&&e.feedLevel&&(U.feed_level=e.feedLevel),isNaN(parseInt(I))||(U.page_size=I),L={},T&&Object.keys(T).length>0){for(D=0,B=Object.entries(T);D<B.length;D++)F=B[D],G=F[0],V=F[1],G.includes(",")&&(K=G.split(",").map(Ae.underscoreKey).join(","),L[K]=V,delete T[G]);L=cl(cl({},L),Ae.underscoreObject(T)),U.bool={must:L}}return s&&(M.includes("distribution_list")||M.includes("patient_distribution_list"))&&(U.bool=Object.assign({},U.bool,{must_not:{total_members:"0"}})),H=[{continuation:n,excludeIds:u,excludeSelf:l,followContinuations:h,network:y,params:U}],[4,Promise.all(H.map(this._query))];case 1:for($=te.sent(),W=[],X=0,Q=$;X<Q.length;X++)for(Y=Q[X].results,J=0,Z=Y;J<Z.length;J++)ee=Z[J],W.push(ee);return[2,{results:W=_.a.uniqBy(W,"entity"),metadata:$[0].metadata}]}}))}))},t.prototype._queryLocalOrganization=function(e){var t=e.organization,n=e.query,r=e.types,o=t.id,i=this._searchLocalOrganization({organization:t,query:n,types:r}),s={firstHit:1,totalHits:i.length},a=Object.keys(n);if(0===i.length&&a.length>0){var u=a.find((function(e){return e.includes("displayName")})),c=u?n[u]:n[a[0]];if(It()(c)||Fr(c)){var l=It()(c)?c:Hr(c),d=this.host.models.User.createInstance({displayName:Fr(c)?Gr(c):c,id:l,messageAnyoneRecipient:!0,organizationId:o});return{results:[new Xc(d,o,s)],metadata:s}}}return{results:i,metadata:s}},ll([Object(zi.decorator)()],t.prototype,"query",null),t}(Bs),gl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ml=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_l=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},bl=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},wl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return gl(t,e),t.prototype.mounted=function(){this._fetched=!1},t.prototype.dispose=function(){this._fetched=!1},t.prototype.find=function(e,t){var n=void 0===t?{}:t,r=n.organizationId,o=n.bypassCache,i=void 0!==o&&o;return _l(this,void 0,void 0,(function(){var t,n,o;return bl(this,(function(s){switch(s.label){case 0:if(this.host.requireUser(),!e)throw new q("id","required");if(!r)throw new q("organizationId","required");return i||!(t=this.host.models.Team.get(e))||t.$placeholder?[4,this.host.api.teams.find(e,{organizationId:r})]:[2,t];case 1:return n=s.sent(),o=n.team,[2,t=this.host.models.Team.inject(o)]}}))}))},t.prototype.refresh=function(e,t){var n=(void 0===t?{}:t).organizationId;return _l(this,void 0,void 0,(function(){return bl(this,(function(t){switch(t.label){case 0:return[4,this.find(e,{organizationId:n,bypassCache:!0})];case 1:return[2,t.sent()]}}))}))},t.prototype.findAll=function(e){var t=(void 0===e?{}:e).bypassCache,n=void 0!==t&&t;return _l(this,void 0,void 0,(function(){var e,t,r;return bl(this,(function(o){switch(o.label){case 0:return!n&&this._fetched?[2,this.getAll()]:0!==(e=this.host.models.Organization.getAll()).length?[3,2]:[4,this.host.organizations.findAll()];case 1:e=o.sent(),o.label=2;case 2:return[4,this.host.search.query({types:["team"],organizationIds:e.map((function(e){return e.id})),query:{displayName:""},followContinuations:!0})];case 3:return t=o.sent().results,r=t.map((function(e){return e.entity})),this._fetched=!0,[2,r]}}))}))},t.prototype.findByOrganizationId=function(e){return _l(this,void 0,void 0,(function(){var t,n;return bl(this,(function(r){switch(r.label){case 0:return e=this._resolveModelId(e),[4,this.host.organizations.find(e)];case 1:return t=r.sent(),[4,this.host.search.query({types:["team"],organizationIds:t.id,query:{displayName:""},followContinuations:!0})];case 2:return n=r.sent().results,[2,n.map((function(e){return e.entity}))]}}))}))},t.prototype.refreshAll=function(){return _l(this,void 0,void 0,(function(){return bl(this,(function(e){switch(e.label){case 0:return[4,this.findAll({bypassCache:!0})];case 1:return[2,e.sent()]}}))}))},t.prototype.getAll=function(){return this.host.models.Team.getAll()},t.prototype.create=function(e){var t=e.avatar,n=e.canMembersLeave,r=void 0===n||n,o=e.canRequestToJoin,i=void 0===o||o,s=e.description,a=e.displayName,u=e.memberIds,c=void 0===u?[]:u,l=e.organizationId;return _l(this,void 0,void 0,(function(){var e,n,o,u=this;return bl(this,(function(d){switch(d.label){case 0:if(this.host.requireUser(),!l)throw new q("organizationId","required");if(c.length<2)throw new q("memberIds","required to have 2 or more IDs");return[4,Promise.all(c.map(this.host.roles.__resolveRoleId).filter(Boolean).map((function(e){return u._resolveModelIdWithTypes(e,"user")})).map((function(e){return u.host.users.find(e,{organizationId:l})})))];case 1:return e=d.sent(),n=ta.a.call(e),c=n.map((function(e){return u._resolveModelIdWithTypes(e,"user")})),[4,this.host.api.teams.create({avatar:t,canMembersLeave:r,canRequestToJoin:i,description:s,displayName:a,memberIds:c,organizationId:l})];case 2:return o=d.sent(),[2,this.host.models.Team.inject(o.team)]}}))}))},t.prototype.update=function(e){var t=e.avatar,n=e.canMembersLeave,r=void 0===n||n,o=e.canRequestToJoin,i=void 0===o||o,s=e.description,a=e.displayName,u=e.id,c=e.memberIds,l=void 0===c?[]:c,d=e.organizationId;return _l(this,void 0,void 0,(function(){var e;return bl(this,(function(n){switch(n.label){case 0:if(this.host.requireUser(),!u)throw new q("id","required");if(!d)throw new q("organizationId","required");if(l.length<2)throw new q("memberIds","required to have 2 or more IDs");return l=l.map(this.host.roles.__resolveRoleId),[4,this.host.api.teams.update({avatar:t,canMembersLeave:r,canRequestToJoin:i,description:s,displayName:a,id:u,memberIds:l,organizationId:d})];case 1:return e=n.sent(),[2,this.host.models.Team.inject(e.team)]}}))}))},t.prototype.delete=function(e,t){var n=t.organizationId;return _l(this,void 0,void 0,(function(){var t,r;return bl(this,(function(o){switch(o.label){case 0:if(!n)throw new q("organizationId","required");if(!e)throw new q("teamId","required");return[4,this.host.api.teams.delete(e,{organizationId:n})];case 1:return 204===(t=o.sent())&&(r=this.host.models.Team.get(e))&&this.host.models.Team.eject(r),[2,t]}}))}))},t.prototype.requestToJoin=function(e,t){var n=t.requestedById,r=t.organizationId;return _l(this,void 0,void 0,(function(){var t;return bl(this,(function(o){switch(o.label){case 0:if(!r)throw new q("organizationId","required");if(!e)throw new q("teamId","required");if(!n)throw new q("requestedById","required");return[4,this.host.api.teams.requestToJoin(e,{requestedById:n,organizationId:r})];case 1:return 204===(t=o.sent())&&this.host.models.Team.inject({id:e,hasCurrentUserPending:!0}),[2,t]}}))}))},t.prototype.acceptJoinRequest=function(e,t){var n=t.teamId,r=t.organizationId,o=t.handledAsId;return _l(this,void 0,void 0,(function(){return bl(this,(function(t){switch(t.label){case 0:if(!r)throw new q("organizationId","required");if(!n)throw new q("teamId","required");if(!e)throw new q("requestId","required");if(!o)throw new q("handledAsId","required");return[4,this.host.api.teams.updateJoinRequest(e,{teamId:n,organizationId:r,handledAsId:o,status:"accepted"})];case 1:return[2,t.sent()]}}))}))},t.prototype.declineJoinRequest=function(e,t){var n=t.teamId,r=t.organizationId,o=t.handledAsId;return _l(this,void 0,void 0,(function(){return bl(this,(function(t){switch(t.label){case 0:if(!r)throw new q("organizationId","required");if(!n)throw new q("teamId","required");if(!e)throw new q("requestId","required");if(!o)throw new q("handledAsId","required");return[4,this.host.api.teams.updateJoinRequest(e,{teamId:n,organizationId:r,handledAsId:o,status:"declined"})];case 1:return[2,t.sent()]}}))}))},t.prototype.leave=function(e,t){var n=(void 0===t?{}:t).organizationId;return _l(this,void 0,void 0,(function(){var t;return bl(this,(function(r){switch(r.label){case 0:if(!e)throw new q("teamId","required");if(!n)throw new q("organizationId","required");return[4,this.host.api.teams.leave(e,{organizationId:n})];case 1:return 204===(t=r.sent())&&this.refresh(e,{organizationId:n}),[2,t]}}))}))},t.prototype._setHasUserPending=function(e){if(e.pendingRequestUserIds)for(var t=0,n=e.pendingRequestUserIds;t<n.length;t++){if(n[t]===this.host.currentUserId)return void(e.hasCurrentUserPending=!0)}},t.prototype.__injectTeamRequest=function(e){if(!e.id)return null;var t;if(e.created_by&&e.created_by.token&&(t=this.host.models.User.inject(e.created_by)),e.team&&e.team.id){var n=e.status,r=Object.assign({},e.team);t&&t.id===this.host.currentUserId&&("accepted"===n?(r.hasCurrentUserBeenDeclined=!1,r.hasCurrentUserPending=!1):"declined"===n&&(r.hasCurrentUserBeenDeclined=!0,r.hasCurrentUserPending=!1)),this.host.models.Team.inject(r)}return this.host.models.TeamRequest.inject(e)},t.prototype.resetDeclinedUserOnTeam=function(e){this.host.models.Team.inject({id:e,hasCurrentUserBeenDeclined:!1})},ml([Object(zi.decorator)()],t.prototype,"find",null),ml([Object(zi.decorator)()],t.prototype,"refresh",null),ml([Object(zi.decorator)()],t.prototype,"findAll",null),ml([Object(zi.decorator)()],t.prototype,"findByOrganizationId",null),ml([Object(zi.decorator)()],t.prototype,"refreshAll",null),t}(Bs),Il=n(13),Ol=n.n(Il),Tl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),El=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Al=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Cl=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Rl=Bo.GLOBAL,Pl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMessageSending=function(e){t.stopTyping(e.counterPartyId,{senderId:e.senderId})},t}return Tl(t,e),t.prototype.mounted=function(){this._lastStartTypingAPICalls={},this._lastStopTypingAPICalls={},this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)},t.prototype.dispose=function(){Zs.a.call(Xs.a.call(Zs.a.call(Ol.a.call(this._typers),_.a.values)),"timer").forEach((function(e){return null!==e&&clearTimeout(e)})),Zs.a.call(Ol.a.call(this._currentUserTyping),"timer").forEach((function(e){return null!==e&&clearTimeout(e)})),this._lastStartTypingAPICalls=null,this._lastStopTypingAPICalls=null,this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)},t.prototype.reactToIsTypingEvent=function(e){var t,n=this,r=e.data;if(this.host.requireUser(),(t=r.proxy_token?r.proxy_token:r.sender_token)!==this.host.currentUserId){var o=r.group_token,i=r.org_token,s=o||i||null,a=o?Bo.GROUP:i?Bo.ORGANIZATION:Rl,u="typing"===r.status;this.host.models.User.ensureEntity(t,{onlyPlaceholder:!1}),a===Rl?_.a.get(this.host,"currentUser.organizationIds",[]).forEach((function(e){n._setTypingStatusOfUser(e,Bo.ORGANIZATION,t,u)})):this._setTypingStatusOfUser(s,a,t,u)}},t.prototype.startTyping=function(e,t){var n=void 0===t?{}:t,r=n.autoStopAfterTimeout,o=n.senderId,i=n.organizationId;return Al(this,void 0,void 0,(function(){var t,n,s=this;return Cl(this,(function(a){switch(a.label){case 0:return void 0===e?[2]:(e=this._resolveModelId(e),o=this._resolveModelId(o),this.host.requireUser(),[4,this._sendStartTyping(e,o,i)]);case 1:return a.sent(),(t=this._currentUserTyping[e])?(clearTimeout(this._currentUserTyping[e].timer),t.timer=null):(t={},this._currentUserTyping[e]=t),n="number"==typeof r?r:this.host.config.clearTypingStatusTimeout,t.timer=setTimeout((function(){s.logger.info("auto stop typing for current user",e),s.stopTyping(e,{senderId:o})}),n),[2]}}))}))},t.prototype._sendStartTyping=function(e,t,n){return Al(this,void 0,void 0,(function(){var r,o,i,s,a,u;return Cl(this,(function(c){switch(c.label){case 0:return this._lastStartTypingAPICalls[e]?(r=this._lastStartTypingAPICalls[e],o=r.expiresAt,i=r.retVal,s=r.lastSenderId,t===s?[3,2]:[4,this.stopTyping(e,{senderId:s})]):[3,3];case 1:c.sent(),c.label=2;case 2:if(ia()().isBefore(o))return[2,i];c.label=3;case 3:return[4,this.host.api.typingStatus.startTyping(e,t,n)];case 4:return a=c.sent(),u=ia()().add(this.config.clearTypingStatusThrottleDelay,"ms"),this._lastStartTypingAPICalls[e]={expiresAt:u,retVal:a,lastSenderId:t},[2,a]}}))}))},t.prototype.stopTyping=function(e,t){var n=(void 0===t?{}:t).senderId;return Al(this,void 0,void 0,(function(){var t;return Cl(this,(function(r){switch(r.label){case 0:return void 0===e?[2]:(e=this._resolveModelId(e),n=this._resolveModelId(n),this.host.requireUser(),(t=this._currentUserTyping[e])&&null!==t.timer&&(clearTimeout(t.timer),t.timer=null),[4,this._sendStopTyping(e,n)]);case 1:return r.sent(),[2]}}))}))},t.prototype._sendStopTyping=function(e,t){return Al(this,void 0,void 0,(function(){var n,r,o,i,s;return Cl(this,(function(a){switch(a.label){case 0:return(n=this._lastStopTypingAPICalls[e])&&(r=n.expiresAt,o=n.retVal,ia()().isBefore(r))?[2,o]:[4,this.host.api.typingStatus.stopTyping(e,t)];case 1:return i=a.sent(),s=ia()().add(this.config.clearTypingStatusThrottleDelay,"ms"),this._lastStopTypingAPICalls[e]={expiresAt:s,retVal:i,senderId:t},[2,i]}}))}))},t.prototype._setTypingStatusOfUser=function(e,t,n,r,o){var i=this;void 0===o&&(o=!1),e=e||Bo.GLOBAL;var s=this._typers[e];if(r){s||(s={},this._typers[e]=s);var a=(u=s[n])&&null!==u.timer;if(u?clearTimeout(u.timer):(u={},s[n]=u),u.timer=setTimeout((function(){i.logger.info("auto stop typing for other typer",e,n),i._setTypingStatusOfUser(e,t,n,!1,!0)}),this.host.config.clearTypingStatusTimeout),a)return}else{var u;if(!(a=(u=s&&s[n])&&null!==u.timer))return;clearTimeout(u.timer),u.timer=null}this.emit("change",{userId:n,contextId:e,contextType:t,isTyping:r,timedOut:o})},t.prototype.isUserTyping=function(e,t){var n=this,r=(void 0===t?{}:t).organizationId;return e=this._resolveModelId(e),r?this._isUserTypingInContext(r,e):_.a.get(this.host,"currentUser.organizationIds",[]).some((function(t){return n._isUserTypingInContext(t,e)}))},t.prototype.isCurrentUserTyping=function(e){e=this._resolveModelId(e);var t=this._currentUserTyping[e];return!!t&&null!==t.timer},t.prototype.isUserTypingInGroup=function(e,t){return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)},t.prototype._isUserTypingInContext=function(e,t){var n=this._typers[e],r=n&&n[t];return!!r&&null!==r.timer},El([Object(zi.decorator)()],t.prototype,"_sendStartTyping",null),El([Object(zi.decorator)()],t.prototype,"_sendStopTyping",null),t}(Bs),Sl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),jl=function(){return(jl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ml=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},zl=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},kl=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Nl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Sl(t,e),t.prototype.dispose=function(){zi.decorator.clear(this._findAll)},t.prototype.findAll=function(e){var t=void 0===e?{}:e,n=t.userId,r=void 0===n?this.host.currentUserId:n,o=t.organizationId;return zl(this,void 0,void 0,(function(){return kl(this,(function(e){return this.host.requireUser(),[2,this._findAll(r,o)]}))}))},t.prototype.refreshAll=function(e){var t=void 0===e?{}:e,n=t.userId,r=void 0===n?this.host.currentUserId:n,o=t.organizationId;return zl(this,void 0,void 0,(function(){return kl(this,(function(e){return this.host.requireUser(),zi.decorator.clear(this._findAll),[2,this._findAll(r,o)]}))}))},t.prototype._findAll=function(e,t){return void 0===t&&(t=this._pickOrganizationId()),zl(this,void 0,void 0,(function(){var n,r,o=this;return kl(this,(function(i){switch(i.label){case 0:return[4,this.host.api.userRoles.findAll(e,t)];case 1:return n=i.sent(),r={userRoles:[],productRoles:[]},n.forEach((function(t){var n=t.organization,i=t.product;if(n){var s=n.organization_id,a=o.host.organizations.getById(s),u=o.host.models.UserRoles.inject(jl({id:o._getOrganizationKey({organizationId:s,userId:e}),userId:e},n));a&&o.host.models.Organization.touch(a),r.userRoles.push(u)}else if(i){var c=i.product_id,l=o.host.models.ProductRoles.inject(jl({id:o._getProductKey({productId:c,userId:e}),userId:e},i));o.host.models.Product.inject({id:c}),r.productRoles.push(l)}})),[2,r]}}))}))},t.prototype._pickOrganizationId=function(){var e=this.host.organizations.getAll();return 0===e.length?"placeholder":e[0].id},t.prototype.getAllUserRoles=function(){return this.host.models.UserRoles.getAll()},t.prototype.getByOrganizationId=function(e,t){var n=(void 0===t?{}:t).userId,r=void 0===n?this.host.currentUserId:n,o=this._getOrganizationKey({organizationId:e,userId:r});return this.host.models.UserRoles.get(o)},t.prototype._getOrganizationKey=function(e){var t=e.organizationId,n=e.userId;return"userRoles:"+(void 0===n?this.host.currentUserId:n)+":"+t},t.prototype.getAllProductRoles=function(){return this.host.models.ProductRoles.getAll()},t.prototype.getByProductId=function(e,t){var n=(void 0===t?{}:t).userId,r=void 0===n?this.host.currentUserId:n,o=this._getProductKey({productId:e,userId:r});return this.host.models.ProductRoles.get(o)},t.prototype._getProductKey=function(e){var t=e.productId,n=e.userId;return"productRoles:"+(void 0===n?this.host.currentUserId:n)+":"+t},Ml([Object(zi.decorator)()],t.prototype,"findAll",null),Ml([Object(zi.decorator)()],t.prototype,"refreshAll",null),Ml([Object(zi.decorator)({memoize:!0,serializeArguments:function(e){return e[0]}})],t.prototype,"_findAll",null),t}(Bs),xl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ul=function(){return(Ul=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ll=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ql=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Dl=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Bl=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},Fl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.PROFILE_ATTRIBUTES_PER_ORG=sl,t._setMembersOnEntity=function(e,n,r){void 0===n&&(n="memberIds"),void 0===r&&(r="members");var o=e,i=o[n],s=o[r];if(i){s?s.length=0:s=[];for(var a=0,u=i;a<u.length;a++){var c=u[a],l=t.host.models.User.get(c);l&&s.push(l)}}else s=null;e[r]=s},t._injectPatientEntity=function(e,n,r){var o="patient:"+n;if(e.id=o,e.organizationId=r,e.userId=n,t.host.models.Patient.inject(e),e.patient_contacts)for(var i=0,s=e.patient_contacts;i<s.length;i++){var a=s[i],u=a.entity?a.entity:a,c=u.token||u.id;u.id=c,u.patientId=o,t.host.models.User.inject(u)}},t._injectPatientContactEntity=function(e,n){e.entity&&(e=e.entity);var r=e.metadata,o={editVersion:r.edit_version,id:"patientContact:"+e.id,organizationId:n,patientDob:r.patient_dob,patientGender:r.patient_gender,patientId:"patient:"+r.patient_id,patientMrn:r.patient_mrn,phoneNumber:r.phone_number,relationName:r.relation_name,smsOptedOut:r.sms_opted_out,userId:e.id};t.host.models.PatientContact.inject(o)},t._onChangeMetadata=function(e,n){var r=n.entityId,o=t.host.models.User.get(r);o&&t.host.models.User.inject(o)},t._onChangeRole=function(e,n){var r=t.host.currentUserId,o=n.botUserId,i=n.memberIds;i||(i=[]),o&&t.host.models.User.injectPlaceholder({id:o,botRole:n});var s={},a=t._roleMemberIds[n.id];if(a)for(var u=0,c=a;u<c.length;u++){var l=c[u];if((f=t.host.models.User.get(l))&&!i.includes(l)){var d=(_=f.roles).indexOf(n);d>-1&&(_.splice(d,1),s[l]=_)}}t._roleMemberIds[n.id]=i;for(var h=0,p=i;h<p.length;h++){var f;l=p[h];(_=(f=t.host.models.User.get(l))?f.roles:[]).includes(n)||(_.push(n),s[l]=_)}for(var v=0,y=Object.entries(s);v<y.length;v++){var g=y[v],m=g[0],_=g[1];t.host.models.User.injectPlaceholder({id:m,roles:_}),m===r&&t._onChangeCurrentUserRole(n)}},t._onRemoveRole=function(e,n){var r=n.botUserId;r&&t.host.models.User.injectPlaceholder({id:r,botRole:null});var o=t._roleMemberIds[n.id];if(o){for(var i=0,s=o;i<s.length;i++){var a=s[i],u=t.host.models.User.get(a);if(u){var c=u.roles,l=c.indexOf(n);l>-1&&(c.splice(l,1),t.host.models.User.inject(u))}}delete t._roleMemberIds[n.id]}},t.getPreferences=function(e){return void 0===e&&(e=t.host.currentUserId),ql(t,void 0,void 0,(function(){return Dl(this,(function(t){switch(t.label){case 0:if(!e)throw new q("userId","required");return[4,this.host.api.users.getPreferences(e)];case 1:return[2,t.sent()]}}))}))},t.editPreferences=function(e){var n=e.quickReplies,r=void 0===n?[]:n,o=e.organizationId,i=e.userId,s=void 0===i?t.host.currentUserId:i;return ql(t,void 0,void 0,(function(){return Dl(this,(function(e){switch(e.label){case 0:if(!r)throw new q("quickReplies","required");if(!o)throw new q("organizationId","required");if(!s)throw new q("userId","required");return[4,this.host.api.users.editPreferences({organizationId:o,quickReplies:r,userId:s})];case 1:return[2,e.sent()]}}))}))},t}return xl(t,e),t.prototype.mounted=function(){this._defaultOrganizationId=null,this._roleMemberIds={},this.host.models.Metadata.on("afterInject",this._onChangeMetadata),this.host.models.Metadata.on("afterEject",this._onChangeMetadata),this.host.models.Role.on("afterInject",this._onChangeRole),this.host.models.Role.on("afterEject",this._onRemoveRole)},t.prototype.dispose=function(){this._defaultOrganizationId=null,this._roleMemberIds={},this.host.models.Metadata.removeListener("afterInject",this._onChangeMetadata),this.host.models.Metadata.removeListener("afterEject",this._onChangeMetadata),this.host.models.Role.removeListener("afterInject",this._onChangeRole),this.host.models.Role.removeListener("afterEject",this._onRemoveRole)},t.prototype.signInWithMagicToken=function(e,t){void 0===t&&(t={});var n={Authorization:"magic-token "+e};return this._signInWithHeaders(n,t)},t.prototype.signInWithApiKeyAndSecret=function(e,t,n){void 0===n&&(n={});var r=this.httpClient.getAuthHeaders({key:e,secret:t});return this._signInWithHeaders(r,n)},t.prototype.signIn=function(e,t,n){void 0===n&&(n={}),Fr(e)&&(e=Hr(e));var r={Authorization:this.getSignInAuthHeader(e,t)};return this._signInWithHeaders(r,n)},t.prototype._checkPartnerName=function(){if(!this.config.partnerName)throw new Error("`partnerName` must be supplied as a config option for `new TigerConnect.Client()`")},t.prototype._signInWithHeaders=function(e,t){return void 0===t&&(t={}),ql(this,void 0,void 0,(function(){var n,r;return Dl(this,(function(o){switch(o.label){case 0:return this._checkPartnerName(),[4,this.host.api.users.signIn(e,t)];case 1:return n=o.sent(),r=this.host.models.User.inject(n.data.user),[2,{auth:n.data.auth,user:r}]}}))}))},t.prototype.checkLogin=function(e,t){return void 0===t&&(t={udid:void 0}),ql(this,void 0,void 0,(function(){return Dl(this,(function(n){switch(n.label){case 0:return this._checkPartnerName(),[4,this.host.api.users.checkLogin(e,t)];case 1:return[2,n.sent().data]}}))}))},t.prototype.signUp=function(e){return void 0===e&&(e={udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0}),ql(this,void 0,void 0,(function(){var t,n,r,o;return Dl(this,(function(i){switch(i.label){case 0:return[4,this.host.api.users.signUp(e)];case 1:return t=i.sent(),n=this.host.models.User.inject(t.data.user),r=t.data.auth,o={user:n,auth:r},this.host.emit("signUp",o),[2,o]}}))}))},t.prototype.signOut=function(e){var t=void 0===e?{}:e,n=t.fromServer,r=void 0!==n&&n,o=t.resetClient,i=void 0===o||o;return ql(this,void 0,void 0,(function(){var e,t,n,o;return Dl(this,(function(s){switch(s.label){case 0:if(!this.host.isSignedIn)return[2,!1];e=!1,t=!1,this.host.emit("signingOut",{fromServer:r,resetClient:i}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.host.api.users.signOut()];case 2:return n=s.sent(),e=!0,[3,4];case 3:return o=s.sent(),t=!0,this.httpClient.isUnauthorizedError(o)?(e=!0,[3,4]):[2,Promise.reject(o)];case 4:return e&&(this.host._setCurrentUser(null),this.host._removeAuth()),this.host.emit("signedOut",{externalLogoutUrl:t?null:n.data.external_logout_url,fromServer:r,resetClient:i&&e,signedOut:e}),[2,e]}}))}))},t.prototype.createQRCode=function(){return ql(this,void 0,void 0,(function(){return Dl(this,(function(e){switch(e.label){case 0:return[4,this.host.api.qrCode.create()];case 1:return[2,e.sent()]}}))}))},t.prototype.findOrCreate=function(e,t){return void 0===t&&(t={}),ql(this,void 0,void 0,(function(){var n,r,o,i,s,a,u;return Dl(this,(function(c){switch(c.label){case 0:return n=t.organizationId,r=!1,n?[4,this.host.organizations._findAll()]:[3,2];case 1:c.sent(),o=this.host.models.Organization.get(n),r=!!o&&o.isContacts,c.label=2;case 2:return(i=r&&(It()(e)||Fr(e)))&&e!==this.host.currentUserId&&!this.getById(e)?[3,4]:[4,this.find(e,{organizationId:n,ignoreNotFound:!0})];case 3:s=c.sent(),c.label=4;case 4:return s||!i?[3,8]:[4,this.host.api.users.lookup(e)];case 5:return(a=c.sent())?this.config.condensedReplays?[3,7]:[4,this.find(a.token,{organizationId:n})]:[2,null];case 6:return s=c.sent(),[3,8];case 7:(u=a.entity).conversationId=a.conversation_id,u.organizationId=a.organization_id,s=this.host.models.User.inject(u),c.label=8;case 8:return[2,s]}}))}))},t.prototype.signOutAllDevices=function(){return ql(this,void 0,void 0,(function(){return Dl(this,(function(e){switch(e.label){case 0:return[4,this.host.api.users.wipe(this.host.currentUserId)];case 1:return[2,e.sent()]}}))}))},t.prototype.findMe=function(e){return void 0===e&&(e={}),ql(this,void 0,void 0,(function(){var t,n,r,o;return Dl(this,(function(i){switch(i.label){case 0:return e=_.a.defaults(e,{ignoreNotFound:!1}),this.host.requireUser(),[4,this.host.api.users.findMe()];case 1:if(t=i.sent())return t.entity&&(t.entity.organization_token=t.organization_id,t=t.entity),n=t.metadata,r=t.organization_token,this._defaultOrganizationId=r,o=this.host.models.User.inject(t),n&&this.host.metadata.__injectMetadata(o.id,r,n),[2,o];if(!e.ignoreNotFound)throw new C(this.host.models.User.name,"me");return[2]}}))}))},t.prototype.findDefaultOrganizationId=function(){return ql(this,void 0,void 0,(function(){return Dl(this,(function(e){switch(e.label){case 0:return this._defaultOrganizationId?[3,2]:[4,this.findMe()];case 1:e.sent(),e.label=2;case 2:return[2,this._defaultOrganizationId]}}))}))},t.prototype.findMyProfilesForAllOrganizations=function(e){return void 0===e&&(e={}),ql(this,void 0,void 0,(function(){var e;return Dl(this,(function(t){switch(t.label){case 0:return[4,this.host.organizations.findAll()];case 1:return e=t.sent().map((function(e){return e.id})),[2,this.findProfileForOrganizations(this.host.currentUserId,e)]}}))}))},t.prototype.find=function(e,t){return void 0===t&&(t={}),ql(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,l,d,h,p,f,v=this;return Dl(this,(function(y){switch(y.label){case 0:return t=_.a.defaults(t,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=this.host.models.User.get(e),o=!0,t.organizationIds?(r=t.organizationIds,[3,4]):[3,1];case 1:return t.organizationId?(r=[t.organizationId],[3,4]):[3,2];case 2:return o=!1,r=n?Bl(n.organizationIds):[],[4,this.findDefaultOrganizationId()];case 3:i=y.sent(),r.includes(i)||r.push(i),y.label=4;case 4:for(s=Ul(Ul({},t),{ignoreNotFound:!0}),a=[],u=0,c=r;u<c.length;u++)l=c[u],a.push(this.__find(e,l,s));return[4,Promise.all(a)];case 5:return d=y.sent(),h=d.map((function(e){return e.data})).find(Boolean),p=!!d.find((function(e){return!e.cached})),h&&h.id&&(n=this.host.models.User.get(h.id)),!h||e===h.id||o?[3,7]:(f=_.a.difference(n.organizationIds,r)).length>0?[4,Promise.all(f.map((function(t){return v.__find(e,t,s)})))]:[3,7];case 6:y.sent(),y.label=7;case 7:if(this.host.models.User.removePlaceholder({entity:n,attrs:h}),p&&!t.ignoreNotFound&&!h)throw new C(this.host.models.User.name,e);return[2,n]}}))}))},t.prototype.__find=function(e,t,n){return void 0===n&&(n={}),ql(this,void 0,void 0,(function(){var r,o,i,s,a,u=this;return Dl(this,(function(c){switch(c.label){case 0:return n=_.a.defaults(n,{bypassCache:!1,ignoreNotFound:!1}),r=this.host.models.User.get(e),n.bypassCache?[3,2]:r&&!r.$placeholder&&r.profileByOrganizationId&&r.profileByOrganizationId[t]?[4,this.host.metadata.find(e,t,n)]:[3,2];case 1:return c.sent(),this.host.models.User.touch(e),[2,{cached:!0,user:r}];case 2:return[4,this.host.api.users.find(e,{organizationId:t})];case 3:if((o=c.sent())&&(o.entity&&(o.entity.organization_token=o.organization_id,o.entity.conversation_id=o.conversation_id,o=o.entity),o.token&&(o.id=o.token,delete o.token),i=o.dnd_auto_forward_receivers,s=void 0===i?[]:i,a=o.metadata,s.forEach((function(e){return u.host.models.User.injectPlaceholder(e)})),o.dnd_auto_forward_receivers=s,r=this.host.models.User.inject(o),a&&("role"===a.feature_service?this.host.roles.__injectSearchResult({entity:r,metadata:a,organizationId:t}):this.host.metadata.__injectMetadata(r.id,t,a))),!n.ignoreNotFound&&!o)throw new C(this.host.models.User.name,e);return[2,{cached:!1,data:o,user:r}]}}))}))},t.prototype.findProfileForOrganizations=function(e,t,n){return void 0===n&&(n={}),ql(this,void 0,void 0,(function(){var r;return Dl(this,(function(o){switch(o.label){case 0:return n=_.a.defaults(n,{bypassCache:!1,ignoreNotFound:!1}),[4,this.find(e,Ul(Ul({},n),{organizationIds:t}))];case 1:return[2,(r=o.sent())?r.profileByOrganizationId:r]}}))}))},t.prototype.findProfileForOrganization=function(e,t,n){return void 0===n&&(n={}),ql(this,void 0,void 0,(function(){var r;return Dl(this,(function(o){switch(o.label){case 0:return n=_.a.defaults(n,{bypassCache:!1,ignoreNotFound:!0}),"string"!=typeof t&&(t=t.id),[4,this.find(e,Ul(Ul({},n),{organizationId:t}))];case 1:return r=o.sent(),[2,r&&r.profileByOrganizationId&&r.profileByOrganizationId[t]||null]}}))}))},t.prototype.ensureUsers=function(e,t){return ql(this,void 0,void 0,(function(){var n,r,o,i;return Dl(this,(function(s){switch(s.label){case 0:for(this.host.requireUser(),"string"!=typeof t&&(t=t.id),n=[],r=0,o=e;r<o.length;r++)i=o[r],n.push(this.find(i,{organizationId:t,ignoreNotFound:!0}));return[4,Promise.all(n)];case 1:return[2,s.sent()]}}))}))},t.prototype.refresh=function(e){return ql(this,void 0,void 0,(function(){return Dl(this,(function(t){switch(t.label){case 0:return[4,this.find(e,{ignoreNotFound:!0,bypassCache:!0})];case 1:return[2,t.sent()]}}))}))},t.prototype.update=function(e){var t=e.firstName,n=e.lastName,r=e.displayName,o=e.status,i=e.dnd,s=e.dndText,a=e.avatarFile,u=e.removeAvatar;return ql(this,void 0,void 0,(function(){var e,c,l;return Dl(this,(function(d){switch(d.label){case 0:return this.host.requireUser(),e=Ur.a.call({firstName:t,lastName:n,displayName:r,status:o,dnd:i,dndText:s,avatarFile:a,removeAvatar:u},(function(e,t){return void 0===e})),[4,this.host.api.users.update(this.host.currentUserId,e)];case 1:return c=d.sent(),l=_.a.omit(e,"removeAvatar","avatarFile"),u?l.avatarUrl=null:void 0!==c.avatarUrl&&(l.avatarUrl=c.avatarUrl),[2,this.host.models.User.inject(Ul({id:this.host.currentUserId},l))]}}))}))},t.prototype.updatePassword=function(e,t){return ql(this,void 0,void 0,(function(){return Dl(this,(function(n){return this.host.requireUser(),[2,this.host.api.users.updatePassword(this.host.currentUserId,e,t,this.config.productKey)]}))}))},t.prototype.setAutoForward=function(e,t){return ql(this,void 0,void 0,(function(){var n;return Dl(this,(function(r){switch(r.label){case 0:return this.host.requireUser(),n=this.host.currentUser.dnd,[4,this.host.api.users.setAutoForward(this.host.currentUserId,e,{dnd:n,receiverId:t})];case 1:return r.sent(),[2,!0]}}))}))},t.prototype.removeAutoForward=function(e){return ql(this,void 0,void 0,(function(){return Dl(this,(function(t){switch(t.label){case 0:return this.host.requireUser(),[4,this.host.api.users.removeAutoForward(this.host.currentUserId,e)];case 1:return t.sent(),[2,!0]}}))}))},t.prototype.setEulaAccepted=function(e,t){return ql(this,void 0,void 0,(function(){return Dl(this,(function(n){switch(n.label){case 0:return this.host.requireUser(),[4,this.host.api.users.setEulaAccepted(this.host.currentUserId,e,t)];case 1:return[2,n.sent()]}}))}))},t.prototype.setAwayMessage=function(e,t){return void 0===t&&(t={}),ql(this,void 0,void 0,(function(){var n,r,o;return Dl(this,(function(i){switch(i.label){case 0:return n=t.dnd,r=t.dndText,o=void 0===r?"":r,this.host.requireUser(),[4,this.host.api.users.setAwayMessage(this.host.currentUserId,e,{dnd:n,dndText:o})];case 1:return i.sent(),[2]}}))}))},t.prototype.getSignInAuthHeader=function(e,t){return this.host.api.users.getSignInAuthHeader(this.config.productKey,e,t)},t.prototype.getAll=function(){return this.host.models.User.getAll()},t.prototype.getById=function(e){return this.host.models.User.get(e)},t.prototype.getMultiById=function(e){return this.host.models.User.getMulti(e)},t.prototype._onChangeCurrentUserRole=function(e){var t=e.botUser;if(t){var n=this.host.roles._roleConversations[t.id];if(n)for(var r=0,o=n;r<o.length;r++){for(var i=o[r],s=!1,a=0,u=i.content;a<u.length;a++){var c=u[a];c.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(c),s=!0}s||this.host.models.Conversation.inject(i)}}},t.prototype.reactToUserPreferencesEvent=function(e){this.emit("preferences:change",Ae.camelizeObject(e))},t.PROFILE_ATTRIBUTES_PER_ORG=sl,Ll([Object(zi.decorator)({serializeArguments:function(e){return""}})],t.prototype,"signOut",null),Ll([Object(zi.decorator)()],t.prototype,"findOrCreate",null),Ll([Object(zi.decorator)()],t.prototype,"signOutAllDevices",null),Ll([Object(zi.decorator)()],t.prototype,"findMe",null),Ll([Object(zi.decorator)()],t.prototype,"findMyProfilesForAllOrganizations",null),Ll([Object(zi.decorator)()],t.prototype,"find",null),Ll([Object(zi.decorator)()],t.prototype,"__find",null),Ll([Object(zi.decorator)()],t.prototype,"refresh",null),t}(Bs),Gl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vl=function(){return(Vl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Kl=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Hl=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},$l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gl(t,e),t.prototype.findAll=function(e,t){var n=(void 0===t?{showAll:!1}:t).showAll;return Kl(this,void 0,void 0,(function(){var t=this;return Hl(this,(function(r){switch(r.label){case 0:if(!e)throw new q("organizationId","required");return[4,this.host.api.virtualWaitingRoom.findAll(e,{showAll:n})];case 1:return[2,r.sent().content.map((function(e){return t.host.models.VirtualWaitingRoom.inject(e)}))]}}))}))},t.prototype.find=function(e,t){return Kl(this,void 0,void 0,(function(){var n;return Hl(this,(function(r){switch(r.label){case 0:if(!t)throw new q("organizationId","required");if(!e)throw new q("room_id","required");return[4,this.host.api.virtualWaitingRoom.find(e,t)];case 1:return n=r.sent(),[2,this.host.models.VirtualWaitingRoom.inject(n)]}}))}))},t.prototype.create=function(e,t){var n=t.staff,r=t.name;return Kl(this,void 0,void 0,(function(){var t;return Hl(this,(function(o){switch(o.label){case 0:if(!e)throw new q("organizationId","required");if(!n)throw new q("staff","required");if(!r)throw new q("name","required");return[4,this.host.api.virtualWaitingRoom.create(e,{staff:n,name:r})];case 1:return t=o.sent(),[2,this.host.models.VirtualWaitingRoom.inject(t)]}}))}))},t.prototype.update=function(e,t,n){var r=n.staff,o=n.name,i=n.status,s=n.version;return Kl(this,void 0,void 0,(function(){var n;return Hl(this,(function(a){switch(a.label){case 0:if(!t)throw new q("organizationId","required");if(!e)throw new q("room_id","required");return[4,this.host.api.virtualWaitingRoom.update(e,t,{staff:r,name:o,status:i,version:s})];case 1:return n=a.sent(),[2,this.host.models.VirtualWaitingRoom.inject({id:e,staff:r,name:o,status:i,version:n.version})]}}))}))},t.prototype.delete=function(e,t){return Kl(this,void 0,void 0,(function(){var n;return Hl(this,(function(r){switch(r.label){case 0:if(!t)throw new q("organizationId","required");if(!e)throw new q("room_id","required");return(n=this.host.models.VirtualWaitingRoom.get(e))&&this.host.models.VirtualWaitingRoom.eject(n),[4,this.host.api.virtualWaitingRoom.delete(e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype.getVisitInfo=function(e){return Kl(this,void 0,void 0,(function(){return Hl(this,(function(t){switch(t.label){case 0:if(!e)throw new q("joinId","required");return[4,this.host.api.virtualWaitingRoom.getVisitInfo(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.createVisit=function(e){var t=e.firstName,n=e.lastName,r=e.mobilePhone,o=e.visitReason,i=e.joinId;return Kl(this,void 0,void 0,(function(){return Hl(this,(function(e){switch(e.label){case 0:return[4,this.host.api.virtualWaitingRoom.createVisit({firstName:t,lastName:n,mobilePhone:r,visitReason:o,joinId:i})];case 1:return[2,e.sent()]}}))}))},t.prototype.visitorLogin=function(e){var t=e.groupId,n=e.accountKey,r=e.accountSecret,o=e.organizationId;return Kl(this,void 0,void 0,(function(){var e;return Hl(this,(function(i){switch(i.label){case 0:return this.host.emit("signingIn"),this.host.configure({events:Vl(Vl({},this.host.config.events),{singleConversation:t})}),this.host._setAuth({key:n,secret:r}),this.host.setDefaultOrganization(o),[4,this.host.users.findMe({ignoreNotFound:!0,isVwrFeature:!0})];case 1:return e=i.sent(),this.host._setCurrentUser(e),this.host.emit("signedIn",e,this.host.getAuth()),this.host.messages._fetchAttachmentTokens(20,{isVwrFeature:!0}),[2]}}))}))},t.prototype.rejoinVisit=function(e){var t=e.rejoinToken,n=e.sessionTokens;return Kl(this,void 0,void 0,(function(){return Hl(this,(function(e){switch(e.label){case 0:return[4,this.host.api.virtualWaitingRoom.rejoinVisit({rejoinToken:t,sessionTokens:n})];case 1:return[2,e.sent()]}}))}))},t.prototype.rejoinWithAuthForm=function(e){var t=e.rejoinToken,n=e.challengeAnswers;return Kl(this,void 0,void 0,(function(){return Hl(this,(function(e){switch(e.label){case 0:return[4,this.host.api.virtualWaitingRoom.rejoinWithAuthForm({rejoinToken:t,challengeAnswers:n})];case 1:return[2,e.sent()]}}))}))},t.prototype.clearAllCompletedVisits=function(e){var t=e.roomId,n=e.organizationId;return Kl(this,void 0,void 0,(function(){return Hl(this,(function(e){switch(e.label){case 0:return[4,this.host.api.virtualWaitingRoom.cleanupVisits({type:"delete_completed_visits",roomId:t,organizationId:n})];case 1:return e.sent(),[2]}}))}))},t.prototype.reactToJoinableCallSSE=function(e){var t=e.data,n=e.type,r=Rs(t);r.vwrCallStatus=n.split(":")[1],this.host.models.VirtualWaitingRoom.inject(r)},t.prototype.findAllVisits=function(e,t){return Kl(this,void 0,void 0,(function(){var n=this;return Hl(this,(function(r){switch(r.label){case 0:if(!t)throw new q("organizationId","required");if(!e)throw new q("roomId","required");return[4,this.host.api.virtualWaitingRoom.findAllVisits(e,t)];case 1:return[2,r.sent().content.map((function(r){return n.host.models.VirtualWaitingRoomVisit.inject(Vl({roomId:e,organizationId:t},r))}))]}}))}))},t.prototype.informProvider=function(e,t){return Kl(this,void 0,void 0,(function(){return Hl(this,(function(n){if(!e)throw new q("organizationId","required");if(!t.roomId)throw new q("roomId","required");if(!t.visitId)throw new q("visitId","required");if(!t.accountToken)throw new q("accountToken","required");return[2,this.host.api.virtualWaitingRoom.informProvider(e,t)]}))}))},t.prototype.updateVisit=function(e,t){return Kl(this,void 0,void 0,(function(){var n;return Hl(this,(function(r){switch(r.label){case 0:if(!e)throw new q("organizationId","required");if(!t.roomId)throw new q("roomId","required");if(!t.visitId)throw new q("visitId","required");return[4,this.host.api.virtualWaitingRoom.updateVisit(e,t)];case 1:return n=r.sent(),[2,this.host.models.VirtualWaitingRoomVisit.inject(Vl(Vl({},n),{id:t.visitId,organizationId:e}))]}}))}))},t}(Bs),Wl=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},Xl=function(e,t){t.host;return e.defineModel("call",{replaceKeys:{},defaultValues:{},skipCamelizationForKeys:["payload"],parseAttrs:function(e){if(e.id||(e.id=e.roomName),e.payload){var t={};e.payload.disabled_participants&&(t=e.payload.disabled_participants,delete e.payload.disabled_participants),e.payload=Ae.camelizeObject(e.payload),e.payload.disabledParticipants=t}return e.payload&&(e.payload.orgId&&(e.organizationId=e.payload.orgId),e.payload.callId&&(e.callId=e.payload.callId),e.payload.groupId&&(e.groupId=e.payload.groupId),e.payload.participantsTokens&&e.payload.callerId&&(e.memberIds=Wl(e.payload.participantsTokens,[e.payload.callerId]))),delete e.serverId,e}})},Ql=function(e,t){var n=t.host;return e.defineModel("callLogEntry",{parseAttrs:function(e){return e.isContact=_s()(e,"target.entity.metadata.isPatientContact"),e.isGroup="tigertext:entity:group"===_s()(e,"target.type"),e.memberCount=_s()(e,"target.entity.numMembers"),e.isMissed="missed_voip_call"===e.type,e.isOptedOut=_s()(e,"target.entity.metadata.smsOptedOut",!1),e.isOutgoing=n.currentUserId===_s()(e,"caller.entity.token"),e.isQuickCall=Boolean(Fr(_s()(e,"target.entity.displayName")))&&"00000"===_s()(e,"target.entity.metadata.patientMrn"),e}})},Yl={DEFAULT:"",PATIENT_MESSAGING:"patient_messaging",VIRTUAL_WAITING_ROOM:"vwr"},Jl=function(e,t){var n=t.host;return e.defineModel("conversation",{instanceEvents:!0,transientAttrs:["_counterPartyAddedOnServer","_origIndex","highestSortNumber","unreadCount","unreadPriorityCount"],defaultValues:{_markingAsRead:!1,_markingAsReadSortNumber:null,_markingAsReadExpiration:null,featureService:Yl.DEFAULT,firstExpiringUnreadMessage:null,firstUnreadMessage:null,higherContinuation:null,highestSortNumber:0,inProgressEscalationCount:0,isLive:!1,lastBangMessageSortNumber:0,lastIncomingMessageSortNumber:0,lastMessage:null,lowerContinuation:null,markableAsReadMessages:null,messages:null,muted:null,network:ko.PROVIDER,timeline:null,unreadCount:0,unreadPriorityCount:0},skipCamelizationForKeys:["metadata","muted"],parseAttrs:function(e){if("muted"in e&&e.muted){var t=e.muted;if(Object.keys(t).length>0){var r=t.mute_duration,o=t.mute_start;o&&(o=1e3*+o);var i=n.mute._addEntry(e.id,{durationInMinutes:r,organizationId:e.organizationId,startedAt:o});e.muted=i}else e.muted=null}return e},afterAssignment:function(t){var r=t.counterParty,o=t.counterPartyId,i=t.counterPartyType,s=t.id,a=t.isDeletable,u=t.isMuteable,c=t.metadata,l=t.muted;if(e.host.config.condensedReplays?l||(l=n.mute.getById(s)):l=n.mute._getByConversationHandle(s),t.muted=l,t.isMuted=!!t.muted,r?(o=r.id,i=r.$entityType):r=i&&o?e.store.get(i,o):null,t.counterParty=r,t.counterPartyId=o,t.counterPartyType=i,t.shouldDisplay=!("user"===i&&r&&!r.shouldDisplay),n.conversations._setAllowedSenders(t),a=!0,u="distributionList"!==i,r&&"group"===i){var d=r.groupType,h=r.p2pSender;if(d===Ao.ROLE_P2P){var p=h&&"role"===h.$entityType;a=t.allowedSenders.length>0&&!p,u=u&&t.allowedSenders.length>0}else d===Ao.ESCALATION?(a=!1,u=!0):d===Ao.PATIENT_MESSAGING&&(a=t.counterParty.memberCount>2)}else r&&"team"===i&&(a=!1,u=!1);t.isDeletable=a,t.isMuteable=u,t.markableAsReadMessages||(t.markableAsReadMessages=[]),t.messages||(t.messages=[]),t.timeline||(t.timeline=[]),t.higherContinuation||(t.higherContinuation={continuation:e.host.config.condensedReplays?{higher_continuation:null}:"HIGHER",itemsEstimate:null}),t.lowerContinuation||(t.lowerContinuation={continuation:e.host.config.condensedReplays?{lower_continuation:null}:"LOWER",itemsEstimate:null}),c&&"patient_messaging"===c.feature_service&&(t.network=ko.PATIENT,t.featureService=Yl.PATIENT_MESSAGING,"group"===i&&(t.patientId="patient:"+c.patient_id,c.patient_contact_id&&(t.patientContactId="patientContact:"+c.patient_contact_id))),c&&"vwr"===c.feature_service&&(t.network=ko.PATIENT,t.featureService=Yl.VIRTUAL_WAITING_ROOM)},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}},hasMany:{content:{type:"message",foreignKey:"conversationId",sortBy:[["sortNumber","asc"],["id","asc"]]}}}})},Zl=function(e,t){var n=e.defineModel("distributionList",{replaceKeys:{avatar:"avatarUrl",createdBy:"createdById",displayName:"name",organizationKey:"organizationId",totalMembers:"memberCount",updatedBy:"updatedById"},skipCamelizationForKeys:["metadata"],transientAttrs:["$deleted"],defaultValues:{memberCount:0},afterAssignment:function(e){e.displayName=e.name},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},organization:{type:"organization",foreignKey:"organizationId"},updatedBy:{type:"user",foreignKey:"updatedById"}}}});return ol(n,{finder:function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return(e=t.host.distributionLists).find.apply(e,n)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Distribution List..."},defaultNotFoundAttrs:{name:"<Distribution List Not Found>"}}),n},ed=function(e,t){var n=t.host;return e.defineModel("escalationExecution",{replaceKeys:{destructionDuration:"minutesToExpire",destructionTime:"expiresAt",displayName:"displayId",escalationExecutionId:"id",escalationGroupToken:"groupId",escalationPath:"path",escalationStatus:"status",level:"currentStep",organizationToken:"organizationId",targetDuration:"targetMinutesToAcknowledge",targetToken:"targetId",triggeredMessageToken:"carbonCopyMessageId",triggeringConversationId:"originalGroupConversationId",triggeringMessageToken:"originalMessageId"},defaultValues:{currentStep:0,status:Eo.IN_PROGRESS},parseAttrs:function(e){if("actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),"carbonCopyMessageId"in e&&"string"==typeof e.carbonCopyMessageId&&"undefined"===e.carbonCopyMessageId&&(e.carbonCopyMessageId=null),"displayId"in e&&(e.displayId.startsWith("#")&&(e.displayId=e.displayId.slice(1)),e.displayId=e.displayId.toUpperCase()),"expiresAt"in e&&"string"==typeof e.expiresAt&&(e.expiresAt=new Date(e.expiresAt).getTime()),"groupId"in e&&"string"==typeof e.groupId&&"undefined"===e.groupId&&(e.groupId=null),"path"in e){for(var t=[],r=!1,o=0,i=e.path;o<i.length;o++){for(var s=i[o],a=s.targets,u=s.duration,c=[],l=0,d=a;l<d.length;l++){var h=d[l];if("string"==typeof h)c.push(n.injectPlaceholderModel({id:h},"user"));else if(h&&h.token){var p=h.displayName,f=h.token;c.push(n.injectPlaceholderModel({id:f,displayName:p},"user"))}else r=!0}t.push({minutesToAcknowledge:u,targets:c})}r?delete e.path:e.path=t}return"status"in e&&("init"===e.status&&(e.status="in_progress"),"destruct"===e.status&&(e.status="cancelled"),e.status=Eo.resolve(e.status)),e},afterAssignment:function(e){},relations:{belongsTo:{carbonCopyMessage:{type:"message",foreignKey:"carbonCopyMessageId"},group:{type:"group",foreignKey:"groupId"},organization:{type:"organization",foreignKey:"organizationId"},originalConversation:{type:"conversation",foreignKey:"originalGroupConversationId"},originalMessage:{type:"message",foreignKey:"originalMessageId"},target:{type:"user",foreignKey:"targetId"},escalationGroupConversation:{type:"conversation",foreignKey:"escalationGroupConversationId"}}}})},td=function(e,t){t.host;return e.defineModel("escalationExecutionChange",{parseAttrs:function(e){return"actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),e}})},nd=function(e,t){var n=t.host;return e.defineModel("escalationPolicy",{replaceKeys:{destructionDuration:"minutesToExpire",escalationPath:"path",target:"targetId",targetDuration:"targetMinutesToAcknowledge"},defaultValues:{alwaysEscalate:!1},parseAttrs:function(e){if("path"in e){for(var t=[],r=!1,o=0,i=e.path;o<i.length;o++){for(var s=i[o],a=s.targets,u=s.duration,c=[],l=0,d=a;l<d.length;l++){var h=d[l];if("string"==typeof h)c.push(n.injectPlaceholderModel({id:h},"user"));else if(h&&h.token){var p=h.displayName,f=h.token;c.push(n.injectPlaceholderModel({id:f,displayName:p},"user"))}else r=!0}t.push({minutesToAcknowledge:u,targets:c})}r?delete e.path:e.path=t}return e},afterAssignment:function(e){},relations:{belongsTo:{target:{type:"user",foreignKey:"targetId"}}}})},rd=function(e,t){var n=t.host,r=e.defineModel("group",{replaceKeys:{avatar:"avatarUrl",createdTime:"createdAt",displayName:"name",members:"memberIds",numMembers:"__memberCount",organizationKey:"organizationId",proxied_members:"proxiedMembers"},transientAttrs:["__memberCount"],defaultValues:{hasCurrentUser:!1,isPublic:!1,memberIds:null},skipCamelizationForKeys:["escalation","metadata","proxied_members"],parseAttrs:function(e){if("createdAt"in e&&(e.createdAt=new Date(e.createdAt)),"createdBy"in e&&delete e.createdBy,e.avatarUrl&&(e.avatarUrl=Qc(e.avatarUrl,n.config)),"escalation"in e){var t=n.escalations._updateEscalation(e.escalation,{inGroupInject:!0});delete e.escalation,e.escalationExecutionId=t.id}if(e.memberIds){for(var r=[],o=0,i=e.memberIds;o<i.length;o++){var s=i[o];"string"==typeof s?r.push(s):s.id&&r.push(s.id)}e.memberIds=r}if(e.metadata&&"patient_care"===e.metadata.feature_service&&(e.patientDetails=e.metadata.patient),e.metadata&&"patient_messaging"===e.metadata.feature_service&&(e.patientDetails={dob:e.metadata.patient_dob,gender:e.metadata.patient_gender,id:e.metadata.patient_id,isPatientContact:e.metadata.is_patient_contact,mrn:e.metadata.patient_mrn,name:e.metadata.patient_name,phoneNumber:e.metadata.phone_number,smsOptedOut:e.metadata.sms_opted_out},e.patientDetails.isPatientContact&&e.metadata.relation_name&&(e.patientDetails.relationName=e.metadata.relation_name)),e.metadata)if(e.metadata.team&&(e.metadata.team.token||e.metadata.team.id)){var a=n.models.Team.inject(e.metadata.team);a&&(e.teamId=a.id)}else e.metadata.team_token&&(e.teamId=e.metadata.team_token);return"metadata"in e&&delete e.metadata,e},afterAssignment:function(e){var t,r=e.id,o=e.memberIds,i=e.organizationId;n.config.condensedReplays?e.conversationId&&(t=n.conversations.getById(e.conversationId)):t=i?n.conversations.get("group",r,i):null;var s=i?n.metadata.get(r,i):null;s&&(s=s.data);var a=n.groups.__extractGroupTypeFromAttrs(e),u=s&&a===Ao.ROLE_P2P?s.target_display_name:e.name;e.conversation=t,e.displayName=u,e.groupType=a,e.memberCount=o&&o.length||e.__memberCount||0,e.metadata=s,"FORUM"!==a&&delete e.hasCurrentUser,n.users._setMembersOnEntity(e),n.groups._setMembership(e),n.groups._setP2PEntities(e)},beforeCreateInstance:function(e){!function(e,t,r){if(!t||0===t.length)return;n.groups.ensureMembersWithIds(e,t,{onlyPlaceholder:!0,attrs:{organizationId:r}})}(e.id,e.memberIds,e.organizationId)},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},escalationExecution:{type:"escalationExecution",foreignKey:"escalationExecutionId"},team:{type:"team",foreignKey:"teamId"}}}});return ol(r,{finder:function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=n.groups).find.apply(e,t)},placeholderEntityDelayBeforeRefreshing:function(){return n.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return n.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading group..."},defaultNotFoundAttrs:{displayName:"<Group Not Found>"},shouldEnsure:function(e,t,r){var o=r.groupMembersOnlyPlaceholder;return!e.members||!e.metadata||e.groupType===Ao.ROLE_P2P||e.members.some((function(e){return n.models.User.shouldEnsure(e,o)}))}}),r},od=function(e,t){t.host;return e.defineModel("groupMembersChange",{parseAttrs:function(e){return"actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),e}})},id=function(e,t){var n=t.host;return e.defineModel("message",{replaceKeys:{clientId:"id",createdTime:"createdAt",data:"metadata",dndAutoForwardedFrom:"autoForwardedFromId",dor:"deleteOnRead",escalationExecId:"escalationExecutionId",groupAvatar:"groupAvatarUrl",groupToken:"groupId",messageId:"id",originalData:"originalMetadata",originalMsgId:"originalMessageId",originalSenderName:"originalSenderDisplayName",originalTimestamp:"originalForwardedMessageCreatedAt",recipient:"recipientId",recipientOrganization:"recipientOrganizationId",recipientOrgToken:"recipientOrganizationId",recipientToken:"recipientId",sender:"senderId",senderAvatar:"senderAvatarUrl",senderOrganization:"senderOrganizationId",senderOrgToken:"senderOrganizationId",senderToken:"senderId"},transientAttrs:["__organizationId","$synced","escalationExecutionChange","groupMembersChange","inTimeline"],defaultValues:{inTimeline:!1,isUnread:!1,messageType:zo.USER_SENT,senderStatus:So.NEW,shouldEnsureRecipientStatus:!1,sortNumber:0},skipCamelizationForKeys:["escalation","metadata","originalMetadata"],parseAttrs:function(e){if(e.teamRequest&&(e.senderId||(e.senderId=e.teamRequest.createdById),e.teamRequestId=e.teamRequest.id,delete e.teamRequest),"attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,"undefined"!==t&&Array.isArray(e.attachments)&&e.attachments.length>0&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach((function(e,t){return e.id=""+(t+1)})),"priority"in e&&(e.priority=Co.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"expireIn"in e&&(e.expiresAt=Date.now()+1e3*e.expireIn,delete e.expireIn),"recipientStatus"in e&&delete e.recipientStatus,"status"in e&&delete e.status,"xmlns"in e&&delete e.xmlns,"escalation"in e){var r=n.escalations._updateEscalation(e.escalation);delete e.escalation,e.escalationExecutionId=r.id}if("subType"in e&&(e.subType=Mo.resolve(e.subType)),e.metadata){e.metadata=_.a.castArray(e.metadata).map(n.metadata.__parseMessageMetadata).filter(Boolean);var o=e.metadata.find((function(e){return"tigertext:message:role:sender"===e.namespace})),i=e.metadata.find((function(e){return"tigertext:message:role:owner"===e.namespace})),s=e.metadata.find((function(e){return"tigertext:message:patient_care"===e.namespace}));if(o&&o.payload){var a=e.senderOrganizationId,u=o.payload;e.senderRole=n.roles.__parseRoleFromMetadata({metadata:u,organizationId:a}),e.currentSenderRoleId=e.senderRole.id}if(i&&i.payload){a=e.senderOrganizationId;var c=e.senderId;u=i.payload;e.senderId=u.token,c!==u.token&&(e.senderRole={$entityType:"role",botUserId:c,id:"role:"+c,organizationId:a},e.currentSenderRoleId="role:"+c)}if(s&&s.payload){for(var l=[],d=0,h=s.payload.components;d<h.length;d++){var p=h[d];"type"in p&&(p.type=Uo.resolve(p.type)),"sub_type"in p&&(p.sub_type=xo.resolve(p.sub_type)),"action_type"in p&&(p.action_type=No.resolve(p.action_type)),l.push(p)}e.patientCareCard=l}}else"metadata"in e&&delete e.metadata;if(e.originalMetadata){e.originalMetadata=_.a.castArray(e.originalMetadata).map(n.metadata.__parseMessageMetadata).filter(Boolean);o=e.originalMetadata.find((function(e){return"tigertext:message:role:sender"===e.namespace})),i=e.originalMetadata.find((function(e){return"tigertext:message:role:owner"===e.namespace}));var f=e.originalMetadata.find((function(e){return"tigertext:message:patient_messaging"===e.namespace}));if(o&&o.payload){a=e.senderOrganizationId,u=o.payload;e.originalSenderRole=n.roles.__parseRoleFromMetadata({metadata:u,organizationId:a})}if(i&&i.payload){var v=e.originalSender,y=e.originalSenderDisplayName,g=e.originalSenderRole;a=e.senderOrganizationId,u=i.payload;g||"string"!=typeof v||(e.originalSenderRole={$entityType:"role",botUserId:v,displayName:y,id:"role:"+v,organizationId:a}),(!v||v&&"string"==typeof v)&&(e.originalSender={$entityType:"user",displayName:u.display_name,id:u.token,organizationId:a})}"isForwarded"in e&&e.isForwarded&&f&&(e.isForwardedFromPatientNetwork=!0,f.payload&&(e.patientDetails={isPatientContact:f.payload.is_patient_contact,mrn:f.payload.patient_mrn,patientId:f.payload.patient_id,patientName:f.payload.patient_name},f.payload.is_patient_contact&&(e.patientDetails.contactId=f.payload.patient_contact_id,e.patientDetails.contactName=f.payload.patient_contact_name,e.patientDetails.relation=f.payload.relation_name),e.originalGroupId=f.payload.group_id,e.originalGroupName=f.payload.group_name))}if("originalSender"in e&&"string"==typeof e.originalSender){a=e.senderOrganizationId,v=e.originalSender,y=e.originalSenderDisplayName;e.originalSender={$entityType:"user",displayName:y,id:v,organizationId:a},"patientDetails"in e&&(e.patientDetails.patientId===e.originalSender.id&&(e.originalSender.isPatient=!0),e.patientDetails.contactId===e.originalSender.id&&(e.originalSender.isPatientContact=!0,e.originalSender.relation=e.patientDetails.relation)),delete e.originalSenderDisplayName}return e},afterAssignment:function(t){var r=t.__organizationId,o=t.counterParty,i=t.counterPartyId,s=t.counterPartyType,a=t.createdAt,u=t.isOutgoing,c=t.recipientOrganizationId,l=t.senderId,d=t.senderOrganizationId,h=n.currentUserId;if(o)switch(i=o.id,s=o.$entityType){case"group":t.groupId=i,delete t.recipientId;break;case"distributionList":t.distributionListId=i,delete t.recipientId}else o=s&&i?e.store.get(s,i):null;t.counterParty=o,t.counterPartyId=i,t.counterPartyType=s,a||(a=new Date),l&&(u=n.messages._isMessageOutgoing(t)),u&&d?r=d:!u&&c&&(r=c),t.__organizationId=r,t.canRecall="distributionList"!==s&&l===h,t.createdAt=a,t.isOutgoing=u,t.isAutoForwarded=!!t.autoForwardedFromId,t.subType||(t.subType=Mo.NA),n.messages._setRecipientStatus(t)},relations:{belongsTo:{autoForwardedFrom:{type:"user",foreignKey:"autoForwardedFromId"},conversation:{type:"conversation",foreignKey:"conversationId"},currentSenderRole:{type:"role",foreignKey:"currentSenderRoleId"},distributionList:{type:"distributionList",foreignKey:"distributionListId"},escalationExecution:{type:"escalationExecution",foreignKey:"escalationExecutionId"},group:{type:"group",foreignKey:"groupId"},originalGroup:{type:"group",foreignKey:"originalGroupId"},recipient:{type:"user",foreignKey:"recipientId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},sender:{type:"user",foreignKey:"senderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"},teamRequest:{type:"teamRequest",foreignKey:"teamRequestId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}}})},sd=function(e){return e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:So.NA},parseAttrs:function(e){return e.status&&(e.status=So.resolve(e.status)),e.createdAt&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),e},beforeInject:function(e,t){if(t){var n=t.status,r=e.status;Po[r]<Po[n]&&(delete e.createdAt,delete e.status)}},relations:{belongsTo:{distributionList:{type:"distributionList",foreignKey:"distributionListId"},message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}})},ad=function(e,t){t.host;return e.defineModel("messageTemplate",{replaceKeys:{createdBy:"createdById",templateLabel:"title",updatedBy:"updatedById"},transientAttrs:["$deleted"],parseAttrs:function(e){return e.hasAttachment=!1,e.attachmentName&&e.attachmentSize&&e.attachmentType&&(e.hasAttachment=!0),e},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},organization:{type:"organization",foreignKey:"organizationId"},updatedBy:{type:"user",foreignKey:"updatedById"}}}})},ud=function(e,t){return e.defineModel("metadata",{parseAttrs:function(e,t){return e.data=t.data,e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},cd=function(e,t){t.host;return e.defineModel("mute",{parseAttrs:function(e){return e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},ld=n(29),dd=n.n(ld),hd=n(30),pd=n.n(hd);function fd(e,t){return t in e?e[t].value:null}var vd=function(e,t){var n=t.host,r=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{allowMsgForward:"__isForwardAllowed",allowPublicGroups:"forumsEnabled",allowRoleScheduleUpload:"__isRolesScheduleUploadEnabled",desktopPriorityMessaging:"__desktopPriorityMessagingSounds",eula:"eulaEnabled",eulaContent:"eulaUrl",featurePatientCare:"__canShowPatientCare",featurePatientNetwork:"__canShowPatientNetwork",featureRoleScheduleUpload:"__canUploadRolesSchedule",featureRoleService:"rolesEnabled",featureRolesEscalation:"__canEscalateMessages",featureTeams:"__canShowTeams",featureTransactions:"canShowTransactions",latestIncomingMessageSortNumber:"lastIncomingMessageSortNumber",members:"memberCount",organizationKey:"organizationId",patientCare:"__showPatientCare",patientNetwork:"__showPatientNetwork",pfNoAttachment:"__isPFAttachmentAllowed",pfNoPhoto:"__isPFPhotoAllowed",roleService:"canAdminRoles",rolesEscalation:"__isRolesEscalationEnabled",ssoWebSessionDuration:"desktopExtendedSession",teams:"__showTeams"},defaultValues:{__canEscalateMessages:!1,__canShowPatientCare:!1,__canShowTeams:!1,__canUploadRolesSchedule:!1,__isForwardAllowed:!1,__isPFAttachmentAllowed:!1,__isPFPhotoAllowed:!1,__isRolesEscalationEnabled:!1,__isRolesScheduleUploadEnabled:!1,__showPatientCare:!1,__showTeams:!1,canAdminRoles:!1,canShowTransactions:!1,desktopExtendedSession:-1,forumsEnabled:!1,highestSortNumber:0,isPatientNetworkEnabled:!1,lastIncomingMessageSortNumber:0,networks:null,paid:!1,rolesEnabled:!1,settings:{},unreadCount:0,unreadPriorityCount:0},transientAttrs:["unreadCount","unreadPriorityCount"],parseAttrs:function(e){return e.settings&&(e.settings=pd.a.call(dd.a.call(e.settings,(function(e){return Ae.camelizeKey(e.name)})),(function(e){isFinite(e.value)&&(e.value=+e.value),"true"===e.value&&(e.value=!0),"false"===e.value&&(e.value=!1)}))),e},afterAssignment:function(e){var t=e.__canEscalateMessages,r=e.__canShowPatientCare,o=e.__canShowPatientNetwork,i=e.__canShowTeams,s=e.__canUploadRolesSchedule,a=e.__desktopPriorityMessagingSounds,u=e.__isForwardAllowed,c=e.__isPFAttachmentAllowed,l=e.__isPFPhotoAllowed,d=e.__isRolesEscalationEnabled,h=e.__isRolesScheduleUploadEnabled,p=e.__showPatientCare,f=e.__showPatientNetwork,v=e.__showTeams,y=e.autoForwardReceiverId,g=e.id,m=e.name,_=e.paid,b=e.settings;v=v&&!!fd(b,"teams"),f="individual"===f?!!fd(b,"patientNetwork"):!!f,y=fd(b,"dndAutoForwardReceiver"),e.allowPriorityMessage=!!fd(b,"priorityMessaging"),e.autoLogoutMinutes=fd(b,"autologoutTime")||1440,e.canUploadRolesSchedule=s&&h,e.deleteOnRead=!!fd(b,"dor"),e.desktopAutoUpdate=!!fd(b,"autoUpdate"),e.isEulaAccepted=!fd(b,"eula"),e.isForwardAllowed=u&&1===fd(b,"forward"),e.messageTimeToLive=fd(b,"ttl")||-1,e.isPatientBroadcastEnabled=!!fd(b,"pfBroadcast"),e.isPatientScheduledMessagesEnabled=!!fd(b,"pfScheduleMessages"),e.isPatientVirtualWaitingRoomEnabled=!!fd(b,"pfVirtualWaitingRoom"),e.isPFVideoCallEnabled=!!fd(b,"pfVideoCall"),e.isPFVoiceCallEnabled=!!fd(b,"pfVoiceCall"),e.isPFGroupVideoCallEnabled=!!fd(b,"pfGroupVideoCall"),e.isPFGroupVoiceCallEnabled=!!fd(b,"pfGroupVoiceCall"),e.isPFAttachmentAllowed=!c,e.isPFPhotoAllowed=!l,e.isVoiceCallEnabled=!!fd(b,"voip"),e.isVideoCallEnabled=!!fd(b,"videoCall"),e.isGroupVoiceCallEnabled=!!fd(b,"groupAudioCall"),e.isGroupVideoCallEnabled=!!fd(b,"groupVideoCall");var w="UpM28mnfW65vJkbqEATtKvxm"===e.id;if(e.allowedSenders=n.organizations._getAllowedSenders(e),e.autoForwardReceiverId=y,e.autoForwardReceiver=y?n.models.User.get(y):null,e.canEscalateMessages=t&&d,e.desktopPriorityMessagingSounds=_&&a,e.displayName=w?"Contacts":m,e.isContacts=w,e.showPatientCare=r&&p,e.isPatientNetworkEnabled=o&&f,n.currentUser&&(n.currentUser.isPatient||n.currentUser.isPatientContact)&&o&&(e.isPatientNetworkEnabled="off"!==f),e.showTeams=i&&v,e.userRoles=n.userRoles.getByOrganizationId(g),e.networks||(e.networks={}),e.networks.provider||(e.networks.provider={unreadCount:0,unreadPriorityCount:0}),e.networks.patient||(e.networks.patient={dnd:!1,dndText:"",unreadCount:0,unreadPriorityCount:0}),e.networks.virtualWaitingRoom||(e.networks.virtualWaitingRoom={unreadCount:0,unreadPriorityCount:0}),e.network){var I=e.network.patient,O=I.dnd,T=I.dndText;e.networks.patient.dnd=O,e.networks.patient.dndText=null!==T?T:"",delete e.network}},methods:{getSettingValue:function(e){return fd(this.settings,e)},getSettingEntry:function(e){return this.settings&&e in this.settings?this.settings[e]:null}},relations:{hasMany:{__expirableMessages:{type:"message",foreignKey:"__organizationId",filter:function(e){return!!e.expiresAt},sortBy:[["expiresAt","asc"],["id","asc"]]},__expirableMutes:{type:"mute",foreignKey:"organizationId",filter:function(e){return!!e.expiresAt},sortBy:[["expiresAt","asc"],["id","asc"]]},__markingAsReadConversations:{type:"conversation",foreignKey:"organizationId",filter:function(e){return!!e._markingAsRead},sortBy:[["_markingAsReadExpiration","asc"],["id","asc"]]},conversations:{type:"conversation",foreignKey:"organizationId",filter:function(e){var t=e.counterParty;return!!t&&t.groupType!==Ao.ROLE_ASSIGNMENT},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"],["id","asc"]]},messageTemplates:{type:"messageTemplate",foreignKey:"organizationId",sortBy:[["title","asc"]]},roles:{type:"role",foreignKey:"organizationId"},roleTags:{type:"roleTag",foreignKey:"organizationId"}}}});return ol(r,{finder:function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=n.organizations).find.apply(e,t)},placeholderEntityDelayBeforeRefreshing:function(){return n.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return n.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Organization..."},defaultNotFoundAttrs:{displayName:"<Organization Not Found>"}}),r},yd=function(e,t){t.host;return e.defineModel("patient",{replaceKeys:{patientMrn:"mrn",patientGender:"gender",patientDob:"dob"},parseAttrs:function(e){return"featureService"in e&&delete e.featureService,"patientContacts"in e&&delete e.patientContacts,"isPatientContact"in e&&delete e.isPatientContact,"dob"in e&&(e.dob=bs(e.dob)),"phoneNumber"in e&&(e.phoneNumber=Vr(e.phoneNumber)),e},relations:{belongsTo:{user:{type:"user",foreignKey:"userId"}},hasMany:{contacts:{type:"patientContact",foreignKey:"patientId"},sharedConversations:{type:"conversation",foreignKey:"patientId",filter:function(e,t){var n=e.counterParty;if(!n)return!1;var r=n.groupType,o=n.hasCurrentUserOrRole,i=n.memberIds;return!(r!==Ao.PATIENT_MESSAGING||!o||!i.includes(t.userId))},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"],["id","asc"]]}}}})},gd=function(e,t){t.host;return e.defineModel("patientContact",{replaceKeys:{patientDob:"dob",patientGender:"gender",patientMrn:"mrn",relationName:"relation"},parseAttrs:function(e){return"entity"in e&&delete e.entity,"dob"in e&&(e.dob=bs(e.dob)),"phoneNumber"in e&&(e.phoneNumber=Vr(e.phoneNumber)),e},relations:{belongsTo:{patient:{type:"patient",foreignKey:"patientId"},user:{type:"user",foreignKey:"userId"}},hasMany:{sharedConversations:{type:"conversation",foreignKey:"patientContactId",filter:function(e,t){var n=e.counterParty;if(!n)return!1;var r=n.groupType,o=n.hasCurrentUserOrRole,i=n.memberIds;return!(r!==Ao.PATIENT_MESSAGING||!o||!i.includes(t.userId))},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"],["id","asc"]]}}}})},md=function(e,t){var n=t.host;return e.defineModel("product",{defaultValues:{activeProcessingEvents:null,conversationCount:0,organizations:null,rolesOptingIn:null,unreadCount:0,unreadPriorityCount:0,unreadVWRCount:0,unreadVWRPriorityCount:0},transientAttrs:["conversationCount","organizations","unreadCount","unreadPriorityCount"],afterAssignment:function(e){var t=e.id;e.productRoles=n.userRoles.getByProductId(t),null===e.activeProcessingEvents&&(e.activeProcessingEvents=[]),null===e.organizations&&(e.organizations=[]),null===e.rolesOptingIn&&(e.rolesOptingIn=[])}})};function _d(e,t){return!!e&&e.includes(t)}var bd=function(e,t){return e.defineModel("productRoles",{defaultValues:{roles:[]},afterAssignment:function(e){var t=e.roles;e.isAdmin=_d(t,"tt_admin"),e.isAnalyticsAdmin=_d(t,"tt_reporting"),e.isLdapAdmin=_d(t,"tt_ldap"),e.isSuperAdmin=_d(t,"tt_super_admin")},methods:{hasRole:function(e){return!!this.roles&&this.roles.includes(e)}},relations:{belongsTo:{product:{type:"product",foreignKey:"productId"},user:{type:"user",foreignKey:"userId"}}}})},wd=function(e,t){var n=t.host;return e.defineModel("role",{defaultValues:{description:"",memberIds:null,roleTagId:null},afterAssignment:function(e){n.users._setMembersOnEntity(e)},relations:{belongsTo:{assignmentGroup:{type:"group",foreignKey:"assignmentGroupId"},botUser:{type:"user",foreignKey:"botUserId"},escalationPolicy:{type:"escalationPolicy",foreignKey:"escalationPolicyId"},organization:{type:"organization",foreignKey:"organizationId"},roleTag:{type:"roleTag",foreignKey:"roleTagId"}}}})},Id=function(e,t){return e.defineModel("roleTag",{replaceKeys:{tagColor:"color",tagName:"name"},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}},hasMany:{roles:{type:"role",foreignKey:"roleTagId"}}},parseAttrs:function(e){if("colorValue"in e){var t=e.color,n=e.colorValue;e.color=n,e.colorId=t,delete e.colorValue}return"color"in e&&(e.color=e.color.replace("0x","#")),e},afterAssignment:function(e){var t=e.name;e.displayName=t,e.isDefault=t&&t.startsWith("Default")}})},Od=function(e,t){var n=t.host;return e.defineModel("scheduledMessage",{replaceKeys:{createdBy:"createdById",recipient:"recipientId",recipientType:"_recipientType",senderToken:"senderId",scheduleStatus:"status",updatedBy:"updatedById"},transientAttrs:["$deleted"],parseAttrs:function(e){return e.hasAttachment=!1,e.attachmentName&&e.attachmentSize&&e.attachmentType&&(e.hasAttachment=!0),e._recipientType&&(e.recipientType=n.modelsByEntityType[Ae.camelizeKey(e._recipientType)].name),e},afterAssignment:function(t){var n=t.recipient,r=t.recipientId,o=t.recipientType;n?(r=n.id,o=n.$entityType):n=o&&r?e.store.get(o,r):null,t.recipient=n,t.recipientId=r,t.recipientType=o},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},organization:{type:"organization",foreignKey:"organizationId"},sender:{type:"user",foreignKey:"senderId"},template:{type:"messageTemplate",foreignKey:"templateId"},updatedBy:{type:"user",foreignKey:"updatedById"}}}})},Td=function(e,t){var n=t.host,r=e.defineModel("team",{replaceKeys:{avatar:"avatarUrl",group_token:"groupToken",members:"__members",numMembers:"__memberCount",name:"displayName"},transientAttrs:["__memberCount","__members"],defaultValues:{canMembersLeave:!1,canRequestToJoin:!1,hasCurrentUserOrRole:!1,hasCurrentUserPending:!1,hasCurrentUserBeenDeclined:!1,memberIds:[]},skipCamelizationForKeys:["members"],parseAttrs:function(e){var t=e.__members;if(t){for(var r=[],o=0,i=t;o<i.length;o++){var s=i[o];if("object"==typeof s)if(s.token){r.push(s.token);var a=n.models.User.inject(s);n.models.User.removePlaceholder({entity:a,attrs:s})}else s.id&&r.push(s.id);else"string"==typeof s&&r.push(s)}e.memberIds=r,delete e.__members}return e},afterAssignment:function(e){var t=e.memberIds;n.groups._setMembership(e),n.users._setMembersOnEntity(e),n.teams._setHasUserPending(e),e.memberCount=t&&t.length||e.__memberCount||0},relations:{belongsTo:{group:{type:"group",foreignKey:"groupId"}}}});return ol(r,{finder:function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=n.teams).find.apply(e,t)},placeholderEntityDelayBeforeRefreshing:function(){return n.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return n.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<Team Not Found>"}}),r},Ed=function(e,t){t.host;return e.defineModel("teamRequest",{replaceKeys:{},transientAttrs:[],defaultValues:{},parseAttrs:function(e){return e.createdBy&&(e.createdById=e.createdBy.token,delete e.createdBy),e.team&&(e.teamId=e.team.id,delete e.team),e},afterAssignment:function(e){},relations:{belongsTo:{createdBy:{type:"user",foreignKey:"createdById"},team:{type:"team",foreignKey:"teamId"}}}})},Ad=function(e,t){return e.defineModel("userRoles",{defaultValues:{roles:[]},afterAssignment:function(e){var t="UpM28mnfW65vJkbqEATtKvxm"===e.organizationId,n=e.roles;e.isAdmin=n.includes("admin"),e.isHelpDesk=n.includes("help_desk"),e.isPatientAdmin=n.includes("patient_messaging_admin"),e.isRoleAdmin=n.includes("feature_role_admin"),e.isTeamAdmin=n.includes("team_admin"),e.isVirtualWaitingRoomAdmin=n.includes("virtual_waiting_room_admin"),e.reportingEnabled=n.includes("reporting")&&!t,e.reportingEnabledOnAllOrgs=n.includes("reporting_view_orgs")&&!t,e.tigerTouchPlusReportingEnabled=n.includes("tigertouchplus_reporting")},methods:{hasRole:function(e){return this.roles.includes(e)}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},user:{type:"user",foreignKey:"userId"}}}})},Cd=function(e,t){t.host;return e.defineModel("virtualWaitingRoom",{parseAttrs:function(e){return e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},Rd=function(e,t){t.host;return e.defineModel("VirtualWaitingRoomVisit",{parseAttrs:function(e){return e},relations:{belongsTo:{conversation:{type:"Conversation",foreignKey:"conversationId"},organization:{type:"organization",foreignKey:"organizationId"},virtualWaitingRoom:{type:"VirtualWaitingRoom",foreignKey:"roomId"}}}})},Pd=n(31),Sd=n.n(Pd),jd=n(32),Md=n.n(jd),zd=n(33),kd=n.n(zd),Nd=function(){return(Nd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},xd={computed:{},defaultValues:null,idAttribute:"id",methods:{},parseAttrs:_.a.identity,relations:{belongsTo:{},hasMany:{}}},Ud=Symbol("NOT_PROVIDED"),Ld=function(){function e(e,t,n){var r=this;void 0===n&&(n={}),this.get=function(e){return r.entitiesById[e]||r.entitiesByServerId[e]||null},this.options=_.a.defaultsDeep({},n,xd),this.idAttribute=this.options.idAttribute,this.name=t,this.store=e,this.entitiesById={},this.entitiesByServerId={},this.entitiesList=[],this.hasManySortFields=null,this.previousHasManySortValues={},this.previousServerIds={},this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),Object.assign(this.options.computed,{$entityType:{enumerable:!0,value:t,writable:!1},$entityClass:{enumerable:!1,value:this,writable:!1}}),this.options.computed=_.a.transform(this.options.computed,(function(e,t,n){e[n]="function"==typeof t?{get:t,enumerable:!1}:t}),{}),this._computedKeys=ra.a.call(Md.a.call(this.options.computed),"$entityType","$entityClass","$$transientAttrs"),this._writablePropertyKeys=Zs.a.call(Sd.a.call(kd.a.call(this.options.computed),(function(e){return e[1].set})),_.a.first),this._relationKeys=Xs.a.call(Zs.a.call(Ol.a.call(this.options.relations),_.a.keys))}return e.create=function(e,t,n){return new this(e,t,n)},e.prototype.__initRelations=function(){var e=this,t=this,n=_.a.transform(this.options.relations.belongsTo,(function(e,n,r){e[r]={get:function(){return t.store.get(n.type,this[n.foreignKey])},set:function(e){this[n.foreignKey]=t.store.resolveId(n.type,e)}}}),{});Object.assign(this.options.computed,n);var r=_.a.transform(this.options.relations.hasMany,(function(n,r,o){var i=r.filter,s=r.foreignKey,a=r.sortBy,u=r.type,c=e.__getSorted(a);n[o]={get:function(){if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={}),this.$$transientAttrs.relations[o])return this.$$transientAttrs.relations[o];var e=[],n=t.store.models[u];if(n.hasManySortFields)for(var r=0,a=n.getAll();r<a.length;r++){var l=a[r];if(l[s]===this[t.idAttribute]&&(!i||i(l,this))){var d=_.a.has(this.previousHasManySortValues,l[this.idAttribute])?this.previousHasManySortValues[l[this.idAttribute]]:Ud;n.previousHasManySortValues[l[n.idAttribute]]=_.a.pick(l,n.hasManySortFields),d===Ud?c.add(e,l):c.update(e,l,{previousValue:d})}}return this.$$transientAttrs.relations[o]=e,e},set:function(e){}}}),{});Object.assign(this.options.computed,r)},e.prototype.__getSorted=function(e){void 0===e&&(e=[[this.idAttribute,"asc"]]);var t=function(e){for(var t=0,n=[],r=0,o=e;r<o.length;r++){var i=o[r],s=i[0],a=i[1];if(n.push("const a"+t+" = a['"+s+"']"),n.push("const b"+t+" = b['"+s+"']"),"asc"===a)n.push("if (a"+t+" === undefined && b"+t+" !== undefined) return -1"),n.push("if (a"+t+" !== undefined && b"+t+" === undefined) return 1"),n.push("if (a"+t+" === null && b"+t+" !== null) return -1"),n.push("if (a"+t+" !== null && b"+t+" === null) return 1"),n.push("if (a"+t+" < b"+t+") return -1"),n.push("if (a"+t+" > b"+t+") return 1");else{if("desc"!==a)throw new Error("unsupported sort ordering for field "+s+": "+a);n.push("if (a"+t+" === undefined && b"+t+" !== undefined) return 1"),n.push("if (a"+t+" !== undefined && b"+t+" === undefined) return -1"),n.push("if (a"+t+" === null && b"+t+" !== null) return 1"),n.push("if (a"+t+" !== null && b"+t+" === null) return -1"),n.push("if (a"+t+" < b"+t+") return 1"),n.push("if (a"+t+" > b"+t+") return -1")}t++}return n.push("return 0"),new Function("a","b",n.join("\n"))}(e);return new ks(t)},e.prototype.__initTransientAttrs=function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach((function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=Rs(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}})),Object.assign(this.options.computed,n)},e.prototype.createInstance=function(e,t){void 0===t&&(t=!0),t&&(e=this.parseAttrs(e));var n=e[this.idAttribute];if(this.entitiesById[n]||this.entitiesByServerId[n])throw new Error("called createInstance on an existing instance");return this.__wireInstance(e)},e.prototype.__wireInstance=function(e){var t=this;this.options.defaultValues&&_.a.defaults(e,Rs(this.options.defaultValues));var n={};this._writablePropertyKeys.forEach((function(t){Cs(e,t)&&(n[t]=e[t],delete e[t])})),Object.defineProperties(e,this.options.computed),Object.assign(e,n),this.options.instanceEvents&&Object.assign(e,v.a.prototype),Object.assign(e,this.options.methods),Object.assign(e,{toPlainObject:function(e){var n=this,r={};t._computedKeys.forEach((function(e){return r[e]=n[e]}));var o=Object.assign({},this,r);return delete o.setMaxListeners,delete o.emit,delete o.addListener,delete o.on,delete o.once,delete o.removeListener,delete o.removeAllListeners,delete o.listeners,delete o.listenerCount,delete o.off,delete o.toPlainObject,delete o._events,delete o._maxListeners,o}});var r=e[this.idAttribute];return r&&!("serverId"in e)&&(e.serverId=r),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(e),e},e.prototype.inject=function(e){var t,n;if(this.is(e)&&(n=e,t=this.resolveId(n),this.entitiesById[t]))return this.__beforeInject(n),this.__register(t,n),this.options.afterAssignment&&this.options.afterAssignment(n),this.__addToHasManyRelationships(n),this.options.afterInject&&this.options.afterInject(n),this.emit("afterInject",this,n),n;if(!n&&(e=this.parseAttrs(e),t=this.resolveId(e),!this.isValidId(t)))throw new Error("'"+this.idAttribute+"' is required");var r=!1,o=this.entitiesById[t]||this.entitiesByServerId[t];return n?(o||(r=!0),this.__beforeInject(n)):o?(n=o,this.__beforeInject(e,n),Object.assign(n,e)):(r=!0,n=this.__wireInstance(e),this.__beforeInject(n)),this.__register(t,n),this.options.afterAssignment&&this.options.afterAssignment(n),this.__addToHasManyRelationships(n),this.options.afterInject&&this.options.afterInject(n),this.emit("afterInject",this,n),r&&(this.options.afterCreate&&this.options.afterCreate(n),this.emit("afterCreate",this,n)),n},e.prototype.__beforeInject=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[0],o=t[1];o&&!("serverId"in r)&&(r.serverId=o.serverId),this.options.beforeInject&&(e=this.options).beforeInject.apply(e,t),this.emit("beforeInject",this,r)},e.prototype.replaceExisting=function(e,t){var n=(void 0===t?{}:t).instance,r=this.options.idAttribute;if(this.is(e))throw new Error("cannot call replaceExisting() on an instance; should be plain object");if(n&&!this.is(n))throw new Error("provided 'instance' option is not an instance of this model");e=this.parseAttrs(e);var o=this.resolveId(e);if(!this.isValidId(o))throw new Error("'"+r+"' is required");var i,s=o;if(n){var a=this.resolveId(n);if(s!==a)this.entitiesById[s]?(this.eject(n),n=null):s=a}if(n||(n=this.entitiesById[s]||this.entitiesByServerId[s])&&(s=n[r]),n){var u={};for(var c in e)u[c]=!0;this.__beforeInject(e,n);for(var l=0,d=Object.getOwnPropertyNames(n);l<d.length;l++){var h=d[l];!u[h]&&Cs(n,h)&&delete n[h]}Object.assign(n,e),n[r]=s,n.serverId=o,this.__wireInstance(n)}else i=!0,n=this.__wireInstance(e),this.__beforeInject(n);return this.__register(s,n),this.options.afterAssignment&&this.options.afterAssignment(n),this.__addToHasManyRelationships(n),this.options.afterInject&&this.options.afterInject(n),this.emit("afterInject",this,n),i&&(this.options.afterCreate&&this.options.afterCreate(n),this.emit("afterCreate",this,n)),n},e.prototype.eject=function(e){e=this.resolveId(e);var t=this.entitiesById[e]||this.entitiesByServerId[e];t&&(this.emit("beforeEject",this,t),this.__removeFromHasManyRelationships(t),this.__unregister(e,t),this.emit("afterEject",this,t))},e.prototype.__register=function(e,t){this.entitiesById[e]!==t&&(this.entitiesById[e]=t,this.entitiesList.push(t));var n=this.previousServerIds[e],r=t.serverId;n&&n!==r&&(delete this.entitiesByServerId[n],r===e?delete this.previousServerIds[e]:(this.entitiesByServerId[r]=t,this.previousServerIds[e]=r)),n||r===e||(this.entitiesByServerId[r]=t,this.previousServerIds[e]=r)},e.prototype.__unregister=function(e,t){delete this.entitiesById[e],_.a.pull(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e];var n=this.previousServerIds[e];n&&(delete this.entitiesByServerId[n],delete this.previousServerIds[e])},e.prototype.injectPlaceholder=function(e){var t=e.token||e[this.idAttribute];if(this.get(t))return this.inject(e);var n=this.createInstance(e);return Object.defineProperty(n,"$placeholder",{value:!0,configurable:!0}),this.inject(n)},e.prototype.removePlaceholder=function(e){var t=e.entity,n=e.attrs;t&&t.$placeholder&&(n?(delete t.$placeholder,delete t.$notFound,this.inject(t)):(Object.defineProperty(t,"$notFound",{value:!0,configurable:!0}),this.inject(t)))},e.prototype.touch=function(e){var t;e=this.resolveId(e),(this.entitiesById[e]||this.entitiesByServerId[e])&&this.inject(((t={})[this.idAttribute]=e,t))},e.prototype.__addToHasManyRelationships=function(e){this.__updateRelationsIfNeeded(e,"add")},e.prototype.__removeFromHasManyRelationships=function(e){this.__updateRelationsIfNeeded(e,"remove")},e.prototype.__updateRelationsIfNeeded=function(e,t){var n=this,r=this.store.getParentRelationshipsOfModel(this.name);if(r){this.hasManySortFields||(this.hasManySortFields=ta.a.call(Xs.a.call(r.map((function(e){var t=e.sortBy;return t&&t.map((function(e){return e[0]}))})).filter(Boolean)).concat([this.idAttribute])));var o=_.a.has(this.previousHasManySortValues,e[this.idAttribute])?this.previousHasManySortValues[e[this.idAttribute]]:Ud;this.previousHasManySortValues[e[this.idAttribute]]=_.a.pick(e,this.hasManySortFields),r.forEach((function(r){var i=r.filter,s=r.foreignKey,a=r.relationKey,u=r.sortBy,c=r.sorted,l=n.store.get(r.parent,e[s]);if(l&&l.$$transientAttrs.relations&&l.$$transientAttrs.relations[a]){var d=!1;if("remove"===t||i&&!i(e,l))if(u)d=o===Ud?c.remove(l[a],e):c.remove(l[a],e,{previousValue:o});else{var h=l[a].indexOf(e);-1!==h&&(l[a].splice(h,1),d=!0)}else"add"===t&&(u?d=o===Ud?c.update(l[a],e):c.update(l[a],e,{previousValue:o}):l[a].includes(e)||(l[a].push(e),d=!0));l.$$transientAttrs.$$wasUpdatedByRelation||(l.$$transientAttrs.$$wasUpdatedByRelation=d)}}))}},e.prototype.ejectAll=function(){for(;this.entitiesList.length>0;)this.eject(this.entitiesList[0])},e.prototype.parseAttrs=function(e){var t=this,n=_.a.pickBy(e,(function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)})),r=_.a.pick(e,this.options.transientAttrs),o=_.a.omit(e,Object.keys(n),this.options.transientAttrs),i=this.options.parseAttrs(Rs(o));return Nd(Nd(Nd({},i),n),r)},e.prototype.getAll=function(){return this.entitiesList},e.prototype.getMulti=function(e){return e.map(this.get)},e.prototype.resolveId=function(e){return this.isValidId(e)?e:e[this.idAttribute]},e.prototype.isValidId=function(e){return"string"==typeof e||"number"==typeof e},e.prototype.is=function(e){return e&&e.$entityClass===this},e}();Object.assign(Ld.prototype,v.a.prototype);var qd=function(){function e(e){var t=this;void 0===e&&(e={}),this.options=e,this.models={},this.__relationsOfHasManyByContainedItem={};["filter","get","getAll","inject","injectPlaceholder","is","resolveId"].forEach((function(e){t[e]=function(n){for(var r,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return(r=t.models[n])[e].apply(r,o)}}))}return e.prototype.defineModel=function(e,t){var n=this;if(void 0===t&&(t={}),this.models[e])throw new Error(e+" already defined");t=Nd(Nd({},this.options),t),this.models[e]=Ld.create(this,e,t);var r=this.models[e].options.relations.hasMany;return _.a.isEmpty(r)||_.a.each(r,(function(t,r){var o=t.sortBy,i=t.type,s=n.models[e].__getSorted(o);n.__relationsOfHasManyByContainedItem[i]||(n.__relationsOfHasManyByContainedItem[i]=[]),n.__relationsOfHasManyByContainedItem[i].push(Nd(Nd({},t),{relationKey:r,sorted:s,parent:e}))})),this.models[e]},e.prototype.getParentRelationshipsOfModel=function(e){return this.__relationsOfHasManyByContainedItem[e]},e.prototype.isEntity=function(e){return e&&e.$entityClass&&e.$entityClass.constructor===Ld},e.prototype.isEntityArray=function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)},e.prototype.clear=function(){_.a.values(this.models).forEach((function(e){return e.ejectAll()}))},e}(),Dd=function(){return(Dd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Bd=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},Fd=function(){function e(e,t){void 0===t&&(t={});var n=t.logger,r=Bd(t,["logger"]);this.host=e,this.options=r,this.logger=n,this.store=new qd(Dd(Dd({},r),{host:e,logger:n})),this.store.host=e}return e.prototype.defineModels=function(){var e=this,t={},n=Dd(Dd({},this.options),{host:this.host,logger:this.logger});_.a.each(h,(function(r,o){t[o]=r(e,n)})),this.models=t},e.prototype.defineModel=function(e,t){return void 0===t&&(t={}),_.a.defaults(t,{replaceKeys:{},skipCamelizationForKeys:null}),_.a.defaults(t.replaceKeys,{token:"id"}),this.store.defineModel(e,Dd(Dd({},t),{afterInject:function(e){var n=Date.now();e.$lastModified===n&&(n+=1e-5),e.$lastModified=n,t.afterInject&&t.afterInject(e)},parseAttrs:function(e){var n;if(_.a.isEmpty(t.skipCamelizationForKeys))n=Ae.camelizeObject(e);else{var r=_.a.omit(e,t.skipCamelizationForKeys),o=_.a.pick(e,t.skipCamelizationForKeys);n=Dd(Dd({},Ae.camelizeObject(r)),o)}return function(e,t){for(var n=0,r=Object.entries(t);n<r.length;n++){var o=r[n],i=o[0],s=o[1];!(s in e)&&i in e&&(e[s]=e[i],delete e[i])}}(n,t.replaceKeys),t.parseAttrs&&(n=t.parseAttrs(n,e)),n}}))},e.prototype.clear=function(){this.store.clear()},e}(),Gd=n(34).version,Vd=Gd=Gd.replace("-dev",""),Kd=function(){return(Kd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Hd=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))},$d=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Wd=function(){function e(e){var t=this;void 0===e&&(e={}),this.errors=r,this.VERSION=Vd,this.version=Vd,this._onBrowserUnload=function(){var e=[];t.emit("browserUnload",(function(t,n,r){return e.push({fn:t,priority:n,name:r})})),_.a.orderBy(e,["priority"],["desc"]).forEach((function(e){var t=e.fn,n=e.priority,r=e.name;console.log("[unload]",n,r),t()}))},this._onDisconnected=function(e){var n=e.isRecoverable;n||t._removeAuth(),t.emit("events:disconnected",{isRecoverable:n})},this._onTick=function(){t.__tickerFrame=w()((function(){try{t.emit("tick")}finally{t.__ticker=setTimeout(t._onTick,5e3)}}))},this._resetLastBang=function(){t._bangOccurredDuringReplay=!0},this._startBangTimer=function(){t._bangOccurredDuringReplay=!1,t._checkBangTimer=setTimeout(t._didBangOccur,t.config.detectBangReplayTimeout)},this._didBangOccur=function(){t._bangOccurredDuringReplay?t._startBangTimer():(t._checkBangTimer=null,t._bangReplayDone())},this._bangReplayDone=function(){t.currentlyServingOfflineMessages&&(t.currentlyServingOfflineMessages=!1,t.emit("conversations:loading:start"),t.conversations.hasPendingReloads()&&t.conversations.__flushConversationsToReload(),t.emit("groups:offline:stop"),t.emit("messages:offline:stop"),t.emit("conversations:loading:stop"),t.emit("messages:new:start"))},this.config=Object.assign({},e),_.a.defaultsDeep(this.config,co.CONFIG_DEFAULT);var n=this.config,h=n.apiEnv,p=n.logLevel;this.config.cloudfront=co.CLOUDFRONT[h],/(env\d+|lt\d*)/.test(h)&&(this.config.cloudfront=co.CLOUDFRONT.development,co.BASE_URLS[this.config.apiEnv]="https://"+h+"-devapi.tigertext.xyz",co.FORGOT_PASSWORD_URLS[this.config.apiEnv]="https://"+h+"-forget.tigertext.com",co.CN_URLS[this.config.apiEnv]="https://"+h+"-console.tigertext.xyz",co.ADMIN_URLS[this.config.apiEnv]=co.CN_URLS[h]+"/app/admin",co.ROLES_URLS[this.config.apiEnv]="/"+h+"/app/roles/index.html"),this.config.baseUrl||(this.config.baseUrl=co.BASE_URLS[h]),this.config.autoSignOutOnBrowserUnload=!1,Object.assign(this,{attachments:u,date:c,email:o,file:l,phone:i}),this.httpClient=new gs({config:this.config,logger:new po({name:"HttpClient",level:p})}),this.eventSourceClient=new Mi({config:this.config,httpClient:this.httpClient,logger:new po({name:"EventSourceClient",level:p})}),this.enums=Kd(Kd({},a),{NetworkStatus:Si}),this.store=new Fd(this,{logger:new po({name:"Store",level:p})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=_.a.mapKeys(this.store.models,(function(e,t){return Ae.camelizeKey(t)})),this.modelsByEntityType.account=this.modelsByEntityType.user,this.modelsByEntityType.list=this.modelsByEntityType.distributionList,this.allModelEntityTypes=Object.keys(this.modelsByEntityType),this.logger=new po({name:"TigerConnectClient",level:p}),this.api={};for(var f=0,v=Object.entries(s);f<v.length;f++){var y=v[f],g=y[0],m=y[1],b=Ae.camelizeKey(g);this.api[b]=new m(this,{logger:new po({name:g+"API",level:p})})}this._services=[];for(var I=0,O=Object.entries(d);I<O.length;I++){var T=O[I],E=T[0],A=(m=T[1],b=Ae.camelizeKey(E),new m(this,{logger:new po({name:E+"Service",level:this.config.serviceLogLevels[b]||p})}));this[b]=A,this._services.push(A)}for(var C=0,R=this._services;C<R.length;C++){(A=R[C]).mounted&&A.mounted()}this._listenToEvents(),this._startTicker(),this.on("browserUnload",(function(e){return e((function(){t.config.autoSignOutOnBrowserUnload&&(t.notifications.disconnect({source:"On browser unload"}),t.signOut({async:!1,resetClient:!1}))}),100,"signOut")})),this._checkBangTimer=null,this.conversationsLoaded=!1,this.currentlyServingOfflineMessages=!1}return e.prototype._listenToEvents=function(){var e=this;this.on("signedIn",(function(t,n){e.logger.info("signedIn",t.id)})),this.on("signedOut",(function(t){t.resetClient&&e.reset()})),this.on("signUp",(function(t){var n=t.user,r=t.auth;e.logger.info("signUp",n.id),e._setCurrentUser(n),e._setAuth(r)})),this.events.on("event",(function(t){e.emit("event",t),"bang"===t.type&&e._resetLastBang()})),this.events.on("batch:available",(function(t){return e.emit("events:batch:available",t)})),this.events.on("connected",(function(){return e.emit("events:connected")})),this.events.on("disconnected",this._onDisconnected),this.events.on("processing:start",(function(t){return e.emit("processing:start",t)})),this.events.on("processing:stop",(function(t){return e.emit("processing:stop",t)})),this.events.on("visibilityChange",(function(t,n){return e.emit("visibilityChange",t,n)})),this.calls.on("answered",(function(t){return e.emit("call:answered",t)})),this.calls.on("ended",(function(t){return e.emit("call:ended",t)})),this.calls.on("incoming",(function(t){return e.emit("call:incoming",t)})),this.calls.on("state",(function(t){return e.emit("call:state",t)})),this.conversations.on("clearTimeline",(function(t){return e.emit("conversation:clearTimeline",t)})),this.conversations.on("clearMessageStatuses",(function(t){return e.emit("conversation:clearMessageStatuses",t)})),this.conversations.on("message",(function(t){return e.emit("message",t)})),this.conversations.on("friends",(function(t){return e.emit("friends",t)})),this.eventSourceClient.on("auth:invalid",(function(){return e.emit("auth:invalid")})),this.groups.on("membership:change",(function(t){return e.emit("group:membership:change",t)})),this.httpClient.on("networkStatus:change",(function(t){return e.emit("networkStatus:change",t)})),this.notifications.on("connected",(function(){return e.emit("notifications:connected")})),this.notifications.on("disconnected",(function(t){return e.emit("notifications:disconnected")})),this.notifications.on("signingIn",(function(){return e.emit("notifications:signingIn")})),this.notifications.on("signedIn",(function(t){return e.emit("notifications:signedIn",t)})),this.notifications.on("signingOut",(function(t){return e.emit("notifications:signingOut",t)})),this.notifications.on("signedOut",(function(t){return e.emit("notifications:signedOut",t)})),this.notifications.on("event",(function(t){return e.emit("notifications:event",t)})),this.notifications.on("message",(function(t){return e.emit("notification:message",t)})),this.notifications.on("unread:change",(function(t){return e.emit("notification:unread:change",t)})),this.organizations.on("preferences:change",(function(t){return e.emit("organization:preferences:change",t)})),this.presence.on("change",(function(t){return e.emit("presence:change",t)})),this.roles.on("change",(function(t){return e.emit("role:change",t)})),this.typingStatus.on("change",(function(t){return e.emit("typing:change",t)})),this.users.on("preferences:change",(function(t){return e.emit("user:preferences:change",t)})),"undefined"!=typeof window&&window.addEventListener("unload",this._onBrowserUnload)},e.prototype._startTicker=function(){this.__ticker=setTimeout(this._onTick,5e3),this.__tickerFrame=null},e.prototype._stopTicker=function(){null!==this.__ticker&&(clearTimeout(this.__ticker),this.__ticker=null),null!==this.__tickerFrame&&(w.a.cancel(this.__tickerFrame),this.__tickerFrame=null)},e.prototype.signIn=function(e,t,n){return void 0===n&&(n={}),Hd(this,void 0,void 0,(function(){var r,o,i,s,a,u,c;return $d(this,(function(l){switch(l.label){case 0:return r=n.udid,o=void 0===r?O()():r,i=n.refreshUser,s=void 0===i||i,this.emit("signingIn"),[4,this.users.signIn(e,t,{udid:o})];case 1:return a=l.sent(),u=a.auth,c=a.user,this._setCurrentUser(c),this._setAuth(u),s?[4,this.users.findMe({bypassCache:!0})]:[3,3];case 2:l.sent(),l.label=3;case 3:return this.emit("signedIn",c,u),[2,{auth:u,user:c}]}}))}))},e.prototype.signInWithApiKeyAndSecret=function(e,t,n){return void 0===n&&(n={}),Hd(this,void 0,void 0,(function(){var r,o,i,s,a,u,c;return $d(this,(function(l){switch(l.label){case 0:return r=n.udid,o=void 0===r?O()():r,i=n.refreshUser,s=void 0===i||i,this.emit("signingIn"),[4,this.users.signInWithApiKeyAndSecret(e,t,{udid:o})];case 1:return a=l.sent(),u=a.auth,c=a.user,this._setCurrentUser(c),this._setAuth(u),s?[4,this.users.findMe({bypassCache:!0})]:[3,3];case 2:l.sent(),l.label=3;case 3:return this.emit("signedIn",c,u),[2,{auth:u,user:c}]}}))}))},e.prototype.signInWithMagicToken=function(e,t){return void 0===t&&(t={}),Hd(this,void 0,void 0,(function(){var n,r,o,i,s,a,u;return $d(this,(function(c){switch(c.label){case 0:return n=t.udid,r=void 0===n?O()():n,o=t.refreshUser,i=void 0===o||o,this.emit("signingIn"),[4,this.users.signInWithMagicToken(e,{udid:r})];case 1:return s=c.sent(),a=s.auth,u=s.user,this._setCurrentUser(u),this._setAuth(a),i?[4,this.users.findMe({bypassCache:!0})]:[3,3];case 2:c.sent(),c.label=3;case 3:return this.emit("signedIn",u,a),[2,{auth:a,user:u}]}}))}))},e.prototype.signOut=function(e){var t=void 0===e?{}:e,n=t.async,r=void 0===n||n,o=t.fromServer,i=void 0!==o&&o,s=t.resetClient,a=void 0===s||s;if(!this.isSignedIn)return Promise.resolve(!1);if(!r&&"undefined"==typeof XMLHttpRequest)throw new Error("`async: false` option cannot be set unless using signOut() in a browser");if(this.events.disconnect({source:"On sign out"}),r)return this.users.signOut({fromServer:i,resetClient:a});this.emit("signingOut",{fromServer:i,resetClient:a});var u=new XMLHttpRequest;u.open("POST",this.config.baseUrl+"/v2/logout",!1);for(var c=0,l=Object.entries(this.httpClient.getAuthHeaders());c<l.length;c++){var d=l[c],h=d[0],p=d[1];u.setRequestHeader(h,p)}return u.send(null),this.emit("signedOut",{fromServer:i,resetClient:a,signedOut:!0}),Promise.resolve(!0)},e.prototype.signOutAllDevices=function(e){var t=(void 0===e?{}:e).async,n=void 0===t||t;if(!this.isSignedIn)return Promise.resolve();if(!n&&"undefined"==typeof XMLHttpRequest)throw new Error("`async: false` option cannot be set unless using signOutAllDevices() in a browser");if(n)return this.users.signOutAllDevices();var r=new XMLHttpRequest;r.open("POST",this.config.baseUrl+"/v2/wipe?token="+this.currentUserId,!1);for(var o=0,i=Object.entries(this.httpClient.getAuthHeaders());o<i.length;o++){var s=i[o],a=s[0],u=s[1];r.setRequestHeader(a,u)}return r.send(null),Promise.resolve()},e.prototype.authenticate=function(e,t){return Hd(this,void 0,void 0,(function(){return $d(this,(function(n){switch(n.label){case 0:return[4,this._authenticateWithParams({key:e,secret:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.authenticateUsingOauth=function(e,t){return void 0===t&&(t={udid:void 0}),Hd(this,void 0,void 0,(function(){var n,r;return $d(this,(function(o){switch(o.label){case 0:return n=t.udid,r=void 0===n?O()():n,[4,this._authenticateWithParams({bearerToken:e,udid:r})];case 1:return[2,o.sent()]}}))}))},e.prototype._authenticateWithParams=function(e){return Hd(this,void 0,void 0,(function(){var t,n;return $d(this,(function(r){switch(r.label){case 0:this._setAuth(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.users.findMe()];case 2:return t=r.sent(),this._setCurrentUser(t),this.emit("signedIn",t,e),[2,t];case 3:throw n=r.sent(),this._removeAuth(),this._currentUser=null,n;case 4:return[2]}}))}))},e.prototype._setCurrentUser=function(e){this._currentUser=e},e.prototype._setAuth=function(e){this._auth=e,this.httpClient.setAuth(e),this.events.setAuth(e)},e.prototype._removeAuth=function(){this._auth=null,this.httpClient.removeAuth(),this.events.removeAuth()},e.prototype.getCurrentUser=function(){return this._currentUser||null},Object.defineProperty(e.prototype,"currentUser",{get:function(){return this.getCurrentUser()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUserId",{get:function(){var e=this.getCurrentUser();return e?e.id:null},enumerable:!1,configurable:!0}),e.prototype.getAuth=function(){return this._auth},Object.defineProperty(e.prototype,"isSignedIn",{get:function(){return!!this.getAuth()},enumerable:!1,configurable:!0}),e.prototype.requireUser=function(){if(!this.isSignedIn)throw new P},e.prototype.reactToAdvisoryEvent=function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.currentlyServingOfflineMessages=!0,this.emit("messages:offline:start",t),this.products._addProcessingEvent({actionType:qo.MESSAGE_REPLAY,entity:this.products.getAll()[0],itemsEstimate:t.replayMessageCount});break;case"replayStop":null===this._checkBangTimer&&(this.emit("groups:offline:start"),this._startBangTimer()),this.products._removeProcessingEvent({actionType:qo.MESSAGE_REPLAY,entity:this.products.getAll()[0]})}},Object.defineProperty(e.prototype,"MODEL_BY_TYPE_NS",{get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:distribution_list":this.models.DistributionList,"tigertext:entity:dist_list_member":this.models.User,"tigertext:entity:list":this.models.DistributionList,"tigertext:entity:message_template":this.models.MessageTemplate,"tigertext:entity:patient_distribution_list":this.models.DistributionList,"tigertext:entity:schedule_message":this.models.ScheduledMessage,"tigertext:entity:tag":this.models.RoleTag,"tigertext:entity:team":this.models.Team,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS},enumerable:!1,configurable:!0}),e.prototype.modelByTypeNS=function(e){return this.MODEL_BY_TYPE_NS[e]},e.prototype.modelNameByTypeNS=function(e){var t=this.MODEL_BY_TYPE_NS[e];return t?t.name:(g()(t,"modelNameByTypeNS: Missing class for "+e),null)},e.prototype.modelNameByEntityType=function(e){var t=this.modelsByEntityType[e]||this.MODEL_BY_TYPE_NS[e];if(t)return t.name;g()(t,"modelNameByEntityType: Missing class for "+e)},e.prototype.ejectModel=function(e,t){void 0===t&&(t=e.xmlns||e.type);var n=this.MODEL_BY_TYPE_NS[t]||this.modelsByEntityType[t];if(n)return n.eject(e);g()(n,"ejectModel: Missing class for "+t)},e.prototype.injectModel=function(e,t){void 0===t&&(t=e.xmlns||e.type);var n=this.MODEL_BY_TYPE_NS[t]||this.modelsByEntityType[t];return n?n.inject(e):(g()(n,"injectModel: Missing class for "+t),null)},e.prototype.injectPlaceholderModel=function(e,t){void 0===t&&(t=e.xmlns||e.type);var n=this.modelByTypeNS(t)||this.modelsByEntityType[t];return n?n.injectPlaceholder(e):(g()(n,"injectPlaceholderModel: Missing class for "+t),null)},e.prototype.getEntity=function(e,t){return this.modelsByEntityType[e].get(t)},e.prototype.getEntities=function(e){var t=this;return e.map((function(e){return t.getEntity(e.type,e.id)}))},e.prototype.dispose=function(){this._stopTicker(),this.conversationsLoaded=!1,null!==this._checkBangTimer&&(clearTimeout(this._checkBangTimer),this._checkBangTimer=null);for(var e=0,t=this._services;e<t.length;e++){var n=t[e];n.dispose&&n.dispose()}this.store&&this.store.clear()},e.prototype.reset=function(){this.dispose();for(var e=0,t=this._services;e<t.length;e++){var n=t[e];n.mounted&&n.mounted()}this._startTicker()},e.prototype.configure=function(e){return Object.assign(this.config,e),this.httpClient.mounted(),this},e.prototype.setDefaultOrganization=function(e){return this.configure({defaultOrganizationId:e})},Object.defineProperty(e.prototype,"networkStatus",{get:function(){return this.httpClient.networkStatus},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forgotPasswordUrl",{get:function(){return co.FORGOT_PASSWORD_URLS[this.config.apiEnv]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adminUrl",{get:function(){return this.config.adminFeatureBranch?"/feature/"+this.config.adminFeatureBranch+"/app/admin":this.config.localAdminUrl?this.config.localAdminUrl:co.ADMIN_URLS[this.config.apiEnv]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cnUrl",{get:function(){return this.config.localCnUrl?this.config.localCnUrl:co.CN_URLS[this.config.apiEnv]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rolesUrl",{get:function(){return this.config.rolesFeatureBranch?"/feature/"+this.config.rolesFeatureBranch+"/app/roles/index.html":this.config.localRolesUrl?this.config.localRolesUrl:co.ROLES_URLS[this.config.apiEnv]},enumerable:!1,configurable:!0}),e.CONSUMER_ORGANIZATION_ID=co.CONSUMER_ORGANIZATION_ID,e.errors=r,e.VERSION=Vd,e.version=Vd,e}();Object.assign(Wd.prototype,v.a.prototype)}]);
//# sourceMappingURL=tigerconnect-sdk-node.min.js.map