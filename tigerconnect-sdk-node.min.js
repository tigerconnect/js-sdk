module.exports=function(n){function r(e){if(a[e])return a[e].exports;var t=a[e]={exports:{},id:e,loaded:!1};return n[e].call(t.exports,t,t.exports,r),t.loaded=!0,t.exports}var a={};return r.m=n,r.c=a,r.p="",r(0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),global._babelPolyfill||!1===global._tcShouldPolyfill||n(194);n(193)("./node");var r=n(93),a=t.Client=r;a.Client=a,t.default=a,e.exports=a},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/typeof")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-descriptor")},function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")},function(e,t){e.exports=require("babel-runtime/core-js/symbol/iterator")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(3)),s=r(n(7)),d=r(n(12)),f=r(n(13)),p=r(n(8)),a=r(n(28)),o=r(n(1)),u=r(n(2)),y=r(n(34)),h=n(22),g=((0,u.default)(v,[{key:"_resolveModelIdWithTypes",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+l(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+l(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+c(e));if(!("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "allowedEntityTypes" violates contract.\n\nExpected:\nstring | string[]\n\nGot:\n'+c(t));if(!e)return null;if("string"==typeof e){var n=this._resolveEntity(e);if(!n)return e;e=n}return h.Validator.oneOf("thing",e.$entityType,(0,h.arrayWrap)(t)),e.serverId||e.id||null}},{key:"_resolveEntity",value:function(e,t){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+l(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+l(t));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+c(e));if(!(null==t||"string"==typeof t||null==t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})))throw new TypeError('Value of argument "types" violates contract.\n\nExpected:\n?string | ?string[]\n\nGot:\n'+c(t));if(t=t?(0,h.arrayWrap)(t):this.host.allModelEntityTypes,"object"===(void 0===e?"undefined":(0,p.default)(e))&&(e.$entityType&&(h.Validator.oneOf("thing",e.$entityType,t),t=[e.$entityType]),e=e.id),!t||"function"!=typeof t[f.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+c(t));if(!t||"function"!=typeof t[f.default]&&!Array.isArray(t))throw new TypeError("Expected types to be iterable, got "+l(t));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,d.default)(t);!(n=(o=i.next()).done);n=!0){var s=o.value,u=this.host.modelsByEntityType[s].get(e);if(u)return u}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return null}},{key:"mounted",value:function(){}},{key:"dispose",value:function(){}}]),v);function v(e,t){(0,o.default)(this,v),this._resolveModelId=function(e){if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+l(e));if(!(null==e||"string"==typeof e||null==e||e instanceof Object))throw new TypeError('Value of argument "thing" violates contract.\n\nExpected:\n?string | ?Object\n\nGot:\n'+c(e));return"string"==typeof e?e:e&&(e.serverId||e.id)||null},(0,a.default)(this,t),this.host=e,this.config=e.config,this.httpClient=e.httpClient}t.default=g,(0,a.default)(g.prototype,y.default.prototype),e.exports=t.default},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.VERSIONS=t.ROUTES=void 0;var u=r(n(10)),a=r(n(9)),o=r(n(28)),i=r(n(1)),s=r(n(2));t.recoverFromNotFound=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fallbackValue,i=void 0===t?null:t,n=e.httpStatusCodes,s=void 0===n?d:n;return function(e,t,n){var r,o=n.value;return n.value=(r=(0,a.default)(u.default.mark(function e(){var t,n,r,a=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,t=a.length,n=Array(t),r=0;r<t;r++)n[r]=a[r];return e.next=4,o.call.apply(o,[this].concat(n));case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(0),e.t0.response&&s.includes(e.t0.response.status))return e.abrupt("return",i);e.next=13;break;case 13:if(e.t0.code===l.PermissionDeniedError.CODE&&s.includes(403))return e.abrupt("return",i);e.next=17;break;case 17:if(e.t0.code===l.WrongCredentialsError.CODE&&s.includes(401))return e.abrupt("return",i);e.next=21;break;case 21:throw e.t0;case 22:case"end":return e.stop()}},e,this,[[0,7]])})),function(){return r.apply(this,arguments)}),n}};var c=r(n(34)),l=n(17),d=[403,404],f=(t.ROUTES={CONVERSATION_FIND_ALL:"conversations.findAll",DISTRIBUTION_LIST_FIND:"distributionLists.find",ENTITIES_FIND_ALL:"entities.findAll",ESCALATION:"escalation",GROUP_ADD_MEMBERS:"group.addMembers",GROUP_CREATE:"group.create",GROUP_FIND:"group.find",GROUP_UPDATE:"group.update",MESSAGE_FIND:"messages.find",MESSAGE_FORWARD:"message.forward",MESSAGE_SEND:"message.send",MESSAGE_UPDATE_RECIPIENT_STATUS_MULTI:"messages.updateRecipientStatusMulti",MUTE_FIND_ALL:"mute.findAll",ORGANIZATION_FIND:"organization.find",ORGANIZATION_FIND_ALL_OF_USER:"organization.findAllOfUser",ROLES_CREATE_P2P_GROUP:"roles.createP2PGroup",SEARCH_QUERY:"search.query",USER_FIND:"user.find",USER_FIND_ME:"user.findMe"},t.VERSIONS={VERSION_TWO:"v2",VERSION_FIVE:"v5"}),p=((0,s.default)(y,[{key:"getVersion",value:function(e){var t=f.VERSION_TWO,n=f.VERSION_FIVE;return{version:this.config.condensedReplays?n:t}}}]),y);function y(e,t){(0,i.default)(this,y),(0,o.default)(this,t),this.config=e.config,this.host=e,this.httpClient=e.httpClient}t.default=p,(0,o.default)(p.prototype,c.default.prototype)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(122)),o=r(n(123)),i=r(n(124)),s=r(n(125)),u=r(n(126)),c=r(n(127)),l=r(n(128)),d=r(n(68)),f=r(n(129));t.default={ConnectionUnavailableError:a.default,NotFoundError:o.default,NotSignedInError:i.default,NotSupportedError:s.default,PermissionDeniedError:u.default,RequiresBasicAuthError:c.default,TargetNotSupportedError:l.default,ValidationError:d.default,WrongCredentialsError:f.default},e.exports=t.default},function(e,t){e.exports=require("reuse-promise")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerValueEnum=t.default=void 0;var a,o=r(n(4)),i=r(n(6)),s=r(n(5)),u=r(n(196)),c=r(n(15)),l=r(n(1)),d=r(n(2)),f=r(n(225)),p=r(n(57)),y=((0,d.default)(h,[{key:"resolve",value:function(e){return e||this.defaultValue}},{key:"isValid",value:function(e){return!!this.entriesByKey[e]}}]),h);function h(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var n in(0,l.default)(this,h),Array.isArray(e)&&(e=e.reduce(function(e,t){return e[t]={},e},{})),this.keys=[],this.entries=[],this.entriesByKey={},this.defaultValue=t.defaultValue||null,e){this[n]=n;var r=(0,c.default)({key:n},e[n]);this.entriesByKey[n]=r,this.entries.push(r),this.keys.push(n)}(0,u.default)(this.keys),(0,u.default)(this.entries),(0,u.default)(this.entriesByKey)}function g(){return(0,l.default)(this,g),(0,i.default)(this,(g.__proto__||(0,o.default)(g)).apply(this,arguments))}t.default=y,t.ServerValueEnum=(a=y,(0,s.default)(g,a),(0,d.default)(g,[{key:"mapEnumKeyToServerValue",value:function(){return this._mapEnumKeyToServerValue||(this._mapEnumKeyToServerValue=(0,p.default)(this.entries,function(e,t){return e[t.key]=t.serverValue},{}))}},{key:"mapServerValueToEnumKey",value:function(){return this._mapServerValueToEnumKey||(this._mapServerValueToEnumKey=(0,f.default)(this.mapEnumKeyToServerValue()))}},{key:"fromServer",value:function(e){return this.mapServerValueToEnumKey()[e]}},{key:"toServer",value:function(e){return this.mapEnumKeyToServerValue()[this.resolve(e)]}},{key:"resolve",value:function(e){return(this.isValid(e)?e:this.fromServer(e))||this.defaultValue}}]),g)},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return Array.isArray(e)?e:null!=e?[e]:[]}Object.defineProperty(t,"__esModule",{value:!0}),t.Validator=t.urlEncodedTaggedString=t.SortedArray=t.replaceKeys=t.replaceKey=t.phone=t.mimeTypes=t.jsonCloneDeep=t.isConfigurableProperty=t.generateComparator=t.email=t.attachments=t.Camelizer=void 0,t.arrayWrapBound=function(){return o(this)},t.arrayWrap=o;var i=a(n(50)),s=r(n(79)),u=r(n(30)),c=a(n(186)),l=a(n(80)),d=a(n(81)),f=r(n(51)),p=r(n(27)),y=a(n(187)),h=a(n(188)),g=a(n(184)),v=a(n(190)),m=a(n(185));t.Camelizer=i.default,t.attachments=s,t.email=u,t.generateComparator=c.default,t.isConfigurableProperty=l.default,t.jsonCloneDeep=d.default,t.mimeTypes=f,t.phone=p,t.replaceKey=y.default,t.replaceKeys=h.default,t.SortedArray=g.default,t.urlEncodedTaggedString=v.default,t.Validator=m.default},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t){e.exports=require("lodash/defaults")},function(e,t){e.exports=require("babel-runtime/helpers/get")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SearchType=t.ProcessingActionTypes=t.PresenceStatus=t.PatientCareCardUIType=t.PatientCareCardType=t.PatientCareCardActionType=t.Networks=t.MessageType=t.MessageSubType=t.MessageSenderStatus=t.MessageRecipientStatus=t.MessagePriority=t.GroupType=t.EscalationStatus=t.EscalationChangeAction=t.ConversationAnchorPoints=t.AllowedSendersReason=void 0;var a=r(n(148)),o=r(n(149)),i=r(n(150)),s=r(n(70)),u=r(n(49)),c=r(n(151)),l=r(n(38)),d=r(n(152)),f=r(n(153)),p=r(n(154)),y=r(n(71)),h=r(n(155)),g=r(n(156)),v=r(n(157)),m=r(n(72)),b=r(n(73)),w=r(n(158));t.AllowedSendersReason=a.default,t.ConversationAnchorPoints=o.default,t.EscalationChangeAction=i.default,t.EscalationStatus=s.default,t.GroupType=u.default,t.MessagePriority=c.default,t.MessageRecipientStatus=l.default,t.MessageSenderStatus=d.default,t.MessageSubType=f.default,t.MessageType=p.default,t.Networks=y.default,t.PatientCareCardActionType=h.default,t.PatientCareCardType=g.default,t.PatientCareCardUIType=v.default,t.PresenceStatus=m.default,t.ProcessingActionTypes=b.default,t.SearchType=w.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPhone=function(e){return/^\+?1?[-.● ]?\(?([2-9][0-9]{2})\)?[-.● ]?([0-9]{3})[-.● ]?([0-9]{4})$/.test(e)},t.formatPhone=function(e){var t=e.replace(/\D/g,"");return/^\+?1/.test(e)?t.replace(/^(1)(\d{3})(\d{3})(\d{4})/,"+$1 $2 $3 $4"):("1"===t[0]&&(t=t.slice(1)),t.replace(/^(\d{3})(\d{3})(\d{4})/,"$1 $2 $3"))},t.formatPhoneWithDash=function(e){var t=e.replace(/\D/g,"");return"1"===t[0]&&(t=t.slice(1)),t.replace(/^(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")},t.normalizePhone=function(e){var t=e.replace(/\D/g,"");return"1"!==t[0]&&(t="1"+t),"+"+t}},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("babel-runtime/helpers/toConsumableArray")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmail=void 0;var r,a=n(202),o=(r=a)&&r.__esModule?r:{default:r};t.isEmail=o.default},function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t){e.exports=require("babel-runtime/core-js/object/values")},function(e,t){e.exports=require("babel-runtime/helpers/objectWithoutProperties")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("lodash-bound/uniq")},function(e,t){e.exports=require("lodash/omit")},function(e,t){"use strict";function n(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||57344<=r?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}function r(e){for(var t=new Uint8Array(e),n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getUtf8Bytes=n,t.doubleEncodeUtf8=function(e){return r(n(e))},t.arrayBufferToBinaryString=r,t.base64ToArrayBuffer=function(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++){var o=t.charCodeAt(a);r[a]=o}return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MESSAGE_STATUS_ORDER=t.MessageRecipientStatus=void 0;var r,a,o=n(31),i=(a=o)&&a.__esModule?a:{default:a},s=new(n(19).ServerValueEnum)({NA:{key:"NA"},NEW:{serverValue:"New"},DELIVERED:{serverValue:"Delivered"},READ:{serverValue:"Read"},ACKNOWLEDGED:{serverValue:"Confirmed"}},{defaultValue:"NA"}),u=(r={},(0,i.default)(r,s.NA,0),(0,i.default)(r,s.NEW,1),(0,i.default)(r,s.DELIVERED,2),(0,i.default)(r,s.READ,3),(0,i.default)(r,s.ACKNOWLEDGED,4),r);t.MessageRecipientStatus=s,t.MESSAGE_STATUS_ORDER=u,t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){var r=I(t);if(!T[r]){var a;if(!n.placeholderEntityDelayBeforeRefreshing)return x(e,t,n).catch((a=console).error.bind(a));Object.defineProperty(t,"$$loadingScheduled",{value:!0,configurable:!0}),T[r]=setTimeout(function(){return _(e,t,n)},n.placeholderEntityDelayBeforeRefreshing)}}function y(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=y(t[0],n);return t.every(function(e){return y(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return y(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+y(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i=r(n(3)),s=r(n(7)),u=r(n(8)),l=r(n(20)),g=r(n(10)),v=r(n(21)),m=r(n(12)),b=r(n(13)),w=r(n(23)),d=r(n(9)),f=r(n(31)),p=r(n(15)),E=r(n(59)),x=(o=(0,d.default)(g.default.mark(function e(t,n,r){var a,o,i,s,u,c,l,d,f,p;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.placeholderEntityAllowLoading){e.next=2;break}return e.abrupt("return");case 2:return Object.defineProperty(n,"$$loading",{value:!0,configurable:!0}),a=void 0,e.prev=4,e.next=7,r.finder(n.id);case 7:e.next=18;break;case 9:if(e.prev=9,e.t0=e.catch(4),e.t0.code!==k.default.NotFoundError.CODE&&e.t0.code!==k.default.PermissionDeniedError.CODE){e.next=15;break}a=!0,e.next=18;break;case 15:e.next=18;break;case 18:if(delete n.$$loading,!a){e.next=51;break}if(!(l=(0,w.default)(r.notFoundAttributes))||"function"!=typeof l[b.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+y(l));e.next=23;break;case 23:if(!l||"function"!=typeof l[b.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+h(l));e.next=25;break;case 25:for(i=!(o=!0),s=void 0,e.prev=28,u=(0,m.default)(l);!(o=(c=u.next()).done);o=!0)d=(0,v.default)(c.value,2),f=d[0],p=d[1],(0,A.default)(n,f)&&(n[f]=p);e.next=36;break;case 32:e.prev=32,e.t1=e.catch(28),i=!0,s=e.t1;case 36:e.prev=36,e.prev=37,!o&&u.return&&u.return();case 39:if(e.prev=39,i)throw s;e.next=42;break;case 42:return e.finish(39);case 43:return e.finish(36);case 44:Object.defineProperty(n,"$notFound",{value:!0,configurable:!0}),t.inject(n),r.onNotFound&&r.onNotFound(),r.onLoad&&r.onLoad(null),r.onFinish&&r.onFinish(null),e.next=57;break;case 51:delete n.$placeholder,delete n.$notFound,t.inject(n),r.onSuccess&&r.onSuccess(n),r.onLoad&&r.onLoad(n),r.onFinish&&r.onFinish(n);case 57:case"end":return e.stop()}},e,this,[[4,9],[28,32,36,44],[37,,39,43]])})),function(e,t,n){return o.apply(this,arguments)}),_=(a=(0,d.default)(g.default.mark(function e(t,n,r){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,delete n.$$loadingScheduled,delete T[I(n)],n.$placeholder){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",x(t,n,r));case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])})),function(e,t,n){return a.apply(this,arguments)});t.default=function(a,e){var n=e.finder,r=e.defaultPlaceholderAttrs,o=e.defaultNotFoundAttrs,i=e.placeholderEntityDelayBeforeRefreshing,s=e.placeholderEntityAllowLoading,u=e.shouldEnsure;if(null==e||void 0!==e.finder&&null!=e.finder&&"function"!=typeof e.finder||!(void 0===e.defaultPlaceholderAttrs||null==e.defaultPlaceholderAttrs||e.defaultPlaceholderAttrs instanceof Object)||!(void 0===e.defaultNotFoundAttrs||null==e.defaultNotFoundAttrs||e.defaultNotFoundAttrs instanceof Object)||void 0!==e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"function"!=typeof e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"number"!=typeof e.placeholderEntityDelayBeforeRefreshing||void 0!==e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"function"!=typeof e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"boolean"!=typeof e.placeholderEntityAllowLoading||void 0!==e.shouldEnsure&&null!=e.shouldEnsure&&"function"!=typeof e.shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder?: ?Function;\n  defaultPlaceholderAttrs?: ?Object;\n  defaultNotFoundAttrs?: ?Object;\n  placeholderEntityDelayBeforeRefreshing?: ?Function | ?number;\n  placeholderEntityAllowLoading?: ?Function | ?boolean;\n  shouldEnsure?: ?Function;\n}\n\nGot:\n"+h(e));if(null==e||void 0!==e.finder&&null!=e.finder&&"function"!=typeof e.finder||!(void 0===e.defaultPlaceholderAttrs||null==e.defaultPlaceholderAttrs||e.defaultPlaceholderAttrs instanceof Object)||!(void 0===e.defaultNotFoundAttrs||null==e.defaultNotFoundAttrs||e.defaultNotFoundAttrs instanceof Object)||void 0!==e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"function"!=typeof e.placeholderEntityDelayBeforeRefreshing&&null!=e.placeholderEntityDelayBeforeRefreshing&&"number"!=typeof e.placeholderEntityDelayBeforeRefreshing||void 0!==e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"function"!=typeof e.placeholderEntityAllowLoading&&null!=e.placeholderEntityAllowLoading&&"boolean"!=typeof e.placeholderEntityAllowLoading||void 0!==e.shouldEnsure&&null!=e.shouldEnsure&&"function"!=typeof e.shouldEnsure)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  finder?: ?Function;\n  defaultPlaceholderAttrs?: ?Object;\n  defaultNotFoundAttrs?: ?Object;\n  placeholderEntityDelayBeforeRefreshing?: ?Function | ?number;\n  placeholderEntityAllowLoading?: ?Function | ?boolean;\n  shouldEnsure?: ?Function;\n}\n\nGot:\n"+y(e));a.ensureEntity=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return"function"==typeof i&&(i=i()),"function"==typeof s&&(s=s()),function(e,t,n,r){var a=3<arguments.length&&void 0!==r?r:{},o=e.get(t);if(o)o.$placeholder?o.$$loading||o.$notFound||a.onlyPlaceholder||c(e,o,a):(a.onExists&&a.onExists(o),a.onFinish&&a.onFinish(o));else{if(n=(0,p.default)((0,f.default)({},e.idAttribute,t),n),a.onMissing&&a.onMissing(),o=e.createInstance(n),Object.defineProperty(o,"$placeholder",{value:!0,configurable:!0}),e.inject(o),a.onlyPlaceholder)return o;c(e,o,a)}}(a,e,(0,p.default)({},r,t.attrs),(0,p.default)({finder:n,notFoundAttributes:o,placeholderEntityDelayBeforeRefreshing:i,placeholderEntityAllowLoading:s},t))},a.waitForEnsuredEntity=function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new l.default(function(e,t){a.ensureEntity(n,(0,p.default)({},r,{onFinish:e}))})},a.shouldEnsure=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof e&&(e=a.get(e)),!e||!(!u||!u(e,t,n))||!(!e.$placeholder||e.$$loading||t)}},t.dispose=function(){(0,E.default)(T).map(function(e){return clearTimeout(e)}),T={}};var k=r(n(17)),A=r(n(80)),T={},I=function(e){return e.$entityType+":"+e.id}},function(e,t){e.exports=require("lodash-bound/map")},function(e,t){e.exports=require("lodash/difference")},function(e,t){e.exports=require("lodash/each")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports=require("lodash/pick")},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){this.type=e,this.target=void 0},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){setTimeout(function(){throw e},0)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),o=new((r=a)&&r.__esModule?r:{default:r}).default(["ONLINE","OFFLINE","CONNECTING","UNREACHABLE"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.PROFILE_ATTRIBUTES_PER_ORG=void 0;var i=r(n(3)),s=r(n(7)),u=r(n(8)),l=r(n(32)),E=r(n(28)),x=r(n(21)),_=r(n(12)),k=r(n(13)),A=r(n(23)),a=r(n(15)),T=r(n(90)),o=r(n(44));t.default=function(e,t){var c=t.host,n=e.defineModel("user",{replaceKeys:{avatar:"avatarUrl",blockedPersonal:"contactsMessagingBlockedByOrganizationIds",organizationKey:"organizationId",organizationToken:"organizationId",timeToLive:"messagesTTL"},defaultValues:{botRole:null,contactsMessagingBlockedByOrganizationIds:[],organizationIds:[],presence:f.default.UNKNOWN,profileByOrganizationId:{},roles:[]},skipCamelizationForKeys:["metadata"],parseAttrs:function(e){var t=e.organizationId;if(e.dndAutoForwardReceivers?e.autoForwardReceiverIds=e.dndAutoForwardReceivers.map(function(e){return e.token}):""===e.dndAutoForwardReceiver||"undefined"===e.dndAutoForwardReceiver?e.autoForwardReceiverIds=[]:void 0!==e.dndAutoForwardReceiver&&(e.autoForwardReceiverIds=[e.dndAutoForwardReceiver]),delete e.dndAutoForwardReceiver,delete e.dndAutoForwardReceivers,t){delete e.organizationId,e.organizationIds||(e.organizationIds=[]),e.organizationIds.includes(t)||e.organizationIds.push(t);var n=(0,a.default)({},(0,o.default)(e,h),{userId:e.id,organizationId:t});delete e.autoForwardReceiverIds,delete e.conversationId,e.profileByOrganizationId||(e.profileByOrganizationId={}),e.profileByOrganizationId[t]=n}return"metadata"in e&&delete e.metadata,e.avatarUrl&&(e.avatarUrl=(0,p.cloudFrontUrlTransform)(e.avatarUrl,c.config)),!e.displayName&&e.name&&(e.displayName=e.name),e.displayName&&(0,d.isPhone)(e.displayName)&&(e.displayName=(0,d.formatPhone)(e.displayName)),e},beforeInject:function(e,t){if(t&&(e.organizationIds&&(e.organizationIds=(0,T.default)(t.organizationIds,e.organizationIds)),e.profileByOrganizationId)){var n={};if(t.profileByOrganizationId){if(!(u=(0,A.default)(t.profileByOrganizationId))||"function"!=typeof u[k.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries to be iterable, got "+b(u));if(!u||"function"!=typeof u[k.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries to be iterable, got "+w(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,_.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=(0,x.default)(i.value,2),l=c[0],d=c[1];n[l]={},(0,E.default)(n[l],d)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}if(!(v=(0,A.default)(e.profileByOrganizationId))||"function"!=typeof v[k.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+b(v));if(!v||"function"!=typeof v[k.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries2 to be iterable, got "+w(v));var f=!0,p=!1,y=void 0;try{for(var h,g=(0,_.default)(v);!(f=(h=g.next()).done);f=!0){var v,m=(0,x.default)(h.value,2);l=m[0],d=m[1];n[l]||(n[l]={}),(0,E.default)(n[l],d)}}catch(e){p=!0,y=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw y}}e.profileByOrganizationId=n}},afterAssignment:function(e){var t=e.profileByOrganizationId;if(e.contactsMessagingBlocked=0<e.contactsMessagingBlockedByOrganizationIds.length,e.isRoleBot=e.metadata.some(function(e){return"role"===e.data.feature_service}),e.shouldDisplay=!e.metadata.some(function(e){return"true"===e.data.invisible}),!(s=(0,l.default)(t))||"function"!=typeof s[k.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$values to be iterable, got "+b(s));if(!s||"function"!=typeof s[k.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$values to be iterable, got "+w(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,_.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;e.dnd||(u.autoForwardReceiverIds=[]),c.users._setMembersOnEntity(u,"autoForwardReceiverIds","autoForwardReceivers")}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}},relations:{hasMany:{metadata:{type:"metadata",foreignKey:"entityId"}}}});return(0,y.default)(n,{finder:function(){var e;return(e=c.users).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return c.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return c.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading..."},defaultNotFoundAttrs:{displayName:"<User Not Found>"}}),n};var d=n(27),f=r(n(72)),p=n(74),y=r(n(39)),h=t.PROFILE_ATTRIBUTES_PER_ORG=["autoForwardReceiverIds","conversationId","department","title"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),o=new((r=a)&&r.__esModule?r:{default:r}).default(["ESCALATION","GROUP","FORUM","PATIENT_CARE","PATIENT_MESSAGING","ROLE_ASSIGNMENT","ROLE_P2P"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,r){return(0,s.default)(e)?e.map(function(e){return a(e,r)}):(0,i.default)(e)?(0,o.default)(e,function(e,t,n){e[r(n)]=a(t,r)},{}):e}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(57)),i=r(n(227)),s=r(n(226)),u=r(n(235)),c=r(n(211)),l=r(n(231)),d={camelizeKey:(0,l.default)(c.default),underscoreKey:(0,l.default)(u.default),camelizeObject:function(e){return a(e,d.camelizeKey)},underscoreObject:function(e){return a(e,d.underscoreKey)}};t.default=d,e.exports=t.default},function(e,t,u){"use strict";function n(e){var t=e.provideDefault,n=void 0!==t&&t;return function(e){var t=e.fileBuffer,n=e.filename,r=u(84)(t),a=n&&u(60).extname(n),o=a&&(0,c.getMimeEntryByExtension)(a);if(r){var i=r.ext,s=r.mime;return{ext:i="."+i,mime:s}}return o?o[0]:{ext:a||d,mime:l}}((0,o.default)(e,["provideDefault"]))||(n?{ext:d,mime:l}:void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MIME_EXTENSION=t.DEFAULT_MIME_CONTENT_TYPE=void 0;var r,a=u(33),o=(r=a)&&r.__esModule?r:{default:r};t.getMimeType=n;var c=u(79),l=t.DEFAULT_MIME_CONTENT_TYPE="application/octet-stream",d=t.DEFAULT_MIME_EXTENSION=".bin";t.default=n},function(e,t){e.exports=require("babel-runtime/core-js/object/create")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("lodash-bound/flatten")},function(e,t){e.exports=require("lodash/chunk")},function(e,t){e.exports=require("lodash/defaultsDeep")},function(e,t){e.exports=require("lodash/transform")},function(e,t){e.exports=require("lodash/uniq")},function(e,t){e.exports=require("lodash/values")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(){this._listeners=(0,o.default)(null)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(52));t.default=a;var i=r(n(46));a.prototype.dispatchEvent=function(e){var t=(e.target=this)._listeners[e.type];if(void 0!==t)for(var n=t.length,r=0;r<n;r+=1){var a=t[r];try{"function"==typeof a.handleEvent?a.handleEvent(e):a.call(this,e)}catch(e){(0,i.default)(e)}}},a.prototype.addEventListener=function(e,t){e=String(e);var n=this._listeners,r=n[e];void 0===r&&(r=[],n[e]=r);for(var a=!1,o=0;o<r.length;o+=1)r[o]===t&&(a=!0);a||r.push(t)},a.prototype.removeEventListener=function(e,t){e=String(e);var n=this._listeners,r=n[e];if(void 0!==r){for(var a=[],o=0;o<r.length;o+=1)r[o]!==t&&a.push(r[o]);0===a.length?delete n[e]:n[e]=a}},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){i.default.call(this,e),this.data=t.data,this.lastEventId=t.lastEventId}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(52));t.default=a;var i=r(n(45));a.prototype=(0,o.default)(i.default.prototype),e.exports=t.default},function(e,t,n){"use strict";function r(e){this._xhr=new i.default(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var a,o=n(65),i=(a=o)&&a.__esModule?a:{default:a};r.prototype.open=function(r,t,a,e,n,o){var i=this._xhr;i.open("GET",e);var s=0;for(var u in i.onprogress=function(){var e=i.responseText.slice(s);s+=e.length,t(e)},i.onreadystatechange=function(){if(2===i.readyState){var e=i.status,t=i.statusText,n=i.getResponseHeader("Content-Type");r(e,t,n)}else 4===i.readyState&&a()},i.withCredentials=n,i.responseType="text",o)Object.prototype.hasOwnProperty.call(o,u)&&i.setRequestHeader(u,o[u]);i.send()},r.prototype.cancel=function(){this._xhr.abort()},e.exports=t.default},function(e,t){"use strict";function n(e){this.withCredentials=!1,this.responseType="",this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=c,this.onreadystatechange=c,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=c}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var c=function(){};n.prototype.open=function(e,t){this._abort(!0);var a=this,o=this._xhr,i=1,n=0;this._abort=function(e){0!==a._sendTimeout&&(clearTimeout(a._sendTimeout),a._sendTimeout=0),1!==i&&2!==i&&3!==i||(i=4,o.onload=c,o.onerror=c,o.onabort=c,o.onprogress=c,o.onreadystatechange=c,o.abort(),0!==n&&(clearTimeout(n),n=0),e||(a.readyState=4,a.onreadystatechange())),i=0};function r(){if(1===i){var t="",n=void 0,r=0;if("contentType"in o)r=200,t="OK",n=o.contentType;else try{r=o.status,t=o.statusText,n=o.getResponseHeader("Content-Type")}catch(e){t="",n=void(r=0)}0!==r&&(i=2,a.readyState=2,a.status=r,a.statusText=t,a._contentType=n,a.onreadystatechange())}}function s(){if(r(),2===i||3===i){i=3;var e="";try{e=o.responseText}catch(e){}a.readyState=3,a.responseText=e,a.onprogress()}}function u(){s(),1!==i&&2!==i&&3!==i||(i=4,0!==n&&(clearTimeout(n),n=0),a.readyState=4,a.onreadystatechange())}o.onload=u,o.onerror=u,o.onabort=u,"sendAsBinary"in XMLHttpRequest.prototype||"mozAnon"in XMLHttpRequest.prototype||(o.onprogress=s),o.onreadystatechange=function(){void 0!==o&&(4===o.readyState?u():3===o.readyState?s():2===o.readyState&&r())},"contentType"in o&&(t+=(-1===t.indexOf("?",0)?"?":"&")+"padding=true"),o.open(e,t,!0),"readyState"in o&&(n=setTimeout(function(){!function e(){n=setTimeout(function(){e()},500),3===o.readyState&&s()}()},0))},n.prototype.abort=function(){this._abort(!1)},n.prototype.getResponseHeader=function(e){return this._contentType},n.prototype.setRequestHeader=function(e,t){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(e,t)},n.prototype.send=function(){if("ontimeout"in XMLHttpRequest.prototype||void 0===document||void 0===document.readyState||"complete"===document.readyState){var e=this._xhr;e.withCredentials=this.withCredentials,e.responseType=this.responseType;try{e.send(void 0)}catch(t){throw t}}else{var t=this;t._sendTimeout=setTimeout(function(){t._sendTimeout=0,t.send()},4)}},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourcePolyfill=t.XHRWrapper=t.XHRTransport=t.throwError=t.MessageEvent=t.EventTarget=t.Event=void 0;var a=r(n(45)),o=r(n(62)),i=r(n(63)),s=r(n(46)),u=r(n(64)),c=r(n(65)),l=r(n(94));t.Event=a.default,t.EventTarget=o.default,t.MessageEvent=i.default,t.throwError=s.default,t.XHRTransport=u.default,t.XHRWrapper=c.default,t.default=l.default,t.EventSourcePolyfill=l.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(i,e){var s=this,u=(1<arguments.length&&void 0!==e?e:{}).idx,c=n(53),l=n(60),d=void 0,f=void 0,p=void 0;return void 0!==u&&(u="-"+u),y.default.resolve().then((0,g.default)(h.default.mark(function e(){var t,n,r,a,o;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof i)return e.next=3,new y.default(function(n,r){c.readFile(i,function(e,t){e?r(e):n(t)})});e.next=9;break;case 3:d=e.sent,f=l.basename(i),t=(0,v.getMimeType)({fileBuffer:d,filename:f,provideDefault:!0}),n=t.mime,p=n,e.next=17;break;case 9:if(!(i instanceof Buffer)){e.next=16;break}d=i,r=(0,v.getMimeType)({fileBuffer:d,provideDefault:!0}),a=r.ext,o=r.mime,f="attachment"+u+a,p=o,e.next=17;break;case 16:throw new Error("Unsupported file attachment type");case 17:return e.abrupt("return",{fieldValue:d.toString("binary"),mimetype:p,filename:f});case 18:case"end":return e.stop()}},e,s)})))}Object.defineProperty(t,"__esModule",{value:!0});var o,y=r((r((r((r((r((r(n(3)),n(7))),n(8))),n(12))),n(13))),n(20))),h=r(n(10)),g=r(n(9)),i=(o=(0,g.default)(h.default.mark(function e(t,n){var r;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="",e.next=4,a(t,n);case 4:r=e.sent,e.next=11;break;case 7:e.next=11;break;case 10:r=e.sent;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)}),v=(n(37),n(51));t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="validation",o);function f(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"invalid",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e+" is "+t;(0,u.default)(this,f);var r=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,n));return r.code=f.CODE,r.name=e,r.reason=t,r}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function g(e,t){return t in e?e[t].value:null}Object.defineProperty(t,"__esModule",{value:!0}),t.CONTACTS_ORG_ID=void 0,t.default=function(e,t){var h=t.host,n=e.defineModel("organization",{instanceEvents:!0,replaceKeys:{allowMsgForward:"__isForwardAllowed",allowPublicGroups:"forumsEnabled",allowRoleScheduleUpload:"__isRolesScheduleUploadEnabled",desktopPriorityMessaging:"__desktopPriorityMessagingSounds",eula:"eulaEnabled",eulaContent:"eulaUrl",featurePatientCare:"__canShowPatientCare",featureRolesEscalation:"__canEscalateMessages",featureRoleScheduleUpload:"__canUploadRolesSchedule",featureRoleService:"rolesEnabled",featureTransactions:"canShowTransactions",members:"memberCount",patientCare:"__showPatientCare",rolesEscalation:"__isRolesEscalationEnabled",roleService:"canAdminRoles",ssoWebSessionDuration:"desktopExtendedSession"},defaultValues:{__canEscalateMessages:!1,__canShowPatientCare:!1,__canUploadRolesSchedule:!1,__isForwardAllowed:!1,__isRolesEscalationEnabled:!1,__isRolesScheduleUploadEnabled:!1,__showPatientCare:!1,_unreadMessages:null,_unreadPriorityMessages:null,canAdminRoles:!1,canShowTransactions:!1,desktopExtendedSession:-1,forumsEnabled:!1,highestSortNumber:0,lastIncomingMessageSortNumber:0,networks:null,paid:!1,reportingV2Enabled:!1,rolesEnabled:!1,settings:{},unreadCount:0,unreadPriorityCount:0},transientAttrs:["unreadCount","unreadPriorityCount"],parseAttrs:function(e){var t;e.settings&&(e.settings=(t=(t=e.settings,a.default).call(t,function(e){return i.default.camelizeKey(e.name)}),o.default).call(t,function(e){isFinite(e.value)&&(e.value=+e.value),"true"===e.value&&(e.value=!0),"false"===e.value&&(e.value=!1)}));return e},afterAssignment:function(e){var t=e.__canEscalateMessages,n=e.__canShowPatientCare,r=e.__canUploadRolesSchedule,a=e.__desktopPriorityMessagingSounds,o=e.__isForwardAllowed,i=e.__isRolesEscalationEnabled,s=e.__isRolesScheduleUploadEnabled,u=e.__showPatientCare,c=e.autoForwardReceiverId,l=e.id,d=e.name,f=e.paid,p=e.settings;c=g(p,"dndAutoForwardReceiver"),e.allowPriorityMessage=!!g(p,"priorityMessaging"),e.autoLogoutMinutes=g(p,"autologoutTime")||1440,e.canUploadRolesSchedule=r&&s,e.deleteOnRead=!!g(p,"dor"),e.desktopAutoUpdate=!!g(p,"autoUpdate"),e.isEulaAccepted=!g(p,"eula"),e.isForwardAllowed=o&&1===g(p,"forward"),e.messageTimeToLive=g(p,"ttl")||-1;var y=e.id===v;e.allowedSenders=h.organizations._getAllowedSenders(e),e.autoForwardReceiverId=c,e.autoForwardReceiver=c?h.models.User.get(c):null,e.canEscalateMessages=t&&i,e.desktopPriorityMessagingSounds=f&&a,e.displayName=y?"Contacts":d,e.isContacts=y,e.showPatientCare=n&&u,e.userRoles=h.userRoles.getByOrganizationId(l),e.reportingV2Enabled=h.config.reportingV2Enabled,e._unreadMessages||(e._unreadMessages=[]),e._unreadPriorityMessages||(e._unreadPriorityMessages=[]),e.networks||(e.networks={}),e.networks.provider||(e.networks.provider={unreadCount:0,unreadPriorityCount:0}),e.networks.patient||(e.networks.patient={unreadCount:0,unreadPriorityCount:0})},methods:{getSettingValue:function(e){return g(this.settings,e)},getSettingEntry:function(e){return this.settings&&e in this.settings?this.settings[e]:null}},relations:{hasMany:{__expirableMessages:{type:"message",foreignKey:"__organizationId",filter:function(e){return!!e.expiresAt},sortBy:[["expiresAt","asc"]]},__expirableMutes:{type:"mute",foreignKey:"organizationId",filter:function(e){return!!e.expiresAt},sortBy:[["expiresAt","asc"]]},__markingAsReadConversations:{type:"conversation",foreignKey:"organizationId",filter:function(e){return!!e._markingAsRead},sortBy:[["_markingAsReadExpiration","asc"]]},conversations:{type:"conversation",foreignKey:"organizationId",filter:function(e){var t=e.counterParty;return!!t&&t.groupType!==s.GroupType.ROLE_ASSIGNMENT},sortBy:[["highestSortNumber","desc"],["_origIndex","asc"]]},roles:{type:"role",foreignKey:"organizationId"},roleTags:{type:"roleTag",foreignKey:"organizationId"}}}});return(0,u.default)(n,{finder:function(){var e;return(e=h.organizations).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return h.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return h.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Organization..."},defaultNotFoundAttrs:{displayName:"<Organization Not Found>"}}),n};var a=r(n(206)),o=r(n(203)),i=r(n(50)),s=n(26),u=r(n(39)),v=t.CONTACTS_ORG_ID="UpM28mnfW65vJkbqEATtKvxm"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({ACKNOWLEDGED:{serverValue:"confirmed"},CANCELLED:{serverValue:"cancelled"},IN_PROGRESS:{serverValue:"in_progress"},NO_RESPONSE:{serverValue:"no_response"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),o=new((r=a)&&r.__esModule?r:{default:r}).default(["PATIENT","PROVIDER"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({UNKNOWN:{serverValue:"unknown"},AVAILABLE:{serverValue:"available"},UNAVAILABLE:{serverValue:"unavailable"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({CONVERSATION_MESSAGE_STATUS:{serverValue:"conversation_message_status"},GROUP_REPLAY:{serverValue:"group_replay"},MESSAGE_REPLAY:{serverValue:"message_replay"},OFFLINE:{serverValue:"offline"},ORGANIZATION_MESSAGE_STATUS:{serverValue:"organization_message_status"},ORGANIZATION_REPLAY:{serverValue:"organization_replay"},ROLE_OPT_IN:{serverValue:"optin"},ROLE_OPT_OUT:{serverValue:"optout"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cloudFrontUrlTransform=void 0;var s=r(n(216)),u=r(n(43));t.cloudFrontUrlTransform=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!n||(0,u.default)(e.cloudfront))return n;var t=e.cloudfront,r=(0,s.default)(t,function(e,t){return-1!==n.indexOf(t)}),a=t[r]?r+"."+e.cloudfrontDomain:"",o=t[r]?e.assetDomain+"/"+t[r]:"",i=a&&o?n.replace(a,o):n;return i.replace("http://","https://")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Event:n(135),SearchResult:n(146)};t.default=r,e.exports=t.default},function(e,t,n){},function(e,t,n){"use strict";!function(){try{var e=n(200).request().constructor.prototype;e.setNoDelay||(e.setNoDelay=function(){}),e.abort||(e.abort=function(){this.xhr&&this.xhr.abort()})}catch(e){}}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,d=r(n(3)),f=r(n(8)),s=r(n(29)),p=r(n(7)),u=r(n(20)),c=r(n(15)),y=r(n(28)),h=r(n(12)),g=r(n(13)),v=r(n(10)),m=r(n(9)),b=r(n(4)),w=r(n(1)),l=r(n(2)),E=r(n(6)),x=r(n(5)),_=r(n(89)),k=r(n(36)),A=r(n(208)),T=r(n(40)),I=r(n(17)),O=n(75),j=r(n(47)),S=n(22),R=r(n(14)),M=["message:is_typing","presence","remote_wipe","sse:heartbeat"],z=["message:is_typing","presence","sse:heartbeat"],G=["00000000-0000-0000-0000-000000000001"],C=["remote_wipe"],P={autoDeliver:"auto-deliver",canConfirm:"can-confirm",closeAfterMessages:"close-after-messages",heartbeat:"heartbeat_5",hidden:"hidden",includeDistributionListEvents:"dl_sender_event",isTyping:"is-typing",msgDeliveryDelay:"msg_delivery_delay",multiOrg:"multi-org",noOfflineMessages:"no-offline-messages",renderMetadata:"render_metadata"},V={events:{allowManualRequestBatch:!0,basicAuthParam:"auth_basic",features:null,heartbeatTimeout:12e3,requiresBasicAuth:!1,routerName:"eventRouter",url:"/v2/events"},simpleNotifications:{allowManualRequestBatch:!1,basicAuthParam:"auth",features:{heartbeat:!0},heartbeatTimeout:12e3,requiresBasicAuth:!0,routerName:"notificationRouter",url:"/v2/events/simple_notifications"}},N=(a=R.default,(0,x.default)(U,a),(0,l.default)(U,[{key:"mounted",value:function(){this._eventQueue=[],this._eventQueueTimeout=null,this._processedEventIds=[],this._queuedAcks=[],this.__allEvents=[]}},{key:"dispose",value:function(){this._eventQueue=[],this._processedEventIds=[],this._queuedAcks=[],this._throttled_flushQueuedAcks.cancel&&this._throttled_flushQueuedAcks.cancel(),this._cancelTimers()}},{key:"setAuth",value:function(e){this._auth=(0,c.default)({basicAuthParam:this.basicAuthParam},e)}},{key:"removeAuth",value:function(){this._auth=null}},{key:"getAuth",value:function(){return this._auth}},{key:"connect",value:(i=(0,m.default)(v.default.mark(function e(){var t,n,a=this;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSignedIn){e.next=2;break}throw new I.default.NotSignedInError;case 2:if(!this.requiresBasicAuth||this._auth.key&&this._auth.secret){e.next=4;break}throw new I.default.RequiresBasicAuthError;case 4:if(this.eventSource)return this.logger.warn("already connected"),e.abrupt("return");e.next=7;break;case 7:if(n=(t=(t=this.features||this.config.events,A.default).call(t,function(e){return 0===e||!!e}),T.default).call(t,function(e,t){var n=P[t];return!0===e?n:n+":"+e}).join(","),this.logger.info("connecting "+this.endpointType+". networkStatus="+this.host.httpClient.networkStatus+" features="+n),this.host.httpClient.networkStatus===j.default.OFFLINE)return this._scheduleConnectRetry(),e.abrupt("return");e.next=12;break;case 12:return this._watchNetworkConnection(),e.abrupt("return",new u.default(function(e,r){a._hasConnected=!1,a._hasError=!1,a._isClosed=!1,a._requestedClose=!1,a.eventSource=a.httpClient.createEventSource(a.url,{auth:a._auth,features:n,heartbeatTimeout:a.heartbeatTimeout,wantNative:null===a.heartbeatTimeout,onOpen:function(){a.logger.info("open"),a._connectionRetryCount=0,a._cancelTimers(),a._hasConnected=!0,a.emit("connected"),e()},onMessage:function(e){return a._queueEvent(e)},onError:function(e){a._hasError=!0,a.logger.info("error",e,e.message||"",e.code||"",void 0!==e.status?e.status:"");var t=a.httpClient.isUnauthorizedError(e),n=a._hasConnected;t?a.disconnect({isRecoverable:!1}):a._disconnectAndRetry(),n||r(e)},onClose:function(){a._isClosed=!0,a.logger.info("close"),a._requestedClose||(a.httpClient._setNetworkStatus(j.default.UNREACHABLE),a._disconnectAndRetry())}})}));case 14:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_scheduleConnectRetry",value:function(){var e=this;this._cancelTimers(),this.logger.info("scheduleConnectRetry",this._connectionRetryCount);var t=Math.min(this.config.eventsAutoReconnectDelay*this._connectionRetryCount,this.config.eventsAutoReconnectMaxDelay);this._scheduleConnectRetryTimeout=setTimeout(function(){e.connect().catch(function(e){})},t),this._connectionRetryCount++}},{key:"_watchNetworkConnection",value:function(){this._watchingNetworkConnection||(this._watchingNetworkConnection=!0,this.host.on("networkStatus:change",this.onNetworkStatusChanged))}},{key:"_unwatchNetworkConnection",value:function(){this._watchingNetworkConnection&&(this.host.removeListener("networkStatus:change",this.onNetworkStatusChanged),this._watchingNetworkConnection=!1)}},{key:"_cancelTimers",value:function(){this._scheduleConnectRetryTimeout&&(clearTimeout(this._scheduleConnectRetryTimeout),this._scheduleConnectRetryTimeout=null),null!==this._eventQueueTimeout&&(clearTimeout(this._eventQueueTimeout),this._eventQueueTimeout=null)}},{key:"reconnect",value:function(){this.eventSource&&this.disconnect(),this.connect()}},{key:"_disconnectAndRetry",value:function(){this.disconnect(),this.config.eventsAutoReconnect&&this._scheduleConnectRetry()}},{key:"disconnect",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).isRecoverable,t=void 0===e||e;if(this._cancelTimers(),this._unwatchNetworkConnection(),this.eventSource){var n=this.eventSource;this.eventSource=null,this._requestedClose=!0,this._isClosed||n.close(),this.emit("disconnected",{isRecoverable:t})}this._eventQueue=[],this._queuedAcks=[]}},{key:"_queueEvent",value:function(e){var t=e.data;if(C.some(function(e){return t.includes(e)})){var n=void 0;try{n=JSON.parse(t)}catch(e){return this.logger.error("error parsing SSE payload: <"+t+">"),void this._disconnectAndRetry()}var r=(0,p.default)(n.event)[0].replace("tigertext:iq:","");if(C.includes(r)){this.disconnect();var a=n.event_id;return void this._processImmediateEvent(a,t)}}this._eventQueue.push(t),this._scheduleEventQueue()}},{key:"_handleEvent",value:function(e){var t=e.event_id;if(this._autoAck||!this._processedEventIds.includes(t)||G.includes(t)){var n=(0,p.default)(e.event)[0],r=n.replace("tigertext:iq:",""),a=e.event[n];!this.config.eventsDebugging&&z.includes(r)||this.__allEvents.push(e),this.logger.debug("incoming",r,a);var o=new O.Event(t,r,a);try{this.router.emit(o),this.emit("event",o),this._autoAck?M.includes(r)||this.__queueAck(t):this._processedEventIds.push(t)}catch(e){this.logger.error("error in event "+r,e,e.stack,{data:a}),this.disconnect()}}}},{key:"__queueAck",value:function(e){var t;e=(0,S.arrayWrap)(e),(t=this._queuedAcks).push.apply(t,(0,s.default)(e)),this._throttled_flushQueuedAcks()}},{key:"ack",value:(o=(0,m.default)(v.default.mark(function e(t){var n;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),n=!1,t=(0,S.arrayWrap)(t),this.logger.log("ack",t),this._pendingAcks++,e.prev=5,e.next=8,this.host.api.events.ack(t);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(5),n=this.httpClient.isUnauthorizedError(e.t0),this.logger.warn("some events not acked",t);case 14:this._pendingAcks--,n&&(this.logger.warn("no longer authorized, terminating session"),this.disconnect({isRecoverable:!1}));case 16:case"end":return e.stop()}},e,this,[[5,10]])})),function(e){return o.apply(this,arguments)})},{key:"_autoAck",get:function(){return"events"===this.endpointType&&this.config.autoAckSuccessfullyHandledEvents}},{key:"isConnected",get:function(){return!!this.eventSource}},{key:"isSignedIn",get:function(){return!!this._auth}},{key:"router",get:function(){return this.host[this.routerName]}},{key:"url",get:function(){return this.config.condensedReplays&&"events"===this.endpointType?"/v5/events":V[this.endpointType].url}}]),U);function U(e,t){var a=this;(0,w.default)(this,U);var n,l=(0,E.default)(this,(U.__proto__||(0,b.default)(U)).call(this,e,t));return l.onNetworkStatusChanged=function(e){var t=e.networkStatus;l._connectionRetryCount=0,t!==j.default.OFFLINE&&t!==j.default.UNREACHABLE||(l.disconnect(),l._scheduleConnectRetry())},l._closeAllConnections=(0,m.default)(v.default.mark(function e(){var t,n,r;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.isConnected)throw new Error("existing connections must be closed first");e.next=2;break;case 2:if("simpleNotifications"!==l.endpointType){e.next=10;break}if(t=l._auth,n=t.key,r=t.secret,n&&r){e.next=6;break}throw new I.default.RequiresBasicAuthError;case 6:return e.next=8,l.host.api.notifications.closeAllConnections(n,r);case 8:e.next=12;break;case 10:return e.next=12,l.host.api.events.closeAllConnections();case 12:case"end":return e.stop()}},e,a)})),l._processImmediateEvent=(n=(0,m.default)(v.default.mark(function e(t,n){return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l._eventQueue=[n],l._eventQueueDeferred=!1,l._autoAck)return e.next=5,l.ack([t]);e.next=5;break;case 5:l.processEventQueue();case 6:case"end":return e.stop()}},e,a)})),function(e,t){return n.apply(this,arguments)}),l._scheduleEventQueue=function(){l.allowManualRequestBatch&&l.config.manuallyRequestEventQueueBatch&&(l._eventQueueIsManual=!0);var e=l._eventQueueIsManual?l._emitBatch:l.processEventQueue;if(null===l._eventQueueTimeout){var t=l.config.eventCollectionInterval;null!==t?l._eventQueueTimeout=setTimeout(e,t):e()}},l._emitBatch=function(){l.emit("batch:available",l._eventQueue.length),l._eventQueueTimeout=null},l.deferEventQueue=function(){l._eventQueueDeferred=!0},l.resumeEventQueue=function(){l._eventQueueDeferred=!1},l.processEventQueue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l.config.maxEventBatch;if(!l._eventQueueDeferred&&0!==l._eventQueue.length){var t=void 0,n=void 0,r=void 0;try{var a=l._eventQueue.splice(0,e);if(!a||"function"!=typeof a[g.default]&&!Array.isArray(a))throw new TypeError("Expected lines to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,f.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,p.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(a));if(!a||"function"!=typeof a[g.default]&&!Array.isArray(a))throw new TypeError("Expected lines to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,f.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,p.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(a));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,h.default)(a);!(o=(u=c.next()).done);o=!0)t=u.value,n=!1,r=JSON.parse(t),n=!0,l._handleEvent(r)}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}l._eventQueueTimeout=null,0<l._eventQueue.length&&l._scheduleEventQueue()}catch(e){n?(l.logger.error("error while processing SSE payload",e,e.stack,{data:r}),l.disconnect()):(l.logger.error("error parsing SSE payload: <"+t+">"),l._disconnectAndRetry())}}},l._flushQueuedAcks=function(){if(0!==l._queuedAcks.length){if(l._pendingAcks>=l.config.flushAckMaxConnections)return void l._throttled_flushQueuedAcks();var e=l._queuedAcks.splice(0,l.config.flushAckMaxEvents);l.ack(e),0<l._queuedAcks.length&&l._throttled_flushQueuedAcks()}},l.endpointType||(l.endpointType="events"),(0,y.default)(l,(0,k.default)(V[l.endpointType],"url")),l._throttled_flushQueuedAcks=(0,_.default)(l._flushQueuedAcks,l.config.flushAckInterval,{leading:!1}),l._connectionRetryCount=0,l._eventQueueDeferred=!1,l._eventQueueIsManual=!1,l._pendingAcks=0,l}t.default=N,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.allExtensions=t.allContentTypes=void 0;var a=r(n(12)),s=r(n(3)),u=r(n(8)),c=r(n(7)),o=r(n(13));t.getMimeEntryByContentType=function(e){return l[e]},t.getMimeEntryByExtension=function(e){return e&&"."===e[0]&&(e=e.slice(1)),d[e]};var i=[{ext:"csv",mime:"text/csv"},{ext:"csv",mime:"text/plain"},{ext:"doc",mime:"application/msword"},{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"},{ext:"gif",mime:"image/gif"},{ext:"gz",mime:"application/gzip"},{ext:"gz",mime:"application/x-gzip"},{ext:"gz",mime:"application/x-compressed"},{ext:"jpg",mime:"image/jpeg"},{ext:"jpeg",mime:"image/jpeg"},{ext:"m4a",mime:"audio/m4a"},{ext:"m4a",mime:"audio/x-m4a"},{ext:"m4a",mime:"audio/mp4"},{ext:"m4v",mime:"video/x-m4v"},{ext:"mov",mime:"video/quicktime"},{ext:"mp3",mime:"audio/mpeg"},{ext:"mp3",mime:"audio/mp3"},{ext:"mp3",mime:"audio/mpeg3"},{ext:"mp3",mime:"audio/x-mpeg"},{ext:"mp3",mime:"audio/x-mpeg-3"},{ext:"mp3",mime:"video/mpeg"},{ext:"mp3",mime:"video/x-mpeg"},{ext:"mp4",mime:"video/mp4"},{ext:"pdf",mime:"application/pdf"},{ext:"png",mime:"image/png"},{ext:"ppsx",mime:"application/vnd.openxmlformats-officedocument.presentationml.slideshow"},{ext:"ppt",mime:"application/vnd.ms-powerpoint"},{ext:"ppt",mime:"application/ms-powerpoint"},{ext:"ppt",mime:"application/mspowerpoint"},{ext:"ppt",mime:"application/powerpoint"},{ext:"ppt",mime:"application/x-mspowerpoint"},{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"},{ext:"svg",mime:"image/svg+xml"},{ext:"txt",mime:"text/plain"},{ext:"wav",mime:"audio/wav"},{ext:"wav",mime:"audio/wave"},{ext:"wav",mime:"audio/x-pn-wav"},{ext:"wav",mime:"audio/x-wav"},{ext:"xls",mime:"application/vnd.ms-excel"},{ext:"xls",mime:"application/excel"},{ext:"xls",mime:"application/x-excel"},{ext:"xls",mime:"application/x-msexcel"},{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{ext:"zip",mime:"application/zip"},{ext:"zip",mime:"application/octet-stream"}],l={},d={};if("function"!=typeof i[o.default]&&!Array.isArray(i))throw new TypeError("Expected supportedMimeEntries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,u.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,s.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(i));if("function"!=typeof i[o.default]&&!Array.isArray(i))throw new TypeError("Expected supportedMimeEntries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,u.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,s.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(i));var f=!0,p=!1,y=void 0;try{for(var h,g=(0,a.default)(i);!(f=(h=g.next()).done);f=!0){var v=h.value,m=v.ext,b=v.mime;l[b]||(l[b]=[]),l[b].push(v),d[m]||(d[m]=[]),d[m].push(v)}}catch(e){p=!0,y=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw y}}t.allContentTypes=(0,c.default)(l),t.allExtensions=(0,c.default)(d)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(11),o=(r=a)&&r.__esModule?r:{default:r};t.default=function(e,t){var n=(0,o.default)(e,t);return n&&n.configurable},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(3),o=(r=a)&&r.__esModule?r:{default:r};t.default=function(e){return void 0!==e?JSON.parse((0,o.default)(e)):null},e.exports=t.default},function(e,t){e.exports=require("babel-runtime/core-js/symbol")},function(e,t){e.exports=require("btoa")},function(e,t){e.exports=require("file-type")},function(e,t){e.exports=require("jshashes")},function(e,t){e.exports=require("lodash-bound/omitBy")},function(e,t){e.exports=require("lodash-bound/values")},function(e,t){e.exports=require("lodash-bound/without")},function(e,t){e.exports=require("lodash/throttle")},function(e,t){e.exports=require("lodash/union")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("shallowequal")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function R(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=R(t[0],n);return t.every(function(e){return R(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return R(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,V.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,f.default)(e))+": "+R(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function M(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=M(t[0],n);return t.every(function(e){return M(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return M(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,V.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,f.default)(e))+": "+M(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i,s,u,c,l,d,f=r(n(3)),p=r(n(8)),v=r(n(20)),y=r(n(10)),h=r(n(9)),z=r(n(21)),G=r(n(12)),C=r(n(13)),P=r(n(23)),V=r(n(7)),N=r(n(15)),U=r(n(28)),F=r(n(1)),g=r(n(2)),L=r(n(232)),$=r(n(230)),D=r(n(56)),m=r(n(34)),b=r(n(201)),B=r(n(242)),w=r(n(61)),q=r(n(120)),Z=r(n(17)),K=r(n(121)),H=r(n(97)),W=r(n(98)),X=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(26)),E=r(n(73)),Q=r(n(47)),Y=r(n(181)),J=r(n(183)),ee=n(22),te=r(n(191)),x=((0,g.default)(ne,[{key:"_listenToEvents",value:function(){var r=this;this.httpClient.on("networkStatus:change",function(e){var t=e.networkStatus;r.emit("networkStatus:change",{networkStatus:t})}),this.httpClient.on("auth:invalid",function(){return r.emit("auth:invalid")}),this.on("signedIn",function(e,t){r.logger.info("signedIn",e.id)}),this.on("signedOut",function(e){e.resetClient&&r.reset()}),this.on("signUp",function(e){var t=e.user,n=e.auth;r.logger.info("signUp",t.id),r._setCurrentUser(t),r._setAuth(n)}),this.events.on("event",function(e){r.emit("event",e),"bang"===e.type&&r._resetLastBang()}),this.events.on("batch:available",function(e){return r.emit("events:batch:available",e)}),this.events.on("connected",function(){return r.emit("events:connected")}),this.events.on("disconnected",this._onDisconnected),this.events.on("processing:start",function(e){return r.emit("processing:start",e)}),this.events.on("processing:stop",function(e){return r.emit("processing:stop",e)}),this.groups.on("membership:change",function(e){return r.emit("group:membership:change",e)}),this.conversations.on("clearTimeline",function(e){return r.emit("conversation:clearTimeline",e)}),this.conversations.on("clearMessageStatuses",function(e){return r.emit("conversation:clearMessageStatuses",e)}),this.conversations.on("message",function(e){return r.emit("message",e)}),this.conversations.on("change",function(e){return r.emit("conversation:change",e)}),this.conversations.on("friends",function(e){return r.emit("friends",e)}),this.notifications.on("connected",function(){return r.emit("notifications:connected")}),this.notifications.on("disconnected",function(e){return r.emit("notifications:disconnected")}),this.notifications.on("signingIn",function(){return r.emit("notifications:signingIn")}),this.notifications.on("signedIn",function(e){return r.emit("notifications:signedIn",e)}),this.notifications.on("signingOut",function(e){return r.emit("notifications:signingOut",e)}),this.notifications.on("signedOut",function(e){return r.emit("notifications:signedOut",e)}),this.notifications.on("event",function(e){return r.emit("notifications:event",e)}),this.notifications.on("message",function(e){return r.emit("notification:message",e)}),this.notifications.on("unread:change",function(e){return r.emit("notification:unread:change",e)}),this.presence.on("change",function(e){return r.emit("presence:change",e)}),this.roles.on("change",function(e){return r.emit("role:change",e)}),this.typingStatus.on("change",function(e){return r.emit("typing:change",e)}),"undefined"!=typeof window&&window.addEventListener("unload",this._onBrowserUnload)}},{key:"_startTicker",value:function(){this.__ticker=setTimeout(this._onTick,5e3),this.__tickerFrame=null}},{key:"_stopTicker",value:function(){null!==this.__ticker&&(clearTimeout(this.__ticker),this.__ticker=null),null!==this.__tickerFrame&&(B.default.cancel(this.__tickerFrame),this.__tickerFrame=null)}},{key:"signIn",value:(d=(0,h.default)(y.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.udid,a=void 0===r?(0,w.default)():r,o=l.refreshUser,i=void 0===o||o,this.emit("signingIn"),e.next=4,this.users.signIn(t,n,{udid:a});case 4:if(s=e.sent,u=s.auth,c=s.user,this._setCurrentUser(c),this._setAuth(u),i)return e.next=12,this.users.findMe({bypassCache:!0});e.next=12;break;case 12:return this.emit("signedIn",c,u),e.abrupt("return",{auth:u,user:c});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"signInWithApiKeyAndSecret",value:(l=(0,h.default)(y.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.udid,a=void 0===r?(0,w.default)():r,o=l.refreshUser,i=void 0===o||o,this.emit("signingIn"),e.next=4,this.users.signInWithApiKeyAndSecret(t,n,{udid:a});case 4:if(s=e.sent,u=s.auth,c=s.user,this._setCurrentUser(c),this._setAuth(u),i)return e.next=12,this.users.findMe({bypassCache:!0});e.next=12;break;case 12:return this.emit("signedIn",c,u),e.abrupt("return",{auth:u,user:c});case 14:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"signInWithMagicToken",value:(c=(0,h.default)(y.default.mark(function e(t){var n,r,a,o,i,s,u,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.udid,r=void 0===n?(0,w.default)():n,a=c.refreshUser,o=void 0===a||a,this.emit("signingIn"),e.next=4,this.users.signInWithMagicToken(t,{udid:r});case 4:if(i=e.sent,s=i.auth,u=i.user,this._setCurrentUser(u),this._setAuth(s),o)return e.next=12,this.users.findMe({bypassCache:!0});e.next=12;break;case 12:return this.emit("signedIn",u,s),e.abrupt("return",{auth:s,user:u});case 14:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"signOut",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.async,n=void 0===t||t,r=e.fromServer,a=void 0!==r&&r,o=e.resetClient,i=void 0===o||o;if(!this.isSignedIn)return v.default.resolve(!1);if(!n&&"undefined"==typeof XMLHttpRequest)throw new Error("`async: false` option cannot be set unless using signOut() in a browser");if(this.events.disconnect(),n)return this.users.signOut({fromServer:a,resetClient:i});this.emit("signingOut",{fromServer:a,resetClient:i});var s=new XMLHttpRequest;if(s.open("POST",this.config.baseUrl+"/v2/logout",!1),!(p=(0,P.default)(this.httpClient.getAuthHeaders()))||"function"!=typeof p[C.default]&&!Array.isArray(p))throw new TypeError("Expected _Object$entries3 to be iterable, got "+R(p));if(!p||"function"!=typeof p[C.default]&&!Array.isArray(p))throw new TypeError("Expected _Object$entries3 to be iterable, got "+M(p));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,G.default)(p);!(u=(d=f.next()).done);u=!0){var p,y=(0,z.default)(d.value,2),h=y[0],g=y[1];s.setRequestHeader(h,g)}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}return s.send(null),this.emit("signedOut",{fromServer:a,resetClient:i,signedOut:!0}),v.default.resolve(!0)}},{key:"signOutAllDevices",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).async,t=void 0===e||e;if(!this.isSignedIn)return v.default.resolve();if(!t&&"undefined"==typeof XMLHttpRequest)throw new Error("`async: false` option cannot be set unless using signOutAllDevices() in a browser");if(t)return this.users.signOutAllDevices();var n=new XMLHttpRequest;if(n.open("POST",this.config.baseUrl+"/v2/wipe?token="+this.currentUserId,!1),!(u=(0,P.default)(this.httpClient.getAuthHeaders()))||"function"!=typeof u[C.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries4 to be iterable, got "+R(u));if(!u||"function"!=typeof u[C.default]&&!Array.isArray(u))throw new TypeError("Expected _Object$entries4 to be iterable, got "+M(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,G.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=(0,z.default)(i.value,2),l=c[0],d=c[1];n.setRequestHeader(l,d)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n.send(null),v.default.resolve()}},{key:"authenticate",value:(u=(0,h.default)(y.default.mark(function e(t,n){var r;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+M(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+M(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+R(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+R(n));e.next=8;break;case 8:return e.next=10,this._authenticateWithParams({key:t,secret:n});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"authenticateUsingOauth",value:(s=(0,h.default)(y.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{udid:void 0};return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+M(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "bearerToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+R(t));e.next=4;break;case 4:return n=o.udid,r=void 0===n?(0,w.default)():n,e.next=7,this._authenticateWithParams({bearerToken:t,udid:r});case 7:return a=e.sent,e.abrupt("return",a);case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"_authenticateWithParams",value:(i=(0,h.default)(y.default.mark(function e(t){var n;return y.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._setAuth(t),e.prev=1,e.next=4,this.users.findMe();case 4:return n=e.sent,this._setCurrentUser(n),this.emit("signedIn",n,t),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(1),this._removeAuth(),this._currentUser=null,e.t0;case 15:case"end":return e.stop()}},e,this,[[1,10]])})),function(e){return i.apply(this,arguments)})},{key:"_setCurrentUser",value:function(e){this._currentUser=e}},{key:"_setAuth",value:function(e){this._auth=e,this.httpClient.setAuth(e),this.events.setAuth(e)}},{key:"_removeAuth",value:function(){this._auth=null,this.httpClient.removeAuth(),this.events.removeAuth()}},{key:"getCurrentUser",value:function(){return this._currentUser||null}},{key:"getAuth",value:function(){return this._auth}},{key:"requireUser",value:function(){if(!this.isSignedIn)throw new Z.default.NotSignedInError}},{key:"reactToAdvisoryEvent",value:function(e,t){switch(this.emit("advisory",{type:e,data:t}),e){case"replayStart":this.currentlyServingOfflineMessages=!0,this.emit("messages:offline:start",t),this.products._addProcessingEvent({actionType:E.default.MESSAGE_REPLAY,entity:this.products.getAll()[0],itemsEstimate:t.replayMessageCount});break;case"replayStop":null===this._checkBangTimer&&(this.emit("groups:offline:start"),this._startBangTimer()),this.products._removeProcessingEvent({actionType:E.default.MESSAGE_REPLAY,entity:this.products.getAll()[0]})}}},{key:"modelByTypeNS",value:function(e){return this.MODEL_BY_TYPE_NS[e]}},{key:"modelNameByTypeNS",value:function(e){var t=this.MODEL_BY_TYPE_NS[e];return t?t.name:((0,b.default)(t,"modelNameByTypeNS: Missing class for "+e),null)}},{key:"modelNameByEntityType",value:function(e){var t=this.modelsByEntityType[e]||this.MODEL_BY_TYPE_NS[e];return t?t.name:void(0,b.default)(t,"modelNameByEntityType: Missing class for "+e)}},{key:"ejectModel",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.MODEL_BY_TYPE_NS[t]||this.modelsByEntityType[t];return n?n.eject(e):void(0,b.default)(n,"ejectModel: Missing class for "+t)}},{key:"injectModel",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.MODEL_BY_TYPE_NS[t]||this.modelsByEntityType[t];return n?n.inject(e):((0,b.default)(n,"injectModel: Missing class for "+t),null)}},{key:"injectPlaceholderModel",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.xmlns||e.type,n=this.modelByTypeNS(t)||this.modelsByEntityType[t];return n?n.injectPlaceholder(e):((0,b.default)(n,"injectPlaceholderModel: Missing class for "+t),null)}},{key:"getEntity",value:function(e,t){return this.modelsByEntityType[e].get(t)}},{key:"getEntities",value:function(e){var t=this;return e.map(function(e){return t.getEntity(e.type,e.id)})}},{key:"dispose",value:function(){if(this._stopTicker(),this.conversationsLoaded=!1,null!==this._checkBangTimer&&(clearTimeout(this._checkBangTimer),this._checkBangTimer=null),!(o=this._services)||"function"!=typeof o[C.default]&&!Array.isArray(o))throw new TypeError("Expected _services2 to be iterable, got "+R(o));if(!o||"function"!=typeof o[C.default]&&!Array.isArray(o))throw new TypeError("Expected _services2 to be iterable, got "+M(o));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,G.default)(o);!(e=(r=a.next()).done);e=!0){var o,i=r.value;i.dispose&&i.dispose()}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this.store&&this.store.clear()}},{key:"reset",value:function(){if(this.dispose(),!(o=this._services)||"function"!=typeof o[C.default]&&!Array.isArray(o))throw new TypeError("Expected _services3 to be iterable, got "+R(o));if(!o||"function"!=typeof o[C.default]&&!Array.isArray(o))throw new TypeError("Expected _services3 to be iterable, got "+M(o));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,G.default)(o);!(e=(r=a.next()).done);e=!0){var o,i=r.value;i.mounted&&i.mounted()}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this._startTicker()}},{key:"configure",value:function(e){return/(ihis)/.test(e.apiEnv||this.config.apiEnv)&&(this.config.reportingV2Enabled=!1),(0,U.default)(this.config,e),this.httpClient.mounted(),this}},{key:"setDefaultOrganization",value:function(e){return this.configure({defaultOrganizationId:e})}},{key:"currentUser",get:function(){return this.getCurrentUser()}},{key:"currentUserId",get:function(){var e=this.getCurrentUser();return e?e.id:null}},{key:"isSignedIn",get:function(){return!!this.getAuth()}},{key:"MODEL_BY_TYPE_NS",get:function(){return this._MODEL_BY_TYPE_NS||(this._MODEL_BY_TYPE_NS={"tigertext:entity:account":this.models.User,"tigertext:entity:group":this.models.Group,"tigertext:entity:distribution_list":this.models.DistributionList,"tigertext:entity:list":this.models.DistributionList,"tigertext:entity:tag":this.models.RoleTag,"tigertext:iq:message":this.models.Message,"tigertext:iq:group_message":this.models.Message,"tigertext:iq:group:message":this.models.Message}),this._MODEL_BY_TYPE_NS}},{key:"networkStatus",get:function(){return this.httpClient.networkStatus}},{key:"forgotPasswordUrl",get:function(){return K.default.FORGOT_PASSWORD_URLS[this.config.apiEnv]}},{key:"cnUrl",get:function(){return this.config.localCnUrl?this.config.localCnUrl:K.default.CN_URLS[this.config.apiEnv]}},{key:"adminUrl",get:function(){return this.config.localRolesUrl?this.config.localRolesUrl:K.default.ADMIN_URLS[this.config.apiEnv]}},{key:"rolesUrl",get:function(){return this.config.localRolesUrl?this.config.localRolesUrl:K.default.ROLES_URLS[this.config.apiEnv]}}]),o=a=ne,a.CONSUMER_ORGANIZATION_ID=K.default.CONSUMER_ORGANIZATION_ID,a.errors=Z.default,a.VERSION=te.default,a.version=te.default,o);function ne(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if((0,F.default)(this,ne),this.errors=Z.default,this.VERSION=te.default,this.version=te.default,this._onBrowserUnload=function(){var r=[];n.emit("browserUnload",function(e,t,n){return r.push({fn:e,priority:t,name:n})}),(0,L.default)(r,["priority"],["desc"]).forEach(function(e){var t=e.fn,n=e.priority,r=e.name;console.log("[unload]",n,r),t()})},this._onDisconnected=function(e){var t=e.isRecoverable;t||n._removeAuth(),n.emit("events:disconnected",{isRecoverable:t})},this._onTick=function(){n.__tickerFrame=(0,B.default)(function(){try{n.emit("tick")}finally{n.__ticker=setTimeout(n._onTick,5e3)}})},this._resetLastBang=function(){n._bangOccurredDuringReplay=!0},this._startBangTimer=function(){n._bangOccurredDuringReplay=!1,n._checkBangTimer=setTimeout(n._didBangOccur,n.config.detectBangReplayTimeout)},this._didBangOccur=function(){n._bangOccurredDuringReplay?n._startBangTimer():(n._checkBangTimer=null,n._bangReplayDone())},this._bangReplayDone=function(){n.currentlyServingOfflineMessages&&(n.currentlyServingOfflineMessages=!1,n.emit("conversations:loading:start"),n.conversations.hasPendingReloads()&&n.conversations.__flushConversationsToReload(),n.emit("groups:offline:stop"),n.emit("messages:offline:stop"),n.emit("conversations:loading:stop"),n.emit("messages:new:start"))},!(null==e||e instanceof Object))throw new TypeError('Value of argument "originalConfig" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+M(e));if(!(null==e||e instanceof Object))throw new TypeError('Value of argument "originalConfig" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+R(e));this.config=(0,U.default)({},e),(0,D.default)(this.config,K.default.CONFIG_DEFAULT);var t=this.config,r=t.apiEnv,a=t.logLevel;if(this.config.cloudfront=K.default.CLOUDFRONT[r],/(env\d+|lt\d*)/.test(r)&&(this.config.cloudfront=K.default.CLOUDFRONT.development,K.default.BASE_URLS[this.config.apiEnv]="https://"+r+"-devapi.tigertext.xyz",K.default.FORGOT_PASSWORD_URLS[this.config.apiEnv]="https://"+r+"-forget.tigertext.com",K.default.CN_URLS[this.config.apiEnv]="https://"+r+"-console.tigertext.xyz",K.default.ADMIN_URLS[this.config.apiEnv]=K.default.CN_URLS[r]+"/app/admin",K.default.ROLES_URLS[this.config.apiEnv]="/"+r+"/app/roles/index.html"),/(ihis)/.test(r)&&(this.config.reportingV2Enabled=!1),this.config.baseUrl||(this.config.baseUrl=K.default.BASE_URLS[r]),this.config.autoSignOutOnBrowserUnload=!1,(0,U.default)(this,{attachments:ee.attachments,email:ee.email,phone:ee.phone}),this.httpClient=new H.default({config:this.config,logger:new W.default({name:"HttpClient",level:a})}),this.enums=(0,N.default)({},X,{NetworkStatus:Q.default}),this.store=new J.default(this,{logger:new W.default({name:"Store",level:a})}),this.store.defineModels(),this.models=this.store.models,this.modelsByEntityType=(0,$.default)(this.store.models,function(e,t){return ee.Camelizer.camelizeKey(t)}),this.modelsByEntityType.account=this.modelsByEntityType.user,this.modelsByEntityType.list=this.modelsByEntityType.distributionList,this.allModelEntityTypes=(0,V.default)(this.modelsByEntityType),this.logger=new W.default({name:"TigerConnectClient",level:a}),this.api={},!(l=(0,P.default)(q.default))||"function"!=typeof l[C.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+R(l));if(!l||"function"!=typeof l[C.default]&&!Array.isArray(l))throw new TypeError("Expected _Object$entries to be iterable, got "+M(l));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,G.default)(l);!(o=(u=c.next()).done);o=!0){var l,d=(0,z.default)(u.value,2),f=d[0],p=d[1],y=ee.Camelizer.camelizeKey(f);this.api[y]=new p(this,{logger:new W.default({name:f+"API",level:a})})}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}if(this._services=[],!(w=(0,P.default)(Y.default))||"function"!=typeof w[C.default]&&!Array.isArray(w))throw new TypeError("Expected _Object$entries2 to be iterable, got "+R(w));if(!w||"function"!=typeof w[C.default]&&!Array.isArray(w))throw new TypeError("Expected _Object$entries2 to be iterable, got "+M(w));var h=!0,g=!1,v=void 0;try{for(var m,b=(0,G.default)(w);!(h=(m=b.next()).done);h=!0){var w,E=(0,z.default)(m.value,2),x=(f=E[0],p=E[1],ee.Camelizer.camelizeKey(f)),_=new p(this,{logger:new W.default({name:f+"Service",level:this.config.serviceLogLevels[x]||a})});this[x]=_,this._services.push(_)}}catch(e){g=!0,v=e}finally{try{!h&&b.return&&b.return()}finally{if(g)throw v}}if(!(j=this._services)||"function"!=typeof j[C.default]&&!Array.isArray(j))throw new TypeError("Expected _services to be iterable, got "+R(j));if(!j||"function"!=typeof j[C.default]&&!Array.isArray(j))throw new TypeError("Expected _services to be iterable, got "+M(j));var k=!0,A=!1,T=void 0;try{for(var I,O=(0,G.default)(j);!(k=(I=O.next()).done);k=!0){var j,S=I.value;S.mounted&&S.mounted()}}catch(e){A=!0,T=e}finally{try{!k&&O.return&&O.return()}finally{if(A)throw T}}this._listenToEvents(),this._startTicker(),this.on("browserUnload",function(e){return e(function(){n.config.autoSignOutOnBrowserUnload&&(n.notifications.disconnect(),n.signOut({async:!1,resetClient:!1}))},100,"signOut")}),this._checkBangTimer=null,this.conversationsLoaded=!1,this.currentlyServingOfflineMessages=!1}(0,U.default)(x.prototype,m.default.prototype),t.default=x,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){i.default.call(this),this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this._close=void 0,function(l,a,e){a=String(a);function o(e,t,n){if(m===G)if(200===e&&void 0!==n&&D.test(n)){m=C,h=!0,y=d,l.readyState=C;var r=new j.default("open");l.dispatchEvent(r),Z(l,l.onopen,r)}else{var a="";a=200!==e?"EventSource's response has a status "+e+" "+(t=t&&t.replace(/\s+/g," "))+" that is not 200. Aborting the connection.":"EventSource's response has a Content-Type specifying an unsupported type: "+(void 0===n?"-":n.replace(/\s+/g," "))+". Aborting the connection.",(0,R.default)(new Error(a)),T();var o=new j.default("error");o.status=e,o.statusText=t,l.dispatchEvent(o),Z(l,l.onerror,o)}}function i(e){if(m===C){for(var t=-1,n=0;n<e.length;n+=1){var r=e.charCodeAt(n);r!=="\n".charCodeAt(0)&&r!=="\r".charCodeAt(0)||(t=n)}var a=(-1!==t?x:"")+e.slice(0,t+1);x=(-1===t?x:"")+e.slice(t+1),""!==a&&(h=!0);for(var o=0;o<a.length;o+=1){var i=a.charCodeAt(o);if(_===V&&i==="\n".charCodeAt(0))_=N;else if(_===V&&(_=N),i==="\r".charCodeAt(0)||i==="\n".charCodeAt(0)){if(_!==N){_===U&&(A=o+1);var s=a.slice(k,A-1),u=a.slice(A+(A<o&&a.charCodeAt(A)===" ".charCodeAt(0)?1:0),o);"data"===s?(b+="\n",b+=u):"id"===s?w=u:"event"===s?E=u:"retry"===s?(d=B(u,d),y=d):"heartbeatTimeout"===s&&(f=B(u,f),0!==v&&(clearTimeout(v),v=setTimeout(function(){I()},f)))}if(_===N){if(""!==b){p=w,""===E&&(E="message");var c=new S.default(E,{data:b.slice(1),lastEventId:w});if(l.dispatchEvent(c),"message"===E&&Z(l,l.onmessage,c),m===P)return}E=b=""}_=i==="\r".charCodeAt(0)?V:N}else _===N&&(k=o,_=U),_===U?i===":".charCodeAt(0)&&(A=o+1,_=F):_===F&&(_=L)}}}function s(){if(m===C||m===G){m=z,0!==v&&(clearTimeout(v),v=0),v=setTimeout(function(){I()},y),y=q(Math.min(16*d,2*y)),l.readyState=G;var e=new j.default("error");l.dispatchEvent(e),Z(l,l.onerror,e)}}var u=void 0!==e&&Boolean(e.withCredentials),d=q(1e3),f=void 0!==e&&void 0!==e.heartbeatTimeout?B(e.heartbeatTimeout,45e3):q(45e3),p="",y=d,h=!1,c=void 0!==e&&void 0!==e.headers?JSON.parse((0,O.default)(e.headers)):void 0,t=void 0!==e&&void 0!==e.Transport?e.Transport:void 0!==$?$:XMLHttpRequest,g=new M.default(new t),v=0,m=z,b="",w="",E="",x="",_=N,k=0,A=0,T=function(){m=P,g.cancel(),0!==v&&(clearTimeout(v),v=0),l.readyState=P},I=function e(){if(v=0,m===z){h=!1,v=setTimeout(function(){e()},f),m=G,w=p,x=E=b="",A=k=0,_=N;var t=a;"data:"!==a.slice(0,5)&&"blob:"!==a.slice(0,5)&&(t=a+(-1===a.indexOf("?",0)?"?":"&")+"lastEventId="+encodeURIComponent(p));var n={Accept:"text/event-stream"};if(void 0!==c)for(var r in c)Object.prototype.hasOwnProperty.call(c,r)&&(n[r]=c[r]);try{g.open(o,i,s,t,u,n)}catch(e){throw T(),e}}else h?(h=!1,v=setTimeout(function(){e()},f)):(console.log("No activity within "+f+" milliseconds. Reconnecting."),g.cancel())};l.url=a,l.readyState=G,l.withCredentials=u,l._close=T,I()}(this,e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.NativeEventSource=t.EventSourcePolyfill=void 0;var o=r(n(52)),O=r(n(3)),j=r(n(45)),i=r(n(62)),S=r(n(63)),R=r(n(46)),M=r(n(64)),z=-1,G=0,C=1,P=2,V=-1,N=0,U=1,F=2,L=3,$=global.XDomainRequest,D=/^text\/event\-stream?(\s*charset\=utf\-8)?$/i,B=function(e,t){var n=parseInt(e,10);return isNaN(n)&&(n=t),q(n)},q=function(e){return Math.min(Math.max(e,1e3),18e6)},Z=function(e,t,n){try{"function"==typeof t&&t.call(e,n)}catch(e){(0,R.default)(e)}};(a.prototype=(0,o.default)(i.default.prototype)).CONNECTING=G,a.prototype.OPEN=C,a.prototype.CLOSED=P,a.prototype.close=function(){this._close()},a.CONNECTING=G,a.OPEN=C,a.CLOSED=P,a.prototype.withCredentials=void 0;var s=global.EventSource;t.default=a,t.EventSourcePolyfill=a,t.NativeEventSource=s},function(e,t,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function I(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=I(t[0],n);return t.every(function(e){return I(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return I(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+I(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function O(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=O(t[0],n);return t.every(function(e){return O(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return O(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+O(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var r,a,o,i,u=n(s(3)),c=n(s(7)),l=n(s(8)),j=n(s(28)),S=n(s(15)),R=n(s(21)),M=n(s(12)),z=n(s(13)),G=n(s(23)),C=n(s(20)),P=n(s(10)),d=n(s(9)),f=n(s(1)),p=n(s(2)),V=n(s(24)),y=n(s(83)),h=n(s(34)),g=n(s(241)),v=s(18),N=n(s(245)),m=n(s(246)),b=n(s(66)),U=n(s(96)),F=n(s(17)),L=n(s(47)),w=[F.default.PermissionDeniedError.CODE,F.default.WrongCredentialsError.CODE],E=s(247),x=((0,p.default)(_,[{key:"mounted",value:function(){this._prefixBaseUrl=(0,m.default)(this.config.baseUrl)}},{key:"setAuth",value:function(e){this._auth=e}},{key:"removeAuth",value:function(){this._auth=null}},{key:"getAuthForKeyAndSecret",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(t));if("string"!=typeof e)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(e));if("string"!=typeof t)throw new TypeError('Value of argument "secret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(t));return e&&t?(0,y.default)(e+":"+t):null}},{key:"getAuthHeaders",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._auth,t=arguments[1];if(!e)return{};var n={};if(e.key&&e.secret)n.Authorization="Basic "+this.getAuthForKeyAndSecret(e.key,e.secret);else{if(!e.bearerToken||!e.udid)return{};n.Authorization="Bearer "+e.bearerToken,n["X-Device-ID"]=e.udid}return t&&(n["TT-X-Features"]=t),n}},{key:"getAuthQueryParams",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._auth,t=arguments[1];if(!e)return"";var n=e.basicAuthParam,r=void 0===n?"auth_basic":n,a={};if(e.key&&e.secret)a[r]=this.getAuthForKeyAndSecret(e.key,e.secret);else{if(!e.bearerToken||!e.udid)return"";a.auth_bearer=e.bearerToken,a.udid=e.udid}var o=g.default.stringify(a);return t&&(o=o+"&features="+t),o}},{key:"_contentType",value:function(e){switch(e){case"json":return"application/json";case"event-stream":return"text/event-stream";case"text":default:return"plain/text"}}},{key:"downloadFileBlob",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(e));if("string"!=typeof e)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(e));F.default.TargetNotSupportedError.raise()}},{key:"downloadToFile",value:function(e,t){var o=this,i=s(53);return new C.default(function(n,r){var a=o.config.baseUrl+e;s(243)({url:a,headers:o.getAuthHeaders()},function(e,t){e||t&&t.statusCode<200||299<t.statusCode?r(new Error("Failed downloading "+a+". Error: "+e.message+" | Status: "+(t?t.statusCode:null))):n()}).pipe(i.createWriteStream(t))})}},{key:"_watchNetworkConnection",value:function(){this.networkStatus=L.default.ONLINE}},{key:"_setNetworkStatus",value:function(e){e!==this.networkStatus&&(e===L.default.UNREACHABLE&&this.networkStatus===L.default.OFFLINE||(this.networkStatus=e,this.emit("networkStatus:change",{networkStatus:this.networkStatus})))}},{key:"isUnauthorizedError",value:function(e){return e&&w.includes(e.code)}},{key:"createEventSource",value:function(n,e){var r=this,t=e.auth,a=void 0===t?this._auth:t,o=e.features,i=(e.heartbeatTimeout,e.onOpen),s=e.onMessage,u=e.onError,c=e.onClose;if(e.wantNative,"string"!=typeof n)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+O(n));if(null==e||void 0!==e.features&&null!=e.features&&"string"!=typeof e.features||void 0!==e.onOpen&&null!=e.onOpen&&"function"!=typeof e.onOpen||void 0!==e.onMessage&&null!=e.onMessage&&"function"!=typeof e.onMessage||void 0!==e.onError&&null!=e.onError&&"function"!=typeof e.onError||void 0!==e.onClose&&null!=e.onClose&&"function"!=typeof e.onClose||void 0!==e.wantNative&&null!=e.wantNative&&"boolean"!=typeof e.wantNative)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  features?: ?string;\n  onOpen?: ?Function;\n  onMessage?: ?Function;\n  onError?: ?Function;\n  onClose?: ?Function;\n  wantNative?: ?boolean;\n}\n\nGot:\n"+O(e));if("string"!=typeof n)throw new TypeError('Value of argument "path" violates contract.\n\nExpected:\nstring\n\nGot:\n'+I(n));if(null==e||void 0!==e.features&&null!=e.features&&"string"!=typeof e.features||void 0!==e.onOpen&&null!=e.onOpen&&"function"!=typeof e.onOpen||void 0!==e.onMessage&&null!=e.onMessage&&"function"!=typeof e.onMessage||void 0!==e.onError&&null!=e.onError&&"function"!=typeof e.onError||void 0!==e.onClose&&null!=e.onClose&&"function"!=typeof e.onClose||void 0!==e.wantNative&&null!=e.wantNative&&"boolean"!=typeof e.wantNative)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  features?: ?string;\n  onOpen?: ?Function;\n  onMessage?: ?Function;\n  onError?: ?Function;\n  onClose?: ?Function;\n  wantNative?: ?boolean;\n}\n\nGot:\n"+I(e));var l=this.getAuthQueryParams(a,o),d=/https?:/.test(n)?n:this.config.baseUrl+n;""!==l&&(d=d+"?"+l),(0,S.default)({},this.getAuthHeaders(a,o),"TT-Route-Xmpp"===this.config.ttRoute?{"TT-Route-Xmpp":"true"}:null);var f=new E(d,{}),p=f.once?f.once.bind(f):function(t,n){f.addEventListener(t,function e(){n.apply(void 0,arguments),f.removeEventListener(t,e)})};return this.networkStatus===L.default.UNREACHABLE&&this._setNetworkStatus(L.default.CONNECTING),p("open",function(){r._setNetworkStatus(L.default.ONLINE),i&&i()}),p("error",function(e){var t=new Error("Could not establish EventSource connection");e&&(t.status=e.status),t.status?401===t.status?(t=new F.default.WrongCredentialsError,r.emit("auth:invalid")):403===t.status&&(t=new F.default.PermissionDeniedError(n,"403","get"),r.emit("auth:invalid")):r._setNetworkStatus(L.default.UNREACHABLE),u&&u(t)}),c&&p("close",c),s&&f.addEventListener("message",s),f}},{key:"isSignedIn",get:function(){return!!this._auth}}]),a=r=_,r.EventSourcePolyfill=b.default,a);function _(e){var t=e.config,n=e.logger;(0,f.default)(this,_),this.EventSourcePolyfill=b.default,this.downloadFileBlobAndUrl=function(){return F.default.TargetNotSupportedError.raise()},this.config=t,this.logger=n,this._prefixBaseUrl=(0,m.default)(this.config.baseUrl),this._watchNetworkConnection()}["get","post","put","patch","del"].forEach(function(T){var t;x.prototype[T]=(t=(0,d.default)(P.default.mark(function e(c){var t,n,r,a,o,i,s,u,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k=this,A=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((A=(0,V.default)(A||{},{reqFormat:"json",resFormat:"json",withCredentials:!0,withHeaders:!0})).urlParams&&(c=c.replace(/:([\w\-]+)/g,function(e,t){return encodeURIComponent(A.urlParams[t])})),this.logger&&this.logger.info("start",T.toUpperCase(),c,A),(t=(0,S.default)({},A.headers,"TT-Route-Xmpp"===this.config.ttRoute?{"TT-Route-Xmpp":"true"}:null)).Accept=t.Accept||this._contentType(A.resFormat),A.requestId&&(t["Request-ID"]=A.requestId),"Authorization"in t||(0,j.default)(t,this.getAuthHeaders(A.auth)),n=N.default[T](c).use(this._prefixBaseUrl).query(A.query||{}),A.withCredentials&&(n=n.withCredentials()),!1!==A.retry&&(n=n.retry(A.retryCount||3)),!1!==A.timeout&&(n=n.timeout(!0===A.timeout?1e4:A.timeout)),r=void 0,(a=A.files&&(0,G.default)(A.files))&&0<a.length?(r=new U.default,t["Content-Type"]=r.getContentType()):t["Content-Type"]=t["Content-Type"]||this._contentType(A.reqFormat),A.withHeaders&&(n=n.set(t)),!r){e.next=73;break}if(o=[],!A.data){e.next=42;break}if(!(f=(0,G.default)(A.data))||"function"!=typeof f[z.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$entries2 to be iterable, got "+I(f));e.next=21;break;case 21:if(!f||"function"!=typeof f[z.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$entries2 to be iterable, got "+O(f));e.next=23;break;case 23:for(s=!(i=!0),u=void 0,e.prev=26,l=(0,M.default)(f);!(i=(d=l.next()).done);i=!0)p=(0,R.default)(d.value,2),y=p[0],h=p[1],o.push(r.appendField(y,h));e.next=34;break;case 30:e.prev=30,e.t0=e.catch(26),s=!0,u=e.t0;case 34:e.prev=34,e.prev=35,!i&&l.return&&l.return();case 37:if(e.prev=37,s)throw u;e.next=40;break;case 40:return e.finish(37);case 41:return e.finish(34);case 42:if(!a||"function"!=typeof a[z.default]&&!Array.isArray(a))throw new TypeError("Expected fileEntries to be iterable, got "+I(a));e.next=44;break;case 44:if(!a||"function"!=typeof a[z.default]&&!Array.isArray(a))throw new TypeError("Expected fileEntries to be iterable, got "+O(a));e.next=46;break;case 46:for(v=!(g=!0),m=void 0,e.prev=49,b=(0,M.default)(a);!(g=(w=b.next()).done);g=!0)E=(0,R.default)(w.value,2),y=E[0],x=E[1],o.push(r.appendFile(y,x));e.next=57;break;case 53:e.prev=53,e.t1=e.catch(49),v=!0,m=e.t1;case 57:e.prev=57,e.prev=58,!g&&b.return&&b.return();case 60:if(e.prev=60,v)throw m;e.next=63;break;case 63:return e.finish(60);case 64:return e.finish(57);case 65:return e.next=67,C.default.all(o);case 67:return e.next=69,r.getPayload(r);case 69:_=e.sent,n=n.send(_),e.next=74;break;case 73:n=n.send(A.data);case 74:return e.abrupt("return",new C.default(function(s,u){n.end(function(e,t){var n=(t||{}).headers;if(e)if(k.logger&&k.logger.info("error",T.toUpperCase(),c,e),e.status)if(401===e.status)k.emit("auth:invalid"),u(new F.default.WrongCredentialsError(n));else if(403===e.status){var r=(A.urlParams||{}).userId,a=void 0===r?"403":r;u(new F.default.PermissionDeniedError(c,a,T))}else u(e);else k._setNetworkStatus(L.default.UNREACHABLE),u(new F.default.ConnectionUnavailableError);else switch(k._setNetworkStatus(L.default.ONLINE),A.resFormat){case"json":var o=t.body||{};"reply"in o&&(o=o.reply);var i={data:o,headers:n,getHeader:function(e){return n[e.toLowerCase()]},status:t.status};k.logger&&k.logger.info("success",T.toUpperCase(),c,i),s(i);break;default:k.logger&&k.logger.info("success",T.toUpperCase(),c,t.text?t.text.substr(0,80)+"...":"[null]"),s(t.text)}})}));case 75:case"end":return e.stop()}},e,this,[[26,30,34,42],[35,,37,41],[49,53,57,65],[58,,60,64]])})),function(e){return t.apply(this,arguments)})}),o=x.prototype.get,i=(0,v.decorator)(o),x.prototype.get=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return t.reusePromise?i.call(this,e,t):o.call(this,e,t)},(0,j.default)(x.prototype,h.default.prototype),t.default=x,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function g(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=g(t[0],n);return t.every(function(e){return g(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return g(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+g(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function v(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=v(t[0],n);return t.every(function(e){return v(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return v(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+v(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i,s=r(n(7)),m=r(n(10)),b=r(n(3)),w=r(n(8)),E=r(n(12)),x=r(n(13)),u=r(n(9)),c=r(n(1)),l=r(n(2)),d=n(239),f=n(37),p=r(n(67)),y=["application/json","text/plain"],h=((0,l.default)(_,[{key:"appendField",value:(i=(0,u.default)(m.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(h)){e.next=43;break}if(n=0,!h||"function"!=typeof h[x.default]&&!Array.isArray(h))throw new TypeError("Expected fieldValue to be iterable, got "+g(h));e.next=4;break;case 4:if(!h||"function"!=typeof h[x.default]&&!Array.isArray(h))throw new TypeError("Expected fieldValue to be iterable, got "+v(h));e.next=6;break;case 6:a=!(r=!0),o=void 0,e.prev=9,i=(0,E.default)(h);case 11:if(r=(s=i.next()).done){e.next=27;break}if(u=s.value,"data"!==t||"object"!==(void 0===u?"undefined":(0,w.default)(u))){e.next=22;break}if(c=u.mimetype,l=void 0===c?"application/json":c,d=u.namespace,f=u.payload,p=void 0===f?"":f,d){e.next=17;break}throw new Error("Missing namespace on data["+n+"] object");case 17:y={"TT-X-Namespace":d},this._appendParsedField(t,{fieldValue:String(p),mimetype:l,filename:null,headers:y}),e.next=23;break;case 22:this.appendField(t,u);case 23:n++;case 24:r=!0,e.next=11;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(9),a=!0,o=e.t0;case 33:e.prev=33,e.prev=34,!r&&i.return&&i.return();case 36:if(e.prev=36,a)throw o;e.next=39;break;case 39:return e.finish(36);case 40:return e.finish(33);case 41:e.next=45;break;case 43:h&&h.nodeType&&h.nodeName&&h.getAttribute&&(h=h.value),"object"===(void 0===h?"undefined":(0,w.default)(h))?this._appendParsedField(t,{fieldValue:(0,b.default)(h),mimetype:"application/json"}):this._appendParsedField(t,{fieldValue:String(h),mimetype:"text/plain"});case 45:case"end":return e.stop()}},e,this,[[9,29,33,41],[34,,36,40]])})),function(e){return i.apply(this,arguments)})},{key:"_appendParsedField",value:function(e,t){var n=t.fieldValue,r=t.filename,a=t.headers,o=t.mimetype,i=this.body.fields;r?r=(0,f.doubleEncodeUtf8)(r):n=(0,f.doubleEncodeUtf8)(n),y.includes(o)&&(o+='; charset="utf-8"');var s=new d.RequestField(n,o,r,a);i.hasOwnProperty(e)?(Array.isArray(i[e])||(i[e]=[i[e]]),i[e].push(s)):i[e]=s}},{key:"appendFile",value:(o=(0,u.default)(m.default.mark(function e(t,n){var r;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r="",n)return e.next=4,(0,p.default)(n,{idx:this.fileIdx++});e.next=5;break;case 4:r=e.sent;case 5:this._appendParsedField(t,r);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"getContentType",value:function(){return this.body.getContentType()}},{key:"getPayload",value:(a=(0,u.default)(m.default.mark(function e(){return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.body.toString());case 4:e.next=7;break;case 7:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})}]),_);function _(){(0,c.default)(this,_),this.body=new d.RequestBody,this.fileIdx=0,this.body.setType("multipart")}t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.HttpClient=t.EventSourcePolyfill=t.readFile=t.encoding=void 0;var a=r(n(37)),o=r(n(67)),i=r(n(66)),s=r(n(95));t.encoding=a.default,t.readFile=o.default,t.EventSourcePolyfill=i.default,t.default=s.default,t.HttpClient=s.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,l.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.LOG_LEVELS=t.default=void 0;var u=r(n(3)),c=r(n(7)),l=r(n(8)),o=r(n(29)),a=r(n(1)),d=((0,r(n(2)).default)(f,[{key:"setLevel",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));if(this.level=e.toLowerCase(),"string"!=typeof this.level)throw new TypeError('Value of "this.level" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(this.level))}}]),f);function f(e){var t=e.name,n=e.level;if((0,a.default)(this,f),null==e||"string"!=typeof e.name||"string"!=typeof e.level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+s(e));if(null==e||"string"!=typeof e.name||"string"!=typeof e.level)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  name: string;\n  level: string;\n}\n\nGot:\n"+i(e));this.name=t,this.level=n}t.default=d;var p=t.LOG_LEVELS=["debug","log","info","warn","error"],y=p.reduce(function(e,t,n){return e[t]=n,e},{});p.forEach(function(r){var a=y[r];d.prototype[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a>=y[this.level]&&(t=["["+this.name+"]"].concat((0,o.default)(t)),Function.prototype.apply.call(console[r],console,t))}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,u.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u=r(n(3)),c=r(n(7)),f=r(n(8)),p=r(n(10)),y=r(n(9)),h=r(n(4)),g=r(n(1)),v=r(n(2)),m=r(n(6)),b=r(n(5)),w=r(n(16)),E=(a=w.default,(0,b.default)(x,a),(0,v.default)(x,[{key:"find",value:(s=(0,y.default)(p.default.mark(function e(t){var n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=4;break;case 4:return e.next=6,this.httpClient.get("/v5/conversation/:id",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"updateConversationStatus",value:(i=(0,y.default)(p.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=o.highestSortNumber,s=o.lowestSortNumber;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=8;break;case 8:return r={status:n},i&&(r.highest_sort_number=i),s&&(r.lowest_sort_number=s),e.next=13,this.httpClient.post("/v5/conversation/:id/status",{urlParams:{id:t},data:r});case 13:return a=e.sent,e.abrupt("return",a.data);case 15:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"fetchTimeline",value:(o=(0,y.default)(p.default.mark(function e(t,n,r,a){var o,i=a.continuation,s=a.markAsDelivered,u=void 0!==s&&s,c=arguments;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "anchorPoint" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(n));e.next=4;break;case 4:if("number"!=typeof r)throw new TypeError('Value of argument "maxItems" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+d(r));e.next=6;break;case 6:if(null==c[3]||!(null==c[3].continuation||c[3].continuation instanceof Object)||null!=c[3].markAsDelivered&&"boolean"!=typeof c[3].markAsDelivered)throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{\n  continuation: ?Object;\n  markAsDelivered: ?boolean;\n}\n\nGot:\n"+d(c[3]));e.next=8;break;case 8:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=10;break;case 10:if("string"!=typeof n)throw new TypeError('Value of argument "anchorPoint" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=12;break;case 12:if("number"!=typeof r)throw new TypeError('Value of argument "maxItems" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+l(r));e.next=14;break;case 14:if(null==c[3]||!(null==c[3].continuation||c[3].continuation instanceof Object)||null!=c[3].markAsDelivered&&"boolean"!=typeof c[3].markAsDelivered)throw new TypeError("Value of argument 3 violates contract.\n\nExpected:\n{\n  continuation: ?Object;\n  markAsDelivered: ?boolean;\n}\n\nGot:\n"+l(c[3]));e.next=16;break;case 16:return e.next=18,this.httpClient.post("/v5/conversation/:id/timeline",{urlParams:{id:t},data:{anchor_point:n,continuation:i,mark_as_delivered:u,max_items:r}});case 18:return o=e.sent,e.abrupt("return",o.data);case 20:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return o.apply(this,arguments)})}]),x);function x(){return(0,g.default)(this,x),(0,m.default)(this,(x.__proto__||(0,h.default)(x)).apply(this,arguments))}t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l,d,f,p,y,h,g=r(n(3)),v=r(n(7)),m=r(n(8)),b=r(n(11)),w=r(n(10)),E=r(n(9)),x=r(n(4)),_=r(n(1)),k=r(n(2)),A=r(n(6)),T=r(n(25)),I=r(n(5)),O=n(16),j=r(O),S=O.VERSIONS.VERSION_TWO,R=O.ROUTES.DISTRIBUTION_LIST_FIND,M=(a=(0,O.recoverFromNotFound)(),y=j.default,(0,I.default)(z,y),(0,k.default)(z,[{key:"find",value:(h=(0,E.default)(w.default.mark(function e(t){var n,r,a,o;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:return n=(0,T.default)(z.prototype.__proto__||(0,x.default)(z.prototype),"getVersion",this).call(this,R),r=n.version,a=void 0===r?S:r,e.next=7,this.httpClient.get("/:version/dist_list/:id",{urlParams:{id:t,version:a}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})}]),u=(o=z).prototype,c="find",l=[a],d=(0,b.default)(o.prototype,"find"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(u,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(u,c,p),p=null),o);function z(){return(0,_.default)(this,z),(0,A.default)(this,(z.__proto__||(0,x.default)(z)).apply(this,arguments))}t.default=M,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function f(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=f(t[0],n);return t.every(function(e){return f(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return f(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+f(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function p(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=p(t[0],n);return t.every(function(e){return p(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return p(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+p(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,y,h,g=r(n(3)),v=r(n(7)),m=r(n(8)),b=r(n(11)),w=r(n(10)),E=r(n(9)),x=r(n(4)),_=r(n(1)),k=r(n(2)),A=r(n(6)),T=r(n(25)),I=r(n(5)),O=n(16),j=r(O),S=O.VERSIONS.VERSION_TWO,R=O.ROUTES.ENTITIES_FIND_ALL,M=(a=(0,O.recoverFromNotFound)(),y=j.default,(0,I.default)(z,y),(0,k.default)(z,[{key:"findMulti",value:(h=(0,E.default)(w.default.mark(function e(t){var n,r,a,o,i,s,u=t.users,c=t.metadata,l=t.organizationId,d=arguments;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=d[0]&&Array.isArray(d[0].users)&&d[0].users.every(function(e){return"string"==typeof e})&&Array.isArray(d[0].metadata)&&d[0].metadata.every(function(e){return"string"==typeof e})&&"string"==typeof d[0].organizationId){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  users: Array<string>;\n  metadata: Array<string>;\n  organizationId: string;\n}\n\nGot:\n"+p(d[0]));case 2:if(null!=d[0]&&Array.isArray(d[0].users)&&d[0].users.every(function(e){return"string"==typeof e})&&Array.isArray(d[0].metadata)&&d[0].metadata.every(function(e){return"string"==typeof e})&&"string"==typeof d[0].organizationId){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  users: Array<string>;\n  metadata: Array<string>;\n  organizationId: string;\n}\n\nGot:\n"+f(d[0]));case 4:return n=(0,T.default)(z.prototype.__proto__||(0,x.default)(z.prototype),"getVersion",this).call(this,R),r=n.version,a=void 0===r?S:r,o={"TT-X-Organization-Key":l},i={render_owner_object:"true"},e.next=9,this.httpClient.post("/:version/entities_bulk",{urlParams:{version:a},data:{users:u,metadata:c},headers:o,query:i});case 9:return s=e.sent,e.abrupt("return",s.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})}]),i=(o=z).prototype,s="findMulti",u=[a],c=(0,b.default)(o.prototype,"findMulti"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function z(){return(0,_.default)(this,z),(0,A.default)(this,(z.__proto__||(0,x.default)(z)).apply(this,arguments))}t.default=M,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,f,p,y,h,g,v=r(n(3)),m=r(n(7)),b=r(n(8)),w=r(n(11)),E=r(n(10)),x=r(n(9)),_=r(n(4)),k=r(n(1)),A=r(n(2)),T=r(n(6)),I=r(n(25)),O=r(n(5)),j=n(16),S=r(j),R=j.VERSIONS.VERSION_TWO,M=j.ROUTES.ESCALATION,z=(o=(0,j.recoverFromNotFound)(),i=(0,j.recoverFromNotFound)(),s=(0,j.recoverFromNotFound)(),u=(0,j.recoverFromNotFound)(),f=S.default,(0,O.default)(G,f),(0,A.default)(G,[{key:"escalateMessage",value:(g=(0,x.default)(E.default.mark(function e(t){var n,r,a,o;return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=4;break;case 4:return n=(0,I.default)(G.prototype.__proto__||(0,_.default)(G.prototype),"getVersion",this).call(this,M),r=n.version,a=void 0===r?R:r,e.next=7,this.httpClient.post("/:version/message/:messageId/escalation",{urlParams:{version:a,messageId:t}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"acknowledge",value:(h=(0,x.default)(E.default.mark(function e(t,n){var r,a,o,i,s=n.messageId,u=n.userTokens,c=arguments;return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+d(c[1]));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=6;break;case 6:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+l(c[1]));case 8:return r=(0,I.default)(G.prototype.__proto__||(0,_.default)(G.prototype),"getVersion",this).call(this,M),a=r.version,o=void 0===a?R:a,e.next=11,this.httpClient.post("/:version/message/:messageId/escalation/:escalationId/confirm",{urlParams:{version:o,escalationId:t,messageId:s},data:{confirm_as:u}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"cancel",value:(y=(0,x.default)(E.default.mark(function e(t){var n,r,a;return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=4;break;case 4:return n=(0,I.default)(G.prototype.__proto__||(0,_.default)(G.prototype),"getVersion",this).call(this,M),r=n.version,a=void 0===r?R:r,e.next=7,this.httpClient.del("/:version/message/:messageId/escalation",{urlParams:{version:a,messageId:t}});case 7:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"skip",value:(p=(0,x.default)(E.default.mark(function e(t,n){var r,a,o,i,s=n.messageId,u=n.userTokens,c=arguments;return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(t));e.next=2;break;case 2:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+d(c[1]));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "escalationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=6;break;case 6:if(null!=c[1]&&"string"==typeof c[1].messageId&&Array.isArray(c[1].userTokens)&&c[1].userTokens.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  messageId: string;\n  userTokens: Array<string>;\n}\n\nGot:\n"+l(c[1]));case 8:return r=(0,I.default)(G.prototype.__proto__||(0,_.default)(G.prototype),"getVersion",this).call(this,M),a=r.version,o=void 0===a?R:a,e.next=11,this.httpClient.post("/:version/message/:messageId/escalation/:escalationId/skip",{urlParams:{version:o,escalationId:t,messageId:s},data:{skip_as:u}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})}]),a((c=G).prototype,"escalateMessage",[o],(0,w.default)(c.prototype,"escalateMessage"),c.prototype),a(c.prototype,"acknowledge",[i],(0,w.default)(c.prototype,"acknowledge"),c.prototype),a(c.prototype,"cancel",[s],(0,w.default)(c.prototype,"cancel"),c.prototype),a(c.prototype,"skip",[u],(0,w.default)(c.prototype,"skip"),c.prototype),c);function G(){return(0,k.default)(this,G),(0,T.default)(this,(G.__proto__||(0,_.default)(G)).apply(this,arguments))}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(10)),u=r(n(9)),c=r(n(4)),l=r(n(1)),d=r(n(2)),f=r(n(6)),p=r(n(5)),y=r(n(16)),h=(a=y.default,(0,p.default)(g,a),(0,d.default)(g,[{key:"ack",value:(i=(0,u.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.post("/v2/events/ack",{data:{events:t}});case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"closeAllConnections",value:(o=(0,u.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/v2/events");case 2:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})}]),g);function g(){return(0,l.default)(this,g),(0,f.default)(this,(g.__proto__||(0,c.default)(g)).apply(this,arguments))}t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,E.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,E.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,c,l,d,f,p,y,h,g,v,m,b=r(n(3)),w=r(n(7)),E=r(n(8)),x=r(n(11)),k=r(n(10)),_=r(n(9)),A=r(n(4)),T=r(n(1)),I=r(n(2)),O=r(n(6)),j=r(n(25)),S=r(n(5)),R=n(16),M=r(R),z=R.VERSIONS.VERSION_FIVE,G=R.VERSIONS.VERSION_TWO,C=R.ROUTES.GROUP_ADD_MEMBERS,P=R.ROUTES.GROUP_CREATE,V=R.ROUTES.GROUP_FIND,N=R.ROUTES.GROUP_UPDATE,U=(o=(0,R.recoverFromNotFound)(),i=(0,R.recoverFromNotFound)(),c=(0,R.recoverFromNotFound)(),d=M.default,(0,S.default)(F,d),(0,I.default)(F,[{key:"create",value:(m=(0,_.default)(k.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p=t.avatarFile,y=t.description,h=t.excludeCreator,g=t.isPublic,v=void 0!==g&&g,m=t.memberIds,b=void 0===m?[]:m,w=t.name,E=t.organizationId,x=t.replayHistory,_=void 0!==x&&x;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,j.default)(F.prototype.__proto__||(0,A.default)(F.prototype),"getVersion",this).call(this,P),r=n.version,a=void 0===r?G:r,o={},i={is_public:v,members:b.join(","),name:w,replay_history:_},s={},u={exclude_creator:h},p&&(s.avatar=p),y&&(i.description=y),E&&(o["TT-X-Organization-Key"]=E),e.next=10,this.httpClient.post("/:version/group",{urlParams:{version:a},query:u,headers:o,data:i,files:s});case 10:if(c=e.sent,a===z)return e.abrupt("return",c.data);e.next=13;break;case 13:return l=c.getHeader("TT-X-Group-Avatar"),d=c.getHeader("TT-X-Group-Token"),f={avatarUrl:l,id:d,memberIds:b,name:w,organizationId:E},e.abrupt("return",f);case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"update",value:(v=(0,_.default)(k.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=n.name,d=void 0===l?void 0:l,f=n.avatarFile,p=void 0===f?void 0:f,y=n.replayHistory,h=void 0===y?void 0:y,g=n.memberIds;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,j.default)(F.prototype.__proto__||(0,A.default)(F.prototype),"getVersion",this).call(this,N),a=r.version,o=void 0===a?G:a,i={},s={},void 0!==d&&(i.name=d),void 0!==g&&(i.members=g.join(",")),void 0!==h&&(i.replay_history=h),p&&(s.avatar=p),e.next=9,this.httpClient.post("/:version/group/:id",{urlParams:{id:t,version:o},data:i,files:s});case 9:return u=e.sent,c=u.getHeader("TT-X-Group-Avatar"),e.abrupt("return",{id:t,avatarUrl:c});case 12:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"find",value:(g=(0,_.default)(k.default.mark(function e(t){var n,r,a,o;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return n=(0,j.default)(F.prototype.__proto__||(0,A.default)(F.prototype),"getVersion",this).call(this,V),r=n.version,a=void 0===r?G:r,e.next=7,this.httpClient.get("/:version/group/:id",{urlParams:{id:t,version:a},query:{render_metadata:"true"}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"findAllMemberIds",value:(h=(0,_.default)(k.default.mark(function e(t){var n;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return e.next=6,this.httpClient.get("/v2/group/:id/members",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"destroy",value:(y=(0,_.default)(k.default.mark(function e(t){return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return e.next=6,this.httpClient.del("/v2/group/:id",{urlParams:{id:t}});case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"addMembers",value:(p=(0,_.default)(k.default.mark(function e(t,n){var r,a,o,i;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+u(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+s(n));case 8:return r=(0,j.default)(F.prototype.__proto__||(0,A.default)(F.prototype),"getVersion",this).call(this,C),a=r.version,o=void 0===a?G:a,e.next=11,this.httpClient.post("/:version/group/:id/members",{urlParams:{id:t,version:o},data:{members:n}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"removeMembers",value:(f=(0,_.default)(k.default.mark(function e(t,n){return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+u(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+s(n));case 8:return e.next=10,this.httpClient.post("/v2/group/:id/members/remove",{urlParams:{id:t},data:{members:n}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})}]),a((l=F).prototype,"find",[o],(0,x.default)(l.prototype,"find"),l.prototype),a(l.prototype,"findAllMemberIds",[i],(0,x.default)(l.prototype,"findAllMemberIds"),l.prototype),a(l.prototype,"destroy",[c],(0,x.default)(l.prototype,"destroy"),l.prototype),l);function F(){return(0,T.default)(this,F),(0,O.default)(this,(F.__proto__||(0,A.default)(F)).apply(this,arguments))}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,I.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function k(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=k(t[0],n);return t.every(function(e){return k(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return k(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,I.default)(e))+": "+k(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,m=r(n(7)),b=r(n(8)),w=r(n(11)),A=r(n(10)),T=r(n(20)),I=r(n(3)),O=r(n(15)),E=r(n(9)),j=r(n(4)),x=r(n(1)),S=r(n(2)),R=r(n(6)),M=r(n(25)),z=r(n(5)),G=n(16),C=r(G),P=n(30),V=G.VERSIONS.VERSION_FIVE,N=G.VERSIONS.VERSION_TWO,U=G.ROUTES.MESSAGE_FIND,F=G.ROUTES.MESSAGE_FORWARD,L=G.ROUTES.MESSAGE_SEND,$=G.ROUTES.MESSAGE_UPDATE_RECIPIENT_STATUS_MULTI,D=(o=(0,G.recoverFromNotFound)(),i=(0,G.recoverFromNotFound)(),u=C.default,(0,z.default)(B,u),(0,S.default)(B,[{key:"send",value:(v=(0,E.default)(A.default.mark(function e(t){var n,r,a,o,i,s,u,c,l=t.attachment,d=t.body,f=t.conversationId,p=t.counterPartyId,y=t.deleteOnRead,h=t.escalate,g=t.localId,v=t.metadata,m=t.priority,b=t.recipientOrganizationId,w=t.senderOrganizationId,E=t.ttl,x=arguments;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==x[0]||!(void 0===x[0].attachment||null==x[0].attachment||x[0].attachment instanceof Object||null==x[0].attachment||"string"==typeof x[0].attachment)||"string"!=typeof x[0].body||void 0!==x[0].conversationId&&null!=x[0].conversationId&&"string"!=typeof x[0].conversationId||void 0!==x[0].counterPartyId&&null!=x[0].counterPartyId&&"string"!=typeof x[0].counterPartyId||void 0!==x[0].deleteOnRead&&null!=x[0].deleteOnRead&&"boolean"!=typeof x[0].deleteOnRead||void 0!==x[0].escalate&&null!=x[0].escalate&&"boolean"!=typeof x[0].escalate||"string"!=typeof x[0].localId||!(void 0===x[0].metadata||null==x[0].metadata||x[0].metadata instanceof Object)||void 0!==x[0].priority&&null!=x[0].priority&&"number"!=typeof x[0].priority||void 0!==x[0].recipientOrganizationId&&null!=x[0].recipientOrganizationId&&"string"!=typeof x[0].recipientOrganizationId||"string"!=typeof x[0].senderOrganizationId||void 0!==x[0].ttl&&null!=x[0].ttl&&"number"!=typeof x[0].ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  conversationId?: ?string;\n  counterPartyId?: ?string;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId: string;\n  ttl?: ?number;\n}\n\nGot:\n"+k(x[0]));e.next=2;break;case 2:if(null==x[0]||!(void 0===x[0].attachment||null==x[0].attachment||x[0].attachment instanceof Object||null==x[0].attachment||"string"==typeof x[0].attachment)||"string"!=typeof x[0].body||void 0!==x[0].conversationId&&null!=x[0].conversationId&&"string"!=typeof x[0].conversationId||void 0!==x[0].counterPartyId&&null!=x[0].counterPartyId&&"string"!=typeof x[0].counterPartyId||void 0!==x[0].deleteOnRead&&null!=x[0].deleteOnRead&&"boolean"!=typeof x[0].deleteOnRead||void 0!==x[0].escalate&&null!=x[0].escalate&&"boolean"!=typeof x[0].escalate||"string"!=typeof x[0].localId||!(void 0===x[0].metadata||null==x[0].metadata||x[0].metadata instanceof Object)||void 0!==x[0].priority&&null!=x[0].priority&&"number"!=typeof x[0].priority||void 0!==x[0].recipientOrganizationId&&null!=x[0].recipientOrganizationId&&"string"!=typeof x[0].recipientOrganizationId||"string"!=typeof x[0].senderOrganizationId||void 0!==x[0].ttl&&null!=x[0].ttl&&"number"!=typeof x[0].ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachment?: ?Object | ?string;\n  body: string;\n  conversationId?: ?string;\n  counterPartyId?: ?string;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId: string;\n  ttl?: ?number;\n}\n\nGot:\n"+_(x[0]));e.next=4;break;case 4:return n=(0,M.default)(B.prototype.__proto__||(0,j.default)(B.prototype),"getVersion",this).call(this,L),r=n.version,o={body:d},i={},s={},(a=void 0===r?N:r)===N?((0,P.isEmail)(p)&&(p=p.toLowerCase()),o.recipient=p,i.response_format="message",b=b||w,w&&(o.sender_organization=w),b&&(o.recipient_organization=b)):a===V&&(o.conversation_id=f),v&&(o.data=v.map(function(e){return(0,O.default)({},e,{payload:(0,I.default)(e.payload)})})),l&&(s.attachment=l),y&&(o.dor=y),h&&(o.escalate=h),void 0!==m&&(o.priority=m),E&&(o.ttl=E),e.prev=15,e.next=18,this.httpClient.post("/:version/message",{urlParams:{version:a},data:o,files:s,query:i,requestId:g,timeout:!l});case 18:return u=e.sent,e.abrupt("return",u.data);case 22:if(e.prev=22,e.t0=e.catch(15),304!==e.t0.status)return e.abrupt("return",T.default.reject(e.t0));e.next=26;break;case 26:if(c=e.t0.response.headers["TT-X-Message-Id".toLowerCase()]){e.next=29;break}return e.abrupt("return",T.default.reject(e.t0));case 29:return e.abrupt("return",{message_id:c});case 30:case"end":return e.stop()}},e,this,[[15,22]])})),function(e){return v.apply(this,arguments)})},{key:"destroy",value:(g=(0,E.default)(A.default.mark(function e(t){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=4;break;case 4:return e.prev=4,e.next=7,this.httpClient.del("/v2/message/:id",{urlParams:{id:t}});case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this,[[4,10]])})),function(e){return g.apply(this,arguments)})},{key:"startTyping",value:(h=(0,E.default)(A.default.mark(function e(t,n){var r;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+k(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=6;break;case 6:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+_(n));e.next=8;break;case 8:return r={recipient:t},n&&(r.proxy_token=n),e.next=12,this.httpClient.post("/v2/message/typing",{data:r});case 12:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"stopTyping",value:(y=(0,E.default)(A.default.mark(function e(t,n){return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+k(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "recipientId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=6;break;case 6:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+_(n));e.next=8;break;case 8:if(n)return e.next=11,this.httpClient.del("/v2/message/typing/:recipientId/:senderId",{urlParams:{recipientId:t,senderId:n}});e.next=13;break;case 11:e.next=15;break;case 13:return e.next=15,this.httpClient.del("/v2/message/typing/:recipientId",{urlParams:{recipientId:t}});case 15:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"forward",value:(p=(0,E.default)(A.default.mark(function e(t,n,r){var a,o,i,s,u,c,l=r.conversationId,d=r.localId,f=r.metadata,p=r.priority,y=r.recipientOrganizationId,h=r.senderOrganizationId,g=arguments;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(t));e.next=2;break;case 2:if(void 0!==n&&null!=n&&"string"!=typeof n)throw new TypeError('Value of optional argument "counterPartyId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+k(n));e.next=4;break;case 4:if(null==g[2]||void 0!==g[2].conversationId&&null!=g[2].conversationId&&"string"!=typeof g[2].conversationId||"string"!=typeof g[2].localId||!(void 0===g[2].metadata||null==g[2].metadata||g[2].metadata instanceof Object)||void 0!==g[2].priority&&null!=g[2].priority&&"number"!=typeof g[2].priority||void 0!==g[2].recipientOrganizationId&&null!=g[2].recipientOrganizationId&&"string"!=typeof g[2].recipientOrganizationId||void 0!==g[2].senderOrganizationId&&null!=g[2].senderOrganizationId&&"string"!=typeof g[2].senderOrganizationId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  conversationId?: ?string;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId?: ?string;\n}\n\nGot:\n"+k(g[2]));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=8;break;case 8:if(void 0!==n&&null!=n&&"string"!=typeof n)throw new TypeError('Value of optional argument "counterPartyId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+_(n));e.next=10;break;case 10:if(null==g[2]||void 0!==g[2].conversationId&&null!=g[2].conversationId&&"string"!=typeof g[2].conversationId||"string"!=typeof g[2].localId||!(void 0===g[2].metadata||null==g[2].metadata||g[2].metadata instanceof Object)||void 0!==g[2].priority&&null!=g[2].priority&&"number"!=typeof g[2].priority||void 0!==g[2].recipientOrganizationId&&null!=g[2].recipientOrganizationId&&"string"!=typeof g[2].recipientOrganizationId||void 0!==g[2].senderOrganizationId&&null!=g[2].senderOrganizationId&&"string"!=typeof g[2].senderOrganizationId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  conversationId?: ?string;\n  localId: string;\n  metadata?: ?Object;\n  priority?: ?number;\n  recipientOrganizationId?: ?string;\n  senderOrganizationId?: ?string;\n}\n\nGot:\n"+_(g[2]));e.next=12;break;case 12:return a=(0,M.default)(B.prototype.__proto__||(0,j.default)(B.prototype),"getVersion",this).call(this,F),o=a.version,s={},(i=void 0===o?N:o)===N?(s.recipient=n,y=y||h,h&&(s.sender_organization=h),y&&(s.recipient_organization=y)):i===V&&(s.conversation_id=l),f&&(s.data=f.map(function(e){return(0,O.default)({},e,{payload:(0,I.default)(e.payload)})})),void 0!==p&&(s.priority=p),e.next=19,this.httpClient.post("/:version/message/:id/forward",{urlParams:{id:t,version:i},data:s,requestId:d});case 19:if(u=e.sent,i===N)return c={message_id:u.getHeader("TT-X-Message-Id")},e.abrupt("return",c);e.next=25;break;case 25:return e.abrupt("return",u.data);case 26:case"end":return e.stop()}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"find",value:(f=(0,E.default)(A.default.mark(function e(t){var n,r,a,o;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=4;break;case 4:return n=(0,M.default)(B.prototype.__proto__||(0,j.default)(B.prototype),"getVersion",this).call(this,U),r=n.version,a=void 0===r?N:r,e.next=7,this.httpClient.get("/:version/message/:id",{urlParams:{id:t,version:a}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"findRecipientStatus",value:(d=(0,E.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=4;break;case 4:return e.next=6,this.httpClient.get("/v2/message/:id/status",{urlParams:{id:t}});case 6:return n=e.sent,e.abrupt("return",n.data);case 8:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"findRecipientStatusMulti",value:(l=(0,E.default)(A.default.mark(function e(t){var n;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+k(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+_(t));case 4:return e.next=6,this.httpClient.post("/v2/get_bulk_message_status",{data:{messages:t}});case 6:return n=e.sent,e.abrupt("return",n.data.bulk_message_statuses);case 8:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"updateRecipientStatusMulti",value:(c=(0,E.default)(A.default.mark(function e(t){var n,r,a,o;return A.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,M.default)(B.prototype.__proto__||(0,j.default)(B.prototype),"getVersion",this).call(this,$),r=n.version,a=void 0===r?N:r,e.next=3,this.httpClient.post("/:version/message/status",{urlParams:{version:a},data:t});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})}]),a((s=B).prototype,"find",[o],(0,w.default)(s.prototype,"find"),s.prototype),a(s.prototype,"findRecipientStatus",[i],(0,w.default)(s.prototype,"findRecipientStatus"),s.prototype),s);function B(){return(0,x.default)(this,B),(0,R.default)(this,(B.__proto__||(0,j.default)(B)).apply(this,arguments))}t.default=D,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,d.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,l.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,c.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,d.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,l.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,c.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c=r(n(3)),l=r(n(7)),d=r(n(8)),f=r(n(10)),p=r(n(9)),y=r(n(4)),h=r(n(1)),g=r(n(2)),v=r(n(6)),m=r(n(5)),b=r(n(16)),w=(a=b.default,(0,m.default)(E,a),(0,g.default)(E,[{key:"update",value:(u=(0,p.default)(f.default.mark(function e(t,n,r){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+s(n));case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+i(n));case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/metadata/:id",{urlParams:{id:t},data:n,headers:{"TT-X-Organization-Key":r}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"find",value:(o=(0,p.default)(f.default.mark(function e(t,n){var r;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.get("/v2/metadata/:id",{urlParams:{id:t},headers:{"TT-X-Organization-Key":n}});case 10:return r=e.sent,e.abrupt("return",r.data);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),E);function E(){return(0,h.default)(this,E),(0,v.default)(this,(E.__proto__||(0,y.default)(E)).apply(this,arguments))}t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,A.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,A.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_=r(n(3)),k=r(n(7)),A=r(n(8)),T=r(n(11)),I=r(n(10)),O=r(n(9)),j=r(n(4)),S=r(n(1)),R=r(n(2)),M=r(n(6)),z=r(n(25)),G=r(n(5)),C=n(16),P=r(C),V=C.VERSIONS.VERSION_TWO,N=C.ROUTES.MUTE_FIND_ALL,U=(o=(0,C.recoverFromNotFound)(),u=(0,C.recoverFromNotFound)(),c=(0,C.recoverFromNotFound)(),l=(0,C.recoverFromNotFound)(),d=(0,C.recoverFromNotFound)(),f=(0,C.recoverFromNotFound)(),y=P.default,(0,G.default)(F,y),(0,R.default)(F,[{key:"findAll",value:(x=(0,O.default)(I.default.mark(function e(){var t,n,r,a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,z.default)(F.prototype.__proto__||(0,j.default)(F.prototype),"getVersion",this).call(this,N),n=t.version,r=void 0===n?V:n,e.next=3,this.httpClient.get("/:version/mute",{urlParams:{version:r}});case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}},e,this)})),function(){return x.apply(this,arguments)})},{key:"unmuteAll",value:(E=(0,O.default)(I.default.mark(function e(){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.httpClient.del("/v2/mute");case 2:case"end":return e.stop()}},e,this)})),function(){return E.apply(this,arguments)})},{key:"muteUser",value:(w=(0,O.default)(I.default.mark(function e(t,n,r){var a=(3<arguments.length&&void 0!==arguments[3]?arguments[3]:{}).recipientOrganizationId,o=void 0===a?r:a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/mute/p2p",{data:{sender_token:t,sender_organization:r,receiver_organization:o,duration:n.toString()}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return w.apply(this,arguments)})},{key:"unmuteUser",value:(b=(0,O.default)(I.default.mark(function e(t,n){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).recipientOrganizationId,a=void 0===r?n:r;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v2/mute/p2p",{headers:{"TT-X-Sender-Token":t,"TT-X-Sender-Organization":n,"TT-X-Receiver-Organization":a}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"muteGroup",value:(m=(0,O.default)(I.default.mark(function e(t,n,r){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/mute/group/:groupId",{urlParams:{groupId:t},data:{duration:n.toString(),receiver_organization:r}});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n){return m.apply(this,arguments)})},{key:"unmuteGroup",value:(v=(0,O.default)(I.default.mark(function e(t,n){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v2/mute/group/:groupId",{urlParams:{groupId:t},headers:{"TT-X-Receiver-Organization":n}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"muteOrganization",value:(g=(0,O.default)(I.default.mark(function e(t,n){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.post("/v2/mute/organization/:organizationId",{urlParams:{organizationId:t},data:{duration:n.toString(),receiver_organization:t}});case 10:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"unmuteOrganization",value:(h=(0,O.default)(I.default.mark(function e(t){return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:return e.next=6,this.httpClient.del("/v2/mute/organization/:organizationId",{urlParams:{organizationId:t},headers:{"TT-X-Receiver-Organization":t}});case 6:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})}]),a((p=F).prototype,"muteUser",[o],(0,T.default)(p.prototype,"muteUser"),p.prototype),a(p.prototype,"unmuteUser",[u],(0,T.default)(p.prototype,"unmuteUser"),p.prototype),a(p.prototype,"muteGroup",[c],(0,T.default)(p.prototype,"muteGroup"),p.prototype),a(p.prototype,"unmuteGroup",[l],(0,T.default)(p.prototype,"unmuteGroup"),p.prototype),a(p.prototype,"muteOrganization",[d],(0,T.default)(p.prototype,"muteOrganization"),p.prototype),a(p.prototype,"unmuteOrganization",[f],(0,T.default)(p.prototype,"unmuteOrganization"),p.prototype),p);function F(){return(0,S.default)(this,F),(0,M.default)(this,(F.__proto__||(0,j.default)(F)).apply(this,arguments))}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u=r(n(10)),c=r(n(9)),l=r(n(4)),d=r(n(1)),f=r(n(2)),p=r(n(6)),y=r(n(5)),h=r(n(16)),g=(a=h.default,(0,y.default)(v,a),(0,f.default)(v,[{key:"closeAllConnections",value:(s=(0,c.default)(u.default.mark(function e(t,n){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.httpClient.getAuthHeaders({key:t,secret:n}),e.next=3,this.httpClient.del("/v2/events/simple_notifications",{headers:r});case 3:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"signIn",value:(i=(0,c.default)(u.default.mark(function e(){var t,n,r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.httpClient.post("/v2/events/simple_notifications/key");case 2:return t=e.sent,n=t.getHeader("TT-X-Api-Key"),r=t.getHeader("TT-X-Api-Secret"),e.abrupt("return",{key:n,secret:r});case 6:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"signOut",value:(o=(0,c.default)(u.default.mark(function e(t,n){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.httpClient.getAuthHeaders({key:t,secret:n}),e.abrupt("return",this.httpClient.post("/v2/logout",{headers:r}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),v);function v(){return(0,d.default)(this,v),(0,p.default)(this,(v.__proto__||(0,l.default)(v)).apply(this,arguments))}t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,c,l,d,f,p=r(n(3)),y=r(n(7)),h=r(n(8)),g=r(n(11)),v=r(n(10)),m=r(n(9)),b=r(n(4)),w=r(n(1)),E=r(n(2)),x=r(n(6)),_=r(n(25)),k=r(n(5)),A=n(16),T=r(A),I=A.VERSIONS.VERSION_TWO,O=A.ROUTES.ORGANIZATION_FIND_ALL_OF_USER,j=A.ROUTES.ORGANIZATION_FIND,S=(o=(0,A.recoverFromNotFound)(),i=(0,A.recoverFromNotFound)(),l=T.default,(0,k.default)(R,l),(0,E.default)(R,[{key:"find",value:(f=(0,m.default)(v.default.mark(function e(t,n){var r,a,o,i;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=8;break;case 8:return r=(0,_.default)(R.prototype.__proto__||(0,b.default)(R.prototype),"getVersion",this).call(this,j),a=r.version,o=void 0===a?I:a,e.next=11,this.httpClient.get("/:version/user/:userId/organization/:id",{urlParams:{version:o,userId:t,id:n}});case 11:return i=e.sent,e.abrupt("return",i.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"findAllOfUser",value:(d=(0,m.default)(v.default.mark(function e(t){var n,r,a,o;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=4;break;case 4:return n=(0,_.default)(R.prototype.__proto__||(0,b.default)(R.prototype),"getVersion",this).call(this,O),r=n.version,a=void 0===r?I:r,e.next=7,this.httpClient.get("/:version/user/:userId/organization",{urlParams:{version:a,userId:t}});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})}]),a((c=R).prototype,"find",[o],(0,g.default)(c.prototype,"find"),c.prototype),a(c.prototype,"findAllOfUser",[i],(0,g.default)(c.prototype,"findAllOfUser"),c.prototype),c);function R(){return(0,w.default)(this,R),(0,x.default)(this,(R.__proto__||(0,b.default)(R)).apply(this,arguments))}t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,y=r(n(11)),h=r(n(10)),g=r(n(9)),v=r(n(4)),m=r(n(1)),b=r(n(2)),w=r(n(6)),E=r(n(5)),x=n(16),_=r(x),k=(a=(0,x.recoverFromNotFound)(),f=_.default,(0,E.default)(A,f),(0,b.default)(A,[{key:"create",value:(p=(0,g.default)(h.default.mark(function e(){var t,n,r;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.httpClient.getAuthHeaders(),e.next=3,this.httpClient.get("/v2/qr_login_code/",{headers:t});case 3:return n=e.sent,r=n.data.qr_key,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})}]),i=(o=A).prototype,s="create",u=[a],c=(0,y.default)(o.prototype,"create"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function A(){return(0,m.default)(this,A),(0,w.default)(this,(A.__proto__||(0,v.default)(A)).apply(this,arguments))}t.default=k,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function g(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=g(t[0],n);return t.every(function(e){return g(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return g(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,h.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+g(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function v(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=v(t[0],n);return t.every(function(e){return v(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return v(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,h.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+v(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,y=r(n(3)),h=r(n(7)),m=r(n(8)),b=r(n(11)),w=r(n(10)),E=r(n(9)),x=r(n(4)),_=r(n(1)),k=r(n(2)),A=r(n(6)),T=r(n(5)),I=n(16),O=r(I),j=["messageId","sender.name","sender.title","sender.department","senderRoleDisplayName","recipient.name","recipient.title","recipient.department","recipientRoleDisplayName","group.name","distributionList.name","sentTimestamp","attachment.hasAttachment","recalledTimestamp","forwardedMessageId","expireTimestamp","dndAutoForwardedFrom"],S={script:"(doc['deliveredTimestamp'].empty ? '' : _source.deliveredTimestamp < _source.sentTimestamp ? _source.sentTimestamp : _source.deliveredTimestamp)"},R={script:"(doc['readTimestamp'].empty ? '' :_source.readTimestamp < _source.sentTimestamp ? _source.sentTimestamp : _source.readTimestamp)"},M=["sender.title","recipient.title","sender.department","senderRoleDisplayName","recipient.department","recipientRoleDisplayName","sender.username","recipient.username","sender.verifiedEmails","recipient.verifiedEmails","sender.unverifiedEmails","recipient.unverifiedEmails","sender.verifiedPhones","recipient.verifiedPhones","sender.unverifiedPhones","recipient.unverifiedPhones","group.groupId","group.name","distributionList.distributionListId","distributionList.name","forwardedMessageId","messageId"],z=(a=(0,I.recoverFromNotFound)(),f=O.default,(0,T.default)(G,f),(0,k.default)(G,[{key:"fetchTransactions",value:(p=(0,E.default)(w.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=n.page,d=n.size,f=n.startDate,p=n.endDate,y=n.query,h=arguments;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(t));e.next=2;break;case 2:if(null==h[1]||"number"!=typeof h[1].page||"number"!=typeof h[1].size||"string"!=typeof h[1].startDate||"string"!=typeof h[1].endDate||"string"!=typeof h[1].query)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  page: number;\n  size: number;\n  startDate: string;\n  endDate: string;\n  query: string;\n}\n\nGot:\n"+v(h[1]));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(t));e.next=6;break;case 6:if(null==h[1]||"number"!=typeof h[1].page||"number"!=typeof h[1].size||"string"!=typeof h[1].startDate||"string"!=typeof h[1].endDate||"string"!=typeof h[1].query)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  page: number;\n  size: number;\n  startDate: string;\n  endDate: string;\n  query: string;\n}\n\nGot:\n"+g(h[1]));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},a=l*d-d,o=t,s=(i=y)&&y.split(" ").join("*"),u=[{range:{sentTimestamp:{from:f,to:p}}},{match:{"sender.organization.orgId":o}},{constant_score:{filter:{missing:{field:"message.hideMessage"}}}},{bool:{should:[{query_string:{query:"*"+s+"*",fields:["sender.name","recipient.name"]}},{multi_match:{query:i,fields:M}}]}}],e.next=16,this.httpClient.post("/v2/report/messages",{headers:r,data:{from:a,size:d,fields:j,script_fields:{deliveredTimestamp:S,readTimestamp:R},sort:{sentTimestamp:{order:"desc"}},query:{bool:{must:u}}}});case 16:return c=e.sent,e.abrupt("return",c);case 18:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})}]),i=(o=G).prototype,s="fetchTransactions",u=[a],c=(0,b.default)(o.prototype,"fetchTransactions"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function G(){var e,t,u,n,r,a,c=this;(0,_.default)(this,G);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return t=u=(0,A.default)(this,(e=G.__proto__||(0,x.default)(G)).call.apply(e,[this].concat(i))),u.exportCSV=(a=(0,E.default)(w.default.mark(function e(t,n){var r,a,o,i,s;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(t));e.next=4;break;case 4:if(r=n.total,a=n.startDate,o=n.endDate,i=n.query,"number"!=typeof r||"string"!=typeof a||"string"!=typeof o||"string"!=typeof i)throw new TypeError('Value of "{\n  total,\n  startDate,\n  endDate,\n  query\n}" violates contract.\n\nExpected:\n{\n  total: number;\n  startDate: string;\n  endDate: string;\n  query: string;\n}\n\nGot:\n'+g({total:r,startDate:a,endDate:o,query:i}));e.next=7;break;case 7:return e.next=9,u.httpClient.post(u.host.cnUrl+"/cn/transactional_data_export",{resFormat:"text",data:{organization:t,start_date:a,end_date:o,query_string:i,total:r}});case 9:return s=e.sent,e.abrupt("return",s);case 11:case"end":return e.stop()}},e,c)})),function(e,t){return a.apply(this,arguments)}),u.generateLookerEmbed=(r=(0,E.default)(w.default.mark(function e(t,n){var r,a,o;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "dashboard_type" violates contract.\n\nExpected:\nstring\n\nGot:\n'+v(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "dashboard_type" violates contract.\n\nExpected:\nstring\n\nGot:\n'+g(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,u.httpClient.post("/v2/looker",{headers:r,data:{dashboard_type:n}});case 11:return a=e.sent,o=a.data,e.abrupt("return",o&&o.looker_url);case 14:case"end":return e.stop()}},e,c)})),function(e,t){return r.apply(this,arguments)}),n=t,(0,A.default)(u,n)}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,k.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,_.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,x.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,k.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,_.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,x.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,d,f,p,y,h,g,v,m,b,w,E,x=r(n(3)),_=r(n(7)),k=r(n(8)),A=r(n(11)),T=r(n(10)),I=r(n(9)),O=r(n(4)),j=r(n(1)),S=r(n(2)),R=r(n(6)),M=r(n(5)),z=n(16),G=r(z),C=(a=(0,z.recoverFromNotFound)(),y=G.default,(0,M.default)(P,y),(0,S.default)(P,[{key:"findAll",value:(E=(0,I.default)(T.default.mark(function e(t){var n,r;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=4;break;case 4:return n={"TT-X-Organization-Key":t},e.next=7,this.httpClient.get("/v2/role/tags",{headers:n});case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"createOrUpdateTag",value:(w=(0,I.default)(T.default.mark(function e(t,n,r,a){var o,i;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "color" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "name" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "color" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "name" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(r));e.next=12;break;case 12:if(o={color:t,name:n,organizationId:r},i=void 0,a)return e.next=17,this.updateTag(a,o);e.next=20;break;case 17:i=e.sent,e.next=23;break;case 20:return e.next=22,this.createTag(o);case 22:i=e.sent;case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return w.apply(this,arguments)})},{key:"createTag",value:(b=(0,I.default)(T.default.mark(function e(t){var n,r,a=t.color,o=t.name,i=t.organizationId,s=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==s[0]||"string"!=typeof s[0].color||"string"!=typeof s[0].name||"string"!=typeof s[0].organizationId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+l(s[0]));e.next=2;break;case 2:if(null==s[0]||"string"!=typeof s[0].color||"string"!=typeof s[0].name||"string"!=typeof s[0].organizationId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+c(s[0]));e.next=4;break;case 4:return n={"TT-X-Organization-Key":i},e.next=7,this.httpClient.post("/v2/tags",{data:{color:a,name:o},headers:n});case 7:return(r=e.sent).token=r.headers["tt-x-tag-id"],e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"updateTag",value:(m=(0,I.default)(T.default.mark(function e(t,n){var r,a,o=n.color,i=n.name,s=n.organizationId,u=arguments;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==u[1]||"string"!=typeof u[1].color||"string"!=typeof u[1].name||"string"!=typeof u[1].organizationId)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+l(u[1]));e.next=2;break;case 2:if(null==u[1]||"string"!=typeof u[1].color||"string"!=typeof u[1].name||"string"!=typeof u[1].organizationId)throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  color: string;\n  name: string;\n  organizationId: string;\n}\n\nGot:\n"+c(u[1]));e.next=4;break;case 4:return r={"TT-X-Organization-Key":s},e.next=7,this.httpClient.put("/v2/tags/:token",{urlParams:{token:t},data:{color:o,name:i},headers:r});case 7:return(a=e.sent).token=t,e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"destroy",value:(v=(0,I.default)(T.default.mark(function e(t,n){var r,a;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.del("/v2/tags/:token",{urlParams:{token:n},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"findColors",value:(g=(0,I.default)(T.default.mark(function e(t){var n,r;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=4;break;case 4:return n={"TT-X-Organization-Key":t},e.next=7,this.httpClient.get("/v2/tag/color_list/:organizationId",{urlParams:{organizationId:t},headers:n});case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"findTag",value:(h=(0,I.default)(T.default.mark(function e(t,n){var r,a;return T.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "tagId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "tagId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.get("/v2/tags/:tagId",{urlParams:{tagId:n},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})}]),i=(o=P).prototype,s="findAll",u=[a],d=(0,A.default)(o.prototype,"findAll"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(i,s,p),p=null),o);function P(){return(0,j.default)(this,P),(0,R.default)(this,(P.__proto__||(0,O.default)(P)).apply(this,arguments))}t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function m(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,A.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=m(t[0],n);return t.every(function(e){return m(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return m(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+m(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,A.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,k.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,_.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,w,E,x,_=r(n(3)),k=r(n(7)),A=r(n(8)),T=r(n(11)),I=r(n(10)),O=r(n(9)),j=r(n(4)),S=r(n(1)),R=r(n(2)),M=r(n(6)),z=r(n(25)),G=r(n(5)),C=n(16),P=r(C),V=C.VERSIONS.VERSION_TWO,N=C.ROUTES.ROLES_CREATE_P2P_GROUP,U=(o=(0,C.recoverFromNotFound)(),i=(0,C.recoverFromNotFound)(),u=P.default,(0,G.default)(F,u),(0,R.default)(F,[{key:"createP2PGroup",value:(x=(0,O.default)(I.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p=t.createdByUserId,y=t.name,h=t.replayHistory,g=void 0!==h&&h,v=t.memberIds,m=void 0===v?[]:v,b=t.organizationId;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,z.default)(F.prototype.__proto__||(0,j.default)(F.prototype),"getVersion",this).call(this,N),r=n.version,a=void 0===r?V:r,o={"TT-X-Organization-Key":b},i={created_by:p,members:m,name:y,replay_history:g},e.next=5,this.httpClient.post("/:version/role_group",{urlParams:{version:a},headers:o,data:i});case 5:return s=e.sent,u=s.data,c=u.conversation_id,l=u.metadata,d=s.data.token,f={conversationId:c,memberIds:m,metadata:l,name:y,organizationId:b,token:d},e.abrupt("return",f);case 10:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"find",value:(E=(0,O.default)(I.default.mark(function e(t,n){var r,a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.get("/v2/role/:id",{urlParams:{id:t},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"createRole",value:(w=(0,O.default)(I.default.mark(function e(t){var n,r,a,o=t.description,i=t.name,s=t.openAssignment,u=t.organizationId,c=t.ownerRequired,l=t.owners,d=t.replayHistory,f=t.tagColor,p=t.tagName,y=t.tagToken,h=t.escalationPolicy,g=arguments;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==g[0]||void 0!==g[0].description&&null!=g[0].description&&"string"!=typeof g[0].description||"string"!=typeof g[0].name||"boolean"!=typeof g[0].openAssignment||"string"!=typeof g[0].organizationId||void 0!==g[0].ownerRequired&&null!=g[0].ownerRequired&&"boolean"!=typeof g[0].ownerRequired||!(void 0===g[0].owners||null==g[0].owners||Array.isArray(g[0].owners)&&g[0].owners.every(function(e){return"string"==typeof e}))||"string"!=typeof g[0].replayHistory||void 0!==g[0].tagColor&&null!=g[0].tagColor&&"string"!=typeof g[0].tagColor||void 0!==g[0].tagName&&null!=g[0].tagName&&"string"!=typeof g[0].tagName||void 0!==g[0].tagToken&&null!=g[0].tagToken&&"string"!=typeof g[0].tagToken||!(void 0===g[0].escalationPolicy||null==g[0].escalationPolicy||g[0].escalationPolicy instanceof Object))throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name: string;\n  openAssignment: boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory: string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+b(g[0]));e.next=2;break;case 2:if(null==g[0]||void 0!==g[0].description&&null!=g[0].description&&"string"!=typeof g[0].description||"string"!=typeof g[0].name||"boolean"!=typeof g[0].openAssignment||"string"!=typeof g[0].organizationId||void 0!==g[0].ownerRequired&&null!=g[0].ownerRequired&&"boolean"!=typeof g[0].ownerRequired||!(void 0===g[0].owners||null==g[0].owners||Array.isArray(g[0].owners)&&g[0].owners.every(function(e){return"string"==typeof e}))||"string"!=typeof g[0].replayHistory||void 0!==g[0].tagColor&&null!=g[0].tagColor&&"string"!=typeof g[0].tagColor||void 0!==g[0].tagName&&null!=g[0].tagName&&"string"!=typeof g[0].tagName||void 0!==g[0].tagToken&&null!=g[0].tagToken&&"string"!=typeof g[0].tagToken||!(void 0===g[0].escalationPolicy||null==g[0].escalationPolicy||g[0].escalationPolicy instanceof Object))throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name: string;\n  openAssignment: boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory: string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+m(g[0]));e.next=4;break;case 4:return n={"TT-X-Organization-Key":u},r={display_name:i,open_assignment:s?"1":"0",replay_history:d},void 0!==o&&(r.description=o),void 0!==h&&(r.escalation_policy=h),void 0!==c&&(r.owner_required=c?"1":"0"),void 0!==l&&(r.owners=l),void 0!==f&&(r.tag_color=f),void 0!==y&&(r.tag_id=y),void 0!==p&&(r.tag_name=p),e.next=15,this.httpClient.post("/v2/role",{headers:n,data:r});case 15:return(a=e.sent).token=a.headers["tt-x-role-token"],e.abrupt("return",a);case 18:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"updateRole",value:(v=(0,O.default)(I.default.mark(function e(t,n){var r,a,o,i=n.description,s=n.name,u=n.openAssignment,c=n.organizationId,l=n.ownerRequired,d=n.owners,f=n.replayHistory,p=n.tagColor,y=n.tagName,h=n.tagToken,g=n.escalationPolicy,v=arguments;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if(null==v[1]||void 0!==v[1].description&&null!=v[1].description&&"string"!=typeof v[1].description||void 0!==v[1].name&&null!=v[1].name&&"string"!=typeof v[1].name||void 0!==v[1].openAssignment&&null!=v[1].openAssignment&&"boolean"!=typeof v[1].openAssignment||"string"!=typeof v[1].organizationId||void 0!==v[1].ownerRequired&&null!=v[1].ownerRequired&&"boolean"!=typeof v[1].ownerRequired||!(void 0===v[1].owners||null==v[1].owners||Array.isArray(v[1].owners)&&v[1].owners.every(function(e){return"string"==typeof e}))||void 0!==v[1].replayHistory&&null!=v[1].replayHistory&&"string"!=typeof v[1].replayHistory||void 0!==v[1].tagColor&&null!=v[1].tagColor&&"string"!=typeof v[1].tagColor||void 0!==v[1].tagName&&null!=v[1].tagName&&"string"!=typeof v[1].tagName||void 0!==v[1].tagToken&&null!=v[1].tagToken&&"string"!=typeof v[1].tagToken||!(void 0===v[1].escalationPolicy||null==v[1].escalationPolicy||v[1].escalationPolicy instanceof Object))throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name?: ?string;\n  openAssignment?: ?boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory?: ?string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+b(v[1]));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if(null==v[1]||void 0!==v[1].description&&null!=v[1].description&&"string"!=typeof v[1].description||void 0!==v[1].name&&null!=v[1].name&&"string"!=typeof v[1].name||void 0!==v[1].openAssignment&&null!=v[1].openAssignment&&"boolean"!=typeof v[1].openAssignment||"string"!=typeof v[1].organizationId||void 0!==v[1].ownerRequired&&null!=v[1].ownerRequired&&"boolean"!=typeof v[1].ownerRequired||!(void 0===v[1].owners||null==v[1].owners||Array.isArray(v[1].owners)&&v[1].owners.every(function(e){return"string"==typeof e}))||void 0!==v[1].replayHistory&&null!=v[1].replayHistory&&"string"!=typeof v[1].replayHistory||void 0!==v[1].tagColor&&null!=v[1].tagColor&&"string"!=typeof v[1].tagColor||void 0!==v[1].tagName&&null!=v[1].tagName&&"string"!=typeof v[1].tagName||void 0!==v[1].tagToken&&null!=v[1].tagToken&&"string"!=typeof v[1].tagToken||!(void 0===v[1].escalationPolicy||null==v[1].escalationPolicy||v[1].escalationPolicy instanceof Object))throw new TypeError("Value of argument 1 violates contract.\n\nExpected:\n{\n  description?: ?string;\n  name?: ?string;\n  openAssignment?: ?boolean;\n  organizationId: string;\n  ownerRequired?: ?boolean;\n  owners?: ?Array<string>;\n  replayHistory?: ?string;\n  tagColor?: ?string;\n  tagName?: ?string;\n  tagToken?: ?string;\n  escalationPolicy?: ?Object;\n}\n\nGot:\n"+m(v[1]));e.next=8;break;case 8:return r={"TT-X-Organization-Key":c},a={},void 0!==i&&(a.description=i),void 0!==s&&(a.display_name=s),void 0!==g&&(a.escalation_policy=g),void 0!==u&&(a.open_assignment=u?"1":"0"),void 0!==l&&(a.owner_required=l?"1":"0"),void 0!==d&&(a.owners=d),void 0!==f&&(a.replay_history=f),void 0!==p&&(a.tag_color=p),void 0!==h&&(a.tag_id=h),void 0!==y&&(a.tag_name=y),e.next=22,this.httpClient.put("/v2/role/:token",{urlParams:{token:t},headers:r,data:a});case 22:return(o=e.sent).token=t,e.abrupt("return",o);case 25:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"deleteRole",value:(g=(0,O.default)(I.default.mark(function e(t,n){var r;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "token" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.del("/v2/role/:token",{urlParams:{token:n},headers:r});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"findSavedRoles",value:(h=(0,O.default)(I.default.mark(function e(t,n){var r,a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.get("/v2/user/:userId/saved_roles",{urlParams:{userId:t},headers:r});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"saveRole",value:(y=(0,O.default)(I.default.mark(function e(t,n,r){var a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.post("/v2/user/:userId/saved_roles",{urlParams:{userId:n},data:{role_id:t},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return y.apply(this,arguments)})},{key:"removeSavedRole",value:(p=(0,O.default)(I.default.mark(function e(t,n,r){var a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.del("/v2/user/:userId/saved_roles/:roleId",{urlParams:{userId:n,roleId:t},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"optIn",value:(f=(0,O.default)(I.default.mark(function e(t,n,r){var a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.post("/v2/role/:roleId/members/:userId",{urlParams:{roleId:t,userId:n},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return f.apply(this,arguments)})},{key:"optOut",value:(d=(0,O.default)(I.default.mark(function e(t,n,r){var a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":r},e.next=15,this.httpClient.del("/v2/role/:roleId/members/:userId",{urlParams:{roleId:t,userId:n},headers:a});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return d.apply(this,arguments)})},{key:"saveAwayResponse",value:(l=(0,O.default)(I.default.mark(function e(t,n,r){var a;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "status" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":n},e.next=15,this.httpClient.post("/v2/role/:roleId/away",{urlParams:{roleId:t},headers:a,data:{status:r}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return l.apply(this,arguments)})},{key:"removeAwayResponse",value:(c=(0,O.default)(I.default.mark(function e(t,n){var r;return I.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+m(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":n},e.next=11,this.httpClient.del("/v2/role/:roleId/away",{urlParams:{roleId:t},headers:r});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})}]),a((s=F).prototype,"find",[o],(0,T.default)(s.prototype,"find"),s.prototype),a(s.prototype,"findSavedRoles",[i],(0,T.default)(s.prototype,"findSavedRoles"),s.prototype),s);function F(){return(0,S.default)(this,F),(0,M.default)(this,(F.__proto__||(0,j.default)(F)).apply(this,arguments))}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,d.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,l.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,d.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,l.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l=r(n(3)),d=r(n(7)),f=r(n(8)),p=r(n(10)),y=r(n(9)),h=r(n(4)),g=r(n(1)),v=r(n(2)),m=r(n(6)),b=r(n(25)),w=r(n(5)),E=r(n(223)),x=n(16),_=r(x),k=x.VERSIONS.VERSION_TWO,A=x.VERSIONS.VERSION_FIVE,T=["user","distributionList"],I=x.ROUTES.CONVERSATION_FIND_ALL,O=(a=_.default,(0,w.default)(j,a),(0,v.default)(j,[{key:"findAll",value:(c=(0,y.default)(p.default.mark(function e(){var t,n,r,a,o,i,s,u=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{organizationId:null};return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,b.default)(j.prototype.__proto__||(0,h.default)(j.prototype),"getVersion",this).call(this,I),n=t.version,o=a=void 0,(r=void 0===n?k:n)===A&&(a="true",o=u.organizationId),i={render_metadata:"true",mark_as_delivered:a},o&&(i.organization_id=o),e.next=7,this.httpClient.get("/:version/roster",{query:i,urlParams:{version:r}});case 7:return s=e.sent,e.abrupt("return",s.data);case 9:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"add",value:(u=(0,y.default)(p.default.mark(function e(t,n,r){var a,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:if((0,E.default)(T,t)){e.next=14;break}return e.abrupt("return");case 14:return a={},r&&(a["TT-X-Organization-Key"]=r),o=this.__typeToNS(t),e.next=19,this.httpClient.post("/v2/roster",{headers:a,data:{entity:n,type:o}});case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(o=(0,y.default)(p.default.mark(function e(t,n,r){var a,o;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:if((0,E.default)(T,t)){e.next=14;break}return e.abrupt("return");case 14:return a={},o=this.__typeToNS(t),r&&(a["TT-X-Organization-Key"]=r,a["TT-X-Type"]=o),e.next=19,this.httpClient.del("/v2/roster/:counterPartyId",{headers:a,urlParams:{counterPartyId:n},data:{type:o}});case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"__typeToNS",value:function(e){return S[e]}}]),j);function j(){return(0,g.default)(this,j),(0,m.default)(this,(j.__proto__||(0,h.default)(j)).apply(this,arguments))}t.default=O;var S={user:"tigertext:entity:account",distributionList:"tigertext:entity:list"};e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,d=r(n(3)),f=r(n(7)),p=r(n(8)),y=r(n(20)),h=r(n(10)),g=r(n(9)),v=r(n(4)),m=r(n(1)),b=r(n(2)),w=r(n(6)),E=r(n(5)),x=r(n(16)),_=(a=x.default,(0,E.default)(k,a),(0,b.default)(k,[{key:"findIntegrationIds",value:(u=(0,g.default)(h.default.mark(function e(t){var n,r;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=4;break;case 4:return n={Accept:"*","TT-X-Organization-Key":t},e.next=7,this.httpClient.post("/v1/integrations/scheduler/configs/info/org",{headers:n,data:{org:t}});case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"sendCsvSchedule",value:(s=(0,g.default)(h.default.mark(function e(t,n,r,a){var o,i,s,u;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "integrationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "file" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(r));e.next=6;break;case 6:if("string"!=typeof a)throw new TypeError('Value of argument "timezone" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(a));e.next=8;break;case 8:if("string"!=typeof t)throw new TypeError('Value of argument "integrationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=10;break;case 10:if("string"!=typeof n)throw new TypeError('Value of argument "file" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=12;break;case 12:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(r));e.next=14;break;case 14:if("string"!=typeof a)throw new TypeError('Value of argument "timezone" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(a));e.next=16;break;case 16:return o={"Content-Type":"text/csv","TT-X-Organization-Key":r,"TT-X-Integration-Id":t,"TT-X-Timezone":a},s=i=void 0,e.prev=19,e.next=22,this.httpClient.post("/v1/integrations/scheduler/webhook/csv",{data:n,headers:o});case 22:u=e.sent,i=u.data,s=u.status,e.next=35;break;case 27:if(e.prev=27,e.t0=e.catch(19),400!==e.t0.status){e.next=34;break}i=e.t0.response&&(e.t0.response.body||e.t0.response.text),s=e.t0.status,e.next=35;break;case 34:return e.abrupt("return",y.default.reject(e.t0));case 35:return e.abrupt("return",{json:i,status:s});case 36:case"end":return e.stop()}},e,this,[[19,27]])})),function(e,t,n,r){return s.apply(this,arguments)})},{key:"findCsv",value:(i=(0,g.default)(h.default.mark(function e(t,n){var r,a;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.post("/v1/integrations/scheduler/webhook/csv/download",{headers:r,data:{org:t,id:n},resFormat:"text"});case 11:return a=e.sent,e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"clearSchedule",value:(o=(0,g.default)(h.default.mark(function e(t,n){var r,a;return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(n));e.next=8;break;case 8:return r={Accept:"*","TT-X-Organization-Key":t},e.next=11,this.httpClient.post("/v1/integrations/scheduler/configs/truncate",{headers:r,data:{id:n}});case 11:return a=e.sent,e.abrupt("return",a.status);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})}]),k);function k(){return(0,m.default)(this,k),(0,w.default)(this,(k.__proto__||(0,v.default)(k)).apply(this,arguments))}t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i=r(n(10)),s=r(n(9)),u=r(n(4)),c=r(n(1)),l=r(n(2)),d=r(n(6)),f=r(n(25)),p=r(n(5)),y=n(16),h=r(y),g=y.VERSIONS.VERSION_TWO,v=y.ROUTES.SEARCH_QUERY,m=(a=h.default,(0,p.default)(b,a),(0,l.default)(b,[{key:"query",value:(o=(0,s.default)(i.default.mark(function e(t){var n,r,a,o;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,f.default)(b.prototype.__proto__||(0,u.default)(b.prototype),"getVersion",this).call(this,v),r=n.version,a=void 0===r?g:r,e.next=3,this.httpClient.post("/:version/search",{data:t,urlParams:{version:a}});case 3:return o=e.sent,e.abrupt("return",o.data);case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}]),b);function b(){return(0,c.default)(this,b),(0,d.default)(this,(b.__proto__||(0,u.default)(b)).apply(this,arguments))}t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,d.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,l.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,f.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,d.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,l.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l=r(n(3)),d=r(n(7)),f=r(n(8)),p=r(n(10)),y=r(n(9)),h=r(n(4)),g=r(n(1)),v=r(n(2)),m=r(n(6)),b=r(n(5)),w=r(n(16)),E=(a=w.default,(0,b.default)(x,a),(0,v.default)(x,[{key:"getTwilioNumbers",value:(c=(0,y.default)(p.default.mark(function e(t,n){var r,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "areaCode" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "areaCode" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return r={"TT-X-Organization-Key":t},e.next=11,this.httpClient.post("/v2/twilio/numbers",{headers:r,data:{area_code:n}});case 11:return a=e.sent,e.abrupt("return",a.data);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"assignPagerNumber",value:(u=(0,y.default)(p.default.mark(function e(t,n,r){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":t},e.next=15,this.httpClient.post("/v2/user/:roleToken/organization/:organizationId/pagers?process_number=true",{headers:a,urlParams:{organizationId:t,roleToken:r},data:{pager_numbers:n}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"removePagerNumber",value:(o=(0,y.default)(p.default.mark(function e(t,n,r){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "number" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "roleToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(r));e.next=12;break;case 12:return a={"TT-X-Organization-Key":t},e.next=15,this.httpClient.del("/v2/user/:roleToken/organization/:organizationId/pagers/:number?process_number=true",{headers:a,urlParams:{organizationId:t,roleToken:r,number:n}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return o.apply(this,arguments)})}]),x);function x(){return(0,g.default)(this,x),(0,m.default)(this,(x.__proto__||(0,h.default)(x)).apply(this,arguments))}t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,m.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,v.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,g.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,u,c,l,d,f,p,y,h,g=r(n(3)),v=r(n(7)),m=r(n(8)),b=r(n(11)),w=r(n(10)),E=r(n(9)),x=r(n(4)),_=r(n(1)),k=r(n(2)),A=r(n(6)),T=r(n(5)),I=n(16),O=r(I),j=(a=(0,I.recoverFromNotFound)(),y=O.default,(0,T.default)(S,y),(0,k.default)(S,[{key:"findAll",value:(h=(0,E.default)(w.default.mark(function e(t,n){var r;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(n));e.next=8;break;case 8:return e.next=10,this.httpClient.get("/v2/user/:userId/organization/:organizationId/roles",{urlParams:{userId:t,organizationId:n}});case 10:return r=e.sent,e.abrupt("return",r.data.roles);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})}]),u=(o=S).prototype,c="findAll",l=[a],d=(0,b.default)(o.prototype,"findAll"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(u,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(u,c,p),p=null),o);function S(){return(0,_.default)(this,S),(0,A.default)(this,(S.__proto__||(0,x.default)(S)).apply(this,arguments))}t.default=j,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,j.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,O.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,I.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,j.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,O.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,I.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,k,A,T,I=r(n(3)),O=r(n(7)),j=r(n(8)),S=r(n(11)),R=r(n(15)),M=r(n(10)),z=r(n(9)),G=r(n(4)),C=r(n(1)),P=r(n(2)),V=r(n(6)),N=r(n(25)),U=r(n(5)),F=n(16),L=r(F),$=r(n(86)),D=r(n(83)),B=r(n(85)),q=n(30),Z=n(27),K=F.VERSIONS.VERSION_TWO,H=F.ROUTES.USER_FIND,W=F.ROUTES.USER_FIND_ME,X=new B.default.MD5,Q=(a=(0,F.recoverFromNotFound)(),f=L.default,(0,U.default)(Y,f),(0,P.default)(Y,[{key:"getAnonymousAuthHeader",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "udid" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(e));if("string"!=typeof e)throw new TypeError('Value of argument "udid" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));var t=this.config.signUpHashKey,n=this.config.signUpHashSalt,r=[t,n,e].join(":"),a=X.hex(r),o=[a.substr(0,2),a.substr(a.length-2)].join(""),i=[this.config.productKey,t,n,e,o].join(":");return"XMPP-Anonymous "+(0,D.default)(i)}},{key:"getSignInAuthHeader",value:function(){var e;return(e=this.constructor).getSignInAuthHeader.apply(e,arguments)}},{key:"checkLogin",value:(T=(0,z.default)(M.default.mark(function e(t,n){var r,a,o;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={Authorization:this.getAnonymousAuthHeader(n.udid)},a={device:n.udid,tt_product_version:this.config.partnerName},(0,Z.isPhone)(t)?a.phones=(0,Z.normalizePhone)(t):a.emails=t,e.next=5,this.httpClient.get("/v4/login_check",{headers:r,query:a});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return T.apply(this,arguments)})},{key:"signUp",value:(A=(0,z.default)(M.default.mark(function e(t){var n,r,a;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={Authorization:this.getAnonymousAuthHeader(t.udid)},r={primary_email:t.email,unique_id:t.email,password:t.password,push_routing:this.config.pushAgent,product:this.config.productKey,country_code:t.countryCode,device_id:t.udid,version:this.config.version},e.next=4,this.httpClient.post("/v2/signup",{headers:n,data:r});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"signIn",value:(k=(0,z.default)(M.default.mark(function e(t,n){var r,a,o,i,s,u,c;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={device_id:n.udid,metadata:{device_type:"js_sdk",device_version:"7.3.1",tt_product_version:this.config.partnerName,user_agent:global.navigator&&global.navigator.userAgent},push_routing:this.config.pushAgent,version:this.config.version,want_condensed_replays:this.config.wantCondensedReplays,want_processing_events:this.config.wantCondensedReplays},e.next=3,this.httpClient.post("/v5/login",{headers:t,data:r});case 3:return(a=e.sent).data&&a.data.settings&&(o=a.data.settings,i=o.condensed_replays,s=void 0!==i&&i,u=o.processing_events,c=void 0!==u&&u,this.host.configure({condensedReplays:s,processingEvents:c})),e.abrupt("return",a);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"lookup",value:(E=(0,z.default)(M.default.mark(function e(t){var n,r,a,o,i;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return n=(0,N.default)(Y.prototype.__proto__||(0,G.default)(Y.prototype),"getVersion",this).call(this,H),r=n.version,a=void 0===r?K:r,o={display_name:t},(0,q.isEmail)(t)?o.email_address=t:(0,Z.isPhone)(t)&&(o.phone_number=(0,Z.normalizePhone)(t)),e.next=9,this.httpClient.post("/:version/user_lookup/:id",{urlParams:{id:t,version:a},data:o});case 9:return i=e.sent,e.abrupt("return",i.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"wipe",value:(w=(0,z.default)(M.default.mark(function e(t){var n;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return e.next=6,this.httpClient.post("/v2/wipe",{data:{},query:{token:t}});case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"find",value:(b=(0,z.default)(M.default.mark(function e(t){var n,r,a,o,i,s=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return n=(0,N.default)(Y.prototype.__proto__||(0,G.default)(Y.prototype),"getVersion",this).call(this,H),r=n.version,a=void 0===r?K:r,(0,q.isEmail)(t)&&(t=t.toLowerCase()),o=s?{"TT-X-Organization-Key":s}:null,e.next=9,this.httpClient.get("/:version/user/:id",{headers:o,urlParams:{id:t,version:a},query:{render_metadata:!0}});case 9:return i=e.sent,e.abrupt("return",i.data);case 11:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"findMe",value:(m=(0,z.default)(M.default.mark(function e(){var t,n,r,a,o,i=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).organizationId;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,N.default)(Y.prototype.__proto__||(0,G.default)(Y.prototype),"getVersion",this).call(this,W),n=t.version,r=void 0===n?K:n,a=i?{"TT-X-Organization-Key":i}:null,e.next=4,this.httpClient.get("/:version/user",{headers:a,query:{render_metadata:!0},urlParams:{version:r}});case 4:return o=e.sent,e.abrupt("return",o.data);case 6:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"update",value:(v=(0,z.default)(M.default.mark(function e(t,n){var r,a,o,i=n.firstName,s=void 0===i?void 0:i,u=n.lastName,c=void 0===u?void 0:u,l=n.displayName,d=void 0===l?void 0:l,f=n.status,p=void 0===f?void 0:f,y=n.dnd,h=void 0===y?void 0:y,g=n.dndText,v=void 0===g?void 0:g,m=n.avatarFile,b=void 0===m?void 0:m,w=n.removeAvatar,E=void 0===w?void 0:w;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=4;break;case 4:return a={},E?a.avatar=null:b&&(a.avatar=b),o=(r={first_name:s,last_name:c,display_name:d,status:p,dnd:h,dnd_text:v},$.default).call(r,function(e,t){return void 0===e}),e.next=9,this.httpClient.post("/v2/user/:id/settings",{urlParams:{id:t},data:o,files:a});case 9:return e.abrupt("return",(0,R.default)({id:t},b&&b.preview?{avatarUrl:b.preview}:null));case 10:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"updatePassword",value:(g=(0,z.default)(M.default.mark(function e(t,n,r,a){var o,i;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(r));e.next=6;break;case 6:if("string"!=typeof a)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(a));e.next=8;break;case 8:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=10;break;case 10:if("string"!=typeof n)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=12;break;case 12:if("string"!=typeof r)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(r));e.next=14;break;case 14:if("string"!=typeof a)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(a));e.next=16;break;case 16:return o={Authorization:this.getSignInAuthHeader(a,t,n)},e.next=19,this.httpClient.post("/v2/user/:id/password",{urlParams:{id:t},headers:o,data:{password:r}});case 19:return i=e.sent,e.abrupt("return",i);case 21:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return g.apply(this,arguments)})},{key:"setAutoForward",value:(h=(0,z.default)(M.default.mark(function e(t,n,r){var a,o=r.dnd,i=r.receiverId,s=arguments;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if(null==s[2]||"boolean"!=typeof s[2].dnd||"string"!=typeof s[2].receiverId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  dnd: boolean;\n  receiverId: string;\n}\n\nGot:\n"+_(s[2]));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=10;break;case 10:if(null==s[2]||"boolean"!=typeof s[2].dnd||"string"!=typeof s[2].receiverId)throw new TypeError("Value of argument 2 violates contract.\n\nExpected:\n{\n  dnd: boolean;\n  receiverId: string;\n}\n\nGot:\n"+x(s[2]));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/user/:userId/organization/:organizationId",{urlParams:{userId:t,organizationId:n},data:{dnd:o,dnd_auto_forward_receiver:i}});case 14:return a=e.sent,e.abrupt("return",a);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"removeAutoForward",value:(y=(0,z.default)(M.default.mark(function e(t,n){var r;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:return e.next=10,this.httpClient.del("/v2/user/:userId/organization/:organizationId/dnd_auto_forward_receiver",{urlParams:{userId:t,organizationId:n}});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"setEulaAccepted",value:(p=(0,z.default)(M.default.mark(function e(t,n,r){var a;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if("boolean"!=typeof r)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+_(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=10;break;case 10:if("boolean"!=typeof r)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+x(r));e.next=12;break;case 12:return e.next=14,this.httpClient.post("/v2/user/:userId/organization/:organizationId",{urlParams:{userId:t,organizationId:n},data:{eula:!r}});case 14:return a=e.sent,e.abrupt("return",a);case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return p.apply(this,arguments)})}],[{key:"getSignInAuthHeader",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));if("string"!=typeof e)throw new TypeError('Value of argument "productKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));if("string"!=typeof n)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));var r=[e,t,n].join(":");return"XMPP-Simple "+(0,D.default)(r)}}]),i=(o=Y).prototype,s="find",u=[a],c=(0,S.default)(o.prototype,"find"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function Y(){return(0,C.default)(this,Y),(0,V.default)(this,(Y.__proto__||(0,G.default)(Y)).apply(this,arguments))}t.default=Q,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Conversations:n(99),DistributionLists:n(100),Entities:n(101),Escalations:n(102),Events:n(103),Groups:n(104),Messages:n(105),Metadata:n(106),Mute:n(107),Notifications:n(108),Organizations:n(109),QRCode:n(110),Reporting:n(111),Roles:n(113),RoleTags:n(112),Roster:n(114),Scheduler:n(115),Search:n(116),Twilio:n(117),UserRoles:n(118),Users:n(119)};t.default=r,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="UpM28mnfW65vJkbqEATtKvxm",r={CONSUMER_ORGANIZATION_ID:n,BASE_URLS:{local:"http://localhost:8888",productionOauth:"http://52.41.133.15:8000/tigertextapi"},ADMIN_URLS:{},CN_URLS:{},FORGOT_PASSWORD_URLS:{},ROLES_URLS:{},CLOUDFRONT:{development:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},production:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},tt:{d1n6bomzxlt9xn:"tigertext/production/avatar",d18oyzjkq5093g:"tigertext/production/avatar-group"},ihis:{avatar:"",groupAvatar:""}},CONFIG_DEFAULT:{apiEnv:"production",assetDomain:"assets.tigerconnect.com",autoAckSuccessfullyHandledEvents:!0,autoSignOutOnBrowserUnload:!0,baseUrl:null,botUsers:[],clearTypingStatusThrottleDelay:2e3,clearTypingStatusTimeout:8e3,cloudfrontDomain:"cloudfront.net",cloudfront:{},condensedReplays:!1,consumerOrganizationId:n,detectBangReplayTimeout:1e3,events:{autoAck:!1,autoDeliver:!1,canConfirm:!0,closeAfterMessages:!1,heartbeat:!0,hidden:!1,includeDistributionListEvents:!0,isTyping:!0,msgDeliveryDelay:0,multiOrg:!0,noOfflineMessages:!1,renderMetadata:!0},eventCollectionInterval:50,eventsAutoReconnect:!0,eventsAutoReconnectDelay:2e3,eventsAutoReconnectMaxDelay:16e3,eventsDebugging:!1,flushAckInterval:1e3,flushAckMaxConnections:2,flushAckMaxEvents:50,flushFindRecipientStatusInterval:150,flushFindRecipientStatusMaxCount:20,flushSetMessageStatusInterval:1e3,flushSetMessageStatusMaxCount:500,keepConversationsForAllForums:!1,localCnUrl:null,localRolesUrl:null,logLevel:"error",manuallyRequestEventQueueBatch:!1,maxEventBatch:50,maxMetadataKeyCount:8,organizationRostersChangeThrottleDelay:500,placeholderEntityAllowLoading:!0,placeholderEntityDelayBeforeRefreshing:100,processingEvents:!1,productKey:"bc1oOf3DZXbnaNZ2LCWZGvSg",pushAgent:"consumer",reportingV2Enabled:!0,serviceLogLevels:{},signUpHashKey:"21d2ff3ffbf",signUpHashSalt:"%(xx*&x$&*%&",ttRoute:null,version:"1.0",wantCondensedReplays:!0}};["stag","uat"].forEach(function(e){r.BASE_URLS[e]="https://"+e+"-devapi.tigertext.me",r.FORGOT_PASSWORD_URLS[e]="https://"+e+"-forget.tigertext.com",r.CN_URLS[e]="https://"+e+"-console.tigertext.me",r.ADMIN_URLS[e]="https://"+e+"-console.tigertext.me/app/admin",r.ROLES_URLS[e]="/"+e+"/app/roles/index.html"}),["ihis","prod","production","tt"].forEach(function(e){r.BASE_URLS[e]="https://api.tigertext.me",r.FORGOT_PASSWORD_URLS[e]="https://forget.tigertext.com",r.CN_URLS[e]="https://home.tigertext.com",r.ADMIN_URLS[e]="https://home.tigertext.com/app/admin",r.ROLES_URLS[e]="/app/roles/index.html"}),["ihis"].forEach(function(e){r.CN_URLS[e]="https://"+e+".tigertext.com",r.ADMIN_URLS[e]="https://"+e+".tigertext.com/app/admin"}),t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="connection-unavailable",o);function f(){(0,u.default)(this,f);var e=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,"No internet connection"));return e.code=f.CODE,e}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="not-found",o);function f(e,t,n){(0,u.default)(this,f);var r=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,n));return r.code=f.CODE,r.resource=e,r.id=t,r}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="not-signed-in",o);function f(){var e;(0,u.default)(this,f);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=(0,c.default)(this,(e=f.__proto__||(0,s.default)(f)).call.apply(e,[this].concat(n)));return a.code=f.CODE,a}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="not-supported",o);function f(e){(0,u.default)(this,f);var t=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,e));return t.code=f.CODE,t}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="permission-denied",o);function f(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"can't perform action '"+n+"' on "+(e.name||e)+" #"+t;(0,u.default)(this,f);var a=(0,c.default)(this,(f.__proto__||(0,s.default)(f)).call(this,r));return a.code=f.CODE,a.resource=e,a.action=n,a.id=t,a}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="requires-basic-auth",o);function f(){var e;(0,u.default)(this,f);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=(0,c.default)(this,(e=f.__proto__||(0,s.default)(f)).call.apply(e,[this].concat(n)));return a.code=f.CODE,a}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(2)),l=r(n(6)),d=r(n(5)),f=(i=Error,(0,d.default)(p,i),(0,c.default)(p,null,[{key:"raise",value:function(e){throw new this(e)}}]),o=a=p,a.CODE="target-not-supported",o);function p(e){return(0,u.default)(this,p),(0,l.default)(this,(p.__proto__||(0,s.default)(p)).call(this,"method"+(e?" "+e:"")+" not supported in target node"))}t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s=r(n(4)),u=r(n(1)),c=r(n(6)),l=r(n(5)),d=(i=Error,(0,l.default)(f,i),o=a=f,a.CODE="wrong-credentials",o);function f(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,u.default)(this,f);for(var n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=(0,c.default)(this,(e=f.__proto__||(0,s.default)(f)).call.apply(e,[this].concat(r))),i=t.tt_login_attempts_left;return o.code=f.CODE,o.loginAttemptsLeft=void 0===i?null:i,o}t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(7));t.default=function(p,e){var y=e.host;return p.defineModel("conversation",{instanceEvents:!0,transientAttrs:["_counterPartyAddedOnServer","_origIndex","highestSortNumber","unreadCount","unreadPriorityCount"],defaultValues:{_unreadMessages:null,_unreadPriorityMessages:null,_markingAsRead:!1,_markingAsReadSortNumber:null,_markingAsReadExpiration:null,firstExpiringUnreadMessage:null,firstUnreadMessage:null,higherContinuation:null,highestSortNumber:0,inProgressEscalationCount:0,isLive:!1,lastBangMessageSortNumber:0,lastIncomingMessageSortNumber:0,lastMessage:null,lowerContinuation:null,markableAsReadMessages:null,messages:null,muted:null,network:g.default.PROVIDER,timeline:null,unreadCount:0,unreadPriorityCount:0},skipCamelizationForKeys:["muted"],parseAttrs:function(e){if("muted"in e&&e.muted){var t=e.muted;if(0<(0,o.default)(t).length){var n=t.mute_duration,r=t.mute_start;r=r&&1e3*+r;var a=y.mute._addEntry(e.id,{durationInMinutes:n,organizationId:e.organizationId,startedAt:r});e.muted=a}else e.muted=null}return e},afterAssignment:function(e){var t=e.counterParty,n=e.counterPartyId,r=e.counterPartyType,a=e.id,o=e.isDeletable,i=e.isMuteable,s=e.muted,u=e.metadata;if(s=p.host.config.condensedReplays?s||y.mute.getById(a):y.mute._getByConversationHandle(a),e.muted=s,e.isMuted=!!e.muted,t?(n=t.id,r=t.$entityType):t=r&&n?p.store.get(r,n):null,e.counterParty=t,e.counterPartyId=n,e.counterPartyType=r,e.shouldDisplay=!("user"===r&&t&&!t.shouldDisplay),y.conversations._setAllowedSenders(e),o=!0,i="distributionList"!==r,t&&"group"===r){var c=t,l=c.groupType,d=c.p2pSender;if(l===h.default.ROLE_P2P){var f=d&&"role"===d.$entityType;o=0<e.allowedSenders.length&&!f,i=i&&0<e.allowedSenders.length}else l===h.default.ESCALATION&&(i=!(o=!1))}e.isDeletable=o,e.isMuteable=i,e._unreadMessages||(e._unreadMessages=[]),e._unreadPriorityMessages||(e._unreadPriorityMessages=[]),e.markableAsReadMessages||(e.markableAsReadMessages=[]),e.messages||(e.messages=[]),e.timeline||(e.timeline=[]),e.higherContinuation||(e.higherContinuation={continuation:p.host.config.condensedReplays?{higher_continuation:null}:"HIGHER",itemsEstimate:null}),e.lowerContinuation||(e.lowerContinuation={continuation:p.host.config.condensedReplays?{lower_continuation:null}:"LOWER",itemsEstimate:null}),u&&"patient_messaging"===u.feature_service&&(e.network=g.default.PATIENT)},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}},hasMany:{content:{type:"message",foreignKey:"conversationId",sortBy:[["sortNumber","asc"]]}}}})};var h=r(n(49)),g=r(n(71));e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.defineModel("distributionList",{replaceKeys:{organizationKey:"organizationId",totalMembers:"memberCount",avatar:"avatarUrl",displayName:"name"},defaultValues:{memberCount:0},afterAssignment:function(e){e.displayName=e.name},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}});return(0,o.default)(n,{finder:function(){var e;return(e=t.host.distributionLists).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return e.host.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return e.host.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{name:"Loading Distribution List..."},defaultNotFoundAttrs:{name:"<Distribution List Not Found>"}}),n};var r,a=n(39),o=(r=a)&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(3)),s=r(n(7)),u=r(n(8)),k=r(n(12)),A=r(n(13));t.default=function(e,t){var E=t.host;return e.defineModel("escalationExecution",{replaceKeys:{destructionDuration:"minutesToExpire",destructionTime:"expiresAt",displayName:"displayId",escalationExecutionId:"id",escalationGroupToken:"groupId",escalationPath:"path",escalationStatus:"status",level:"currentStep",organizationToken:"organizationId",targetDuration:"targetMinutesToAcknowledge",targetToken:"targetId",triggeredMessageToken:"carbonCopyMessageId",triggeringConversationId:"originalGroupConversationId",triggeringMessageToken:"originalMessageId"},defaultValues:{currentStep:0,status:T.default.IN_PROGRESS},parseAttrs:function(e){if("actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),"carbonCopyMessageId"in e&&"string"==typeof e.carbonCopyMessageId&&"undefined"===e.carbonCopyMessageId&&(e.carbonCopyMessageId=null),"displayId"in e&&(e.displayId.startsWith("#")&&(e.displayId=e.displayId.slice(1)),e.displayId=e.displayId.toUpperCase()),"expiresAt"in e&&"string"==typeof e.expiresAt&&(e.expiresAt=new Date(e.expiresAt).getTime()),"groupId"in e&&"string"==typeof e.groupId&&"undefined"===e.groupId&&(e.groupId=null),"path"in e){var t=[],n=!1;if(!(u=e.path)||"function"!=typeof u[A.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+x(u));if(!u||"function"!=typeof u[A.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+_(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,k.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=i.value,l=c.targets,d=c.duration,f=[];if(!l||"function"!=typeof l[A.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+x(l));if(!l||"function"!=typeof l[A.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+_(l));var p=!0,y=!1,h=void 0;try{for(var g,v=(0,k.default)(l);!(p=(g=v.next()).done);p=!0){var m=g.value;if("string"==typeof m)f.push(E.injectPlaceholderModel({id:m},"user"));else if(m&&m.token){var b=m.displayName,w=m.token;f.push(E.injectPlaceholderModel({id:w,displayName:b},"user"))}else n=!0}}catch(e){y=!0,h=e}finally{try{!p&&v.return&&v.return()}finally{if(y)throw h}}t.push({minutesToAcknowledge:d,targets:f})}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}n?delete e.path:e.path=t}return"status"in e&&("init"===e.status&&(e.status="in_progress"),"destruct"===e.status&&(e.status="cancelled"),e.status=T.default.resolve(e.status)),e},afterAssignment:function(e){},relations:{belongsTo:{carbonCopyMessage:{type:"message",foreignKey:"carbonCopyMessageId"},group:{type:"group",foreignKey:"groupId"},organization:{type:"organization",foreignKey:"organizationId"},originalConversation:{type:"conversation",foreignKey:"originalGroupConversationId"},originalMessage:{type:"message",foreignKey:"originalMessageId"},target:{type:"user",foreignKey:"targetId"},escalationGroupConversation:{type:"conversation",foreignKey:"escalationGroupConversationId"}}}})};var T=r(n(70));e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("escalationExecutionChange",{parseAttrs:function(e){return"actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),e}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,u.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,s.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(3)),s=r(n(7)),u=r(n(8)),k=r(n(12)),A=r(n(13));t.default=function(e,t){var E=t.host;return e.defineModel("escalationPolicy",{replaceKeys:{destructionDuration:"minutesToExpire",escalationPath:"path",target:"targetId",targetDuration:"targetMinutesToAcknowledge"},defaultValues:{alwaysEscalate:!1},parseAttrs:function(e){if("path"in e){var t=[],n=!1;if(!(u=e.path)||"function"!=typeof u[A.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+x(u));if(!u||"function"!=typeof u[A.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$path to be iterable, got "+_(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,k.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=i.value,l=c.targets,d=c.duration,f=[];if(!l||"function"!=typeof l[A.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+x(l));if(!l||"function"!=typeof l[A.default]&&!Array.isArray(l))throw new TypeError("Expected targetIds to be iterable, got "+_(l));var p=!0,y=!1,h=void 0;try{for(var g,v=(0,k.default)(l);!(p=(g=v.next()).done);p=!0){var m=g.value;if("string"==typeof m)f.push(E.injectPlaceholderModel({id:m},"user"));else if(m&&m.token){var b=m.displayName,w=m.token;f.push(E.injectPlaceholderModel({id:w,displayName:b},"user"))}else n=!0}}catch(e){y=!0,h=e}finally{try{!p&&v.return&&v.return()}finally{if(y)throw h}}t.push({minutesToAcknowledge:d,targets:f})}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}n?delete e.path:e.path=t}return e},afterAssignment:function(e){},relations:{belongsTo:{target:{type:"user",foreignKey:"targetId"}}}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),o=((0,r(n(2)).default)(i,null,[{key:"is",value:function(e){return e instanceof this}}]),i);function i(e,t,n){(0,a.default)(this,i),this.id=e,this.type=t,this.data=n}t.default=o,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(3)),f=r(n(7)),p=r(n(8)),y=r(n(12)),h=r(n(13));t.default=function(e,t){var l=t.host,n=e.defineModel("group",{replaceKeys:{avatar:"avatarUrl",createdTime:"createdAt",displayName:"name",members:"memberIds",numMembers:"__memberCount",organizationKey:"organizationId",proxied_members:"proxiedMembers"},transientAttrs:["__memberCount"],defaultValues:{hasCurrentUser:!1,isPublic:!1,memberIds:null},skipCamelizationForKeys:["escalation","metadata","proxied_members"],parseAttrs:function(e){if("createdAt"in e&&(e.createdAt=new Date(e.createdAt)),"createdBy"in e&&delete e.createdBy,e.avatarUrl&&(e.avatarUrl=(0,g.cloudFrontUrlTransform)(e.avatarUrl,l.config)),"escalation"in e){var t=l.escalations._updateEscalation(e.escalation,{inGroupInject:!0});delete e.escalation,e.escalationExecutionId=t.id}if(e.memberIds){var n=[];if(!(u=e.memberIds)||"function"!=typeof u[h.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$memberIds to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(u));if(!u||"function"!=typeof u[h.default]&&!Array.isArray(u))throw new TypeError("Expected _attrs$memberIds to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(u));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,y.default)(u);!(r=(i=s.next()).done);r=!0){var u,c=i.value;"string"==typeof c?n.push(c):c.id&&n.push(c.id)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}e.memberIds=n}return e.metadata&&"patient_care"===e.metadata.feature_service&&(e.patientDetails=e.metadata.patient),"metadata"in e&&delete e.metadata,e},afterAssignment:function(e){var t=e.id,n=e.memberIds,r=e.organizationId,a=void 0;l.config.condensedReplays?e.conversationId&&(a=l.conversations.getById(e.conversationId)):a=r?l.conversations.get("group",t,r):null;var o=r?l.metadata.get(t,r):null;o=o&&o.data;var i=l.groups.__extractGroupTypeFromAttrs(e),s=o&&i===u.GroupType.ROLE_P2P?o.target_display_name:e.name;e.conversation=a,e.displayName=s,e.groupType=i,e.memberCount=n&&n.length||e.__memberCount||0,e.metadata=o,"FORUM"!==i&&delete e.hasCurrentUser,l.users._setMembersOnEntity(e),l.groups._setP2PEntities(e)},beforeCreateInstance:function(e){!function(e,t,n){t&&0!==t.length&&l.groups.ensureMembersWithIds(e,t,{onlyPlaceholder:!0,attrs:{organizationId:n}})}(e.id,e.memberIds,e.organizationId)},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},escalationExecution:{type:"escalationExecution",foreignKey:"escalationExecutionId"}}}});return(0,a.default)(n,{finder:function(){var e;return(e=l.groups).find.apply(e,arguments)},placeholderEntityDelayBeforeRefreshing:function(){return l.config.placeholderEntityDelayBeforeRefreshing},placeholderEntityAllowLoading:function(){return l.config.placeholderEntityAllowLoading},defaultPlaceholderAttrs:{displayName:"Loading group..."},defaultNotFoundAttrs:{displayName:"<Group Not Found>"},shouldEnsure:function(e,t,n){var r=n.groupMembersOnlyPlaceholder;return!e.members||!e.metadata||e.groupType===u.GroupType.ROLE_P2P||e.members.some(function(e){return l.models.User.shouldEnsure(e,r)})}}),n};var a=r(n(39)),g=n(74),u=n(26);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("groupMembersChange",{parseAttrs:function(e){return"actionTime"in e&&"string"==typeof e.actionTime&&(e.actionTime=new Date(e.actionTime)),e}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var M=r(n(3)),z=r(n(7)),G=r(n(8)),C=r(n(12)),P=r(n(13)),V=r(n(212));t.default=function(d,e){var R=e.host;return d.defineModel("message",{replaceKeys:{clientId:"id",createdTime:"createdAt",data:"metadata",dndAutoForwardedFrom:"autoForwardedFromId",dor:"deleteOnRead",escalationExecId:"escalationExecutionId",groupAvatar:"groupAvatarUrl",groupToken:"groupId",messageId:"id",originalData:"originalMetadata",originalMsgId:"originalMessageId",originalSenderName:"originalSenderDisplayName",originalTimestamp:"originalForwardedMessageCreatedAt",recipient:"recipientId",recipientOrganization:"recipientOrganizationId",recipientOrgToken:"recipientOrganizationId",recipientToken:"recipientId",sender:"senderId",senderAvatar:"senderAvatarUrl",senderOrganization:"senderOrganizationId",senderOrgToken:"senderOrganizationId",senderToken:"senderId"},transientAttrs:["__organizationId","$synced","escalationExecutionChange","groupMembersChange","inTimeline"],defaultValues:{inTimeline:!1,isUnread:!0,messageType:N.MessageType.USER_SENT,senderStatus:N.MessageRecipientStatus.NEW,shouldEnsureRecipientStatus:!1,sortNumber:0},skipCamelizationForKeys:["escalation","metadata","originalMetadata"],parseAttrs:function(e){if("attachmentName"in e){var t=e.attachmentName;delete e.attachmentName,"undefined"!==t&&Array.isArray(e.attachments)&&0<e.attachments.length&&t&&(e.attachments[0].name=t)}if(Array.isArray(e.attachments)&&e.attachments.forEach(function(e,t){return e.id=""+(t+1)}),"priority"in e&&(e.priority=N.MessagePriority.resolve(e.priority)),"createdAt"in e&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),"expireIn"in e&&(e.expiresAt=Date.now()+1e3*e.expireIn,delete e.expireIn),"recipientStatus"in e&&delete e.recipientStatus,"status"in e&&delete e.status,"xmlns"in e&&delete e.xmlns,"escalation"in e){var n=R.escalations._updateEscalation(e.escalation);delete e.escalation,e.escalationExecutionId=n.id}if("subType"in e&&(e.subType=N.MessageSubType.resolve(e.subType)),e.metadata){e.metadata=(0,V.default)(e.metadata).map(R.metadata.__parseMessageMetadata).filter(Boolean);var r=e.metadata.find(function(e){return"tigertext:message:role:sender"===e.namespace}),a=e.metadata.find(function(e){return"tigertext:message:role:owner"===e.namespace}),o=e.metadata.find(function(e){return"tigertext:message:patient_care"===e.namespace});if(r&&r.payload){var i=e.senderOrganizationId,s=r.payload;e.senderRole=R.roles.__parseRoleFromMetadata({metadata:s,organizationId:i}),e.currentSenderRoleId=e.senderRole.id}if(a&&a.payload){var u=e.senderOrganizationId,c=e.senderId,l=a.payload;e.senderId=l.token,c!==l.token&&(e.senderRole={$entityType:"role",botUserId:c,id:"role:"+c,organizationId:u},e.currentSenderRoleId="role:"+c)}if(o&&o.payload){var d=[];if(!(v=o.payload.components)||"function"!=typeof v[P.default]&&!Array.isArray(v))throw new TypeError("Expected _patientCareAttrs$pay to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,G.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,z.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,M.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(v));if(!v||"function"!=typeof v[P.default]&&!Array.isArray(v))throw new TypeError("Expected _patientCareAttrs$pay to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,G.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,z.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,M.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(v));var f=!0,p=!1,y=void 0;try{for(var h,g=(0,C.default)(v);!(f=(h=g.next()).done);f=!0){var v,m=h.value;"type"in m&&(m.type=N.PatientCareCardUIType.resolve(m.type)),"sub_type"in m&&(m.sub_type=N.PatientCareCardType.resolve(m.sub_type)),"action_type"in m&&(m.action_type=N.PatientCareCardActionType.resolve(m.action_type)),d.push(m)}}catch(e){p=!0,y=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw y}}e.patientCareCard=d}}else"metadata"in e&&delete e.metadata;if(e.originalMetadata){e.originalMetadata=(0,V.default)(e.originalMetadata).map(R.metadata.__parseMessageMetadata).filter(Boolean);var b=e.originalMetadata.find(function(e){return"tigertext:message:role:sender"===e.namespace}),w=e.originalMetadata.find(function(e){return"tigertext:message:role:owner"===e.namespace});if(b&&b.payload){var E=e.senderOrganizationId,x=b.payload;e.originalSenderRole=R.roles.__parseRoleFromMetadata({metadata:x,organizationId:E})}if(w&&w.payload){var _=e.originalSender,k=e.originalSenderDisplayName,A=e.originalSenderRole,T=e.senderOrganizationId,I=w.payload;A||"string"!=typeof _||(e.originalSenderRole={$entityType:"role",botUserId:_,displayName:k,id:"role:"+_,organizationId:T}),(!_||_&&"string"==typeof _)&&(e.originalSender={$entityType:"user",displayName:I.display_name,id:I.token,organizationId:T})}}if("originalSender"in e&&"string"==typeof e.originalSender){var O=e.senderOrganizationId,j=e.originalSender,S=e.originalSenderDisplayName;e.originalSender={$entityType:"user",displayName:S,id:j,organizationId:O},delete e.originalSenderDisplayName}return e},afterAssignment:function(e){var t=e.__organizationId,n=e.counterParty,r=e.counterPartyId,a=e.counterPartyType,o=e.createdAt,i=e.isOutgoing,s=e.recipientOrganizationId,u=e.senderId,c=e.senderOrganizationId,l=R.currentUserId;if(n)switch(r=n.id,a=n.$entityType){case"group":e.groupId=r,delete e.recipientId;break;case"distributionList":e.distributionListId=r,delete e.recipientId}else n=a&&r?d.store.get(a,r):null;e.counterParty=n,e.counterPartyId=r,e.counterPartyType=a,o=o||new Date,u&&(i=R.messages._isMessageOutgoing(e)),i&&c?t=c:!i&&s&&(t=s),e.__organizationId=t,e.canRecall="distributionList"!==a&&u===l,e.createdAt=o,e.isOutgoing=i,e.isAutoForwarded=!!e.autoForwardedFromId,e.subType||(e.subType=N.MessageSubType.NA),R.messages._setRecipientStatus(e)},relations:{belongsTo:{autoForwardedFrom:{type:"user",foreignKey:"autoForwardedFromId"},conversation:{type:"conversation",foreignKey:"conversationId"},currentSenderRole:{type:"role",foreignKey:"currentSenderRoleId"},distributionList:{type:"distributionList",foreignKey:"distributionListId"},escalationExecution:{type:"escalationExecution",foreignKey:"escalationExecutionId"},group:{type:"group",foreignKey:"groupId"},recipient:{type:"user",foreignKey:"recipientId"},recipientOrganization:{type:"organization",foreignKey:"recipientOrganizationId"},sender:{type:"user",foreignKey:"senderId"},senderOrganization:{type:"organization",foreignKey:"senderOrganizationId"}},hasMany:{statusesPerRecipient:{type:"messageStatusPerRecipient",foreignKey:"messageId"}}}})};var N=n(26);e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.defineModel("messageStatusPerRecipient",{replaceKeys:{accountId:"userId",timestamp:"createdAt"},defaultValues:{status:o.default.NA},parseAttrs:function(e){return e.status&&(e.status=o.default.resolve(e.status)),e.createdAt&&"string"==typeof e.createdAt&&(e.createdAt=new Date(e.createdAt)),e},beforeInject:function(e,t){if(t){var n=t.status,r=e.status;a.MESSAGE_STATUS_ORDER[r]<a.MESSAGE_STATUS_ORDER[n]&&(delete e.createdAt,delete e.status)}},relations:{belongsTo:{distributionList:{type:"distributionList",foreignKey:"distributionListId"},message:{type:"message",foreignKey:"messageId"},user:{type:"user",foreignKey:"userId"}}}})};var r,a=n(38),o=(r=a)&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("metadata",{parseAttrs:function(e,t){return e.data=t.data,e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.host,e.defineModel("mute",{parseAttrs:function(e){return e},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.host;return e.defineModel("product",{defaultValues:{activeProcessingEvents:null,organizations:null,unreadCount:0,unreadPriorityCount:0},transientAttrs:["organizations","unreadCount","unreadPriorityCount"],afterAssignment:function(e){var t=e.id;e.productRoles=n.userRoles.getByProductId(t),null===e.activeProcessingEvents&&(e.activeProcessingEvents=[]),null===e.organizations&&(e.organizations=[])}})},e.exports=t.default},function(e,t){"use strict";function n(e,t){return!!e&&e.includes(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("productRoles",{defaultValues:{roles:[]},afterAssignment:function(e){var t=e.roles;e.isAdmin=n(t,"tt_admin"),e.isAnalyticsAdmin=n(t,"tt_reporting"),e.isLdapAdmin=n(t,"tt_ldap"),e.isSuperAdmin=n(t,"tt_super_admin")},methods:{hasRole:function(e){return!!this.roles&&this.roles.includes(e)}},relations:{belongsTo:{product:{type:"product",foreignKey:"productId"},user:{type:"user",foreignKey:"userId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.host;return e.defineModel("role",{defaultValues:{description:"",memberIds:null,roleTagId:null},afterAssignment:function(e){n.users._setMembersOnEntity(e)},relations:{belongsTo:{assignmentGroup:{type:"group",foreignKey:"assignmentGroupId"},botUser:{type:"user",foreignKey:"botUserId"},escalationPolicy:{type:"escalationPolicy",foreignKey:"escalationPolicyId"},organization:{type:"organization",foreignKey:"organizationId"},roleTag:{type:"roleTag",foreignKey:"roleTagId"}}}})},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("roleTag",{replaceKeys:{tagColor:"color",tagName:"name"},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"}},hasMany:{roles:{type:"role",foreignKey:"roleTagId"}}},parseAttrs:function(e){if("colorValue"in e){var t=e.color,n=e.colorValue;e.color=n,e.colorId=t,delete e.colorValue}return"color"in e&&(e.color=e.color.replace("0x","#")),e},afterAssignment:function(e){var t=e.name;e.displayName=t,e.isDefault=t&&t.startsWith("Default")}})},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),o=((0,r(n(2)).default)(i,null,[{key:"is",value:function(e){return e instanceof this}}]),i);function i(e,t,n,r){(0,a.default)(this,i),this.id="searchResult:"+t+":"+e.id,this.entity=e,this.entityId=e.id,this.entityType=e.$entityType,this.metadata=r,this.organizationId=t,this.conversationId=n}t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.defineModel("userRoles",{defaultValues:{roles:[]},afterAssignment:function(e){var t=e.organizationId===r.CONTACTS_ORG_ID,n=e.roles;e.isAdmin=n.includes("admin"),e.isHelpDesk=n.includes("help_desk"),e.isRoleAdmin=n.includes("feature_role_admin"),e.reportingEnabled=n.includes("reporting")&&!t,e.reportingEnabledOnAllOrgs=n.includes("reporting_view_orgs")&&!t},methods:{hasRole:function(e){return this.roles.includes(e)}},relations:{belongsTo:{organization:{type:"organization",foreignKey:"organizationId"},user:{type:"user",foreignKey:"userId"}}}})};var r=n(69);e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),o=new((r=a)&&r.__esModule?r:{default:r}).default(["CONTACTS_MESSAGING_BLOCKED_BY_ADMIN","CONVERSATION_NOT_FULLY_LOADED","CONVERSATION_WITH_ROLE_YOU_ARE_CURRENTLY_IN","COUNTER_PARTY_IS_TIGERPAGE","COUNTER_PARTY_NOT_FULLY_LOADED","COUNTER_PARTY_TYPE_NOT_SUPPORTED","GROUP_HAS_NO_MEMBERS","GROUP_MEMBERS_NOT_LOADED","IS_ROLE_ASSIGNMENT_GROUP","NO_COUNTER_PARTY","USER_IS_NOT_IN_THIS_ROLE_CONVERSATION","USER_IS_NOT_MEMBER_OF_GROUP","NONE"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({CONTINUATION:{serverValue:"continuation"},CONVERSATION_END:{serverValue:"conversation_end"},FIRST_UNREAD_ITEM:{serverValue:"first_unread_item"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({ACKNOWLEDGED:{serverValue:"escalation_acknowledged"},CANCELLED:{serverValue:"escalation_cancelled"},INITIATED:{serverValue:"escalation_initiated"},MEMBER_ADDED:{serverValue:"escalation_member_added"},NO_RESPONSE:{serverValue:"escalation_no_response"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({LOW:{serverValue:-1},NORMAL:{serverValue:0},HIGH:{serverValue:1}},{defaultValue:"NORMAL"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),o=new((r=a)&&r.__esModule?r:{default:r}).default(["SENDING","SENT","FAILED","RETRYING","NEW","NA"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({EMPTY_ROLE_NOTIFICATION:{serverValue:"empty_role_notification"},NA:{key:"NA"},ROLE_AWAY_NOTIFICATION:{serverValue:"role_away_notification"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(19),o=new((r=a)&&r.__esModule?r:{default:r}).default(["ESCALATION_EXECUTION_CHANGE","GROUP_MEMBERSHIP_CHANGE","HIGHER_CONTINUATION","LOWER_CONTINUATION","USER_SENT"]);t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({ADD_MEMBERS:{serverValue:"add_members"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({ADMIT:{serverValue:"admit"},DISCHARGE:{serverValue:"discharge"},LAB:{serverValue:"lab"},TRANSFER:{serverValue:"transfer"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({ACTION:{serverValue:"ehr_action_item"},HEADER:{serverValue:"ehr_header"},ITEM:{serverValue:"table_item"},TEXT:{serverValue:"ehr_text_view"}},{defaultValue:"NA"});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(19).ServerValueEnum)({DISTRIBUTION_LIST:{serverValue:"distribution_list"},FORUM:{serverValue:"public_group"},GROUP:{serverValue:"group"},ORGANIZATION:{serverValue:"organization"},TAG:{serverValue:"tag"},USER:{serverValue:"account"}});t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Conversation:n(130),DistributionList:n(131),EscalationExecution:n(132),EscalationExecutionChange:n(133),EscalationPolicy:n(134),Group:n(136),GroupMembersChange:n(137),Message:n(138),MessageStatusPerRecipient:n(139),Metadata:n(140),Mute:n(141),Organization:n(69).default,Product:n(142),ProductRoles:n(143),Role:n(144),RoleTag:n(145),User:n(48).default,UserRoles:n(147)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function fe(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,P.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=fe(t[0],n);return t.every(function(e){return fe(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return fe(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,C.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,G.default)(e))+": "+fe(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function pe(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,P.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=pe(t[0],n);return t.every(function(e){return pe(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return pe(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,C.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,G.default)(e))+": "+pe(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G=r(n(3)),C=r(n(7)),P=r(n(8)),V=r(n(11)),N=r(n(15)),U=r(n(33)),F=r(n(20)),ye=r(n(10)),he=r(n(29)),ge=r(n(21)),L=r(n(9)),ve=r(n(12)),me=r(n(13)),$=r(n(4)),D=r(n(1)),B=r(n(2)),q=r(n(6)),Z=r(n(5)),K=r(n(31)),H=r(n(229)),W=r(n(56)),X=r(n(24)),Q=r(n(14)),Y=r(n(54)),J=r(n(205)),ee=r(n(40)),te=r(n(35)),ne=r(n(88)),re=n(18),ae=r(n(85)),oe=r(n(17)),be=n(26),ie=n(38),we=r(ie),se=n(22),ue=n(30),ce=n(27),le=new ae.default.MD5,de=[be.MessageType.ESCALATION_EXECUTION_CHANGE,be.MessageType.GROUP_MEMBERSHIP_CHANGE],Ee=(o={},(0,K.default)(o,be.EscalationChangeAction.ACKNOWLEDGED,"Acknowledged"),(0,K.default)(o,be.EscalationChangeAction.CANCELLED,"Cancelled"),(0,K.default)(o,be.EscalationChangeAction.INITIATED,"Initiated"),(0,K.default)(o,be.EscalationChangeAction.MEMBER_ADDED,"Added"),(0,K.default)(o,be.EscalationChangeAction.NO_RESPONSE,"ended with No Response"),o),xe=[be.GroupType.ROLE_ASSIGNMENT,be.GroupType.ROLE_P2P],_e=(i={},(0,K.default)(i,"ADD","added"),(0,K.default)(i,"JOIN","joined"),(0,K.default)(i,"LEAVE","left"),(0,K.default)(i,"REMOVE","removed"),i),ke=(s={},(0,K.default)(s,"ADD","to"),(0,K.default)(s,"REMOVE","from"),s),Ae=(u={},(0,K.default)(u,be.GroupType.ESCALATION,"escalation"),(0,K.default)(u,be.GroupType.FORUM,"forum"),(0,K.default)(u,be.GroupType.GROUP,"group"),(0,K.default)(u,be.GroupType.PATIENT_CARE,"care team"),(0,K.default)(u,be.GroupType.ROLE_P2P,"conversation"),u),Te=[we.default.NEW,we.default.DELIVERED],Ie=(c={},(0,K.default)(c,"OPT_IN","opted into"),(0,K.default)(c,"OPT_OUT","opted out of"),c),Oe=(l=(0,re.decorator)(),d=(0,re.decorator)(),f=(0,re.decorator)(),y=Q.default,(0,Z.default)(je,y),(0,B.default)(je,[{key:"mounted",value:function(){this._convByConvHandle={},this._fetched=!1,this._rolesFriendsEventPromise=null,this.__escalationEnabledOrganizations=[],this.__queuedConversationsToReload=[],this._roleConversationsProcessingEvent={},this.host.on("message:sending",this._onSendingMessage),this.host.on("message:sent",this._onSentMessage),this.host.models.Group.on("afterEject",this._onRemoveGroup),this.host.models.Message.on("afterInject",this._onChangeMessage),this.host.models.Message.on("afterEject",this._onRemoveMessage),this.host.models.Organization.on("afterInject",this._onChangeOrganization)}},{key:"dispose",value:function(){this._convByConvHandle={},this._fetched=!1,this._rolesFriendsEventPromise=null,this.__escalationEnabledOrganizations=[],this.__queuedConversationsToReload=[],this.host.removeListener("message:sending",this._onSendingMessage),this.host.removeListener("message:sent",this._onSentMessage),this.host.models.Group.removeListener("afterEject",this._onRemoveGroup),this.host.models.Message.removeListener("afterInject",this._onChangeMessage),this.host.models.Message.removeListener("afterEject",this._onRemoveMessage),this.host.models.Organization.removeListener("afterInject",this._onChangeOrganization)}},{key:"clearTimeline",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).emit,n=void 0===t||t;this.clearMessageStatuses(e,{emit:!1});var r=e.higherContinuation,a=e.lowerContinuation,o=e.timeline,i=0;if(!o||"function"!=typeof o[me.default]&&!Array.isArray(o))throw new TypeError("Expected timeline to be iterable, got "+fe(o));if(!o||"function"!=typeof o[me.default]&&!Array.isArray(o))throw new TypeError("Expected timeline to be iterable, got "+pe(o));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,ve.default)(o);!(s=(l=d.next()).done);s=!0)l.value.inTimeline=!1,i+=1}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}return e.isLive=!1,r.itemsEstimate=null,a.itemsEstimate=null,n&&this.emit("clearTimeline",e.id),this.config.condensedReplays?this.host.models.Conversation.inject(e):this.__reloadConversation(e,{notify:!1}),i}},{key:"fetchTimeline",value:(z=(0,L.default)(ye.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C,P,V,N,U,F,L,$,D,B,q,Z,K,H,W,X,Q,Y,J,ee,te,ne,re,ae=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},oe=ae.anchorPoint,ie=void 0===oe?be.ConversationAnchorPoints.CONVERSATION_END:oe,se=ae.continuation,ue=ae.markAsDelivered,ce=void 0!==ue&&ue,le=ae.maxItems,de=void 0===le?15:le;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getById(t),r=n.content,a=n._savedFirstUnreadMessage,o=n.timeline,i=r.length,s=0,u=[],c=i-de,l=i,this.config.condensedReplays&&(n._savedFirstUnreadMessage=null),ie!==be.ConversationAnchorPoints.CONVERSATION_END){e.next=12;break}this.clearTimeline(n,{emit:!1}),e.next=92;break;case 12:if(ie!==be.ConversationAnchorPoints.FIRST_UNREAD_ITEM){e.next=50;break}if(this.clearTimeline(n,{emit:!1}),this.config.condensedReplays){e.next=48;break}if(!(g=r.entries())||"function"!=typeof g[me.default]&&!Array.isArray(g))throw new TypeError("Expected _content$entries to be iterable, got "+fe(g));e.next=18;break;case 18:if(!g||"function"!=typeof g[me.default]&&!Array.isArray(g))throw new TypeError("Expected _content$entries to be iterable, got "+pe(g));e.next=20;break;case 20:f=!(d=!0),p=void 0,e.prev=23,y=(0,ve.default)(g);case 25:if(d=(h=y.next()).done){e.next=33;break}if(v=(0,ge.default)(h.value,2),m=v[0],b=v[1],l=m,a&&a===b)return e.abrupt("break",33);e.next=30;break;case 30:d=!0,e.next=25;break;case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(23),f=!0,p=e.t0;case 39:e.prev=39,e.prev=40,!d&&y.return&&y.return();case 42:if(e.prev=42,f)throw p;e.next=45;break;case 45:return e.finish(42);case 46:return e.finish(39);case 47:l<r.length&&(l=Math.min(l+de,r.length));case 48:e.next=92;break;case 50:if(this.config.condensedReplays||ie!==be.ConversationAnchorPoints.CONTINUATION){e.next=92;break}if(w=o[0]?o[0].sortNumber:1/0,E=o[o.length-1]?o[o.length-1].sortNumber:0,0!==(x="LOWER"===se?w:E)){e.next=58;break}l-=de,e.next=92;break;case 58:if(!(O=r.entries())||"function"!=typeof O[me.default]&&!Array.isArray(O))throw new TypeError("Expected _content$entries2 to be iterable, got "+fe(O));e.next=61;break;case 61:if(!O||"function"!=typeof O[me.default]&&!Array.isArray(O))throw new TypeError("Expected _content$entries2 to be iterable, got "+pe(O));e.next=63;break;case 63:k=!(_=!0),A=void 0,e.prev=66,T=(0,ve.default)(O);case 68:if(_=(I=T.next()).done){e.next=78;break}if(j=(0,ge.default)(I.value,2),m=j[0],b=j[1],l=m,"HIGHER"===se&&b.sortNumber>x)return e.abrupt("break",78);e.next=73;break;case 73:if("LOWER"===se&&b.sortNumber>=x)return e.abrupt("break",78);e.next=75;break;case 75:_=!0,e.next=68;break;case 78:e.next=84;break;case 80:e.prev=80,e.t1=e.catch(66),k=!0,A=e.t1;case 84:e.prev=84,e.prev=85,!_&&T.return&&T.return();case 87:if(e.prev=87,k)throw A;e.next=90;break;case 90:return e.finish(87);case 91:return e.finish(84);case 92:if(this.config.condensedReplays){e.next=122;break}if(ie!==be.ConversationAnchorPoints.CONVERSATION_END&&(ie===be.ConversationAnchorPoints.CONTINUATION&&"HIGHER"===se?i=(c=l)+de:(l===r.length-1&&(l+=1),c=(i=l)-de)),i=Math.min(i,r.length+1),c=Math.max(c,0),u.push.apply(u,(0,he.default)(r.slice(c,i))),!u||"function"!=typeof u[me.default]&&!Array.isArray(u))throw new TypeError("Expected messagesToAdd to be iterable, got "+fe(u));e.next=99;break;case 99:if(!u||"function"!=typeof u[me.default]&&!Array.isArray(u))throw new TypeError("Expected messagesToAdd to be iterable, got "+pe(u));e.next=101;break;case 101:for(R=!(S=!0),M=void 0,e.prev=104,z=(0,ve.default)(u);!(S=(G=z.next()).done);S=!0)(b=G.value).inTimeline||(b.inTimeline=!0,this.host.models.Message.inject(b),s+=1);e.next=112;break;case 108:e.prev=108,e.t2=e.catch(104),R=!0,M=e.t2;case 112:e.prev=112,e.prev=113,!S&&z.return&&z.return();case 115:if(e.prev=115,R)throw M;e.next=118;break;case 118:return e.finish(115);case 119:return e.finish(112);case 120:e.next=160;break;case 122:return e.next=124,this.host.api.conversations.fetchTimeline(t,be.ConversationAnchorPoints.toServer(ie),de,{continuation:se,markAsDelivered:ce});case 124:if(C=e.sent,P=C.direction,V=C.higher_continuation,N=C.lower_continuation,!(U=C.timeline)||"function"!=typeof U[me.default]&&!Array.isArray(U))throw new TypeError("Expected timeline to be iterable, got "+fe(U));e.next=131;break;case 131:if(!U||"function"!=typeof U[me.default]&&!Array.isArray(U))throw new TypeError("Expected timeline to be iterable, got "+pe(U));e.next=133;break;case 133:for(L=!(F=!0),$=void 0,e.prev=136,D=(0,ve.default)(U);!(F=(B=D.next()).done);F=!0)q=B.value,"tigertext:iq:bang"===(Z=q.xmlns)?(K=q.bang_id||""+q.sort_number)?this.host.groups.__handleBang({data:q,eventId:K,alwaysAddToTimeline:!0}):this.logger.warn("Skipping bang with no event id"):"tigertext:iq:message"===Z||"tigertext:iq:group_message"===Z?(q.conversation_id||(q.conversation_id=t),H=this._reactToMessageEventCR({data:q,injectConversation:!1}),(W=H.message).isUnread&&!a&&((n._savedFirstUnreadMessage=W).unreadMessageCount&&(n.unreadCount=W.unreadMessageCount),W.unreadPriorityMessageCount&&(n.unreadPriorityCount=W.unreadPriorityMessageCount)),W.inTimeline=!0,"user"===n.counterPartyType&&(X={id:W.id+":"+W.counterPartyId,messageId:W.id,status:we.default.resolve(q.status),userId:this.host.currentUserId},this.host.models.MessageStatusPerRecipient.inject(X)),W.senderStatus=be.MessageSenderStatus.SENT,this.host.models.Message.inject(W)):this.logger.warn("Skipping timeline entry with unrecognized xmlns: "+Z);e.next=144;break;case 140:e.prev=140,e.t3=e.catch(136),L=!0,$=e.t3;case 144:e.prev=144,e.prev=145,!F&&D.return&&D.return();case 147:if(e.prev=147,L)throw $;e.next=150;break;case 150:return e.finish(147);case 151:return e.finish(144);case 152:if("Higher"!==P&&"Initial"!==P||(Q=0===U.length?0:1,ie===be.ConversationAnchorPoints.CONVERSATION_END&&(Q=0),1===Q&&"Initial"===P&&(Y=U[U.length-1].message_id)&&(J=this.host.messages.getById(Y),ee=J.isOutgoing,te=J.isUnread,ne=void 0===te||te,!ee&&ne||(Q=0)),n.higherContinuation={continuation:{higher_continuation:V},itemsEstimate:Q}),"Lower"!==P&&"Initial"!==P||(n.lowerContinuation={continuation:{lower_continuation:N},itemsEstimate:0===U.length?0:1}),re=n.lowestSortNumber,ie!==be.ConversationAnchorPoints.CONTINUATION&&void 0!==re)return e.next=158,this.markAsDelivered(n.id);e.next=158;break;case 158:s=U.length,n.isLive=0===n.higherContinuation.itemsEstimate;case 160:return this.host.models.Conversation.inject(n),e.abrupt("return",s);case 162:case"end":return e.stop()}},e,this,[[23,35,39,47],[40,,42,46],[66,80,84,92],[85,,87,91],[104,108,112,120],[113,,115,119],[136,140,144,152],[145,,147,151]])})),function(e){return z.apply(this,arguments)})},{key:"findAll",value:(M=(0,L.default)(ye.default.mark(function e(){var t,n,r,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,X.default)(a,{includeMutes:!0}),this.config.condensedReplays&&(a.includeMutes=!1),this._fetched)return e.abrupt("return",this.getAll());e.next=4;break;case 4:return e.next=6,F.default.all([this.host.api.roster.findAll(),a.includeMutes?this.host.mute.findAll():F.default.resolve()]);case 6:if(t=e.sent,n=(0,ge.default)(t,1),r=n[0],this.config.condensedReplays)return e.abrupt("return",this._processFindAllCR(r));e.next=13;break;case 13:return e.abrupt("return",this._processFindAll(r));case 14:case"end":return e.stop()}},e,this)})),function(){return M.apply(this,arguments)})},{key:"findAllForOrganization",value:(R=(0,L.default)(ye.default.mark(function e(t){var n;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._resolveModelIdWithTypes(t,"organization"),this.config.condensedReplays){e.next=3;break}throw new oe.default.NotSupportedError("findAllForOrganization() may not be called if this.config.condensedReplays=false");case 3:if(this._fetched)return e.abrupt("return",this.getAllForOrganization(t));e.next=5;break;case 5:return e.next=7,this.host.api.roster.findAll({organizationId:t});case 7:return n=e.sent,e.abrupt("return",this._processFindAllCR(n));case 9:case"end":return e.stop()}},e,this)})),function(e){return R.apply(this,arguments)})},{key:"_processFindAllCR",value:function(e){for(var t=[],n=[],r={organization:"placeholder"},a=0;a<e.length;a++){var o=e[a],i=o.entity;if(i){var s=this.host.modelNameByEntityType(i.type);"user"===s?n.push({rawConversation:o,origIndex:a}):s&&t.push({rawConversation:o,origIndex:a})}}if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected users to be iterable, got "+fe(n));if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected users to be iterable, got "+pe(n));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,ve.default)(n);!(u=(d=f.next()).done);u=!0){var p=d.value,y=p.rawConversation,h=p.origIndex;p.conversation=this.__injectConversation(y,{origIndex:h})}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}if(!t||"function"!=typeof t[me.default]&&!Array.isArray(t))throw new TypeError("Expected nonUsers to be iterable, got "+fe(t));if(!t||"function"!=typeof t[me.default]&&!Array.isArray(t))throw new TypeError("Expected nonUsers to be iterable, got "+pe(t));var g=!0,v=!1,m=void 0;try{for(var b,w=(0,ve.default)(t);!(g=(b=w.next()).done);g=!0){var E=b.value,x=E.rawConversation,_=E.origIndex;E.conversation=this.__injectConversation(x,{origIndex:_})}}catch(e){v=!0,m=e}finally{try{!g&&w.return&&w.return()}finally{if(v)throw m}}for(var k=[];0<t.length||0<n.length;){var A=(0===t.length?n.shift():0===n.length?t.shift():t[0].origIndex<n[0].origIndex?t.shift():n.shift()).conversation;this.__ensureEntities(A,r),k.push(A)}return this._fetched=!0,k}},{key:"_processFindAll",value:function(e){for(var t=[],n=[],r=[],a=0;a<e.length;a++){var o=e[a],i=o,s=i.organization_key,u=i.type,c=(0,U.default)(i,["organization_key","type"]),l=this.host.modelNameByTypeNS(u);c.organizationId=s,"user"===(o={entityAttrs:c,entityType:l,organizationId:s,origIndex:a}).entityType?(o.counterParty=this.__injectCounterParty(o),r.push(o)):o.entityType&&("group"===l&&(o.groupType=this.host.groups.__extractGroupTypeFromAttrs(c)),o.groupType===be.GroupType.FORUM&&delete c.members,n.push(o))}if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected toProcess to be iterable, got "+fe(n));if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected toProcess to be iterable, got "+pe(n));var d=!0,f=!1,p=void 0;try{for(var y,h=(0,ve.default)(n);!(d=(y=h.next()).done);d=!0){var g=y.value;g.counterParty=this.__injectCounterParty((0,N.default)({},g,{hasCurrentUser:!0})),t.push(g)}}catch(e){f=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(f)throw p}}for(var v=[];0<t.length||0<r.length;){var m=0===t.length?r.shift():0===r.length?t.shift():t[0].origIndex<r[0].origIndex?t.shift():r.shift(),b=m.conversationId,w=m.counterParty,E=m.lastMessage,x=m.muted;s=m.organizationId,delete w.$placeholder;var _=void 0;this.host.config.condensedReplays&&E&&(_=E.sort_number);var k=this.ensureConversation(w.$entityType,w.id,s,{conversationId:b,ensureEntities:{organization:"placeholder"},highestSortNumber:_,muted:x});k._counterPartyAddedOnServer=!0,v.push(k)}return this._fetched=!0,v}},{key:"find",value:(S=(0,L.default)(ye.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));e.next=4;break;case 4:if(a=(0,W.default)(a,{ensureEntities:{counterParty:"full",escalationExecution:"full",groupMembers:"placeholder",messageCounterParties:"full",organization:"placeholder",touchOnRelatedEntityLoad:!1}}),n=void 0,this.config.condensedReplays)return e.next=9,this.host.api.conversations.find(t);e.next=17;break;case 9:if(r=e.sent){e.next=12;break}throw new oe.default.NotFoundError(this.host.models.Conversation.name,t);case 12:if(n=this.__injectConversation(r)){e.next=15;break}throw new oe.default.NotFoundError(this.host.models.Conversation.name,t);case 15:e.next=24;break;case 17:if(n=this.getById(t)){e.next=22;break}return e.next=21,this.findAll();case 21:n=this.getById(t);case 22:if(n){e.next=24;break}throw new oe.default.NotFoundError(this.host.models.Conversation.name,t);case 24:return e.next=26,this.__ensureEntities(n,a.ensureEntities);case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"__injectConversation",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.highestSortNumber,r=t.origIndex,a=void 0===r?this.host.models.Conversation.getAll().length:r,o=void 0,i=e.conversation_id,s=e.entity,u=e.first_expiring_unread_message,c=e.in_progress_escalation_count,l=e.last_message,d=e.lowest_sort_number,f=e.muted,p=e.organization_id,y=e.unread_message_count,h=e.unread_priority_message_count,g=this.getById(i);if(g)o=g.counterParty,p=g.organizationId;else{if(p=p||e.organization_key,!f&&s&&s.muted&&(f=s.muted,delete s.muted),s&&(o=this.__injectCounterParty({conversationId:i,entityAttrs:s,entityType:s.$entityType,hasCurrentUser:!0,organizationId:p})),!o)return null;delete o.$placeholder,g=g||this.host.models.Conversation.createInstance({id:i,counterParty:o,organizationId:p,_origIndex:a})}var v=o,m=v.id,b=v.$entityType;u&&(l&&(l.message_id===u.message_id?u=l:(u.senderId=l.sender_token,u.senderOrganizationId=l.sender_organization)),g.firstExpiringUnreadMessage=this._ensureFirstExpiringUnreadMessage({rawFirstExpiringUnreadMessage:u,conversationId:i,counterParty:o})),l&&(g.lastMessage=this._ensureLastMessage({rawLastMessage:l,conversationId:i,counterParty:o}),void 0===n&&(n=l.sort_number)),g._counterPartyAddedOnServer=!0,s&&s.metadata&&(g.metadata=s.metadata),void 0!==n&&(g.highestSortNumber=n),void 0!==d&&0!==d&&(g.lowestSortNumber=d),void 0!==c&&(g.inProgressEscalationCount=c),void 0!==f&&(g.muted=f),void 0!==y&&(g.unreadCount=y),void 0!==h&&(g.unreadPriorityCount=h),this.host.models.Conversation.inject(g);var w=this.getConversationKey(b,m,p);return this._convByConvHandle[w]=g}},{key:"refetch",value:(j=(0,L.default)(ye.default.mark(function e(){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._fetched=!1,e.abrupt("return",this.findAll());case 2:case"end":return e.stop()}},e,this)})),function(){return j.apply(this,arguments)})},{key:"_ensureLastMessage",value:function(e){var t=e.rawLastMessage,n=e.conversationId,r=e.counterParty,a=t.message_id,o=(0,U.default)(t,["message_id"]);if(a){var i=this.host.messages.getById(a);return i?(i.shouldEnsureRecipientStatus=!0,i.senderStatus=be.MessageSenderStatus.SENT,this.host.models.Message.inject(i)):(o.senderStatus=be.MessageSenderStatus.SENT,o.id=a,o.shouldEnsureRecipientStatus=!0,o.conversationId=n,o.counterParty=r,i=this.host.models.Message.injectPlaceholder(o)),i}return null}},{key:"_ensureFirstExpiringUnreadMessage",value:function(e){var t=e.rawFirstExpiringUnreadMessage,n=e.conversationId,r=e.counterParty,a=t.expire_in,o=t.message_id,i=(0,U.default)(t,["expire_in","message_id"]);if(o){var s=this.host.messages.getById(o);return s?(s.shouldEnsureRecipientStatus=!0,s.expireIn=a,this.host.models.Message.inject(s)):(i.id=o,i.shouldEnsureRecipientStatus=!0,i.expireIn=a,i.conversationId=n,i.counterParty=r,s=this.host.models.Message.injectPlaceholder(i)),s}return null}},{key:"markAsDelivered",value:(O=(0,L.default)(ye.default.mark(function e(t){var n,r,a;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new oe.default.NotFoundError(this.host.models.Conversation.name,t);case 7:if(t=this._resolveModelId(t),this.config.condensedReplays)return r=n.lowestSortNumber,e.prev=10,a=we.default.toServer(we.default.DELIVERED),e.next=14,this.host.api.conversations.updateConversationStatus(t,a,{lowestSortNumber:r});e.next=23;break;case 14:n.lowestSortNumber=null,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),this.logger.warn("failed to mark conversation "+t+" as delivered");case 20:this.host.models.Conversation.inject(n),e.next=24;break;case 23:return e.abrupt("return",this.host.messages.markAsDelivered(n.messages));case 24:case"end":return e.stop()}},e,this,[[10,17]])})),function(e){return O.apply(this,arguments)})},{key:"markAsRead",value:(I=(0,L.default)(ye.default.mark(function e(t){var n,r,a,o,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new oe.default.NotFoundError(this.host.models.Conversation.name,t);case 7:if(t=this._resolveModelId(t),!this.config.condensedReplays){e.next=28;break}if(r=n.highestSortNumber,0===n.unreadCount)return e.abrupt("return");e.next=12;break;case 12:return a=n.messages.length,n._markingAsRead=!0,n._markingAsReadSortNumber=0<a?n.messages[a-1].sortNumber:0,n._markingAsReadExpiration=(new Date).getTime()+3e4,this.host.models.Conversation.inject(n),e.prev=17,o=we.default.toServer(we.default.READ),e.next=21,this.host.api.conversations.updateConversationStatus(t,o,{highestSortNumber:r});case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(17),this.logger.warn("failed to mark conversation "+t+" as read");case 26:e.next=29;break;case 28:return e.abrupt("return",this.host.messages.markAsRead(n.markableAsReadMessages,i));case 29:case"end":return e.stop()}},e,this,[[17,23]])})),function(e){return I.apply(this,arguments)})},{key:"add",value:(T=(0,L.default)(ye.default.mark(function e(t,n,r){var a;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(r));e.next=12;break;case 12:return a=this.ensureConversation(t,n,r),e.prev=13,e.next=16,this.host.api.roster.add(t,n,r);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(13),this.logger.warn("can't add "+n+" "+t,e.t0);case 21:a._counterPartyAddedOnServer=!0;case 22:case"end":return e.stop()}},e,this,[[13,18]])})),function(e,t,n){return T.apply(this,arguments)})},{key:"remove",value:(A=(0,L.default)(ye.default.mark(function e(t){var n,r,a,o;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new oe.default.NotFoundError(this.host.models.Conversation.name,t);case 7:return r=n.counterPartyId,a=n.counterPartyType,o=n.organizationId,e.prev=8,e.next=11,this.host.api.roster.remove(a,r,o);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),this.logger.warn("can't remove conversation "+t);case 16:case"end":return e.stop()}},e,this,[[8,13]])})),function(e){return A.apply(this,arguments)})},{key:"ensureConversation",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(n));var a=(r=(0,W.default)(r,{ensureEntities:{counterParty:!1,organization:!1,messageCounterParties:!1,groupMembers:!1,touchOnRelatedEntityLoad:!0}})).conversationId,o=this.getConversationKey(e,t,n);if(this.config.condensedReplays&&!a){var i=this._convByConvHandle[o];i&&(a=i.id)}a=a||o;var s=this.getById(a);if(s){this.__ensureEntities(s,r.ensureEntities);var u=!1;return this.config.condensedReplays&&void 0!==r.highestSortNumber&&(s.highestSortNumber=r.highestSortNumber,u=!0),this.config.condensedReplays&&void 0!==r.muted&&(s.muted=r.muted,u=!0),this._convByConvHandle[o]=s,u&&this.host.models.Conversation.inject(s),s}var c={id:a,counterPartyType:e,counterPartyId:t,organizationId:n,_origIndex:this.host.models.Conversation.getAll().length};return r.highestSortNumber&&(c.highestSortNumber=r.highestSortNumber),r.muted&&(c.muted=r.muted),s=this.host.models.Conversation.createInstance(c),this.__ensureEntities(s,r.ensureEntities),this.host.models.Conversation.inject(s),this._convByConvHandle[o]=s}},{key:"__ejectConversation",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));var t=this.getById(e);if(t){var n=t.counterPartyType,r=t.counterPartyId,a=t.organizationId,o=this.getConversationKey(n,r,a);delete this._convByConvHandle[o],this.host.models.Conversation.eject(t),this.__queuedConversationsToReload=this.__queuedConversationsToReload.filter(function(e){return e.id!==t.id})}return t}},{key:"reactToMessageEvent",value:function(e){var t=e.data;if(this.config.condensedReplays)this.reactToMessageEventCR({data:t});else{var n=this._reactToMessageEvent({data:t}),r=n.message,a=n.conversation;this.host.models.Message.inject(r),this.emit("message",r),a&&(this.__addConversationCounterPartyToServerRosterIfShould(a),a.emit("message",r),this.config.condensedReplays&&a._markingAsReadSortNumber&&r.sortNumber>a._markingAsReadSortNumber&&this.__clearOptimisticStatus([a])),ie.MESSAGE_STATUS_ORDER[r.markedRecipientStatus]<ie.MESSAGE_STATUS_ORDER[we.default.DELIVERED]&&this.host.messages.markAsReceived(r,{})}}},{key:"reactToMessageEventCR",value:function(e){var t=e.data,n={},r=this._reactToMessageEventCR({data:t}),a=r.message,o=r.conversation;this.host.models.Message.inject(a),this.emit("message",a),o&&(this.__addConversationCounterPartyToServerRosterIfShould(o),o.emit("message",a)),n.queue=!0,this.host.messages.markAsReceived(a,n)}},{key:"_reactToMessageEvent",value:function(e){var t=e.data,n=e.conversationId,r=void 0===n?null:n;t=(0,se.jsonCloneDeep)(t);var a=this.host.currentUserId,o=t.recipient_status;o=o||[];var i={status:t.status,timestamp:t.created_time},s=this.host.models.Message.parseAttrs(t);s.messageType=be.MessageType.USER_SENT;var u=!0;if(s.groupId)s.counterPartyType="group",s.counterPartyId=s.groupId;else if(s.recipientId){if(this.host.distributionLists.getById(s.recipientId))s.counterPartyType="distributionList";else if(this.host.users.getById(s.recipientId))s.counterPartyType="user";else{u=!1;var c=this.host.messages._looksLikeDistributionListMessage(s);s.counterPartyType=c?"distributionList":"user"}s.counterPartyId="distributionList"===s.counterPartyType||s.senderId===a?s.recipientId:s.senderId}var l=this.host.messages._isMessageOutgoing(s);"distributionList"!==s.counterPartyType&&(i.account_id=l?s.recipientId:this.host.currentUserId,i.account_id&&o.push(i)),s.senderStatus=be.MessageSenderStatus.SENT;var d=u&&this.ensureConversation(s.counterPartyType,s.counterPartyId,s.recipientOrganizationId,{conversationId:r,ensureEntities:{counterParty:"placeholder",groupMembers:"placeholder",organization:"placeholder"}});s.conversationId=d?d.id:null;var f=this.host.models.Message.get(s.id);if(f){var p=s.body,y=s.escalationExecutionId,h=s.priority,g=s.sortNumber,v=s.sortSeries;f.body=p,f.escalationExecutionId=y||null,f.priority=h,f.shouldEscalate=!1,f.sortNumber=g,f.sortSeries=v}else f=this.host.models.Message.createInstance(s,!1);var m=f.senderId===a?f.recipientId:f.senderId;if(m&&"distributionList"!==f.counterPartyType&&this.__ensureMessageCounterParty(d,m,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),!o||"function"!=typeof o[me.default]&&!Array.isArray(o))throw new TypeError("Expected recipientStatuses to be iterable, got "+fe(o));if(!o||"function"!=typeof o[me.default]&&!Array.isArray(o))throw new TypeError("Expected recipientStatuses to be iterable, got "+pe(o));var b=!0,w=!1,E=void 0;try{for(var x,_=(0,ve.default)(o);!(b=(x=_.next()).done);b=!0){var k=x.value;this.config.condensedReplays||this.host.messages.__injectMessageStatus(f,k)}}catch(e){w=!0,E=e}finally{try{!b&&_.return&&_.return()}finally{if(w)throw E}}return"group"!==s.counterPartyType&&!this.config.condensedReplays||(f.shouldEnsureRecipientStatus=!0),f.inTimeline=!(!d||!d.isLive),{message:f,conversation:d}}},{key:"_reactToMessageEventCR",value:function(e){var t=e.data,n=e.injectConversation,r=void 0===n||n;t=(0,se.jsonCloneDeep)(t);var a=this.host.currentUserId,o=void 0,i=void 0;t.last_message?((o=t.last_message).conversation_id=t.conversation_id,i=t.last_message.sort_number):o=t,o.is_group&&!o.group_token&&(o.group_token=o.recipient_token);var s=this.host.models.Message.parseAttrs(o);if(s.messageType=be.MessageType.USER_SENT,s.groupId)s.counterPartyType="group",s.counterPartyId=s.groupId;else if(s.recipientId){if(this.host.distributionLists.getById(s.recipientId))s.counterPartyType="distributionList";else if(this.host.users.getById(s.recipientId))s.counterPartyType="user";else{var u=this.host.messages._looksLikeDistributionListMessage(s);s.counterPartyType=u?"distributionList":"user"}s.counterPartyId="distributionList"===s.counterPartyType||s.senderId===a?s.recipientId:s.senderId}s.senderStatus=be.MessageSenderStatus.SENT;var c=this.host.models.Message.get(s.id);if(c){var l=s.body,d=s.escalationExecutionId,f=s.priority,p=s.sortNumber,y=s.sortSeries,h=s.senderId,g=s.recipientId;c.body=l,c.escalationExecutionId=d||null,c.priority=f,c.shouldEscalate=!1,c.sortNumber=p,c.sortSeries=y,c.senderId=h,c.recipientId=g}else c=this.host.models.Message.inject(s);var v=void 0;v=r?(t.entity||(t.entity=this._resolveEntity(s.counterPartyId,s.counterPartyType)),t.organization_id||(t.sender_id&&(c.isOutgoing=this.host.messages._isMessageOutgoing(c)),c.isOutgoing&&c.senderOrganizationId?c.__organizationId=c.senderOrganizationId:!c.isOutgoing&&c.recipientOrganizationId&&(c.__organizationId=c.recipientOrganizationId),t.organization_id=c.__organizationId),this.__injectConversation(t,{highestSortNumber:i})):this.host.conversations.getById(o.conversation_id);var m=c.senderId===a?c.recipientId:c.senderId;return m&&"distributionList"!==c.counterPartyType&&this.__ensureMessageCounterParty(v,m,{messageCounterParties:this.host.currentlyServingOfflineMessages?"placeholder":"full",touchOnRelatedEntityLoad:!0}),c.inTimeline=!(!v||!v.isLive),c.shouldEnsureRecipientStatus=c.inTimeline,{message:c,conversation:v}}},{key:"reactToFriendsEventCR",value:function(e){var t=e.data,n=e.eventId,r=t=(0,se.jsonCloneDeep)(t),a=r.action,o=(r.xmlns,(0,U.default)(r,["action","xmlns"])),i=o.entity,s=o.organization_id||o.organization_key,u=i.metadata,c=i.id||i.token;if(i.type){var l=this.host.modelNameByEntityType(i.type);if(i.organizationId=s,"group"===l&&u&&"role"===u.feature_service&&"role_assignment"===u.meta_type)return void(this._rolesFriendsEventPromise=this.host.roles.reactToFriendsEventCR({action:a,attrs:i,id:n}));var d=o.conversation_id,f=o.last_message,p=o.lowest_sort_number,y=this.getById(d);if("add"===a||"update"===a){y&&"update"===a&&this.clearMessageStatuses(y);var h=f?f.sort_number:void 0;if(void 0===h&&(h="group"===l?this.host.messages.__getNextSortNumber(s):y&&"add"===a?y.highestSortNumber:1),y=this.__injectConversation(o,{highestSortNumber:h}),p&&this.markAsDelivered(y),"add"===a&&y){var g="group"===l&&this.host.groups.__extractGroupTypeFromAttrs(i);g!==be.GroupType.GROUP&&g!==be.GroupType.FORUM||(i.members=null),this.__injectCounterParty({entityAttrs:i,entityType:l,groupType:g,hasCurrentUser:!0,isPlaceholder:!0,organizationId:s}),this.clearTimeline(y)}}else"del"===a?this.__removeFriend({attrs:i,entityType:l,id:c,organizationId:s}):this.logger.error("friends action not implemented",a,t);y&&this.__clearOptimisticStatus([y]),this.emit("friends",(0,N.default)({action:a},i))}}},{key:"reactToFriendsEvent",value:function(e){var t=e.data,n=e.id;if(this.config.condensedReplays)this.reactToFriendsEventCR({data:t,eventId:n});else{var r=(t=(0,se.jsonCloneDeep)(t)).friend,a=r.action,o=r.organization_id,i=(0,U.default)(r,["action","organization_id"]),s=i.metadata,u=i.token,c=this.host.modelNameByTypeNS(i.xmlns);if(c){if("group"===c&&s&&"role"===s.feature_service&&"role_assignment"===s.meta_type)return void(this._rolesFriendsEventPromise=this.host.roles.reactToFriendsEvent({data:t,id:n}));if("add"===a){var l="group"===c&&this.host.groups.__extractGroupTypeFromAttrs(i);l!==be.GroupType.GROUP&&l!==be.GroupType.FORUM||(i.members=null),this.__injectCounterParty({entityAttrs:i,entityType:c,groupType:l,hasCurrentUser:!0,isPlaceholder:!0,organizationId:o});var d="group"===c?this.host.messages.__getNextSortNumber(o):1;this.ensureConversation(c,u,o,{highestSortNumber:d})}else"del"===a?this.__removeFriend({attrs:i,entityType:c,id:u,organizationId:o}):this.logger.error("friends action not implemented",a,t);this.emit("friends",(0,N.default)({action:a},i))}}}},{key:"reactToUpdateEventCR",value:function(e){var t=e.data,n=t=(0,se.jsonCloneDeep)(t),r=n.entity,a=n.organization_id,o=r.metadata,i=r.token,s=r.type;r.organizationId=a,this._sanitizeGroupAttrs(r);var u=this.host.modelNameByEntityType(s),c=this.host.groups.__extractGroupTypeFromAttrs(r);if(o&&a&&i&&xe.includes(c)&&this.host.metadata.__injectMetadata(i,a,o),o&&o.feature_service&&"role"===o.feature_service){if("group"===u&&o.target_id)return this.__injectTargetEntity(o,a);this.host.roles.reactToUpdateEventCR({entity:r})}this.host.injectModel(r,s)}},{key:"reactToUpdateEvent",value:function(e){var t=e.data;if(this.config.condensedReplays)this.reactToUpdateEventCR({data:t});else{var n=t=(0,se.jsonCloneDeep)(t),r=n.metadata,a=n.organization_key,o=n.token,i=n.type;this._sanitizeGroupAttrs(t);var s=this.host.modelNameByTypeNS(i),u=this.host.groups.__extractGroupTypeFromAttrs(t);if(r&&a&&o&&xe.includes(u)&&this.host.metadata.__injectMetadata(o,a,r),r&&r.feature_service&&"role"===r.feature_service){if("group"===s&&r.target_id)return this.__injectTargetEntity(r,a);this.host.roles.reactToUpdateEvent({data:t})}var c=t,l=(0,U.default)(c,[]);this.host.injectModel(l,i)}}},{key:"__queueReload",value:function(e){this.__queuedConversationsToReload.includes(e)||this.__queuedConversationsToReload.push(e),this.__flushConversationsToReload()}},{key:"hasPendingReloads",value:function(){return this.__queuedConversationsToReload&&0<this.__queuedConversationsToReload.length}},{key:"__updateTimeline",value:function(e){var t=e.content,n=e.timeline;if(n.length=0,!t||"function"!=typeof t[me.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+fe(t));if(!t||"function"!=typeof t[me.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+pe(t));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,ve.default)(t);!(r=(i=s.next()).done);r=!0){var u=i.value;u.inTimeline&&n.push(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}this.host.models.Conversation.inject(e)}},{key:"__reloadConversation",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).notify,n=void 0===t||t,r=e._unreadMessages,a=e._unreadPriorityMessages,o=e.content,i=e.higherContinuation,s=e.lowerContinuation,u=e.markableAsReadMessages,c=e.messages,l=e.timeline,d=0,f=e.firstUnreadMessage=null,p=null;if(u.length=0,c.length=0,l.length=0,r.length=0,a.length=0,!(b=o.entries())||"function"!=typeof b[me.default]&&!Array.isArray(b))throw new TypeError("Expected _content$entries3 to be iterable, got "+fe(b));if(!b||"function"!=typeof b[me.default]&&!Array.isArray(b))throw new TypeError("Expected _content$entries3 to be iterable, got "+pe(b));var y=!0,h=!1,g=void 0;try{for(var v,m=(0,ve.default)(b);!(y=(v=m.next()).done);y=!0){var b,w=(0,ge.default)(v.value,2),E=w[0],x=w[1],_=x.escalationExecution,k=x.inTimeline,A=x.isOutgoing,T=x.isUnread,I=x.markedRecipientStatus,O=x.messageType,j=x.priority;k&&(null===f&&(f=E),p=E,l.push(x)),O===be.MessageType.USER_SENT?(c.push(x),_&&"IN_PROGRESS"===_.status&&!this.config.condensedReplays&&d++,!this.config.condensedReplays&&Te.includes(I)&&u.push(x),A||(T&&(e.firstUnreadMessage||(e.firstUnreadMessage=x),r.push(x),j===be.MessagePriority.HIGH&&a.push(x)),e.lastIncomingMessageSortNumber=x.sortNumber)):de.includes(O)&&(e.lastBangMessageSortNumber=x.sortNumber)}}catch(e){h=!0,g=e}finally{try{!y&&m.return&&m.return()}finally{if(h)throw g}}this.config.condensedReplays||(s.itemsEstimate=f,null!==(i.itemsEstimate=p)&&(i.itemsEstimate=o.length-1-p)),e.isLive=0===i.itemsEstimate||0===o.length;var S=0<c.length?c[c.length-1]:null,R=S||(0,H.default)(o.filter(function(e){return e.messageType===be.MessageType.GROUP_MEMBERSHIP_CHANGE&&e.groupMembersChange&&"ADD"===e.groupMembersChange.action}));if(this.host.config.condensedReplays?e.highestSortNumber=e.highestSortNumber||0:(e.inProgressEscalationCount=d,e.lastMessage=S,e.unreadCount=r.length,e.unreadPriorityCount=a.length,e.highestSortNumber=R&&R.sortNumber||e.lastConversationSortNumber||0),n){this.host.models.Conversation.inject(e);var M=e.counterPartyType,z=e.counterPartyId,G=e.organizationId,C=this.getConversationKey(M,z,G);(this._convByConvHandle[C]=e).emit("change"),this.emit("change",e)}}},{key:"__addConversationCounterPartyToServerRosterIfShould",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(e));if(e&&!e._counterPartyAddedOnServer){var t=e.organization;t&&!t.$placeholder&&this.add(e.counterPartyType,e.counterPartyId,e.organizationId)}}},{key:"addMembershipChangeLog",value:function(e){var t,n=e.action,r=e.actionTime,a=e.actor,o=e.alwaysAddToTimeline,i=e.createdAt,s=e.group,u=e.id,c=e.memberIds,l=e.members,d=e.sortNumber,f=a.id,p=s.id,y=s.organizationId,h=this.host.currentUser,g=this.get("group",p,y),v=void 0;if(this.config.condensedReplays){if(!g)return;v=g.id}else v=this.getConversationKey("group",p,y);t=!!o||!!g&&g.isLive;var m=this.host.models.GroupMembersChange.inject({id:"groupMembersChange:"+u,action:n,actionTime:r,actor:a,memberIds:c,members:l});this.host.models.Message.inject({body:this.__generateGroupMembershipChangeBody(e),conversationId:v,counterPartyId:p,counterPartyType:"group",createdAt:i,groupId:p,groupMembersChange:m,id:"bang:"+u,inTimeline:t,isOutgoing:!1,messageType:be.MessageType.GROUP_MEMBERSHIP_CHANGE,recipient:h,senderId:f,sortNumber:d}),"OPT_IN"!==n&&"OPT_OUT"!==n||this.host.roles.refresh(y),g&&!this.config.condensedReplays&&this.__reloadConversation(g)}},{key:"__generateGroupMembershipChangeBody",value:function(e){var t,n=this,r=e.action,a=e.actor,o=e.group,i=e.members,s=o.groupType,u=_e[r]||Ie[r],c=a.id===this.host.currentUserId?"You":a.displayName,l=ke[r]||"",d=null;return(r in ke||r in Ie)&&(d=(t=(t=i.map(function(e,t){return[e.id===n.host.currentUserId?"You":e.displayName,(t===i.length-2?" and":",")+" "]}),Y.default).call(t),J.default).call(t).join("")),r in Ie?[d,u,c].filter(Boolean).join(" "):[c,u,d,l,"this",Ae[s]].filter(Boolean).join(" ")}},{key:"addEscalationExecutionChangeLog",value:function(e){var t,n=e.action,r=e.actionTime,a=e.actor,o=e.alwaysAddToTimeline,i=e.createdAt,s=e.escalationExecution,u=e.group,c=e.members,l=e.id,d=e.sortNumber,f=u.id,p=u.organizationId,y=this.host.currentUser,h=this.get("group",f,p),g=h?h.id:null;if(!h){if(this.config.condensedReplays)return;g=this.getConversationKey("group",f,p)}t=!!o||!!h&&h.isLive;var v=this.host.models.EscalationExecutionChange.inject({id:"escalationExecutionChange:"+l,action:n,actionTime:r,actor:a,members:c});this.host.models.Message.inject({body:this.__generateGroupEscalationChangeBody(e,s),conversationId:g,counterPartyId:f,counterPartyType:"group",createdAt:i,escalationExecutionChange:v,escalationExecutionId:s?s.id:null,groupId:f,id:"bang:"+l,inTimeline:t,isOutgoing:!1,messageType:be.MessageType.ESCALATION_EXECUTION_CHANGE,recipient:y,senderId:a?a.id:null,sortNumber:d}),h&&!this.config.condensedReplays&&this.__reloadConversation(h)}},{key:"__generateGroupEscalationChangeBody",value:function(e,t){var n=e.action,r=e.actor,a=e.members,o=Ee[n],i=t&&t.displayId||"";return i.startsWith("#")&&(i=i.slice(1,i.length)),""!==i&&(i+=" "),n===be.EscalationChangeAction.MEMBER_ADDED?o+" "+a[0].displayName+" to this escalation":n!==be.EscalationChangeAction.INITIATED&&r&&r.displayName?"Escalation "+i+o+" by "+r.displayName:"Escalation "+i+o}},{key:"getMessageConversationKey",value:function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(e));if(e.groupId)return this.conversationHashForListEntityId(e.groupId);if(e.distributionListId)return this.conversationHashForListEntityId(e.distributionListId);var t=e.senderId===this.host.currentUserId?e.recipientId:e.senderId;return this.conversationHashForUserMessage(t,e.senderOrganizationId,e.recipientOrganizationId)}},{key:"getConversationKey",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+pe(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+pe(r));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+fe(n));if(null!=r&&"string"!=typeof r)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+fe(r));switch(e){case"user":return this.conversationHashForUserMessage(t,n,r);case"group":case"distributionList":return this.conversationHashForListEntityId(t);default:throw new Error("type "+e+" not supported in conversation")}}},{key:"conversationHashForUserMessage",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t;if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+pe(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));if("string"!=typeof t)throw new TypeError('Value of argument "senderOrganizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "recipientOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+fe(n));var r=[e,t,n].join(":");return le.b64(r)}},{key:"conversationHashForListEntityId",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));return le.b64(e)}},{key:"conversationHashForGroupId",value:function(){return this.conversationHashForListEntityId.apply(this,arguments)}},{key:"conversationHashForDistributionListId",value:function(){return this.conversationHashForListEntityId.apply(this,arguments)}},{key:"looksLikeConversationHandle",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));return/^[a-zA-Z0-9\/+=]{24}$/.test(e)}},{key:"findConversationWithUser",value:(k=(0,L.default)(ye.default.mark(function e(t,n){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(n));e.next=8;break;case 8:return e.abrupt("return",this.get(this.host.models.User.name,t,n));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"findConversationWithGroup",value:(_=(0,L.default)(ye.default.mark(function e(t,n){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(n));e.next=8;break;case 8:return e.abrupt("return",this.get(this.host.models.Group.name,t,n));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return _.apply(this,arguments)})},{key:"findAllGroupConversationsWithMembers",value:(x=(0,L.default)(ye.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},p=f.exact,y=void 0===p||p,h=f.includeCurrentUser,g=void 0===h||h,v=f.includeForums,m=void 0===v||v,b=f.includeRoles,w=void 0===b||b,E=f.senderId,x=void 0===E?null:E;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+pe(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(n));e.next=4;break;case 4:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+fe(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(n));e.next=8;break;case 8:return e.next=10,this.resolveMembers((0,se.arrayWrap)(t));case 10:return t=(t=e.sent).map(this._resolveModelId),e.next=14,this.host.groups.findAllWithSpecificMembers(t,n,{exact:y,includeCurrentUser:g,includeForums:m,includeRoles:w,senderId:x});case 14:if(r=e.sent,a=[],!r||"function"!=typeof r[me.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+fe(r));e.next=18;break;case 18:if(!r||"function"!=typeof r[me.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+pe(r));e.next=20;break;case 20:for(i=!(o=!0),s=void 0,e.prev=23,u=(0,ve.default)(r);!(o=(c=u.next()).done);o=!0)l=c.value,(d=this.get(this.host.models.Group.name,l.id,n))&&a.push(d);e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),i=!0,s=e.t0;case 31:e.prev=31,e.prev=32,!o&&u.return&&u.return();case 34:if(e.prev=34,i)throw s;e.next=37;break;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.abrupt("return",a);case 40:case"end":return e.stop()}},e,this,[[23,27,31,39],[32,,34,38]])})),function(e,t){return x.apply(this,arguments)})},{key:"findLocalRoleP2PConversation",value:function(e,t){var n=void 0,r=void 0;e=this.host.roles.__resolveRoleId(e),t=this.host.roles.__resolveRoleId(t);var a=this.host.models.User.get(e),o=this.host.models.User.get(t);if(o&&o.isRoleBot&&o.botRole)r=this.host.roles._roleP2PConversations[t];else{if(!(a&&a.isRoleBot&&a.botRole))return null;r=this.host.roles._roleP2PConversations[e]}if(r){if(!r||"function"!=typeof r[me.default]&&!Array.isArray(r))throw new TypeError("Expected roleP2PConversations to be iterable, got "+fe(r));if(!r||"function"!=typeof r[me.default]&&!Array.isArray(r))throw new TypeError("Expected roleP2PConversations to be iterable, got "+pe(r));var i=!0,s=!1,u=void 0;try{for(var c,l=(0,ve.default)(r);!(i=(c=l.next()).done);i=!0){var d=c.value,f=d.$lastModified,p=d.counterParty,y=p.p2pRecipient,h=p.p2pSender;if(y&&h){var g=this.host.roles.__resolveRoleId(y.id),v=this.host.roles.__resolveRoleId(h.id);(g===e&&v===t||g===t&&v===e)&&(!n||n.$lastModified<f)&&(n=d)}}}catch(e){s=!0,u=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw u}}}return n}},{key:"resolveMembers",value:(E=(0,L.default)(ye.default.mark(function e(t){var r=this;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.default.all(t.map(function(){var t=(0,L.default)(ye.default.mark(function e(t){var n;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ue.isEmail)(t)||(0,ce.isPhone)(t))return e.prev=1,e.next=4,r.host.users.find(t);e.next=11;break;case 4:return n=e.sent,e.abrupt("return",n.id);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",t);case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e,r,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"selectConversation",value:(w=(0,L.default)(ye.default.mark(function e(t,n){var r,a,o,i,s=n.anchorPoint,u=void 0===s?be.ConversationAnchorPoints.CONVERSATION_END:s,c=n.lowerMargin,l=void 0===c?5:c,d=n.markAsRead,f=void 0===d||d,p=n.minUnreadItems,y=void 0===p?15:p;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));e.next=4;break;case 4:if(r=this.getById(t)){e.next=7;break}return e.abrupt("return");case 7:return this.config.condensedReplays||(0<r.markableAsReadMessages.length?r._savedFirstUnreadMessage=r.markableAsReadMessages[0]:r._savedFirstUnreadMessage=null),f&&0<r.unreadCount&&this.markAsRead(t,{localOnly:!0}),a=void 0,i=o=0,e.next=14,this.fetchTimeline(t,{anchorPoint:u,continuation:r.higherContinuation.continuation,maxItems:y});case 14:if(a=e.sent,o+=a,!(0<a)){e.next=36;break}case 17:if(o<y)return e.next=20,this.fetchTimeline(t,{anchorPoint:be.ConversationAnchorPoints.CONTINUATION,continuation:r.higherContinuation.continuation});e.next=26;break;case 20:if(a=e.sent,o+=a,0===a)return e.abrupt("break",26);e.next=24;break;case 24:e.next=17;break;case 26:if(i<l)return e.next=29,this.fetchTimeline(t,{anchorPoint:be.ConversationAnchorPoints.CONTINUATION,continuation:r.lowerContinuation.continuation});e.next=36;break;case 29:if(a=e.sent,o+=a,i+=a,0===a)return e.abrupt("break",36);e.next=34;break;case 34:e.next=26;break;case 36:return this.config.condensedReplays?f&&0<r.unreadCount&&this.markAsRead(t):f&&this.markAsRead(t),e.abrupt("return",o);case 38:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"getWithUser",value:function(e,t){var n=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).createIfNotFound,r=void 0!==n&&n;if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));e=this._resolveModelId(e),t=this._resolveModelId(t);var a=this.conversationHashForUserMessage(e,t),o=this.getById(a);return!o&&r&&(o=this.ensureConversation("user",e,t)),o||null}},{key:"getWithListEntity",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{createIfNotFound:!1},r=n.createIfNotFound,a=void 0!==r&&r,o=n.organizationId,i=n.conversationId,s=void 0===i?null:i;if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));if("string"!=typeof e)throw new TypeError('Value of argument "entityType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));if(!("string"==typeof t||t instanceof Object))throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));var u=void 0;if(this.config.condensedReplays)u=this.getById(s);else{t=this._resolveModelId(t);var c=this.conversationHashForListEntityId(t);u=this.getById(c)}if(!u&&a){var l=this._resolveEntity(t,e);if(!l)throw new Error("Entity required when using createIfNotFound");o=l.organizationId,u=this.ensureConversation(e,t,o,{conversationId:s})}return u}},{key:"getWithGroup",value:function(e){return this.getWithListEntity("group",e)}},{key:"getWithDistributionList",value:function(e){return this.getWithListEntity("distributionList",e)}},{key:"get",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(n));if("string"!=typeof e)throw new TypeError('Value of argument "counterPartyType" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));if("string"!=typeof t)throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(t));if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(n));var r=this.getConversationKey(e,t,n);return(this.config.condensedReplays?this._convByConvHandle[r]:this.host.models.Conversation.get(r))||null}},{key:"getAll",value:function(){return this.host.models.Conversation.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(e));return this.host.models.Conversation.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+pe(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+fe(e));return this.host.models.Conversation.getMulti(e)}},{key:"getAllForOrganization",value:function(e){var t=this._resolveEntity(e,"organization");return t?t.conversations:null}},{key:"__ensureEntities",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(e));if(!(e instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(e));var r=[],a=F.default.resolve();return n.counterParty&&(a=this.__ensureCounterParty(e,n),r.push(a)),n.escalationExecution&&r.push(this.__ensureEscalationExecution(e,a,n)),n.messageCounterParties&&r.push(this.__ensureMessageCounterParties(e,n)),n.organization&&r.push(this.__ensureOrganization(e,n)),0<(r=r.filter(Boolean)).length?F.default.all(r).then(function(){n.onLoad&&n.onLoad(),t.host.models.Conversation.inject(e)}).catch(function(e){return console.error(e)}):F.default.resolve()}},{key:"__ensureOrganization",value:function(n){var r=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(n instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(n));if(!(n instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(n));return this.host.models.Organization.shouldEnsure(n.organization,"full"!==a.organization)?new F.default(function(e,t){r.host.models.Organization.ensureEntity(n.organizationId,{onlyPlaceholder:"placeholder"===a.organization,onMissing:function(){r.logger.info("org "+n.organizationId+" not found, created placeholder org"),n.$loadingOrganization=!0},onLoad:function(){r.logger.info("org "+n.organizationId+" loaded"),n.$loadingOrganization=!1,a.touchOnRelatedEntityLoad&&r.host.models.Conversation.inject(n)},onFinish:e})}):null}},{key:"__ensureCounterParty",value:(b=(0,L.default)(ye.default.mark(function e(r){var a,o,i,s=this,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(r));case 2:if(r instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(r));case 4:if(u=(0,N.default)({},u),"group"===r.counterPartyType&&r.counterParty&&r.counterParty.groupType===be.GroupType.ROLE_P2P&&(u.counterParty="full",u.groupMembers="full"),(a=this.host.modelsByEntityType[r.counterPartyType]).shouldEnsure(r.counterParty,"full"!==u.counterParty,{groupMembersOnlyPlaceholder:"full"!==u.groupMembers})){e.next=10;break}return e.abrupt("return",null);case 10:o={},e.t0=r.counterPartyType,e.next="user"===e.t0?14:"group"===e.t0?15:"distributionList"===e.t0?15:17;break;case 14:return e.abrupt("break",18);case 15:return o.organizationId=r.organizationId,e.abrupt("break",18);case 17:throw new Error("unsupported counterPartyType",r.counterPartyType);case 18:return i=function(e){if("group"===a.name&&"placeholder"!==u.counterParty&&u.groupMembers)return s.host.groups.ensureMembers(e,{onlyPlaceholder:"placeholder"===u.groupMembers})},e.abrupt("return",new F.default(function(n,e){var t;a.ensureEntity(r.counterPartyId,{attrs:o,onlyPlaceholder:"placeholder"===u.counterParty,onMissing:function(){s.logger.info("entry "+r.counterPartyId+" not found, created placeholder on org "+r.organizationId),r.$loadingCounterParty=!0},onLoad:function(){r.$loadingCounterParty=!1,u.touchOnRelatedEntityLoad&&s.host.models.Conversation.inject(r)},onFinish:(t=(0,L.default)(ye.default.mark(function e(t){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t)return e.next=3,i(t);e.next=3;break;case 3:n();case 4:case"end":return e.stop()}},e,s)})),function(e){return t.apply(this,arguments)})})}));case 20:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"__ensureEscalationExecution",value:(m=(0,L.default)(ye.default.mark(function e(t,n){var r,a,o;return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(t));case 4:return e.next=6,n;case 6:if(r=t.counterPartyType,(a=t.counterParty)&&"group"===r){e.next=9;break}return e.abrupt("return");case 9:if(o=a.escalationExecution,a.groupType===be.GroupType.ESCALATION&&o){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,this.host.escalations.ensureEscalationExecution(o);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"__ensureMessageCounterParties",value:function(t){var e,n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(t instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(t));if(!(t instanceof Object))throw new TypeError('Value of argument "conversation" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(t));var a=(e=(e=(e=t.messages,ee.default).call(e,"senderId").filter(Boolean),te.default).call(e),ne.default).call(e,this.host.currentUserId,t.counterPartyId);return F.default.all(a.map(function(e){return n.__ensureMessageCounterParty(t,e,r)}))}},{key:"__ensureMessageCounterParty",value:function(n,r){var a=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof r)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+pe(r));if("string"!=typeof r)throw new TypeError('Value of argument "messageOtherUserId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+fe(r));var e=this.host.models.User.get(r);return this.host.models.User.shouldEnsure(e,"full"!==o.messageCounterParties)?new F.default(function(e,t){a.host.models.User.ensureEntity(r,{onlyPlaceholder:"placeholder"===o.messageCounterParties,onMissing:function(){var e=n?"entry "+n.counterPartyId+" not found, created placeholder on org "+n.organizationId:"counterParty "+r+" not found";a.logger.info(e)},onLoad:function(){n&&o.touchOnRelatedEntityLoad&&a.host.models.Conversation.inject(n)},onFinish:e})}):null}},{key:"_setAllowedSenders",value:function(e){var t=e.counterParty,n=e.counterPartyType,r=e.organization,a=this.host.currentUser,o=[a];if(a.contactsMessagingBlocked&&r.isContacts)return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.CONTACTS_MESSAGING_BLOCKED_BY_ADMIN);if(!n||!r)return e.allowedSenders=o,void(e.allowedSendersReason=be.AllowedSendersReason.CONVERSATION_NOT_FULLY_LOADED);if(!t)return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.NO_COUNTER_PARTY);switch(n){case"user":return t.$placeholder?(e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.COUNTER_PARTY_NOT_FULLY_LOADED)):"TigerPage"===t.displayName?(e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.COUNTER_PARTY_IS_TIGERPAGE)):(e.allowedSenders=o,void(e.allowedSendersReason=be.AllowedSendersReason.NONE));case"distributionList":return e.allowedSenders=o,void(e.allowedSendersReason=be.AllowedSendersReason.NONE);case"group":var i=t.createdByRole,s=t.createdByUser,u=t.groupType,c=t.p2pRecipient,l=t.p2pSender,d=t.targetRole,f=t.targetUser,p=t.members,y=t.proxiedMembers,h=r.allowedSenders;if(u===be.GroupType.FORUM)return e.allowedSenders=o,void(e.allowedSendersReason=be.AllowedSendersReason.NONE);if(u===be.GroupType.ROLE_ASSIGNMENT)return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.IS_ROLE_ASSIGNMENT_GROUP);if(u===be.GroupType.ROLE_P2P&&c&&l){var g=[],v=i&&i.botUser,m=d&&d.botUser;!v||p&&p.includes(v)?!s||p&&p.includes(s)||g.push(s):g.push(v),!m||p&&p.includes(m)?!f||p&&p.includes(f)||g.push(f):g.push(m),0<g.length&&(p=[].concat((0,he.default)(p||[]),g))}else if(t.$placeholder)return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.COUNTER_PARTY_NOT_FULLY_LOADED);if(!p)return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.GROUP_MEMBERS_NOT_LOADED);if(0===p.length)return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.GROUP_HAS_NO_MEMBERS);var b=[];if(!h||"function"!=typeof h[me.default]&&!Array.isArray(h))throw new TypeError("Expected orgAllowedSenders to be iterable, got "+fe(h));if(!h||"function"!=typeof h[me.default]&&!Array.isArray(h))throw new TypeError("Expected orgAllowedSenders to be iterable, got "+pe(h));var w=!0,E=!1,x=void 0;try{for(var _,k=(0,ve.default)(h);!(w=(_=k.next()).done);w=!0){var A=_.value,T="role"===A.$entityType?A.botUser:A;if(p.includes(T)){var I=T.id,O=y&&y[I];if(O){var j=!1;if(!O||"function"!=typeof O[me.default]&&!Array.isArray(O))throw new TypeError("Expected proxiedEntries to be iterable, got "+fe(O));if(!O||"function"!=typeof O[me.default]&&!Array.isArray(O))throw new TypeError("Expected proxiedEntries to be iterable, got "+pe(O));var S=!0,R=!1,M=void 0;try{for(var z,G=(0,ve.default)(O);!(S=(z=G.next()).done);S=!0)z.value.token===I&&(j=!0)}catch(e){R=!0,M=e}finally{try{!S&&G.return&&G.return()}finally{if(R)throw M}}if(!j)continue}b.push(A)}}}catch(e){E=!0,x=e}finally{try{!w&&k.return&&k.return()}finally{if(E)throw x}}return 0===b.length?(e.allowedSenders=b,void(e.allowedSendersReason=be.AllowedSendersReason.USER_IS_NOT_MEMBER_OF_GROUP)):u!==be.GroupType.ROLE_P2P?(e.allowedSenders=b,void(e.allowedSendersReason=be.AllowedSendersReason.NONE)):l&&b.includes(l)?c===a||a.roles.includes(c)?(e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.CONVERSATION_WITH_ROLE_YOU_ARE_CURRENTLY_IN)):(e.allowedSenders=[l],void(e.allowedSendersReason=be.AllowedSendersReason.NONE)):(e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.USER_IS_NOT_IN_THIS_ROLE_CONVERSATION));default:return e.allowedSenders=[],void(e.allowedSendersReason=be.AllowedSendersReason.COUNTER_PARTY_TYPE_NOT_SUPPORTED)}}},{key:"reactToProcessingStart",value:function(e){var t=e.data,n=t=(0,se.jsonCloneDeep)(t),r=n.action_type,a=n.conversation_id,o=n.entity,i=n.organization_id,s=o.token,u=be.ProcessingActionTypes.resolve(r);if(this.host.products._addProcessingEvent({actionType:u,entity:(0,N.default)({id:s},o)}),u===be.ProcessingActionTypes.ROLE_OPT_OUT)this._roleConversationsProcessingEvent[s]=this.host.roles._roleConversations[s];else if(u===be.ProcessingActionTypes.ORGANIZATION_MESSAGE_STATUS||u===be.ProcessingActionTypes.ORGANIZATION_REPLAY){var c=this.host.organizations.getById(i);if(!c)return;c._markingAsReadConversations&&this.__clearOptimisticStatus(c._markingAsReadConversations)}else if(u===be.ProcessingActionTypes.GROUP_REPLAY){var l=void 0;if(a&&(l=this.getById(a)),!l)return;this.__clearOptimisticStatus([l])}else if(u===be.ProcessingActionTypes.ROLE_OPT_IN||u===be.ProcessingActionTypes.ROLE_OPT_OUT){var d=this.host.roles._roleConversations[s];if(!d)return;this.__clearOptimisticStatus(d)}}},{key:"reactToProcessingStop",value:function(e){var t=e.data,n=t=(0,se.jsonCloneDeep)(t),r=n.action_type,a=n.conversation_id,o=n.entity,i=n.organization_id;!a&&o.conversation_id&&(a=o.conversation_id,delete o.conversation_id),!i&&o.organization_key&&(i=o.organization_key,delete o.organization_key);var s=o.token,u=be.ProcessingActionTypes.resolve(r);if(this.host.products._removeProcessingEvent({actionType:u,entity:(0,N.default)({id:s},o)}),u===be.ProcessingActionTypes.GROUP_REPLAY){var c=void 0;if(a&&(c=this.getById(a)),!c)return;this.clearTimeline(c),this.__clearOptimisticStatus([c])}else if(u===be.ProcessingActionTypes.ROLE_OPT_IN||u===be.ProcessingActionTypes.ROLE_OPT_OUT){this.clearTimelineForAllRoleConversations(u,s);var l=this.host.roles._roleConversations[s];if(!l)return;this.__clearOptimisticStatus(l)}else if(u===be.ProcessingActionTypes.ORGANIZATION_MESSAGE_STATUS)this.clearMessageStatusesForOrganization(i);else if(u===be.ProcessingActionTypes.CONVERSATION_MESSAGE_STATUS){var d=void 0;if(a&&(d=this.getById(a)),!d)return;this.clearMessageStatuses(d)}if(u===be.ProcessingActionTypes.ORGANIZATION_MESSAGE_STATUS||u===be.ProcessingActionTypes.ORGANIZATION_REPLAY){var f=this.host.organizations.getById(i);if(!f)return;f._markingAsReadConversations&&this.__clearOptimisticStatus(f._markingAsReadConversations)}}},{key:"__clearOptimisticStatus",value:function(e){if(!e||"function"!=typeof e[me.default]&&!Array.isArray(e))throw new TypeError("Expected conversations to be iterable, got "+fe(e));if(!e||"function"!=typeof e[me.default]&&!Array.isArray(e))throw new TypeError("Expected conversations to be iterable, got "+pe(e));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,ve.default)(e);!(t=(a=o.next()).done);t=!0){var i=a.value;i._markingAsRead&&(i=this.getById(i.id))&&(i._markingAsRead=!1,i._markingAsReadSortNumber=null,i._markingAsReadExpiration=null,this.host.models.Conversation.inject(i))}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"clearTimelineForAllRoleConversations",value:function(e,t){var n;if(n=e===be.ProcessingActionTypes.ROLE_OPT_OUT?this._roleConversationsProcessingEvent[t]:this.host.roles._roleConversations[t]){if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+fe(n));if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+pe(n));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,ve.default)(n);!(r=(i=s.next()).done);r=!0){var u=i.value;this.clearTimeline(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}},{key:"clearMessageStatusesForOrganization",value:function(e){var t=this.host.organizations.getById(e);if(t){var n=t.conversations;if(n){if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+fe(n));if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+pe(n));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,ve.default)(n);!(r=(i=s.next()).done);r=!0){var u=i.value;this.clearMessageStatuses(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}}},{key:"clearMessageStatuses",value:function(e){var n=this,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).emit,r=void 0===t||t,a=e.content;if(!a||"function"!=typeof a[me.default]&&!Array.isArray(a))throw new TypeError("Expected content to be iterable, got "+fe(a));if(!a||"function"!=typeof a[me.default]&&!Array.isArray(a))throw new TypeError("Expected content to be iterable, got "+pe(a));var o=!0,i=!1,s=void 0;try{for(var u,c=function(){var t=u.value;t.shouldEnsureRecipientStatus=!0,n.host.models.Message.inject(t),setTimeout(function(){if(n.host.messages._pendingFindRecipientStatuses){var e=n.host.messages._pendingFindRecipientStatuses[t.id];e&&e()}},0)},l=(0,ve.default)(a);!(o=(u=l.next()).done);o=!0)c()}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}return r&&this.emit("clearMessageStatuses",a),this.config.condensedReplays||this.__reloadConversation(e,{notify:!1}),a.length}},{key:"mute",value:(v=(0,L.default)(ye.default.mark(function e(t,n){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+pe(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));case 6:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+fe(n));e.next=8;break;case 8:return e.next=10,this.host.mute.muteConversation(t,n);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"unmute",value:(g=(0,L.default)(ye.default.mark(function e(t){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+pe(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+fe(t));case 4:return e.next=6,this.host.mute.unmuteConversation(t);case 6:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"unmuteAll",value:(h=(0,L.default)(ye.default.mark(function e(){return ye.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.mute.unmuteAll();case 2:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})}]),a((p=je).prototype,"findAll",[l],(0,V.default)(p.prototype,"findAll"),p.prototype),a(p.prototype,"add",[d],(0,V.default)(p.prototype,"add"),p.prototype),a(p.prototype,"remove",[f],(0,V.default)(p.prototype,"remove"),p.prototype),p);function je(){var e,t,k,n;(0,D.default)(this,je);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=k=(0,q.default)(this,(e=je.__proto__||(0,$.default)(je)).call.apply(e,[this].concat(a))),k.__injectCounterParty=function(e){var t=e.conversationId,n=e.entityAttrs,r=e.entityType,a=e.groupType,o=e.hasCurrentUser,i=void 0!==o&&o,s=e.isPlaceholder,u=void 0!==s&&s,c=e.organizationId,l=n.id,d=n.metadata;if(l=l||n.token,!r&&n.type&&(r=k.host.modelNameByEntityType(n.type)),t&&(n.conversationId=t),c&&(n.organizationId=c),"group"!==r||a||(a=k.host.groups.__extractGroupTypeFromAttrs(n)),d&&l&&c&&k.host.metadata.__injectMetadata(l,c,d),"group"===r){if(d){if(d.created_by){var f=k.__injectCreatedByEntity(d,c),p=f.role,y=void 0===p?null:p,h=f.user,g=void 0===h?null:h;(y||g)&&(n.createdByRole=y,n.createdByUser=g)}else if(n.created_by){var v=k.host.models.User.injectPlaceholder({id:n.created_by});n.createdByUser=v}if(d.target_id){var m=k.__injectTargetEntity(d,c),b=m.role,w=void 0===b?null:b,E=m.user,x=void 0===E?null:E;(w||x)&&(n.targetRole=w,n.targetUser=x)}"role_assignment"===d.meta_type&&k.host.roles.__injectRoleAssignmentEntity(n.display_name,d,c)}a===be.GroupType.FORUM&&i&&(n.hasCurrentUser=!0)}else if("user"===r){var _=n.dnd_auto_forward_receiver;_&&"undefined"!==_&&k.host.models.User.injectPlaceholder({id:_})}return l?u?k.host.injectPlaceholderModel(n,r):k.host.injectModel(n,r):null},k.__injectCreatedByEntity=function(e,t){var n={};if(void 0!==e.created_by_tag_id)n.role=k.host.roles.__injectRoleFromMetadata({metadata:{token:e.created_by,display_name:e.created_by_display_name,tag_color:e.created_by_tag_color,tag_id:e.created_by_tag_id,tag_name:e.created_by_tag_name},organizationId:t,replaceExisting:!1});else{var r=k.host.models.User.get(e.created_by);if(r)n.user=r;else{var a={id:e.created_by};"created_by_display_name"in e&&(a.displayName=e.created_by_display_name),n.user=k.host.models.User.injectPlaceholder(a)}}return n},k.__injectTargetEntity=function(e,t){var n={};if(void 0!==e.target_tag_id)n.role=k.host.roles.__injectRoleFromMetadata({metadata:{display_name:e.target_display_name,tag_color:e.target_tag_color,tag_id:e.target_tag_id,tag_name:e.target_tag_name,token:e.target_id},organizationId:t,replaceExisting:!1});else{var r=k.host.models.User.get(e.target_id);if(r)n.user=r;else{var a={id:e.target_id};"target_display_name"in e&&(a.displayName=e.target_display_name),n.user=k.host.models.User.injectPlaceholder(a)}}return n},k.__removeFriend=function(e){var t,n=e.attrs,r=e.entityType,a=e.id,o=e.organizationId,i=k.get(r,a,o),s="group"===r?k.host.models.Group.get(a):null,u=!(!s||s.groupType!==be.GroupType.FORUM);if(t="user"===r||k.config.condensedReplays?i&&i.content.slice():i&&i.messages.slice(),i&&!k.config.condensedReplays&&k.__reloadConversation(i,{notify:!1}),u&&(n.hasCurrentUser=!1,n.members=null,k.host.models.Group.inject(n)),k.config.keepConversationsForAllForums&&u||(i&&k.__ejectConversation(i.id),s&&k.config.condensedReplays&&k.host.models.Group.eject(s)),Array.isArray(t)){if(!t||"function"!=typeof t[me.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+fe(t));if(!t||"function"!=typeof t[me.default]&&!Array.isArray(t))throw new TypeError("Expected content to be iterable, got "+pe(t));var c=!0,l=!1,d=void 0;try{for(var f,p=(0,ve.default)(t);!(c=(f=p.next()).done);c=!0){var y=f.value;k.host.ejectModel(y,y.$entityType)}}catch(e){l=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw d}}}},k._sanitizeGroupAttrs=function(e){var t=e.members;k.host.groups.__extractGroupTypeFromAttrs(e)===be.GroupType.FORUM&&t&&0===t.length&&delete e.members},k._onSendingMessage=function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(e));var t=void 0;(t=k.config.condensedReplays?e.conversation:k.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId,{ensureEntities:{counterParty:"full",organization:"placeholder",messageCounterParties:"full",groupMembers:"full",touchOnRelatedEntityLoad:!0}}))&&(k.host.config.condensedReplays&&t&&e&&t.highestSortNumber<e.sortNumber&&(t.highestSortNumber=e.sortNumber),k.__addConversationCounterPartyToServerRosterIfShould(t))},k._onSentMessage=function(e){if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+pe(e));if(!(e instanceof Object))throw new TypeError('Value of argument "message" violates contract.\n\nExpected:\nObject\n\nGot:\n'+fe(e));var t=k.ensureConversation(e.counterPartyType,e.counterPartyId,e.senderOrganizationId);k.host.config.condensedReplays&&t&&e&&t.highestSortNumber<e.sortNumber&&(t.highestSortNumber=e.sortNumber),k.config.condensedReplays?k.host.models.Conversation.inject(t):k.__reloadConversation(t),t.emit("message",e)},k._onChangeMessage=function(e,t){t.conversation&&k.__queueReload(t.conversation)},k._onRemoveMessage=function(e,t){var n=t.conversation;if(n)if(k.config.condensedReplays){var r=n,a=r.firstExpiringUnreadMessage,o=r.id,i=r.lastMessage;if(!(n=k.getById(o)))return;var s=i===t;(s||a===t)&&k.find(n.id),s&&(n.lastMessage=null),k.__updateTimeline(n)}else k.__queueReload(n)},k._onRemoveGroup=function(e,t){var n=t.conversationId?t.conversationId:k.getConversationKey("group",t.id,t.organizationId);k.__ejectConversation(n)},k._onChangeOrganization=function(e,t){var n=t.conversations,r=k.__escalationEnabledOrganizations.indexOf(t),a=-1<r;if(a!==t.canEscalateMessages&&(a?k.__escalationEnabledOrganizations.splice(r,1):k.__escalationEnabledOrganizations.push(t),n)){if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+fe(n));if(!n||"function"!=typeof n[me.default]&&!Array.isArray(n))throw new TypeError("Expected conversations to be iterable, got "+pe(n));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,ve.default)(n);!(o=(u=c.next()).done);o=!0){var l=u.value;k.__queueReload(l)}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}},k.__flushConversationsToReload=function(){if(!k.host.currentlyServingOfflineMessages&&0<k.__queuedConversationsToReload.length){var e=[];if(k.host.organizations._deferConversationChanges=!0,!(i=k.__queuedConversationsToReload)||"function"!=typeof i[me.default]&&!Array.isArray(i))throw new TypeError("Expected _queuedConversations to be iterable, got "+fe(i));if(!i||"function"!=typeof i[me.default]&&!Array.isArray(i))throw new TypeError("Expected _queuedConversations to be iterable, got "+pe(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,ve.default)(i);!(t=(a=o.next()).done);t=!0){var i,s=a.value,u=s.organizationId;k.__reloadConversation(s),e.includes(u)||e.push(u)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}if(k.host.organizations._deferConversationChanges=!1,!e||"function"!=typeof e[me.default]&&!Array.isArray(e))throw new TypeError("Expected changedOrganizations to be iterable, got "+fe(e));if(!e||"function"!=typeof e[me.default]&&!Array.isArray(e))throw new TypeError("Expected changedOrganizations to be iterable, got "+pe(e));var c=!0,l=!1,d=void 0;try{for(var f,p=(0,ve.default)(e);!(c=(f=p.next()).done);c=!0){u=f.value;var y=k.host.organizations.getById(u);y&&k.host.organizations.__reloadConversations(y)}}catch(e){l=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw d}}k.__queuedConversationsToReload.length=0}},n=t,(0,q.default)(k,n)}t.default=Oe,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,y.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,p.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p=r(n(3)),y=r(n(7)),h=r(n(8)),g=r(n(11)),v=r(n(10)),m=r(n(9)),b=r(n(4)),w=r(n(1)),E=r(n(2)),x=r(n(6)),_=r(n(5)),k=r(n(24)),A=r(n(14)),T=r(n(17)),I=n(18),O=(o=(0,I.decorator)(),u=(0,I.decorator)(),l=A.default,(0,_.default)(j,l),(0,E.default)(j,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"find",value:(f=(0,m.default)(v.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:if(a=(0,k.default)(a,{ignoreNotFound:!1,bypassCache:!1,includeMembers:!1,includeMetadata:!1}),this.host.requireUser(),n=null,a.bypassCache){e.next=11;break}if(n=this.host.models.DistributionList.get(t))return e.abrupt("return",n);e.next=11;break;case 11:return e.next=13,this.host.api.distributionLists.find(t);case 13:if(!(r=e.sent)){e.next=19;break}delete(n=this.host.models.DistributionList.inject(r)).$placeholder,e.next=21;break;case 19:if(a.ignoreNotFound){e.next=21;break}throw new T.default.NotFoundError(this.host.models.DistributionList.name,t);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"findAll",value:(d=(0,m.default)(v.default.mark(function e(){var t,n,r,a;return v.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["distributionList"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.DistributionList.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));return this.host.models.DistributionList.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+s(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+i(e));return this.host.models.DistributionList.getMulti(e)}}]),a((c=j).prototype,"find",[o],(0,g.default)(c.prototype,"find"),c.prototype),a(c.prototype,"findAll",[u],(0,g.default)(c.prototype,"findAll"),c.prototype),c);function j(){return(0,w.default)(this,j),(0,x.default)(this,(j.__proto__||(0,b.default)(j)).apply(this,arguments))}t.default=O,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function Z(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,g.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=Z(t[0],n);return t.every(function(e){return Z(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return Z(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,h.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+Z(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function K(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,g.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=K(t[0],n);return t.every(function(e){return K(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return K(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,h.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+K(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,y=r(n(3)),h=r(n(7)),g=r(n(8)),v=r(n(11)),H=r(n(10)),W=r(n(21)),X=r(n(23)),Q=r(n(12)),Y=r(n(32)),J=r(n(13)),ee=r(n(20)),m=r(n(9)),b=r(n(4)),w=r(n(1)),E=r(n(2)),x=r(n(6)),_=r(n(5)),te=r(n(55)),ne=r(n(58)),k=r(n(14)),A=n(18),re=n(22),ae=r(n(17)),T=(a=(0,A.decorator)(),f=k.default,(0,_.default)(I,f),(0,E.default)(I,[{key:"findMulti",value:(p=(0,m.default)(H.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C,P,V,N,U,F,L,$,D,B,q=this;return H.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+K(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+K(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+Z(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Z(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new ae.default.ValidationError("organizationId","required");case 10:return t=(0,ne.default)((0,re.arrayWrap)(t).map(this._resolveModelId)),r=(0,te.default)(t,10),a=r.map(function(e){return q.host.api.entities.findMulti({users:e,metadata:e,organizationId:n})}),e.next=15,ee.default.all(a);case 15:if(o=e.sent,i={},!o||"function"!=typeof o[J.default]&&!Array.isArray(o))throw new TypeError("Expected allResults to be iterable, got "+Z(o));e.next=19;break;case 19:if(!o||"function"!=typeof o[J.default]&&!Array.isArray(o))throw new TypeError("Expected allResults to be iterable, got "+K(o));e.next=21;break;case 21:u=!(s=!0),c=void 0,e.prev=24,l=(0,Q.default)(o);case 26:if(s=(d=l.next()).done){e.next=138;break}if(f=d.value,p=f.users,y=f.metadata,!p){e.next=82;break}if(!p||"function"!=typeof p[J.default]&&!Array.isArray(p))throw new TypeError("Expected users to be iterable, got "+Z(p));e.next=32;break;case 32:if(!p||"function"!=typeof p[J.default]&&!Array.isArray(p))throw new TypeError("Expected users to be iterable, got "+K(p));e.next=34;break;case 34:g=!(h=!0),v=void 0,e.prev=37,m=(0,Q.default)(p);case 39:if(h=(b=m.next()).done){e.next=68;break}if(w=b.value,!(T=(0,X.default)(w))||"function"!=typeof T[J.default]&&!Array.isArray(T))throw new TypeError("Expected _Object$entries to be iterable, got "+Z(T));e.next=44;break;case 44:if(!T||"function"!=typeof T[J.default]&&!Array.isArray(T))throw new TypeError("Expected _Object$entries to be iterable, got "+K(T));e.next=46;break;case 46:for(x=!(E=!0),_=void 0,e.prev=49,k=(0,Q.default)(T);!(E=(A=k.next()).done);E=!0)I=(0,W.default)(A.value,2),O=I[0],j=I[1],i[O]={entity:j};e.next=57;break;case 53:e.prev=53,e.t0=e.catch(49),x=!0,_=e.t0;case 57:e.prev=57,e.prev=58,!E&&k.return&&k.return();case 60:if(e.prev=60,x)throw _;e.next=63;break;case 63:return e.finish(60);case 64:return e.finish(57);case 65:h=!0,e.next=39;break;case 68:e.next=74;break;case 70:e.prev=70,e.t1=e.catch(37),g=!0,v=e.t1;case 74:e.prev=74,e.prev=75,!h&&m.return&&m.return();case 77:if(e.prev=77,g)throw v;e.next=80;break;case 80:return e.finish(77);case 81:return e.finish(74);case 82:if(!y){e.next=135;break}if(!y||"function"!=typeof y[J.default]&&!Array.isArray(y))throw new TypeError("Expected allMetadata to be iterable, got "+Z(y));e.next=85;break;case 85:if(!y||"function"!=typeof y[J.default]&&!Array.isArray(y))throw new TypeError("Expected allMetadata to be iterable, got "+K(y));e.next=87;break;case 87:R=!(S=!0),M=void 0,e.prev=90,z=(0,Q.default)(y);case 92:if(S=(G=z.next()).done){e.next=121;break}if(C=G.value,!(L=(0,X.default)(C))||"function"!=typeof L[J.default]&&!Array.isArray(L))throw new TypeError("Expected _Object$entries2 to be iterable, got "+Z(L));e.next=97;break;case 97:if(!L||"function"!=typeof L[J.default]&&!Array.isArray(L))throw new TypeError("Expected _Object$entries2 to be iterable, got "+K(L));e.next=99;break;case 99:for(V=!(P=!0),N=void 0,e.prev=102,U=(0,Q.default)(L);!(P=(F=U.next()).done);P=!0)$=(0,W.default)(F.value,2),O=$[0],D=$[1],(B=i[O])&&(B.metadata=D);e.next=110;break;case 106:e.prev=106,e.t2=e.catch(102),V=!0,N=e.t2;case 110:e.prev=110,e.prev=111,!P&&U.return&&U.return();case 113:if(e.prev=113,V)throw N;e.next=116;break;case 116:return e.finish(113);case 117:return e.finish(110);case 118:S=!0,e.next=92;break;case 121:e.next=127;break;case 123:e.prev=123,e.t3=e.catch(90),R=!0,M=e.t3;case 127:e.prev=127,e.prev=128,!S&&z.return&&z.return();case 130:if(e.prev=130,R)throw M;e.next=133;break;case 133:return e.finish(130);case 134:return e.finish(127);case 135:s=!0,e.next=26;break;case 138:e.next=144;break;case 140:e.prev=140,e.t4=e.catch(24),u=!0,c=e.t4;case 144:e.prev=144,e.prev=145,!s&&l.return&&l.return();case 147:if(e.prev=147,u)throw c;e.next=150;break;case 150:return e.finish(147);case 151:return e.finish(144);case 152:return e.abrupt("return",(0,Y.default)(i));case 153:case"end":return e.stop()}},e,this,[[24,140,144,152],[37,70,74,82],[49,53,57,65],[58,,60,64],[75,,77,81],[90,123,127,135],[102,106,110,118],[111,,113,117],[128,,130,134],[145,,147,151]])})),function(e,t){return p.apply(this,arguments)})}]),i=(o=I).prototype,s="findMulti",u=[a],c=(0,v.default)(o.prototype,"findMulti"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function I(){return(0,w.default)(this,I),(0,x.default)(this,(I.__proto__||(0,b.default)(I)).apply(this,arguments))}t.default=T,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,x.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,E.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,w.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function d(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,x.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=d(t[0],n);return t.every(function(e){return d(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return d(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,E.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,w.default)(e))+": "+d(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,f,p,y,h,g,v,m,b,w=r(n(3)),E=r(n(7)),x=r(n(8)),_=r(n(11)),k=r(n(10)),A=r(n(9)),T=r(n(4)),I=r(n(1)),O=r(n(2)),j=r(n(6)),S=r(n(5)),R=n(18),M=r(n(17)),z=r(n(14)),G=(o=(0,R.decorator)(),i=(0,R.decorator)(),s=(0,R.decorator)(),u=(0,R.decorator)(),c=(0,R.decorator)(),p=z.default,(0,S.default)(C,p),(0,O.default)(C,[{key:"escalateMessage",value:(b=(0,A.default)(k.default.mark(function e(t){var n,r,a;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"message")){e.next=7;break}throw new M.default.NotFoundError(this.host.models.Message.name,t);case 7:return e.next=9,this.host.api.escalations.escalateMessage(n.serverId);case 9:return r=e.sent,a=(r||{}).escalation,e.abrupt("return",this._updateEscalation(a));case 12:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"acknowledge",value:(m=(0,A.default)(k.default.mark(function e(t){var n,r,a,o,i,s,u,c;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new M.default.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return t=n.id,r=n.originalMessageId,a=this.host,o=a.currentUser,i=a.currentUserId,(s=o.roles.map(function(e){return e.botUserId})).push(i),e.next=14,this.host.api.escalations.acknowledge(t,{messageId:r,userTokens:s});case 14:return u=e.sent,c=this.host.models.EscalationExecution.inject(u),e.abrupt("return",c);case 17:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"cancel",value:(v=(0,A.default)(k.default.mark(function e(t){var n,r;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new M.default.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return r=n.originalMessageId,e.next=10,this.host.api.escalations.cancel(r);case 10:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"ensureEscalationExecution",value:(g=(0,A.default)(k.default.mark(function e(t){var n,r,a,o;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new M.default.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return r=n.carbonCopyMessageId,a=n.originalMessageId,o=[],r&&o.push(r),a&&o.push(a),e.next=13,this.host.messages.ensureRecipientStatusMulti(o);case 13:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"skip",value:(h=(0,A.default)(k.default.mark(function e(t){var n,r,a,o,i,s,u,c;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new M.default.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return t=n.id,r=n.originalMessageId,a=this.host,o=a.currentUser,i=a.currentUserId,(s=o.roles.map(function(e){return e.botUserId})).push(i),e.next=14,this.host.api.escalations.skip(t,{messageId:r,userTokens:s});case 14:return u=e.sent,c=this.host.models.EscalationExecution.inject(u),e.abrupt("return",c);case 17:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"removeEscalationGroup",value:(y=(0,A.default)(k.default.mark(function e(t){var n,r;return k.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+d(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "escalationExecutionId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+l(t));case 4:if(n=this._resolveEntity(t,"escalationExecution")){e.next=7;break}throw new M.default.NotFoundError(this.host.models.EscalationExecution.name,t);case 7:return r=n.groupId,e.next=10,this.host.api.groups.destroy(r);case 10:if(e.sent){e.next=13;break}throw new M.default.NotFoundError(this.host.models.Group.name,r);case 13:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"reactToEscalationsEvent",value:function(e){var t=e.data;this._updateEscalation(t.escalation)}},{key:"_updateEscalation",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).inGroupInject,n=void 0!==t&&t,r={};e&&e.display_name&&(r=this.host.models.EscalationExecution.inject(e));var a=r,o=a.id,i=a.carbonCopyMessage,s=a.groupId,u=a.organizationId,c=a.originalMessage;return c&&this.host.models.Message.inject({escalationExecutionId:o,id:c.id}),i&&this.host.models.Message.inject({escalationExecutionId:o,id:i.id}),s&&!n&&this.host.models.Group.inject({id:s,escalationExecutionId:o,organizationId:u}),r}},{key:"getAll",value:function(){return this.host.models.EscalationExecution.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+d(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(e));return this.host.models.EscalationExecution.get(e)}}]),a((f=C).prototype,"escalateMessage",[o],(0,_.default)(f.prototype,"escalateMessage"),f.prototype),a(f.prototype,"acknowledge",[i],(0,_.default)(f.prototype,"acknowledge"),f.prototype),a(f.prototype,"cancel",[s],(0,_.default)(f.prototype,"cancel"),f.prototype),a(f.prototype,"skip",[u],(0,_.default)(f.prototype,"skip"),f.prototype),a(f.prototype,"removeEscalationGroup",[c],(0,_.default)(f.prototype,"removeEscalationGroup"),f.prototype),f);function C(){return(0,I.default)(this,C),(0,j.default)(this,(C.__proto__||(0,T.default)(C)).apply(this,arguments))}t.default=G,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=r(n(31)),i=r(n(10)),s=r(n(9)),u=r(n(4)),c=r(n(1)),l=r(n(2)),d=r(n(6)),f=r(n(5)),p=r(n(42)),y=r(n(14)),h=(a=y.default,(0,f.default)(g,a),(0,l.default)(g,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.info("unhandled event: "+e.type,e.data)}}]),g);function g(e,t){var n;(0,c.default)(this,g);var r=(0,d.default)(this,(g.__proto__||(0,u.default)(g)).call(this,e,t));r.EVENTS=(n={},(0,o.default)(n,"bang",function(e){this.host.groups.reactToBangEvent(e)}),(0,o.default)(n,"client_advisory",function(e){switch(e.data.advisory.name){case"replay_start":this.host.reactToAdvisoryEvent("replayStart",{replayMessageCount:e.data.advisory.replay_message_count});break;case"replay_stop":this.host.reactToAdvisoryEvent("replayStop")}}),(0,o.default)(n,"escalations",function(e){this.host.escalations.reactToEscalationsEvent(e)}),(0,o.default)(n,"friends",function(e){this.host.conversations.reactToFriendsEvent(e)}),(0,o.default)(n,"message|group_message",function(e){this.host.conversations.reactToMessageEvent(e)}),(0,o.default)(n,"message:status|group:message:status",function(e){this.host.messages.reactToMessageStatusEvent(e)}),(0,o.default)(n,"presence",function(e){this.host.presence.reactToPresenceEvent(e)}),(0,o.default)(n,"update",function(e){this.host.conversations.reactToUpdateEvent(e)}),(0,o.default)(n,"update:tag",function(e){this.host.roleTags.reactToUpdateEvent(e)}),(0,o.default)(n,"account:settings",function(n){var r=this;n.data.services.forEach(function(e){switch(e.xmlns){case"tigertext:iq:update:account":var t=e.account||n.data.token;r.host.users.refresh(t);break;case"tigertext:iq:update:org_settings":r.host.organizations.refreshAll();break;default:r.logger.warn("unhandled account:settings service type "+e.xmlns)}})}),(0,o.default)(n,"message:is_typing",function(e){this.host.typingStatus.reactToIsTypingEvent(e)}),(0,o.default)(n,"processing:start",function(e){this.host.conversations.reactToProcessingStart(e)}),(0,o.default)(n,"processing:stop",function(e){this.host.conversations.reactToProcessingStop(e)}),(0,o.default)(n,"remote_wipe",function(e){var t=this;return(0,s.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.host.notifications.disconnect(),t.host.signOut({fromServer:!0});case 2:case"end":return e.stop()}},e,t)}))()}),(0,o.default)(n,"validated",function(e){this.logger.warn("validated not implemented")}),(0,o.default)(n,"msg:metadata_update",function(e){this.logger.warn("msg:metadata_update not implemented")}),(0,o.default)(n,"conversation_mute",function(e){this.host.mute.reactToMuteEvent(e)}),(0,o.default)(n,"reconnect",function(e){this.host.events.reconnect()}),(0,o.default)(n,"push:credentials",function(){return null}),(0,o.default)(n,"sse:heartbeat",function(){return null}),n);var a=[];return(0,p.default)(r.EVENTS,function(t,e){e.includes("|")&&(a.push(e),e.split("|").forEach(function(e){return r.EVENTS[e]=t}))}),a.forEach(function(e){return delete r.EVENTS[e]}),r}t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,y,h=r(n(3)),g=r(n(7)),v=r(n(8)),m=r(n(11)),b=r(n(10)),w=r(n(29)),E=r(n(20)),x=r(n(9)),_=r(n(4)),k=r(n(1)),A=r(n(2)),T=r(n(6)),I=r(n(5)),O=r(n(24)),j=r(n(35)),S=n(18),R=r(n(17)),M=r(n(14)),z=(o=(0,S.decorator)(),u=(0,S.decorator)(),l=M.default,(0,I.default)(G,l),(0,A.default)(G,[{key:"mounted",value:function(){this._fetched=!1}},{key:"dispose",value:function(){this._fetched=!1}},{key:"create",value:(y=(0,x.default)(b.default.mark(function e(t){var n,r,a,o,i=this,s=t.avatarFile,u=t.description,c=t.memberIds,l=void 0===c?[]:c,d=t.metadata,f=t.name,p=t.organizationId,y=t.replayHistory,h=void 0===y||y,g=t.senderId,v=void 0===g?this.host.currentUserId:g;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),p){e.next=3;break}throw new R.default.ValidationError("organizationId","required");case 3:return e.next=5,E.default.all([v].concat((0,w.default)(l)).map(this.host.roles.__resolveRoleId).filter(Boolean).map(function(e){return i._resolveModelIdWithTypes(e,"user")}).map(function(e){return i.host.users.findOrCreate(e,{organizationId:p})}));case 5:return n=e.sent,e.t0=n,r=j.default.call(e.t0),l=r.map(function(e){return i._resolveModelIdWithTypes(e,"user")}),e.next=11,this.host.api.groups.create({avatarFile:s,description:u,excludeCreator:!1,isPublic:!0,memberIds:l,name:f,organizationId:p,replayHistory:h});case 11:if(a=e.sent,o=void 0,o=this.config.condensedReplays&&a.entity?this.host.conversations.__injectCounterParty({conversationId:a.conversation_id,entityAttrs:a.entity,entityType:"group",hasCurrentUser:!0,organizationId:a.organization_id}):this.host.models.Group.inject(a),d)return e.next=17,this.host.metadata.update(o.id,d,p);e.next=17;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"find",value:(p=(0,x.default)(b.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(t));e.next=4;break;case 4:if(a=(0,O.default)(a,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=null,a.bypassCache){e.next=13;break}if((n=this.host.models.Group.get(t))&&!n.$placeholder)return e.next=12,this.host.groups.__ensureEntitiesLoaded(n.id,a);e.next=13;break;case 12:return e.abrupt("return",n);case 13:return e.next=15,this.host.groups.__find(t);case 15:if(r=e.sent,n=this.host.models.Group.get(t),r){e.next=21;break}if(a.ignoreNotFound){e.next=20;break}throw new R.default.NotFoundError(this.host.models.Group.name,t);case 20:return e.abrupt("return",n);case 21:if(n)return e.next=24,this.host.groups.__ensureEntitiesLoaded(n.id,a);e.next=24;break;case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"findAll",value:(f=(0,x.default)(b.default.mark(function e(){var t,n,r,a,o=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).bypassCache,i=void 0!==o&&o;return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i&&this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["forum"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),this._fetched=!0,e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Group.getAll().filter(function(e){return e.isPublic})}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));return this.host.models.Group.get(e)}},{key:"join",value:(d=(0,x.default)(b.default.mark(function e(t){return b.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+s(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+i(t));case 4:return e.abrupt("return",this.host.groups.addMembers(t,[this.host.currentUserId]));case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})}]),a((c=G).prototype,"find",[o],(0,m.default)(c.prototype,"find"),c.prototype),a(c.prototype,"findAll",[u],(0,m.default)(c.prototype,"findAll"),c.prototype),c);function G(){return(0,k.default)(this,G),(0,T.default)(this,(G.__proto__||(0,_.default)(G)).apply(this,arguments))}t.default=z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function $(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,M.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=$(t[0],n);return t.every(function(e){return $(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return $(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,R.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,S.default)(e))+": "+$(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function D(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,M.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=D(t[0],n);return t.every(function(e){return D(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return D(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,R.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,S.default)(e))+": "+D(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S=r(n(3)),R=r(n(7)),M=r(n(8)),z=r(n(11)),G=r(n(21)),C=r(n(23)),P=r(n(10)),V=r(n(15)),N=r(n(29)),U=r(n(20)),F=r(n(9)),B=r(n(12)),q=r(n(13)),L=r(n(4)),Z=r(n(1)),K=r(n(2)),H=r(n(6)),W=r(n(5)),X=r(n(224)),Q=r(n(41)),Y=r(n(238)),J=r(n(24)),ee=r(n(14)),te=r(n(17)),ne=n(18),re=r(n(35)),ae=n(26),oe=n(22),ie=n(30),se=n(27),ue=(o=(0,ne.decorator)(),i=(0,ne.decorator)(),s=(0,ne.decorator)(),u=(0,ne.decorator)(),c=(0,ne.decorator)(),l=(0,ne.decorator)(),f=ee.default,(0,W.default)(ce,f),(0,K.default)(ce,[{key:"mounted",value:function(){this._fetched=!1,this._groupMemberIds={},this._userGroups={},this._userState={},this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onRemoveConversation),this.host.models.Group.on("afterInject",this._onChangeGroup),this.host.models.Group.on("afterEject",this._onRemoveGroup),this.host.models.Metadata.on("afterInject",this._onChangeMetadata),this.host.models.Metadata.on("afterEject",this._onChangeMetadata),this.host.models.User.on("afterInject",this._onChangeUser),this.host.models.User.on("afterEject",this._onRemoveUser)}},{key:"dispose",value:function(){this._fetched=!1,this._groupMemberIds={},this._userGroups={},this._userState={},this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onRemoveConversation),this.host.models.Group.removeListener("afterInject",this._onChangeGroup),this.host.models.Group.removeListener("afterEject",this._onRemoveGroup),this.host.models.Metadata.removeListener("afterInject",this._onChangeMetadata),this.host.models.Metadata.removeListener("afterEject",this._onChangeMetadata),this.host.models.User.removeListener("afterInject",this._onChangeUser),this.host.models.User.removeListener("afterEject",this._onRemoveUser)}},{key:"create",value:(j=(0,F.default)(P.default.mark(function e(t){var n,r,a,o,i,s=this,u=t.avatarFile,c=t.description,l=t.memberIds,d=void 0===l?[]:l,f=t.metadata,p=t.name,y=t.organizationId,h=t.replayHistory,g=void 0!==h&&h,v=t.senderId,m=void 0===v?this.host.currentUserId:v;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),y){e.next=3;break}throw new te.default.ValidationError("organizationId","required");case 3:return e.next=5,U.default.all([m].concat((0,N.default)(d)).map(this.host.roles.__resolveRoleId).filter(Boolean).map(function(e){return s._resolveModelIdWithTypes(e,"user")}).map(function(e){return s.host.users.findOrCreate(e,{organizationId:y})}));case 5:return n=e.sent,e.t0=n,r=re.default.call(e.t0),d=r.map(function(e){return s._resolveModelIdWithTypes(e,"user")}),a=this._shouldExcludeSender(y,d,m),p=p||this._getGroupName(r),e.next=13,this.host.api.groups.create({avatarFile:u,description:c,excludeCreator:a,memberIds:d,name:p,organizationId:y,replayHistory:g});case 13:if(o=e.sent,i=void 0,this.config.condensedReplays&&o.entity?(i=this.host.conversations.__injectCounterParty({conversationId:o.conversation_id,entityAttrs:o.entity,entityType:"group",organizationId:o.organization_id}),this.host.conversations.__injectConversation((0,V.default)({},o,{entity:i}))):i=this.host.models.Group.inject(o),f)return e.next=19,this.host.metadata.update(i.id,f,y);e.next=19;break;case 19:return e.abrupt("return",i);case 20:case"end":return e.stop()}},e,this)})),function(e){return j.apply(this,arguments)})},{key:"_shouldExcludeSender",value:function(e,t,n){var r,a,o=this.host.models.User.get(n);return!!((r=a=o)&&"user"===r.$entityType&&a.isRoleBot&&o.botRole&&0<o.botRole.members.length)&&!t.includes(o.botRole.memberIds[0])}},{key:"_getGroupName",value:function(e){return e.map(function(e){var t=e.displayName,n=e.firstName;return e.isRoleBot?t:n||((0,ie.isEmail)(t)||(0,se.isPhone)(t)?t:"")}).filter(Boolean).join(", ")||"Group"}},{key:"update",value:(O=(0,F.default)(P.default.mark(function e(t,n){var r,a,o,i=n.name,s=n.avatarFile,u=n.replayHistory,c=n.memberIds,l=n.metadata;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),r={},void 0!==i&&(r.name=i),void 0!==u&&(r.replayHistory=u),void 0!==c&&(r.memberIds=c.map(this.host.roles.__resolveRoleId)),e.next=12,this.host.api.groups.update(t,{name:i,avatarFile:s,replayHistory:u,memberIds:c});case 12:if(void 0!==(a=e.sent).avatarUrl&&(r.avatarUrl=a.avatarUrl),o=this.host.models.Group.inject((0,V.default)({id:t},r)),l)return e.next=18,this.host.metadata.update(t,l,o.organizationId);e.next=18;break;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}},e,this)})),function(e,t){return O.apply(this,arguments)})},{key:"find",value:(I=(0,F.default)(P.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=4;break;case 4:if(a=(0,J.default)(a,{bypassCache:!1,ignoreNotFound:!1,includeMembers:!1}),this.host.requireUser(),n=null,a.bypassCache){e.next=13;break}if((n=this.host.models.Group.get(t))&&!n.$placeholder)return e.next=12,this.__ensureEntitiesLoaded(n.id,a);e.next=13;break;case 12:return e.abrupt("return",n);case 13:return e.next=15,this.__find(t);case 15:if(r=e.sent,n=this.host.models.Group.get(t),r){e.next=21;break}if(a.ignoreNotFound){e.next=20;break}throw new te.default.NotFoundError(this.host.models.Group.name,t);case 20:return e.abrupt("return",n);case 21:if(n)return e.next=24,this.__ensureEntitiesLoaded(n.id,a);e.next=24;break;case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}},e,this)})),function(e){return I.apply(this,arguments)})},{key:"__find",value:(T=(0,F.default)(P.default.mark(function e(t){var n,r,a,o,i;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=4;break;case 4:return n=this.host.models.Group.get(t),e.next=7,this.host.api.groups.find(t);case 7:if(r=e.sent,this.config.condensedReplays&&r&&r.entity)return a=r.entity,n=this.host.conversations.__injectCounterParty({conversationId:r.conversation_id,entityAttrs:a,entityType:"group",organizationId:r.organization_id}),this.host.models.Group.removePlaceholder({entity:n,attrs:a}),e.abrupt("return",a);e.next=15;break;case 15:return r&&(this.__removeForumMembers(r),o=r.metadata,n=this.host.models.Group.inject(r),i=n.organizationId,o&&i&&this.host.metadata.__injectMetadata(t,i,o)),this.host.models.Group.removePlaceholder({entity:n,attrs:r}),e.abrupt("return",r);case 18:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"__removeForumMembers",value:function(e){var t=e.members,n=this.__extractGroupTypeFromAttrs(e);n===ae.GroupType.FORUM?t&&0===t.length&&delete e.members:n===ae.GroupType.ROLE_ASSIGNMENT||t||(e.members=[])}},{key:"__extractGroupTypeFromAttrs",value:function(e){var t=e.id||e.token,n=e.organizationId||e.organization_key,r=n?this.host.metadata.get(t,n):null,a=e.metadata||(r?r.data:null),o=ae.GroupType.GROUP;return a&&"role_assignment"===a.meta_type?o=ae.GroupType.ROLE_ASSIGNMENT:a&&"role"===a.feature_service?o=ae.GroupType.ROLE_P2P:a&&"escalation"===a.feature_service?o=ae.GroupType.ESCALATION:a&&"patient_care"===a.feature_service?o=ae.GroupType.PATIENT_CARE:a&&"patient_messaging"===a.feature_service?o=ae.GroupType.PATIENT_MESSAGING:(e.isPublic||e.is_public)&&(o=ae.GroupType.FORUM),o}},{key:"__ensureEntitiesLoaded",value:(A=(0,F.default)(P.default.mark(function e(t,n){var r,a;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=4;break;case 4:return r=this.host.models.Group.get(t),a=[this.ensureMetadata(r)],n.includeMembers&&a.push(this.ensureMembers(r)),e.next=9,U.default.all(a);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"findAll",value:(k=(0,F.default)(P.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).includeMembers,j=void 0!==O&&O;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched)return e.abrupt("return",this.getAll());e.next=2;break;case 2:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=6,this.host.organizations.findAll();e.next=7;break;case 6:t=e.sent;case 7:return e.next=9,this.host.search.query({types:["group"],organizationIds:t.map(function(e){return e.id}),query:{displayName:""},followContinuations:!0});case 9:if(n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),!j){e.next=93;break}if(o={},!a||"function"!=typeof a[q.default]&&!Array.isArray(a))throw new TypeError("Expected groups to be iterable, got "+$(a));e.next=16;break;case 16:if(!a||"function"!=typeof a[q.default]&&!Array.isArray(a))throw new TypeError("Expected groups to be iterable, got "+D(a));e.next=18;break;case 18:s=!(i=!0),u=void 0,e.prev=21,c=(0,B.default)(a);case 23:if(i=(l=c.next()).done){e.next=52;break}if(d=l.value,f=d.organizationId,!(p=d.memberIds)||"function"!=typeof p[q.default]&&!Array.isArray(p))throw new TypeError("Expected memberIds to be iterable, got "+$(p));e.next=28;break;case 28:if(!p||"function"!=typeof p[q.default]&&!Array.isArray(p))throw new TypeError("Expected memberIds to be iterable, got "+D(p));e.next=30;break;case 30:for(h=!(y=!0),g=void 0,e.prev=33,v=(0,B.default)(p);!(y=(m=v.next()).done);y=!0)b=m.value,o[f]||(o[f]=[]),o[f].includes(b)||o[f].push(b);e.next=41;break;case 37:e.prev=37,e.t0=e.catch(33),h=!0,g=e.t0;case 41:e.prev=41,e.prev=42,!y&&v.return&&v.return();case 44:if(e.prev=44,h)throw g;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:i=!0,e.next=23;break;case 52:e.next=58;break;case 54:e.prev=54,e.t1=e.catch(21),s=!0,u=e.t1;case 58:e.prev=58,e.prev=59,!i&&c.return&&c.return();case 61:if(e.prev=61,s)throw u;e.next=64;break;case 64:return e.finish(61);case 65:return e.finish(58);case 66:if(w=[],!(T=(0,C.default)(o))||"function"!=typeof T[q.default]&&!Array.isArray(T))throw new TypeError("Expected _Object$entries to be iterable, got "+$(T));e.next=70;break;case 70:if(!T||"function"!=typeof T[q.default]&&!Array.isArray(T))throw new TypeError("Expected _Object$entries to be iterable, got "+D(T));e.next=72;break;case 72:for(x=!(E=!0),_=void 0,e.prev=75,k=(0,B.default)(T);!(E=(A=k.next()).done);E=!0)I=(0,G.default)(A.value,2),f=I[0],p=I[1],w.push(this.host.users.ensureUsers(p,f));e.next=83;break;case 79:e.prev=79,e.t2=e.catch(75),x=!0,_=e.t2;case 83:e.prev=83,e.prev=84,!E&&k.return&&k.return();case 86:if(e.prev=86,x)throw _;e.next=89;break;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.next=93,U.default.all(w);case 93:return this._fetched=!0,e.abrupt("return",a);case 95:case"end":return e.stop()}},e,this,[[21,54,58,66],[33,37,41,49],[42,,44,48],[59,,61,65],[75,79,83,91],[84,,86,90]])})),function(){return k.apply(this,arguments)})},{key:"findAllWithSpecificMembers",value:(_=(0,F.default)(P.default.mark(function e(t,n,r){var a;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+D(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 4:if(null==r||r instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+D(r));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+$(t));case 8:if("string"==typeof n||n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(n));case 10:if(null==r||r instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+$(r));case 12:if(n=this._resolveModelId(n),t=(0,oe.arrayWrap)(t).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),0===(a=this.__findAllLocalWithSpecificMembers(t,n,r)).length)return e.next=18,this.findAll();e.next=19;break;case 18:a=this.__findAllLocalWithSpecificMembers(t,n,r);case 19:return e.abrupt("return",a);case 20:case"end":return e.stop()}},e,this)})),function(e,t,n){return _.apply(this,arguments)})},{key:"ensureMembers",value:(x=(0,F.default)(P.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+D(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+$(t));case 4:if(t.memberIds){e.next=17;break}if(t.groupType===ae.GroupType.FORUM)return e.next=8,this.findAllMemberIds(t.id);e.next=12;break;case 8:(n=e.sent)&&this.host.models.Group.inject({id:t.id,members:n}),e.next=17;break;case 12:if(t.groupType!==ae.GroupType.ROLE_ASSIGNMENT){e.next=15;break}e.next=17;break;case 15:return e.next=17,this.__find(t.id);case 17:return(r=a.attrs?(0,V.default)({},a.attrs):{}).organizationId=t.organizationId,e.next=21,this.ensureMembersWithIds(t.id,t.memberIds,(0,V.default)({},a,{attrs:r}));case 21:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"ensureMembersWithIds",value:(E=(0,F.default)(P.default.mark(function e(t,n){var r=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+D(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+$(n));case 8:if(this.host.requireUser(),0===(n=(0,Y.default)(n,this.host.currentUserId)).length)return e.abrupt("return");e.next=12;break;case 12:return a=(0,J.default)(a,{onlyPlaceholder:!1}),e.next=15,U.default.all(n.map(function(e){return r.__ensureMember(e,a)}).filter(Boolean));case 15:0<e.sent.length&&this.host.models.Group.touch(t);case 17:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"__ensureMember",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(e));if("string"!=typeof e)throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(e));if(!this.host.models.User.shouldEnsure(e,t.onlyPlaceholder))return null;var n=this.host.models.User.get(e);return n&&t.attrs&&this.host.models.User.injectPlaceholder((0,V.default)({id:n.id},t.attrs)),this.host.models.User.waitForEnsuredEntity(e,t)}},{key:"ensureMetadata",value:(w=(0,F.default)(P.default.mark(function e(t){var n,r,a;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+D(t));case 2:if(t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "group" violates contract.\n\nExpected:\nObject\n\nGot:\n'+$(t));case 4:if(n=t.groupType,r=t.id,(a=t.organizationId)&&this.host.metadata.get(r,a)){e.next=12;break}if(n!==ae.GroupType.FORUM&&n!==ae.GroupType.ROLE_ASSIGNMENT){e.next=10;break}e.next=12;break;case 10:return e.next=12,this.__find(r);case 12:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Group.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(e));return this.host.models.Group.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+D(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+$(e));return this.host.models.Group.getMulti(e)}},{key:"__findAllLocalWithSpecificMembers",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=n.exact,a=void 0===r||r,o=n.includeCurrentUser,i=void 0===o||o,s=n.includeForums,u=void 0===s||s,c=n.includeRoles,l=void 0===c||c,d=n.senderId,f=void 0===d?null:d;if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+D(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+D(t));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+$(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));var p=this.host,y=p.currentUser,h=p.currentUserId,g=y.roles.map(function(e){return e.botUserId});f&&g.includes(f)?(e=e.slice()).push(f,h):i&&!e.includes(h)&&(e=e.slice()).push(h);var v=e.includes(h),m=e.length,b=this.host.models.Group.getAll(),w=[];if(!b||"function"!=typeof b[q.default]&&!Array.isArray(b))throw new TypeError("Expected all to be iterable, got "+$(b));if(!b||"function"!=typeof b[q.default]&&!Array.isArray(b))throw new TypeError("Expected all to be iterable, got "+D(b));var E=!0,x=!1,_=void 0;try{for(var k,A=(0,B.default)(b);!(E=(k=A.next()).done);E=!0){var T=k.value;if(u||T.groupType!==ae.GroupType.FORUM){var I=T.memberIds;if(T.organizationId===t&&I){var O=!0;if(!e||"function"!=typeof e[q.default]&&!Array.isArray(e))throw new TypeError("Expected memberIds to be iterable, got "+$(e));if(!e||"function"!=typeof e[q.default]&&!Array.isArray(e))throw new TypeError("Expected memberIds to be iterable, got "+D(e));var j=!0,S=!1,R=void 0;try{for(var M,z=(0,B.default)(e);!(j=(M=z.next()).done);j=!0){var G=M.value;if(!I.includes(G)){O=!1;break}}}catch(e){S=!0,R=e}finally{try{!j&&z.return&&z.return()}finally{if(S)throw R}}if(O){if(a){if(!f&&!v)continue;var C=m;if(l){if(!g||"function"!=typeof g[q.default]&&!Array.isArray(g))throw new TypeError("Expected myBotUserIds to be iterable, got "+$(g));if(!g||"function"!=typeof g[q.default]&&!Array.isArray(g))throw new TypeError("Expected myBotUserIds to be iterable, got "+D(g));var P=!0,V=!1,N=void 0;try{for(var U,F=(0,B.default)(g);!(P=(U=F.next()).done);P=!0){var L=U.value;T.memberIds.includes(L)&&C++}}catch(e){V=!0,N=e}finally{try{!P&&F.return&&F.return()}finally{if(V)throw N}}}if(C!==T.memberIds.length)continue}w.push(T)}}}}}catch(e){x=!0,_=e}finally{try{!E&&A.return&&A.return()}finally{if(x)throw _}}return w}},{key:"destroy",value:(b=(0,F.default)(P.default.mark(function e(t){return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.next=8,this.host.api.groups.destroy(t);case 8:if(e.sent){e.next=11;break}throw new te.default.NotFoundError(this.host.models.Group.name,t);case 11:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"findAllMemberIds",value:(m=(0,F.default)(P.default.mark(function e(t){return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 4:return this.host.requireUser(),t=this._resolveModelId(t),e.abrupt("return",this.host.api.groups.findAllMemberIds(t));case 7:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"addMembers",value:(v=(0,F.default)(P.default.mark(function e(t,n){var r,a,o,i;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+D(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+$(n));case 8:if(this.host.requireUser(),t=this._resolveModelId(t),n=(0,oe.arrayWrap)(n).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),(r=this.getById(t))&&r.groupType===ae.GroupType.ROLE_P2P)throw new te.default.PermissionDeniedError("role p2p group",r.id,"add users");e.next=14;break;case 14:if(!r){e.next=20;break}if("FORUM"!==r.groupType||r.memberIds){e.next=19;break}return e.next=18,this.findAllMemberIds(t);case 18:r.memberIds=e.sent;case 19:n=(0,Q.default)(n,r.memberIds);case 20:if(0===n.length)return e.abrupt("return");e.next=22;break;case 22:return e.next=24,this.host.api.groups.addMembers(t,n);case 24:if(a=e.sent,!this.config.condensedReplays){e.next=37;break}if(o=this.host.conversations.getById(a.conversation_id)){e.next=34;break}return e.next=30,this.host.api.conversations.find(a.conversation_id);case 30:if(i=e.sent){e.next=33;break}throw new te.default.NotFoundError(this.host.models.Conversation.name,t);case 33:o=this.host.conversations.__injectConversation(i);case 34:a.unread_message_count&&(o.unreadCount=a.unread_message_count),a.unread_priority_message_count&&(o.unreadPriorityCount=a.unread_priority_message_count),this.host.models.Conversation.inject(o);case 37:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"removeMembers",value:(g=(0,F.default)(P.default.mark(function e(t,n){var r,a,o,i,s;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+D(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 6:if("string"==typeof n||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "memberIds" violates contract.\n\nExpected:\nstring | string[] | Object[]\n\nGot:\n'+$(n));case 8:if(this.host.requireUser(),t=this._resolveModelId(t),n=(0,oe.arrayWrap)(n).map(this._resolveModelId).map(this.host.roles.__resolveRoleId),!(r=this.getById(t))){e.next=22;break}if(a=r.groupType,o=r.id,i=r.p2pSender,s=i&&"role"===i.$entityType&&i.botUserId,a===ae.GroupType.ROLE_P2P&&s&&n.includes(s))throw new te.default.PermissionDeniedError("role p2p group",o,"remove an on-duty user");e.next=17;break;case 17:if("FORUM"!==a||r.memberIds){e.next=21;break}return e.next=20,this.findAllMemberIds(t);case 20:r.memberIds=e.sent;case 21:n=(0,X.default)(n,r.memberIds);case 22:if(0===n.length)return e.abrupt("return");e.next=24;break;case 24:return e.next=26,this.host.api.groups.removeMembers(t,n);case 26:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"addMember",value:(h=(0,F.default)(P.default.mark(function e(t,n){return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(n));case 8:return e.abrupt("return",this.addMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"removeMember",value:(y=(0,F.default)(P.default.mark(function e(t,n){return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "memberId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(n));case 8:return e.abrupt("return",this.removeMembers(t,[n]));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"leave",value:(p=(0,F.default)(P.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g;return P.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+D(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 4:if(t=this._resolveModelId(t),n=this.getById(t)){e.next=8;break}return e.abrupt("return");case 8:if(r=this.host,a=r.currentUser,o=r.currentUserId,i=n.groupType,s=n.p2pSender,u=n.memberIds,c=a.roles.map(function(e){return e.botUserId}),l=[o],i===ae.GroupType.FORUM)return e.next=16,this.findAllMemberIds(t);e.next=17;break;case 16:u=e.sent;case 17:if(i!==ae.GroupType.ROLE_P2P||!s){e.next=21;break}l=["user"===s.$entityType?s.id:s.botUserId],e.next=45;break;case 21:if(!u){e.next=45;break}if(!u||"function"!=typeof u[q.default]&&!Array.isArray(u))throw new TypeError("Expected memberIds to be iterable, got "+$(u));e.next=24;break;case 24:if(!u||"function"!=typeof u[q.default]&&!Array.isArray(u))throw new TypeError("Expected memberIds to be iterable, got "+D(u));e.next=26;break;case 26:for(f=!(d=!0),p=void 0,e.prev=29,y=(0,B.default)(u);!(d=(h=y.next()).done);d=!0)g=h.value,c.includes(g)&&l.push(g);e.next=37;break;case 33:e.prev=33,e.t0=e.catch(29),f=!0,p=e.t0;case 37:e.prev=37,e.prev=38,!d&&y.return&&y.return();case 40:if(e.prev=40,f)throw p;e.next=43;break;case 43:return e.finish(40);case 44:return e.finish(37);case 45:return e.next=47,this.removeMembers(t,l);case 47:case"end":return e.stop()}},e,this,[[29,33,37,45],[38,,40,44]])})),function(e){return p.apply(this,arguments)})},{key:"reactToBangEvent",value:function(e){var t=e.data,n=(t=(0,oe.jsonCloneDeep)(t)).bang_id||""+t.sort_number;return this.__handleBang({data:t,eventId:n,alwaysAddToTimeline:!1})}},{key:"__handleBang",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=void 0!==r&&r,o=t.event;"added"===o?this.__addedToGroup({data:t,eventId:n,alwaysAddToTimeline:a}):"removed"===o?this.__removedFromGroup({data:t,eventId:n,alwaysAddToTimeline:a}):ae.EscalationChangeAction.fromServer(o)&&this.__handleEscalationBang({data:t,eventId:n,alwaysAddToTimeline:a})}},{key:"__handleEscalationBang",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(o.token&&i.token){var u=this.host.models.Group.get(i.token);u=u||this.host.models.Group.injectPlaceholder({id:i.token,organizationId:s});var c=this.host.models.EscalationExecution.get(o.token);c=(c=c||u.escalationExecution)||(l===ae.EscalationChangeAction.MEMBER_ADDED?null:this.host.models.EscalationExecution.inject({id:o.token,organizationId:s}));var l=ae.EscalationChangeAction.resolve(t.event),d=t.action_user_name,f=t.action_time||t.created_on,p=null,y=null;l===ae.EscalationChangeAction.INITIATED?p={displayName:a.display_name,id:a.token,organizationId:s,type:"user"}:l===ae.EscalationChangeAction.MEMBER_ADDED?y=[{displayName:t.member_name,id:t.member_id,organizationId:s,type:"user"}]:l!==ae.EscalationChangeAction.NO_RESPONSE&&(p={displayName:d,id:null,organizationId:s,type:"user"});var h={action:l,actionTime:f,actor:p,alwaysAddToTimeline:r,createdAt:t.created_on,escalationExecution:c,group:u,members:y,id:n,sortNumber:+t.sort_number};this.host.conversations.addEscalationExecutionChangeLog(h)}}},{key:"__addedToGroup",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(a&&a.token&&i&&i.token&&o&&o.token){var u={displayName:a.display_name,id:a.token,organizationId:s,type:"user"},c={displayName:o.display_name,id:o.token,organizationId:s,type:"user"},l=this.host.models.Group.get(i.token);if(l){var d=this.host.models.User.get(u.id),f=d&&d.isRoleBot?"OPT_IN":c.id===u.id?"JOIN":"ADD",p={action:f,actionTime:t.action_time||t.created_on,actor:u,alwaysAddToTimeline:r,createdAt:t.created_on,group:l,id:n,members:[c],memberIds:[c.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(p),"OPT_IN"!=f&&l.memberIds&&l.memberIds.includes(c.id)||(this.host.models.Group.touch(l),this.emit("membership:change",p))}}}},{key:"__removedFromGroup",value:function(e){var t=e.data,n=e.eventId,r=e.alwaysAddToTimeline,a=t.caller_entity,o=t.subject_entity,i=t.target_entity,s=t.organization_id;if(a&&a.token&&i&&i.token&&o&&o.token){var u=this.host.models.Group.get(i.token);if(u){var c={displayName:a.display_name,id:a.token,organizationId:s,type:"user"},l={displayName:o.display_name,id:o.token,organizationId:s,type:"user"},d=this.host.models.User.get(c.id),f=d&&d.isRoleBot?"OPT_OUT":l.id===c.id?"LEAVE":"REMOVE",p={action:f,actionTime:t.action_time||t.created_on,actor:c,alwaysAddToTimeline:r,createdAt:t.created_on,group:u,id:n,members:[l],memberIds:[l.id],sortNumber:+t.sort_number};this.host.conversations.addMembershipChangeLog(p),"OPT_OUT"!=f&&u.memberIds&&!u.memberIds.includes(l.id)||this.emit("membership:change",p)}}}}]),a((d=ce).prototype,"find",[o],(0,z.default)(d.prototype,"find"),d.prototype),a(d.prototype,"__find",[i],(0,z.default)(d.prototype,"__find"),d.prototype),a(d.prototype,"__ensureEntitiesLoaded",[s],(0,z.default)(d.prototype,"__ensureEntitiesLoaded"),d.prototype),a(d.prototype,"findAll",[u],(0,z.default)(d.prototype,"findAll"),d.prototype),a(d.prototype,"findAllWithSpecificMembers",[c],(0,z.default)(d.prototype,"findAllWithSpecificMembers"),d.prototype),a(d.prototype,"findAllMemberIds",[l],(0,z.default)(d.prototype,"findAllMemberIds"),d.prototype),d);function ce(){var e,t,w,n;(0,Z.default)(this,ce);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=w=(0,H.default)(this,(e=ce.__proto__||(0,L.default)(ce)).call.apply(e,[this].concat(a))),w._setP2PEntities=function(e){var t=e.createdByRole,n=e.createdByUser,r=e.groupType,a=e.targetUser,o=e.targetRole,i=w.host.currentUser;if(i&&r===ae.GroupType.ROLE_P2P){var s=i.roles,u=[],c=[];t?c.push(t):n&&n!==i&&u.push(n),o?c.push(o):a&&a!==i&&u.push(a);var l=null,d=null;1===c.length?d=n===i||a===i?s.includes(c[0])?(l=i,c[0]):(l=c[0],i):(l=u[0],c[0]):2===c.length&&(s.includes(c[0])?(l=c[1],d=c[0]):s.includes(c[1])&&(l=c[0],d=c[1])),e.p2pRecipient=l,e.p2pSender=d}},w._onChangeConversation=function(e,t){var n=t.counterPartyId;if("group"===t.counterPartyType){var r=w.host.models.Group.get(n);r&&(r.conversation||w.host.models.Group.inject(r))}},w._onRemoveConversation=function(e,t){var n=t.counterPartyId;if("group"===t.counterPartyType){var r=w.host.models.Group.get(n);r&&r.conversation&&w.host.models.Group.inject(r)}},w._onChangeGroup=function(e,t){var n=t.id,r=t.memberIds,a=w._groupMemberIds[n];if(a){if(!a||"function"!=typeof a[q.default]&&!Array.isArray(a))throw new TypeError("Expected lastGroupMemberIds to be iterable, got "+$(a));if(!a||"function"!=typeof a[q.default]&&!Array.isArray(a))throw new TypeError("Expected lastGroupMemberIds to be iterable, got "+D(a));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,B.default)(a);!(o=(u=c.next()).done);o=!0){var l=u.value,d=w._userGroups[l],f=d?d.indexOf(t):-1;-1<f&&r&&!r.includes(l)&&d.splice(f,1)}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}if(r){if(!(w._groupMemberIds[n]=r)||"function"!=typeof r[q.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+$(r));if(!r||"function"!=typeof r[q.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+D(r));var p=!0,y=!1,h=void 0;try{for(var g,v=(0,B.default)(r);!(p=(g=v.next()).done);p=!0){var m=g.value,b=w._userGroups[m]||[];b.includes(t)||b.push(t),w._userGroups[m]=b}}catch(e){y=!0,h=e}finally{try{!p&&v.return&&v.return()}finally{if(y)throw h}}}},w._onRemoveGroup=function(e,t){var n=t.id,r=t.memberIds;if(delete w._groupMemberIds[n],r){if(!r||"function"!=typeof r[q.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+$(r));if(!r||"function"!=typeof r[q.default]&&!Array.isArray(r))throw new TypeError("Expected memberIds to be iterable, got "+D(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,B.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value,l=w._userGroups[c],d=l?l.indexOf(t):-1;-1<d&&l.splice(d,1)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}},w._onChangeMetadata=function(e,t){var n=t.entityId,r=w.host.models.Group.get(n);r&&w.host.models.Group.inject(r)},w._onChangeUser=function(e,t){var n=t.botRole,r=t.id,a=t.isRoleBot,o=w._userGroups[r],i=w._userState[r],s=i&&(i.botRole!==n||i.isRoleBot!==a);if(i&&!s||(w._userState[r]={botRole:n,isRoleBot:a}),o){if(!o||"function"!=typeof o[q.default]&&!Array.isArray(o))throw new TypeError("Expected groups to be iterable, got "+$(o));if(!o||"function"!=typeof o[q.default]&&!Array.isArray(o))throw new TypeError("Expected groups to be iterable, got "+D(o));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,B.default)(o);!(u=(d=f.next()).done);u=!0){var p=d.value,y=p.conversation,h=p.groupType,g=p.members;h!==ae.GroupType.ROLE_P2P&&!s&&g&&g.includes(t)||(w.host.models.Group.inject(p),y&&w.host.models.Conversation.inject(y))}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}}},w._onRemoveUser=function(e,t){var n=t.id,r=w._userGroups[n];if(r&&0<r.length){if(!r||"function"!=typeof r[q.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+$(r));if(!r||"function"!=typeof r[q.default]&&!Array.isArray(r))throw new TypeError("Expected groups to be iterable, got "+D(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,B.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value,l=c.members;l&&l.includes(t)&&w.host.models.Group.inject(c)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}delete w._userGroups[n],delete w._userState[n]},n=t,(0,H.default)(w,n)}t.default=ue,e.exports=t.default},function(e,t,d){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function Se(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,be.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=Se(t[0],n);return t.every(function(e){return Se(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return Se(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,ze.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,ie.default)(e))+": "+Se(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function Re(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,be.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=Re(t[0],n);return t.every(function(e){return Re(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return Re(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,ze.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,ie.default)(e))+": "+Re(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C,P,V,N,U,F,L,$,D,B,q,Z,K,H,W,X,Q,Y,J,ee,te,ne,re,ae,oe,ie=n(d(3)),se=n(d(11)),Me=n(d(32)),ze=n(d(7)),ue=n(d(21)),ce=n(d(23)),le=n(d(33)),de=n(d(15)),Ge=n(d(12)),Ce=n(d(13)),Pe=n(d(10)),fe=n(d(20)),pe=n(d(9)),ye=n(d(4)),he=n(d(1)),ge=n(d(2)),ve=n(d(6)),me=n(d(5)),be=n(d(8)),Ve=n(d(55)),we=n(d(41)),Ee=n(d(90)),xe=n(d(215)),_e=n(d(24)),ke=n(d(219)),Ae=n(d(43)),Te=n(d(221)),Ie=n(d(213)),Oe=n(d(36)),je=n(d(89)),Ne=n(d(35)),Ue=n(d(91)),Fe=d(18),Le=n(d(61)),$e=n(d(17)),De=d(26),Be=d(38),qe=d(22),Ze=d(30),Ke=d(51),He=d(27),We=d(37),Xe=n(d(14)),Qe=["escalationExecutionId","id","serverId"],Ye=["distributionList","group","user"],Je=(a=(0,Fe.decorator)(),o=(0,Fe.decorator)(),i=(0,Fe.decorator)({serializeArguments:function(e){return e[0]}}),s=(0,Fe.decorator)({memoize:!0}),u=(0,Fe.decorator)(),c=(0,Fe.decorator)({memoize:!0}),l=(0,Fe.decorator)({serializeArguments:function(e){return"object"===(0,be.default)(e[0])?e[0].id:e[0]}}),f=(0,Fe.decorator)({serializeArguments:function(e){return e[0].map(function(e){return"object"===(void 0===e?"undefined":(0,be.default)(e))?e.id:e}).join(":")}}),y=Xe.default,(0,me.default)(et,y),(0,ge.default)(et,[{key:"mounted",value:function(){this._pendingFindRecipientStatuses={},this._queuedFindRecipientStatuses=[],this._queuedSetMessageStatuses={deliveredIds:[],readIds:[]},this.host.on("tick",this._onTick),this.host.models.MessageStatusPerRecipient.on("afterInject",this._onChangeMessageStatus),this.host.models.MessageStatusPerRecipient.on("afterEject",this._onChangeMessageStatus)}},{key:"dispose",value:function(){this._pendingFindRecipientStatuses=null,this._queuedFindRecipientStatuses=null,this._queuedSetMessageStatuses=null,this._downloadAttachmentBlobAndUrl&&Fe.decorator.clear(this._downloadAttachmentBlobAndUrl),this.downloadAttachmentUrl&&Fe.decorator.clear(this.downloadAttachmentUrl),this.downloadAttachment&&Fe.decorator.clear(this.downloadAttachment),this._throttled_flushFindRecipientStatusesQueue.cancel&&this._throttled_flushFindRecipientStatusesQueue.cancel(),this._throttled_flushSetMessageStatusesQueue.cancel&&this._throttled_flushSetMessageStatusesQueue.cancel(),this.host.removeListener("tick",this._onTick),this.host.models.MessageStatusPerRecipient.removeListener("afterInject",this._onChangeMessageStatus),this.host.models.MessageStatusPerRecipient.removeListener("afterEject",this._onChangeMessageStatus)}},{key:"send",value:(oe=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(null==d||d instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(d));case 6:if("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||t instanceof Object||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | string[] | Object | Object[]\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==d||d instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(d));case 12:if(Array.isArray(t))return e.next=15,this.__resolveSender(d);e.next=16;break;case 15:return e.abrupt("return",this.sendToGroupOfUsers(t,n,d));case 16:return e.next=18,this.__resolveCounterPartyEntityAndOrganizationId(t,d.senderOrganizationId||d.organizationId);case 18:return r=e.sent,a=r.counterParty,o=r.organizationId,qe.Validator.notEmpty("counterPartyId",a,"counterPartyId not found"),o?d=(0,de.default)({},(0,Oe.default)(d,"organizationId","senderOrganizationId","recipientOrganizationId"),{organizationId:o}):o=d.organizationId,e.next=25,this.__resolveSender(d);case 25:if(i=e.sent,s=function(e){return e&&"user"===e.$entityType},(u=function(e){return s(e)&&e.isRoleBot})(a)||s(a)&&u(i))return e.abrupt("return",this.sendToRole(t,n,d));e.next=30;break;case 30:if(c=a.groupType,l=a.memberIds,c!==De.GroupType.FORUM||l&&l.includes(this.host.currentUserId)){e.next=34;break}return e.next=34,this.host.forums.join(a);case 34:return e.abrupt("return",this.__sendToCounterParty(a,n,d));case 35:case"end":return e.stop()}},e,this)})),function(e,t){return oe.apply(this,arguments)})},{key:"__resolveSender",value:(ae=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.__resolveSenderId(t),r=t.senderOrganizationId||t.organizationId,n===this.host.currentUserId)return e.abrupt("return",this.host.currentUser);e.next=4;break;case 4:return r||qe.Validator.raise("senderOrganizationId","missing","When senderId is provided, senderOrganizationId or organizationId must also be provided"),e.next=7,this.host.users.find(n,{organizationId:r});case 7:return(a=e.sent)||qe.Validator.raise("senderId","invalid","The provided senderId was not found"),a.isRoleBot||qe.Validator.raise("senderId","invalid","senderId must be either the current user or a role"),e.next=12,this.host.roles.find(n,r);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)})),function(e){return ae.apply(this,arguments)})},{key:"__resolveSenderId",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.senderId;return t=t?(t=this._resolveModelId(t),this.host.roles.__resolveRoleId(t)):this.host.currentUserId,e.senderId=t}},{key:"__resolveCounterPartyEntityAndOrganizationId",value:(re=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if(null!=o&&"string"!=typeof o)throw new TypeError('Value of argument "providedOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Re(o));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if(null!=o&&"string"!=typeof o)throw new TypeError('Value of argument "providedOrganizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(o));e.next=8;break;case 8:if("string"==typeof t&&(t=this.host.roles.__resolveRoleId(t)),n=this._resolveEntity(t,[].concat(Ye,["conversation"])),r=o,n){e.next=17;break}if(this.host.conversations.looksLikeConversationHandle(t))return e.next=15,this.host.conversations.find(t);e.next=17;break;case 15:(a=e.sent)&&(n=a.counterParty,r=a.organizationId);case 17:if(n){e.next=21;break}return e.next=20,this.__resolveRemoteCounterPartyEntity(t,r);case 20:n=e.sent;case 21:return n&&(n.organizationId&&"user"!==n.$entityType&&(r=n.organizationId),"conversation"===n.$entityType&&(n=n.counterParty)),e.abrupt("return",{counterParty:n,organizationId:r});case 23:case"end":return e.stop()}},e,this)})),function(e){return re.apply(this,arguments)})},{key:"__lookUpUser",value:(ne=(0,pe.default)(Pe.default.mark(function e(t,n){var r;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Re(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=6;break;case 6:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(n));e.next=8;break;case 8:return e.next=10,this.host.users.findOrCreate(t,{organizationId:n});case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return ne.apply(this,arguments)})},{key:"__resolveRemoteCounterPartyEntity",value:(te=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d=this;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));e.next=2;break;case 2:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Re(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=6;break;case 6:if(null!=n&&"string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(n));e.next=8;break;case 8:if(r=null,t=this.host.roles.__resolveRoleId(t),!(a=(0,Ie.default)([(0,pe.default)(Pe.default.mark(function e(){return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.users.find(t,{organizationId:n}));case 1:case"end":return e.stop()}},e,d)})),(0,pe.default)(Pe.default.mark(function e(){return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",((0,Ze.isEmail)(t)||(0,He.isPhone)(t))&&d.__lookUpUser(t,n));case 1:case"end":return e.stop()}},e,d)})),(0,pe.default)(Pe.default.mark(function e(){return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.groups.find(t));case 1:case"end":return e.stop()}},e,d)})),(0,pe.default)(Pe.default.mark(function e(){return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.host.distributionLists.find(t));case 1:case"end":return e.stop()}},e,d)}))]))||"function"!=typeof a[Ce.default]&&!Array.isArray(a))throw new TypeError("Expected resolvers to be iterable, got "+Se(a));e.next=13;break;case 13:if(!a||"function"!=typeof a[Ce.default]&&!Array.isArray(a))throw new TypeError("Expected resolvers to be iterable, got "+Re(a));e.next=15;break;case 15:i=!(o=!0),s=void 0,e.prev=18,u=(0,Ge.default)(a);case 20:if(o=(c=u.next()).done){e.next=37;break}return l=c.value,e.prev=22,e.next=25,l();case 25:if(r=e.sent)return e.abrupt("break",37);e.next=28;break;case 28:e.next=34;break;case 30:if(e.prev=30,e.t0=e.catch(22),e.t0.code!==$e.default.NotFoundError.CODE)throw e.t0;e.next=34;break;case 34:o=!0,e.next=20;break;case 37:e.next=43;break;case 39:e.prev=39,e.t1=e.catch(18),i=!0,s=e.t1;case 43:e.prev=43,e.prev=44,!o&&u.return&&u.return();case 46:if(e.prev=46,i)throw s;e.next=49;break;case 49:return e.finish(46);case 50:return e.finish(43);case 51:return e.abrupt("return",r);case 52:case"end":return e.stop()}},e,this,[[18,39,43,51],[22,30],[44,,46,50]])})),function(e,t){return te.apply(this,arguments)})},{key:"__sendToCounterParty",value:(ee=(0,pe.default)(Pe.default.mark(function e(t,n,r){var a,o,i,s,u,c,l,d,f,p,y,h=r.organizationId,g=r.senderOrganizationId,v=void 0===g?h:g,m=r.recipientOrganizationId,b=void 0===m?v:m,w=(0,le.default)(r,["organizationId","senderOrganizationId","recipientOrganizationId"]);return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=8;break;case 8:return a=t.$entityType,o=t.serverId,this.host.requireUser(),qe.Validator.oneOf("counterPartyType",a,["user","group","distributionList"]),qe.Validator.notEmpty("counterPartyId",o),v=this.__ensureOrganization(v),b=b||v,w=this.__normalizeSendOptions(w,{counterParty:t,senderOrganizationId:v}),i=this.__createNewMessage(t,n,(0,de.default)({organizationId:h,senderOrganizationId:v,recipientOrganizationId:b},w)),this.host.events.deferEventQueue(),this.host.models.Message.inject(i),this.host.emit("message:sending",i),u=(s=w).attachmentFiles,c=s.deleteOnRead,l=s.escalate,d=s.metadata,f=s.priority,p=s.ttl,e.prev=20,e.next=23,this.host.api.messages.send({attachment:(0,Te.default)(u),body:n,counterPartyId:o,deleteOnRead:c,escalate:l,localId:i?i.id:Le.default.v4(),metadata:d,priority:De.MessagePriority.toServer(f),recipientOrganizationId:b,senderOrganizationId:v,ttl:p});case 23:return y=e.sent,e.next=26,this.__retrieveSentMessage(y,{instance:i});case 26:i=e.sent,this.host.emit("message:sent",i),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(20),this.logger.error("error while sending message",e.t0),i.senderStatus=De.MessageSenderStatus.FAILED,this.host.models.Message.inject(i);case 35:return this.host.events.resumeEventQueue(),e.abrupt("return",i);case 37:case"end":return e.stop()}},e,this,[[20,30]])})),function(e,t,n){return ee.apply(this,arguments)})},{key:"__createNewMessage",value:function(e,t,n){var r=n.conversationId,a=n.isForwarded,o=void 0!==a&&a,i=n.organizationId,s=n.recipientOrganizationId,u=void 0===s?l:s,c=n.senderOrganizationId,l=void 0===c?i:c,d=(0,le.default)(n,["conversationId","isForwarded","organizationId","recipientOrganizationId","senderOrganizationId"]);if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Re(e));if("string"!=typeof t)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));if(!(e instanceof Object))throw new TypeError('Value of argument "counterParty" violates contract.\n\nExpected:\nObject\n\nGot:\n'+Se(e));if("string"!=typeof t)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));var f=d.attachmentFiles,p=d.deleteOnRead,y=d.escalate,h=d.metadata,g=d.priority,v=d.senderId,m=d.ttl,b=e.$entityType,w=e.serverId;this.host.requireUser(),qe.Validator.oneOf("counterPartyType",b,["user","group","distributionList"]),qe.Validator.notEmpty("counterPartyId",w);var E=void 0;r&&(E=this.host.conversations.getById(r));var x=(E=E||this.host.conversations.ensureConversation(b,w,l)).isLive,_=this.__getNextSortNumber(l,{conversation:E}),k=v&&v!==this.host.currentUserId?v:void 0,A=t;"distributionList"===b&&(t="["+e.displayName+"]: "+t);var T=this.host.models.Message.createInstance({$synced:!1,body:t,conversationId:E.id,counterPartyId:w,counterPartyType:b,createdAt:new Date,currentSenderRoleId:k,deleteOnRead:p,id:Le.default.v4(),inTimeline:x,isForwarded:o,isOutgoing:!0,messageType:De.MessageType.USER_SENT,metadata:h,priority:g,recipientOrganizationId:u,senderId:this.host.currentUserId,senderOrganizationId:l,senderStatus:De.MessageSenderStatus.SENDING,shouldEscalate:y,sortNumber:_,ttl:m});return T._originalBody=A,f&&(T.attachments=f.map(this.__generateAttachmentDescriptor)),"group"===b?T.groupId=w:"user"===b?T.recipientId=w:"distributionList"===b&&(T.distributionListId=w),this.config.condensedReplays||(T.markedRecipientStatus=De.MessageRecipientStatus.READ),T}},{key:"__normalizeSendOptions",value:function(e,t){var n=e.attachmentFile,r=e.attachmentFiles,a=e.deleteOnRead,o=e.escalate,i=e.metadata,s=e.priority,u=e.senderId,c=e.ttl,l=t.counterParty,d=t.senderOrganizationId;if(null==e||!(void 0===e.attachmentFiles||null==e.attachmentFiles||Array.isArray(e.attachmentFiles)&&e.attachmentFiles.every(function(e){return"string"==typeof e||e instanceof Object}))||void 0!==e.deleteOnRead&&null!=e.deleteOnRead&&"boolean"!=typeof e.deleteOnRead||void 0!==e.escalate&&null!=e.escalate&&"boolean"!=typeof e.escalate||!(void 0===e.metadata||null==e.metadata||Array.isArray(e.metadata)&&e.metadata.every(function(e){return e instanceof Object})||null==e.metadata||e.metadata instanceof Object)||void 0!==e.priority&&null!=e.priority&&"string"!=typeof e.priority||void 0!==e.senderId&&null!=e.senderId&&"string"!=typeof e.senderId||void 0!==e.ttl&&null!=e.ttl&&"number"!=typeof e.ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachmentFiles?: ?Array<string | Object>;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  metadata?: ?Array<Object> | ?Object;\n  priority?: ?string;\n  senderId?: ?string;\n  ttl?: ?number;\n}\n\nGot:\n"+Re(e));if(null==e||!(void 0===e.attachmentFiles||null==e.attachmentFiles||Array.isArray(e.attachmentFiles)&&e.attachmentFiles.every(function(e){return"string"==typeof e||e instanceof Object}))||void 0!==e.deleteOnRead&&null!=e.deleteOnRead&&"boolean"!=typeof e.deleteOnRead||void 0!==e.escalate&&null!=e.escalate&&"boolean"!=typeof e.escalate||!(void 0===e.metadata||null==e.metadata||Array.isArray(e.metadata)&&e.metadata.every(function(e){return e instanceof Object})||null==e.metadata||e.metadata instanceof Object)||void 0!==e.priority&&null!=e.priority&&"string"!=typeof e.priority||void 0!==e.senderId&&null!=e.senderId&&"string"!=typeof e.senderId||void 0!==e.ttl&&null!=e.ttl&&"number"!=typeof e.ttl)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  attachmentFiles?: ?Array<string | Object>;\n  deleteOnRead?: ?boolean;\n  escalate?: ?boolean;\n  metadata?: ?Array<Object> | ?Object;\n  priority?: ?string;\n  senderId?: ?string;\n  ttl?: ?number;\n}\n\nGot:\n"+Se(e));i=this.__normalizeMetadata({metadata:i,organizationId:d,senderId:u}),r=(0,qe.arrayWrap)(r||n),!(0,Ae.default)(r)&&1<r.length&&qe.Validator.raise("attachmentFiles","invalid","currently only a single attachment is supported");var f=this.host.models.Organization.get(d);void 0===c&&(c=f?f.messageTimeToLive:-1),a=a||f.deleteOnRead;var p=l.groupType,y=l.p2pRecipient;return p===De.GroupType.ROLE_P2P&&y&&y.escalationPolicy&&y.escalationPolicy.alwaysEscalate&&(o=!0,s=De.MessagePriority.NORMAL),{attachmentFiles:r,deleteOnRead:a,escalate:o,metadata:i,priority:s,senderId:u,ttl:c}}},{key:"__ensureOrganization",value:function(e){if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Re(e));if(null!=e&&"string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\n?string\n\nGot:\n'+Se(e));return e||(this.host.config.defaultOrganizationId?this.host.config.defaultOrganizationId:void qe.Validator.raise("organizationId","required","Message is sent in the context of an organization. Provide `organizationId` or set a default one with client.setDefaultOrganization(...)"))}},{key:"__normalizeMetadata",value:function(e){var t=e.metadata,n=(e.organizationId,e.senderId);if(t=t||[],t=(0,qe.arrayWrap)(t),n!==this.host.currentUserId){var r=this.host.roles.getById(n),a=r.roleTag;t.push({namespace:"tigertext:message:role:sender",payload:{token:n,display_name:r.displayName,tag_id:a?a.tagId:"",tag_color:a?a.color.replace("#","0x"):"",tag_name:a?a.name:""}})}return 0<t.length?t.map(function(e){return(0,de.default)({mimetype:"application/json"},e)}):void 0}},{key:"__getNextSortNumber",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).conversation,n=this.host.models.Organization.get(e);n&&!t&&(t=n.conversations[0]);var r=n&&n.highestSortNumber||0,a=t&&t.lastBangMessageSortNumber||0;return Math.max(r,a)+1}},{key:"__loadLocalFilePathWithFileReader",value:function(r){return new fe.default(function(e,t){var n=new FileReader;n.addEventListener("load",function(){e(n.result)},!1),n.addEventListener("error",function(e){t(e)},!1),n.readAsDataURL(r)})}},{key:"previewMessage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if(!(null==t||t instanceof Object))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if(!(null==t||t instanceof Object))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(t));var n=this._resolveMessage(e),r={};if(!(c=(0,ce.default)(n))||"function"!=typeof c[Ce.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+Se(c));if(!c||"function"!=typeof c[Ce.default]&&!Array.isArray(c))throw new TypeError("Expected _Object$entries to be iterable, got "+Re(c));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Ge.default)(c);!(a=(s=u.next()).done);a=!0){var c,l=(0,ue.default)(s.value,2),d=l[0],f=l[1];(0,qe.isConfigurableProperty)(n,d)&&!Qe.includes(d)&&(r[d]=f)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}r=(0,de.default)({},r,{id:Le.default.v4(),conversationId:null},t),this.__setForwardedMessageProperties({origMessage:n,organizationId:n.__organizationId,message:r});var p=this.host.models.Message.inject(r);if(!(b=n.statusesPerRecipient)||"function"!=typeof b[Ce.default]&&!Array.isArray(b))throw new TypeError("Expected _message$statusesPerR to be iterable, got "+Se(b));if(!b||"function"!=typeof b[Ce.default]&&!Array.isArray(b))throw new TypeError("Expected _message$statusesPerR to be iterable, got "+Re(b));var y=!0,h=!1,g=void 0;try{for(var v,m=(0,Ge.default)(b);!(y=(v=m.next()).done);y=!0){var b,w=v.value,E=w.userId||w.distributionListId,x=p.id+":"+E;this.host.models.MessageStatusPerRecipient.inject((0,de.default)({},w,{id:x,messageId:p.id}))}}catch(e){h=!0,g=e}finally{try{!y&&m.return&&m.return()}finally{if(h)throw g}}return p}},{key:"endPreviewMessage",value:function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));var t=this._resolveMessage(e);if(t){if(!(s=t.statusesPerRecipient)||"function"!=typeof s[Ce.default]&&!Array.isArray(s))throw new TypeError("Expected _message$statusesPerR2 to be iterable, got "+Se(s));if(!s||"function"!=typeof s[Ce.default]&&!Array.isArray(s))throw new TypeError("Expected _message$statusesPerR2 to be iterable, got "+Re(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,Ge.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;this.host.models.MessageStatusPerRecipient.eject(u)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}this.host.models.Message.eject(t)}}},{key:"sendToUser",value:(J=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(null==h||h instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(h));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==h||h instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(h));case 12:if(this.host.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,h));case 14:if(r=h.organizationId,a=h.senderId,o=void 0===a?this.host.currentUserId:a,i=h.groupName,s=h.groupMetadata,r){e.next=17;break}throw new Error("organizationId is required");case 17:if(t=this._resolveModelIdWithTypes(t,"user"),(u=this._resolveEntity(t,"user"))&&u.profileByOrganizationId&&u.profileByOrganizationId[r]){e.next=23;break}return e.next=22,this.host.users.find(t,{organizationId:r});case 22:u=e.sent;case 23:return e.next=25,this.__resolveRoleBotId(o,r);case 25:if(c=e.sent,l=c.isRole,d=c.roleBotId,l)return e.next=31,this.__prepareRoleP2PGroup(r,t,d,i,{groupMetadata:s});e.next=33;break;case 31:return f=e.sent,e.abrupt("return",this.sendToGroup(f,n,(0,de.default)({},h,{organizationId:r,senderId:o})));case 33:if(p=u&&u.profileByOrganizationId[r],y=p&&p.conversationId){e.next=37;break}throw new Error("conversationId not found for p2p message");case 37:return this.host.conversations.getById(y)||this.host.models.Conversation.inject({counterPartyId:u.id,counterPartyType:u.$entityType,id:y,organizationId:r}),e.abrupt("return",this.sendToConversation(y,n,h));case 40:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"sendToGroup",value:(Y=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(null==a||a instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(a));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==a||a instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(a));case 12:if(this.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,a));case 14:if(r=this._resolveEntity(t,"group")){e.next=19;break}return e.next=18,this.host.groups.find(t);case 18:r=e.sent;case 19:if(r&&r.conversationId){e.next=21;break}throw new Error("group conversationId not found");case 21:return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),e.abrupt("return",this.sendToConversation(r.conversationId,n,a));case 24:case"end":return e.stop()}},e,this)})),function(e,t){return Y.apply(this,arguments)})},{key:"sendToRole",value:(Q=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(null==f||f instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(f));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==f||f instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(f));case 12:if(r=f.organizationId,a=f.senderId,o=void 0===a?this.host.currentUserId:a,i=f.groupMetadata,s=f.groupName,!this.host.config.condensedReplays){e.next=24;break}if(r){e.next=16;break}throw new Error("organizationId is required");case 16:return e.next=18,this.__resolveRoleBotId(t,r);case 18:if(u=e.sent,c=u.isRole,l=u.roleBotId,c){e.next=23;break}throw new Error("recipient must be a role");case 23:t=l;case 24:return e.next=26,this.__prepareRoleP2PGroup(r,t,o,s,{groupMetadata:i});case 26:return d=e.sent,e.abrupt("return",this.sendToGroup(d,n,(0,de.default)({},f,{organizationId:r,senderId:o})));case 28:case"end":return e.stop()}},e,this)})),function(e,t){return Q.apply(this,arguments)})},{key:"__resolveRoleBotId",value:(X=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.host.roles.__resolveRoleId(t),r=void 0;try{a=this._resolveModelIdWithTypes(t,"role"),r=!!this._resolveEntity(a,"role")}catch(e){r=!1}if(r){e.next=10;break}if((o=this._resolveEntity(t,"user"))&&o.profileByOrganizationId&&o.profileByOrganizationId[n]){e.next=9;break}return e.next=8,this.host.users.find(t,{organizationId:n});case 8:o=e.sent;case 9:o&&o.isRoleBot&&(r=!0);case 10:return e.abrupt("return",{isRole:r,roleBotId:t});case 11:case"end":return e.stop()}},e,this)})),function(e,t){return X.apply(this,arguments)})},{key:"sendToConversation",value:(W=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(null==_||_ instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(_));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==_||_ instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(_));case 12:if(this.host.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,_));case 14:if(t=this._resolveModelIdWithTypes(t,"conversation"),r=this.host.conversations.getById(t)){e.next=18;break}throw new Error("conversation not found");case 18:return e.next=20,this.__resolveSender(_);case 20:if(a=e.sent,o=r.counterPartyId,i=r.counterPartyType,s=r.organization,u=this._resolveEntity(o,i),this.host.requireUser(),c=u.groupType,l=u.memberIds,c!==De.GroupType.FORUM||l&&l.includes(this.host.currentUserId)){e.next=28;break}return e.next=28,this.host.forums.join(u);case 28:return d=s.id,f=d,_=this.__normalizeSendOptions(_,{counterParty:u,senderOrganizationId:d,senderId:a.id}),p=this.__createNewMessage(u,n,(0,de.default)({conversationId:t,organizationId:s.id,senderOrganizationId:d,recipientOrganizationId:f},_)),this.host.events.deferEventQueue(),this.host.models.Message.inject(p),this.host.emit("message:sending",p),h=(y=_).attachmentFiles,g=y.deleteOnRead,v=y.escalate,m=y.metadata,b=y.priority,w=y.ttl,e.prev=36,e.next=39,this.host.api.messages.send({attachment:(0,Te.default)(h),body:n,conversationId:r.id,deleteOnRead:g,escalate:v,localId:p?p.id:Le.default.v4(),metadata:m,priority:De.MessagePriority.toServer(b),senderOrganizationId:d,ttl:w});case 39:return E=e.sent,x=E.last_message?E.last_message:E,e.next=44,this.__retrieveSentMessage(x,{instance:p});case 44:(p=e.sent).unreadMessageCount&&(r.unreadCount=p.unreadMessageCount),p.unreadPriorityMessageCount&&(r.unreadPriorityCount=p.unreadPriorityMessageCount),r.lastMessage=p,r.highestSortNumber=p.sortNumber,r.isLive=!0,r.timeline.push(p),this.host.models.Conversation.inject(r),p.inTimeline=!0,this.host.models.Message.inject(p),this.host.emit("message:sent",p),e.next=62;break;case 57:e.prev=57,e.t0=e.catch(36),this.logger.error("error while sending message",e.t0),p.senderStatus=De.MessageSenderStatus.FAILED,this.host.models.Message.inject(p);case 62:return this.host.events.resumeEventQueue(),e.abrupt("return",p);case 64:case"end":return e.stop()}},e,this,[[36,57]])})),function(e,t){return W.apply(this,arguments)})},{key:"sendToDistributionList",value:(H=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(null==a||a instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Re(a));case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "distributionListId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=10;break;case 10:if(null==a||a instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?Object\n\nGot:\n'+Se(a));case 12:if(this.config.condensedReplays){e.next=14;break}return e.abrupt("return",this.send(t,n,a));case 14:if(t=this._resolveModelIdWithTypes(t,"distributionList"),r=this._resolveEntity(groupId,"distributionList")){e.next=20;break}return e.next=19,this.host.distributionLists.find(t);case 19:r=e.sent;case 20:if(r&&r.conversationId){e.next=22;break}throw new Error("distributionList conversationId not found");case 22:return e.abrupt("return",this.sendToConversation(r.conversationId,n,a));case 23:case"end":return e.stop()}},e,this)})),function(e,t){return H.apply(this,arguments)})},{key:"sendToGroupOfUsers",value:(K=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=o.groupMetadata,s=o.groupName,u=o.organizationId,c=o.senderId,l=(0,le.default)(o,["groupMetadata","groupName","organizationId","senderId"]);return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "body" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=8;break;case 8:return e.next=10,this.__prepareGroupForUsers(u,t,c,s,{groupMetadata:i});case 10:if(r=e.sent,this.config.condensedReplays)return a=r.conversationId,e.next=15,this.host.conversations.find(a);e.next=18;break;case 15:return e.abrupt("return",this.sendToConversation(a,n,(0,de.default)({},l,{organizationId:u,senderId:c})));case 18:return e.abrupt("return",this.sendToGroup(r,n,(0,de.default)({},l,{organizationId:u,senderId:c})));case 19:case"end":return e.stop()}},e,this)})),function(e,t){return K.apply(this,arguments)})},{key:"__prepareGroupForUsers",value:function(e,t,n,r){var a=(4<arguments.length&&void 0!==arguments[4]?arguments[4]:{}).groupMetadata;return 0===t.length&&qe.Validator.raise("memberIds","required"),this.host.groups.create({memberIds:t,metadata:a,name:r,organizationId:e,senderId:n})}},{key:"__prepareRoleP2PGroup",value:(Z=(0,pe.default)(Pe.default.mark(function e(t,n,r,a){var o,i,s=(4<arguments.length&&void 0!==arguments[4]?arguments[4]:{}).groupMetadata;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.host.conversations.findLocalRoleP2PConversation(n,r))return e.abrupt("return",o.counterParty);e.next=3;break;case 3:return e.next=5,this.host.roles.createP2PGroup({metadata:s,name:a,organizationId:t,recipientId:n,senderId:r});case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return Z.apply(this,arguments)})},{key:"recall",value:(q=(0,pe.default)(Pe.default.mark(function e(t){var n,r;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e})||Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Se(t));case 4:return this.host.requireUser(),n=(0,qe.arrayWrap)(t).filter(Boolean),r=n.map(this.__recallSingle.bind(this)),e.next=9,fe.default.all(r);case 9:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"__recallSingle",value:(B=(0,pe.default)(Pe.default.mark(function e(t){var n;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(!(n=this._resolveMessage(t))){e.next=17;break}if(n.senderId!==this.host.currentUserId)throw new $e.default.PermissionDeniedError(n,n.serverId,"recall");e.next=8;break;case 8:if(!1!==n.$synced&&n.serverId){e.next=12;break}this.host.models.Message.eject(n),e.next=15;break;case 12:return e.next=14,this.host.api.messages.destroy(n.serverId);case 14:this.host.models.Message.eject(n);case 15:e.next=19;break;case 17:return e.next=19,this.host.api.messages.destroy(t);case 19:case"end":return e.stop()}},e,this)})),function(e){return B.apply(this,arguments)})},{key:"retrySend",value:(D=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}throw new $e.default.NotFoundError(this.host.models.Message.name,t);case 8:if(a=(r=n).isForwarded,r.senderStatus!==De.MessageSenderStatus.FAILED&&qe.Validator.raise("message","invalid","Message to retry must be in a FAILED senderStatus and sent from current user"),this.host.events.deferEventQueue(),n.senderStatus=De.MessageSenderStatus.RETRYING,this.host.models.Message.inject(n),this.host.emit("message:sending",n),a)return e.next=17,this.__retryApiForward(n);e.next=20;break;case 17:n=e.sent,e.next=23;break;case 20:return e.next=22,this.__retryApiSend(n);case 22:n=e.sent;case 23:return this.config.condensedReplays&&(o=this.host.conversations.getById(n.conversationId),n.unreadMessageCount&&(o.unreadCount=n.unreadMessageCount),n.unreadPriorityMessageCount&&(o.unreadPriorityCount=n.unreadPriorityMessageCount),this.host.models.Conversation.inject(o)),this.host.events.resumeEventQueue(),e.abrupt("return",n);case 26:case"end":return e.stop()}},e,this)})),function(e){return D.apply(this,arguments)})},{key:"resend",value:($=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},_=x.priority,k=x.retrieveMessage,A=void 0!==k&&k,T=x.senderId;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(n=this._resolveMessage(t),void 0===_&&(_=n.priority),void 0===T&&(T=n.senderId),r=n.attachments,a=n.body,o=n.conversationId,i=n.counterParty,s=n.counterPartyId,u=n.deleteOnRead,c=n.isForwarded,l=n.metadata,d=n.originalMessageId,f=n.recipientOrganizationId,p=n.ttl,!c){e.next=14;break}if(this.config.condensedReplays)return e.abrupt("return",this.forwardToConversation(d,o,{organizationId:f,priority:_}));e.next=11;break;case 11:return e.abrupt("return",this.forward(d,s,{organizationId:f,priority:_,retrieveMessage:A,senderId:T}));case 14:if(y=[],l=l.filter(function(e){return"tigertext:message:role:sender"!==e.namespace}),!r){e.next=50;break}if(!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected attachments to be iterable, got "+Se(r));e.next=19;break;case 19:if(!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected attachments to be iterable, got "+Re(r));e.next=21;break;case 21:g=!(h=!0),v=void 0,e.prev=24,m=(0,Ge.default)(r);case 26:if(h=(b=m.next()).done){e.next=36;break}return w=b.value,e.next=30,this._downloadAttachmentBlobAndUrl(t,w.id);case 30:(E=e.sent.blob).name=w.name,y.push(E);case 33:h=!0,e.next=26;break;case 36:e.next=42;break;case 38:e.prev=38,e.t0=e.catch(24),g=!0,v=e.t0;case 42:e.prev=42,e.prev=43,!h&&m.return&&m.return();case 45:if(e.prev=45,g)throw v;e.next=48;break;case 48:return e.finish(45);case 49:return e.finish(42);case 50:if(this.config.condensedReplays)return e.abrupt("return",this.sendToConversation(o,a,{attachmentFiles:y,deleteOnRead:u,priority:_,metadata:l,ttl:p}));e.next=52;break;case 52:return e.abrupt("return",this.__sendToCounterParty(i,a,{attachmentFiles:y,deleteOnRead:u,organizationId:f,priority:_,senderId:T,metadata:l,ttl:p}));case 53:case"end":return e.stop()}},e,this,[[24,38,42,50],[43,,45,49]])})),function(e){return $.apply(this,arguments)})},{key:"forwardToConversation",value:(L=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward(t,n,x));case 6:if(r=x.metadata,a=void 0===r?[]:r,o=x.priority,i=x.senderId,s=void 0===i?this.host.currentUserId:i,u=this.host.conversations.getById(n)){e.next=10;break}throw new Error("conversation not found");case 10:if(this.host.requireUser(),c=this._resolveMessage(t)){e.next=14;break}throw new $e.default.NotFoundError(this.host.models.Message.name,id);case 14:if(l=c.attachments,d=c.body,f=c.serverId){e.next=17;break}throw new Error("original message was not sent");case 17:return s=this.__resolveSenderId({senderId:s}),void 0===o&&(o=c.priority),p=u.counterPartyId,y=u.counterPartyType,h=u.organization,g=this._resolveEntity(p,y),v=h.id,m={metadata:a,priority:o,senderId:s},m=this.__normalizeSendOptions(m,{counterParty:g,senderOrganizationId:v}),a=m.metadata,(b=this.__createNewMessage(g,d,(0,de.default)({conversationId:n,organizationId:h.id,isForwarded:!0},m))).attachments=l,this.__setForwardedMessageProperties({origMessage:c,organizationId:h.id,message:b}),this.host.events.deferEventQueue(),this.host.models.Message.inject(b),this.host.emit("message:sending",b),e.prev=31,e.next=34,this.host.api.messages.forward(f,null,{conversationId:n,localId:b.id,metadata:a,priority:De.MessagePriority.toServer(o)});case 34:return w=e.sent,e.next=37,this.__retrieveSentMessage(w.message,{instance:b});case 37:(E=e.sent).unreadMessageCount&&(u.unreadCount=E.unreadMessageCount),E.unreadPriorityMessageCount&&(u.unreadPriorityCount=E.unreadPriorityMessageCount),this.host.models.Conversation.inject(u),this.host.emit("message:sent",E),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(31),this.logger.error("error while forwarding message",e.t0),b.senderStatus=De.MessageSenderStatus.FAILED,this.host.models.Message.inject(b);case 49:return this.host.events.resumeEventQueue(),e.abrupt("return",b);case 51:case"end":return e.stop()}},e,this,[[31,44]])})),function(e,t){return L.apply(this,arguments)})},{key:"forwardToUser",value:(F=(0,pe.default)(Pe.default.mark(function e(t,n){for(var r=arguments.length,a=Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var i,s,u,c,l,d,f,p,y,h,g,v,m,b;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward.apply(this,[t,n].concat(a)));case 6:if(i=a[0],u=(s=void 0===i?{}:i).organizationId,c=s.senderId,l=void 0===c?this.host.currentUserId:c,d=s.groupName,f=s.groupMetadata,u){e.next=10;break}throw new Error("organizationId is required");case 10:if(n=this._resolveModelIdWithTypes(n,"user"),(p=this._resolveEntity(n,"user"))&&p.profileByOrganizationId&&p.profileByOrganizationId[u]){e.next=16;break}return e.next=15,this.host.users.find(n,{organizationId:u});case 15:p=e.sent;case 16:return e.next=18,this.__resolveRoleBotId(l,u);case 18:if(y=e.sent,h=y.isRole,g=y.roleBotId,h)return e.next=24,this.__prepareRoleP2PGroup(u,n,g,d,{groupMetadata:f});e.next=26;break;case 24:return v=e.sent,e.abrupt("return",this.forwardToGroup(t,v,(0,de.default)({},s,{organizationId:u,senderId:l})));case 26:if(m=p&&p.profileByOrganizationId[u],b=m&&m.conversationId){e.next=30;break}throw new Error("conversationId not found for p2p message");case 30:return this.host.conversations.getById(b)||this.host.models.Conversation.inject({counterPartyId:p.id,counterPartyType:p.$entityType,id:b,organizationId:u}),e.abrupt("return",this.forwardToConversation.apply(this,[t,b].concat(a)));case 33:case"end":return e.stop()}},e,this)})),function(e,t){return F.apply(this,arguments)})},{key:"forwardToGroup",value:(U=(0,pe.default)(Pe.default.mark(function e(t,n){for(var r=arguments.length,a=Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var i;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward.apply(this,[t,n].concat(a)));case 6:if(i=this._resolveEntity(n,"group")){e.next=11;break}return e.next=10,this.host.groups.find(n);case 10:i=e.sent;case 11:if(i&&i.conversationId){e.next=13;break}throw new Error("group "+n+" not found");case 13:return this.host.conversations.getById(i.conversationId)||this.host.models.Conversation.inject({counterPartyId:i.id,counterPartyType:i.$entityType,id:i.conversationId,organizationId:i.organizationId}),e.abrupt("return",this.forwardToConversation.apply(this,[t,i.conversationId].concat(a)));case 16:case"end":return e.stop()}},e,this)})),function(e,t){return U.apply(this,arguments)})},{key:"forwardToDistributionList",value:(N=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.config.condensedReplays){e.next=6;break}return e.abrupt("return",this.forward(t,n,a));case 6:if(r=this._resolveEntity(n,"distributionList")){e.next=11;break}return e.next=10,this.host.distributionLists.find(n);case 10:r=e.sent;case 11:if(r&&r.conversationId){e.next=13;break}throw new Error("distributionList "+n+" not found");case 13:return this.host.conversations.getById(r.conversationId)||this.host.models.Conversation.inject({counterPartyId:r.id,counterPartyType:r.$entityType,id:r.conversationId,organizationId:r.organizationId}),e.abrupt("return",this.forwardToConversation(t,r.conversationId,a));case 16:case"end":return e.stop()}},e,this)})),function(e,t){return N.apply(this,arguments)})},{key:"forwardToGroupOfUsers",value:(V=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=o.groupMetadata,s=o.groupName,u=o.organizationId,c=o.senderId,l=(0,le.default)(o,["groupMetadata","groupName","organizationId","senderId"]);return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Re(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "userIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+Se(n));case 8:return e.next=10,this.__prepareGroupForUsers(u,n,c,s,{groupMetadata:i});case 10:if(r=e.sent,this.config.condensedReplays)return a=r.conversationId,e.next=15,this.host.conversations.find(a);e.next=16;break;case 15:return e.abrupt("return",this.forwardToConversation(t,a,(0,de.default)({},l,{organizationId:u,senderId:c})));case 16:return e.abrupt("return",this.forwardToGroup(t,r,(0,de.default)({},l,{organizationId:u,senderId:c})));case 17:case"end":return e.stop()}},e,this)})),function(e,t){return V.apply(this,arguments)})},{key:"forwardToRole",value:(P=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.organizationId,a=f.senderId,o=void 0===a?this.host.currentUserId:a,i=f.groupMetadata,s=f.groupName,!this.host.config.condensedReplays){e.next=12;break}if(r){e.next=4;break}throw new Error("organizationId is required");case 4:return e.next=6,this.__resolveRoleBotId(n,r);case 6:if(u=e.sent,c=u.isRole,l=u.roleBotId,c){e.next=11;break}throw new Error("recipient must be a role");case 11:n=l;case 12:return e.next=14,this.__prepareRoleP2PGroup(r,n,o,s,{groupMetadata:i});case 14:return d=e.sent,e.abrupt("return",this.forwardToGroup(t,d.id,(0,de.default)({},f,{organizationId:r,senderId:o})));case 16:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})},{key:"forward",value:(C=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w=this,E=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},x=E.organizationId,_=E.senderOrganizationId,k=void 0===_?x:_,A=E.recipientOrganizationId,T=void 0===A?k:A,I=E.groupMetadata,O=E.groupName,j=E.metadata,S=void 0===j?[]:j,R=(E.preferExistingGroup,E.priority),M=E.retrieveMessage,z=void 0!==M&&M,G=E.senderId,C=void 0===G?this.host.currentUserId:G;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Re(n));case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"==typeof n||n instanceof Object||Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring | Object | string[] | Object[]\n\nGot:\n'+Se(n));case 8:if(this.host.requireUser(),r=this._resolveMessage(t)){e.next=12;break}throw new $e.default.NotFoundError(this.host.models.Message.name,t);case 12:if(a=r.attachments,o=r.body,i=r.serverId){e.next=15;break}throw new Error("original message was not sent");case 15:if(C=this.__resolveSenderId({senderId:C}),Array.isArray(n))return s=n.map(function(e){return w._resolveModelIdWithTypes(e,["user","role"])}),e.next=20,this.__prepareGroupForUsers(x,s,C,O,{groupMetadata:I});e.next=22;break;case 20:u=e.sent,n=u.id;case 22:return void 0===R&&(R=r.priority),e.next=25,this.__resolveCounterPartyEntityAndOrganizationId(n,k);case 25:return c=e.sent,l=c.counterParty,(d=c.organizationId)&&(k=T=d),T=T||k,l&&(n=l.serverId),e.next=33,this.__resolveSender({organizationId:x,senderId:C,senderOrganizationId:k});case 33:if(f=e.sent,p=function(e){return e&&"user"===e.$entityType},(y=function(e){return p(e)&&e.isRoleBot})(l)||p(l)&&y(f))return e.next=39,this.__prepareRoleP2PGroup(x,l.id,C,O,{groupMetadata:I});e.next=42;break;case 39:h=e.sent,n=(l=h).id;case 42:return qe.Validator.notEmpty("entityId",n,"entityId not found"),g={metadata:S,priority:R,senderId:C},g=this.__normalizeSendOptions(g,{counterParty:l,senderOrganizationId:k}),S=g.metadata,(v=this.__createNewMessage(l,o,(0,de.default)({organizationId:x,senderOrganizationId:k,recipientOrganizationId:T,isForwarded:!0},g))).attachments=a,this.__setForwardedMessageProperties({origMessage:r,organizationId:x,message:v}),this.host.events.deferEventQueue(),this.host.models.Message.inject(v),this.host.emit("message:sending",v),e.prev=52,e.next=55,this.host.api.messages.forward(i,n,{localId:v.id,metadata:S,priority:De.MessagePriority.toServer(R),recipientOrganizationId:T,senderOrganizationId:k});case 55:if(m=e.sent,b=m.message_id,z)return e.next=60,this.find(b,{instance:v,replace:!0});e.next=63;break;case 60:v=e.sent,e.next=67;break;case 63:v.senderStatus=De.MessageSenderStatus.SENT,v.serverId=b,v.$synced=void 0,this.host.models.Message.inject(v);case 67:this.host.emit("message:sent",v),e.next=75;break;case 70:e.prev=70,e.t0=e.catch(52),this.logger.error("error while forwarding message",e.t0),v.senderStatus=De.MessageSenderStatus.FAILED,this.host.models.Message.inject(v);case 75:return this.host.events.resumeEventQueue(),e.abrupt("return",v);case 77:case"end":return e.stop()}},e,this,[[52,70]])})),function(e,t){return C.apply(this,arguments)})},{key:"__setForwardedMessageProperties",value:function(e){var t=e.origMessage,n=e.organizationId,r=e.message,a=t.createdAt,o=t.currentSenderRole,i=t.originalForwardedMessageCreatedAt,s=t.originalMessageId,u=t.originalSender,c=t.originalSenderRole,l=t.sender,d=t.senderRole,f=t.serverId,p=t.subType;return r.originalForwardedMessageCreatedAt||(r.originalForwardedMessageCreatedAt=i||a),r.originalMessageId||(r.originalMessageId=s||f),r.originalSender?r.originalSender=u:l&&(r.originalSender={displayName:l.displayName,id:l.id,organizationId:n}),r.originalSenderRole||(p===De.MessageSubType.ROLE_AWAY_NOTIFICATION&&o?r.originalSenderRole={$entityType:"role",botUserId:o.botUserId,displayName:o.displayName,id:o.id,organizationId:n}:c?r.originalSenderRole=(0,de.default)({},c):d&&(r.originalSenderRole=(0,de.default)({},d))),r.subType||(r.subType=p),r}},{key:"reactToMessageStatusEvent",value:function(e){var t=e.data;if(this.config.condensedReplays)this.reactToMessageStatusEventCR({data:t});else{var n=(t=(0,qe.jsonCloneDeep)(t)).client_id,r=t.is_recalled,a=this.host.models.Message.get(n);if(a){if(r)return void this.host.models.Message.eject(a);this.__injectMessageStatus(a,t),Be.MESSAGE_STATUS_ORDER[a.markedRecipientStatus]<Be.MESSAGE_STATUS_ORDER[De.MessageRecipientStatus.DELIVERED]&&this.markAsReceived(a)}}}},{key:"reactToMessageStatusEventCR",value:function(e){var t=e.data,n=(t=(0,qe.jsonCloneDeep)(t)).client_id,r=t.is_recalled,a=this.host.models.Message.get(n);if(a){t.conversation_id||(t.conversation_id=a.conversationId);var o=this.host.conversations.getById(a.conversationId);if(o){if(r)return void this.host.models.Message.eject(a);a.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(a),this.host.conversations.__injectConversation(t),o._markingAsReadSortNumber&&a.sortNumber>=o._markingAsReadSortNumber&&this.host.conversations.__clearOptimisticStatus([o])}}}},{key:"__injectMessageStatus",value:function(e,t){if(e){var n=t.account_id||t.accountId,r={createdAt:t.timestamp||t.createdAt,id:e.id+":"+n,messageId:e.id,status:De.MessageRecipientStatus.resolve(t.status)};return"distributionList"===e.counterPartyType?r.distributionListId=n:(r.userId=n,this.host.models.User.ensureEntity(n,{onlyPlaceholder:!0})),this.host.models.MessageStatusPerRecipient.inject(r)}}},{key:"findCR",value:(G=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=u.includeCounterParty,l=void 0===c||c,d=u.includeStatuses,f=void 0===d||d,p=u.instance,y=u.replace,h=void 0!==y&&y;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=4;break;case 4:return this.host.requireUser(),e.next=7,this.host.api.messages.find(t);case 7:if(n=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:if(r=n.message){e.next=13;break}return e.abrupt("return",null);case 13:if(r.conversationId=n.conversation_id,p&&h&&this.__setDefaultAttributes(r,{instance:p}),l)return a=r.recipient_token,o=r.sender_organization,e.next=20,this.__lookupCounterParty(a,{organizationId:o});e.next=27;break;case 20:if(!(i=e.sent)){e.next=26;break}r.counterParty=i,r.conversationHandle||(r.conversationHandle=this.host.conversations.getConversationKey(i.$entityType,i.serverId,o)),e.next=27;break;case 26:return e.abrupt("return",null);case 27:if((s=h?this.host.models.Message.replaceExisting(r,{instance:p}):this.host.models.Message.inject(r)).$synced=void 0,f)return e.next=32,this.findRecipientStatus(s,{queue:!1});e.next=32;break;case 32:return e.abrupt("return",s);case 33:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"find",value:(z=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=u.includeCounterParty,l=void 0===c||c,d=u.includeStatuses,f=void 0===d||d,p=u.instance,y=u.replace,h=void 0!==y&&y;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "serverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=4;break;case 4:if(this.config.condensedReplays)return e.next=7,this.findCR(t,{includeCounterParty:l,includeStatuses:f,instance:p,replace:h});e.next=9;break;case 7:return n=e.sent,e.abrupt("return",n);case 9:return this.host.requireUser(),e.next=12,this.host.api.messages.find(t);case 12:if(r=e.sent){e.next=15;break}return e.abrupt("return",null);case 15:if(p&&h&&this.__setDefaultAttributes(r,{instance:p}),l)return a=r.recipient_token,o=r.sender_organization,e.next=21,this.__lookupCounterParty(a,{organizationId:o});e.next=28;break;case 21:if(!(i=e.sent)){e.next=27;break}r.counterParty=i,this.config.condensedReplays||r.conversationId||(r.conversationId=this.host.conversations.getConversationKey(i.$entityType,i.serverId,o)),e.next=28;break;case 27:return e.abrupt("return",null);case 28:if((s=h?this.host.models.Message.replaceExisting(r,{instance:p}):this.host.models.Message.inject(r)).$synced=void 0,f)return e.next=33,this.findRecipientStatus(s,{queue:!1});e.next=33;break;case 33:return e.abrupt("return",s);case 34:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"findAttachment",value:(M=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(n));e.next=8;break;case 8:if(r=this._resolveMessage(t),a=!1,r){e.next=15;break}return a=!0,e.next=14,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 14:r=e.sent;case 15:if(!(o=this.__getMessageAttachment(r,n))||o.isLocal||a||"name"in o){e.next=22;break}return e.next=19,this.find(t,{includeStatuses:!1,includeCounterParty:!1});case 19:r=e.sent,(o=this.__getMessageAttachment(r,n)).name||(o.name=null);case 22:return e.abrupt("return",o);case 23:case"end":return e.stop()}},e,this)})),function(e,t){return M.apply(this,arguments)})},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(e));return this.host.models.Message.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+Re(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+Se(e));return this.host.models.Message.getMulti(e)}},{key:"__lookupCounterParty",value:(R=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b=this,w=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).organizationId;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(t));e.next=4;break;case 4:if("function"!=typeof(n=[{model:this.host.models.User,finder:function(){return b.host.users.find(t,{organizationId:w})}},{model:this.host.models.Group,finder:function(){return b.host.groups.find(t)}},{model:this.host.models.DistributionList,finder:function(){return b.host.distributionLists.find(t)}}])[Ce.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Se(n));e.next=7;break;case 7:if(!n||"function"!=typeof n[Ce.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Re(n));e.next=9;break;case 9:a=!(r=!0),o=void 0,e.prev=12,i=(0,Ge.default)(n);case 14:if(r=(s=i.next()).done){e.next=23;break}if(u=s.value,c=u.model,l=c.get(t))return e.abrupt("return",l);e.next=20;break;case 20:r=!0,e.next=14;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),a=!0,o=e.t0;case 29:e.prev=29,e.prev=30,!r&&i.return&&i.return();case 32:if(e.prev=32,a)throw o;e.next=35;break;case 35:return e.finish(32);case 36:return e.finish(29);case 37:if(!n||"function"!=typeof n[Ce.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Se(n));e.next=39;break;case 39:if(!n||"function"!=typeof n[Ce.default]&&!Array.isArray(n))throw new TypeError("Expected counterPartyTypesAndFinders to be iterable, got "+Re(n));e.next=41;break;case 41:f=!(d=!0),p=void 0,e.prev=44,y=(0,Ge.default)(n);case 46:if(d=(h=y.next()).done){e.next=64;break}return g=h.value,v=g.finder,e.prev=49,e.next=52,v();case 52:if(m=e.sent)return e.abrupt("return",m);e.next=55;break;case 55:e.next=61;break;case 57:if(e.prev=57,e.t1=e.catch(49),e.t1.code!==$e.default.NotFoundError.CODE)throw e.t1;e.next=61;break;case 61:d=!0,e.next=46;break;case 64:e.next=70;break;case 66:e.prev=66,e.t2=e.catch(44),f=!0,p=e.t2;case 70:e.prev=70,e.prev=71,!d&&y.return&&y.return();case 73:if(e.prev=73,f)throw p;e.next=76;break;case 76:return e.finish(73);case 77:return e.finish(70);case 78:return e.abrupt("return",null);case 79:case"end":return e.stop()}},e,this,[[12,25,29,37],[30,,32,36],[44,66,70,78],[49,57],[71,,73,77]])})),function(e){return R.apply(this,arguments)})},{key:"_isMessageOutgoing",value:function(e){var t=e.counterParty,n=e.counterPartyType,r=e.currentSenderRole,a=e.senderId;if(!a)return!1;var o=this.host,i=o.currentUser,s=o.currentUserId,u=t||{},c=u.groupType,l=u.members,d=u.p2pRecipient,f=u.p2pSender,p="group"===n&&c===De.GroupType.ROLE_P2P,y=i.roles,h=[s],g=[],v=0;if(!y||"function"!=typeof y[Ce.default]&&!Array.isArray(y))throw new TypeError("Expected myRoles to be iterable, got "+Se(y));if(!y||"function"!=typeof y[Ce.default]&&!Array.isArray(y))throw new TypeError("Expected myRoles to be iterable, got "+Re(y));var m=!0,b=!1,w=void 0;try{for(var E,x=(0,Ge.default)(y);!(m=(E=x.next()).done);m=!0){var _=E.value.botUserId;h.push(_)}}catch(e){b=!0,w=e}finally{try{!m&&x.return&&x.return()}finally{if(b)throw w}}if(l){if(!l||"function"!=typeof l[Ce.default]&&!Array.isArray(l))throw new TypeError("Expected members to be iterable, got "+Se(l));if(!l||"function"!=typeof l[Ce.default]&&!Array.isArray(l))throw new TypeError("Expected members to be iterable, got "+Re(l));var k=!0,A=!1,T=void 0;try{for(var I,O=(0,Ge.default)(l);!(k=(I=O.next()).done);k=!0){var j=I.value,S=j.botRole;j.isRoleBot&&S&&!g.includes(S)&&g.push(S)}}catch(e){A=!0,T=e}finally{try{!k&&O.return&&O.return()}finally{if(A)throw T}}if(p){if(f){var R=f.botRole;f.isRoleBot&&R&&!g.includes(R)&&g.push(R)}if(d){var M=d.botRole;d.isRoleBot&&M&&!g.includes(M)&&g.push(M)}}if(!g||"function"!=typeof g[Ce.default]&&!Array.isArray(g))throw new TypeError("Expected roleMembers to be iterable, got "+Se(g));if(!g||"function"!=typeof g[Ce.default]&&!Array.isArray(g))throw new TypeError("Expected roleMembers to be iterable, got "+Re(g));var z=!0,G=!1,C=void 0;try{for(var P,V=(0,Ge.default)(g);!(z=(P=V.next()).done);z=!0){var N=P.value;y.includes(N)&&v++}}catch(e){G=!0,C=e}finally{try{!z&&V.return&&V.return()}finally{if(G)throw C}}}return p?!(d===i&&a===s&&!r)&&(!(!f||a!==f.id&&a!==f.botUserId)||y.includes(r)&&(1===v||r===f)):"distributionList"===n||y.includes(r)||h.includes(a)}},{key:"_setRecipientStatus",value:function(e){var t=e.__organizationId,n=e._markingAsStatus,r=e.conversation,a=e.counterParty,o=e.counterPartyType,i=e.createdAt,s=e.deleteOnRead,u=e.expiresAt,c=e.isOutgoing,l=e.messageType,d=e.senderId,f=e.statusesPerRecipient,p=e.ttl,y=this.host,h=y.currentUser,g=y.currentUserId,v=a||{},m=v.groupType,b=v.p2pRecipient,w=[],E=[],x=[g],_=void 0,k=void 0;if(!(S=h.roles)||"function"!=typeof S[Ce.default]&&!Array.isArray(S))throw new TypeError("Expected _currentUser$roles to be iterable, got "+Se(S));if(!S||"function"!=typeof S[Ce.default]&&!Array.isArray(S))throw new TypeError("Expected _currentUser$roles to be iterable, got "+Re(S));var A=!0,T=!1,I=void 0;try{for(var O,j=(0,Ge.default)(S);!(A=(O=j.next()).done);A=!0){var S,R=O.value;R.organizationId===t&&x.push(R.botUserId)}}catch(e){T=!0,I=e}finally{try{!A&&j.return&&j.return()}finally{if(T)throw I}}var M=d&&x.includes(d),z=[],G=De.MessageRecipientStatus.READ,C=De.MessageRecipientStatus.NEW,P=m===De.GroupType.ROLE_P2P&&b===h;if(!f||"function"!=typeof f[Ce.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(f));if(!f||"function"!=typeof f[Ce.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Re(f));var V=!0,N=!1,U=void 0;try{for(var F,L=(0,Ge.default)(f);!(V=(F=L.next()).done);V=!0){var $=F.value.userId;x.includes($)&&z.push($)}}catch(e){N=!0,U=e}finally{try{!V&&L.return&&L.return()}finally{if(N)throw U}}var D=1<z.length;if(!f||"function"!=typeof f[Ce.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(f));if(!f||"function"!=typeof f[Ce.default]&&!Array.isArray(f))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Re(f));var B=!0,q=!1,Z=void 0;try{for(var K,H=(0,Ge.default)(f);!(B=(K=H.next()).done);B=!0){var W=K.value,X=W.distributionListId,Q=($=W.userId,W.status),Y=x.includes($);P||!(!c&&Y)&&!(c&&(X||!Y))||D&&$===g||E.push(Q),(P||M&&x.includes(d))&&(Be.MESSAGE_STATUS_ORDER[C]<Be.MESSAGE_STATUS_ORDER[Q]&&(C=Q),Be.MESSAGE_STATUS_ORDER[C]<Be.MESSAGE_STATUS_ORDER[De.MessageRecipientStatus.READ]&&(C=De.MessageRecipientStatus.READ)),!Y||P||M&&d===$||w.push(Q)}}catch(e){q=!0,Z=e}finally{try{!B&&H.return&&H.return()}finally{if(q)throw Z}}if(0<E.length){k=E[0];for(var J=1;J<E.length;J++){var ee=E[J];0===z.length?Be.MESSAGE_STATUS_ORDER[k]<Be.MESSAGE_STATUS_ORDER[ee]&&(k=ee):Be.MESSAGE_STATUS_ORDER[k]>Be.MESSAGE_STATUS_ORDER[ee]&&(k=ee)}}else k=C;if(_=G,0<w.length){if(!w||"function"!=typeof w[Ce.default]&&!Array.isArray(w))throw new TypeError("Expected applicableLeastStatuses to be iterable, got "+Se(w));if(!w||"function"!=typeof w[Ce.default]&&!Array.isArray(w))throw new TypeError("Expected applicableLeastStatuses to be iterable, got "+Re(w));var te=!0,ne=!1,re=void 0;try{for(var ae,oe=(0,Ge.default)(w);!(te=(ae=oe.next()).done);te=!0){var ie=ae.value;Be.MESSAGE_STATUS_ORDER[_]>Be.MESSAGE_STATUS_ORDER[ie]&&(_=ie)}}catch(e){ne=!0,re=e}finally{try{!te&&oe.return&&oe.return()}finally{if(ne)throw re}}}if(this.config.condensedReplays&&r&&r._markingAsRead&&r._markingAsReadSortNumber>=e.sortNumber&&(k=De.MessageRecipientStatus.READ),n){var se=!1;Be.MESSAGE_STATUS_ORDER[k]<Be.MESSAGE_STATUS_ORDER[n]&&(k=n,se=!0),!this.config.condensedReplays&&c&&Be.MESSAGE_STATUS_ORDER[_]<Be.MESSAGE_STATUS_ORDER[n]&&(_=n,se=!0),se||this.config.condensedReplays||(e._markingAsStatus=void 0)}if(s&&"user"===o&&k===De.MessageRecipientStatus.READ){var ue=Date.now()+6e4;(!u||ue<u)&&(u=ue)}else u||void 0===p||(u=i.getTime()+60*p*1e3);e.expiresAt=u,e.isUnread=l===De.MessageType.USER_SENT&&!c&&-1===this.compareRecipientStatus(k,De.MessageRecipientStatus.READ),this.config.condensedReplays||(e.markedRecipientStatus=_),e.ttl=p}},{key:"compareRecipientStatus",value:function(e,t){return De.MessageRecipientStatus.isValid(e)&&(e=Be.MESSAGE_STATUS_ORDER[e]),De.MessageRecipientStatus.isValid(t)&&(t=Be.MESSAGE_STATUS_ORDER[t]),t<e?1:e===t?0:e<t?-1:void 0}},{key:"__getMessageAttachment",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Re(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));var n=this._resolveMessage(e);return n?(t=t.toString(),n.attachments?(0,xe.default)(n.attachments,{id:t}):null):null}},{key:"__getAttachmentPath",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Re(t));if("string"!=typeof e)throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));return"/v2/message/"+e+"/attachment/"+t}},{key:"downloadAttachmentUrl",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Re(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("string"!=typeof t&&"number"!=typeof t)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(t));return this._downloadAttachmentBlobAndUrl(e,t).then(function(e){return e.url})}},{key:"downloadAttachment",value:(S=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).fileName;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Re(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=8;break;case 8:e.next=33;break;case 16:return e.next=18,this._downloadAttachmentBlobAndUrl(r.serverId,n);case 18:a=e.sent.blob;case 19:if((l=l||(void 0).name)||(l="Attachment",r.sender.$placeholder||(l+=" from "+r.sender.displayName),l+=" at "+(0,Ue.default)(r.createdAt).format("YYYY-MM-DD h-mma"),(o=(0,Ke.getMimeType)({mime:(void 0).contentType}))&&(l+=o.ext)),(i=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))&&navigator.userAgent.match("chrome"))return e.next=25,this.__loadLocalFilePathWithFileReader(a);e.next=30;break;case 25:s=e.sent,u=(0,We.base64ToArrayBuffer)(s),this._saveByteArray(l,u,(void 0).contentType),e.next=31;break;case 30:i?(c=window.URL.createObjectURL(a),window.open(c,"_blank")):(0,d(199).saveAs)(a,l);case 31:e.next=34;break;case 33:$e.default.TargetNotSupportedError.raise();case 34:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"_saveByteArray",value:function(e,t,n){var r=new FileReader,a=new Blob([t],{type:n});r.fileName=e,r.onload=function(e){window.open(r.result,"_blank")},r.readAsDataURL(a)}},{key:"_downloadAttachmentBlobAndUrl",value:(j=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Re(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 6:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=8;break;case 8:e.next=27;break;case 13:if(r=e.sent){e.next=16;break}throw new $e.default.NotFoundError("MessageAttachment",(void 0).serverId+":"+n);case 16:if(r.isLocal&&r.localFile instanceof Blob)return e.next=19,r.localPathPromise;e.next=23;break;case 19:return a=e.sent,e.abrupt("return",{blob:r.localFile,url:a});case 23:return o=this.__getAttachmentPath((void 0).serverId,n),e.abrupt("return",this.httpClient.downloadFileBlobAndUrl(o));case 25:e.next=28;break;case 27:$e.default.TargetNotSupportedError.raise();case 28:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"downloadAttachmentToFile",value:(O=(0,pe.default)(Pe.default.mark(function e(t,n,r){var a,o,i;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Re(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Re(r));e.next=6;break;case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "messageId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 8:if("string"!=typeof n&&"number"!=typeof n)throw new TypeError('Value of argument "attachmentId" violates contract.\n\nExpected:\nstring | number\n\nGot:\n'+Se(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "dest" violates contract.\n\nExpected:\nstring\n\nGot:\n'+Se(r));e.next=12;break;case 12:return n=n.toString(),a=this._resolveMessage(t),e.next=17,this.findAttachment(t,n);case 17:if(o=e.sent){e.next=20;break}throw new $e.default.NotFoundError("MessageAttachment",a.serverId+":"+n);case 20:if(!/(\/|\\)$/.test(r)){e.next=26;break}if(!o.name){e.next=25;break}r+=o.name,e.next=26;break;case 25:throw new Error("missing file name in downloadAttachmentToFile(..., dest)");case 26:return i=this.__getAttachmentPath(a.serverId,n),e.abrupt("return",this.httpClient.downloadToFile(i,r));case 30:$e.default.TargetNotSupportedError.raise();case 31:case"end":return e.stop()}},e,this)})),function(e,t,n){return O.apply(this,arguments)})},{key:"getMessageCount",value:function(){return this.host.models.Message.getAll().length}},{key:"getTotalUnreadCount",value:function(){var e=this.host.models.Product.getAll()[0];return e?e.unreadCount:0}},{key:"getTotalUnreadPriorityCount",value:function(){var e=this.host.models.Product.getAll()[0];return e?e.unreadPriorityCount:0}},{key:"markAsRead",value:(I=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=l.localOnly,f=void 0!==d&&d,p=l.queue,y=void 0===p?this.host.currentlyServingOfflineMessages:p;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Se(t));case 4:if(0===(t=(n=(n=t,qe.arrayWrapBound).call(n).map(this._resolveModelId),Ne.default).call(n)).length)return e.abrupt("return");e.next=7;break;case 7:if(this.config.condensedReplays||!f){e.next=34;break}if(!(r=this.host.models.Message.getMulti(t))||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected readMessages to be iterable, got "+Se(r));e.next=11;break;case 11:if(!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected readMessages to be iterable, got "+Re(r));e.next=13;break;case 13:for(o=!(a=!0),i=void 0,e.prev=16,s=(0,Ge.default)(r);!(a=(u=s.next()).done);a=!0)(c=u.value)&&(c._markingAsStatus=De.MessageRecipientStatus.READ,this.host.models.Message.inject(c));e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),o=!0,i=e.t0;case 24:e.prev=24,e.prev=25,!a&&s.return&&s.return();case 27:if(e.prev=27,o)throw i;e.next=30;break;case 30:return e.finish(27);case 31:return e.finish(24);case 32:e.next=39;break;case 34:if(y)return e.abrupt("return",this.__queueSetMessageStatuses({readIds:t}));e.next=38;break;case 38:return e.abrupt("return",this.__setMessagesStatus({readIds:t}));case 39:case"end":return e.stop()}},e,this,[[16,20,24,32],[25,,27,31]])})),function(e){return I.apply(this,arguments)})},{key:"markAsDelivered",value:(T=(0,pe.default)(Pe.default.mark(function e(t){var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object||Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring | Object | Array<string | Object>\n\nGot:\n'+Se(t));case 4:if(r=(0,_e.default)(r,{queue:this.host.currentlyServingOfflineMessages}),0===(t=(n=(n=t,qe.arrayWrapBound).call(n).map(this._resolveModelId),Ne.default).call(n)).length)return e.abrupt("return");e.next=8;break;case 8:if(r.queue)return e.abrupt("return",this.__queueSetMessageStatuses({deliveredIds:t}));e.next=12;break;case 12:return e.abrupt("return",this.__setMessagesStatus({deliveredIds:t}));case 13:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"markAsReceived",value:(A=(0,pe.default)(Pe.default.mark(function e(){var t=arguments;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.markAsDelivered.apply(this,t));case 1:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"__queueSetMessageStatuses",value:(k=(0,pe.default)(Pe.default.mark(function e(t){var n,r=t.deliveredIds,a=t.readIds,o=arguments;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=o[0]&&(void 0===o[0].deliveredIds||null==o[0].deliveredIds||Array.isArray(o[0].deliveredIds)&&o[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(void 0===o[0].readIds||null==o[0].readIds||Array.isArray(o[0].readIds)&&o[0].readIds.every(function(e){return"string"==typeof e}))){e.next=2;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds?: ?Array<string>;\n  readIds?: ?Array<string>;\n}\n\nGot:\n"+Re(o[0]));case 2:if(null!=o[0]&&(void 0===o[0].deliveredIds||null==o[0].deliveredIds||Array.isArray(o[0].deliveredIds)&&o[0].deliveredIds.every(function(e){return"string"==typeof e}))&&(void 0===o[0].readIds||null==o[0].readIds||Array.isArray(o[0].readIds)&&o[0].readIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  deliveredIds?: ?Array<string>;\n  readIds?: ?Array<string>;\n}\n\nGot:\n"+Se(o[0]));case 4:if(n=this._queuedSetMessageStatuses,r&&(n.deliveredIds=(0,Ee.default)(n.deliveredIds,r)),a&&(n.readIds=(0,Ee.default)(n.readIds,a)),n.deliveredIds.length+n.readIds.length>=this.config.flushSetMessageStatusMaxCount)return this.logger.log("reached "+this.config.flushSetMessageStatusMaxCount+" -- flushing"),e.abrupt("return",this.__flushSetMessageStatusesQueue());e.next=13;break;case 13:this._throttled_flushSetMessageStatusesQueue();case 14:case"end":return e.stop()}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"__setMessagesStatus",value:(_=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C=t.deliveredIds,P=void 0===C?[]:C,V=t.readIds,N=void 0===V?[]:V;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),P=(n=P.map(this._resolveModelId),Ne.default).call(n),N=(n=N.map(this._resolveModelId),Ne.default).call(n),P=this.config.condensedReplays?(0,we.default)(P,N):(r=this.host.models.Message.getMulti(P).filter(function(e){return e&&Be.MESSAGE_STATUS_ORDER[e.markedRecipientStatus]>=Be.MESSAGE_STATUS_ORDER[De.MessageRecipientStatus.DELIVERED]}),a=r.map(function(e){return e.id}),o=this.host.models.Message.getMulti(N).filter(function(e){return e&&Be.MESSAGE_STATUS_ORDER[e.markedRecipientStatus]>=Be.MESSAGE_STATUS_ORDER[De.MessageRecipientStatus.READ]}),i=o.map(function(e){return e.id}),N=(0,we.default)(N,i),(0,we.default)(P,N,a)),s={},0<P.length&&(s.delivered=P),!(0<N.length)){e.next=32;break}if(s.read=N,!(u=this.host.models.Message.getMulti(N))||"function"!=typeof u[Ce.default]&&!Array.isArray(u))throw new TypeError("Expected readMessages to be iterable, got "+Se(u));e.next=11;break;case 11:if(!u||"function"!=typeof u[Ce.default]&&!Array.isArray(u))throw new TypeError("Expected readMessages to be iterable, got "+Re(u));e.next=13;break;case 13:for(l=!(c=!0),d=void 0,e.prev=16,f=(0,Ge.default)(u);!(c=(p=f.next()).done);c=!0)(y=p.value)&&(y._markingAsStatus=De.MessageRecipientStatus.READ,this.host.models.Message.inject(y));e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),l=!0,d=e.t0;case 24:e.prev=24,e.prev=25,!c&&f.return&&f.return();case 27:if(e.prev=27,l)throw d;e.next=30;break;case 30:return e.finish(27);case 31:return e.finish(24);case 32:if(0===(0,ze.default)(s).length)return e.abrupt("return",!1);e.next=34;break;case 34:return e.prev=34,e.next=37,this.host.api.messages.updateRecipientStatusMulti(s);case 37:if(h=e.sent,!this.config.condensedReplays){e.next=63;break}if(!(E=(0,ce.default)(h))||"function"!=typeof E[Ce.default]&&!Array.isArray(E))throw new TypeError("Expected _Object$entries2 to be iterable, got "+Se(E));e.next=42;break;case 42:if(!E||"function"!=typeof E[Ce.default]&&!Array.isArray(E))throw new TypeError("Expected _Object$entries2 to be iterable, got "+Re(E));e.next=44;break;case 44:for(v=!(g=!0),m=void 0,e.prev=47,b=(0,Ge.default)(E);!(g=(w=b.next()).done);g=!0)x=(0,ue.default)(w.value,2),_=x[0],k=x[1],A=k.unread_message_count,T=k.unread_priority_message_count,(I=this.host.models.Conversation.get(_))&&(I.unreadMessageCount=A,I.unreadPriorityMessageCount=T,this.host.models.Conversation.inject(I));e.next=55;break;case 51:e.prev=51,e.t1=e.catch(47),v=!0,m=e.t1;case 55:e.prev=55,e.prev=56,!g&&b.return&&b.return();case 58:if(e.prev=58,v)throw m;e.next=61;break;case 61:return e.finish(58);case 62:return e.finish(55);case 63:e.next=92;break;case 65:if(e.prev=65,e.t2=e.catch(34),!(O=this.host.models.Message.getMulti(N))||"function"!=typeof O[Ce.default]&&!Array.isArray(O))throw new TypeError("Expected readMessages to be iterable, got "+Se(O));e.next=70;break;case 70:if(!O||"function"!=typeof O[Ce.default]&&!Array.isArray(O))throw new TypeError("Expected readMessages to be iterable, got "+Re(O));e.next=72;break;case 72:for(S=!(j=!0),R=void 0,e.prev=75,M=(0,Ge.default)(O);!(j=(z=M.next()).done);j=!0)(G=z.value)&&G._markingAsStatus&&(G._markingAsStatus=void 0,this.host.models.Message.inject(G));e.next=83;break;case 79:e.prev=79,e.t3=e.catch(75),S=!0,R=e.t3;case 83:e.prev=83,e.prev=84,!j&&M.return&&M.return();case 86:if(e.prev=86,S)throw R;e.next=89;break;case 89:return e.finish(86);case 90:return e.finish(83);case 91:return e.abrupt("return",fe.default.reject(e.t2));case 92:return e.abrupt("return",!0);case 93:case"end":return e.stop()}},e,this,[[16,20,24,32],[25,,27,31],[34,65],[47,51,55,63],[56,,58,62],[75,79,83,91],[84,,86,90]])})),function(e){return _.apply(this,arguments)})},{key:"setMessageTTLInMinutes",value:function(e,t){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Re(t));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));if("number"!=typeof t)throw new TypeError('Value of argument "ttl" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+Se(t));var n=this._resolveMessage(e);if(n){var r=(0,Ue.default)().add(t,"minute").toDate().getTime();this.host.models.Message.inject({id:n.id,ttl:t,expiresAt:r})}}},{key:"_clearOptimisticMarkAsReadState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();if(e.getTime&&(e=e.getTime()),!(i=this.host.organizations.getAll())||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g to be iterable, got "+Se(i));if(!i||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g to be iterable, got "+Re(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Ge.default)(i);!(t=(a=o.next()).done);t=!0)for(var i,s=a.value.__markingAsReadConversations,u=!1;!u&&0<s.length;){var c=s[0],l=this.host.conversations.getById(c.id);if(!l)return;l._markingAsReadExpiration<e?(l._markingAsRead=!1,l._markingAsReadSortNumber=null,l._markingAsReadExpiration=null,this.host.models.Conversation.inject(l)):u=!0}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"ensureRecipientStatus",value:(x=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},g=h.includeUsers,v=void 0===g||g,m=h.queue,b=void 0===m||m;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}return e.abrupt("return",null);case 8:if(r=n.counterPartyType,a=n.senderStatus,o=n.shouldEnsureRecipientStatus,i=n.statusesPerRecipient,a===De.MessageSenderStatus.SENDING)return e.abrupt("return",null);e.next=11;break;case 11:if("distributionList"===r)return e.abrupt("return",null);e.next=13;break;case 13:if(o||!(0<i.length)){e.next=41;break}if(s=!1,!v){e.next=39;break}if(!i||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(i));e.next=18;break;case 18:if(!i||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Re(i));e.next=20;break;case 20:for(c=!(u=!0),l=void 0,e.prev=23,d=(0,Ge.default)(i);!(u=(f=d.next()).done);u=!0)f.value.user||(s=!0);e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),c=!0,l=e.t0;case 31:e.prev=31,e.prev=32,!u&&d.return&&d.return();case 34:if(e.prev=34,c)throw l;e.next=37;break;case 37:return e.finish(34);case 38:return e.finish(31);case 39:if(s){e.next=41;break}return e.abrupt("return",i);case 41:if(p=void 0,b)return e.next=45,this.__queueFindRecipientStatuses([{id:t,includeUsers:v}]);e.next=49;break;case 45:y=e.sent,p=y[0],e.next=52;break;case 49:return e.next=51,this.__findRecipientStatus(t,{includeUsers:v});case 51:p=e.sent;case 52:return e.abrupt("return",p);case 53:case"end":return e.stop()}},e,this,[[23,27,31,39],[32,,34,38]])})),function(e){return x.apply(this,arguments)})},{key:"findRecipientStatus",value:(E=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.includeUsers,s=void 0!==i&&i,u=o.queue,c=void 0===u||u;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n=this._resolveMessage(t)){e.next=8;break}return e.abrupt("return",null);case 8:if(n.senderStatus===De.MessageSenderStatus.SENDING)return e.abrupt("return",null);e.next=10;break;case 10:if("distributionList"===n.counterPartyType)return e.abrupt("return",null);e.next=12;break;case 12:if(t=this._resolveModelId(t),r=void 0,c)return e.next=17,this.__queueFindRecipientStatuses([{id:t,includeUsers:s}]);e.next=21;break;case 17:a=e.sent,r=a[0],e.next=24;break;case 21:return e.next=23,this.__findRecipientStatus(t,{includeUsers:s});case 23:r=e.sent;case 24:return e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"ensureRecipientStatusMulti",value:(w=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},z=M.includeUsers,G=void 0===z||z,C=M.queue,P=void 0===C||C;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Re(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Se(t));case 4:if(t=(n=(n=t,qe.arrayWrapBound).call(n).map(this._resolveModelId),Ne.default).call(n),r=[],a={},!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Se(t));e.next=9;break;case 9:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Re(t));e.next=11;break;case 11:i=!(o=!0),s=void 0,e.prev=14,u=(0,Ge.default)(t);case 16:if(o=(c=u.next()).done){e.next=53;break}if(l=c.value,d={id:l,includeUsers:G},f=this._resolveMessage(l),p=!0,!f){e.next=49;break}if(y=f.shouldEnsureRecipientStatus,h=f.statusesPerRecipient,y||!(0<h.length)){e.next=49;break}if(p=!1,!G){e.next=49;break}if(!h||"function"!=typeof h[Ce.default]&&!Array.isArray(h))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(h));e.next=28;break;case 28:if(!h||"function"!=typeof h[Ce.default]&&!Array.isArray(h))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Re(h));e.next=30;break;case 30:for(v=!(g=!0),m=void 0,e.prev=33,b=(0,Ge.default)(h);!(g=(w=b.next()).done);g=!0)w.value.user||(p=!0);e.next=41;break;case 37:e.prev=37,e.t0=e.catch(33),v=!0,m=e.t0;case 41:e.prev=41,e.prev=42,!g&&b.return&&b.return();case 44:if(e.prev=44,v)throw m;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:p?r.push(d):a[d.id]=f.statusesPerRecipient;case 50:o=!0,e.next=16;break;case 53:e.next=59;break;case 55:e.prev=55,e.t1=e.catch(14),i=!0,s=e.t1;case 59:e.prev=59,e.prev=60,!o&&u.return&&u.return();case 62:if(e.prev=62,i)throw s;e.next=65;break;case 65:return e.finish(62);case 66:return e.finish(59);case 67:if(0===r.length)return e.abrupt("return");e.next=69;break;case 69:if(E=void 0,P)return e.next=73,this.__queueFindRecipientStatuses(r);e.next=76;break;case 73:E=e.sent,e.next=79;break;case 76:return e.next=78,this.__findRecipientStatusMulti(r);case 78:E=e.sent;case 79:if(E)for(x=0;x<r.length;x++)E.length>x&&(_=r[x],k=E[x],a[_.id]=k);if(A=[],!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Se(t));e.next=83;break;case 83:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Re(t));e.next=85;break;case 85:for(I=!(T=!0),O=void 0,e.prev=88,j=(0,Ge.default)(t);!(T=(S=j.next()).done);T=!0)R=S.value,A.push(a[R]);e.next=96;break;case 92:e.prev=92,e.t2=e.catch(88),I=!0,O=e.t2;case 96:e.prev=96,e.prev=97,!T&&j.return&&j.return();case 99:if(e.prev=99,I)throw O;e.next=102;break;case 102:return e.finish(99);case 103:return e.finish(96);case 104:return e.abrupt("return",A);case 105:case"end":return e.stop()}},e,this,[[14,55,59,67],[33,37,41,49],[42,,44,48],[60,,62,66],[88,92,96,104],[97,,99,103]])})),function(e){return w.apply(this,arguments)})},{key:"findRecipientStatusMulti",value:(b=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},f=d.includeUsers,p=void 0!==f&&f,y=d.queue,h=void 0!==y&&y;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Re(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Se(t));case 4:if(t=(n=(n=t,qe.arrayWrapBound).call(n).map(this._resolveModelId),Ne.default).call(n),r=[],!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Se(t));e.next=8;break;case 8:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+Re(t));e.next=10;break;case 10:for(o=!(a=!0),i=void 0,e.prev=13,s=(0,Ge.default)(t);!(a=(u=s.next()).done);a=!0)c=u.value,l={id:c,includeUsers:p},r.push(l);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),o=!0,i=e.t0;case 21:e.prev=21,e.prev=22,!a&&s.return&&s.return();case 24:if(e.prev=24,o)throw i;e.next=27;break;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(0===r.length)return e.abrupt("return");e.next=31;break;case 31:if(h)return e.abrupt("return",this.__queueFindRecipientStatuses(r));e.next=35;break;case 35:return e.abrupt("return",this.__findRecipientStatusMulti(r));case 36:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28]])})),function(e){return b.apply(this,arguments)})},{key:"__queueFindRecipientStatuses",value:(m=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "statusRequests" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Re(t));case 2:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "statusRequests" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+Se(t));case 4:if(n=[],!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected statusRequests to be iterable, got "+Se(t));e.next=7;break;case 7:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected statusRequests to be iterable, got "+Re(t));e.next=9;break;case 9:a=!(r=!0),o=void 0,e.prev=12,i=(0,Ge.default)(t);case 14:if(r=(s=i.next()).done){e.next=59;break}if(u=s.value,c=u.id,l=u.includeUsers,p=!(f=d=void 0),n.push(new fe.default(function(e,t){d=e,f=t})),!(b=this._queuedFindRecipientStatuses)||"function"!=typeof b[Ce.default]&&!Array.isArray(b))throw new TypeError("Expected _queuedFindRecipientS to be iterable, got "+Se(b));e.next=23;break;case 23:if(!b||"function"!=typeof b[Ce.default]&&!Array.isArray(b))throw new TypeError("Expected _queuedFindRecipientS to be iterable, got "+Re(b));e.next=25;break;case 25:h=!(y=!0),g=void 0,e.prev=28,v=(0,Ge.default)(b);case 30:if(y=(m=v.next()).done){e.next=41;break}if(w=m.value,c===w.id)return w.includeUsers=w.includeUsers||l,w.onCompletes.push(d),w.onErrors.push(f),p=!1,e.abrupt("break",41);e.next=38;break;case 38:y=!0,e.next=30;break;case 41:e.next=47;break;case 43:e.prev=43,e.t0=e.catch(28),h=!0,g=e.t0;case 47:e.prev=47,e.prev=48,!y&&v.return&&v.return();case 50:if(e.prev=50,h)throw g;e.next=53;break;case 53:return e.finish(50);case 54:return e.finish(47);case 55:p&&this._queuedFindRecipientStatuses.push({id:c,includeUsers:l,onCompletes:[d],onErrors:[f]});case 56:r=!0,e.next=14;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(12),a=!0,o=e.t1;case 65:e.prev=65,e.prev=66,!r&&i.return&&i.return();case 68:if(e.prev=68,a)throw o;e.next=71;break;case 71:return e.finish(68);case 72:return e.finish(65);case 73:return this._queuedFindRecipientStatuses.length>=this.config.flushFindRecipientStatusMaxCount?(this.logger.log("reached "+this.config.flushFindRecipientStatusMaxCount+" -- flushing"),this.__flushFindRecipientStatusesQueue()):0<this._queuedFindRecipientStatuses.length&&this._throttled_flushFindRecipientStatusesQueue(),e.next=76,fe.default.all(n);case 76:return E=e.sent,e.abrupt("return",E);case 78:case"end":return e.stop()}},e,this,[[12,61,65,73],[28,43,47,55],[48,,50,54],[66,,68,72]])})),function(e){return m.apply(this,arguments)})},{key:"__flushFindRecipientStatusesQueue",value:(v=(0,pe.default)(Pe.default.mark(function e(){var v,m,b,t,n;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this._queuedFindRecipientStatuses.length)return e.abrupt("return");e.next=2;break;case 2:return v=this._queuedFindRecipientStatuses,this._queuedFindRecipientStatuses=[],b=m=void 0,e.prev=5,e.next=8,this.__findRecipientStatusMulti(v);case 8:b=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),m=e.t0;case 14:for(e.prev=14,t=function(e){var t=void 0;b&&b.length>e&&(t=b[e]);var n=v[e],r=n.onCompletes,a=n.onErrors;if(m){if(!a||"function"!=typeof a[Ce.default]&&!Array.isArray(a))throw new TypeError("Expected onErrors to be iterable, got "+Se(a));if(!a||"function"!=typeof a[Ce.default]&&!Array.isArray(a))throw new TypeError("Expected onErrors to be iterable, got "+Re(a));var o=!0,i=!1,s=void 0;try{for(var u,c=function(){var e=u.value;setTimeout(function(){return e(m)},0)},l=(0,Ge.default)(a);!(o=(u=l.next()).done);o=!0)c()}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}}else{if(!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected onCompletes to be iterable, got "+Se(r));if(!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected onCompletes to be iterable, got "+Re(r));var d=!0,f=!1,p=void 0;try{for(var y,h=function(){var e=y.value;setTimeout(function(){return e(t)},0)},g=(0,Ge.default)(r);!(d=(y=g.next()).done);d=!0)h()}catch(e){f=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(f)throw p}}}},n=0;n<v.length;n++)t(n);return e.finish(14);case 18:case"end":return e.stop()}},e,this,[[5,11,14,18]])})),function(){return v.apply(this,arguments)})},{key:"__findRecipientStatus",value:(g=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k=this,A=n.includeUsers;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),r=this._resolveMessage(t),a=!1,this._pendingFindRecipientStatuses[r.id])return e.abrupt("return",null);e.next=5;break;case 5:return o=void 0,e.prev=6,i=new fe.default(function(e,t){k._pendingFindRecipientStatuses[r.id]=function(){return e(null)}}),e.next=10,fe.default.race([i,this.host.api.messages.findRecipientStatus(r.serverId)]);case 10:o=e.sent;case 11:return e.prev=11,delete this._pendingFindRecipientStatuses[r.id],e.finish(11);case 14:if(o){e.next=16;break}return e.abrupt("return",null);case 16:if(o.is_recalled)return this.host.models.Message.eject(r),e.abrupt("return",null);e.next=19;break;case 19:if(!(f=o.statuses)||"function"!=typeof f[Ce.default]&&!Array.isArray(f))throw new TypeError("Expected _data$statuses to be iterable, got "+Se(f));e.next=22;break;case 22:if(!f||"function"!=typeof f[Ce.default]&&!Array.isArray(f))throw new TypeError("Expected _data$statuses to be iterable, got "+Re(f));e.next=24;break;case 24:for(u=!(s=!0),c=void 0,e.prev=27,l=(0,Ge.default)(f);!(s=(d=l.next()).done);s=!0)p=d.value,this.__injectMessageStatus(r,p);e.next=35;break;case 31:e.prev=31,e.t0=e.catch(27),u=!0,c=e.t0;case 35:e.prev=35,e.prev=36,!s&&l.return&&l.return();case 38:if(e.prev=38,u)throw c;e.next=41;break;case 41:return e.finish(38);case 42:return e.finish(35);case 43:if(!A){e.next=72;break}if(y=r.recipientOrganizationId,h=r.statusesPerRecipient,g=[],!h||"function"!=typeof h[Ce.default]&&!Array.isArray(h))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(h));e.next=48;break;case 48:if(!h||"function"!=typeof h[Ce.default]&&!Array.isArray(h))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Re(h));e.next=50;break;case 50:for(m=!(v=!0),b=void 0,e.prev=53,w=(0,Ge.default)(h);!(v=(E=w.next()).done);v=!0)x=E.value,(_=x.userId)&&usersIds.push(_);e.next=61;break;case 57:e.prev=57,e.t1=e.catch(53),m=!0,b=e.t1;case 61:e.prev=61,e.prev=62,!v&&w.return&&w.return();case 64:if(e.prev=64,m)throw b;e.next=67;break;case 67:return e.finish(64);case 68:return e.finish(61);case 69:return e.next=71,this.host.users.ensureUsers(g,y);case 71:a=!0;case 72:return r.shouldEnsureRecipientStatus&&(r.shouldEnsureRecipientStatus=!1,a=!0),a&&this.host.models.Message.inject(r),!this.config.condensedReplays&&Be.MESSAGE_STATUS_ORDER[r.markedRecipientStatus]<Be.MESSAGE_STATUS_ORDER[De.MessageRecipientStatus.DELIVERED]&&this.markAsReceived(r),e.abrupt("return",r.statusesPerRecipient);case 77:case"end":return e.stop()}},e,this,[[6,,11,14],[27,31,35,43],[36,,38,42],[53,57,61,69],[62,,64,68]])})),function(e,t){return g.apply(this,arguments)})},{key:"__findRecipientStatusMulti",value:(h=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C,P,V,N,U,F,L,$,D,B,q,Z,K,H,W,X,Q,Y,J,ee,te,ne,re,ae,oe,ie,se,ue,ce,le,de,fe,pe,ye,he,ge,ve,me,be,we,Ee,xe,_e,ke,Ae,Te,Ie,Oe,je=this;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "requests" violates contract.\n\nExpected:\nArray<Object>\n\nGot:\n'+Re(t));case 2:if(Array.isArray(t)&&t.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "requests" violates contract.\n\nExpected:\nArray<Object>\n\nGot:\n'+Se(t));case 4:if(this.host.requireUser(),n={},r=t,t=[],!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected inRequests to be iterable, got "+Se(r));e.next=10;break;case 10:if(!r||"function"!=typeof r[Ce.default]&&!Array.isArray(r))throw new TypeError("Expected inRequests to be iterable, got "+Re(r));e.next=12;break;case 12:o=!(a=!0),i=void 0,e.prev=15,s=(0,Ge.default)(r);case 17:if(a=(u=s.next()).done){e.next=35;break}if(c=u.value,l=c.id,d=c.includeUsers,f=this._resolveMessage(l),y=(p=f||{}).counterParty,h=p.serverId,g={id:l,includeUsers:d,message:f},t.push(g),h){e.next=26;break}return e.abrupt("continue",32);case 26:if(this._pendingFindRecipientStatuses[h])return e.abrupt("continue",32);e.next=28;break;case 28:if(y&&"distributionList"===y.$entityType)return e.abrupt("continue",32);e.next=30;break;case 30:g.id=h,n[h]=!0;case 32:a=!0,e.next=17;break;case 35:e.next=41;break;case 37:e.prev=37,e.t0=e.catch(15),o=!0,i=e.t0;case 41:e.prev=41,e.prev=42,!a&&s.return&&s.return();case 44:if(e.prev=44,o)throw i;e.next=47;break;case 47:return e.finish(44);case 48:return e.finish(41);case 49:if(v=(0,Ve.default)((0,ze.default)(n),20),m={},b={},!v||"function"!=typeof v[Ce.default]&&!Array.isArray(v))throw new TypeError("Expected idGroupChunks to be iterable, got "+Se(v));e.next=54;break;case 54:if(!v||"function"!=typeof v[Ce.default]&&!Array.isArray(v))throw new TypeError("Expected idGroupChunks to be iterable, got "+Re(v));e.next=56;break;case 56:E=!(w=!0),x=void 0,e.prev=59,_=(0,Ge.default)(v);case 61:if(w=(k=_.next()).done){e.next=156;break}return A=k.value,T=void 0,e.prev=64,e.delegateYield(Pe.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l,d,f,p,y,h;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},!A||"function"!=typeof A[Ce.default]&&!Array.isArray(A))throw new TypeError("Expected idsInGroup to be iterable, got "+Se(A));e.next=3;break;case 3:if(!A||"function"!=typeof A[Ce.default]&&!Array.isArray(A))throw new TypeError("Expected idsInGroup to be iterable, got "+Re(A));e.next=5;break;case 5:for(r=!(n=!0),a=void 0,e.prev=8,o=function(){var e=s.value;je._pendingFindRecipientStatuses[e]=function(){t[e]=!0}},i=(0,Ge.default)(A);!(n=(s=i.next()).done);n=!0)o();e.next=17;break;case 13:e.prev=13,e.t0=e.catch(8),r=!0,a=e.t0;case 17:e.prev=17,e.prev=18,!n&&i.return&&i.return();case 20:if(e.prev=20,r)throw a;e.next=23;break;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return e.next=27,je.host.api.messages.findRecipientStatusMulti(A);case 27:if(u=e.sent,T=[],!u||"function"!=typeof u[Ce.default]&&!Array.isArray(u))throw new TypeError("Expected rawResults to be iterable, got "+Se(u));e.next=31;break;case 31:if(!u||"function"!=typeof u[Ce.default]&&!Array.isArray(u))throw new TypeError("Expected rawResults to be iterable, got "+Re(u));e.next=33;break;case 33:for(l=!(c=!0),d=void 0,e.prev=36,f=(0,Ge.default)(u);!(c=(p=f.next()).done);c=!0)y=p.value,h=y.client_id,t[h]||T.push(y);e.next=44;break;case 40:e.prev=40,e.t1=e.catch(36),l=!0,d=e.t1;case 44:e.prev=44,e.prev=45,!c&&f.return&&f.return();case 47:if(e.prev=47,l)throw d;e.next=50;break;case 50:return e.finish(47);case 51:return e.finish(44);case 52:case"end":return e.stop()}},e,je,[[8,13,17,25],[18,,20,24],[36,40,44,52],[45,,47,51]])})(),"t1",66);case 66:if(e.prev=66,!A||"function"!=typeof A[Ce.default]&&!Array.isArray(A))throw new TypeError("Expected idsInGroup to be iterable, got "+Se(A));e.next=69;break;case 69:if(!A||"function"!=typeof A[Ce.default]&&!Array.isArray(A))throw new TypeError("Expected idsInGroup to be iterable, got "+Re(A));e.next=71;break;case 71:for(O=!(I=!0),j=void 0,e.prev=74,S=(0,Ge.default)(A);!(I=(R=S.next()).done);I=!0)M=R.value,delete this._pendingFindRecipientStatuses[M];e.next=82;break;case 78:e.prev=78,e.t2=e.catch(74),O=!0,j=e.t2;case 82:e.prev=82,e.prev=83,!I&&S.return&&S.return();case 85:if(e.prev=85,O)throw j;e.next=88;break;case 88:return e.finish(85);case 89:return e.finish(82);case 90:return e.finish(66);case 91:if(T){e.next=93;break}return e.abrupt("return",[]);case 93:if(!T||"function"!=typeof T[Ce.default]&&!Array.isArray(T))throw new TypeError("Expected results to be iterable, got "+Se(T));e.next=95;break;case 95:if(!T||"function"!=typeof T[Ce.default]&&!Array.isArray(T))throw new TypeError("Expected results to be iterable, got "+Re(T));e.next=97;break;case 97:G=!(z=!0),C=void 0,e.prev=100,P=(0,Ge.default)(T);case 102:if(z=(V=P.next()).done){e.next=139;break}if(N=V.value,U=N.client_id,F=N.statuses,L=this.host.models.Message.get(U),N.is_recalled)return this.host.models.Message.eject(L),b[U]=!0,e.abrupt("continue",136);e.next=111;break;case 111:if(!(F&&0<F.length)){e.next=136;break}if(!F||"function"!=typeof F[Ce.default]&&!Array.isArray(F))throw new TypeError("Expected statuses to be iterable, got "+Se(F));e.next=114;break;case 114:if(!F||"function"!=typeof F[Ce.default]&&!Array.isArray(F))throw new TypeError("Expected statuses to be iterable, got "+Re(F));e.next=116;break;case 116:for(D=!($=!0),B=void 0,e.prev=119,q=(0,Ge.default)(F);!($=(Z=q.next()).done);$=!0)K=Z.value,this.__injectMessageStatus(L,K);e.next=127;break;case 123:e.prev=123,e.t3=e.catch(119),D=!0,B=e.t3;case 127:e.prev=127,e.prev=128,!$&&q.return&&q.return();case 130:if(e.prev=130,D)throw B;e.next=133;break;case 133:return e.finish(130);case 134:return e.finish(127);case 135:m[U]=L;case 136:z=!0,e.next=102;break;case 139:e.next=145;break;case 141:e.prev=141,e.t4=e.catch(100),G=!0,C=e.t4;case 145:e.prev=145,e.prev=146,!z&&P.return&&P.return();case 148:if(e.prev=148,G)throw C;e.next=151;break;case 151:return e.finish(148);case 152:return e.finish(145);case 153:w=!0,e.next=61;break;case 156:e.next=162;break;case 158:e.prev=158,e.t5=e.catch(59),E=!0,x=e.t5;case 162:e.prev=162,e.prev=163,!w&&_.return&&_.return();case 165:if(e.prev=165,E)throw x;e.next=168;break;case 168:return e.finish(165);case 169:return e.finish(162);case 170:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Se(t));e.next=172;break;case 172:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Re(t));e.next=174;break;case 174:W=!(H=!0),X=void 0,e.prev=177,Q=(0,Ge.default)(t);case 179:if(H=(Y=Q.next()).done){e.next=219;break}if(J=Y.value,d=J.includeUsers,ee=J.message,te=!1,!ee||b[ee.serverId])return e.abrupt("continue",216);e.next=185;break;case 185:if(ne=ee.recipientOrganizationId,re=ee.shouldEnsureRecipientStatus,ae=ee.statusesPerRecipient,!d){e.next=214;break}if(oe=[],!ae||"function"!=typeof ae[Ce.default]&&!Array.isArray(ae))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Se(ae));e.next=190;break;case 190:if(!ae||"function"!=typeof ae[Ce.default]&&!Array.isArray(ae))throw new TypeError("Expected statusesPerRecipient to be iterable, got "+Re(ae));e.next=192;break;case 192:for(se=!(ie=!0),ue=void 0,e.prev=195,ce=(0,Ge.default)(ae);!(ie=(le=ce.next()).done);ie=!0)de=le.value,(fe=de.userId)&&oe.push(fe);e.next=203;break;case 199:e.prev=199,e.t6=e.catch(195),se=!0,ue=e.t6;case 203:e.prev=203,e.prev=204,!ie&&ce.return&&ce.return();case 206:if(e.prev=206,se)throw ue;e.next=209;break;case 209:return e.finish(206);case 210:return e.finish(203);case 211:return e.next=213,this.host.users.ensureUsers(oe,ne);case 213:te=!0;case 214:re&&(ee.shouldEnsureRecipientStatus=!1,te=!0),te&&this.host.models.Message.inject(ee);case 216:H=!0,e.next=179;break;case 219:e.next=225;break;case 221:e.prev=221,e.t7=e.catch(177),W=!0,X=e.t7;case 225:e.prev=225,e.prev=226,!H&&Q.return&&Q.return();case 228:if(e.prev=228,W)throw X;e.next=231;break;case 231:return e.finish(228);case 232:return e.finish(225);case 233:if(this.config.condensedReplays){e.next=258;break}if(!(me=(0,Me.default)(m))||"function"!=typeof me[Ce.default]&&!Array.isArray(me))throw new TypeError("Expected _Object$values to be iterable, got "+Se(me));e.next=237;break;case 237:if(!me||"function"!=typeof me[Ce.default]&&!Array.isArray(me))throw new TypeError("Expected _Object$values to be iterable, got "+Re(me));e.next=239;break;case 239:for(ye=!(pe=!0),he=void 0,e.prev=242,ge=(0,Ge.default)(me);!(pe=(ve=ge.next()).done);pe=!0)be=ve.value,Be.MESSAGE_STATUS_ORDER[be.markedRecipientStatus]<Be.MESSAGE_STATUS_ORDER[De.MessageRecipientStatus.DELIVERED]&&this.markAsReceived(be);e.next=250;break;case 246:e.prev=246,e.t8=e.catch(242),ye=!0,he=e.t8;case 250:e.prev=250,e.prev=251,!pe&&ge.return&&ge.return();case 253:if(e.prev=253,ye)throw he;e.next=256;break;case 256:return e.finish(253);case 257:return e.finish(250);case 258:if(we=[],!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Se(t));e.next=261;break;case 261:if(!t||"function"!=typeof t[Ce.default]&&!Array.isArray(t))throw new TypeError("Expected requests to be iterable, got "+Re(t));e.next=263;break;case 263:for(xe=!(Ee=!0),_e=void 0,e.prev=266,ke=(0,Ge.default)(t);!(Ee=(Ae=ke.next()).done);Ee=!0)Te=Ae.value,Ie=Te.id,Oe=m[Ie],we.push(Oe?Oe.statusesPerRecipient:null);e.next=274;break;case 270:e.prev=270,e.t9=e.catch(266),xe=!0,_e=e.t9;case 274:e.prev=274,e.prev=275,!Ee&&ke.return&&ke.return();case 277:if(e.prev=277,xe)throw _e;e.next=280;break;case 280:return e.finish(277);case 281:return e.finish(274);case 282:return e.abrupt("return",we);case 283:case"end":return e.stop()}},e,this,[[15,37,41,49],[42,,44,48],[59,158,162,170],[64,,66,91],[74,78,82,90],[83,,85,89],[100,141,145,153],[119,123,127,135],[128,,130,134],[146,,148,152],[163,,165,169],[177,221,225,233],[195,199,203,211],[204,,206,210],[226,,228,232],[242,246,250,258],[251,,253,257],[266,270,274,282],[275,,277,281]])})),function(e){return h.apply(this,arguments)})}]),r((p=et).prototype,"__prepareGroupForUsers",[a],(0,se.default)(p.prototype,"__prepareGroupForUsers"),p.prototype),r(p.prototype,"__prepareRoleP2PGroup",[o],(0,se.default)(p.prototype,"__prepareRoleP2PGroup"),p.prototype),r(p.prototype,"find",[i],(0,se.default)(p.prototype,"find"),p.prototype),r(p.prototype,"downloadAttachmentUrl",[s],(0,se.default)(p.prototype,"downloadAttachmentUrl"),p.prototype),r(p.prototype,"downloadAttachment",[u],(0,se.default)(p.prototype,"downloadAttachment"),p.prototype),r(p.prototype,"_downloadAttachmentBlobAndUrl",[c],(0,se.default)(p.prototype,"_downloadAttachmentBlobAndUrl"),p.prototype),r(p.prototype,"findRecipientStatus",[l],(0,se.default)(p.prototype,"findRecipientStatus"),p.prototype),r(p.prototype,"findRecipientStatusMulti",[f],(0,se.default)(p.prototype,"findRecipientStatusMulti"),p.prototype),p);function et(){var e,g=this;(0,he.default)(this,et);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a,o,i,v=(0,ve.default)(this,(e=et.__proto__||(0,ye.default)(et)).call.apply(e,[this].concat(n)));return v.DELETE_ON_READ_MS=6e4,v.__retrieveSentMessage=(i=(0,pe.default)(Pe.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h=n.instance;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.message_id){e.next=3;break}throw new Error("Missing message_id from /message response");case 3:if(t.sort_number){e.next=16;break}return e.next=6,v.find(r,{instance:h,replace:!0});case 6:if(a=e.sent){e.next=13;break}return e.next=10,new fe.default(function(e){return setTimeout(e,1e3)});case 10:return e.next=12,v.find(r,{instance:h,replace:!0});case 12:a=e.sent;case 13:a&&(h=a),e.next=32;break;case 16:if(void 0===t.is_forwarded&&(t.is_forwarded=!1),o=t.status||"New",v.__setDefaultAttributes(t,{instance:h}),(h=v.host.models.Message.replaceExisting(t,{instance:h})).$synced=void 0,s=(i=h).counterPartyType,u=i.createdAt,c=i.group,l=i.recipientId,f=(d=c||{}).groupType,p=d.p2pRecipient,y=void 0,f===De.GroupType.ROLE_P2P&&p?y="role"===p.$entityType?p.botUserId:p.id:"user"===s&&(y=l),!y){e.next=29;break}v.__injectMessageStatus(h,{accountId:y,createdAt:u,status:o}),e.next=32;break;case 29:if(f===De.GroupType.GROUP)return e.next=32,v.findRecipientStatus(h,{queue:!1});e.next=32;break;case 32:return e.abrupt("return",h);case 33:case"end":return e.stop()}},e,g)})),function(e,t){return i.apply(this,arguments)}),v.__generateAttachmentDescriptor=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "attachment" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));var t="local:"+Le.default.v4();"string"==typeof e||e instanceof Buffer||qe.Validator.raise("attachment","invalid","attachment (string or Buffer) is invalid");var n=void 0,r=void 0,a=void 0,o=d(53),i=d(60),s=d(240),u=d(84);if("string"==typeof e)n=o.statSync(e).size,r=s.lookup(e),a=i.basename(e);else{var c=u(e);if(c)a="attachment."+c.ext,r=c.mime;n=e.byteLength}return{id:t,localPath:"string"==typeof e?e:null,localFile:e instanceof Buffer?e:null,name:a,size:n,contentType:r,isLocal:!0}},v.__retryApiSend=(o=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t)._originalBody,a=n.attachments,o=n.conversationId,i=n.counterPartyId,s=n.deleteOnRead,u=n.id,c=n.metadata,l=n.priority,d=n.recipientOrganizationId,f=n.senderOrganizationId,p=n.shouldEscalate,y=n.ttl,e.prev=1,e.next=4,v.host.api.messages.send({attachment:(0,ke.default)(a,"0.localFile"),body:r,conversationId:o,counterPartyId:i,deleteOnRead:s,escalate:p,localId:u,metadata:c,priority:De.MessagePriority.toServer(l),recipientOrganizationId:d,senderOrganizationId:f,ttl:y});case 4:return h=e.sent,e.next=7,v.__retrieveSentMessage(h,{instance:t});case 7:t=e.sent,v.host.emit("message:sent",t),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),v.logger.warn("error while sending message",e.t0),t.senderStatus=De.MessageSenderStatus.FAILED,v.host.models.Message.inject(t);case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}},e,g,[[1,11]])})),function(e){return o.apply(this,arguments)}),v.__retryApiForward=(a=(0,pe.default)(Pe.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f;return Pe.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t).conversationId,a=n.counterPartyId,o=n.id,i=n.metadata,s=n.originalMessageId,u=n.priority,c=n.recipientOrganizationId,l=n.senderOrganizationId,e.prev=1,e.next=4,v.host.api.messages.forward(s,a,{conversationId:r,localId:o,metadata:i,priority:De.MessagePriority.toServer(u),recipientOrganizationId:c,senderOrganizationId:l});case 4:return d=e.sent,f=d.message_id,e.next=8,v.find(f,{instance:t,replace:!0});case 8:t=e.sent,v.host.emit("message:sent",t),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(1),v.logger.error("error while forwarding message",e.t0),t.senderStatus=De.MessageSenderStatus.FAILED,v.host.models.Message.inject(t);case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}},e,g,[[1,12]])})),function(e){return a.apply(this,arguments)}),v._resolveMessage=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Re(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+Se(e));return v.host.models.Message.is(e)?e:v.host.models.Message.get(e)},v._looksLikeDistributionListMessage=function(e){var t=e.body;if(!t)return!1;var n=t.match(/^\[(.+?)\]: /);return!!n&&n[1]},v.__setDefaultAttributes=function(e,t){var n=t.instance,r={is_forwarded:n.isForwarded,attachments:n.attachments,conversationId:n.conversationId,counterParty:n.counterParty,senderStatus:De.MessageSenderStatus.SENT,shouldEscalate:!1};return n.isForwarded&&(r.originalForwardedMessageCreatedAt=n.originalForwardedMessageCreatedAt,r.originalMessageId=n.originalMessageId,n.originalSender&&(r.originalSender=n.originalSender)),(0,_e.default)(e,r),e},v.__flushSetMessageStatusesQueue=function(){if(0<v._queuedSetMessageStatuses.deliveredIds.length+v._queuedSetMessageStatuses.readIds.length){var e=v._queuedSetMessageStatuses;v._queuedSetMessageStatuses={deliveredIds:[],readIds:[]},v.__setMessagesStatus(e)}},v._onTick=function(){v._deleteExpiredMessages(),v._deleteExpiredMutes(),v.config.condensedReplays&&v._clearOptimisticMarkAsReadState()},v._deleteExpiredMessages=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();if(e.getTime&&(e=e.getTime()),!(i=v.host.organizations.getAll())||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g2 to be iterable, got "+Se(i));if(!i||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g2 to be iterable, got "+Re(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Ge.default)(i);!(t=(a=o.next()).done);t=!0)for(var i,s=a.value.__expirableMessages,u=!1;!u&&0<s.length;){var c=s[0];c.expiresAt<e?v.host.models.Message.eject(c):u=!0}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},v._deleteExpiredMutes=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();if(e.getTime&&(e=e.getTime()),!(i=v.host.organizations.getAll())||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g3 to be iterable, got "+Se(i));if(!i||"function"!=typeof i[Ce.default]&&!Array.isArray(i))throw new TypeError("Expected _host$organizations$g3 to be iterable, got "+Re(i));var t=!0,n=!1,r=void 0;try{for(var a,o=(0,Ge.default)(i);!(t=(a=o.next()).done);t=!0)for(var i,s=a.value.__expirableMutes,u=!1;!u&&0<s.length;){var c=s[0];if(c.expiresAt<e){v.host.models.Mute.eject(c);var l=v.host.models.Conversation.get(c.conversationId);if(!l)continue;l.muted=null,v.host.models.Conversation.inject(l)}else u=!0}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},v._onChangeMessageStatus=function(e,t){var n=t.messageId,r=v.host.models.Message.get(n);r&&v.host.models.Message.inject(r)},v._throttled_flushFindRecipientStatusesQueue=v.config.flushFindRecipientStatusInterval?(0,je.default)(v.__flushFindRecipientStatusesQueue,v.config.flushFindRecipientStatusInterval,{leading:!1}):v.__flushFindRecipientStatusesQueue,v._throttled_flushSetMessageStatusesQueue=v.config.flushSetMessageStatusInterval?(0,je.default)(v.__flushSetMessageStatusesQueue,v.config.flushSetMessageStatusInterval,{leading:!1}):v.__flushSetMessageStatusesQueue,v}t.default=Je,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function x(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=x(t[0],n);return t.every(function(e){return x(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return x(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+x(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function _(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=_(t[0],n);return t.every(function(e){return _(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return _(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,w.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+_(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y=r(n(3)),h=r(n(8)),g=r(n(11)),k=r(n(21)),A=r(n(23)),T=r(n(12)),I=r(n(13)),v=r(n(29)),m=r(n(28)),O=r(n(10)),b=r(n(20)),w=r(n(7)),E=r(n(9)),j=r(n(15)),S=r(n(4)),R=r(n(1)),M=r(n(2)),z=r(n(6)),G=r(n(5)),C=r(n(210)),P=r(n(55)),V=r(n(58)),N=r(n(24)),U=r(n(14)),F=r(n(17)),L=n(18),$=n(22),D=(o=(0,L.decorator)(),i=(0,L.decorator)(),u=U.default,(0,G.default)(B,u),(0,M.default)(B,[{key:"fullUpdate",value:(p=(0,E.default)(O.default.mark(function e(t,n,r){return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+_(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+_(n));case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(r));e.next=6;break;case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+x(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "entireData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+x(n));case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(r));e.next=12;break;case 12:if(r){e.next=14;break}throw new F.default.ValidationError("organizationId","required");case 14:if(0<this.host.config.maxMetadataKeyCount&&(0,w.default)(n).length>this.host.config.maxMetadataKeyCount)throw new F.default.ValidationError("entireData","invalid","Total number of metadata keys is "+(0,w.default)(n)+" and should not exceed "+this.host.config.maxMetadataKeyCount);e.next=16;break;case 16:return this.host.requireUser(),t=this._resolveModelId(t),e.prev=18,e.next=21,this.host.api.metadata.update(t,n,r);case 21:return this.__injectMetadata(t,r,n),e.abrupt("return",n);case 25:if(e.prev=25,e.t0=e.catch(18),e.t0.response&&404===e.t0.response.status)throw new F.default.NotFoundError("metadata",t);e.next=31;break;case 31:return e.abrupt("return",b.default.reject(e.t0));case 32:case"end":return e.stop()}},e,this,[[18,25]])})),function(e,t,n){return p.apply(this,arguments)})},{key:"update",value:(f=(0,E.default)(O.default.mark(function e(t,n,r){var a,o;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+_(t));case 2:if(n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+_(n));case 4:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(r));e.next=6;break;case 6:if("string"==typeof t||t instanceof Object){e.next=8;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+x(t));case 8:if(n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "partialData" violates contract.\n\nExpected:\nObject\n\nGot:\n'+x(n));case 10:if("string"!=typeof r)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(r));e.next=12;break;case 12:if(r){e.next=14;break}throw new F.default.ValidationError("organizationId","required");case 14:return e.next=16,this.find(t,r,{bypassCache:!0});case 16:return a=e.sent,o=(0,m.default)({},a,n),e.abrupt("return",this.fullUpdate(t,o,r));case 19:case"end":return e.stop()}},e,this)})),function(e,t,n){return f.apply(this,arguments)})},{key:"find",value:(d=(0,E.default)(O.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+_(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+x(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new F.default.ValidationError("organizationId","required");case 10:if(a=(0,N.default)(a,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),t=this._resolveModelId(t),r=void 0,a.bypassCache){e.next=18;break}if(r=this.get(t,n))return e.abrupt("return",r);e.next=18;break;case 18:return e.prev=18,e.next=21,this.host.api.metadata.find(t,n);case 21:return r=e.sent,this.__injectMetadata(t,n,r),e.abrupt("return",r);case 26:if(e.prev=26,e.t0=e.catch(18),!e.t0.response||404!==e.t0.response.status){e.next=33;break}if(a.ignoreNotFound){e.next=31;break}throw new F.default.NotFoundError("metadata",t);case 31:e.next=34;break;case 33:return e.abrupt("return",b.default.reject(e.t0));case 34:case"end":return e.stop()}},e,this,[[18,26]])})),function(e,t){return d.apply(this,arguments)})},{key:"findMulti",value:(l=(0,E.default)(O.default.mark(function e(t,n){var r,a,o,i,s=this,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+_(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+x(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:if(n){e.next=10;break}throw new F.default.ValidationError("organizationId","required");case 10:return this.host.requireUser(),t=(0,V.default)((0,$.arrayWrap)(t).map(this._resolveModelId)),r=(0,P.default)(t,20),a=r.map(function(e){return s.__findMultiPaged(e,n,u)}),e.next=16,b.default.all(a);case 16:return o=e.sent,i=C.default.apply(void 0,[{}].concat((0,v.default)(o))),e.abrupt("return",i);case 19:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"__findMultiPaged",value:(c=(0,E.default)(O.default.mark(function e(t,n){var r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+_(t));case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(n));e.next=4;break;case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nstring[]\n\nGot:\n'+x(t));case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(n));e.next=8;break;case 8:return e.next=10,this.host.api.entities.findMulti({users:[],metadata:t,organizationId:n});case 10:if(r=e.sent,a=r.metadata,o={},!a||"function"!=typeof a[I.default]&&!Array.isArray(a))throw new TypeError("Expected allMetadata to be iterable, got "+x(a));e.next=15;break;case 15:if(!a||"function"!=typeof a[I.default]&&!Array.isArray(a))throw new TypeError("Expected allMetadata to be iterable, got "+_(a));e.next=17;break;case 17:s=!(i=!0),u=void 0,e.prev=20,c=(0,T.default)(a);case 22:if(i=(l=c.next()).done){e.next=60;break}if(d=l.value,!(v=(0,A.default)(d))||"function"!=typeof v[I.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries to be iterable, got "+x(v));e.next=27;break;case 27:if(!v||"function"!=typeof v[I.default]&&!Array.isArray(v))throw new TypeError("Expected _Object$entries to be iterable, got "+_(v));e.next=29;break;case 29:p=!(f=!0),y=void 0,e.prev=32,h=(0,T.default)(v);case 34:if(f=(g=h.next()).done){e.next=43;break}if(m=(0,k.default)(g.value,2),b=m[0],w=m[1]){e.next=38;break}return e.abrupt("continue",40);case 38:E=this.__injectMetadata(b,n,w),o[b]=E;case 40:f=!0,e.next=34;break;case 43:e.next=49;break;case 45:e.prev=45,e.t0=e.catch(32),p=!0,y=e.t0;case 49:e.prev=49,e.prev=50,!f&&h.return&&h.return();case 52:if(e.prev=52,p)throw y;e.next=55;break;case 55:return e.finish(52);case 56:return e.finish(49);case 57:i=!0,e.next=22;break;case 60:e.next=66;break;case 62:e.prev=62,e.t1=e.catch(20),s=!0,u=e.t1;case 66:e.prev=66,e.prev=67,!i&&c.return&&c.return();case 69:if(e.prev=69,s)throw u;e.next=72;break;case 72:return e.finish(69);case 73:return e.finish(66);case 74:return e.abrupt("return",o);case 75:case"end":return e.stop()}},e,this,[[20,62,66,74],[32,45,49,57],[50,,52,56],[67,,69,73]])})),function(e,t){return c.apply(this,arguments)})},{key:"get",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));var n="metadata:"+e+":"+t;return this.host.models.Metadata.get(n)||null}},{key:"__injectMetadata",value:function(e,t,n){if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+_(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+_(n));if("string"!=typeof e)throw new TypeError('Value of argument "entityId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(e));if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+x(t));if(!(n instanceof Object))throw new TypeError('Value of argument "data" violates contract.\n\nExpected:\nObject\n\nGot:\n'+x(n));var r="metadata:"+e+":"+t;return this.host.models.Metadata.inject({id:r,data:n,entityId:e,organizationId:t})}}]),a((s=B).prototype,"find",[o],(0,g.default)(s.prototype,"find"),s.prototype),a(s.prototype,"findMulti",[i],(0,g.default)(s.prototype,"findMulti"),s.prototype),s);function B(){var e,t,n,r;(0,R.default)(this,B);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=n=(0,z.default)(this,(e=B.__proto__||(0,S.default)(B)).call.apply(e,[this].concat(o))),n.__parseMessageMetadata=function(e){var t=e.mimetype,n=e.payload,r=t.indexOf(";");if(-1<r&&(t=t.slice(0,r)),"application/json"!==t||"string"!=typeof n)return e;var a=void 0;try{a=JSON.parse(n)}catch(t){return console.warn("Invalid metadata payload",e),null}return(0,j.default)({},e,{payload:a})},r=t,(0,z.default)(n,r)}t.default=D,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function y(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=y(t[0],n);return t.every(function(e){return y(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return y(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,M.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+y(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function h(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,w.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=h(t[0],n);return t.every(function(e){return h(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return h(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,M.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,b.default)(e))+": "+h(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,g,v,m,b=r(n(3)),w=r(n(8)),E=r(n(11)),x=r(n(10)),_=r(n(32)),k=r(n(12)),A=r(n(13)),T=r(n(9)),I=r(n(4)),O=r(n(1)),j=r(n(2)),S=r(n(6)),R=r(n(5)),M=r(n(7)),z=r(n(198)),G=n(18),C=n(22),P=r(n(14)),V={account:"user",group:"group"},N=new z.default((0,M.default)(V)),U=(a=(0,G.decorator)(),f=P.default,(0,R.default)(F,f),(0,j.default)(F,[{key:"mounted",value:function(){this._fetched=!1,this._muteEntriesByConversationHandle={}}},{key:"dispose",value:function(){this._fetched=!1,this._muteEntriesByConversationHandle=null}},{key:"findAll",value:(m=(0,T.default)(x.default.mark(function e(){var t,n,r,a,o,i,s,u,c,l;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetched){e.next=37;break}return e.next=3,this.host.api.mute.findAll();case 3:if(!(t=e.sent)||"function"!=typeof t[A.default]&&!Array.isArray(t))throw new TypeError("Expected muteEntries to be iterable, got "+y(t));e.next=6;break;case 6:if(!t||"function"!=typeof t[A.default]&&!Array.isArray(t))throw new TypeError("Expected muteEntries to be iterable, got "+h(t));e.next=8;break;case 8:r=!(n=!0),a=void 0,e.prev=11,o=(0,k.default)(t);case 13:if(n=(i=o.next()).done){e.next=22;break}if(s=i.value,N.has(s.sender_type)){e.next=17;break}return e.abrupt("continue",19);case 17:u=this._parseMuteEntry(s),c=u.conversationId,l=u.entry,this._addEntry(c,l);case 19:n=!0,e.next=13;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(11),r=!0,a=e.t0;case 28:e.prev=28,e.prev=29,!n&&o.return&&o.return();case 31:if(e.prev=31,r)throw a;e.next=34;break;case 34:return e.finish(31);case 35:return e.finish(28);case 36:this._fetched=!0;case 37:return e.abrupt("return",(0,_.default)(this._muteEntriesByConversationHandle));case 38:case"end":return e.stop()}},e,this,[[11,24,28,36],[29,,31,35]])})),function(){return m.apply(this,arguments)})},{key:"_removeAllEntries",value:function(){if(this.config.condensedReplays){if(!(o=this.host.conversations.getAll())||"function"!=typeof o[A.default]&&!Array.isArray(o))throw new TypeError("Expected _host$conversations$g to be iterable, got "+y(o));if(!o||"function"!=typeof o[A.default]&&!Array.isArray(o))throw new TypeError("Expected _host$conversations$g to be iterable, got "+h(o));var e=!0,t=!1,n=void 0;try{for(var r,a=(0,k.default)(o);!(e=(r=a.next()).done);e=!0){var o,i=r.value;i.muted&&this._removeEntry(i.id)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}}else{if(!(f=(0,M.default)(this._muteEntriesByConversationHandle))||"function"!=typeof f[A.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$keys to be iterable, got "+y(f));if(!f||"function"!=typeof f[A.default]&&!Array.isArray(f))throw new TypeError("Expected _Object$keys to be iterable, got "+h(f));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,k.default)(f);!(s=(l=d.next()).done);s=!0){var f,p=l.value;this._removeEntry(p)}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}}},{key:"_getByConversationHandle",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "conversationHandle" violates contract.\n\nExpected:\nstring\n\nGot:\n'+h(e));if("string"!=typeof e)throw new TypeError('Value of argument "conversationHandle" violates contract.\n\nExpected:\nstring\n\nGot:\n'+y(e));var t=this._muteEntriesByConversationHandle[e];return t?t.expiresAt<Date.now()?(delete this._muteEntriesByConversationHandle[e],null):t:null}},{key:"unmuteAll",value:(v=(0,T.default)(x.default.mark(function e(){return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.mute.unmuteAll();case 2:this._removeAllEntries();case 3:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"muteConversation",value:(g=(0,T.default)(x.default.mark(function e(t,n){var r,a,o,i;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+h(t));case 2:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+h(n));e.next=4;break;case 4:if("string"==typeof t||t instanceof Object){e.next=6;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+y(t));case 6:if("number"!=typeof n)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+y(n));e.next=8;break;case 8:if(this.__validateDurationInMinutes(n),r=this._resolveEntity(t,"conversation")){e.next=12;break}throw new Error("conversation "+t+" not found");case 12:if(t=r.id,a=r.counterPartyId,o=r.counterPartyType,i=r.organizationId,"user"===o)return e.next=17,this.host.api.mute.muteUser(a,n,i,{recipientOrganizationId:i});e.next=20;break;case 17:this._addEntry(t,{durationInMinutes:n,organizationId:i}),e.next=24;break;case 20:if("group"===o)return e.next=23,this.host.api.mute.muteGroup(a,n,i);e.next=24;break;case 23:this._addEntry(t,{durationInMinutes:n,organizationId:i});case 24:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"unmuteConversation",value:(p=(0,T.default)(x.default.mark(function e(t){var n,r,a,o;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+h(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "conversationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+y(t));case 4:if(n=this._resolveEntity(t,"conversation")){e.next=7;break}throw new Error("conversation "+t+" not found");case 7:if(t=n.id,r=n.counterPartyId,a=n.counterPartyType,o=n.organizationId,"user"===a)return e.next=12,this.host.api.mute.unmuteUser(r,o,{recipientOrganizationId:o});e.next=15;break;case 12:this._removeEntry(t),e.next=19;break;case 15:if("group"===a)return e.next=18,this.host.api.mute.unmuteGroup(r,o);e.next=19;break;case 18:this._removeEntry(t);case 19:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"reactToMuteEvent",value:function(e){var t=e.data;if((t=(0,C.jsonCloneDeep)(t)).token===this.host.currentUser.id){var n=t.action;if("clear"===n)return void this._removeAllEntries();var r=this._parseMuteEntry(t),a=r.conversationId,o=r.entry;"add"===n?this._addEntry(a,o):this._removeEntry(a)}}},{key:"getById",value:function(e){return e.startsWith("mute:")||(e="mute:"+e),this.host.models.Mute.get(e)}},{key:"__validateDurationInMinutes",value:function(e){if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+h(e));if("number"!=typeof e)throw new TypeError('Value of argument "durationInMinutes" violates contract.\n\nExpected:\nnumber\n\nGot:\n'+y(e));(e<0||525600<e||e%1!=0)&&C.Validator.raise("durationInMinutes","invalid","should be a positive integer from 1 to 525600 (1 year)")}}]),i=(o=F).prototype,s="findAll",u=[a],c=(0,E.default)(o.prototype,"findAll"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function F(){var e,t,c,n;(0,O.default)(this,F);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=c=(0,S.default)(this,(e=F.__proto__||(0,I.default)(F)).call.apply(e,[this].concat(a))),c._parseMuteEntry=function(e){var t=+e.mute_duration,n=e.mute_start,r=e.caller_organization||e.organization_id;n=n&&1e3*+n;var a=void 0;if(c.config.condensedReplays)a=e.conversation_id;else{var o=V[e.sender_type],i=e.sender_token;a=c.host.conversations.getConversationKey(o,i,r)}return{conversationId:a,entry:{durationInMinutes:t,organizationId:r,startedAt:n}}},c._addEntry=function(e,t){var n=t.durationInMinutes,r=t.organizationId,a=t.startedAt,o=void 0===a?Date.now():a,i=+o+60*n*1e3;if(!(i<Date.now())){var s=c.host.models.Mute.inject({id:"mute:"+e,conversationId:e,durationInMinutes:n,expiresAt:i,organizationId:r,startedAt:o});if(c.config.condensedReplays){var u=c.host.conversations.getById(e);if(!u)return s;u.muted=s,c.host.models.Conversation.inject(u)}else c._muteEntriesByConversationHandle[e]=s,c.host.models.Conversation.touch(e);return s}},c._removeEntry=function(e){c.config.condensedReplays||delete c._muteEntriesByConversationHandle[e];var t=c.host.conversations.getById(e);t&&t.muted&&(c.host.models.Mute.eject(t.muted),t.muted=null,c.host.models.Conversation.inject(t))},n=t,(0,S.default)(c,n)}t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=r(n(31)),i=r(n(4)),s=r(n(1)),u=r(n(2)),c=r(n(6)),l=r(n(5)),d=r(n(42)),f=r(n(14)),p=(a=f.default,(0,l.default)(y,a),(0,u.default)(y,[{key:"emit",value:function(e){this.EVENTS[e.type]?this.EVENTS[e.type].call(this,e):this.logger.info("unhandled event: "+e.type,e.data)}}]),y);function y(e,t){var n;(0,s.default)(this,y);var r=(0,c.default)(this,(y.__proto__||(0,i.default)(y)).call(this,e,t));r.EVENTS=(n={},(0,o.default)(n,"message|group_message",function(e){this.host.notifications.reactToMessageEvent(e)}),(0,o.default)(n,"message:status|group:message:status",function(e){this.host.notifications.reactToMessageStatusEvent(e)}),(0,o.default)(n,"remote_wipe",function(e){this.host.notifications.disconnect(),this.host.notifications.signOut({fromServer:!0})}),(0,o.default)(n,"sse:heartbeat",function(){return null}),n);var a=[];return(0,d.default)(r.EVENTS,function(t,e){e.includes("|")&&(a.push(e),e.split("|").forEach(function(e){return r.EVENTS[e]=t}))}),a.forEach(function(e){return delete r.EVENTS[e]}),r}t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b=r(n(11)),w=r(n(20)),E=r(n(10)),x=r(n(9)),_=r(n(15)),k=r(n(4)),A=r(n(1)),T=r(n(2)),I=r(n(6)),O=r(n(5)),j=n(18),S=r(n(61)),R=r(n(17)),M=r(n(81)),z=r(n(14)),G=r(n(78)),C=(a=(0,j.decorator)({serializeArguments:function(e){return""}}),y=z.default,(0,O.default)(P,y),(0,T.default)(P,[{key:"mounted",value:function(){this.events.mounted(),this.events.on("connected",this._emitConnected),this.events.on("disconnected",this._emitDisconnected),this.events.on("event",this._emitEvent)}},{key:"dispose",value:function(){this.events.removeListener("connected",this._emitConnected),this.events.removeListener("disconnected",this._emitDisconnected),this.events.removeListener("event",this._emitEvent),this.events.dispose()}},{key:"signIn",value:(m=(0,x.default)(E.default.mark(function e(){var t,n,r;return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.host.getAuth())&&t.key&&t.secret){e.next=3;break}throw new R.default.RequiresBasicAuthError;case 3:if(this.emit("signingIn"),this.events.isSignedIn){e.next=9;break}return e.next=7,this.host.api.notifications.signIn(t.key,t.secret);case 7:n=e.sent,this.events.setAuth(n);case 9:return r=this.events.getAuth(),this.emit("signedIn",r),e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"signOut",value:(v=(0,x.default)(E.default.mark(function e(){var t,n,r=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).fromServer,a=void 0!==r&&r;return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.events.getAuth()){e.next=3;break}return e.abrupt("return",!1);case 3:return this.emit("signingOut",{fromServer:a}),n=void 0,e.prev=5,e.next=8,this.host.api.notifications.signOut(t.key,t.secret);case 8:n=!0,e.next=22;break;case 11:if(e.prev=11,e.t0=e.catch(5),!this.httpClient.isUnauthorizedError(e.t0)){e.next=17;break}n=!0,e.next=22;break;case 17:if(!a){e.next=21;break}this.logger.error("error while logging out of desktop notifications",e.t0,e.t0.stack),e.next=22;break;case 21:return e.abrupt("return",w.default.reject(e.t0));case 22:return n&&this.events.removeAuth(),this.emit("signedOut",{fromServer:a,signedOut:n}),e.abrupt("return",n);case 25:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return v.apply(this,arguments)})},{key:"authenticate",value:(g=(0,x.default)(E.default.mark(function e(t,n){return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.events.setAuth({key:t,secret:n});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"connect",value:(h=(0,x.default)(E.default.mark(function e(){return E.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.events.connect();case 2:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"disconnect",value:function(){return this.events.disconnect()}},{key:"reconnect",value:function(){return this.events.reconnect()}},{key:"reactToMessageEvent",value:function(e){var t=e.data;t=(0,M.default)(t);var n=this.host.models.Message.createInstance((0,_.default)({},t,{id:S.default.v4()}));this.emit("unread:change",n.unreadMessageCount),this.emit("message",n)}},{key:"reactToMessageStatusEvent",value:function(e){this.emit("unread:change",e.unread_message_count)}},{key:"isSignedIn",get:function(){return this.events.isSignedIn}},{key:"isConnected",get:function(){return this.events.isConnected}}]),i=P,s=function(){var t=this;this._emitConnected=function(){t.emit("connected")},this._emitDisconnected=function(e){t.emit("disconnected",e)},this._emitEvent=function(e){t.emit("event",e)}},u=(o=i).prototype,c="signOut",l=[a],d=(0,b.default)(o.prototype,"signOut"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(u,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(u,c,p),p=null),o);function P(e,t){(0,A.default)(this,P);var n=(0,I.default)(this,(P.__proto__||(0,k.default)(P)).call(this,e,t));return s.call(n),n.events=new G.default(e,(0,_.default)({},t,{endpointType:"simpleNotifications"})),n}t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function b(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=b(t[0],n);return t.every(function(e){return b(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return b(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+b(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function w(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,_.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=w(t[0],n);return t.every(function(e){return w(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return w(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,x.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,E.default)(e))+": "+w(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,m,E=r(n(3)),x=r(n(7)),_=r(n(8)),k=r(n(11)),A=r(n(21)),T=r(n(23)),I=r(n(15)),O=r(n(10)),j=r(n(9)),S=r(n(12)),R=r(n(29)),M=r(n(13)),z=r(n(4)),G=r(n(1)),C=r(n(2)),P=r(n(6)),V=r(n(5)),N=r(n(24)),U=r(n(236)),F=r(n(214)),L=r(n(14)),$=n(18),D=r(n(17)),B=r(n(92)),q=r(n(50)),Z=(o=(0,$.decorator)(),i=(0,$.decorator)(),s=(0,$.decorator)({memoize:!0}),u=(0,$.decorator)(),l=L.default,(0,V.default)(K,l),(0,C.default)(K,[{key:"mounted",value:function(){this._deferConversationChanges=!1,this._lastMyRoles=[],this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onChangeConversation),this.host.models.User.on("afterInject",this._onChangeUser)}},{key:"dispose",value:function(){this._deferConversationChanges=!1,this._lastMyRoles=[],this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onChangeConversation),this.host.models.User.removeListener("afterInject",this._onChangeUser),$.decorator.clear(this._findAll)}},{key:"create",value:(m=(0,j.default)(O.default.mark(function e(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{allowPublicGroups:void 0,autologoutTime:void 0,deleteOnRead:void 0,groupLifespan:void 0,lifecycleCallback:void 0,name:void 0,pinLock:void 0,settingsRestricted:void 0,ttl:void 0,welcomeEmailSettings:void 0};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.abrupt("return",this.httpClient.post("/v2/organization",{data:r}).then(function(e){var t=e.getHeader("TT-X-Organization-Key");return n.host.models.Organization.inject({id:t,name:r.name})}));case 2:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"update",value:(v=(0,j.default)(O.default.mark(function e(){var t,n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{allowPublicGroups:void 0,autologoutTime:void 0,autoSendWelcomeEmail:void 0,deleteOnRead:void 0,groupLifespan:void 0,id:void 0,lifecycleCallback:void 0,name:void 0,pinLock:void 0,settingsRestricted:void 0,ttl:void 0,welcomeEmailLogo:void 0,welcomeEmailSettings:void 0};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),t=q.default.underscoreObject({allowPublicGroups:r.allowPublicGroups,autologoutTime:r.autologoutTime,autoSendWelcomeEmail:r.autoSendWelcomeEmail,dor:r.deleteOnRead,groupLifespan:r.groupLifespan,lifecycleCallback:r.lifecycleCallback,name:r.name,pinLock:r.pinLock,settingsRestricted:r.settingsRestricted,ttl:r.ttl,welcomeEmailLogo:r.welcomeEmailLogo,welcomeEmailSettings:r.welcomeEmailSettings}),e.abrupt("return",this.httpClient.post("/v2/organization/:id",{urlParams:{id:r.id},data:t}).then(function(e){return n.host.models.Organization.inject((0,I.default)({id:r.id},t))}));case 3:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"findAll",value:(g=(0,j.default)(O.default.mark(function e(){var t,n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{onlyApproved:!1};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.next=3,this._findAll();case 3:return t=e.sent,e.next=6,this.host.userRoles.findAll();case 6:return r.onlyApproved&&(t=(0,F.default)(t,{pending:!1})),(t=(0,U.default)(t,function(e){return e.name.toLowerCase()})).forEach(function(e){return n.__reloadConversations(e)}),e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"refreshAll",value:(h=(0,j.default)(O.default.mark(function e(){var t;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $.decorator.clear(this._findAll),e.next=3,this._findAll();case 3:return t=e.sent,e.next=6,this.host.userRoles.refreshAll();case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"_findAll",value:(y=(0,j.default)(O.default.mark(function e(){var t,n,r,a,o,i,s,u,c;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.organizations.findAllOfUser(this.host.currentUserId);case 2:if(t=e.sent,n=[],!t||"function"!=typeof t[M.default]&&!Array.isArray(t))throw new TypeError("Expected items to be iterable, got "+b(t));e.next=6;break;case 6:if(!t||"function"!=typeof t[M.default]&&!Array.isArray(t))throw new TypeError("Expected items to be iterable, got "+w(t));e.next=8;break;case 8:for(a=!(r=!0),o=void 0,e.prev=11,i=(0,S.default)(t);!(r=(s=i.next()).done);r=!0)u=s.value,c=this.host.models.Organization.inject(u),this.host.models.Organization.removePlaceholder({entity:c,attrs:u}),n.push(c);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),a=!0,o=e.t0;case 19:e.prev=19,e.prev=20,!r&&i.return&&i.return();case 22:if(e.prev=22,a)throw o;e.next=25;break;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return",n);case 28:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])})),function(){return y.apply(this,arguments)})},{key:"find",value:(p=(0,j.default)(O.default.mark(function e(t){var n,r,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e.next=4;break;case 4:if(a=(0,N.default)(a,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=void 0,a.bypassCache){e.next=11;break}if((n=this.host.models.Organization.get(t))&&!n.$placeholder)return e.abrupt("return",n);e.next=11;break;case 11:return e.next=13,this.host.api.organizations.find(this.host.currentUserId,t);case 13:return r=e.sent,e.next=16,this.host.userRoles.findAll({organizationId:t});case 16:if(!r){e.next=21;break}n=this.host.models.Organization.inject(r),this.__reloadConversations(n),e.next=23;break;case 21:if(a.ignoreNotFound){e.next=23;break}throw new D.default.NotFoundError(this.host.models.Organization.name,t);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"_getAllowedSenders",value:function(e){var t=e.id,n=[],r=this.host.currentUser;if(r){var a=r.roles;if(!a||"function"!=typeof a[M.default]&&!Array.isArray(a))throw new TypeError("Expected currentRoles to be iterable, got "+b(a));if(!a||"function"!=typeof a[M.default]&&!Array.isArray(a))throw new TypeError("Expected currentRoles to be iterable, got "+w(a));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,S.default)(a);!(o=(u=c.next()).done);o=!0){var l=u.value;l.organizationId===t&&n.push(l)}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}n.push(r)}return n}},{key:"getPendingEulas",value:(f=(0,j.default)(O.default.mark(function e(){var t,n;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findAll();case 2:return t=e.sent,n=t.filter(function(e){return e.eulaEnabled&&!e.isEulaAccepted}).reduce(function(e,t){var n=t.id,r=t.eulaUrl;return e[r]?e[r].push(n):e[r]=[n],e},{}),e.abrupt("return",(0,T.default)(n).map(function(e){var t=(0,A.default)(e,2);return{url:t[0],organizationIds:t[1]}}));case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"findEulaContent",value:(d=(0,j.default)(O.default.mark(function e(t){var n;return O.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.replace("http://","https://"),e.next=3,this.httpClient.get(t,{withCredentials:!1,withHeaders:!1,resFormat:"text"});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"getSettingValue",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(t));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(e));if("string"!=typeof t)throw new TypeError('Value of argument "key" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(t));e=this._resolveModelId(e);var n=this.getById(e);return n?n.getSettingValue(t):null}},{key:"getAll",value:function(){return this.host.models.Organization.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+w(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+b(e));return this.host.models.Organization.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+w(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+b(e));return this.host.models.Organization.getMulti(e)}},{key:"__reloadConversations",value:function(e){if(e){var t=e.conversations,n=0,r=0,a=0,o=0,i=0;if(!t||"function"!=typeof t[M.default]&&!Array.isArray(t))throw new TypeError("Expected conversations to be iterable, got "+b(t));if(!t||"function"!=typeof t[M.default]&&!Array.isArray(t))throw new TypeError("Expected conversations to be iterable, got "+w(t));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,S.default)(t);!(s=(l=d.next()).done);s=!0){var f=l.value,p=f.highestSortNumber,y=f.unreadCount,h=f.unreadPriorityCount,g=f.lastIncomingMessageSortNumber,v=f.shouldDisplay,m=f.metadata;v&&(n=Math.max(n,p),m&&"patient_messaging"===m.feature_service?(r+=y,o+=h):(a+=y,i+=h),!this.config.condensedReplays&&g&&(!e.lastIncomingMessageSortNumber||e.lastIncomingMessageSortNumber<g)&&(e.lastIncomingMessageSortNumber=g))}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}e.highestSortNumber=n,e.unreadCount=a+r,e.unreadPriorityCount=i+o,e.networks.provider.unreadCount=a,e.networks.provider.unreadPriorityCount=i,e.networks.patient.unreadCount=r,e.networks.patient.unreadPriorityCount=o,this.host.models.Organization.inject(e),e.emit("change")}}}]),a((c=K).prototype,"findAll",[o],(0,k.default)(c.prototype,"findAll"),c.prototype),a(c.prototype,"refreshAll",[i],(0,k.default)(c.prototype,"refreshAll"),c.prototype),a(c.prototype,"_findAll",[s],(0,k.default)(c.prototype,"_findAll"),c.prototype),a(c.prototype,"find",[u],(0,k.default)(c.prototype,"find"),c.prototype),c);function K(){var e,t,v,n;(0,G.default)(this,K);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=v=(0,P.default)(this,(e=K.__proto__||(0,z.default)(K)).call.apply(e,[this].concat(a))),v._onChangeConversation=function(e,t){var n=t.organization;n&&(v.host.currentlyServingOfflineMessages||v._deferConversationChanges||v.__reloadConversations(n))},v._onChangeUser=function(e,t){var n=t.id,r=v.host.models.Organization.getAll();if(!r||"function"!=typeof r[M.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+b(r));if(!r||"function"!=typeof r[M.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+w(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,S.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value;c.autoForwardReceiverId===n&&c.autoForwardReceiver!==t&&v.host.models.Organization.inject(c)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}if(t===v.host.currentUser&&!v.host.currentlyServingOfflineMessages&&!v._deferConversationChanges){var l=v.host.currentUser.roles;if(!(0,B.default)(l,v._lastMyRoles)){if(v._lastMyRoles=[].concat((0,R.default)(l)),!r||"function"!=typeof r[M.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+b(r));if(!r||"function"!=typeof r[M.default]&&!Array.isArray(r))throw new TypeError("Expected allOrganizations to be iterable, got "+w(r));var d=!0,f=!1,p=void 0;try{for(var y,h=(0,S.default)(r);!(d=(y=h.next()).done);d=!0){var g=y.value;(0,B.default)(g.allowedSenders,v._getAllowedSenders(g))||v.host.models.Organization.inject(g)}}catch(e){f=!0,p=e}finally{try{!d&&h.return&&h.return()}finally{if(f)throw p}}}}},n=t,(0,P.default)(v,n)}t.default=Z,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o=r(n(4)),i=r(n(1)),s=r(n(2)),u=r(n(6)),c=r(n(5)),l=r(n(14)),d=n(26),f=(a=l.default,(0,c.default)(p,a),(0,s.default)(p,[{key:"mounted",value:function(){this._data={}}},{key:"dispose",value:function(){this._data=null}},{key:"reactToPresenceEvent",value:function(e){var t=e.data;this.set(t.from,d.PresenceStatus.resolve(t.type))}},{key:"set",value:function(e,t){if(this._data[e]!==t){this._data[e]=t;var n=this.host.models.User.inject({id:e,presence:t});this.emit("change",{presence:t,user:n,userId:e})}}},{key:"get",value:function(e){return e===this.host.currentUserId?d.PresenceStatus.AVAILABLE:this._data[e]||d.PresenceStatus.UNKNOWN}}]),p);function p(e,t){return(0,i.default)(this,p),(0,u.default)(this,(p.__proto__||(0,o.default)(p)).call(this,e,t))}t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function k(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=k(t[0],n);return t.every(function(e){return k(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return k(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+k(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function A(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,p.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=A(t[0],n);return t.every(function(e){return A(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return A(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+A(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d=r(n(3)),f=r(n(7)),p=r(n(8)),y=r(n(11)),h=r(n(10)),g=r(n(9)),T=r(n(21)),I=r(n(12)),O=r(n(23)),j=r(n(13)),v=r(n(4)),m=r(n(1)),b=r(n(2)),w=r(n(6)),E=r(n(5)),x=n(18),S=r(n(92)),_=r(n(14)),R=(o=(0,x.decorator)(),i=(0,x.decorator)(),u=_.default,(0,E.default)(M,u),(0,b.default)(M,[{key:"mounted",value:function(){this.host.models.Organization.on("afterInject",this._onChangeOrganization),this.host.models.Organization.on("afterEject",this._onChangeOrganization)}},{key:"dispose",value:function(){this.host.models.Organization.removeListener("afterInject",this._onChangeOrganization),this.host.models.Organization.removeListener("afterEject",this._onChangeOrganization)}},{key:"findAll",value:(l=(0,g.default)(h.default.mark(function e(){return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.findAll();case 2:return e.abrupt("return",this.getAll());case 3:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"refreshAll",value:(c=(0,g.default)(h.default.mark(function e(){return h.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.refreshAll();case 2:return e.abrupt("return",this.getAll());case 3:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"getAll",value:function(){return this.host.models.Product.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+A(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+k(e));return this.host.models.Product.get(e)}}]),a((s=M).prototype,"findAll",[o],(0,y.default)(s.prototype,"findAll"),s.prototype),a(s.prototype,"refreshAll",[i],(0,y.default)(s.prototype,"refreshAll"),s.prototype),s);function M(){var e,t,_,n;(0,m.default)(this,M);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=_=(0,w.default)(this,(e=M.__proto__||(0,v.default)(M)).call.apply(e,[this].concat(a))),_._addProcessingEvent=function(e){var t=_.host.models.Product.getAll()[0];t&&(t.activeProcessingEvents.push(e),_.host.models.Product.inject(t),_.emit("processing:start",e))},_._removeProcessingEvent=function(e){var t=_.host.models.Product.getAll()[0];if(t){for(var n=t.activeProcessingEvents,r=e.actionType,a=e.entity,o=n.length-1;0<=o;o--){var i=n[o];if(r===i.actionType&&a.id===i.entity.id){n.splice(o,1);break}}_.host.models.Product.inject(t),_.emit("processing:stop",e)}},_._onChangeOrganization=function(e,t){var n=_.host.models.Product.getAll()[0];if(n){var r=_.host.models.Organization.getAll();if(0!==r.length){var a={organizations:r},o=0,i=0;if(!r||"function"!=typeof r[j.default]&&!Array.isArray(r))throw new TypeError("Expected organizations to be iterable, got "+k(r));if(!r||"function"!=typeof r[j.default]&&!Array.isArray(r))throw new TypeError("Expected organizations to be iterable, got "+A(r));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,I.default)(r);!(s=(l=d.next()).done);s=!0){var f=l.value;f.$placeholder||(o+=f.unreadCount,i+=f.unreadPriorityCount)}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}a.unreadCount=o,a.unreadPriorityCount=i;var p=!1;if(!(b=(0,O.default)(a))||"function"!=typeof b[j.default]&&!Array.isArray(b))throw new TypeError("Expected _Object$entries to be iterable, got "+k(b));if(!b||"function"!=typeof b[j.default]&&!Array.isArray(b))throw new TypeError("Expected _Object$entries to be iterable, got "+A(b));var y=!0,h=!1,g=void 0;try{for(var v,m=(0,I.default)(b);!(y=(v=m.next()).done);y=!0){var b,w=(0,T.default)(v.value,2),E=w[0],x=w[1];(0,S.default)(n[E],x)||(n[E]=x,p=!0)}}catch(e){h=!0,g=e}finally{try{!y&&m.return&&m.return()}finally{if(h)throw g}}p&&_.host.models.Product.inject(n)}}},n=t,(0,w.default)(_,n)}t.default=R,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function u(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,b.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=u(t[0],n);return t.every(function(e){return u(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return u(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,m.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,v.default)(e))+": "+u(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,c,l,d,f,p,y,h,g,v=r(n(3)),m=r(n(7)),b=r(n(8)),w=r(n(11)),E=r(n(15)),x=r(n(10)),_=r(n(20)),k=r(n(9)),A=r(n(4)),T=r(n(1)),I=r(n(2)),O=r(n(6)),j=r(n(5)),S=r(n(218)),R=r(n(24)),M=n(18),z=n(22),G=r(n(17)),C=r(n(14)),P=(a=(0,M.decorator)(),y=C.default,(0,j.default)(V,y),(0,I.default)(V,[{key:"findAll",value:(g=(0,k.default)(x.default.mark(function e(){var t,n,r=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,R.default)(a,{ignoreNotFound:!0,bypassCache:!1}),0===(t=this.host.models.Organization.getAll()).length)return e.next=5,this.host.organizations.findAll();e.next=6;break;case 5:t=e.sent;case 6:return e.next=8,_.default.all(t.map(function(e){return r.findAllForOrganization(e.id,a)}));case 8:return n=e.sent,e.abrupt("return",(0,S.default)(n));case 10:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"findAllForOrganization",value:(h=(0,k.default)(x.default.mark(function e(n){var t,r,a,o=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof n||n instanceof Object){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+u(n));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+s(n));case 4:if(i=(0,R.default)(i,{ignoreNotFound:!0,bypassCache:!1}),n=this._resolveModelId(n),(t=this._resolveEntity(n)).rolesEnabled&&t.canAdminRoles){e.next=9;break}return e.abrupt("return",[]);case 9:return e.next=11,this.host.api.roleTags.findAll(n);case 11:if(r=e.sent){e.next=16;break}if(i.ignoreNotFound)return e.abrupt("return",[]);e.next=15;break;case 15:throw new G.default.NotFoundError("roleTags",n);case 16:return a=r.map(function(e){var t=n+":"+e.tag_id;return o.host.models.RoleTag.inject((0,E.default)({},e,{id:t,organizationId:n}))}),this.host.models.Organization.touch(n),e.abrupt("return",a);case 19:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"reactToUpdateEventCR",value:function(e){var t=e.data,n=t=(0,z.jsonCloneDeep)(t),r=n.entity,a=n.organization_id,o=r.color,i=r.display_name,s=r.token,u=o.color_id,c=o.color_value;return this.host.models.RoleTag.inject({color:u,colorValue:c,id:a+":"+s,name:i,organizationId:a,tagId:s})}},{key:"reactToUpdateEvent",value:function(e){var t=e.data;if(!this.config.condensedReplays){var n=t=(0,z.jsonCloneDeep)(t),r=n.color,a=n.display_name,o=n.organization_key,i=n.token,s=r.color_id,u=r.color_value;return this.host.models.RoleTag.inject({color:s,colorValue:u,id:o+":"+i,name:a,organizationId:o,tagId:i})}this.reactToUpdateEventCR({data:t})}},{key:"getAll",value:function(){return this.host.models.RoleTag.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+u(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));return this.host.models.RoleTag.get(e)}}]),i=(o=V).prototype,c="findAllForOrganization",l=[a],d=(0,w.default)(o.prototype,"findAllForOrganization"),f=o.prototype,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=l.slice().reverse().reduce(function(e,t){return t(i,c,e)||e},p),f&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(f):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(i,c,p),p=null),o);function V(){return(0,T.default)(this,V),(0,O.default)(this,(V.__proto__||(0,A.default)(V)).apply(this,arguments))}t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function L(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=L(t[0],n);return t.every(function(e){return L(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return L(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,S.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,R.default)(e))+": "+L(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function $(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,T.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=$(t[0],n);return t.every(function(e){return $(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return $(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,S.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,R.default)(e))+": "+$(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T=r(n(8)),I=r(n(11)),O=r(n(21)),j=r(n(33)),S=r(n(7)),R=r(n(3)),D=r(n(10)),B=r(n(20)),M=r(n(9)),q=r(n(12)),Z=r(n(13)),z=r(n(15)),G=r(n(4)),C=r(n(1)),P=r(n(2)),V=r(n(6)),N=r(n(5)),U=r(n(44)),F=r(n(24)),K=n(18),H=r(n(17)),W=r(n(49)),X=r(n(14)),Q=["role","user"],Y=(o=(0,K.decorator)(),i=(0,K.decorator)(),s=(0,K.decorator)(),u=(0,K.decorator)(),c=(0,K.decorator)(),l=(0,K.decorator)(),d=(0,K.decorator)(),f=(0,K.decorator)(),y=X.default,(0,N.default)(J,y),(0,P.default)(J,[{key:"mounted",value:function(){this._previouslyInRoles={},this._roleConversations={},this._roleP2PConversations={},this.host.models.Conversation.on("afterInject",this._onChangeConversation),this.host.models.Conversation.on("afterEject",this._onRemoveConversation)}},{key:"dispose",value:function(){this._previouslyInRoles={},this._roleConversations={},this._roleP2PConversations={},this.host.models.Conversation.removeListener("afterInject",this._onChangeConversation),this.host.models.Conversation.removeListener("afterEject",this._onRemoveConversation)}},{key:"createP2PGroup",value:(A=(0,M.default)(D.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M=this,z=t.metadata,G=t.name,C=t.organizationId,P=t.recipientId,V=t.replayHistory,N=void 0===V||V,U=t.senderId,F=void 0===U?this.host.currentUserId:U;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.requireUser(),P){e.next=3;break}throw new H.default.ValidationError("recipientId","required");case 3:if(C){e.next=5;break}throw new H.default.ValidationError("organizationId","required");case 5:if(n=this.host.currentUserId,a=[],"function"!=typeof(r=[F,P])[Z.default]&&!Array.isArray(r))throw new TypeError("Expected initialUserIds to be iterable, got "+L(r));e.next=10;break;case 10:if(!r||"function"!=typeof r[Z.default]&&!Array.isArray(r))throw new TypeError("Expected initialUserIds to be iterable, got "+$(r));e.next=12;break;case 12:for(i=!(o=!0),s=void 0,e.prev=15,u=(0,q.default)(r);!(o=(c=u.next()).done);o=!0)l=c.value,l=this.host.roles.__resolveRoleId(l),l=this._resolveModelIdWithTypes(l,"user"),a.includes(l)||a.push(l);e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),i=!0,s=e.t0;case 23:e.prev=23,e.prev=24,!o&&u.return&&u.return();case 26:if(e.prev=26,i)throw s;e.next=29;break;case 29:return e.finish(26);case 30:return e.finish(23);case 31:if(2!==a.length)throw new H.default.ValidationError("recipientId","same user as senderId");e.next=33;break;case 33:return e.next=35,B.default.all(a.map(function(e){return M.host.users.find(e,{organizationId:C})}));case 35:return d=e.sent,G=G||d.map(function(e){return e.isRoleBot?e.displayName:e.firstName}).filter(Boolean).join(", ")||"Group",e.next=39,this.host.api.roles.createP2PGroup({createdByUserId:F,memberIds:a,name:G,organizationId:C,replayHistory:N});case 39:if(f=e.sent,y=p=void 0,this.config.condensedReplays?(y=f.entity||f,p=f.conversation_id):y=f,!d||"function"!=typeof d[Z.default]&&!Array.isArray(d))throw new TypeError("Expected users to be iterable, got "+L(d));e.next=44;break;case 44:if(!d||"function"!=typeof d[Z.default]&&!Array.isArray(d))throw new TypeError("Expected users to be iterable, got "+$(d));e.next=46;break;case 46:g=!(h=!0),v=void 0,e.prev=49,m=(0,q.default)(d);case 51:if(h=(b=m.next()).done){e.next=85;break}if(w=b.value,E=w.botRole,w.isRoleBot&&E){e.next=56;break}return e.abrupt("continue",82);case 56:if(x=E.memberIds){e.next=59;break}return e.abrupt("continue",82);case 59:if(!x||"function"!=typeof x[Z.default]&&!Array.isArray(x))throw new TypeError("Expected botMemberIds to be iterable, got "+L(x));e.next=61;break;case 61:if(!x||"function"!=typeof x[Z.default]&&!Array.isArray(x))throw new TypeError("Expected botMemberIds to be iterable, got "+$(x));e.next=63;break;case 63:for(k=!(_=!0),A=void 0,e.prev=66,T=(0,q.default)(x);!(_=(I=T.next()).done);_=!0)O=I.value,a.includes(O)||a.push(O);e.next=74;break;case 70:e.prev=70,e.t1=e.catch(66),k=!0,A=e.t1;case 74:e.prev=74,e.prev=75,!_&&T.return&&T.return();case 77:if(e.prev=77,k)throw A;e.next=80;break;case 80:return e.finish(77);case 81:return e.finish(74);case 82:h=!0,e.next=51;break;case 85:e.next=91;break;case 87:e.prev=87,e.t2=e.catch(49),g=!0,v=e.t2;case 91:e.prev=91,e.prev=92,!h&&m.return&&m.return();case 94:if(e.prev=94,g)throw v;e.next=97;break;case 97:return e.finish(94);case 98:return e.finish(91);case 99:if(j=y.id||y.token,S=this.host.models.Group.get(j),R=void 0,R=S&&S.memberIds?S.memberIds:y.members=a,S=this.host.conversations.__injectCounterParty({conversationId:p,entityAttrs:y,entityType:"group",groupType:W.default.ROLE_P2P,hasCurrentUser:R.includes(n),isPlaceholder:!0,organizationId:C}),z)return e.next=107,this.host.metadata.update(S.id,z,C);e.next=107;break;case 107:return e.abrupt("return",S);case 108:case"end":return e.stop()}},e,this,[[15,19,23,31],[24,,26,30],[49,87,91,99],[66,70,74,82],[75,,77,81],[92,,94,98]])})),function(e){return A.apply(this,arguments)})},{key:"findAll",value:(k=(0,M.default)(D.default.mark(function e(){var t,n,r,a,o=this;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===(t=this.host.models.Organization.getAll()).length)return e.next=4,this.host.organizations.findAll();e.next=5;break;case 4:t=e.sent;case 5:if(0===(t=t.filter(function(e){return e.rolesEnabled})).length)return e.abrupt("return",[]);e.next=8;break;case 8:return e.next=10,this.host.search.query({types:["user"],organizationIds:t.map(function(e){return e.id}),query:{displayName:"",featureService:"role"},followContinuations:!0});case 10:return n=e.sent,r=n.results,a=r.map(function(e){return e.entity}),t.map(function(e){var t=e.id;return o.host.models.Organization.touch(t)}),e.abrupt("return",a);case 15:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)})},{key:"findByOrganizationId",value:(_=(0,M.default)(D.default.mark(function e(t){var n,r,a,o;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object){e.next=2;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(t));case 2:if("string"==typeof t||t instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+L(t));case 4:return t=this._resolveModelId(t),e.next=7,this.host.organizations.find(t);case 7:if((n=e.sent).rolesEnabled){e.next=10;break}return e.abrupt("return",[]);case 10:return e.next=12,this.host.search.query({types:["user"],organizationIds:n.id,query:{displayName:"",featureService:"role"},followContinuations:!0});case 12:return r=e.sent,a=r.results,o=a.map(function(e){return e.entity}),this.host.models.Organization.touch(t),e.abrupt("return",o);case 17:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"find",value:(x=(0,M.default)(D.default.mark(function e(t,n){var r,a,o,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=2;break;case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(n));case 4:if(i instanceof Object){e.next=6;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+$(i));case 6:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(t));e.next=8;break;case 8:if("string"==typeof n||n instanceof Object){e.next=10;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+L(n));case 10:if(i instanceof Object){e.next=12;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+L(i));case 12:if(this.host.requireUser(),i=(0,F.default)(i,{bypassCache:!1,ignoreNotFound:!1}),t=this.__resolveRoleId(t),n=this._resolveModelId(n),i.bypassCache){e.next=20;break}if(r=this.getById(t))return e.abrupt("return",r);e.next=20;break;case 20:return e.next=22,this.host.api.roles.find(t,n);case 22:if(a=e.sent){e.next=27;break}if(i.ignoreNotFound)return e.abrupt("return");e.next=26;break;case 26:throw new H.default.NotFoundError(this.host.models.Role.name,t);case 27:return o=this.__injectSearchResult({entity:{id:t,displayName:a.display_name},metadata:a,organizationId:n}),this.host.models.Organization.touch(n),e.abrupt("return",o);case 30:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"saveRole",value:(E=(0,M.default)(D.default.mark(function e(t,n){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(n));e.next=8;break;case 8:return this.host.requireUser(),n=this._resolveModelId(n),t=this.__resolveRoleId(t),e.next=13,this.host.api.roles.saveRole(t,this.host.currentUserId,n);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"removeSavedRole",value:(w=(0,M.default)(D.default.mark(function e(t,n){return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(n));e.next=8;break;case 8:return this.host.requireUser(),n=this._resolveModelId(n),t=this.__resolveRoleId(t),e.next=13,this.host.api.roles.removeSavedRole(t,this.host.currentUserId,n);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"findSavedRoles",value:(b=(0,M.default)(D.default.mark(function e(t){var n,r,a=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=2;break;case 2:if(o instanceof Object){e.next=4;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+$(o));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(t));e.next=6;break;case 6:if(o instanceof Object){e.next=8;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\nObject\n\nGot:\n'+L(o));case 8:return o=(0,F.default)(o,{ignoreNotFound:!1}),this.host.requireUser(),t=this._resolveModelId(t),e.next=13,this.host.api.roles.findSavedRoles(this.host.currentUserId,t);case 13:if(n=e.sent){e.next=18;break}if(o.ignoreNotFound)return e.abrupt("return");e.next=17;break;case 17:throw new H.default.NotFoundError("saved roles",t);case 18:return r=n.map(function(e){return a.__injectSearchResult({entity:{id:e.token,displayName:e.display_name},metadata:e,organizationId:t})}).filter(Boolean),this.host.models.Organization.touch(t),e.abrupt("return",r);case 21:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"reactToUpdateEventCR",value:function(e){var t,n=e.entity,r=n.display_name,a=n.metadata,o=n.organizationId;return t="group"===n.type?a.id:n.id,a=(0,z.default)({},a,{display_name:r,token:this.__resolveRoleId(t)}),this.__injectRoleFromMetadata({metadata:a,organizationId:o})}},{key:"reactToUpdateEvent",value:function(e){var t,n=e.data,r=n.display_name,a=n.metadata,o=n.organization_key;return t="tigertext:entity:group"===n.type?a.id:n.token,a=(0,z.default)({},a,{display_name:r,token:this.__resolveRoleId(t)}),this.__injectRoleFromMetadata({metadata:a,organizationId:o})}},{key:"__injectRoleFromMetadata",value:function(e){var t=e.metadata,n=void 0===t?{}:t,r=e.organizationId,a=e.replaceExisting,o=void 0===a||a,i=n.escalation_policy,s=n.token;if(!s)return null;var u="role:"+s;if(!o){var c=this.host.models.Role.get(u);if(c)return c}var l=this.host.models.Organization.get(r);this.host.metadata.__injectMetadata(s,r,(0,z.default)({feature_service:"role"},n)),this.host.models.User.injectPlaceholder({id:s,organizationId:r,displayName:n.display_name});var d={botUserId:s,displayName:n.display_name,id:u,organizationId:r};if(n.description&&(d.description=n.description),i&&i.escalation_path){var f=JSON.parse((0,R.default)(i));f.id="escalationPolicy:"+s,f.targetId=s;var p=this.host.models.EscalationPolicy.inject(f);d.escalationPolicyId=p.id}else d.escalationPolicyId=null;if(n.room_assignment_id&&(d.assignmentGroupId=n.room_assignment_id),n.owners)if("string"==typeof n.owners)d.memberIds=n.owners.split(","),this.host.models.User.injectPlaceholder({id:n.owners});else{if(d.memberIds=n.owners.map(function(e){return e.token}),!(b=n.owners)||"function"!=typeof b[Z.default]&&!Array.isArray(b))throw new TypeError("Expected _metadata$owners to be iterable, got "+L(b));if(!b||"function"!=typeof b[Z.default]&&!Array.isArray(b))throw new TypeError("Expected _metadata$owners to be iterable, got "+$(b));var y=!0,h=!1,g=void 0;try{for(var v,m=(0,q.default)(b);!(y=(v=m.next()).done);y=!0){var b,w=v.value;this.host.models.User.injectPlaceholder(w)}}catch(e){h=!0,g=e}finally{try{!y&&m.return&&m.return()}finally{if(h)throw g}}}return n.tag_id?(d.roleTagId=r+":"+n.tag_id,this.host.models.RoleTag.inject((0,z.default)({},(0,U.default)(n,"tag_id","tag_color","tag_name"),{id:d.roleTagId,organizationId:r}))):l&&(d.roleTagId=null),this.host.models.Role.inject(d)}},{key:"__parseRoleFromMetadata",value:function(e){var t=e.metadata,n=void 0===t?{}:t,r=e.organizationId,a=n.token;if(!a)return null;var o={$entityType:"role",botUserId:a,displayName:n.display_name,id:"role:"+a,organizationId:r},i=null;return n.tag_id&&(i={id:r+":"+n.tag_id,organizationId:r,color:n.tag_color,tagId:n.tag_id,name:n.tag_name,displayName:n.tag_name}).color&&(i.color=i.color.replace("0x","#")),o.roleTag=i,o}},{key:"getAll",value:function(){return this.host.models.Role.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(e));return e=this.__resolveRoleId(e),this.host.models.Role.get("role:"+e)}},{key:"refresh",value:(m=(0,M.default)(D.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(t));e.next=4;break;case 4:if(0===(n=(0,S.default)(this._roleConversations)).length)return e.abrupt("return");e.next=7;break;case 7:return e.next=9,this.host.entities.findMulti(n,t);case 9:if(!(r=e.sent)||"function"!=typeof r[Z.default]&&!Array.isArray(r))throw new TypeError("Expected entities to be iterable, got "+L(r));e.next=12;break;case 12:if(!r||"function"!=typeof r[Z.default]&&!Array.isArray(r))throw new TypeError("Expected entities to be iterable, got "+$(r));e.next=14;break;case 14:for(o=!(a=!0),i=void 0,e.prev=17,s=(0,q.default)(r);!(a=(u=s.next()).done);a=!0)c=u.value,l=c.entity,d=c.metadata,l&&d&&(d.owners||(d.owners=[]),this.__injectSearchResult({entity:{id:l.token,displayName:l.display_name},metadata:d,organizationId:t}));e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),o=!0,i=e.t0;case 25:e.prev=25,e.prev=26,!a&&s.return&&s.return();case 28:if(e.prev=28,o)throw i;e.next=31;break;case 31:return e.finish(28);case 32:return e.finish(25);case 33:case"end":return e.stop()}},e,this,[[17,21,25,33],[26,,28,32]])})),function(e){return m.apply(this,arguments)})},{key:"reactToFriendsEventCR",value:(v=(0,M.default)(D.default.mark(function e(t){var n,r,a,o,i,s;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.action,r=t.attrs,a=r.id,o=r.metadata,i=void 0===o?{}:o,s=r.organizationId,r.action=n,r.token=a,e.next=6,this.__reactToRoleChange(i.id,s,i.triggered_id,r);case 6:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"reactToFriendsEvent",value:(g=(0,M.default)(D.default.mark(function e(t){var n,r,a,o,i;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data.friend,r=n.metadata,a=void 0===r?{}:r,o=n.organization_id,i=(0,j.default)(n,["metadata","organization_id"]),e.next=3,this.__reactToRoleChange(a.id,o,a.triggered_id,i);case 3:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"__reactToRoleChange",value:(h=(0,M.default)(D.default.mark(function e(t,n,r,a){var o,i,s,u,c,l,d,f,p,y,h,g,v,m;return D.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(n));e.next=4;break;case 4:if("string"!=typeof r)throw new TypeError('Value of argument "triggeredId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+$(r));e.next=6;break;case 6:if("string"!=typeof t)throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(t));e.next=8;break;case 8:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(n));e.next=10;break;case 10:if("string"!=typeof r)throw new TypeError('Value of argument "triggeredId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+L(r));e.next=12;break;case 12:if(n=this._resolveModelId(n),t=this.__resolveRoleId(t),r=this._resolveModelId(r),o=this.host.currentUser,i=a.action,s=a.token,u=function(){return o.roles.some(function(e){return e.botUserId===t})},c=this._previouslyInRoles[t]||u(),l=a.event_status,"del"!==i){e.next=27;break}if(l&&"end"!==l)return this._previouslyInRoles[t]=c,e.abrupt("return");e.next=26;break;case 26:delete this._previouslyInRoles[t];case 27:return d=this.getById(t),e.next=30,B.default.all([this.find(t,n,{bypassCache:!0,ignoreNotFound:!0}),this.host.users.find(r,{organizationId:n})]);case 30:if(f=e.sent,p=(0,O.default)(f,2),y=p[0],h=p[1],d||y){e.next=36;break}return e.abrupt("return");case 36:(g="del"===i&&d&&!y)&&(y=d,v="role:"+t,this.host.models.Role.inject({id:v,memberIds:[]}),this.host.models.Role.eject(y)),(m=u())&&!c?this.emit("change",{type:"OPT_IN",role:y,target:o,triggeredBy:h}):!m&&c&&(this.host.models.Group.eject(s),this.host.models.User.touch(this.host.currentUserId),this.emit("change",{type:"OPT_OUT",isRoleDeleted:g,role:y,target:o,triggeredBy:h}));case 40:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return h.apply(this,arguments)})}]),a((p=J).prototype,"findAll",[o],(0,I.default)(p.prototype,"findAll"),p.prototype),a(p.prototype,"findByOrganizationId",[i],(0,I.default)(p.prototype,"findByOrganizationId"),p.prototype),a(p.prototype,"find",[s],(0,I.default)(p.prototype,"find"),p.prototype),a(p.prototype,"saveRole",[u],(0,I.default)(p.prototype,"saveRole"),p.prototype),a(p.prototype,"removeSavedRole",[c],(0,I.default)(p.prototype,"removeSavedRole"),p.prototype),a(p.prototype,"findSavedRoles",[l],(0,I.default)(p.prototype,"findSavedRoles"),p.prototype),a(p.prototype,"refresh",[d],(0,I.default)(p.prototype,"refresh"),p.prototype),a(p.prototype,"__reactToRoleChange",[f],(0,I.default)(p.prototype,"__reactToRoleChange"),p.prototype),p);function J(){var e,t,g,n;(0,C.default)(this,J);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=g=(0,V.default)(this,(e=J.__proto__||(0,G.default)(J)).call.apply(e,[this].concat(a))),g.__injectSearchResult=function(e){var t=e.entity,n=e.metadata,r=void 0===n?{}:n,a=e.organizationId;return r=(0,z.default)({},r,{display_name:t.displayName,token:g.__resolveRoleId(t.id)}),g.__injectRoleFromMetadata({metadata:r,organizationId:a})},g.__injectRoleAssignmentEntity=function(e,t,n){return g.__injectRoleFromMetadata({metadata:{display_name:e,meta_type:t.meta_type,owners:t.owner_id,tag_color:t.tag_color,tag_id:t.tag_id,tag_name:t.tag_name,token:t.id},organizationId:n,replaceExisting:!1})},g.__resolveRoleId=function(e){if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+$(e));if(!("string"==typeof e||e instanceof Object))throw new TypeError('Value of argument "roleId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+L(e));if("string"!=typeof e){if(!Q.includes(e.$entityType))return e;e=g._resolveModelId(e)}return e.replace("role:","")},g._onChangeConversation=function(e,t){var n=t.counterParty,r=t.counterPartyType,a=n&&n.members&&0<n.members.length;if("group"===r&&a){if(!(l=n.members)||"function"!=typeof l[Z.default]&&!Array.isArray(l))throw new TypeError("Expected _counterParty$members to be iterable, got "+L(l));if(!l||"function"!=typeof l[Z.default]&&!Array.isArray(l))throw new TypeError("Expected _counterParty$members to be iterable, got "+$(l));var o=!0,i=!1,s=void 0;try{for(var u,c=(0,q.default)(l);!(o=(u=c.next()).done);o=!0){var l,d=u.value;if(d.isRoleBot){var f=g._roleConversations[d.id]||[];if(f.includes(t)||f.push(t),g._roleConversations[d.id]=f,"ROLE_P2P"===n.groupType){var p=g._roleP2PConversations[d.id]||[];p.includes(t)||p.push(t),g._roleP2PConversations[d.id]=p}}}}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}},g._onRemoveConversation=function(e,t){var n=t.counterParty,r=t.counterPartyType,a=n&&n.members&&0<n.members.length;if("group"===r&&a){var o=n.memberIds;if(!o||"function"!=typeof o[Z.default]&&!Array.isArray(o))throw new TypeError("Expected memberIds to be iterable, got "+L(o));if(!o||"function"!=typeof o[Z.default]&&!Array.isArray(o))throw new TypeError("Expected memberIds to be iterable, got "+$(o));var i=!0,s=!1,u=void 0;try{for(var c,l=(0,q.default)(o);!(i=(c=l.next()).done);i=!0){var d=c.value,f=g._roleConversations[d],p=f?f.indexOf(t):-1;if(-1<p&&f.splice(p,1),f&&0===f.length&&delete g._roleConversations[d],"ROLE_P2P"===n.groupType){var y=g._roleP2PConversations[d],h=y?y.indexOf(t):-1;-1<h&&y.splice(h,1),y&&0===y.length&&delete g._roleP2PConversations[d]}}}catch(e){s=!0,u=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw u}}}},n=t,(0,V.default)(g,n)}t.default=Y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function oe(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=oe(t[0],n);return t.every(function(e){return oe(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return oe(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,le.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+oe(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function ie(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,h.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=ie(t[0],n);return t.every(function(e){return ie(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return ie(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,le.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,y.default)(e))+": "+ie(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,o,i,s,u,c,l,d,f,p,y=r(n(3)),h=r(n(8)),g=r(n(11)),se=r(n(21)),ue=r(n(23)),ce=r(n(10)),le=r(n(7)),de=r(n(20)),fe=r(n(12)),pe=r(n(13)),ye=r(n(15)),v=r(n(9)),m=r(n(4)),b=r(n(1)),w=r(n(2)),E=r(n(6)),x=r(n(5)),_=r(n(32)),he=r(n(237)),ge=r(n(41)),ve=r(n(58)),k=n(18),me=r(n(17)),be=n(26),we=n(75),V=n(48),Ee=n(22),A=n(30),T=n(27),I=r(n(14)),xe=["avatar","conversation_id","department","description","display_name","dnd_auto_forward_receiver","dnd","first_name","is_public","last_login_time","last_name","name","num_members","organization_key","pagers","status","title","token"],_e={distributionList:be.SearchType.toServer(be.SearchType.DISTRIBUTION_LIST),forum:be.SearchType.toServer(be.SearchType.FORUM),group:be.SearchType.toServer(be.SearchType.GROUP),organization:be.SearchType.toServer(be.SearchType.ORGANIZATION),tag:be.SearchType.toServer(be.SearchType.TAG),user:be.SearchType.toServer(be.SearchType.USER)},ke=(0,_.default)(_e),O=(a=(0,k.decorator)(),f=I.default,(0,x.default)(j,f),(0,w.default)(j,[{key:"query",value:(p=(0,v.default)(ce.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C,P,V,N,U,F,L,$,D,B,q,Z,K,H,W,X,Q,Y,J,ee,te,ne,re,ae;return ce.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.continuation,r=void 0===n?null:n,a=t.excludeIds,o=void 0===a?[]:a,i=t.excludeSelf,s=void 0!==i&&i,u=t.followContinuations,c=void 0!==u&&u,l=t.includeDisabled,d=void 0!==l&&l,f=t.organizationId,p=void 0===f?null:f,y=t.organizationIds,h=void 0===y?[]:y,g=t.query,v=void 0===g?{}:g,m=t.resultsFormat,b=void 0===m?"entities":m,w=t.returnFields,E=void 0===w?xe:w,x=t.sort,_=void 0===x?[]:x,k=t.types,0===(A=void 0===k?[]:k).length)throw new me.default.ValidationError("types","required","no types specified");e.next=3;break;case 3:if(A=(0,ve.default)(A.map(function(e){return be.SearchType.isValid(e)?be.SearchType.toServer(e):_e[e]})),0<(T=(0,ge.default)(A,ke)).length)throw new me.default.ValidationError("types","invalid","invalid types: "+T.join(", "));e.next=7;break;case 7:if(p&&(h=[p]),0===h.length)throw new me.default.ValidationError("organizationIds","invalid","search must be done in a context of an organization");e.next=10;break;case 10:if(1!==h.length){e.next=15;break}if((I=this.host.models.Organization.get(p))&&I.isContacts)return O=this._queryLocalOrganization({organization:I,query:v,types:A}),j=O.results,S=O.metadata,e.abrupt("return",{results:j,metadata:S});e.next=15;break;case 15:if("ids"===b&&(b="tokens"),o=(0,Ee.arrayWrap)(o),R={directory:h,include_disabled:d,render_metadata:!0,results_format:b,return_fields:E,type:A},_&&_.length&&(R.sort=_.map(function(e){return Ee.Camelizer.underscoreKey(e)})),M={},!(v&&0<(0,le.default)(v).length)){e.next=47;break}if(!(N=(0,ue.default)(v))||"function"!=typeof N[pe.default]&&!Array.isArray(N))throw new TypeError("Expected _Object$entries to be iterable, got "+oe(N));e.next=24;break;case 24:if(!N||"function"!=typeof N[pe.default]&&!Array.isArray(N))throw new TypeError("Expected _Object$entries to be iterable, got "+ie(N));e.next=26;break;case 26:for(G=!(z=!0),C=void 0,e.prev=29,P=(0,fe.default)(N);!(z=(V=P.next()).done);z=!0)U=(0,se.default)(V.value,2),F=U[0],L=U[1],F.includes(",")&&($=F.split(",").map(Ee.Camelizer.underscoreKey).join(","),M[$]=L,delete v[F]);e.next=37;break;case 33:e.prev=33,e.t0=e.catch(29),G=!0,C=e.t0;case 37:e.prev=37,e.prev=38,!z&&P.return&&P.return();case 40:if(e.prev=40,G)throw C;e.next=43;break;case 43:return e.finish(40);case 44:return e.finish(37);case 45:M=(0,ye.default)({},M,Ee.Camelizer.underscoreObject(v)),R.bool={must:M};case 47:return D=[{continuation:r,excludeIds:o,excludeSelf:s,followContinuations:c,params:R}],e.next=51,de.default.all(D.map(this._query));case 51:if(B=e.sent,q=[],!B||"function"!=typeof B[pe.default]&&!Array.isArray(B))throw new TypeError("Expected allResults to be iterable, got "+oe(B));e.next=55;break;case 55:if(!B||"function"!=typeof B[pe.default]&&!Array.isArray(B))throw new TypeError("Expected allResults to be iterable, got "+ie(B));e.next=57;break;case 57:K=!(Z=!0),H=void 0,e.prev=60,W=(0,fe.default)(B);case 62:if(Z=(X=W.next()).done){e.next=91;break}if(Q=X.value,!(Y=Q.results)||"function"!=typeof Y[pe.default]&&!Array.isArray(Y))throw new TypeError("Expected results to be iterable, got "+oe(Y));e.next=67;break;case 67:if(!Y||"function"!=typeof Y[pe.default]&&!Array.isArray(Y))throw new TypeError("Expected results to be iterable, got "+ie(Y));e.next=69;break;case 69:for(ee=!(J=!0),te=void 0,e.prev=72,ne=(0,fe.default)(Y);!(J=(re=ne.next()).done);J=!0)ae=re.value,q.push(ae);e.next=80;break;case 76:e.prev=76,e.t1=e.catch(72),ee=!0,te=e.t1;case 80:e.prev=80,e.prev=81,!J&&ne.return&&ne.return();case 83:if(e.prev=83,ee)throw te;e.next=86;break;case 86:return e.finish(83);case 87:return e.finish(80);case 88:Z=!0,e.next=62;break;case 91:e.next=97;break;case 93:e.prev=93,e.t2=e.catch(60),K=!0,H=e.t2;case 97:e.prev=97,e.prev=98,!Z&&W.return&&W.return();case 100:if(e.prev=100,K)throw H;e.next=103;break;case 103:return e.finish(100);case 104:return e.finish(97);case 105:return q=(0,he.default)(q,"entity"),e.abrupt("return",{results:q,metadata:B[0].metadata});case 107:case"end":return e.stop()}},e,this,[[29,33,37,45],[38,,40,44],[60,93,97,105],[72,76,80,88],[81,,83,87],[98,,100,104]])})),function(e){return p.apply(this,arguments)})},{key:"_queryLocalOrganization",value:function(e){var t=e.organization,n=e.query,r=e.types,a=t.id,o=this._searchLocalOrganization({organization:t,query:n,types:r}),i={firstHit:1,totalHits:o.length},s=(0,le.default)(n);if(0===o.length&&0<s.length){var u=s.find(function(e){return e.includes("displayName")}),c=u?n[u]:n[s[0]];if((0,A.isEmail)(c)||(0,T.isPhone)(c)){var l=(0,A.isEmail)(c)?c:(0,T.normalizePhone)(c),d=this.host.models.User.createInstance({displayName:(0,T.isPhone)(c)?(0,T.formatPhone)(c):c,id:l,messageAnyoneRecipient:!0,organizationId:a});return{results:[new we.SearchResult(d,a,i)],metadata:i}}}return{results:o,metadata:i}}}]),i=(o=j).prototype,s="query",u=[a],c=(0,g.default)(o.prototype,"query"),l=o.prototype,d={},Object.keys(c).forEach(function(e){d[e]=c[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(i,s,e)||e},d),l&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(l):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(i,s,d),d=null),o);function j(){var e,t,re,n,r,ae=this;(0,b.default)(this,j);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=re=(0,E.default)(this,(e=j.__proto__||(0,m.default)(j)).call.apply(e,[this].concat(o))),re._query=(r=(0,v.default)(ce.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,G,C,P,V,N,U,F,L,$,D,B,q,Z,K,H,W,X,Q,Y,J,ee,te,ne;return ce.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.continuation,r=void 0===n?null:n,a=t.excludeIds,o=void 0===a?[]:a,i=t.excludeSelf,s=void 0!==i&&i,u=t.followContinuations,c=void 0!==u&&u,l=t.params,r&&(l=(0,ye.default)({},l,{continuation:r})),e.next=4,re.host.api.search.query(l);case 4:if(d=e.sent,f=d.results,p=[],!f||"function"!=typeof f[pe.default]&&!Array.isArray(f))throw new TypeError("Expected entries to be iterable, got "+oe(f));e.next=9;break;case 9:if(!f||"function"!=typeof f[pe.default]&&!Array.isArray(f))throw new TypeError("Expected entries to be iterable, got "+ie(f));e.next=11;break;case 11:h=!(y=!0),g=void 0,e.prev=14,v=(0,fe.default)(f);case 16:if(y=(m=v.next()).done){e.next=32;break}if(b=m.value,w=b.type,E=b.entity,x=b.organization_id,_={entityAttrs:E,organizationId:x,type:w},re.config.condensedReplays?E.conversation_id?(_.conversationId=E.conversation_id,delete E.conversation_id):_.conversationId=b.conversation_id:delete E.conversation_id,0===(0,le.default)(E).length)return e.abrupt("continue",29);e.next=25;break;case 25:"tigertext:entity:account"===w?(0,Ee.replaceKey)(E,"status","account_status"):"tigertext:entity:tag"===w&&(E.token=x+":"+E.token),(k=E.metadata)&&re.host.metadata.__injectMetadata(E.token,x,k),p.push(_);case 29:y=!0,e.next=16;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(14),h=!0,g=e.t0;case 38:e.prev=38,e.prev=39,!y&&v.return&&v.return();case 41:if(e.prev=41,h)throw g;e.next=44;break;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return A=d.metadata,T=A.continuation,I=A.first_hit,O=A.total_hits,j={firstHit:I,totalHits:O},T&&(c?j.firstHit=1:j.continuation=T),S=[],R=[],M=function(e){var t=e.results;if(!t||"function"!=typeof t[pe.default]&&!Array.isArray(t))throw new TypeError("Expected results to be iterable, got "+oe(t));if(!t||"function"!=typeof t[pe.default]&&!Array.isArray(t))throw new TypeError("Expected results to be iterable, got "+ie(t));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,fe.default)(t);!(n=(o=i.next()).done);n=!0){var s=o.value;S.push(s)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}},c&&T&&R.push(re._query((0,ye.default)({},t,{continuation:T})).then(M)),e.next=55,de.default.all(R);case 55:if(z=[],!p||"function"!=typeof p[pe.default]&&!Array.isArray(p))throw new TypeError("Expected candidates to be iterable, got "+oe(p));e.next=58;break;case 58:if(!p||"function"!=typeof p[pe.default]&&!Array.isArray(p))throw new TypeError("Expected candidates to be iterable, got "+ie(p));e.next=60;break;case 60:C=!(G=!0),P=void 0,e.prev=63,V=(0,fe.default)(p);case 65:if(G=(N=V.next()).done){e.next=89;break}if(U=N.value,F=U.conversationId,L=U.entityAttrs,$=U.organizationId,D=U.type,B=re.host.modelNameByTypeNS(D),(q="group"===B&&re.host.groups.__extractGroupTypeFromAttrs(L))===be.GroupType.FORUM&&delete L.members,Z=re.host.metadata.get(L.token,$),K=Z?Z.data:null,"user"===(H=re.host.conversations.__injectCounterParty({conversationId:F,entityAttrs:L,entityType:B,groupType:q,hasCurrentUser:!1,organizationId:$})).$entityType&&K&&"role"===K.feature_service&&re.host.roles.__injectSearchResult({entity:H,metadata:K,organizationId:$}),o.length&&o.includes(H.id))return e.abrupt("continue",86);e.next=77;break;case 77:if(W=re.host.currentUserId,s&&H.id===W)return e.abrupt("continue",86);e.next=80;break;case 80:if(H){e.next=83;break}return re.logger.warn("no entity for ",U),e.abrupt("continue",86);case 83:H.isRoleBot&&H.botRole&&(H=H.botRole),X=new we.SearchResult(H,$,F,K),z.unshift(X);case 86:G=!0,e.next=65;break;case 89:e.next=95;break;case 91:e.prev=91,e.t1=e.catch(63),C=!0,P=e.t1;case 95:e.prev=95,e.prev=96,!G&&V.return&&V.return();case 98:if(e.prev=98,C)throw P;e.next=101;break;case 101:return e.finish(98);case 102:return e.finish(95);case 103:if(!z||"function"!=typeof z[pe.default]&&!Array.isArray(z))throw new TypeError("Expected immediateResults to be iterable, got "+oe(z));e.next=105;break;case 105:if(!z||"function"!=typeof z[pe.default]&&!Array.isArray(z))throw new TypeError("Expected immediateResults to be iterable, got "+ie(z));e.next=107;break;case 107:for(Y=!(Q=!0),J=void 0,e.prev=110,ee=(0,fe.default)(z);!(Q=(te=ee.next()).done);Q=!0)ne=te.value,S.unshift(ne);e.next=118;break;case 114:e.prev=114,e.t2=e.catch(110),Y=!0,J=e.t2;case 118:e.prev=118,e.prev=119,!Q&&ee.return&&ee.return();case 121:if(e.prev=121,Y)throw J;e.next=124;break;case 124:return e.finish(121);case 125:return e.finish(118);case 126:return e.abrupt("return",{results:S,metadata:j});case 127:case"end":return e.stop()}},e,ae,[[14,34,38,46],[39,,41,45],[63,91,95,103],[96,,98,102],[110,114,118,126],[119,,121,125]])})),function(e){return r.apply(this,arguments)}),re._searchLocalOrganization=function(e){var t=e.organization,n=e.query,r=e.types,a=void 0===r?[]:r,o=t.conversations,i=t.id,s=[];if(!o||"function"!=typeof o[pe.default]&&!Array.isArray(o))throw new TypeError("Expected conversations to be iterable, got "+oe(o));if(!o||"function"!=typeof o[pe.default]&&!Array.isArray(o))throw new TypeError("Expected conversations to be iterable, got "+ie(o));var u=!0,c=!1,l=void 0;try{for(var d,f=(0,fe.default)(o);!(u=(d=f.next()).done);u=!0){var p=d.value,y=p.counterParty,h=p.counterPartyType,g=p.metadata,v=_e[h];if(a.includes(v))if(n&&0!==(0,le.default)(n).length){var m=!0;if(!(k=(0,ue.default)(n))||"function"!=typeof k[pe.default]&&!Array.isArray(k))throw new TypeError("Expected _Object$entries2 to be iterable, got "+oe(k));if(!k||"function"!=typeof k[pe.default]&&!Array.isArray(k))throw new TypeError("Expected _Object$entries2 to be iterable, got "+ie(k));var b=!0,w=!1,E=void 0;try{for(var x,_=(0,fe.default)(k);!(b=(x=_.next()).done);b=!0){var k,A=(0,se.default)(x.value,2),T=A[0],I=A[1];T=T.split(","),I=I.toLowerCase();var O=!1;if(!T||"function"!=typeof T[pe.default]&&!Array.isArray(T))throw new TypeError("Expected fields to be iterable, got "+oe(T));if(!T||"function"!=typeof T[pe.default]&&!Array.isArray(T))throw new TypeError("Expected fields to be iterable, got "+ie(T));var j=!0,S=!1,R=void 0;try{for(var M,z=(0,fe.default)(T);!(j=(M=z.next()).done);j=!0){var G=M.value,C="user"===h&&V.PROFILE_ATTRIBUTES_PER_ORG.includes(G)?y.profileByOrganizationId[i]:y;if(C){var P=C[G];if(void 0!==P&&P.toLowerCase().includes(I)){O=!0;break}}}}catch(e){S=!0,R=e}finally{try{!j&&z.return&&z.return()}finally{if(S)throw R}}if(!O){m=!1;break}}}catch(e){w=!0,E=e}finally{try{!b&&_.return&&_.return()}finally{if(w)throw E}}m&&s.push(new we.SearchResult(y,i,g))}else s.push(new we.SearchResult(y,i,g))}}catch(e){c=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}return s},n=t,(0,E.default)(re,n)}t.default=O,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function c(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=c(t[0],n);return t.every(function(e){return c(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return c(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+c(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function l(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=l(t[0],n);return t.every(function(e){return l(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return l(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+l(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,d,f,p,y,h=r(n(3)),g=r(n(7)),v=r(n(8)),m=r(n(11)),b=r(n(15)),w=r(n(10)),E=r(n(9)),x=r(n(4)),_=r(n(1)),k=r(n(2)),A=r(n(6)),T=r(n(5)),I=r(n(59)),O=r(n(87)),j=r(n(54)),S=r(n(40)),R=r(n(91)),M=n(18),z=r(n(14)),G="global",C=(o=(0,M.decorator)(),i=(0,M.decorator)(),u=z.default,(0,T.default)(P,u),(0,k.default)(P,[{key:"mounted",value:function(){this._lastStartTypingAPICalls={},this._lastStopTypingAPICalls={},this._typers={},this._currentUserTyping={},this.host.on("message:sending",this._onMessageSending)}},{key:"dispose",value:function(){var e;(e=(e=(e=(e=this._typers,O.default).call(e),S.default).call(e,I.default),j.default).call(e),S.default).call(e,"timer").forEach(function(e){return null!==e&&clearTimeout(e)}),(e=(e=this._currentUserTyping,O.default).call(e),S.default).call(e,"timer").forEach(function(e){return null!==e&&clearTimeout(e)}),this._lastStartTypingAPICalls=null,this._lastStopTypingAPICalls=null,this._typers=null,this.host.removeListener("message:sending",this._onMessageSending)}},{key:"reactToIsTypingEvent",value:function(e){var t,n=e.data;if(this.host.requireUser(),(t=n.proxy_token?n.proxy_token:n.sender_token)!==this.host.currentUserId){var r=n.group_token||G,a="typing"===n.status;this.host.models.User.ensureEntity(t,{onlyPlaceholder:!1}),this._setTypingStatusOfUser(r,t,a)}}},{key:"startTyping",value:(y=(0,E.default)(w.default.mark(function e(t){var n,r,a=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=o.autoStopAfterTimeout,s=o.senderId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||null==t){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+l(t));case 2:if("string"==typeof t||t instanceof Object||null==t){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+c(t));case 4:if(void 0===t)return e.abrupt("return");e.next=6;break;case 6:return t=this._resolveModelId(t),s=this._resolveModelId(s),this.host.requireUser(),e.next=11,this._sendStartTyping(t,s);case 11:(n=this._currentUserTyping[t])?(clearTimeout(this._currentUserTyping[t].timer),n.timer=null):(n={},this._currentUserTyping[t]=n),r="number"==typeof i?i:this.host.config.clearTypingStatusTimeout,n.timer=setTimeout(function(){a.logger.info("auto stop typing for current user",t),a.stopTyping(t,{senderId:s})},r);case 15:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"_sendStartTyping",value:(p=(0,E.default)(w.default.mark(function e(t,n){var r,a,o,i,s,u;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._lastStartTypingAPICalls[t]){e.next=7;break}if(r=this._lastStartTypingAPICalls[t],a=r.expiresAt,o=r.retVal,i=r.lastSenderId,n!==i)return e.next=5,this.stopTyping(t,{senderId:i});e.next=5;break;case 5:if((0,R.default)().isBefore(a))return e.abrupt("return",o);e.next=7;break;case 7:return e.next=9,this.host.api.messages.startTyping(t,n);case 9:return s=e.sent,u=(0,R.default)().add(this.config.clearTypingStatusThrottleDelay,"ms"),this._lastStartTypingAPICalls[t]={expiresAt:u,retVal:s,lastSenderId:n},e.abrupt("return",s);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"stopTyping",value:(f=(0,E.default)(w.default.mark(function e(t){var n,r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).senderId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Object||null==t){e.next=2;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+l(t));case 2:if("string"==typeof t||t instanceof Object||null==t){e.next=4;break}throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nstring | Object | void\n\nGot:\n'+c(t));case 4:if(void 0===t)return e.abrupt("return");e.next=6;break;case 6:return t=this._resolveModelId(t),r=this._resolveModelId(r),this.host.requireUser(),(n=this._currentUserTyping[t])&&null!==n.timer&&(clearTimeout(n.timer),n.timer=null),e.next=13,this._sendStopTyping(t,r);case 13:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_sendStopTyping",value:(d=(0,E.default)(w.default.mark(function e(t,n){var r,a,o,i,s;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._lastStopTypingAPICalls[t])){e.next=5;break}if(a=r.expiresAt,o=r.retVal,(0,R.default)().isBefore(a))return e.abrupt("return",o);e.next=5;break;case 5:return e.next=7,this.host.api.messages.stopTyping(t,n);case 7:return i=e.sent,s=(0,R.default)().add(this.config.clearTypingStatusThrottleDelay,"ms"),this._lastStopTypingAPICalls[t]={expiresAt:s,retVal:i,senderId:n},e.abrupt("return",i);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"_setTypingStatusOfUser",value:function(e,t,n){var r=this,a=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+l(n));if(null!=a&&"boolean"!=typeof a)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+l(a));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));if("boolean"!=typeof n)throw new TypeError('Value of argument "isTyping" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+c(n));if(null!=a&&"boolean"!=typeof a)throw new TypeError('Value of argument "timedOut" violates contract.\n\nExpected:\n?boolean\n\nGot:\n'+c(a));var o=this._typers[e];if(n){o||(o={},this._typers[e]=o);var i=o[t],s=i&&null!==i.timer;if(i?clearTimeout(i.timer):(i={},o[t]=i),i.timer=setTimeout(function(){r.logger.info("auto stop typing for other typer",e,t),r._setTypingStatusOfUser(e,t,!1,!0)},this.host.config.clearTypingStatusTimeout),s)return}else{var u=o&&o[t];if(!u||null===u.timer)return;clearTimeout(u.timer),u.timer=null}this.emit("change",(0,b.default)({userId:t},e!==G?{groupId:e}:null,{isTyping:n,timedOut:a}))}},{key:"isUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+c(e));return e=this._resolveModelId(e),this._isUserTypingInContext(G,e)}},{key:"isCurrentUserTyping",value:function(e){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(e));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "counterPartyId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+c(e));e=this._resolveModelId(e);var t=this._currentUserTyping[e];return!!t&&null!==t.timer}},{key:"isUserTypingInGroup",value:function(e,t){if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+l(t));if(!(e instanceof Object||"string"==typeof e))throw new TypeError('Value of argument "groupId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+c(e));if(!(t instanceof Object||"string"==typeof t))throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nObject | string\n\nGot:\n'+c(t));return t=this._resolveModelId(t),e=this._resolveModelId(e),this._isUserTypingInContext(e,t)}},{key:"_isUserTypingInContext",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+l(t));if("string"!=typeof e)throw new TypeError('Value of argument "contextId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(e));if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+c(t));var n=this._typers[e],r=n&&n[t];return!!r&&null!==r.timer}}]),a((s=P).prototype,"_sendStartTyping",[o],(0,m.default)(s.prototype,"_sendStartTyping"),s.prototype),a(s.prototype,"_sendStopTyping",[i],(0,m.default)(s.prototype,"_sendStopTyping"),s.prototype),s);function P(){var e,t,n,r;(0,_.default)(this,P);for(var a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];return t=n=(0,A.default)(this,(e=P.__proto__||(0,x.default)(P)).call.apply(e,[this].concat(o))),n._onMessageSending=function(e){n.stopTyping(e.counterPartyId,{senderId:e.senderId})},r=t,(0,A.default)(n,r)}t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function i(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=i(t[0],n);return t.every(function(e){return i(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return i(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+i(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function s(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,v.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=s(t[0],n);return t.every(function(e){return s(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return s(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,g.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,h.default)(e))+": "+s(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,c,l,d,f,p,y,h=r(n(3)),g=r(n(7)),v=r(n(8)),m=r(n(11)),b=r(n(15)),w=r(n(10)),E=r(n(9)),x=r(n(4)),_=r(n(1)),k=r(n(2)),A=r(n(6)),T=r(n(5)),I=r(n(14)),O=n(18),j=(o=(0,O.decorator)(),u=(0,O.decorator)(),c=(0,O.decorator)({memoize:!0,serializeArguments:function(e){return e[0]}}),d=I.default,(0,T.default)(S,d),(0,k.default)(S,[{key:"dispose",value:function(){O.decorator.clear(this._findAll)}},{key:"findAll",value:(y=(0,E.default)(w.default.mark(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.userId,r=void 0===n?this.host.currentUserId:n,a=t.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),e.abrupt("return",this._findAll(r,a));case 2:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"refreshAll",value:(p=(0,E.default)(w.default.mark(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.userId,r=void 0===n?this.host.currentUserId:n,a=t.organizationId;return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.host.requireUser(),O.decorator.clear(this._findAll),e.abrupt("return",this._findAll(r,a));case 3:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"_findAll",value:(f=(0,E.default)(w.default.mark(function e(u){var t,c,l=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._pickOrganizationId();return w.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof u)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(u));e.next=2;break;case 2:if("string"!=typeof u)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(u));e.next=4;break;case 4:return e.next=6,this.host.api.userRoles.findAll(u,n);case 6:return t=e.sent,c={userRoles:[],productRoles:[]},t.forEach(function(e){var t=e.organization,n=e.product;if(t){var r=t.organization_id,a=l.host.organizations.getById(r),o=l.host.models.UserRoles.inject((0,b.default)({id:l._getOrganizationKey({organizationId:r,userId:u}),userId:u},t));a&&l.host.models.Organization.touch(a),c.userRoles.push(o)}else if(n){var i=n.product_id,s=l.host.models.ProductRoles.inject((0,b.default)({id:l._getProductKey({productId:i,userId:u}),userId:u},n));l.host.models.Product.inject({id:i}),c.productRoles.push(s)}}),e.abrupt("return",c);case 10:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_pickOrganizationId",value:function(){var e=this.host.organizations.getAll();return 0===e.length?"placeholder":e[0].id}},{key:"getAllUserRoles",value:function(){return this.host.models.UserRoles.getAll()}},{key:"getByOrganizationId",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).userId,n=void 0===t?this.host.currentUserId:t;if("string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));var r=this._getOrganizationKey({organizationId:e,userId:n});return this.host.models.UserRoles.get(r)}},{key:"_getOrganizationKey",value:function(e){var t=e.organizationId,n=e.userId,r=void 0===n?this.host.currentUserId:n;if(null==e||"string"!=typeof e.organizationId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  organizationId: string;\n  userId?: ?string;\n}\n\nGot:\n"+s(e));if(null==e||"string"!=typeof e.organizationId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  organizationId: string;\n  userId?: ?string;\n}\n\nGot:\n"+i(e));return"userRoles:"+r+":"+t}},{key:"getAllProductRoles",value:function(){return this.host.models.ProductRoles.getAll()}},{key:"getByProductId",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).userId,n=void 0===t?this.host.currentUserId:t;if("string"!=typeof e)throw new TypeError('Value of argument "productId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+s(e));if("string"!=typeof e)throw new TypeError('Value of argument "productId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+i(e));var r=this._getProductKey({productId:e,userId:n});return this.host.models.ProductRoles.get(r)}},{key:"_getProductKey",value:function(e){var t=e.productId,n=e.userId,r=void 0===n?this.host.currentUserId:n;if(null==e||"string"!=typeof e.productId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  productId: string;\n  userId?: ?string;\n}\n\nGot:\n"+s(e));if(null==e||"string"!=typeof e.productId||void 0!==e.userId&&null!=e.userId&&"string"!=typeof e.userId)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  productId: string;\n  userId?: ?string;\n}\n\nGot:\n"+i(e));return"productRoles:"+r+":"+t}}]),a((l=S).prototype,"findAll",[o],(0,m.default)(l.prototype,"findAll"),l.prototype),a(l.prototype,"refreshAll",[u],(0,m.default)(l.prototype,"refreshAll"),l.prototype),a(l.prototype,"_findAll",[c],(0,m.default)(l.prototype,"_findAll"),l.prototype),l);function S(){return(0,_.default)(this,S),(0,A.default)(this,(S.__proto__||(0,x.default)(S)).apply(this,arguments))}t.default=j,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(n,r,e,t,a){var o={};return Object.keys(t).forEach(function(e){o[e]=t[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=e.slice().reverse().reduce(function(e,t){return t(n,r,e)||e},o),a&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(a):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(n,r,o),o=null),o}function G(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,$.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=G(t[0],n);return t.every(function(e){return G(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return G(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,L.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,F.default)(e))+": "+G(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function C(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,$.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=C(t[0],n);return t.every(function(e){return C(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return C(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,L.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,F.default)(e))+": "+C(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i,s,u,c,l,d,f,p,y,h,g,v,m,b,w,E,x,_,k,A,T,I,O,j,S,R,M,z,P,V,N,U,F=r(n(3)),L=r(n(7)),$=r(n(8)),D=r(n(11)),B=r(n(15)),q=r(n(29)),Z=r(n(20)),K=r(n(10)),H=r(n(9)),W=r(n(21)),X=r(n(23)),Q=r(n(12)),Y=r(n(13)),J=r(n(4)),ee=r(n(1)),te=r(n(2)),ne=r(n(6)),re=r(n(5)),ae=r(n(36)),oe=r(n(41)),ie=r(n(24)),se=r(n(86)),ue=n(18),ce=r(n(17)),le=n(48),de=n(27),fe=r(n(14)),pe=(o=(0,ue.decorator)({serializeArguments:function(e){return""}}),i=(0,ue.decorator)(),s=(0,ue.decorator)(),u=(0,ue.decorator)(),c=(0,ue.decorator)(),l=(0,ue.decorator)(),d=(0,ue.decorator)(),f=(0,ue.decorator)(),g=fe.default,(0,re.default)(ye,g),(0,te.default)(ye,[{key:"mounted",value:function(){this._defaultOrganizationId=null,this._roleMemberIds={},this.host.models.Metadata.on("afterInject",this._onChangeMetadata),this.host.models.Metadata.on("afterEject",this._onChangeMetadata),this.host.models.Role.on("afterInject",this._onChangeRole),this.host.models.Role.on("afterEject",this._onRemoveRole)}},{key:"dispose",value:function(){this._defaultOrganizationId=null,this._roleMemberIds={},this.host.models.Metadata.removeListener("afterInject",this._onChangeMetadata),this.host.models.Metadata.removeListener("afterEject",this._onChangeMetadata),this.host.models.Role.removeListener("afterInject",this._onChangeRole),this.host.models.Role.removeListener("afterEject",this._onRemoveRole)}},{key:"signInWithMagicToken",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new TypeError('Value of argument "magicToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof e)throw new TypeError('Value of argument "magicToken" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(e));var n={Authorization:"magic-token "+e};return this._signInWithHeaders(n,t)}},{key:"signInWithApiKeyAndSecret",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw new TypeError('Value of argument "apiKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof t)throw new TypeError('Value of argument "apiSecret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));if("string"!=typeof e)throw new TypeError('Value of argument "apiKey" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(e));if("string"!=typeof t)throw new TypeError('Value of argument "apiSecret" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));var r=this.httpClient.getAuthHeaders({key:e,secret:t});return this._signInWithHeaders(r,n)}},{key:"signIn",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));(0,de.isPhone)(e)&&(e=(0,de.normalizePhone)(e));var r={Authorization:this.getSignInAuthHeader(e,t)};return this._signInWithHeaders(r,n)}},{key:"_checkPartnerName",value:function(){if(!this.config.partnerName)throw new Error("`partnerName` must be supplied as a config option for `new TigerConnect.Client()`")}},{key:"_signInWithHeaders",value:(U=(0,H.default)(K.default.mark(function e(t){var n,r,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkPartnerName(),e.next=3,this.host.api.users.signIn(t,o);case 3:return n=e.sent,r=this.host.models.User.inject(n.data.user),a=n.data.auth,e.abrupt("return",{auth:a,user:r});case 7:case"end":return e.stop()}},e,this)})),function(e){return U.apply(this,arguments)})},{key:"checkLogin",value:(N=(0,H.default)(K.default.mark(function e(t){var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{udid:void 0};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=4;break;case 4:return this._checkPartnerName(),e.next=7,this.host.api.users.checkLogin(t,r);case 7:return n=e.sent,e.abrupt("return",n.data);case 9:case"end":return e.stop()}},e,this)})),function(e){return N.apply(this,arguments)})},{key:"signUp",value:(V=(0,H.default)(K.default.mark(function e(){var t,n,r,a,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{udid:void 0,email:void 0,password:void 0,countryCode:void 0,version:void 0};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.users.signUp(o);case 2:return t=e.sent,n=this.host.models.User.inject(t.data.user),r=t.data.auth,a={user:n,auth:r},this.host.emit("signUp",a),e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)})),function(){return V.apply(this,arguments)})},{key:"signOut",value:(P=(0,H.default)(K.default.mark(function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=n.fromServer,a=void 0!==r&&r,o=n.resetClient,i=void 0===o||o;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.host.isSignedIn){e.next=2;break}return e.abrupt("return",!1);case 2:return t=!1,this.host.emit("signingOut",{fromServer:a,resetClient:i}),e.prev=4,e.next=7,this.httpClient.post("/v2/logout");case 7:t=!0,e.next=21;break;case 10:if(e.prev=10,e.t0=e.catch(4),!this.httpClient.isUnauthorizedError(e.t0)){e.next=16;break}t=!0,e.next=21;break;case 16:if(!a){e.next=20;break}this.logger.error("error while logging out",e.t0,e.t0.stack),e.next=21;break;case 20:return e.abrupt("return",Z.default.reject(e.t0));case 21:return t&&(this.host._setCurrentUser(null),this.host._removeAuth()),this.host.emit("signedOut",{fromServer:a,resetClient:i&&t,signedOut:t}),e.abrupt("return",t);case 24:case"end":return e.stop()}},e,this,[[4,10]])})),function(){return P.apply(this,arguments)})},{key:"createQRCode",value:(z=(0,H.default)(K.default.mark(function e(){return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.qrCode.create();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return z.apply(this,arguments)})},{key:"findOrCreate",value:(M=(0,H.default)(K.default.mark(function e(t){var n,r,a,o,i,s,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if(null!=u&&(null==u||void 0!==u.organizationId&&null!=u.organizationId&&"string"!=typeof u.organizationId))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string\n}\n\nGot:\n'+C(u));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if(null!=u&&(null==u||void 0!==u.organizationId&&null!=u.organizationId&&"string"!=typeof u.organizationId))throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string\n}\n\nGot:\n'+G(u));e.next=8;break;case 8:if(n=u.organizationId,r=!1,n)return e.next=13,this.host.organizations.find(n);e.next=15;break;case 13:a=e.sent,r=a.isContacts;case 15:if(!r||t===this.host.currentUserId||this.getById(t))return e.next=18,this.find(t,{organizationId:n});e.next=20;break;case 18:return o=e.sent,e.abrupt("return",o);case 20:return e.next=22,this.host.api.users.lookup(t);case 22:return i=e.sent,e.next=25,this.find(i.token,{organizationId:n});case 25:return s=e.sent,e.abrupt("return",s);case 27:case"end":return e.stop()}},e,this)})),function(e){return M.apply(this,arguments)})},{key:"signOutAllDevices",value:(R=(0,H.default)(K.default.mark(function e(){var t;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.api.users.wipe(this.host.currentUserId);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)})),function(){return R.apply(this,arguments)})},{key:"findMe",value:(S=(0,H.default)(K.default.mark(function e(){var t,n,r,a,o,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,ie.default)(i,{ignoreNotFound:!1}),this.host.requireUser(),e.next=4,this.host.api.users.findMe();case 4:if(t=e.sent)return t.entity&&(t.entity.organization_token=t.organization_id,t=t.entity),r=(n=t).metadata,a=n.organization_token,this._defaultOrganizationId=a,o=this.host.models.User.inject(t),r&&this.host.metadata.__injectMetadata(o.id,a,r),e.abrupt("return",o);e.next=14;break;case 14:if(i.ignoreNotFound){e.next=16;break}throw new ce.default.NotFoundError(this.host.models.User.name,"me");case 16:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:"findDefaultOrganizationId",value:(j=(0,H.default)(K.default.mark(function e(){return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._defaultOrganizationId){e.next=3;break}return e.next=3,this.findMe();case 3:return e.abrupt("return",this._defaultOrganizationId);case 4:case"end":return e.stop()}},e,this)})),function(){return j.apply(this,arguments)})},{key:"findMyProfilesForAllOrganizations",value:(O=(0,H.default)(K.default.mark(function e(){var t;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.host.organizations.findAll();case 2:return e.t0=function(e){return e.id},t=e.sent.map(e.t0),e.abrupt("return",this.findProfileForOrganizations(this.host.currentUserId,t));case 5:case"end":return e.stop()}},e,this)})),function(){return O.apply(this,arguments)})},{key:"find",value:(I=(0,H.default)(K.default.mark(function e(t){var n,r,a,o,i,s,u,c,l,d,f,p,y,h,g,v=this,m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if(null==m||null!=m&&(void 0===m.organizationId||null==m.organizationId||"string"==typeof m.organizationId)&&(void 0===m.organizationIds||null==m.organizationIds||Array.isArray(m.organizationIds)&&m.organizationIds.every(function(e){return"string"==typeof e}))){e.next=4;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string;\n  organizationIds?: ?string[];\n}\n\nGot:\n'+C(m));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if(null==m||null!=m&&(void 0===m.organizationId||null==m.organizationId||"string"==typeof m.organizationId)&&(void 0===m.organizationIds||null==m.organizationIds||Array.isArray(m.organizationIds)&&m.organizationIds.every(function(e){return"string"==typeof e}))){e.next=8;break}throw new TypeError('Value of argument "options" violates contract.\n\nExpected:\n?{\n  organizationId?: ?string;\n  organizationIds?: ?string[];\n}\n\nGot:\n'+G(m));case 8:if(m=(0,ie.default)(m,{bypassCache:!1,ignoreNotFound:!1}),this.host.requireUser(),n=this.host.models.User.get(t),a=!(r=void 0),!m.organizationIds){e.next=17;break}r=m.organizationIds,e.next=27;break;case 17:if(!m.organizationId){e.next=21;break}r=[m.organizationId],e.next=27;break;case 21:return a=!1,r=n?[].concat((0,q.default)(n.organizationIds)):[],e.next=25,this.findDefaultOrganizationId();case 25:o=e.sent,r.includes(o)||r.push(o);case 27:if(i=(0,B.default)({},m,{ignoreNotFound:!0}),s=[],!r||"function"!=typeof r[Y.default]&&!Array.isArray(r))throw new TypeError("Expected organizationIds to be iterable, got "+G(r));e.next=31;break;case 31:if(!r||"function"!=typeof r[Y.default]&&!Array.isArray(r))throw new TypeError("Expected organizationIds to be iterable, got "+C(r));e.next=33;break;case 33:for(c=!(u=!0),l=void 0,e.prev=36,d=(0,Q.default)(r);!(u=(f=d.next()).done);u=!0)p=f.value,s.push(this.__find(t,p,i));e.next=44;break;case 40:e.prev=40,e.t0=e.catch(36),c=!0,l=e.t0;case 44:e.prev=44,e.prev=45,!u&&d.return&&d.return();case 47:if(e.prev=47,c)throw l;e.next=50;break;case 50:return e.finish(47);case 51:return e.finish(44);case 52:return e.next=54,Z.default.all(s);case 54:if(y=e.sent,(h=y.map(function(e){return e.user}).find(Boolean))&&(n=this.host.models.User.get(h.id)),!h||t===h.id||a){e.next=62;break}if(0<(g=(0,oe.default)(n.organizationIds,r)).length)return e.next=62,Z.default.all(g.map(function(e){return v.__find(t,e,i)}));e.next=62;break;case 62:if(this.host.models.User.removePlaceholder({entity:n,attrs:h}),m.ignoreNotFound||h){e.next=65;break}throw new ce.default.NotFoundError(this.host.models.User.name,t);case 65:return e.abrupt("return",n);case 66:case"end":return e.stop()}},e,this,[[36,40,44,52],[45,,47,51]])})),function(e){return I.apply(this,arguments)})},{key:"__find",value:(T=(0,H.default)(K.default.mark(function e(t,n){var r,a,o,i,s,u,c=this,l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(n));e.next=8;break;case 8:if(l=(0,ie.default)(l,{bypassCache:!1,ignoreNotFound:!1}),r=this.host.models.User.get(t),l.bypassCache){e.next=16;break}if(r&&!r.$placeholder&&r.profileByOrganizationId&&r.profileByOrganizationId[n])return e.next=14,this.host.metadata.find(t,n,l);e.next=16;break;case 14:return this.host.models.User.touch(t),e.abrupt("return",{user:r});case 16:return e.next=18,this.host.api.users.find(t,{organizationId:n});case 18:if((a=e.sent)&&(a.entity&&(a.entity.organization_token=a.organization_id,a.entity.conversation_id=a.conversation_id,a=a.entity),i=(o=a).dnd_auto_forward_receivers,s=void 0===i?[]:i,u=o.metadata,s.forEach(function(e){return c.host.models.User.injectPlaceholder(e)}),a.dnd_auto_forward_receivers=s,r=this.host.models.User.inject(a),u&&("role"===u.feature_service?this.host.roles.__injectSearchResult({entity:r,metadata:u,organizationId:n}):this.host.metadata.__injectMetadata(r.id,n,u))),l.ignoreNotFound||a){e.next=22;break}throw new ce.default.NotFoundError(this.host.models.User.name,t);case 22:return e.abrupt("return",{data:a,user:r});case 23:case"end":return e.stop()}},e,this)})),function(e,t){return T.apply(this,arguments)})},{key:"findProfileForOrganizations",value:(A=(0,H.default)(K.default.mark(function e(t,n){var r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=4;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+C(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if(Array.isArray(n)&&n.every(function(e){return"string"==typeof e})||Array.isArray(n)&&n.every(function(e){return e instanceof Object})){e.next=8;break}throw new TypeError('Value of argument "organizationIds" violates contract.\n\nExpected:\nstring[] | Object[]\n\nGot:\n'+G(n));case 8:return a=(0,ie.default)(a,{bypassCache:!1,ignoreNotFound:!1}),e.next=11,this.find(t,(0,B.default)({},a,{organizationIds:n}));case 11:return r=e.sent,e.abrupt("return",r?r.profileByOrganizationId:r);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"findProfileForOrganization",value:(k=(0,H.default)(K.default.mark(function e(t,n){var r,a,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+C(n));case 4:if("string"!=typeof t)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+G(n));case 8:return o=(0,ie.default)(o,{bypassCache:!1,ignoreNotFound:!0}),"string"!=typeof n&&(n=n.id),e.next=12,this.find(t,(0,B.default)({},o,{organizationId:n}));case 12:return r=e.sent,a=r&&r.profileByOrganizationId&&r.profileByOrganizationId[n],e.abrupt("return",a||null);case 15:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"ensureUsers",value:(_=(0,H.default)(K.default.mark(function e(t,n){var r,a,o,i,s,u,c,l;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=2;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+C(t));case 2:if("string"==typeof n||n instanceof Object){e.next=4;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+C(n));case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e||e instanceof Object})){e.next=6;break}throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string | Object>\n\nGot:\n'+G(t));case 6:if("string"==typeof n||n instanceof Object){e.next=8;break}throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring | Object\n\nGot:\n'+G(n));case 8:if(this.host.requireUser(),"string"!=typeof n&&(n=n.id),r=[],!t||"function"!=typeof t[Y.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+G(t));e.next=13;break;case 13:if(!t||"function"!=typeof t[Y.default]&&!Array.isArray(t))throw new TypeError("Expected ids to be iterable, got "+C(t));e.next=15;break;case 15:for(o=!(a=!0),i=void 0,e.prev=18,s=(0,Q.default)(t);!(a=(u=s.next()).done);a=!0)c=u.value,r.push(this.find(c,{organizationId:n,ignoreNotFound:!0}));e.next=26;break;case 22:e.prev=22,e.t0=e.catch(18),o=!0,i=e.t0;case 26:e.prev=26,e.prev=27,!a&&s.return&&s.return();case 29:if(e.prev=29,o)throw i;e.next=32;break;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.next=36,Z.default.all(r);case 36:return l=e.sent,e.abrupt("return",l);case 38:case"end":return e.stop()}},e,this,[[18,22,26,34],[27,,29,33]])})),function(e,t){return _.apply(this,arguments)})},{key:"refresh",value:(x=(0,H.default)(K.default.mark(function e(t){var n;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t,{ignoreNotFound:!0,bypassCache:!0});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"update",value:(E=(0,H.default)(K.default.mark(function e(t){var n,r,a,o,i,s=t.firstName,u=t.lastName,c=t.displayName,l=t.status,d=t.dnd,f=t.dndText,p=t.avatarFile,y=t.removeAvatar,h=arguments;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==h[0]||void 0!==h[0].firstName&&null!=h[0].firstName&&"string"!=typeof h[0].firstName||void 0!==h[0].lastName&&null!=h[0].lastName&&"string"!=typeof h[0].lastName||void 0!==h[0].displayName&&null!=h[0].displayName&&"string"!=typeof h[0].displayName||void 0!==h[0].status&&null!=h[0].status&&"string"!=typeof h[0].status||void 0!==h[0].dnd&&null!=h[0].dnd&&"boolean"!=typeof h[0].dnd||void 0!==h[0].dndText&&null!=h[0].dndText&&"string"!=typeof h[0].dndText||!(void 0===h[0].avatarFile||null==h[0].avatarFile||h[0].avatarFile instanceof Object)||void 0!==h[0].removeAvatar&&null!=h[0].removeAvatar&&"boolean"!=typeof h[0].removeAvatar)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName?: ?string;\n  lastName?: ?string;\n  displayName?: ?string;\n  status?: ?string;\n  dnd?: ?boolean;\n  dndText?: ?string;\n  avatarFile?: ?Object;\n  removeAvatar?: ?boolean;\n}\n\nGot:\n"+C(h[0]));e.next=2;break;case 2:if(null==h[0]||void 0!==h[0].firstName&&null!=h[0].firstName&&"string"!=typeof h[0].firstName||void 0!==h[0].lastName&&null!=h[0].lastName&&"string"!=typeof h[0].lastName||void 0!==h[0].displayName&&null!=h[0].displayName&&"string"!=typeof h[0].displayName||void 0!==h[0].status&&null!=h[0].status&&"string"!=typeof h[0].status||void 0!==h[0].dnd&&null!=h[0].dnd&&"boolean"!=typeof h[0].dnd||void 0!==h[0].dndText&&null!=h[0].dndText&&"string"!=typeof h[0].dndText||!(void 0===h[0].avatarFile||null==h[0].avatarFile||h[0].avatarFile instanceof Object)||void 0!==h[0].removeAvatar&&null!=h[0].removeAvatar&&"boolean"!=typeof h[0].removeAvatar)throw new TypeError("Value of argument 0 violates contract.\n\nExpected:\n{\n  firstName?: ?string;\n  lastName?: ?string;\n  displayName?: ?string;\n  status?: ?string;\n  dnd?: ?boolean;\n  dndText?: ?string;\n  avatarFile?: ?Object;\n  removeAvatar?: ?boolean;\n}\n\nGot:\n"+G(h[0]));e.next=4;break;case 4:return this.host.requireUser(),r=(n={firstName:s,lastName:u,displayName:c,status:l,dnd:d,dndText:f,avatarFile:p,removeAvatar:y},se.default).call(n,function(e,t){return void 0===e}),e.next=8,this.host.api.users.update(this.host.currentUserId,r);case 8:return a=e.sent,o=(0,ae.default)(r,"removeAvatar","avatarFile"),y?o.avatarUrl=null:void 0!==a.avatarUrl&&(o.avatarUrl=a.avatarUrl),i=this.host.models.User.inject((0,B.default)({id:this.host.currentUserId},o)),e.abrupt("return",i);case 13:case"end":return e.stop()}},e,this)})),function(e){return E.apply(this,arguments)})},{key:"updatePassword",value:(w=(0,H.default)(K.default.mark(function e(t,n){var r;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "currentPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "newPassword" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(n));e.next=8;break;case 8:return this.host.requireUser(),r=this.host.api.users.updatePassword(this.host.currentUserId,t,n,this.config.productKey),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"setAutoForward",value:(b=(0,H.default)(K.default.mark(function e(t,n){var r;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("string"!=typeof n)throw new TypeError('Value of argument "receiverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if("string"!=typeof n)throw new TypeError('Value of argument "receiverId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(n));e.next=8;break;case 8:return this.host.requireUser(),r=this.host.currentUser.dnd,e.next=12,this.host.api.users.setAutoForward(this.host.currentUserId,t,{dnd:r,receiverId:n});case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return b.apply(this,arguments)})},{key:"removeAutoForward",value:(m=(0,H.default)(K.default.mark(function e(t){return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=4;break;case 4:return this.host.requireUser(),e.next=7,this.host.api.users.removeAutoForward(this.host.currentUserId,t);case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"setEulaAccepted",value:(v=(0,H.default)(K.default.mark(function e(t,n){var r;return K.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));e.next=2;break;case 2:if("boolean"!=typeof n)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+C(n));e.next=4;break;case 4:if("string"!=typeof t)throw new TypeError('Value of argument "organizationId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));e.next=6;break;case 6:if("boolean"!=typeof n)throw new TypeError('Value of argument "accept" violates contract.\n\nExpected:\nboolean\n\nGot:\n'+G(n));e.next=8;break;case 8:return this.host.requireUser(),e.next=11,this.host.api.users.setEulaAccepted(this.host.currentUserId,t,n);case 11:return r=e.sent,e.abrupt("return",r);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"getSignInAuthHeader",value:function(e,t){if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(t));if("string"!=typeof e)throw new TypeError('Value of argument "userId" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(e));if("string"!=typeof t)throw new TypeError('Value of argument "password" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(t));return this.host.api.users.getSignInAuthHeader(this.config.productKey,e,t)}},{key:"getAll",value:function(){return this.host.models.User.getAll()}},{key:"getById",value:function(e){if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+C(e));if("string"!=typeof e)throw new TypeError('Value of argument "id" violates contract.\n\nExpected:\nstring\n\nGot:\n'+G(e));return this.host.models.User.get(e)}},{key:"getMultiById",value:function(e){if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+C(e));if(!Array.isArray(e)||!e.every(function(e){return"string"==typeof e}))throw new TypeError('Value of argument "ids" violates contract.\n\nExpected:\nArray<string>\n\nGot:\n'+G(e));return this.host.models.User.getMulti(e)}},{key:"_onChangeCurrentUserRole",value:function(e){var t=e.botUser;if(t){var n=this.host.roles._roleConversations[t.id];if(n){if(!n||"function"!=typeof n[Y.default]&&!Array.isArray(n))throw new TypeError("Expected roleConversations to be iterable, got "+G(n));if(!n||"function"!=typeof n[Y.default]&&!Array.isArray(n))throw new TypeError("Expected roleConversations to be iterable, got "+C(n));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,Q.default)(n);!(r=(i=s.next()).done);r=!0){var u=i.value,c=!1;if(!(h=u.content)||"function"!=typeof h[Y.default]&&!Array.isArray(h))throw new TypeError("Expected _conversation$content to be iterable, got "+G(h));if(!h||"function"!=typeof h[Y.default]&&!Array.isArray(h))throw new TypeError("Expected _conversation$content to be iterable, got "+C(h));var l=!0,d=!1,f=void 0;try{for(var p,y=(0,Q.default)(h);!(l=(p=y.next()).done);l=!0){var h,g=p.value;g.shouldEnsureRecipientStatus=!0,this.host.models.Message.inject(g),c=!0}}catch(e){d=!0,f=e}finally{try{!l&&y.return&&y.return()}finally{if(d)throw f}}c||this.host.models.Conversation.inject(u)}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}}}}}]),h=y=ye,y.PROFILE_ATTRIBUTES_PER_ORG=le.PROFILE_ATTRIBUTES_PER_ORG,a((p=h).prototype,"signOut",[o],(0,D.default)(p.prototype,"signOut"),p.prototype),a(p.prototype,"findOrCreate",[i],(0,D.default)(p.prototype,"findOrCreate"),p.prototype),a(p.prototype,"signOutAllDevices",[s],(0,D.default)(p.prototype,"signOutAllDevices"),p.prototype),a(p.prototype,"findMe",[u],(0,D.default)(p.prototype,"findMe"),p.prototype),a(p.prototype,"findMyProfilesForAllOrganizations",[c],(0,D.default)(p.prototype,"findMyProfilesForAllOrganizations"),p.prototype),a(p.prototype,"find",[l],(0,D.default)(p.prototype,"find"),p.prototype),a(p.prototype,"__find",[d],(0,D.default)(p.prototype,"__find"),p.prototype),a(p.prototype,"refresh",[f],(0,D.default)(p.prototype,"refresh"),p.prototype),p);function ye(){var e,t,z,n;(0,ee.default)(this,ye);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=z=(0,ne.default)(this,(e=ye.__proto__||(0,J.default)(ye)).call.apply(e,[this].concat(a))),z.PROFILE_ATTRIBUTES_PER_ORG=le.PROFILE_ATTRIBUTES_PER_ORG,z._setMembersOnEntity=function(e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"members",n=e[1<arguments.length&&void 0!==arguments[1]?arguments[1]:"memberIds"],r=e[t];if(n){if(r?r.length=0:r=[],!n||"function"!=typeof n[Y.default]&&!Array.isArray(n))throw new TypeError("Expected memberIds to be iterable, got "+G(n));if(!n||"function"!=typeof n[Y.default]&&!Array.isArray(n))throw new TypeError("Expected memberIds to be iterable, got "+C(n));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Q.default)(n);!(a=(s=u.next()).done);a=!0){var c=s.value,l=z.host.models.User.get(c);l&&r.push(l)}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}}else r=null;e[t]=r},z._onChangeMetadata=function(e,t){var n=t.entityId,r=z.host.models.User.get(n);r&&z.host.models.User.inject(r)},z._onChangeRole=function(e,t){var n=z.host.currentUserId,r=t.botUserId,a=t.memberIds;a=a||[],r&&z.host.models.User.injectPlaceholder({id:r,botRole:t});var o={},i=z._roleMemberIds[t.id];if(i){if(!i||"function"!=typeof i[Y.default]&&!Array.isArray(i))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+G(i));if(!i||"function"!=typeof i[Y.default]&&!Array.isArray(i))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+C(i));var s=!0,u=!1,c=void 0;try{for(var l,d=(0,Q.default)(i);!(s=(l=d.next()).done);s=!0){var f=l.value,p=z.host.models.User.get(f);if(p&&!a.includes(f)){var y=p.roles,h=y.indexOf(t);-1<h&&(y.splice(h,1),o[f]=y)}}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}if(!(z._roleMemberIds[t.id]=a)||"function"!=typeof a[Y.default]&&!Array.isArray(a))throw new TypeError("Expected memberIds to be iterable, got "+G(a));if(!a||"function"!=typeof a[Y.default]&&!Array.isArray(a))throw new TypeError("Expected memberIds to be iterable, got "+C(a));var g=!0,v=!1,m=void 0;try{for(var b,w=(0,Q.default)(a);!(g=(b=w.next()).done);g=!0){var E=b.value,x=z.host.models.User.get(E),_=x?x.roles:[];_.includes(t)||(_.push(t),o[E]=_)}}catch(e){v=!0,m=e}finally{try{!g&&w.return&&w.return()}finally{if(v)throw m}}if(!(j=(0,X.default)(o))||"function"!=typeof j[Y.default]&&!Array.isArray(j))throw new TypeError("Expected _Object$entries to be iterable, got "+G(j));if(!j||"function"!=typeof j[Y.default]&&!Array.isArray(j))throw new TypeError("Expected _Object$entries to be iterable, got "+C(j));var k=!0,A=!1,T=void 0;try{for(var I,O=(0,Q.default)(j);!(k=(I=O.next()).done);k=!0){var j,S=(0,W.default)(I.value,2),R=S[0],M=S[1];z.host.models.User.injectPlaceholder({id:R,roles:M}),R===n&&z._onChangeCurrentUserRole(t)}}catch(e){A=!0,T=e}finally{try{!k&&O.return&&O.return()}finally{if(A)throw T}}},z._onRemoveRole=function(e,t){var n=t.botUserId;n&&z.host.models.User.injectPlaceholder({id:n,botRole:null});var r=z._roleMemberIds[t.id];if(r){if(!r||"function"!=typeof r[Y.default]&&!Array.isArray(r))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+G(r));if(!r||"function"!=typeof r[Y.default]&&!Array.isArray(r))throw new TypeError("Expected lastRoleMemberIds to be iterable, got "+C(r));var a=!0,o=!1,i=void 0;try{for(var s,u=(0,Q.default)(r);!(a=(s=u.next()).done);a=!0){var c=s.value,l=z.host.models.User.get(c);if(l){var d=l.roles,f=d.indexOf(t);-1<f&&(d.splice(f,1),z.host.models.User.inject(l))}}}catch(e){o=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw i}}delete z._roleMemberIds[t.id]}},n=t,(0,ne.default)(z,n)}t.default=pe,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={Conversations:n(160),DistributionLists:n(161),Entities:n(162),Escalations:n(163),EventRouter:n(164),Events:n(78),Forums:n(165),Groups:n(166),Messages:n(167),Metadata:n(168),Mute:n(169),NotificationRouter:n(170),Notifications:n(171),Organizations:n(172),Presence:n(173),Products:n(174),Roles:n(176),RoleTags:n(175),Search:n(177),TypingStatus:n(178),UserRoles:n(179),Users:n(180)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function g(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,s.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=g(t[0],n);return t.every(function(e){return g(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return g(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+g(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}function v(t,n){if(void 0===n&&(n=0),n+=1,null===t)return"null";if(void 0===t)return"void";if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return void 0===t?"undefined":(0,s.default)(t);if(Array.isArray(t)){if(0<t.length){if(4<n)return"[...]";var r=v(t[0],n);return t.every(function(e){return v(e,n)===r})?r.trim()+"[]":"["+t.slice(0,15).map(function(e){return v(e,n)}).join(", ")+(15<=t.length?", ...":"")+"]"}return"Array"}var e=(0,c.default)(t);if(!e.length)return t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"Object";if(4<n)return"{...}";var a="  ".repeat(n-1),o=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,i.default)(e))+": "+v(t[e],n)+";"}).join("\n  "+a);return 15<=e.length&&(o+="\n  "+a+"..."),t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name+" {\n  "+a+o+"\n"+a+"}":"{\n  "+a+o+"\n"+a+"}"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(3)),s=r(n(8)),u=r(n(15)),c=r(n(7)),a=r(n(21)),o=r(n(31)),m=r(n(197)),l=r(n(195)),b=r(n(12)),w=r(n(13)),E=r(n(28)),d=r(n(1)),f=r(n(2)),p=r(n(82)),y=r(n(59)),h=r(n(42)),x=r(n(43)),_=r(n(36)),k=r(n(233)),A=r(n(220)),T=r(n(234)),I=r(n(24)),O=r(n(44)),j=r(n(228)),S=r(n(217)),R=r(n(57)),M=r(n(56)),z=r(n(222)),G=r(n(204)),C=r(n(54)),P=r(n(207)),V=r(n(40)),N=r(n(209)),U=r(n(35)),F=r(n(87)),L=r(n(88)),$=r(n(34)),D=n(22),B={computed:{},defaultValues:null,idAttribute:"id",methods:{},parseAttrs:z.default,relations:{belongsTo:{},hasMany:{}}},q=(0,p.default)("NOT_PROVIDED"),Z=((0,f.default)(K,null,[{key:"create",value:function(e,t,n){return new this(e,t,n)}}]),(0,f.default)(K,[{key:"__initRelations",value:function(){var r=this,y=this,e=(0,R.default)(this.options.relations.belongsTo,function(e,t,n){e[n]={get:function(){return y.store.get(t.type,this[t.foreignKey])},set:function(e){this[t.foreignKey]=y.store.resolveId(t.type,e)}}},{});(0,E.default)(this.options.computed,e);var t=(0,R.default)(this.options.relations.hasMany,function(e,t,c){var l=t.filter,d=t.foreignKey,n=t.sortBy,f=t.type,p=r.__getSorted(n);e[c]={get:function(){if(this.$$transientAttrs.relations||(this.$$transientAttrs.relations={}),this.$$transientAttrs.relations[c])return this.$$transientAttrs.relations[c];var e=[],t=y.store.models[f];if(t.hasManySortFields){if(!(s=t.getAll())||"function"!=typeof s[w.default]&&!Array.isArray(s))throw new TypeError("Expected _entityModel$getAll to be iterable, got "+g(s));if(!s||"function"!=typeof s[w.default]&&!Array.isArray(s))throw new TypeError("Expected _entityModel$getAll to be iterable, got "+v(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,b.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=o.value;u[d]!==this[y.idAttribute]||l&&!l(u)||(t.previousHasManySortValues[u[t.idAttribute]]=(0,O.default)(u,t.hasManySortFields),p.add(e,u))}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}}return this.$$transientAttrs.relations[c]=e},set:function(e){}}},{});(0,E.default)(this.options.computed,t)}},{key:"__getSorted",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[[this.idAttribute,"asc"]],t=(0,D.generateComparator)(e);return new D.SortedArray(t)}},{key:"__initTransientAttrs",value:function(){var e=this,t=this,n={$$transientAttrs:{enumerable:!1,get:function(){var e=this[t.idAttribute];return t.transientAttrsStore[e]||(t.transientAttrsStore[e]={})}}},r={};this.options.transientAttrs&&this.options.transientAttrs.forEach(function(t){e.options.defaultValues&&t in e.options.defaultValues&&(r[t]=(0,D.jsonCloneDeep)(e.options.defaultValues[t]),delete e.options.defaultValues[t]),n[t]={get:function(){return t in this.$$transientAttrs?this.$$transientAttrs[t]:t in r?this.$$transientAttrs[t]=r[t]:void 0},set:function(e){this.$$transientAttrs[t]=e}}}),(0,E.default)(this.options.computed,n)}},{key:"createInstance",value:function(e){1<arguments.length&&void 0!==arguments[1]&&!arguments[1]||(e=this.parseAttrs(e));var t=e[this.idAttribute];if(this.entitiesById[t]||this.entitiesByServerId[t])throw new Error("called createInstance on an existing instance");return this.__wireInstance(e)}},{key:"__wireInstance",value:function(t){var a=this;this.options.defaultValues&&(0,I.default)(t,(0,D.jsonCloneDeep)(this.options.defaultValues));var n={};this._writablePropertyKeys.forEach(function(e){(0,D.isConfigurableProperty)(t,e)&&(n[e]=t[e],delete t[e])}),(0,l.default)(t,this.options.computed),(0,E.default)(t,n),this.options.instanceEvents&&(0,E.default)(t,$.default.prototype),(0,E.default)(t,this.options.methods),(0,E.default)(t,{toPlainObject:function(e){var t=this,n={};a._computedKeys.forEach(function(e){return n[e]=t[e]});var r=(0,E.default)({},this,n);return delete r.setMaxListeners,delete r.emit,delete r.addListener,delete r.on,delete r.once,delete r.removeListener,delete r.removeAllListeners,delete r.listeners,delete r.listenerCount,delete r.off,delete r.toPlainObject,delete r._events,delete r._maxListeners,r}});var e=t[this.idAttribute];return!e||"serverId"in t||(t.serverId=e),this.options.beforeCreateInstance&&this.options.beforeCreateInstance(t),t}},{key:"inject",value:function(e){var t=this.is(e),n=void 0,r=void 0,a=!0;if(t){if(r=e,n=this.resolveId(r),this.entitiesById[n])return this.__beforeInject(r),this.__register(n,r),this.options.afterAssignment&&this.options.afterAssignment(r),this.__addToHasManyRelationships(r),this.options.afterInject&&this.options.afterInject(r),this.emit("afterInject",this,r),r;a=!1}if(a&&(e=this.parseAttrs(e),n=this.resolveId(e),!this.isValidId(n)))throw new Error("'"+this.idAttribute+"' is required");var o=!1;return(r=this.entitiesById[n]||this.entitiesByServerId[n])?(this.__beforeInject(e,r),(0,E.default)(r,e)):(o=!0,r=t?e:this.__wireInstance(e),this.__beforeInject(r)),this.__register(n,r),this.options.afterAssignment&&this.options.afterAssignment(r),this.__addToHasManyRelationships(r),this.options.afterInject&&this.options.afterInject(r),this.emit("afterInject",this,r),o&&(this.options.afterCreate&&this.options.afterCreate(r),this.emit("afterCreate",this,r)),r}},{key:"__beforeInject",value:function(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],o=n[1];!o||"serverId"in a||(a.serverId=o.serverId),this.options.beforeInject&&(e=this.options).beforeInject.apply(e,n),this.emit("beforeInject",this,a)}},{key:"replaceExisting",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).instance,n=this.options.idAttribute;if(this.is(e))throw new Error("cannot call replaceExisting() on an instance; should be plain object");if(t&&!this.is(t))throw new Error("provided 'instance' option is not an instance of this model");e=this.parseAttrs(e);var r=this.resolveId(e);if(!this.isValidId(r))throw new Error("'"+n+"' is required");var a=r,o=void 0;if(t){var i=this.resolveId(t);a!==i&&(this.entitiesById[a]?(this.eject(t),t=null):a=i)}if(t||(t=this.entitiesById[a]||this.entitiesByServerId[a])&&(a=t[n]),t){var s={};for(var u in e)s[u]=!0;if(this.__beforeInject(e,t),!(y=(0,m.default)(t))||"function"!=typeof y[w.default]&&!Array.isArray(y))throw new TypeError("Expected _Object$getOwnPropert to be iterable, got "+g(y));if(!y||"function"!=typeof y[w.default]&&!Array.isArray(y))throw new TypeError("Expected _Object$getOwnPropert to be iterable, got "+v(y));var c=!0,l=!1,d=void 0;try{for(var f,p=(0,b.default)(y);!(c=(f=p.next()).done);c=!0){var y,h=f.value;!s[h]&&(0,D.isConfigurableProperty)(t,h)&&delete t[h]}}catch(e){l=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw d}}(0,E.default)(t,e),t[n]=a,t.serverId=r,this.__wireInstance(t)}else o=!0,t=this.__wireInstance(e),this.__beforeInject(t);return this.__register(a,t),this.options.afterAssignment&&this.options.afterAssignment(t),this.__addToHasManyRelationships(t),this.options.afterInject&&this.options.afterInject(t),this.emit("afterInject",this,t),o&&(this.options.afterCreate&&this.options.afterCreate(t),this.emit("afterCreate",this,t)),t}},{key:"eject",value:function(e){e=this.resolveId(e);var t=this.entitiesById[e]||this.entitiesByServerId[e];t&&(this.emit("beforeEject",this,t),this.__removeFromHasManyRelationships(t),this.__unregister(e,t),this.emit("afterEject",this,t))}},{key:"__register",value:function(e,t){this.entitiesById[e]!==t&&(this.entitiesById[e]=t,this.entitiesList.push(t));var n=this.previousServerIds[e],r=t.serverId;n&&n!==r&&(delete this.entitiesByServerId[n],r===e?delete this.previousServerIds[e]:(this.entitiesByServerId[r]=t,this.previousServerIds[e]=r)),n||r===e||(this.entitiesByServerId[r]=t,this.previousServerIds[e]=r)}},{key:"__unregister",value:function(e,t){delete this.entitiesById[e],(0,T.default)(this.entitiesList,t),e in this.transientAttrsStore&&delete this.transientAttrsStore[e];var n=this.previousServerIds[e];n&&(delete this.entitiesByServerId[n],delete this.previousServerIds[e])}},{key:"injectPlaceholder",value:function(e){var t=e.token||e[this.idAttribute];if(this.get(t))return this.inject(e);var n=this.createInstance(e);return Object.defineProperty(n,"$placeholder",{value:!0,configurable:!0}),this.inject(n)}},{key:"removePlaceholder",value:function(e){var t=e.entity,n=e.attrs;t&&t.$placeholder&&(n?(delete t.$placeholder,delete t.$notFound):Object.defineProperty(t,"$notFound",{value:!0,configurable:!0}),this.inject(t))}},{key:"touch",value:function(e){e=this.resolveId(e),(this.entitiesById[e]||this.entitiesByServerId[e])&&this.inject((0,o.default)({},this.idAttribute,e))}},{key:"__addToHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"add")}},{key:"__removeFromHasManyRelationships",value:function(e){this.__updateRelationsIfNeeded(e,"remove")}},{key:"__updateRelationsIfNeeded",value:function(c,l){var d=this,e=this.store.getParentRelationshipsOfModel(this.name);if(e){var t;this.hasManySortFields||(this.hasManySortFields=(t=(t=e.map(function(e){var t=e.sortBy;return t&&t.map(function(e){return(0,a.default)(e,1)[0]})}).filter(Boolean),C.default).call(t).concat([this.idAttribute]),U.default).call(t));var f=(0,A.default)(this.previousHasManySortValues,c[this.idAttribute])?this.previousHasManySortValues[c[this.idAttribute]]:q;this.previousHasManySortValues[c[this.idAttribute]]=(0,O.default)(c,this.hasManySortFields),e.forEach(function(e){var t=e.filter,n=e.foreignKey,r=e.relationKey,a=e.sortBy,o=e.sorted,i=d.store.get(e.parent,c[n]);if(i&&i.$$transientAttrs.relations&&i.$$transientAttrs.relations[r]){var s=!1;if("remove"===l||t&&!t(c))if(a)s=f===q?o.remove(i[r],c):o.remove(i[r],c,{previousValue:f});else{var u=i[r].indexOf(c);-1!==u&&(i[r].splice(u,1),s=!0)}else"add"===l&&(a?s=f===q?o.update(i[r],c):o.update(i[r],c,{previousValue:f}):i[r].includes(c)||(i[r].push(c),s=!0));i.$$transientAttrs.$$wasUpdatedByRelation||(i.$$transientAttrs.$$wasUpdatedByRelation=s)}})}}},{key:"ejectAll",value:function(){for(;0<this.entitiesList.length;)this.eject(this.entitiesList[0])}},{key:"parseAttrs",value:function(e){var t=this,n=(0,k.default)(e,function(e){return t.store.isEntity(e)||t.store.isEntityArray(e)}),r=(0,O.default)(e,this.options.transientAttrs),a=(0,_.default)(e,(0,c.default)(n),this.options.transientAttrs),o=this.options.parseAttrs((0,D.jsonCloneDeep)(a));return(0,u.default)({},o,n,r)}},{key:"getAll",value:function(){return this.entitiesList}},{key:"getMulti",value:function(e){return e.map(this.get)}},{key:"resolveId",value:function(e){return this.isValidId(e)?e:e[this.idAttribute]}},{key:"isValidId",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"is",value:function(e){return e&&e.$entityClass===this}}]),K);function K(e,t){var n,r=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};(0,d.default)(this,K),this.get=function(e){return r.entitiesById[e]||r.entitiesByServerId[e]||null},this.options=(0,M.default)({},a,B),this.idAttribute=this.options.idAttribute,this.name=t,this.store=e,this.entitiesById={},this.entitiesByServerId={},this.entitiesList=[],this.hasManySortFields=null,this.previousHasManySortValues={},this.previousServerIds={},this.transientAttrsStore={},this.options.relations&&this.__initRelations(),this.__initTransientAttrs(),(0,E.default)(this.options.computed,{$entityType:{enumerable:!0,value:t,writable:!1},$entityClass:{enumerable:!1,value:this,writable:!1}}),this.options.computed=(0,R.default)(this.options.computed,function(e,t,n){e[n]="function"==typeof t?{get:t,enumerable:!1}:t},{}),this._computedKeys=(n=(n=this.options.computed,P.default).call(n),L.default).call(n,"$entityType","$entityClass","$$transientAttrs"),this._writablePropertyKeys=(n=(n=(n=this.options.computed,N.default).call(n),G.default).call(n,function(e){return e[1].set}),V.default).call(n,S.default),this._relationKeys=(n=(n=(n=this.options.relations,F.default).call(n),V.default).call(n,j.default),C.default).call(n)}(0,E.default)(Z.prototype,$.default.prototype);var H=((0,f.default)(W,[{key:"defineModel",value:function(o){var i=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.models[o])throw new Error(o+" already defined");e=(0,u.default)({},this.options,e),this.models[o]=Z.create(this,o,e);var t=this.models[o].options.relations.hasMany;return(0,x.default)(t)||(0,h.default)(t,function(e,t){var n=e.sortBy,r=e.type,a=i.models[o].__getSorted(n);i.__relationsOfHasManyByContainedItem[r]||(i.__relationsOfHasManyByContainedItem[r]=[]),i.__relationsOfHasManyByContainedItem[r].push((0,u.default)({},e,{relationKey:t,sorted:a,parent:o}))}),this.models[o]}},{key:"getParentRelationshipsOfModel",value:function(e){return this.__relationsOfHasManyByContainedItem[e]}},{key:"isEntity",value:function(e){return e&&e.$entityClass&&e.$entityClass.constructor===Z}},{key:"isEntityArray",value:function(e){return e&&Array.isArray(e)&&e.some(this.isEntity)}},{key:"clear",value:function(){(0,y.default)(this.models).forEach(function(e){return e.ejectAll()})}}]),W);function W(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(0,d.default)(this,W),this.options=e,this.models={},this.__relationsOfHasManyByContainedItem={},["filter","get","getAll","inject","injectPlaceholder","is","resolveId"].forEach(function(o){i[o]=function(e){for(var t,n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=i.models[e])[o].apply(t,r)}})}t.default=H,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(15)),a=r(n(33)),i=r(n(1)),s=r(n(2)),u=r(n(44)),c=r(n(36)),l=r(n(43)),d=r(n(24)),f=r(n(42)),p=r(n(159)),y=n(22),h=r(n(182)),g=((0,s.default)(v,[{key:"defineModels",value:function(){var n=this,r={},a=(0,o.default)({},this.options,{host:this.host,logger:this.logger});(0,f.default)(p.default,function(e,t){r[t]=e(n,a)}),this.models=r}},{key:"defineModel",value:function(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return(0,d.default)(a,{replaceKeys:{},skipCamelizationForKeys:null}),(0,d.default)(a.replaceKeys,{token:"id"}),this.store.defineModel(e,(0,o.default)({},a,{afterInject:function(e){var t=Date.now();e.$lastModified===t&&(t+=1e-5),e.$lastModified=t,a.afterInject&&a.afterInject(e)},parseAttrs:function(e){var t=void 0;if((0,l.default)(a.skipCamelizationForKeys))t=y.Camelizer.camelizeObject(e);else{var n=(0,c.default)(e,a.skipCamelizationForKeys),r=(0,u.default)(e,a.skipCamelizationForKeys);t=(0,o.default)({},y.Camelizer.camelizeObject(n),r)}return(0,y.replaceKeys)(t,a.replaceKeys),a.parseAttrs&&(t=a.parseAttrs(t,e)),t}}))}},{key:"clear",value:function(){this.store.clear()}}]),v);function v(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.logger,r=(0,a.default)(t,["logger"]);(0,i.default)(this,v),this.host=e,this.options=r,this.logger=n,this.store=new h.default((0,o.default)({},r,{host:e,logger:n})),this.store.host=e}t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(1)),o=r(n(2)),i=r(n(82)),s=r(n(244)),u=Object.prototype.hasOwnProperty,c=(0,i.default)("NOT_PROVIDED"),l=((0,o.default)(d,[{key:"add",value:function(e,t){var n=s.default.gt(e,t,this.cmp);-1!==n?e.splice(n,0,t):e.push(t)}},{key:"indexOf",value:function(e,t,n){var r=n&&u.call(n,"previousValue")?n.previousValue:c,a=e.length;if(r===c||0===this.cmp(t,r)){var o=s.default.gt(e,t,this.cmp);if(-1!=(o=-1===o?a-1:o-1)){for(;0<o&&0===this.cmp(e[o-1],t);)o--;for(;o<a&&0===this.cmp(e[o],t);){if(e[o]===t)return o;o++}}}else for(var i=0;i<a;){if(e[i]===t)return i;i++}return-1}},{key:"remove",value:function(e,t,n){var r=this.indexOf(e,t,n);return-1!==r&&(e.splice(r,1),!0)}},{key:"removeAll",value:function(e,t,n){var r=n&&u.call(n,"previousValue")?n.previousValue:c,a=this.indexOf(e,t,n),o=!1;if(-1!==a)for(var i=r===c||0===this.cmp(t,r);a<e.length&&(!i||0===this.cmp(e[a],t));)e[a]===t?(e.splice(a,1),o=!0):a++;return o}},{key:"update",value:function(e,t,n){var r=n&&u.call(n,"previousValue")?n.previousValue:c,a=r===c||0===this.cmp(t,r),o=this.indexOf(e,t,n);if(-1!==o){if(a)return!1;e.splice(o,1)}return-1!==(o=s.default.gt(e,t,this.cmp))?e.splice(o,0,t):e.push(t),!0}}]),d);function d(e){(0,a.default)(this,d),this.cmp=e}t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(68),o=(r=a)&&r.__esModule?r:{default:r},i={isNotEmpty:function(e,t){return!!t},notEmpty:function(e,t,n){i.isNotEmpty(e,t)||(n=n||"expected "+e+" to be provided",i.raise(e,void 0,n))},isOneOf:function(e,t,n){return n.includes(t)},oneOf:function(e,t,n,r){i.isOneOf(e,t,n)||(r=r||"expected "+t+" to be one of ("+n.join(", ")+")",i.raise(e,void 0,r))},raise:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"invalid",n=arguments[2];throw new o.default(e,t,n)}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(3)),f=r(n(7)),p=r(n(8)),y=r(n(21)),h=r(n(12)),g=r(n(13));t.default=function(e){var t=0,n=[];if(!e||"function"!=typeof e[g.default]&&!Array.isArray(e))throw new TypeError("Expected rules to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));if(!e||"function"!=typeof e[g.default]&&!Array.isArray(e))throw new TypeError("Expected rules to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(e));var r=!0,a=!1,o=void 0;try{for(var i,s=(0,h.default)(e);!(r=(i=s.next()).done);r=!0){var u=(0,y.default)(i.value,2),c=u[0],l=u[1];if(n.push("const a"+t+" = a['"+c+"']"),n.push("const b"+t+" = b['"+c+"']"),"asc"===l)n.push("if (a"+t+" === undefined && b"+t+" !== undefined) return -1"),n.push("if (a"+t+" !== undefined && b"+t+" === undefined) return 1"),n.push("if (a"+t+" === null && b"+t+" !== null) return -1"),n.push("if (a"+t+" !== null && b"+t+" === null) return 1"),n.push("if (a"+t+" < b"+t+") return -1"),n.push("if (a"+t+" > b"+t+") return 1");else{if("desc"!==l)throw new Error("unsupported sort ordering for field "+c+": "+l);n.push("if (a"+t+" === undefined && b"+t+" !== undefined) return 1"),n.push("if (a"+t+" !== undefined && b"+t+" === undefined) return -1"),n.push("if (a"+t+" === null && b"+t+" !== null) return 1"),n.push("if (a"+t+" !== null && b"+t+" === null) return -1"),n.push("if (a"+t+" < b"+t+") return 1"),n.push("if (a"+t+" > b"+t+") return -1")}t++}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n.push("return 0"),new Function("a","b",n.join("\n"))},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){!(n in e)&&t in e&&(e[n]=e[t],delete e[t])},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var d=r(n(3)),f=r(n(7)),p=r(n(8)),y=r(n(21)),h=r(n(12)),g=r(n(13)),v=r(n(23));t.default=function(e,t){if(!(s=(0,v.default)(t))||"function"!=typeof s[g.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$entries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(s));if(!s||"function"!=typeof s[g.default]&&!Array.isArray(s))throw new TypeError("Expected _Object$entries to be iterable, got "+function t(n,r){if(void 0===r&&(r=0),r+=1,null===n)return"null";if(void 0===n)return"void";if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void 0===n?"undefined":(0,p.default)(n);if(Array.isArray(n)){if(0<n.length){if(4<r)return"[...]";var a=t(n[0],r);return n.every(function(e){return t(e,r)===a})?a.trim()+"[]":"["+n.slice(0,15).map(function(e){return t(e,r)}).join(", ")+(15<=n.length?", ...":"")+"]"}return"Array"}var e=(0,f.default)(n);if(!e.length)return n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name:"Object";if(4<r)return"{...}";var o="  ".repeat(r-1),i=e.slice(0,15).map(function(e){return(/^([A-Z_$][A-Z0-9_$]*)$/i.test(e)?e:(0,d.default)(e))+": "+t(n[e],r)+";"}).join("\n  "+o);return 15<=e.length&&(i+="\n  "+o+"..."),n.constructor&&n.constructor.name&&"Object"!==n.constructor.name?n.constructor.name+" {\n  "+o+i+"\n"+o+"}":"{\n  "+o+i+"\n"+o+"}"}(s));var n=!0,r=!1,a=void 0;try{for(var o,i=(0,h.default)(s);!(n=(o=i.next()).done);n=!0){var s,u=(0,y.default)(o.value,2),c=u[0],l=u[1];!(l in e)&&c in e&&(e[l]=e[c],delete e[c])}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return e},e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(i){return function(e){for(var t=e[0],n=arguments.length,r=Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var o=0;o<r.length;++o)t+=i(r[o]),t+=e[o+1];return t}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(189),o=(r=a)&&r.__esModule?r:{default:r};t.default=(0,o.default)(encodeURIComponent),e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(192),o=((r=a)&&r.__esModule?r:{default:r}).default.version;o=o.replace("-dev",""),t.default=o,e.exports=t.default},function(e,t){e.exports={name:"tigerconnect",private:!0,version:"7.3.1",description:"JS (web and node) SDK for TigerConnect",homepage:"https://tigerconnect.github.io/js-sdk/",repository:"tigerconnect/js-sdk",author:{name:"TigerConnect Developers",email:"developersupport@tigerconnect.com",url:"https://tigerconnect.github.io/js-sdk/"},main:"lib/index.js",keywords:["tigerconnect","tigertext","communications","messenger","sdk"],scripts:{"build:clean":"rimraf lib dist","build:js":"babel -d lib/ src/","build:travis":"run-s lint coverage:travis build","build:webpack":"webpack","build:webpack:node":"webpack --target node",build:"run-p build:clean build:js build:webpack","build:node":"run-s build:webpack:node",coverage:"run-s coverage:clean coverage:test coverage:report:html","coverage:check":"nyc check-coverage","coverage:clean":"rimraf .nyc_output","coverage:open":"open-cli coverage/index.html","coverage:report":"run-s coverage:report:*","coverage:report:codecov":"nyc report --reporter=lcov > coverage.lcov && codecov","coverage:report:html":"rimraf coverage && nyc report --reporter=html","coverage:test":'cross-env NODE_ENV=coverage nyc mocha "test/**/*.test.js"',"coverage:travis":"run-s coverage:test coverage:report coverage:check","deploy:docs":"gulp npm:publish:docs:prepare",deps:"npm-check -s","deps:update":"npm-check -u",lint:"eslint . --ext .js","lint:fix":"eslint . --ext .js --fix",test:'mocha "test/**/*.test.js"',watch:"run-s build:clean && gulp build:js && run-p watch:js watch:webpack","watch:js":"gulp watch:js","watch:test":"npm test -- -w","watch:webpack":"webpack --watch"},husky:{hooks:{"pre-push":"./hooks/pre-push"}},nyc:{statements:79,branches:70,lines:80,include:["src/**/*.js"],exclude:["test/**/*.test.js"],require:["babel-register"],sourceMap:!1,instrument:!1,cache:!0},dependencies:{"babel-polyfill":"~6.20.0",btoa:"^1.1.2","file-saver":"^1.3.3","file-type":"^4.0.0","humanize-list":"^1.0.1",invariant:"^2.2.2","is-email":"^1.0.0",jshashes:"^1.0.7",lodash:"^4.17.15","lodash-bound":"^1.1.2",maltypart:"^1.5.0",mime:"^1.6.0",moment:"^2.24.0",qs:"^6.1.0",raf:"^3.4.0",request:"^2.88.0","reuse-promise":"^1.1.0",shallowequal:"^0.2.2","sorted-array-functions":"^1.1.0",superagent:"^5.1.0","superagent-prefix":"0.0.2","tt-eventsource":"^0.2.1-tt1",uuid:"^3.0.0"},devDependencies:{"assets-webpack-plugin":"^4.0.0","babel-cli":"~6.18.0","babel-core":"~6.21.0","babel-eslint":"^7.1.1","babel-loader":"^6.2.8","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-conditional-compilation":"0.0.1","babel-plugin-flow-comments":"^6.3.19","babel-plugin-import-asserts":"^3.0.0","babel-plugin-istanbul":"^4.1.5","babel-plugin-lodash":"^3.2.10","babel-plugin-macros":"^1.0.15","babel-plugin-syntax-flow":"^6.18.0","babel-plugin-transform-class-properties":"~6.19.0","babel-plugin-transform-decorators-legacy":"^1.3.4","babel-plugin-transform-es2015-classes":"^6.18.0","babel-plugin-transform-flow-strip-types":"^6.18.0","babel-plugin-transform-runtime":"~6.15.0","babel-plugin-typecheck":"^3.9.0","babel-preset-es2015":"^6.18.0","babel-preset-stage-0":"^6.16.0",busboy:"^0.2.14",chai:"^4.2.0","chai-as-promised":"^7.1.1","chai-deep-match":"^1.2.1",codecov:"^3.5.0","cross-env":"^3.2.4",decache:"^4.1.0","dom-storage":"^2.0.2",eslint:"^3.17.1",gulp:"^4.0.2","gulp-babel":"^6.1.2","gulp-changed":"^4.0.1","gulp-debug":"^4.0.0","gulp-file":"^0.4.0","gulp-if":"^3.0.0","gulp-load-plugins":"^2.0.1","gulp-plumber":"^1.2.1","gulp-uglify":"^3.0.2","gulp-watch":"^5.0.1",husky:"^3.0.3","json-loader":"^0.5.4","lodash-webpack-plugin":"^0.11.2",mocha:"^6.2.0","mocha-clean":"^1.0.0",nock:"^9.0.2","npm-check":"^5.9.0","npm-run-all":"^4.0.2",nyc:"^14.1.1","open-cli":"^5.0.0","performance-now":"^2.0.0",rimraf:"^2.5.4",sinon:"^7.4.1","sinon-chai":"^3.3.0","strip-loader":"^0.1.2",timekeeper:"1.0.0",watch:"^1.0.1",webpack:"^1.13.3","webpack-node-externals":"^1.5.4",yargs:"^6.4.0"},license:{type:"Commercial",url:"https://tigerconnect.com/terms/end-user-terms-use-license-agreement/"}}},function(e,t,n){function r(e){return n(a(e))}function a(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./node":76,"./node.js":76,"./web":77,"./web.js":77};r.keys=function(){return Object.keys(o)},r.resolve=a,(e.exports=r).id=193},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("babel-runtime/core-js/object/define-properties")},function(e,t){e.exports=require("babel-runtime/core-js/object/freeze")},function(e,t){e.exports=require("babel-runtime/core-js/object/get-own-property-names")},function(e,t){e.exports=require("babel-runtime/core-js/set")},function(e,t){e.exports=require("file-saver")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("invariant")},function(e,t){e.exports=require("is-email")},function(e,t){e.exports=require("lodash-bound/each")},function(e,t){e.exports=require("lodash-bound/filter")},function(e,t){e.exports=require("lodash-bound/initial")},function(e,t){e.exports=require("lodash-bound/keyBy")},function(e,t){e.exports=require("lodash-bound/keys")},function(e,t){e.exports=require("lodash-bound/pickBy")},function(e,t){e.exports=require("lodash-bound/toPairs")},function(e,t){e.exports=require("lodash/assign")},function(e,t){e.exports=require("lodash/camelCase")},function(e,t){e.exports=require("lodash/castArray")},function(e,t){e.exports=require("lodash/compact")},function(e,t){e.exports=require("lodash/filter")},function(e,t){e.exports=require("lodash/find")},function(e,t){e.exports=require("lodash/findKey")},function(e,t){e.exports=require("lodash/first")},function(e,t){e.exports=require("lodash/flatten")},function(e,t){e.exports=require("lodash/get")},function(e,t){e.exports=require("lodash/has")},function(e,t){e.exports=require("lodash/head")},function(e,t){e.exports=require("lodash/identity")},function(e,t){e.exports=require("lodash/includes")},function(e,t){e.exports=require("lodash/intersection")},function(e,t){e.exports=require("lodash/invert")},function(e,t){e.exports=require("lodash/isArray")},function(e,t){e.exports=require("lodash/isObject")},function(e,t){e.exports=require("lodash/keys")},function(e,t){e.exports=require("lodash/last")},function(e,t){e.exports=require("lodash/mapKeys")},function(e,t){e.exports=require("lodash/memoize")},function(e,t){e.exports=require("lodash/orderBy")},function(e,t){e.exports=require("lodash/pickBy")},function(e,t){e.exports=require("lodash/pull")},function(e,t){e.exports=require("lodash/snakeCase")},function(e,t){e.exports=require("lodash/sortBy")},function(e,t){e.exports=require("lodash/uniqBy")},function(e,t){e.exports=require("lodash/without")},function(e,t){e.exports=require("maltypart")},function(e,t){e.exports=require("mime")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("raf")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("sorted-array-functions")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-prefix")},function(e,t){e.exports=require("tt-eventsource")}]);